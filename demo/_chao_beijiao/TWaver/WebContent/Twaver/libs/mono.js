!function(a,b){function c(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function d(){return new c(null)}function e(a,b,c,d,e,f){for(;--f>=0;){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=67108863&g}return e}function f(a,b,c,d,e,f){for(var g=32767&b,h=b>>15;--f>=0;){var i=32767&this[a],j=this[a++]>>15,k=h*i+j*g;i=g*i+((32767&k)<<15)+c[d]+(1073741823&e),e=(i>>>30)+(k>>>15)+h*j+(e>>>30),c[d++]=1073741823&i}return e}function g(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this[a],j=this[a++]>>14,k=h*i+j*g;i=g*i+((16383&k)<<14)+c[d]+e,e=(i>>28)+(k>>14)+h*j,c[d++]=268435455&i}return e}function h(a){return dd.charAt(a)}function j(a,b){var c=ed[a.charCodeAt(b)];return null==c?-1:c}function k(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s}function l(a){this.t=1,this.s=0>a?-1:0,a>0?this[0]=a:-1>a?this[0]=a+DV:this.t=0}function m(a){var b=d();return b.fromInt(a),b}function n(a,b){var d;if(16==b)d=4;else if(8==b)d=3;else if(256==b)d=8;else if(2==b)d=1;else if(32==b)d=5;else{if(4!=b)return void this.fromRadix(a,b);d=2}this.t=0,this.s=0;for(var e=a.length,f=!1,g=0;--e>=0;){var h=8==d?255&a[e]:j(a,e);0>h?"-"==a.charAt(e)&&(f=!0):(f=!1,0==g?this[this.t++]=h:g+d>this.DB?(this[this.t-1]|=(h&(1<<this.DB-g)-1)<<g,this[this.t++]=h>>this.DB-g):this[this.t-1]|=h<<g,g+=d,g>=this.DB&&(g-=this.DB))}8==d&&0!=(128&a[0])&&(this.s=-1,g>0&&(this[this.t-1]|=(1<<this.DB-g)-1<<g)),this.clamp(),f&&c.ZERO.subTo(this,this)}function o(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function p(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var c,d=(1<<b)-1,e=!1,f="",g=this.t,i=this.DB-g*this.DB%b;if(g-->0)for(i<this.DB&&(c=this[g]>>i)>0&&(e=!0,f=h(c));g>=0;)b>i?(c=(this[g]&(1<<i)-1)<<b-i,c|=this[--g]>>(i+=this.DB-b)):(c=this[g]>>(i-=b)&d,0>=i&&(i+=this.DB,--g)),c>0&&(e=!0),e&&(f+=h(c));return e?f:"0"}function q(){var a=d();return c.ZERO.subTo(this,a),a}function r(){return this.s<0?this.negate():this}function s(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(b=c-a.t,0!=b)return b;for(;--c>=0;)if(0!=(b=this[c]-a[c]))return b;return 0}function t(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function u(){return this.t<=0?0:this.DB*(this.t-1)+t(this[this.t-1]^this.s&this.DM)}function v(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s}function w(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s}function x(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()}function y(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)return void(b.t=0);var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function z(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0,-1>d?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()}function A(a,b){var d=this.abs(),e=a.abs(),f=d.t;for(b.t=f+e.t;--f>=0;)b[f]=0;for(f=0;f<e.t;++f)b[f+d.t]=d.am(0,e[f],b,f,0,d.t);b.s=0,b.clamp(),this.s!=a.s&&c.ZERO.subTo(b,b)}function B(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()}function C(a,b,e){var f=a.abs();if(!(f.t<=0)){var g=this.abs();if(g.t<f.t)return null!=b&&b.fromInt(0),void(null!=e&&this.copyTo(e));null==e&&(e=d());var h=d(),i=this.s,j=a.s,k=this.DB-t(f[f.t-1]);k>0?(f.lShiftTo(k,h),g.lShiftTo(k,e)):(f.copyTo(h),g.copyTo(e));var l=h.t,m=h[l-1];if(0!=m){var n=m*(1<<this.F1)+(l>1?h[l-2]>>this.F2:0),o=this.FV/n,p=(1<<this.F1)/n,q=1<<this.F2,r=e.t,s=r-l,u=null==b?d():b;for(h.dlShiftTo(s,u),e.compareTo(u)>=0&&(e[e.t++]=1,e.subTo(u,e)),c.ONE.dlShiftTo(l,u),u.subTo(h,h);h.t<l;)h[h.t++]=0;for(;--s>=0;){var v=e[--r]==m?this.DM:Math.floor(e[r]*o+(e[r-1]+q)*p);if((e[r]+=h.am(0,v,e,s,0,l))<v)for(h.dlShiftTo(s,u),e.subTo(u,e);e[r]<--v;)e.subTo(u,e)}null!=b&&(e.drShiftTo(l,b),i!=j&&c.ZERO.subTo(b,b)),e.t=l,e.clamp(),k>0&&e.rShiftTo(k,e),0>i&&c.ZERO.subTo(e,e)}}}function D(a){var b=d();return this.abs().divRemTo(a,null,b),this.s<0&&b.compareTo(c.ZERO)>0&&a.subTo(b,b),b}function E(a){this.m=a}function F(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function G(a){return a}function H(a){a.divRemTo(this.m,null,a)}function I(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function J(a,b){a.squareTo(b),this.reduce(b)}function K(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function L(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function M(a){var b=d();return a.abs().dlShiftTo(this.m.t,b),b.divRemTo(this.m,null,b),a.s<0&&b.compareTo(c.ZERO)>0&&this.m.subTo(b,b),b}function N(a){var b=d();return a.copyTo(b),this.reduce(b),b}function O(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=b+this.m.t,a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function P(a,b){a.squareTo(b),this.reduce(b)}function Q(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function R(){return 0==(this.t>0?1&this[0]:this.s)}function S(a,b){if(a>4294967295||1>a)return c.ONE;var e=d(),f=d(),g=b.convert(this),h=t(a)-1;for(g.copyTo(e);--h>=0;)if(b.sqrTo(e,f),(a&1<<h)>0)b.mulTo(f,g,e);else{var i=e;e=f,f=i}return b.revert(e)}function T(a,b){var c;return c=256>a||b.isEven()?new E(b):new L(b),this.exp(a,c)}function U(){var a=d();return this.copyTo(a),a}function V(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function W(){return 0==this.t?this.s:this[0]<<24>>24}function X(){return 0==this.t?this.s:this[0]<<16>>16}function Y(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function Z(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function $(a){if(null==a&&(a=10),0==this.signum()||2>a||a>36)return"0";var b=this.chunkSize(a),c=Math.pow(a,b),e=m(c),f=d(),g=d(),h="";for(this.divRemTo(e,f,g);f.signum()>0;)h=(c+g.intValue()).toString(a).substr(1)+h,f.divRemTo(e,f,g);return g.intValue().toString(a)+h}function _(a,b){this.fromInt(0),null==b&&(b=10);for(var d=this.chunkSize(b),e=Math.pow(b,d),f=!1,g=0,h=0,i=0;i<a.length;++i){var k=j(a,i);0>k?"-"==a.charAt(i)&&0==this.signum()&&(f=!0):(h=b*h+k,++g>=d&&(this.dMultiply(e),this.dAddOffset(h,0),g=0,h=0))}g>0&&(this.dMultiply(Math.pow(b,g)),this.dAddOffset(h,0)),f&&c.ZERO.subTo(this,this)}function ab(a,b,d){if("number"==typeof b)if(2>a)this.fromInt(1);else for(this.fromNumber(a,d),this.testBit(a-1)||this.bitwiseTo(c.ONE.shiftLeft(a-1),ib,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(c.ONE.shiftLeft(a-1),this);else{var e=new Array,f=7&a;e.length=(a>>3)+1,b.nextBytes(e),f>0?e[0]&=(1<<f)-1:e[0]=0,this.fromString(e,256)}}function bb(){var a=this.t,b=new Array;b[0]=this.s;var c,d=this.DB-a*this.DB%8,e=0;if(a-->0)for(d<this.DB&&(c=this[a]>>d)!=(this.s&this.DM)>>d&&(b[e++]=c|this.s<<this.DB-d);a>=0;)8>d?(c=(this[a]&(1<<d)-1)<<8-d,c|=this[--a]>>(d+=this.DB-8)):(c=this[a]>>(d-=8)&255,0>=d&&(d+=this.DB,--a)),0!=(128&c)&&(c|=-256),0==e&&(128&this.s)!=(128&c)&&++e,(e>0||c!=this.s)&&(b[e++]=c);return b}function cb(a){return 0==this.compareTo(a)}function db(a){return this.compareTo(a)<0?this:a}function eb(a){return this.compareTo(a)>0?this:a}function fb(a,b,c){var d,e,f=Math.min(a.t,this.t);for(d=0;f>d;++d)c[d]=b(this[d],a[d]);if(a.t<this.t){for(e=a.s&this.DM,d=f;d<this.t;++d)c[d]=b(this[d],e);c.t=this.t}else{for(e=this.s&this.DM,d=f;d<a.t;++d)c[d]=b(e,a[d]);c.t=a.t}c.s=b(this.s,a.s),c.clamp()}function gb(a,b){return a&b}function hb(a){var b=d();return this.bitwiseTo(a,gb,b),b}function ib(a,b){return a|b}function jb(a){var b=d();return this.bitwiseTo(a,ib,b),b}function kb(a,b){return a^b}function lb(a){var b=d();return this.bitwiseTo(a,kb,b),b}function mb(a,b){return a&~b}function nb(a){var b=d();return this.bitwiseTo(a,mb,b),b}function ob(){for(var a=d(),b=0;b<this.t;++b)a[b]=this.DM&~this[b];return a.t=this.t,a.s=~this.s,a}function pb(a){var b=d();return 0>a?this.rShiftTo(-a,b):this.lShiftTo(a,b),b}function qb(a){var b=d();return 0>a?this.lShiftTo(-a,b):this.rShiftTo(a,b),b}function rb(a){if(0==a)return-1;var b=0;return 0==(65535&a)&&(a>>=16,b+=16),0==(255&a)&&(a>>=8,b+=8),0==(15&a)&&(a>>=4,b+=4),0==(3&a)&&(a>>=2,b+=2),0==(1&a)&&++b,b}function sb(){for(var a=0;a<this.t;++a)if(0!=this[a])return a*this.DB+rb(this[a]);return this.s<0?this.t*this.DB:-1}function tb(a){for(var b=0;0!=a;)a&=a-1,++b;return b}function ub(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c)a+=tb(this[c]^b);return a}function vb(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this[b]&1<<a%this.DB)}function wb(a,b){var d=c.ONE.shiftLeft(a);return this.bitwiseTo(d,b,d),d}function xb(a){return this.changeBit(a,ib)}function yb(a){return this.changeBit(a,mb)}function zb(a){return this.changeBit(a,kb)}function Ab(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]+a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a[c],b[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=0>d?-1:0,d>0?b[c++]=d:-1>d&&(b[c++]=this.DV+d),b.t=c,b.clamp()}function Bb(a){var b=d();return this.addTo(a,b),b}function Cb(a){var b=d();return this.subTo(a,b),b}function Db(a){var b=d();return this.multiplyTo(a,b),b}function Eb(){var a=d();return this.squareTo(a),a}function Fb(a){var b=d();return this.divRemTo(a,b,null),b}function Gb(a){var b=d();return this.divRemTo(a,null,b),b}function Hb(a){var b=d(),c=d();return this.divRemTo(a,b,c),new Array(b,c)}function Ib(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function Jb(a,b){if(0!=a){for(;this.t<=b;)this[this.t++]=0;for(this[b]+=a;this[b]>=this.DV;)this[b]-=this.DV,++b>=this.t&&(this[this.t++]=0),++this[b]}}function Kb(){}function Lb(a){return a}function Mb(a,b,c){a.multiplyTo(b,c)}function Nb(a,b){a.squareTo(b)}function Ob(a){return this.exp(a,new Kb)}function Pb(a,b,c){var d=Math.min(this.t+a.t,b);for(c.s=0,c.t=d;d>0;)c[--d]=0;var e;for(e=c.t-this.t;e>d;++d)c[d+this.t]=this.am(0,a[d],c,d,0,this.t);for(e=Math.min(a.t,b);e>d;++d)this.am(0,a[d],c,d,0,b-d);c.clamp()}function Qb(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;--d>=0;)c[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c[this.t+d-b]=this.am(b-d,a[d],c,0,0,this.t+d-b);c.clamp(),c.drShiftTo(1,c)}function Rb(a){this.r2=d(),this.q3=d(),c.ONE.dlShiftTo(2*a.t,this.r2),this.mu=this.r2.divide(a),this.m=a}function Sb(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var b=d();return a.copyTo(b),this.reduce(b),b}function Tb(a){return a}function Ub(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);a.compareTo(this.r2)<0;)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);a.compareTo(this.m)>=0;)a.subTo(this.m,a)}function Vb(a,b){a.squareTo(b),this.reduce(b)}function Wb(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function Xb(a,b){var c,e,f=a.bitLength(),g=m(1);if(0>=f)return g;c=18>f?1:48>f?3:144>f?4:768>f?5:6,e=8>f?new E(b):b.isEven()?new Rb(b):new L(b);var h=new Array,i=3,j=c-1,k=(1<<c)-1;if(h[1]=e.convert(this),c>1){var l=d();for(e.sqrTo(h[1],l);k>=i;)h[i]=d(),e.mulTo(l,h[i-2],h[i]),i+=2}var n,o,p=a.t-1,q=!0,r=d();for(f=t(a[p])-1;p>=0;){for(f>=j?n=a[p]>>f-j&k:(n=(a[p]&(1<<f+1)-1)<<j-f,p>0&&(n|=a[p-1]>>this.DB+f-j)),i=c;0==(1&n);)n>>=1,--i;if((f-=i)<0&&(f+=this.DB,--p),q)h[n].copyTo(g),q=!1;else{for(;i>1;)e.sqrTo(g,r),e.sqrTo(r,g),i-=2;i>0?e.sqrTo(g,r):(o=g,g=r,r=o),e.mulTo(r,h[n],g)}for(;p>=0&&0==(a[p]&1<<f);)e.sqrTo(g,r),o=g,g=r,r=o,--f<0&&(f=this.DB-1,--p)}return e.revert(g)}function Yb(a){var b=this.s<0?this.negate():this.clone(),c=a.s<0?a.negate():a.clone();if(b.compareTo(c)<0){var d=b;b=c,c=d}var e=b.getLowestSetBit(),f=c.getLowestSetBit();if(0>f)return b;for(f>e&&(f=e),f>0&&(b.rShiftTo(f,b),c.rShiftTo(f,c));b.signum()>0;)(e=b.getLowestSetBit())>0&&b.rShiftTo(e,b),(e=c.getLowestSetBit())>0&&c.rShiftTo(e,c),b.compareTo(c)>=0?(b.subTo(c,b),b.rShiftTo(1,b)):(c.subTo(b,c),c.rShiftTo(1,c));return f>0&&c.lShiftTo(f,c),c}function Zb(a){if(0>=a)return 0;var b=this.DV%a,c=this.s<0?a-1:0;if(this.t>0)if(0==b)c=this[0]%a;else for(var d=this.t-1;d>=0;--d)c=(b*c+this[d])%a;return c}function $b(a){var b=a.isEven();if(this.isEven()&&b||0==a.signum())return c.ZERO;for(var d=a.clone(),e=this.clone(),f=m(1),g=m(0),h=m(0),i=m(1);0!=d.signum();){for(;d.isEven();)d.rShiftTo(1,d),b?(f.isEven()&&g.isEven()||(f.addTo(this,f),g.subTo(a,g)),f.rShiftTo(1,f)):g.isEven()||g.subTo(a,g),g.rShiftTo(1,g);for(;e.isEven();)e.rShiftTo(1,e),b?(h.isEven()&&i.isEven()||(h.addTo(this,h),i.subTo(a,i)),h.rShiftTo(1,h)):i.isEven()||i.subTo(a,i),i.rShiftTo(1,i);d.compareTo(e)>=0?(d.subTo(e,d),b&&f.subTo(h,f),g.subTo(i,g)):(e.subTo(d,e),b&&h.subTo(f,h),i.subTo(g,i))}return 0!=e.compareTo(c.ONE)?c.ZERO:i.compareTo(a)>=0?i.subtract(a):i.signum()<0?(i.addTo(a,i),i.signum()<0?i.add(a):i):i}function _b(a){var b,c=this.abs();if(1==c.t&&c[0]<=fd[fd.length-1]){for(b=0;b<fd.length;++b)if(c[0]==fd[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<fd.length;){for(var d=fd[b],e=b+1;e<fd.length&&gd>d;)d*=fd[e++];for(d=c.modInt(d);e>b;)if(d%fd[b++]==0)return!1}return c.millerRabin(a)}function ac(a){var b=this.subtract(c.ONE),e=b.getLowestSetBit();if(0>=e)return!1;var f=b.shiftRight(e);a=a+1>>1,a>fd.length&&(a=fd.length);for(var g=d(),h=0;a>h;++h){g.fromInt(fd[Math.floor(Math.random()*fd.length)]);var i=g.modPow(f,this);if(0!=i.compareTo(c.ONE)&&0!=i.compareTo(b)){for(var j=1;j++<e&&0!=i.compareTo(b);)if(i=i.modPowInt(2,this),0==i.compareTo(c.ONE))return!1;if(0!=i.compareTo(b))return!1}}return!0}function bc(){this.i=0,this.j=0,this.S=new Array}function cc(a){var b,c,d;for(b=0;256>b;++b)this.S[b]=b;for(c=0,b=0;256>b;++b)c=c+this.S[b]+a[b%a.length]&255,d=this.S[b],this.S[b]=this.S[c],this.S[c]=d;this.i=0,this.j=0}function dc(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}function ec(){return new bc}function fc(a){id[jd++]^=255&a,id[jd++]^=a>>8&255,id[jd++]^=a>>16&255,id[jd++]^=a>>24&255,jd>=kd&&(jd-=kd)}function gc(){fc((new Date).getTime())}function hc(){if(null==hd){for(gc(),hd=ec(),hd.init(id),jd=0;jd<id.length;++jd)id[jd]=0;jd=0}return hd.next()}function ic(a){var b;for(b=0;b<a.length;++b)a[b]=hc()}function jc(){}function kc(a,b){return new c(a,b)}function lc(a,b){if(b<a.length+11)return null;for(var d=new Array,e=a.length-1;e>=0&&b>0;){var f=a.charCodeAt(e--);128>f?d[--b]=f:f>127&&2048>f?(d[--b]=63&f|128,d[--b]=f>>6|192):(d[--b]=63&f|128,d[--b]=f>>6&63|128,d[--b]=f>>12|224)}d[--b]=0;for(var g=new jc,h=new Array;b>2;){for(h[0]=0;0==h[0];)g.nextBytes(h);d[--b]=h[0]}return d[--b]=2,d[--b]=0,new c(d)}function mc(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function nc(a,b){this.n=kc(a,16),this.e=parseInt(b,16)}function oc(a){return a.modPowInt(this.e,this.n)}function pc(a){var b=lc(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPrivate(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d}function qc(a,b){for(var c=a.toByteArray(),d=0;d<c.length&&0==c[d];)++d;if(c.length-d!=b-1||2!=c[d])return null;for(++d;0!=c[d];)if(++d>=c.length)return null;for(var e="";++d<c.length;){var f=255&c[d];128>f?e+=String.fromCharCode(f):f>191&&224>f?(e+=String.fromCharCode((31&f)<<6|63&c[d+1]),++d):(e+=String.fromCharCode((15&f)<<12|(63&c[d+1])<<6|63&c[d+2]),d+=2)}return e}function rc(a,b,c){this.n=kc(a,16),this.e=parseInt(b,16),this.d=kc(c,16)}function sc(a,b,c,d,e,f,g,h){this.n=kc(a,16),this.e=parseInt(b,16),this.d=kc(c,16),this.p=kc(d,16),this.q=kc(e,16),this.dmp1=kc(f,16),this.dmq1=kc(g,16),this.coeff=kc(h,16)}function tc(a){if(null==this.p||null==this.q)return a.modPow(this.d,this.n);for(var b=a.mod(this.p).modPow(this.dmp1,this.p),c=a.mod(this.q).modPow(this.dmq1,this.q);b.compareTo(c)<0;)b=b.add(this.p);return b.subtract(c).multiply(this.coeff).mod(this.p).multiply(this.q).add(c)}function uc(a){var b=kc(a,16),c=this.doPublic(b);return null==c?null:qc(c,this.n.bitLength()+7>>3)}function vc(a,b,c){var d=0,e=0,f=b.split("\n"),g=2*a.measureText("e").width;return f.forEach(function(b){if(c){var f,h,i,j,k,l=b.split(" "),m=l.length,n="";for(i=0;m>i;i++)if(f=l[i]+(i===m-1?"":" "),h=n+f,j=a.measureText(h).width,c>j)n=h;else if(j==c)n="",e+=g;else{for(k=0;k<f.length;k++)if(h=n+f.substr(0,k+1),a.measureText(h).width>c){n=f.substring(k,f.length),e+=g;break}for(;n.length>0&&a.measureText(n).width>c;)for(k=0;k<n.length;k++)if(h=n.substr(0,k+1),a.measureText(h).width>c){n=n.substring(k,n.length),e+=g;break}}}else j=a.measureText(b).width,d=j>d?j:d;e+=g}),d=c?c:d,{w:d,h:e}}function wc(a,b,c,d){var e,f=a.animate,g=d._now,h=d._shapeDataIndex,i=c._animates;if(i||(i=c._animates={}),h.length)for(var j=0;j<h.length;j++){e=h[j];var k=i[e];k||(k=i[e]={}),i=k}else e=h;var l=i[e];l||(l=i[e]={},f.forEach(function(e){var f,h=e.attr,i=l[h];e={attr:h,to:e.to,type:e.type||"number",delay:e.delay||0,dur:e.dur||1e3,interval:e.interval||0,finish:e.finish,repeat:e.repeat||1,reverse:null==e.reverse?!0:e.reverse,onDone:e.onDone,easing:e.easing,trigger:null==e.to,start:g,time:0,total:0,count:0,started:!1,stopped:!1,current:null},Array.isArray(e.dur)&&(e.groupDur=e.dur.slice(0,e.dur.length-1),e.dur=e.dur[e.dur.length-1],e.groupDurTotal=e.groupDur.reduce(function(a,b,c){return e.groupDur[c]=a+b},0),e.groupIndex=0,e.groupTime=0,e.groupStart=g),null==e.finish&&(e.finish=e.delay+e.dur+e.interval),i?Array.isArray(i)?(i.push(e),i=i[i.length-2]):l[h]=[i,e]:(f=Yd(c,b,a,h,d),l[h]=e),i&&(f=i.to,"group_set"===i.type&&(f=f[f.length-1])),e.from=f,e.trigger||(e.started=!0,xc(e),yc(e))})),f=l,Object.keys(f).forEach(function(e){var h=f[e];if(Array.isArray(h)){var i=h[h.length-1];i.count+1===i.repeat?h.forEach(function(e){zc(e,a,b,c,d,!0)}):i.count+1<i.repeat&&(i.total>=i.finish&&h.forEach(function(a){a.trigger||(a.started=!0),a.stopped=!1,a.time=0,a.start=g,a.total=0,"group_set"===a.type&&(a.groupIndex=0,a.groupTime=0,a.groupStart=g)}),h.forEach(function(e){zc(e,a,b,c,d,!1)}))}else zc(h,a,b,c,d,!0)})}function xc(a){var b=a.type,c=a.from,d=a.to;"number"===b?(a.from=c||0,a.to=d||0):"point"===b?(c?c.length&&(a.from={x:c[0],y:c[1]}):a.from="scale"===a.attr?{x:1,y:1}:{x:0,y:0},d?d.length&&(a.to={x:d[0],y:d[1]}):a.to="scale"===a.attr?{x:1,y:1}:{x:0,y:0}):"rect"===b?(c?c.length&&(a.from={x:c[0],y:c[1],w:c[2],h:c[3]}):a.from={x:0,y:0,w:0,h:0},d?d.length&&(a.to={x:d[0],y:d[1],w:d[2],h:d[3]}):a.to={x:0,y:0,w:0,h:0}):"color"===b&&(a.from=re(c),a.to=re(d)),a.current=a.from}function yc(a){var b=a.type,c=a.from,d=a.to;"number"===b?a.delta=d-c:"point"===b?a.delta={x:d.x-c.x,y:d.y-c.y}:"rect"===b?a.delta={x:d.x-c.x,y:d.y-c.y,w:d.w-c.w,h:d.h-c.h}:"color"===b&&(a.delta={r:d.r-c.r,g:d.g-c.g,b:d.b-c.b,a:d.a-c.a})}function zc(a,b,c,d,e,f){if(a.trigger){var g=Yd(d,c,b,a.attr,e,null,!1);if(!a.started){if(g===a.from)return;a.started=!0,a.start=e._now,a.to=g,xc(a),yc(a)}a.started&&g!==a.to&&(a.start=e._now,a.from=a.current,a.to=g,a.time=0,a.total=0,a.count=0,xc(a),yc(a))}if(a.started&&!a.stopped){var h=e._now,i=h-a.start;if(i>=a.delay&&(a.total=i,i-=a.delay,a.time=i>a.dur?a.dur:i,"group_set"===a.type&&(a.groupTime=h-a.groupStart,a.groupStart===a.start&&(a.groupTime-=a.delay),a.groupTime>=a.groupDur[a.groupIndex]&&a.groupIndex++,a.groupTime>=a.groupDurTotal&&(a.groupIndex=0,a.groupTime=a.groupTime-a.groupDurTotal,a.groupStart=h)),a.total>=a.finish))if(a.count++,"group_set"===a.type,a.count>=a.repeat)a.time=a.dur,a.stopped=!0,a.trigger&&(a.from=a.to,a.to=null,a.start=null,a.time=0,a.total=0,a.count=0,a.started=!1,a.stopped=!1),a.onDone&&a.onDone.call(c,d,e);else if(f&&(a.time=0,a.start=h,a.total=0,a.reverse)){var j=a.from;a.from=a.to,a.to=j,yc(a)}e&&!e._invalidate&&(e._invalidate=!0)}}function Ac(a,b){var c=a.type,d=a.delta,e=a.from,f=a.time,g=a.dur,h=ke[a.easing||"easeNone"];return h||(h=ke.easeNone),"number"===c?b=h(f,e,d,g):"point"===c?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g)}:"rect"===c?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g),w:h(f,e.w,d.w,g),h:h(f,e.h,d.h,g)}:"color"===c?b="rgba("+Math.floor(h(f,e.r,d.r,g))+","+Math.floor(h(f,e.g,d.g,g))+","+Math.floor(h(f,e.b,d.b,g))+","+Math.floor(h(f,e.a,d.a,g))+")":"set"===c?a.time&&(b=a.to):"group_set"===c&&(b=a.to[a.groupIndex]),a.current=b,b}function Bc(a){if(!he[a.id]){if(je=!0,he[a.id]=a,a.finish=null==a.finish?a.delay+a.dur+a.interval:a.finish,null==a.from&&a.attr&&a.source){var b;a.from=(b=a.attr.match(/^S[:@](.*)/i))?a.source.getStyle(b[1]):(b=a.attr.match(/^C[:@](.*)/i))?a.source.getClient(b[1]):Ic.Util.getValue(a.source,a.attr)}xc(a),yc(a)}return a}function Cc(a,b){return he[a.id]&&(null==b&&(b=!0),b&&Hc(a,a.to),a.onStop&&a.onStop(),a.time=0,a.total=0,a.start=null,a.count=0,a.started=!1,a.stopped=!1,a.paused=!1,a.pausedTime=null,a.pausedTotal=0,delete he[a.id]),a}function Dc(a){null==a&&(a=!0),Object.keys(he).forEach(function(b){var c=he[b];c&&(a&&Hc(c,c.to),c.onStop&&c.onStop())}),he={}}function Ec(){Object.keys(he).forEach(function(a){var b=he[a];b&&b.pause()})}function Fc(){Object.keys(he).forEach(function(a){var b=he[a];b&&b.resume()})}function Gc(a){Object.keys(he).forEach(function(b){var c=he[b];if(c){if(null==c.start&&(c.start=a),c.paused)return void(c.pausedTime||(c.pausedTime=a));if(c.pausedTime&&(c.pausedTotal+=a-c.pausedTime,c.pausedTime=null),c.total=a-c.start-c.pausedTotal,c.total>c.delay){c.time=c.total-c.delay;var d=!1;if(c.time>=c.dur&&(c.time=c.dur,d=!0),!c.stopped&&Hc(c,Ac(c)),c.stopped=d,c.total>=c.finish)if(c.count++,c.count>=c.repeat)Cc(c,!1),c.onDone&&c.onDone();else if(c.time=0,c.total=0,c.start=null,c.stopped=!1,c.reverse){var e=c.from;c.from=c.to,c.to=e,yc(c)}}!je&&(je=!0)}})}function Hc(a,b){if(a.started||(a.started=!0,a.onPlay&&a.onPlay()),a.filter&&(b=a.filter(b)),a.attr&&a.source){var c;(c=a.attr.match(/^S[:@](.*)/i))?a.source.setStyle(c[1],b):(c=a.attr.match(/^C[:@](.*)/i))?a.source.setClient(c[1],b):Ic.Util.setValue(a.source,a.attr,b)}a.onUpdate&&a.onUpdate(b)}var Ic={};Ic._isInitializing=!1;var Jc={isDeserializing:!1,isCalculatingBus:!1,images:{},registerImage:function(a,b,c,d,e){Jc.images[a]=new Ic.ImageAsset(a,b,c,d,e),xe(a)},getRegisteredImageNames:function(){return Object.keys(Jc.images)},unregisterImage:function(a){delete Jc.images[a]},getImageAsset:function(a){return Jc.images[a]},showVersion:function(a){Jc.isCtrlDown(a)&&a.shiftKey&&76==a.keyCode&&alert("TWaver HTML5 "+Ic.Util.getVersion()+"\n"+Kc)},callLater:function(a,b,c,d){return setTimeout(function(){a.apply(b,c)},d||Ce.CALL_LATER_DELAY)},isEmptyObject:function(a){for(var b in a)return!1;return!0},xml:function(b){if(a.DOMParser)return(new DOMParser).parseFromString(b,"text/xml");var c=new ActiveXObject("Microsoft.XmlDOM");return c.async=!1,c.loadXml(b),c},num:function(a){return"number"==typeof a&&!isNaN(a)&&isFinite(a)},getter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1),c=/ble$/.test(a)||/ed$/.test(a)?"is":"get";return c+b},setter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);return"set"+b},_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(){for(var a=[],b=0;32>b;b++)a[b]=this._id[Math.floor(16*Math.random())];return a[12]="4",a[16]=this._id[3&a[16]|8],a.join("")},keys:function(a){var b=new me;for(var c in a)b.add(c);return b},es:["toString","toLocaleString","valueOf"],ip:function(a,b){var c="_"+b;a[Jc.getter(b)]=function(){return this[c]},a[Jc.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},validateLicense:function(a){Kc=a,nd()},ibool:function(a,b){var c="_"+b,d=b.charAt(0).toUpperCase()+b.slice(1);a["is"+d]=function(){return this[c]},a[Jc.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},getValue:function(a,b,c){var d=b.charAt(0).toUpperCase()+b.slice(1),e="get"+d,f="is"+d;return c?"boolean"===c?a[f]():a[e]():a[e]?a[e]():a[f]?a[f]():a[b]},setValue:function(a,b,c){a["set"+b.charAt(0).toUpperCase()+b.slice(1)](c)},clone:function(a){if(!a)return null;var b={};for(var c in a)b[c]=a[c];return b},cloneRect:function(a){return a?{x:a.x,y:a.y,width:a.width,height:a.height}:null},classCache:{},getClass:function(b){var c=Jc.classCache[b];if(!c){var d=b.split("."),e=d.length;c=a;for(var f=0;e>f;f++)c=c[d[f]];Jc.classCache[b]=c}return c},newInstance:function(a){var b=Jc.getClass(a);if(!b)return null;var c=arguments.length,d=arguments;if(1===c)return new b;if(2===c)return new b(d[1]);if(3===c)return new b(d[1],d[2]);if(4===c)return new b(d[1],d[2],d[3]);if(5===c)return new b(d[1],d[2],d[3],d[4]);if(6===c)return new b(d[1],d[2],d[3],d[4],d[5]);if(7===c)return new b(d[1],d[2],d[3],d[4],d[5],d[6]);if(8===c)return new b(d[1],d[2],d[3],d[4],d[5],d[6],d[7]);throw"don't support args more than 7"},addMethod:function(a,b){var c=a.prototype;for(var d in b)c[d]=b[d]},ext:function(a,b,c){var d;if("string"==typeof a&&(d=a,a=Jc.getClass(a)),b){var e=function(){};e.prototype=b.prototype,a.prototype=new e,a.prototype.constructor=a,a.superClass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}if(d&&(a.prototype.getClassName=function(){return d}),c){var f=a.prototype;for(var g in c)Rc.ext(g,f,c);for(var h=Jc.es.length,i=0;h>i;i++)g=Jc.es[i],c.hasOwnProperty(g)&&!c.propertyIsEnumerable(g)&&(f[g]=c[g])}},setViewBounds:function(a,b){if(a)if(a.adjustBounds)a.adjustBounds(b);else{var c=a.style;!c&&a.getView()&&(c=a.getView().style),c&&(c.position="absolute",c.left=b.x+"px",c.top=b.y+"px",c.width=b.width+"px",c.height=b.height+"px")}},getImageSrc:function(a){var b=Jc.getImageAsset(a);return b?b.getSrc()?b.getSrc():b.getImage().getAttribute("src"):a},nextColorCount:0,nextColor:function(){return Jc.nextColorCount>=Ce.COLORS.length&&(Jc.nextColorCount=0),Ce.COLORS[Jc.nextColorCount++]},isCtrlDown:function(a){return a.ctrlKey||a.metaKey},isShiftDown:function(a){return a.shiftKey},isAltDown:function(a){return a.altKey},setText:function(a,b,c){c?Qc.isFirefox?a.textContent=b:a.innerText=b:a.innerHTML=b},fillDescendant:function(a,b){b.add(a),a.hasChildren()&&a.getChildren().forEach(function(a){Jc.fillDescendant(a,b)})}},Kc="l=1.0\ntype=1\ngis=1\n3d=0\nstart=2015-03-27\nend=2015-06-30\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=15b4c32a27a2e72e0265f4a61da054a7b00d2e5c04f075d26501322fdeca953d6dc6eebd5b5439c28e52108254b31aafef6a88c5b7d560da9e3de4f206b9f5a7072b8abe211853b4d753e568060ecea30602e936ab6fbe2c15ae5d0b34b59fb27dd969f1e089b65575ca983f4a4c497593035f338865b743b86b4ce1fc2f2c3a696f147d3841cbf17b510ba76a208e7752c5e0e70e73db8d9dfedc7c112b2d721789eaf8d5f623bd0426845e2e832cf588e489fdd84e8c6e38c1ae11c71dfe88fe85303219ffe584a7305b19f78386a301447415122883380ecc091a31145f4d2a39e060b97a1ec7b6c0b7240aadaf110bc675696d4a19fe7cb5e8e7ead3a28f56542452e610d985eac73bb8a10a527cb3ae221e458fcfb7448a415e2c2d65e383ff683a9f24553c86e0d2095704cc5fed41808c1e2b04ac7e155f973df8ca024fc580f17d253f340be64126ff7d4b3c1988e4e824d6968f929a3ab599a3abf88d6d1f3694562fd8957e9ef3612eb8d4bdd9ced18edec1d45c2849eef8b989fd14fcdc97608e561b11310977cbdae529f5b1c509b6f5f8dfdd11989ac36f60d0017bf845e3ca6e6c7ad8fe6d433645af1365757892e53f288fae1eafce732a925a3cd756c0d8406cb595e65bef43f6db994553644de2cd8d2fb19ee301b44c9ba68ac59e19bbaeaa341fa92fdb072e08baf387f73b0ce1ed0fac291d54f6f7912f055287115e22d2e4fee7ef181641412f2bee2900f1a82c705d1593ca81505353d50310b2f60245cfb33c864bcba76e207c32f4c55a4e85d5084f48dc895c2c5410ac28fe10f6404bc902333208e98c25734edd845e96ff30af04810e3c7a70518dbf8536fb18abb5d5a9f3fc159dc7ed914ff1cc0b75c915f084ce37b9ce4f";a.twaver=Ic,a._twaver=Jc,Ic.animate={},Ic.network={},Ic.network.interaction={},Ic.controls={},Ic.charts={},Ic.layout={};var Lc,Mc,Nc=a.navigator,Oc=a.document,Pc=a.Image;a.document||(Mc=!0,Lc=require("canvas"),Pc=Lc.Image,Nc={userAgent:""},Oc={});var Qc=function(){var a={},b=Nc.userAgent.toLowerCase();return a.isOpera=/opera/.test(b),a.isIE=/msie/.test(b)||/trident/.test(b),a.isFirefox=/firefox/i.test(b),a.isChrome=/chrome/i.test(b),a.isSafari=!a.isChrome&&/safari/i.test(b),a.isIPhone=/iphone/.test(b),a.isIPod=/ipod/.test(b),a.isIPad=/ipad/.test(b),a.isAndroid=/android/i.test(b),a.isWebOS=/webos/i.test(b),a.isMSToucheable=Nc.msMaxTouchPoints&&Nc.msMaxTouchPoints>1,a.isTouchable="ontouchend"in Oc||a.isMSToucheable,a}();Jc.ua=Qc;var Rc={__accessor:function(a,b){for(var c=b.__accessor,d=c.length,e=0;d>e;e++)Jc.ip(a,c[e])},__bool:function(a,b){for(var c=b.__bool,d=c.length,e=0;d>e;e++)Jc.ibool(a,c[e])},__client:function(a){a.getClient=function(a){return this._clientMap[a]},a.setClient=function(a,b){var c=this._clientMap[a];return null==b?delete this._clientMap[a]:this._clientMap[a]=b,this.firePropertyChange("C:"+a,c,b)&&this.onClientChanged(a,c,b),this},a.getClientProperties=function(){return Jc.keys(this._clientMap)},a.onClientChanged=function(){}},__style:function(a){a.getStyle=function(a,c){var d=this._styleMap[a];return c===b&&(c=!0),null==d&&c?Ic.Styles.getStyle(a):d},a.setStyle=function(a,b){var c=this._styleMap[a];return null==b?delete this._styleMap[a]:this._styleMap[a]=b,this.firePropertyChange("S:"+a,c,b)&&this.onStyleChanged(a,c,b),this},a.getStyleProperties=function(){return Jc.keys(this._styleMap)},a.onStyleChanged=function(){}},__new:function(a){a.newInstance=function(){var a=Jc.getClass(this.getClassName());if(!a)return null;var b=arguments.length,c=arguments;if(0===b)return new a;if(1===b)return new a(c[0]);if(2===b)return new a(c[0],c[1]);if(3===b)return new a(c[0],c[1],c[2]);if(4===b)return new a(c[0],c[1],c[2],c[3]);if(5===b)return new a(c[0],c[1],c[2],c[3],c[4]);if(6===b)return new a(c[0],c[1],c[2],c[3],c[4],c[5]);if(7===b)return new a(c[0],c[1],c[2],c[3],c[4],c[5],c[6]);throw"don't support args more than 7"}},__property:function(a){a.getValue=function(a){return"accessor"===this._propertyType?Jc.getValue(a,this._propertyName):"style"===this._propertyType&&a.getStyle?a.getStyle(this._propertyName):"client"===this._propertyType&&a.getClient?a.getClient(this._propertyName):"field"===this._propertyType?a[this._propertyName]:null},a.setValue=function(a,b){if("accessor"===this._propertyType)a[Jc.setter(this._propertyName)](b);else{if("style"===this._propertyType&&a.setStyle)return a.setStyle(this._propertyName,b);if("client"===this._propertyType&&a.setClient)return a.setClient(this._propertyName,b);"field"===this._propertyType&&(a[this._propertyName]=b)
}}},map:{__accessor:1,__bool:1,__client:1,__style:1,__new:1,__tree:1,__property:1},ext:function(a,b,c){1===Rc.map[a]?Rc[a](b,c):b[a]=c[a]}};Jc.extend=Rc;var Sc=function(a,b,c,d,e,f){this._m11=a,this._m12=b,this._m21=c,this._m22=d,this._offsetX=e,this._offsetY=f,this._type=0,0!=this._m21||0!=this._m12?this._type=4:((1!=this._m11||1!=this._m22)&&(this._type=2),(0!=this._offsetX||0!=this._offsetY)&&(this._type|=1),0==(3&this._type)&&(this._type=0))};Sc.prototype.transform=function(){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!a||!Jc.num(a.x)||!Jc.num(a.y))throw"arguments should contain x, y";switch(this._type){case 0:return{x:a.x,y:a.y};case 1:return{x:this._offsetX+a.x,y:this._offsetY+a.y};case 2:return{x:a.x*this._m11,y:a.y*this._m22};case 3:return{x:a.x*this._m11+this._offsetX,y:a.y*this._m22+this._offsetY}}return{x:this._m11*a.x+a.y*this._m21+this._offsetX,y:this._m22*a.y+a.x*this._m12+this._offsetY}};var Tc={getDistance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},getCenterPoint:function(a,b){return a&&b?{x:(a.x+b.x)/2,y:(a.y+b.y)/2}:null==b&&a.width?{x:a.x+a.width/2,y:a.y+a.height/2}:void 0},isPointInPolygon:function(a,b){a=a._as;var c=0,d=0,e=!1,f=a.length;for(c=0,d=f-1;f>c;d=c++){var g=a[c],h=a[d];g.y>b.y!=h.y>b.y&&b.x<(h.x-g.x)*(b.y-g.y)/(h.y-g.y)+g.x&&(e=!e)}return e},unionRect:function(a,b){if(a&&!b)return Jc.cloneRect(a);if(!a&&b)return Jc.cloneRect(b);if(a&&b){var c={};return c.x=Math.min(a.x,b.x),c.y=Math.min(a.y,b.y),c.width=Math.max(a.x+a.width,b.x+b.width)-c.x,c.height=Math.max(a.y+a.height,b.y+b.height)-c.y,c}return null},intersects:function(a,b){if(!a||!b)return!1;var c=b.width,d=b.height,e=a.width,f=a.height;if(0>=e||0>=f||0>=c||0>=d)return!1;var g=b.x,h=b.y,i=a.x,j=a.y;return e+=i,f+=j,c+=g,d+=h,(i>e||e>g)&&(j>f||f>h)&&(g>c||c>i)&&(h>d||d>j)},intersection:function(a,b){if(!a||!b)return!1;var c=b.x,d=b.y,e=a.x,f=a.y,g=c;g+=b.width;var h=d;h+=b.height;var i=e;i+=a.width;var j=f;return j+=a.height,e>c&&(c=e),f>d&&(d=f),g>i&&(g=i),h>j&&(h=j),g-=c,h-=d,0===g||0===h?null:{x:c,y:d,width:g,height:h}},contains:function(a,b){var c=b.x,d=b.y,e=b.width,f=b.height,g=a.width,h=a.height;if(0>(g|h|e|f))return!1;var i=a.x,j=a.y;if(i>c||j>d)return!1;if(g+=i,e+=c,c>=e){if(g>=i||e>g)return!1}else if(g>=i&&e>g)return!1;if(h+=j,f+=d,d>=f){if(h>=j||f>h)return!1}else if(h>=j&&f>h)return!1;return!0},getLinePoints:function(a){if(!a)return null;var b=new me;return a.forEach(function(a){b.addAll(a)}),b},getLineRect:function(a){var b=Tc.getLinePoints(a);return Tc.getRect(b)},getRect:function(a,b){if(!a)return null;a._as&&(a=a._as);var c=a.length;if(0>=c)return null;var d=a[0];b=b||{x:null,y:null,width:0,height:0};for(var e=0;c>e;e++)if(d=a[e],d instanceof me)Tc.getRect(d,b);else{null==b.x&&(b.x=d.x,b.y=d.y);var f=Math.min(b.x,d.x),g=Math.min(b.y,d.y),h=Math.max(b.x+b.width,d.x),i=Math.max(b.y+b.height,d.y);b.x=f,b.y=g,b.width=h-f,b.height=i-g}return b},addPadding:function(a,b,c,d){d=d||-1;var e=b.getStyle(c)*d;0!=e&&Tc.grow(a,e,e),e=b.getStyle(c+".left")*d,0!=e&&(a.x-=e,a.width+=e),e=b.getStyle(c+".right")*d,0!=e&&(a.width+=e),e=b.getStyle(c+".top")*d,0!=e&&(a.y-=e,a.height+=e),e=b.getStyle(c+".bottom")*d,0!=e&&(a.height+=e),a.width<0&&(a.width=-a.width,a.x-=a.width),a.height<0&&(a.height=-a.height,a.y-=a.height)},grow:function(a,b,c){if(null==a)return null;null==c&&(c=b);var d=a.width+b+b;if(!(0>d)){var e=a.height+c+c;if(!(0>e))return a.x-=b,a.y-=c,a.width=d,a.height=e,a}},containsPoint:function(a,b,c){return arguments.length<3&&(c=b.y,b=b.x),!a||b<a.x||c<a.y||b>a.x+a.width||c>a.y+a.height?!1:!0},getHotSpot:function(a,b,c,d,e){if("oval"===e){var f=.35;return{x:a+.5*c+c*f,y:b+d/2-Math.sqrt(.25-f*f)*d}}if("circle"===e){var g=a+c/2,h=b+d/2,i=Math.min(c,d)/2;a=g-i,b=h-i,c=2*i,d=2*i;var j=c/2,k=d/2,l=j*k/Math.sqrt(j*j+k*k);return{x:a+c/2+l,y:b+d/2-l}}var m={x:a+c,y:b};return c>3&&(m.x-=3),d>3&&(m.y+=3),m},getCircleRect:function(a){var b=Math.min(a.width,a.height)/2;return{x:a.x+a.width/2-b,y:a.y+a.height/2-b,width:2*b,height:2*b}},getEllipsePoint:function(a,b){if(!a||!b)return null;var c=a.x+a.width/2,d=a.y+a.height/2,e=b.x-c,f=b.y-d,g=a.width/2,h=a.height/2,i=Math.sqrt(1/(1/g/g+f*f/e/e/h/h));0>e&&(i=-i);var j;return j=0==e?f>0?h:-h:i*f/e,{x:c+i,y:d+j}},createMatrix:function(a,b,c){var d=Math.sin(a),e=Math.cos(a),f=b*(1-e)+c*d,g=c*(1-e)-b*d;return new Sc(e,d,-d,e,f,g)},calculatePointInfoAlongLineBySegments:function(a,b,c,d,e){return Tc.calculatePointInfoAlongLine(Tc.getPointObject(a,b),c,d,e)},calculatePointInfoAlongLine:function(a,c,d,e){if(c=c===b?!0:c,d=d||0,e=e||0,!a||a.size()<2)throw"must more than two points";if(!c){var f=Tc.reversePath(a);return Tc.calculatePointInfoAlongLine(f,!0,d,e)}a._as&&(a=a._as);var g,h,i,j,k,l=0,m=0,n=a.length;for(j=0;n>j;j++)if(k=a[j],0!=j){if(0>=d){i=Tc.calculatePointInfoOnStraightLine(Tc._getPoint(h),Tc._getControlPoint(k),d,e),g=i;break}if(m=Tc._getLength(k,h),l+m>d){i=Tc.getPathInfo(k,h,d-l,e,m),g=i;break}l+=m,h=k}else h=k;if(null==g){var o,p;h=a[n-1],p=Tc._getPoint(h),h instanceof me&&(h=h._as),o=h instanceof Array?Tc._getControlPoint(h):Tc._getPoint(a[n-2]);var q=Math.atan2(p.y-o.y,p.x-o.x);i=Tc.transformPoint(p,q,d-l,e),i.angle=q,g=i}return g},reversePath:function(a){var b,c=new me,d=null;a._as&&(a=a._as);for(var e=a.length-1;e>=0;e--)b=a[e],c.add(Tc._getReversePath(b,d)),d=b;return c},_getPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-1]:a},_getControlPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-2]:a},_getReversePath:function(a,b){var c=Tc._getPoint(a);return b&&b._as&&(b=b._as),null!=b&&b instanceof Array?new me(2==b.length?[b[0],c]:[b[1],b[0],c]):c},_getLength:function(a,b){var c=Tc._getPoint(b),d=Tc._getPoint(a);if(a instanceof me&&(a=a._as),a instanceof Array)return Tc.calculateCurveLength(c,a,1);var e=d.y-c.y,f=d.x-c.x;return Math.sqrt(f*f+e*e)},getPathInfo:function(a,b,c,d,e){var f,g=Tc._getPoint(b),h=Tc._getPoint(a);if(a instanceof me&&(a=a._as),a instanceof Array){0>e&&(e=Tc._getLength(a,b));var i=c/e,j=Tc.calculatePointInfoOnCurveLine(g,a,i);g=j.point,f=j.angle,c=0}else f=Math.atan2(h.y-g.y,h.x-g.x);return Tc.transformPoint(g,f,c,d)},transformPoint:function(a,b,c,d){var e={x:c,y:d},f=Tc.createMatrix(b,0,0);return e=f.transform(e),e.x+=a.x,e.y+=a.y,{point:e,angle:b}},calculatePointInfoOnStraightLine:function(a,b,c,d){var e=Math.atan2(b.y-a.y,b.x-a.x);return Tc.transformPoint(a,e,c,d)},calculatePointInfoOnCurveLine:function(a,b,c){if(0>c||c>1)throw"Illegal arguments";return b._as&&(b=b._as),2==b.length?Tc._calculatePointInfoOnCurveLine2(a,b[0],b[1],c):Tc._calculatePointInfoOnCurveLine3(a,b[0],b[1],b[2],c)},_calculatePointInfoOnCurveLine2:function(a,b,c,d){var e=2*(a.x+c.x-2*b.x)*d+2*b.x-2*a.x,f=2*(a.y+c.y-2*b.y)*d+2*b.y-2*a.y,g=Math.atan2(f,e),h=(a.x+c.x-2*b.x)*d*d+(2*b.x-2*a.x)*d+a.x,i=(a.y+c.y-2*b.y)*d*d+(2*b.y-2*a.y)*d+a.y;return{point:{x:h,y:i},angle:g}},_calculatePointInfoOnCurveLine3:function(a,b,c,d,e){var f,g,h;f=1-e,g=f*f*f,h=e*e*e;var i=g*a.x+3*e*f*f*b.x+3*e*e*f*c.x+h*d.x,j=g*a.y+3*e*f*f*b.y+3*e*e*f*c.y+h*d.y;return{point:{x:i,y:j},angle:Math.atan2(Tc._bezeSpeedY(a,b,c,d,e),Tc._bezeSpeedX(a,b,c,d,e))}},calculateCurveLength:function(a,b,c){return b._as&&(b=b._as),2==b.length?Tc._calculateCurveLength(a,b[0],b[1],c):Tc._calculateBezierCurveLength(a,b[0],b[1],b[2],c)},_calculateCurveLength:function(a,b,c,d){if(0>=d||d>1)return 0;var e=Math.floor(d*(Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))+Math.sqrt((c.x-b.x)*(c.x-b.x)+(c.y-b.y)*(c.y-b.y)))/2),f=0;0>=e&&(e=1);for(var g,h,i=d/e,j=0,k=0;e>k;k++)j=i*k,g=2*(a.x+c.x-2*b.x)*j+2*b.x-2*a.x,h=2*(a.y+c.y-2*b.y)*j+2*b.y-2*a.y,g*=i,h*=i,f+=Math.sqrt(g*g+h*h);return f},_calculateBezierCurveLength:function(a,b,c,d,e){if(0>=e||e>1)return 0;var f=1e4,g=Math.floor(f*e);if(1==(1&g)&&g++,0==g)return 0;var h,i=Math.floor(g/2),j=0,k=0,l=e/g;for(h=0;i>h;h++)j+=Tc._bezeSpeed(a,b,c,d,(2*h+1)*l);for(h=1;i>h;h++)k+=Tc._bezeSpeed(a,b,c,d,2*h*l);return(Tc._bezeSpeed(a,b,c,d,0)+Tc._bezeSpeed(a,b,c,d,1)+2*k+4*j)*l/3},_bezeSpeedX:function(a,b,c,d,e){var f=1-e;return-3*a.x*f*f+3*b.x*f*f-6*b.x*f*e+6*c.x*f*e-3*c.x*e*e+3*d.x*e*e},_bezeSpeedY:function(a,b,c,d,e){var f=1-e;return-3*a.y*f*f+3*b.y*f*f-6*b.y*f*e+6*c.y*f*e-3*c.y*e*e+3*d.y*e*e},_bezeSpeed:function(a,b,c,d,e){var f=Tc._bezeSpeedX(a,b,c,d,e),g=Tc._bezeSpeedY(a,b,c,d,e);return Math.sqrt(f*f+g*g)},getPointObject:function(a,b){if(b&&0!=b.size()){var c=new me;b=b._as,a=a._as;var d,e,f=0,g=b.length,h=a.length;for(d=0;g>d&&(e=b[d],f!=h);d++)"cubicto"===e?h-2>f&&c.add([a[f++],a[f++],a[f++]]):"quadto"===e?h-1>f&&c.add([a[f++],a[f++]]):h>f&&c.add(a[f++]);for(;h>f;f++)c.add(a[f]);return c}return a},calculateLineLength:function(a,b){if(!a||a.size()<2)return 0;if(b)return Tc.calculateLineLength(Tc.getPointObject(a,b));a=a._as;var c,d,e,f,g,h,i,j=a.length,k=0;for(c=0;j>c;c++)f=a[c],0!=c?(e=f,e instanceof me&&(e=e._as),e instanceof Array?(g=Tc.calculateCurveLength(d,e,1),d=e[e.length-1]):(i=f.y-d.y,h=f.x-d.x,g=Math.sqrt(h*h+i*i),d=e),k+=g):d=f;return k},toDegrees:function(a){return 180*a/Math.PI},toRadians:function(a){return a/180*Math.PI},getRadiansBetweenLines:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},getAngle:function(a,b){return a.x===b.x?b.y===a.y?0:b.y>a.y?Math.PI/2:-Math.PI/2:Math.atan((b.y-a.y)/(b.x-a.x))}};Jc.math=Tc;var Uc={getPoints:function(a){var b=new me;return a.forEach(function(a){b.add({x:a.x,y:a.y}),b.add({x:a.x+a.width,y:a.y+a.height}),b.add({x:a.x+a.width,y:a.y}),b.add({x:a.x,y:a.y+a.height})}),b},rectangle:function(a){var b;return a.forEach(function(a){b=Tc.unionRect(b,a)}),b},oval:function(a){var b=Uc.rectangle(a),c=0,d=b.height/b.width,e=d*d,f=b.x+b.width/2,g=b.y+b.height/2,h=Uc.getPoints(a);h.forEach(function(a){var b=a.x-f,d=a.y-g,h=b*b+d*d/e;h>c&&(c=h)}),c=Math.sqrt(c);var i=d*c;return{x:f-c,y:g-i,width:2*c,height:2*i}},circle:function(a){var b=Uc.rectangle(a),c=0,d=b.x+b.width/2,e=b.y+b.height/2,f=Uc.getPoints(a);return f.forEach(function(a){var b=a.x-d,f=a.y-e,g=b*b+f*f;g>c&&(c=g)}),c=Math.sqrt(c),{x:d-c,y:e-c,width:2*c,height:2*c}},roundrect:function(a){var b=Uc.rectangle(a),c=Math.min(b.width,b.height)/16;return Tc.grow(b,c,c),b},star:function(a){var b=Uc.rectangle(a);return Tc.grow(b,b.width,b.height),b},triangle:function(a){var b=Uc.rectangle(a);return b.x-=b.width/2,b.width*=2,b.y-=b.height,b.height*=2,b},hexagon:function(a){var b=Uc.rectangle(a);return b.x-=b.width/2,b.width*=2,b},pentagon:function(a){var b=Uc.rectangle(a);return b.x-=b.width/6,b.width+=b.width/3,b.y-=b.height/4,b.height+=b.height/4,b},diamond:function(a){var b=Uc.rectangle(a);return b.x-=b.width/2,b.width+=b.width,b.y-=b.height/2,b.height+=b.height,b}};Jc.group=Uc;var Vc={"topleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y-b.height}},"topleft.topright":function(a,b){return{x:a.x,y:a.y-b.height}},"top.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y-b.height}},"topright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y-b.height}},"topright.topright":function(a,b){return{x:a.x+a.width,y:a.y-b.height}},topleft:function(a,b){return{x:a.x-b.width/2,y:a.y-b.height/2}},top:function(a,b){return{x:a.x-b.width/2+a.width/2,y:a.y-b.height/2}},topright:function(a,b){return{x:a.x-b.width/2+a.width,y:a.y-b.height/2}},"topleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y}},"topleft.bottomright":function(a){return{x:a.x,y:a.y}},"top.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y}},"topright.bottomleft":function(a,b){return{x:a.x-b.width+a.width,y:a.y}},"topright.bottomright":function(a){return{x:a.x+a.width,y:a.y}},"left.left":function(a,b){return{x:a.x-b.width,y:a.y+a.height/2-b.height/2}},left:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height/2-b.height/2}},"left.right":function(a,b){return{x:a.x,y:a.y+a.height/2-b.height/2}},center:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height/2-b.height/2}},"right.left":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height/2-b.height/2}},right:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height/2-b.height/2}},"right.right":function(a,b){return{x:a.x+a.width,y:a.y+a.height/2-b.height/2}},"bottomleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height-b.height}},"bottomleft.topright":function(a,b){return{x:a.x,y:a.y+a.height-b.height}},"bottom.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height}},"bottomright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height-b.height}},"bottomright.topright":function(a,b){return{x:a.x+a.width,y:a.y+a.height-b.height}},bottomleft:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height-b.height/2}},bottom:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height/2}},bottomright:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height-b.height/2}},"bottomleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height}},"bottomleft.bottomright":function(a){return{x:a.x,y:a.y+a.height}},"bottom.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height}},"bottomright.bottomleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height}},"bottomright.bottomright":function(a){return{x:a.x+a.width,y:a.y+a.height}},get:function(a,b,c){if(!b)throw"refRect can not be null";c||(c={width:0,height:0});var d=Vc[a];if(d)return d(b,c);throw"Can not resolve '"+a+"' position"}};Jc.position=Vc;var Wc={preventDefault:function(a){Ce.KEEP_DEFAULT_FUNCTION(a)||(a.preventDefault?a.preventDefault():a.preventManipulation?a.preventManipulation():a.returnValue=!1)},insertAfter:function(a,b){return b?b.parentNode.insertBefore(a,b.nextSibling):a.parentNode.insertBefore(a,a.parentNode.firstChild),a},forEach:function(a,b,c){if(Wc.isVisible(a)){for(var d=a.childNodes.length,e=0;d>e;e++)Wc.forEach(a.childNodes[e],b,c);c?b.call(c,a):b(a)}},setVisible:function(a,b){a.style.display=b?"block":"none"},isVisible:function(a){return"style"in a&&"none"!==a.style.display},release:function(a){for(var b=a.childNodes.length,c=0;b>c;c++)Wc.release(a.childNodes[c]);b>0&&Wc.clear(a),a._pool&&a._pool.release(a)},clear:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},setZoom:function(a,b){var c=a.style;if(c.setProperty)if(Qc.isFirefox)c.setProperty("-moz-transform","scale("+b+")",null),c.setProperty("-moz-transform-origin","0 0",null);else if(Qc.isOpera)c.setProperty("-o-transform","scale("+b+")",null),c.setProperty("-o-transform-origin","0 0",null);else if(Qc.isChrome||Qc.isSafari){c.setProperty("-webkit-transform","scale("+b+")",null),c.setProperty("-webkit-transform-origin","0 0",null);var d=null;a._webkitInvaildateDiv?d=a._webkitInvaildateDiv:(d=Oc.createElement("div"),a._webkitInvaildateDiv=d),d.parentNode&&d.parentNode==a?a.removeChild(d):a.appendChild(d)}else Qc.isIE?(c.setProperty("-ms-transform","scale("+b+")",null),c.setProperty("-ms-transform-origin","0 0",null)):(c.setProperty("transform","scale("+b+")",null),c.setProperty("transform-origin","0 0",null))},setCSSStyle:function(a,b,c){a.style.setProperty(b,c,null)},removeCSSStyle:function(a,b){a.style.removeProperty(b)},getCSSStyle:function(a,b){return a.style.getPropertyValue(b)},setBorderRaidus:function(a,b){Qc.isFirefox?a.style.MozBorderRadius=b:a.style.borderRadius=b},createSelect:function(a,b){var c,d,e,f=Oc.createElement("select");if(Array.isArray(a))for(c=0;c<a.length;c++)d=a[c],e=Oc.createElement("option"),e.innerHTML=d,e.setAttribute("value",d),d===b&&e.setAttribute("selected","true"),f.appendChild(e);else for(c=0;c<a.values.length;c++)d=a.values[c],e=Oc.createElement("option"),e.innerHTML=a.map[d],e.setAttribute("value",d),d===b&&e.setAttribute("selected","true"),f.appendChild(e);return f},createImg:function(a){var b=Oc.createElement("img");return b.style.position="absolute","string"==typeof a&&b.setAttribute("src",a),b},createView:function(a,b){var c=Oc.createElement("div");return c.style.position=Ce.VIEW_POSITION,c.style.fontSize=Ce.VIEW_FONT_SIZE,c.style.fontFamily=Ce.VIEW_FONT_FAMILY,c.style.cursor="default",c.style.outline="none",c.style.textAlign="left",c.style.msTouchAction="none",c.tabIndex=0,b||(c.onmousedown=Wc.preventDefault),c.style.setProperty&&(c.style.setProperty("-khtml-user-select","none",null),c.style.setProperty("-webkit-user-select","none",null),c.style.setProperty("-moz-user-select","none",null),c.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),a&&(c.style.overflow=a),c},createDiv:function(){var a=Oc.createElement("div");return a.style.position="absolute",a.style.msTouchAction="none",a},createCanvas:function(a,b){if(a=a||0,b=b||0,Mc){var c=require("canvas");return new c(a,b)}var d=Oc.createElement("canvas");return d.style.position="absolute",d.style.msTouchAction="none",d.width=a,d.height=b,d},setCanvas:function(a,b,c,d,e){2===arguments.length&&(c=b.y,d=b.width,e=b.height,b=b.x),a.style.left=b+"px",a.style.top=c+"px",a.setAttribute("width",d),a.setAttribute("height",e),a._viewRect={x:b,y:c,width:d,height:e};var f=a.getContext("2d");return 0!==f.shadowBlur&&(f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=0,f.shadowColor="rgba(0,0,0,0.0)"),f.clearRect(0,0,d,e),f.translate(-b,-c),f},setImg:function(a,b,c){a.setAttribute("src",b),a.style.left=c.x+"px",a.style.top=c.y+"px",a.style.width=c.width+"px",a.style.height=c.height+"px",a._viewRect=Jc.clone(c)},setDiv:function(a,b,c,d,e){d=Jc.num(d)?d:0,a.style.left=b.x-d+"px",a.style.top=b.y-d+"px",a.style.width=b.width+"px",a.style.height=b.height+"px",a._viewRect=Jc.clone(b),a.style.backgroundColor=c?c:"",a.style.border=d>0?d+"px "+e+" solid":""},addEventListener:function(a,b,c,d){var e="_"+a+"_";if(!d[e]){var f=function(a){f.instance[f.method](a)};f.method=b,f.instance=d,d[e]=f,c.addEventListener(a,f,!1)}},removeEventListener:function(a,b,c){var d="_"+a+"_",e=c[d];e&&(b.removeEventListener(a,e,!1),delete c[d])},isValidEvent:function(a,b){if(!b)return!1;if(b.target===a)if(Qc.isFirefox){if(a.clientHeight<a.scrollHeight&&b.layerX<25)return!1;if(a.clientWidth<a.scrollWidth&&b.layerY<25)return!1}else if(b.offsetX>a.clientWidth||b.offsetY>a.clientHeight)return!1;return!0},getLogicalPoint:function(a,b,c){c=c?c:1;var d,e=a.getBoundingClientRect();if(Qc.isTouchable&&b.changedTouches&&b.changedTouches.length>0){var f=b.changedTouches[0],g=Qc.isAndroid?0:zd.scrollLeft(),h=Qc.isAndroid?0:zd.scrollTop();d={x:(f.clientX+a.scrollLeft-e.left-g)/c,y:(f.clientY+a.scrollTop-e.top-h)/c}}else{if(!Wc.isValidEvent(a,b))return null;d={x:(b.clientX-e.left+a.scrollLeft)/c,y:(b.clientY-e.top+a.scrollTop)/c}}return d},handle_mousedown:function(b,c){Wc.target&&Wc.handle_mouseup(c),a.addEventListener("mousemove",Wc.handle_mousemove,!1),a.addEventListener("mouseup",Wc.handle_mouseup,!1),Wc.target=b},handle_mousemove:function(a){Wc.target.handle_mousemove&&Wc.target.handle_mousemove(a),Wc.target.handleMouseMove&&Wc.target.handleMouseMove(a)},handle_mouseup:function(b){Wc.target.handle_mouseup&&Wc.target.handle_mouseup(b),Wc.target.handleMouseUp&&Wc.target.handleMouseUp(b),a.removeEventListener("mousemove",Wc.handle_mousemove,!1),a.removeEventListener("mouseup",Wc.handle_mouseup,!1),delete Wc.target},getClientPoint:function(a){return{x:a.clientX,y:a.clientY}},windowWidth:function(){return"number"==typeof a.innerWidth?a.innerWidth:Oc.documentElement&&Oc.documentElement.clientWidth?Oc.documentElement.clientWidth:Oc.body&&Oc.body.clientWidth?Oc.body.clientWidth:0},windowHeight:function(){return"number"==typeof a.innerHeight?a.innerHeight:Oc.documentElement&&Oc.documentElement.clientHeight?Oc.documentElement.clientHeight:Oc.body&&Oc.body.clientHeight?Oc.body.clientHeight:0}};Jc.html=Wc;var Xc={cache:{},g:Wc.createCanvas().getContext("2d"),getTextSize:function(a,b){Xc.g.font=a?a:Ce.FONT;var c=Xc.cache[Xc.g.font];c||(c=2*Xc.g.measureText("e").width+4,Xc.cache[Xc.g.font]=c),b=b||"",b=String(b);for(var d,e=b.split("\n"),f=e.length,g=0,h=f-1;h>=0;h--)d=Xc.g.measureText(e[h]).width,d>g&&(g=d);return{width:g+4,height:c*f}},drawText:function(a,c,d,e,f,g){c=c||"",c=String(c),e||(e=Ce.FONT);var h="center";g&&(h=g),a.font=e,a.fillStyle=f,a.textAlign=h,a.textBaseline="middle";var i,j,k=c.split("\n"),l=k.length,m=0;d?d.width===b?(i=d.x,j=d.y):(m=d.height/l,"left"==h?i=d.x:"center"==h&&(i=d.x+d.width/2),j=d.y+m/2):(i=0,j=0),Qc.isOpera&&(j-=2);for(var n=0;l>n;n++)"right"==h&&(a.textAlign="left",i=d.x+d.width-Xc.getTextSize(e,k[n]).width),a.fillText(k[n],i,j),j+=m},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;if(Math.abs(e)>2*Math.PI&&(e=2*Math.PI),m=Math.ceil(Math.abs(e)/(Math.PI/4)),i=e/m,j=-i,k=-d,m>0){n=b+Math.cos(d)*f,o=c+Math.sin(-d)*g,h?a.lineTo(n,o):a.moveTo(n,o);for(var t=0;m>t;t++)k+=j,l=k-j/2,p=b+Math.cos(k)*f,q=c+Math.sin(k)*g,r=b+Math.cos(l)*(f/Math.cos(j/2)),s=c+Math.sin(l)*(g/Math.cos(j/2)),a.quadraticCurveTo(r,s,p,q)}},dashedLine:function(a,b,c,d,e,f,g){var h=f-d,i=g-e,j=Math.sqrt(h*h+i*i);if(0!=j){h/=j,i/=j;for(var k=j,l=-c.offset,m=c.drawing,n=c.patternIndex;k>l;)l+=b[n],l>=k&&(c.offset=b[n]-(l-k),c.patternIndex=n,c.drawing=m,l=k),m?a.lineTo(d+l*h,e+l*i):a.moveTo(d+l*h,e+l*i),m=!m,n=(n+1)%b.length}},drawLinePoints:function(a,b,c,d,e){var f,g,h,i,j,k,l=0,m=0,n=b.size();if(k=c&&c.length>0?new ud(a,c[0],c.length>1?c[1]:c[0]):a,d)for(m=0,j=d.size();j>m;m++)if(f=d.get(m),"moveto"===f&&n>l)g=b.get(l++),k.moveTo(g.x,g.y);else if("lineto"===f&&n>l)g=b.get(l++),k.lineTo(g.x,g.y);else if("cubicto"===f&&n-2>l)g=b.get(l++),h=b.get(l++),i=b.get(l++),k.bezierCurveTo(g.x,g.y,h.x,h.y,i.x,i.y);else{if(!("quadto"===f&&n-1>l))throw"Can not resolve segment '"+f+"'";g=b.get(l++),h=b.get(l++),k.quadraticCurveTo(g.x,g.y,h.x,h.y)}else this._drawLine(b,k);e&&k.closePath()},_drawLine:function(a,b){var c,d,e,f,g,h=0,i=a.size();for(c=a.get(0),b.moveTo(c.x,c.y),h=1;i>h;h++)g=a.get(h),g.size?(f=g.size(),2===f?(c=g.get(0),d=g.get(1),b.quadraticCurveTo(c.x,c.y,d.x,d.y)):3===f&&(c=g.get(0),d=g.get(1),e=g.get(2),b.bezierCurveTo(c.x,c.y,d.x,d.y,e.x,e.y))):b.lineTo(g.x,g.y)},drawRoundRect:function(a,b,c,d,e,f,g,h,i){6===arguments.length&&(g=f,h=f,i=f);var j=b+d,k=c+e,l=e>d?2*d:2*e;f=l>f?f:l,g=l>g?g:l,h=l>h?h:l,i=l>i?i:l;var m=.292893218813453*i,n=.585786437626905*i;a.moveTo(j,k-i),a.quadraticCurveTo(j,k-n,j-m,k-m),a.quadraticCurveTo(j-n,k,j-i,k),m=.292893218813453*h,n=.585786437626905*h,a.lineTo(b+h,k),a.quadraticCurveTo(b+n,k,b+m,k-m),a.quadraticCurveTo(b,k-n,b,k-h),m=.292893218813453*f,n=.585786437626905*f,a.lineTo(b,c+f),a.quadraticCurveTo(b,c+n,b+m,c+m),a.quadraticCurveTo(b+n,c,b+f,c),m=.292893218813453*g,n=.585786437626905*g,a.lineTo(j-g,c),a.quadraticCurveTo(j-n,c,j-m,c+m),a.quadraticCurveTo(j,c+n,j,c+g),a.lineTo(j,k-i)},drawVector:function(a,b,c,d,e,f,g){4===arguments.length&&(e=d.y,f=d.width,g=d.height,d=d.x);var h=Xc["_"+b];h&&(a.beginPath(),c&&c.length>0&&(a=new ud(a,c[0],c.length>1?c[1]:c[0])),h(a,d,e,f,g))},_rectangle:function(a,b,c,d,e){a.rect(b,c,d,e)},_circle:function(a,b,c,d,e){var f=b+d/2,g=c+e/2,h=Math.min(d,e)/2;a instanceof ud?Xc.drawArc(a,f,g,0,2*Math.PI,h,h,!1):a.arc(f,g,h,0,2*Math.PI,!0)},_oval:function(a,b,c,d,e){if(a instanceof ud)Xc.drawArc(a,b+d/2,c+e/2,0,2*Math.PI,d/2,e/2,!1);else{var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l)}},_roundrect:function(a,b,c,d,e){Xc.drawRoundRect(a,b,c,d,e,Math.min(Math.min(d,e)/4,10))},_star:function(a,b,c,d,e){var f=2*d,g=2*e,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(b+.306*d,c+.579*e),a.lineTo(h-f/6,i+g/4),a.lineTo(b+d/2,c+.733*e),a.lineTo(h+f/6,i+g/4),a.lineTo(b+.693*d,c+.579*e),a.lineTo(h+f/4,i-g/12),a.lineTo(b+.611*d,c+.332*e),a.lineTo(h+0,i-g/4),a.lineTo(b+.388*d,c+.332*e),a.closePath()},_triangle:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b+d,c+e),a.lineTo(b,c+e),a.closePath()},_hexagon:function(a,b,c,d,e){a.moveTo(b,c+e/2),a.lineTo(b+d/4,c+e),a.lineTo(b+3*d/4,+c+e),a.lineTo(b+d,c+e/2),a.lineTo(b+3*d/4,c),a.lineTo(b+d/4,c),a.closePath()},_pentagon:function(a,b,c,d,e){var f=2*d,g=2*e,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(h-f/6,i+g/4),a.lineTo(h+f/6,i+g/4),a.lineTo(h+f/4,i-g/12),a.lineTo(h+0,i-g/4),a.closePath()},_diamond:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b,c+e/2),a.lineTo(b+d/2,c+e),a.lineTo(b+d,c+e/2),a.closePath()},fill:function(a,b,c,d,e,f,g,h){var i=Zc[c];a.fillStyle=i?5===arguments.length?i(a,b,d,e.x,e.y,e.width,e.height):i(a,b,d,e,f,g,h):b},createRadialGradient:function(a,b,c,d,e,f,g,h,i){var j=a.createRadialGradient(d+f*h,e+g*i,Math.min(f,g)/24,d+f/2,e+g/2,Math.max(f,g)/2);return j.addColorStop(0,c),j.addColorStop(1,b),j},drawPath:function(a,b,c,d,e,f,g,h){var i=a._element,j=a.getBodyRect();d&&Tc.addPadding(j,i,c+".padding",1);var k=Jc.clone(j),l=i.getStyle(c+".outline.width");l>0&&Tc.grow(k,l/2,l/2);var m=a.setShadow(a,b,k);0!=i.getAngle()&&(i instanceof Ke||(j=i.getOriginalRect()),Ic.Util.rotateCanvas(m,j,i.getAngle()));var n,o=i.getStyle(c+".fill");if(o){n=a._innerColor&&!vd.hasDefault(a._element)?a._innerColor:i.getStyle(c+".fill.color");var p=i.getStyle(c+".gradient");p?Xc.fill(m,n,p,i.getStyle(c+".gradient.color"),j):m.fillStyle=n}var q=i.getStyle(c+".shape");return o&&(m.beginPath(),f?Xc.drawLinePoints(m,f,null,g,h):Xc.drawVector(m,q,null,j),m.fill()),l>0&&(m.lineWidth=l,m.lineCap=i.getStyle(c+".cap"),m.lineJoin=i.getStyle(c+".join"),m.strokeStyle=i.getStyle(c+".outline.color"),m.beginPath(),f?Xc.drawLinePoints(m,f,e,g,h):Xc.drawVector(m,q,e,j),m.stroke()),k},draw3DRect:function(a,b,c,d,e,f,g){if(0!==c){arguments.length<=4&&(g=d.height,f=d.width,e=d.y,d=d.x);var h=c>0;c=Math.abs(c);var i,j;if(a.lineWidth=1,a.lineCap="square",1===c)i=Xc.brighter(b),j=Xc.darker(b),a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke();else for(var k=2*c,l=50/k,m=0;k>m;m++)i=Xc.brighter(b,50-m*l),j=Xc.darker(b,50-m*l),d+=.5,e+=.5,f-=1,g-=1,a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke()}},brighter:function(a,b){return b||(b=50),Xc.adjustBrightness2(a,b)},darker:function(a,b){return b||(b=50),Xc.adjustBrightness2(a,-b)},adjustBrightness2:function(a,b){var c,d,e;if(0===b)return a;var f=re(a);return 0>b?(b=(100+b)/100,c=Math.ceil(f.r*b),d=Math.ceil(f.g*b),e=Math.ceil(f.b*b)):(b/=100,c=f.r,d=f.g,e=f.b,c+=(255-c)*b,d+=(255-d)*b,e+=(255-e)*b,c=Math.min(Math.ceil(c),255),d=Math.min(Math.ceil(d),255),e=Math.min(Math.ceil(e),255)),"rgba("+c+","+d+","+e+",1)"},getColorArray:function(a){return qe.clearRect(0,0,1,1),qe.fillStyle=a,qe.fillRect(0,0,1,1),qe.getImageData(0,0,1,1).data},hit:function(a,b,c){if(!a)return!1;var d=a._viewRect;if(!d)return!1;if(b-=d.x,c-=d.y,0>b||0>c||b>=d.width||c>=d.height)return!1;try{for(var e=a.getContext("2d").getImageData(b,c,1,1),f=e.data,g=0,h=f.length;h>g;g+=4)if(0!==f[g+3])return!0}catch(i){return!0}return!1},intersects:function(a,b){if(!a)return!1;if(b=Tc.intersection(b,a._viewRect),!b)return!1;b.x-=a._viewRect.x,b.y-=a._viewRect.y;try{for(var c=a.getContext("2d").getImageData(b.x,b.y,b.width,b.height),d=c.data,e=0,f=d.length;f>e;e+=4)if(0!==d[e+3])return!0}catch(g){}return!1}};Jc.g=Xc;var Yc,Zc={"linear.southwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e+g,d+f,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.southeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.northwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.northeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.west":function(a,b,c,d,e,f){var g=a.createLinearGradient(d,e,d+f,e);return g.addColorStop(0,c),g.addColorStop(1,b),g},"linear.east":function(a,b,c,d,e,f){var g=a.createLinearGradient(d,e,d+f,e);return g.addColorStop(0,b),g.addColorStop(1,c),g},"radial.center":function(a,b,c,d,e,f,g){return Xc.createRadialGradient(a,b,c,d,e,f,g,.5,.5)},"radial.southwest":function(a,b,c,d,e,f,g){return Xc.createRadialGradient(a,b,c,d,e,f,g,.25,.75)},"radial.southeast":function(a,b,c,d,e,f,g){return Xc.createRadialGradient(a,b,c,d,e,f,g,.75,.75)},"radial.northwest":function(a,b,c,d,e,f,g){return Xc.createRadialGradient(a,b,c,d,e,f,g,.25,.25)},"radial.northeast":function(a,b,c,d,e,f,g){return Xc.createRadialGradient(a,b,c,d,e,f,g,.75,.25)},"radial.north":function(a,b,c,d,e,f,g){return Xc.createRadialGradient(a,b,c,d,e,f,g,.5,.25)},"radial.south":function(a,b,c,d,e,f,g){return Xc.createRadialGradient(a,b,c,d,e,f,g,.5,.75)},"radial.west":function(a,b,c,d,e,f,g){return Xc.createRadialGradient(a,b,c,d,e,f,g,.25,.5)},"radial.east":function(a,b,c,d,e,f,g){return Xc.createRadialGradient(a,b,c,d,e,f,g,.75,.5)},"spread.horizontal":function(a,b,c,d,e,f){var g=a.createLinearGradient(d,e,d+f,e);return g.addColorStop(0,b),g.addColorStop(.5,c),g.addColorStop(1,b),g},"spread.vertical":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.diagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.antidiagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,b),h.addColorStop(1/3,c),h.addColorStop(2/3,b),h.addColorStop(1,c),h},"spread.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,c),h.addColorStop(1/3,b),h.addColorStop(2/3,c),h.addColorStop(1,b),h},"spread.west":function(a,b,c,d,e,f){var g=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return g.addColorStop(0,b),g.addColorStop(1/3,c),g.addColorStop(2/3,b),g.addColorStop(1,c),g},"spread.east":function(a,b,c,d,e,f){var g=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return g.addColorStop(0,c),g.addColorStop(1/3,b),g.addColorStop(2/3,c),g.addColorStop(1,b),g}},$c=0xdeadbeefcafe,_c=15715070==(16777215&$c);_c&&"Microsoft Internet Explorer"==Nc.appName?(c.prototype.am=f,Yc=30):_c&&"Netscape"!=Nc.appName?(c.prototype.am=e,Yc=26):(c.prototype.am=g,Yc=28),c.prototype.DB=Yc,c.prototype.DM=(1<<Yc)-1,c.prototype.DV=1<<Yc;var ad=52;c.prototype.FV=Math.pow(2,ad),c.prototype.F1=ad-Yc,c.prototype.F2=2*Yc-ad;var bd,cd,dd="0123456789abcdefghijklmnopqrstuvwxyz",ed=new Array;for(bd="0".charCodeAt(0),cd=0;9>=cd;++cd)ed[bd++]=cd;for(bd="a".charCodeAt(0),cd=10;36>cd;++cd)ed[bd++]=cd;for(bd="A".charCodeAt(0),cd=10;36>cd;++cd)ed[bd++]=cd;E.prototype.convert=F,E.prototype.revert=G,E.prototype.reduce=H,E.prototype.mulTo=I,E.prototype.sqrTo=J,L.prototype.convert=M,L.prototype.revert=N,L.prototype.reduce=O,L.prototype.mulTo=Q,L.prototype.sqrTo=P,c.prototype.copyTo=k,c.prototype.fromInt=l,c.prototype.fromString=n,c.prototype.clamp=o,c.prototype.dlShiftTo=v,c.prototype.drShiftTo=w,c.prototype.lShiftTo=x,c.prototype.rShiftTo=y,c.prototype.subTo=z,c.prototype.multiplyTo=A,c.prototype.squareTo=B,c.prototype.divRemTo=C,c.prototype.invDigit=K,c.prototype.isEven=R,c.prototype.exp=S,c.prototype.toString=p,c.prototype.negate=q,c.prototype.abs=r,c.prototype.compareTo=s,c.prototype.bitLength=u,c.prototype.mod=D,c.prototype.modPowInt=T,c.ZERO=m(0),c.ONE=m(1),Kb.prototype.convert=Lb,Kb.prototype.revert=Lb,Kb.prototype.mulTo=Mb,Kb.prototype.sqrTo=Nb,Rb.prototype.convert=Sb,Rb.prototype.revert=Tb,Rb.prototype.reduce=Ub,Rb.prototype.mulTo=Wb,Rb.prototype.sqrTo=Vb;
var fd=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],gd=(1<<26)/fd[fd.length-1];c.prototype.chunkSize=Y,c.prototype.toRadix=$,c.prototype.fromRadix=_,c.prototype.fromNumber=ab,c.prototype.bitwiseTo=fb,c.prototype.changeBit=wb,c.prototype.addTo=Ab,c.prototype.dMultiply=Ib,c.prototype.dAddOffset=Jb,c.prototype.multiplyLowerTo=Pb,c.prototype.multiplyUpperTo=Qb,c.prototype.modInt=Zb,c.prototype.millerRabin=ac,c.prototype.clone=U,c.prototype.intValue=V,c.prototype.byteValue=W,c.prototype.shortValue=X,c.prototype.signum=Z,c.prototype.toByteArray=bb,c.prototype.equals=cb,c.prototype.min=db,c.prototype.max=eb,c.prototype.and=hb,c.prototype.or=jb,c.prototype.xor=lb,c.prototype.andNot=nb,c.prototype.not=ob,c.prototype.shiftLeft=pb,c.prototype.shiftRight=qb,c.prototype.getLowestSetBit=sb,c.prototype.bitCount=ub,c.prototype.testBit=vb,c.prototype.setBit=xb,c.prototype.clearBit=yb,c.prototype.flipBit=zb,c.prototype.add=Bb,c.prototype.subtract=Cb,c.prototype.multiply=Db,c.prototype.divide=Fb,c.prototype.remainder=Gb,c.prototype.divideAndRemainder=Hb,c.prototype.modPow=Xb,c.prototype.modInverse=$b,c.prototype.pow=Ob,c.prototype.gcd=Yb,c.prototype.isProbablePrime=_b,c.prototype.square=Eb,bc.prototype.init=cc,bc.prototype.next=dc;var hd,id,jd,kd=256;if(null==id){id=new Array,jd=0;var ld;if("Netscape"==Nc.appName&&Nc.appVersion<"5"&&a.crypto){var md=a.crypto.random(32);for(ld=0;ld<md.length;++ld)id[jd++]=255&md.charCodeAt(ld)}for(;kd>jd;)ld=Math.floor(65536*Math.random()),id[jd++]=ld>>>8,id[jd++]=255&ld;jd=0,gc()}jc.prototype.nextBytes=ic;mc.prototype.doPublic=oc,mc.prototype.setPublic=nc,mc.prototype.encrypt=pc,mc.prototype.doPrivate=tc,mc.prototype.setPrivate=rc,mc.prototype.setPrivateEx=sc,mc.prototype.decrypt=uc;var nd=function(){od.v(Kc)},od={},pd="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",qd="10001";od.cross=function(a){if(a){for(var b="",c=0;c<a.length;)c+1<a.length?(b+=a[c+1],b+=a[c]):b+=a[c],c+=2;return b}return null},od.reverse=function(a){if(a){for(var b="",c=a.length;c>0;c--)b+=a[c-1];return b}return null},od.v=function(a){if(a){var b=od;if(b.start=null,b.beginDate=null,b.end=null,b.endDate=null,b.gis=null,b["3D"]=null,b["3d"]=null,b.l=null,b.__li__=null,a.indexOf("signature=")>0){var c=a.split("signature="),d=c[0],e=c[1],f=new mc;f.setPublic(pd,qd);for(var g=e,h=g.length,i=256,j=0,k="",l="";h>j;)k=g.substr(j,i),l+=f.decrypt(k),j+=i;if(l===d)return b.i(a),!0}}return!1},od.i=function(a){var c=od;c.__li__=a;var d,e,f,g,h,i=a.split("\n");for(d=i.length-1;d>=0;d--)e=i[d],h=e.split("="),f=h[0],g=h[1],c[f]=g;c.start!=b&&(c.beginDate=new Date(Date.parse(c.start.replace(/-/g,"/")))),c.end!=b&&(c.endDate=new Date(Date.parse(c.end.replace(/-/g,"/"))));var j=c.gis;j!=b&&(j=parseInt(j)),j&&(c._isPermissionGIS=!0);var k=c["3D"]||c["3d"];k!=b&&(k=parseInt(k)),k&&(c._isPermission3D=!0),c["3D"]&&(c._isPermission3D=!0),c.l!=b&&(c.version=c.l)};var rd=function(a){return a.__li__!==b&&!a._isPermission3D},sd=function(a){if(!rd(a))return!0;var b=new Date;return null!=a.beginDate&&a.beginDate.getTime()-b.getTime()>=0||null!=a.endDate&&a.endDate.getTime()-b.getTime()<=0},td=function(){return sd(od)?!1:od._isPermissionGIS};od.$z=function(a){var b=new mc;b.setPublic(pd,qd);for(var c=a,d=c.length,e=256,f=0,g="",h="";d>f;)g=c.substr(f,e),h+=b.decrypt(g),f+=e;return h},od.twm=function(a){var c=od,d=c.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),e=this.type,f=this.markText,g=c.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");if(a[g]=c.__li__,"3"!==e||sd(od)||f!==b){a.__liLabel==b&&(a.__liLabel=Oc.createElement("div")),c.startDate===b&&(c.startDate=new Date);var h=(new Date).getTime()-c.startDate.getTime();if(!(3e5>h)){var i=sd(c)&&h>3e5,j=f;if(i?j=c.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=e||j!==b&&""!=j?"1"!=e||f||(j=d):j=c.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),j!==b){var k=a,l=k.__liLabel;if(l.innerHTML=j,k._rootCanvas)l.type=e,l.mark=f,l.expired=i,k._xyz=l;else{var m=0,n=0;l.style.position="absolute";var o=k.getView().style;f!=b&&null!=f&&""!=f||"2"==e?(m=10-k.getView().scrollLeft,n=10-k.getView().scrollTop):(m=o.width.replace("px","")/2-50-k.getView().scrollLeft,n=o.height.replace("px","")/2-k.getView().scrollTop),l.style.right=m+"px",l.style.bottom=n+"px",l.style.fontSize="120%",i&&(k.getView().style.opacity=.1,l.style.color="red",l.style.fontSize="150%"),k.getView().appendChild(l)}}}}},Jc.validateLicense(Kc);var ud=function(a,b,c){this.g=a,this.onLength=b,this.offLength=c,this.isLine=!0,this.overflow=0,this.dashLength=b+c,this.pen={x:0,y:0}};Jc.ext(ud,Object,{_curveaccuracy:6,moveTo:function(a,b){this.pen={x:a,y:b},this.g.moveTo(a,b),this.start||(this.start={x:a,y:b})},lineTo:function(a,b){var c=a-this.pen.x,d=b-this.pen.y,e=Math.atan2(d,c),f=Math.cos(e),g=Math.sin(e),h=this.lineLength(this.pen.x,this.pen.y,a,b);if(this.overflow){if(this.overflow>h)return this.isLine?this._lineTo(a,b):this.moveTo(a,b),void(this.overflow-=h);if(this.isLine?this._lineTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow):this.moveTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow),h-=this.overflow,this.overflow=0,this.isLine=!this.isLine,!h)return}var i=Math.floor(h/this.dashLength);if(i){for(var j=f*this.onLength,k=g*this.onLength,l=f*this.offLength,m=g*this.offLength,n=0;i>n;n++)this.isLine?(this._lineTo(this.pen.x+j,this.pen.y+k),this.moveTo(this.pen.x+l,this.pen.y+m)):(this.moveTo(this.pen.x+l,this.pen.y+m),this._lineTo(this.pen.x+j,this.pen.y+k));h-=this.dashLength*i}this.isLine?h>this.onLength?(this._lineTo(this.pen.x+f*this.onLength,this.pen.y+g*this.onLength),this.moveTo(a,b),this.overflow=this.offLength-(h-this.onLength),this.isLine=!1):(this._lineTo(a,b),h==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-h,this.moveTo(a,b))):h>this.offLength?(this.moveTo(this.pen.x+f*this.offLength,this.pen.y+g*this.offLength),this._lineTo(a,b),this.overflow=this.onLength-(h-this.offLength),this.isLine=!0):(this.moveTo(a,b),h==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-h)},quadraticCurveTo:function(a,b,c,d){var e,f=this.pen.x,g=this.pen.y,h=this.curveLength(f,g,a,b,c,d),i=0,j=0;if(this.overflow){if(this.overflow>h)return this.isLine?this._curveTo(a,b,c,d):this.moveTo(c,d),void(this.overflow-=h);if(i=this.overflow/h,e=this.curveSliceUpTo(f,g,a,b,c,d,i),this.isLine?this._curveTo(e[2],e[3],e[4],e[5]):this.moveTo(e[4],e[5]),this.overflow=0,this.isLine=!this.isLine,!h)return}var k=h-h*i,l=Math.floor(k/this.dashLength),m=this.onLength/h,n=this.offLength/h;if(l)for(var o=0;l>o;o++)this.isLine?(j=i+m,e=this.curveSlice(f,g,a,b,c,d,i,j),this._curveTo(e[2],e[3],e[4],e[5]),i=j,j=i+n,e=this.curveSlice(f,g,a,b,c,d,i,j),this.moveTo(e[4],e[5])):(j=i+n,e=this.curveSlice(f,g,a,b,c,d,i,j),this.moveTo(e[4],e[5]),i=j,j=i+m,e=this.curveSlice(f,g,a,b,c,d,i,j),this._curveTo(e[2],e[3],e[4],e[5])),i=j;k=h-h*i,this.isLine?k>this.onLength?(j=i+m,e=this.curveSlice(f,g,a,b,c,d,i,j),this._curveTo(e[2],e[3],e[4],e[5]),this.moveTo(c,d),this.overflow=this.offLength-(k-this.onLength),this.isLine=!1):(e=this.curveSliceFrom(f,g,a,b,c,d,i),this._curveTo(e[2],e[3],e[4],e[5]),h==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-k,this.moveTo(c,d))):k>this.offLength?(j=i+n,e=this.curveSlice(f,g,a,b,c,d,i,j),this.moveTo(e[4],e[5]),e=this.curveSliceFrom(f,g,a,b,c,d,j),this._curveTo(e[2],e[3],e[4],e[5]),this.overflow=this.onLength-(k-this.offLength),this.isLine=!0):(this.moveTo(c,d),k==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-k)},bezierCurveTo:function(a,b,c,d,e,f){this.pen={x:e,y:f},this.g.bezierCurveTo(a,b,c,d,e,f)},rect:function(a,b,c,d){this.pen={x:a,y:b},this.moveTo(a,b),this.lineTo(a,b+d),this.lineTo(a+c,b+d),this.lineTo(a+c,b),this.lineTo(a,b)},closePath:function(){this.lineTo(this.start.x,this.start.y)},lineLength:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},curveLength:function(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o=0,p=a,q=b,r=g>0?g:this._curveaccuracy,s=1;r>=s;s++)j=s/r,k=1-j,l=k*k,m=2*j*k,n=j*j,h=l*a+m*c+n*e,i=l*b+m*d+n*f,o+=this.lineLength(p,q,h,i),p=h,q=i;return o},curveSlice:function(a,b,c,d,e,f,g,h){if(0==g)return this.curveSliceUpTo(a,b,c,d,e,f,h);if(1==h)return this.curveSliceFrom(a,b,c,d,e,f,g);var i=this.curveSliceUpTo(a,b,c,d,e,f,h);return i.push(g/h),this.curveSliceFrom.apply(this,i)},curveSliceUpTo:function(a,b,c,d,e,f,g){if(1!=g){var h=c+(e-c)*g,i=d+(f-d)*g;c=a+(c-a)*g,d=b+(d-b)*g,e=c+(h-c)*g,f=d+(i-d)*g}return[a,b,c,d,e,f]},curveSliceFrom:function(a,b,c,d,e,f,g){if(1!=g){var h=a+(c-a)*g,i=b+(d-b)*g;c+=(e-c)*g,d+=(f-d)*g,a=h+(c-h)*g,b=i+(d-i)*g}return[a,b,c,d,e,f]},_lineTo:function(a,b){(a!=this.pen.x||b!=this.pen.y)&&(this.pen={x:a,y:b},this.g.lineTo(a,b))},_curveTo:function(a,b,c,d){(a!=c||b!=d||c!=this.pen.x||d!=this.pen.y)&&(this.pen={x:c,y:d},this.g.quadraticCurveTo(a,b,c,d))}}),Jc.DashedLine=ud;var vd={DEFAULTS:{"default":1,"default.vector":1,"vector.default":1},VECTORS:{vector:1,"default.vector":1,"vector.default":1},hasDefault:function(a){if(a instanceof Je){var b=a.getStyle("body.type");return 1===vd.DEFAULTS[b]}return!0},hasVector:function(a){if(a instanceof Je){var b=a.getStyle("body.type");return 1===vd.VECTORS[b]}return!1},hasAgentLinks:function(a){for(var b=a.getChildrenSize(),c=0;b>c;c++){var d=a.getChildAt(c);if(d instanceof Je&&vd.hasAgentLinks(d))return!0}return a.hasAgentLinks()},getParents:function(a,b,c){c||(c=!0);for(var d=new me,e=a._parent;null!=e&&e!==b;)d.add(e,0),e=e._parent;return c&&null!=e&&e===b&&d.add(e,0),d},getSubNetwork:function(a){if(!a)return null;if(a instanceof Ic.Link){var b=a._fromAgent,c=a._toAgent;if(!b||!c)return null;var d=vd.getSubNetwork(b),e=vd.getSubNetwork(c);return d===e?d:null}var f=a._parent;if(!f)return null;for(;f instanceof Ic.Link&&!(f instanceof Ic.SubNetwork);)f=f._parent;return f instanceof Ic.SubNetwork?f:vd.getSubNetwork(f)},figureSameSubNetworkAgent:function(a){if(!a)return null;for(var b=a._parent;b instanceof Ke;){if(!(b._parent instanceof Ke))return b.isExpanded()?a:b;b.isExpanded()||(a=b),b=b._parent}return a},figureSpanSubNetworkAgent:function(a,b){if(!a||!b)return null;var c=vd.getSubNetwork(a),d=vd.getSubNetwork(b);if(c!=d){for(;null!=d&&c!=d;)d=vd.getSubNetwork(d);if(c===d)return a;var e=new me;e.add(a,0);for(var f=a._parent;f instanceof Je&&!b.isDescendantOf(f);)e.add(f,0),f=f._parent;for(var g=e.size(),h=0;g>h;h++){var i=e.get(h);if(i instanceof Ke&&!i.isExpanded())return i;if(i.ISubNetwork)return i}return a}return a},figureFromAgent:function(a){if(a.isLooped())return a.getFromNode();var b=vd.figureSameSubNetworkAgent(a.getFromNode()),c=vd.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getFromNode():vd.figureSpanSubNetworkAgent(b,c)},figureToAgent:function(a){if(a.isLooped())return a.getToNode();var b=vd.figureSameSubNetworkAgent(a.getFromNode()),c=vd.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getToNode():vd.figureSpanSubNetworkAgent(c,b)},getBundleLinks:function(a,b){if(!a||!b)return null;var c,d,e,f;if(a===b){if(f=a.getLoopedLinks(),!f)return null;f=new me(f)}else{var g=a.getAgentLinks(),h=b.getAgentLinks();if(!g||!h)return null;for(d=g.size(),c=0;d>c;c++)e=g.get(c),h.contains(e)&&(f||(f=new me),f.add(e))}if(null!=f)for(c=0;c<f.size();c++)e=f.get(c),e.getStyle("link.bundle.enable")||(e._setBundleLinks(null),f.removeAt(c),c--);return f},resetBundleLinks:function(a,b){var c=vd.getBundleLinks(a,b);if(c&&0!==c.size()){var d=null;if(1===c.size())return d=c.get(0),void d._setBundleLinks(null);var e,f,g=new me;for(e=0;e<c.size();e++)d=c.get(e),f=d.getStyle("link.bundle.id"),g.indexOf(f)<0&&g.add(f);g.sort();var h,i,j=new me;for(i=0;i<g.size();i++){f=g.get(i);var k=new me;for(e=0;e<c.size();e++)d=c.get(e),f===d.getStyle("link.bundle.id")&&k.add(d);h=new Ic.BundleLinks(k,j),j.add(h)}for(i=0;i<j.size();i++)for(h=j.get(i),e=0;e<h.getLinks().size();e++)d=h.getLinks().get(e),d._setBundleLinks(h)}},moveElements:function(a,b,c,d){for(var e=vd.filterMovingElements(a,d),f=e.size(),g=0;f>g;g++)e.get(g).translate(b,c)},filterMovingElements:function(a,b){for(var c=new me,d=a.size(),e=0;d>e;e++){var f=a.get(e);if(f instanceof Je&&(!b||b(f))){for(var g=!0,h=c.toArray(),i=0;i<h.length;i++){var j=h[i];g&&j instanceof Ic.Follower&&f instanceof Ic.Follower&&f.isLoopedHostOn(j)?g=!1:j instanceof Ic.Follower&&j.isHostOn(f)?c.remove(j):g&&f instanceof Ic.Follower&&j instanceof Je&&f.isHostOn(j)?g=!1:vd.isDescendantOfGroup(j,f)?c.remove(j):g&&vd.isDescendantOfGroup(f,j)&&(g=!1)}g&&c.add(f)}}return c},isDescendantOfGroup:function(a,b){if(!(a&&b instanceof Ke))return!1;if(!b.hasChildren())return!1;for(a=a._parent;a instanceof Ke;){if(a===b)return!0;a=a._parent}return!1}};Jc.element=vd;var wd={between:function(a,b,c){return c>=a&&b>=c?!0:c>=b&&a>=c?!0:!1},considerEast:function(a,b,c){return b?wd.between(b.x,c.x,a.x)?c.x>b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerWest:function(a,b,c){return b?wd.between(b.x,c.x,a.x)?c.x<b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerNorth:function(a,b,c){return b?wd.between(b.y,c.y,a.y)?c.y<b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},considerSouth:function(a,b,c){return b?wd.between(b.y,c.y,a.y)?c.y>b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},getHorizontalPoint:function(a,b,c){return wd.between(b.x,c.x,a.x)?{x:a.x,y:b.y}:Math.abs(a.x-b.x)<Math.abs(a.x-c.x)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getVerticalPoint:function(a,b,c){return wd.between(b.y,c.y,a.y)?{x:b.x,y:a.y}:Math.abs(a.y-b.y)<Math.abs(a.y-c.y)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getPoint:function(a,b,c,d,e){var f=Math.abs(d.x-c.x)>Math.abs(d.y-c.y);if("south"===e)return f&&wd.considerSouth(b,a,c)?wd.getHorizontalPoint(b,c,d):null;if("north"===e)return f&&wd.considerNorth(b,a,c)?wd.getHorizontalPoint(b,c,d):null;if("west"===e)return!f&&wd.considerWest(b,a,c)?wd.getVerticalPoint(b,c,d):null;if("east"===e)return!f&&wd.considerEast(b,a,c)?wd.getVerticalPoint(b,c,d):null;if("nearby"===e){var g;return g=f?wd.getHorizontalPoint(b,c,d):wd.getVerticalPoint(b,c,d),!a||Tc.getDistance(a,b)>Tc.getDistance(g,b)?g:null}return null},getBusPoint:function(a,b,c){var d,e=a.size();if(e>0){for(var f=a.get(0),g=1;e>g;g++){var h=a.get(g),i=wd.getPoint(d,b,f,h,c);i&&(d=i),f=h}d||(d={x:f.x,y:f.y})}return d}};Jc.bus=wd;var xd={createFromPoint:function(a,b){var c=a._element;if(!c.getFromAgent())return{x:0,y:0};var d,e=c.getStyle("link.from.position"),f=c.getStyle("link.from.xoffset"),g=c.getStyle("link.from.yoffset");if(a._network._edgeDetect){var h=c.getFromAgent(),i=c.getToAgent(),j=h.getImage(),k=Jc.images[j],l=h.getCenterLocation(),m=i.getCenterLocation(),n=this._getPointAngleDegree(m.x,m.y,l.x,l.y),o={x:0,y:0};if(k){var p=k._image;if(p&&ce(p)||p&&Ic.Util.getImageAsset(j)._cache)return ce(p)?k._edgeData||(k._edgeData=k._createEdgeData(p)):"object"==typeof p&&(k._edgeData||(k._edgeData=k._createEdgeData(Ic.Util.getImageAsset(j)._cache))),o.x=k._edgeData[n].x+h.getRect().x,o.y=k._edgeData[n].y+h.getRect().y,o}}if(!Jc.isCalculatingBus){if(Jc.isCalculatingBus=!0,c.getFromAgent()instanceof Ic.Bus){var q=c.getFromAgent();if(vd.hasVector(q)){var r=b?b._getElementZoomRect(a,q.getRect()):q.getRect(),s=q.getStyle("vector.shape");if("oval"===s)d=Tc.getEllipsePoint(r,xd.createToPoint(a));else if("circle"===s)d=Tc.getEllipsePoint(Tc.getCircleRect(r),xd.createToPoint(a));else if("rectangle"===s||"roundrect"===s){var t=new me;t.add({x:q.x,y:q.y}),t.add({x:q.x+q.width,y:q.y}),t.add({x:q.x+q.width,y:q.y+q.height}),t.add({x:q.x,y:q.y+q.height}),t.add({x:q.x,y:q.y}),t=b?b._getShapeNodeZoomPoints(a,t):t,d=wd.getBusPoint(t,xd.createToPoint(a),q.getStyle("bus.style"))}}else{var t=b?b._getShapeNodeZoomPoints(a,q.getPoints()):q.getPoints();d=wd.getBusPoint(t,xd.createToPoint(a),q.getStyle("bus.style"))}}Jc.isCalculatingBus=!1}return d?(d.x+=f,d.y+=g):d=a._network.getPosition(e,c.getFromAgent(),null,f,g,!0),d},createToPoint:function(a,b){var c=a._element;if(!c.getToAgent())return{x:0,y:0};var d,e=c.getStyle("link.to.position"),f=c.getStyle("link.to.xoffset"),g=c.getStyle("link.to.yoffset");if(a._network._edgeDetect){var h=c.getFromAgent(),i=c.getToAgent(),j=i.getImage(),k=Jc.images[j],l=h.getLocation(),m=i.getCenterLocation(),n=this._getPointAngleDegree(l.x,l.y,m.x,m.y),o={x:0,y:0};if(k){var p=k._image;if(p&&ce(p)||p&&Ic.Util.getImageAsset(j)._cache)return ce(p)?k._edgeData||(k._edgeData=k._createEdgeData(p)):"object"==typeof p&&(k._edgeData||(k._edgeData=k._createEdgeData(Ic.Util.getImageAsset(j)._cache))),o.x=k._edgeData[n].x+i.getRect().x,o.y=k._edgeData[n].y+i.getRect().y,o}}if(!Jc.isCalculatingBus){if(Jc.isCalculatingBus=!0,c.getToAgent()instanceof Ic.Bus){var q=c.getToAgent();if(vd.hasVector(q)){var r=b?b._getElementZoomRect(a,q.getRect()):q.getRect(),s=q.getStyle("vector.shape");if("oval"===s)d=Tc.getEllipsePoint(r,xd.createFromPoint(a));else if("circle"===s)d=Tc.getEllipsePoint(Tc.getCircleRect(r),xd.createFromPoint(a));else if("rectangle"===s||"roundrect"===s){var t=new me;t.add({x:q.x,y:q.y}),t.add({x:q.x+q.width,y:q.y}),t.add({x:q.x+q.width,y:q.y+q.height}),t.add({x:q.x,y:q.y+q.height}),t.add({x:q.x,y:q.y}),t=b?b._getShapeNodeZoomPoints(a,t):t,d=wd.getBusPoint(t,xd.createFromPoint(a),q.getStyle("bus.style"))}}else{var t=b?b._getShapeNodeZoomPoints(a,q.getPoints()):q.getPoints();d=wd.getBusPoint(t,xd.createFromPoint(a),q.getStyle("bus.style"))}}Jc.isCalculatingBus=!1}return d?(d.x+=f,d.y+=g):d=a._network.getPosition(e,c.getToAgent(),null,f,g,!0),d},fillLoopedPoints:function(a,b,c){var d,e=xd.getBundleGap(a,!0),f=e,g=a.getStyle("link.looped.type"),h=a.getStyle("link.looped.direction");if("north"===h)return"arc"===g?xd.drawArc(b.x+b.width/2,b.y,0,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y},c.add({x:d.x+f,y:d.y}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width/2,y:b.y-e};if("northeast"===h)return"arc"===g?xd.drawArc(b.x+b.width,b.y,1.5*Math.PI,1.5*Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x+f,y:d.y+f}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+.707*e,y:b.y-.707*e};if("east"===h)return"arc"===g?xd.drawArc(b.x+b.width,b.y+b.height/2,1.5*Math.PI,Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+e,y:d.y-f}),c.add({x:d.x+e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x+b.width+e,y:b.y+b.height/2};if("southeast"===h)return"arc"===g?xd.drawArc(b.x+b.width,b.y+b.height,Math.PI,1.5*Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+f,y:d.y-f}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+.707*e,y:b.y+b.height+.707*e};if("south"===h)return"arc"===g?xd.drawArc(b.x+b.width/2,b.y+b.height,Math.PI,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y+b.height},c.add({x:d.x-f,y:d.y}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x+b.width/2,y:b.y+b.height+e};if("southwest"===h)return"arc"===g?xd.drawArc(b.x,b.y+b.height,.5*Math.PI,1.5*Math.PI,e,e,!1,c):(d={x:b.x,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-f,y:d.y-f}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x-.707*e,y:b.y+b.height+.707*e};if("west"===h)return"arc"===g?xd.drawArc(b.x,b.y+b.height/2,.5*Math.PI,Math.PI,e,e,!1,c):(d={x:b.x,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-e,y:d.y-f}),c.add({x:d.x-e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x-e,y:b.y+b.height/2};if("northwest"===h)return"arc"===g?xd.drawArc(b.x,b.y,0,1.5*Math.PI,e,e,!1,c):(d={x:b.x,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x-f,y:d.y+f}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x+f,y:d.y})),{x:b.x-.707*e,y:b.y-.707*e};throw"Can not resolve link looped direction '"+h+"'"},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;if(Math.abs(d)>2*Math.PI&&(d=2*Math.PI),m=Math.ceil(Math.abs(d)/(Math.PI/4)),i=d/m,j=-i,k=-c,m>0){n=a+Math.cos(c)*e,o=b+Math.sin(-c)*f,h.add({x:n,y:o});for(var t=0;m>t;t++){k+=j,l=k-j/2,p=a+Math.cos(k)*e,q=b+Math.sin(k)*f,r=a+Math.cos(l)*(e/Math.cos(j/2)),s=b+Math.sin(l)*(f/Math.cos(j/2));var u=new me;u.add({x:r,y:s}),u.add({x:p,y:q}),h.add(u)}}},fillBundlePoints:function(a,c,d,e,f,g){{var h;a._element.getBundleCount(),a._element.getBundleIndex(),a.getStyle("link.bundle.expanded")}if("parallel"!==c&&0===(h=xd.getBundleGap(a,!1)))return f.add(d),f.add(e),Tc.getCenterPoint(d,e);h===b&&(h=xd.getBundleGap(a,!1));var i=xd.getBundleOffset(a),j=Tc.getDistance(d,e);if(g){var k=g.getSizeZoom();i*=k,h*=k}("arc"===c||"triangle"===c)&&f.add({x:0,y:0}),"arc"===c&&f.add({x:0,y:h}),f.add({x:i,y:h}),f.add({x:j-i,y:h}),"arc"===c&&f.add({x:j,y:h}),("arc"===c||"triangle"===c)&&f.add({x:j,y:0});for(var l=Math.atan2(e.y-d.y,e.x-d.x),m=Tc.createMatrix(l,0,0),n=0,o=f.size();o>n;n++){var p=f.get(n);p=m.transform(p),p.x+=d.x,p.y+=d.y,f.set(n,p)}if("arc"===c){var q=Tc.getCenterPoint(f.get(2),f.get(3)),r=new me;return r.add(f.get(1)),r.add(f.get(2)),f.set(1,r),r=new me,r.add(f.get(4)),r.add(f.get(5)),f.set(4,r),f.removeAt(5),f.removeAt(2),q}return xd.calculateCenterPoint(f)},calculateCenterPoint:function(a){var b=a.size();if(null==a||1>b)return{x:0,y:0};if(b%2===0){var c=b/2,d=a.get(c-1),e=a.get(c);return{x:(d.x+e.x)/2,y:(d.y+e.y)/2}}return a.get((b-1)/2)},getBundleOffset:function(a){var b=Tc.getDistance(a.getFromPoint(),a.getToPoint()),c=a.getStyle("link.bundle.offset");return b>2*c?c:b/2},getBundleGap:function(a,b){var c=a._element;if(!c.getBundleLinks())return b?c.getStyle("link.looped.gap"):0;for(var d=b?"link.looped.gap":"link.bundle.gap",e=null,f=0,g=0,h=c.getBundleLinks().getSiblings(),i=0,j=c.getStyle("link.bundle.independent"),k=c.getStyle("link.bundle.group.gap"),l=0,m=h.size();m>l;l++){var n=h.get(l);if(!j||n===c.getBundleLinks()){for(var o=0,p=n.getLinks().size();p>o;o++){var q=n.getLinks().get(o);if(j===q.getStyle("link.bundle.independent")&&a._network.isVisible(q)){if(null==e)e=q,i=q.getStyle(d);else{var r=q.getStyle(d);g+=i/2+r/2,i=r}q===c&&(f=g+k/2)}}g+=k}}if(b)return g-f+i;var s=f-g/2;return null!=e&&c.getFromAgent()!==e.getFromAgent()&&(s=-s),s},isTargetPriority:function(a,b,c){if(a){if(b.height<c.height)return b.height+c.height<Math.max(b.y+b.height,c.y+c.height)-Math.min(b.y,c.y)+b.height/2}else if(b.width<c.width)return b.width+c.width<Math.max(b.x+b.width,c.x+c.width)-Math.min(b.x,c.x)+b.width/2;return!0},calculateOrthogonalAndFlexionalLinkPoints:function(a,b,c,d){var e=xd.isHorizontal(a,b,c,d),f=new me;if(xd.isFlexionalTypeLink(a))xd.flexional(e,b,c,f,d.getStyle("link.extend"));else{xd.orthogonal(a,b,c,f,e,d);var g=xd.isSplitByPercent(a,d),h=g?xd.calculateSplitValueByPercent(a,e,b,c,d.getStyle("link.split.percent")):d.getStyle("link.split.value");0===h&&(e=!e)}var i;0===f.size()?xd.isTargetPriority(e,b,c)?(i={x:c.x+c.width/2,y:c.y+c.height/2},f.add(xd.rectanglePerimeter(b,!0,i)),f.add(xd.rectanglePerimeter(c,!1,f.get(f.size()-1)))):(i={x:b.x+b.width/2,y:b.y+b.height/2},i=xd.rectanglePerimeter(c,!1,i),f.add(xd.rectanglePerimeter(b,!0,i)),f.add(i)):(i=f.get(0),f.add(xd.rectanglePerimeter(b,!0,i),0),f.add(xd.rectanglePerimeter(c,!1,f.get(f.size()-1))));var j=f.size();if(2>j)return f;for(var k=f.get(0),l=1;j-1>l;l++){var m=f.get(l);m.x===k.x&&m.y===k.y&&(f.remove(m),j--,l--),k=m}return f},isHorizontal:function(a,b,c){if(a){if("flexional.horizontal"===a||"orthogonal.horizontal"===a||"orthogonal.H.V"===a||"extend.left"===a||"extend.right"===a)return!0;if("flexional.vertical"===a||"orthogonal.vertical"===a||"orthogonal.V.H"===a||"extend.top"===a||"extend.bottom"===a)return!1}var d=xd.calculateXGap(b,c),e=xd.calculateYGap(b,c);return d>=e},flexional:function(a,b,c,d,e){a?xd.flexionalHorizontal(b,c,d,e):xd.flexionalVertical(b,c,d,e)},isSplitByPercent:function(a,b){return b.getStyle("link.split.by.percent")},isExtendTypeLink:function(a){return a&&("extend.top"===a||"extend.left"===a||"extend.bottom"===a||"extend.right"===a)},isFlexionalTypeLink:function(a){return a&&("flexional"===a||"flexional.horizontal"===a||"flexional.vertical"===a)},calculateControlPoint:function(a,b,c,d,e){if("orthogonal.H.V"===a||"orthogonal.V.H"===a)return{x:d.x+d.width/2,y:d.y+d.height/2};var f;if(xd.isExtendTypeLink(a)){var g=Math.min(c.y,d.y),h=Math.min(c.x,d.x),i=Math.max(c.y+c.height,d.y+d.height),j=Math.max(c.x+c.width,d.x+d.width);if(f=e.getStyle("link.extend"),"extend.top"===a)return{x:(h+j)/2,y:g-f};if("extend.left"===a)return{x:h-f,y:(g+i)/2};if("extend.bottom"===a)return{x:(h+j)/2,y:i+f};if("extend.right"===a)return{x:j+f,y:(g+i)/2}}var k=xd.isSplitByPercent(a,e);if(f=k?xd.calculateSplitValueByPercent(a,b,c,d,e.getStyle("link.split.percent")):e.getStyle("link.split.value"),f===Number.NEGATIVE_INFINITY||f===Number.POSITIVE_INFINITY)return{x:d.x+d.width/2,y:d.y+d.height/2};if(0===f)return{x:c.x+c.width/2,y:c.y+c.height/2};if(b){var l=c.x+c.x+c.width<d.x+d.x+d.width;return{x:xd.calculateSplitLocation(l,f,c.x,c.width),y:c.y+c.height/2}}var m=c.y+c.y+c.height<d.y+d.y+d.height;return{x:c.x+c.width/2,y:xd.calculateSplitLocation(m,f,c.y,c.height)}},calculateGap:function(a,b,c,d){var e=Math.max(b,d)-Math.min(a,c);return e-(b-a+d-c)},calculateXGap:function(a,b){var c=Math.max(a.x+a.width,b.x+b.width)-Math.min(a.x,b.x);return c-a.width-b.width},calculateYGap:function(a,b){var c=Math.max(a.y+a.height,b.y+b.height)-Math.min(a.y,b.y);return c-a.height-b.height},calculateSplitValueByPercent:function(a,b,c,d,e){var f=xd.calculateSplitGapByPercent(e,b,c,d);return f*e},calculateSplitGapByPercent:function(a,b,c,d){return b?xd._calculateSplitGapByPercent(a,c.x,c.x+c.width,d.x,d.x+d.width):xd._calculateSplitGapByPercent(a,c.y,c.y+c.height,d.y,d.y+d.height)},_calculateSplitGapByPercent:function(a,b,c,d,e){var f=xd.calculateGap(b,c,d,e),g=d+e>b+c;if(f>0){if(1===a)return f+(e-d)/2;if(a>=0&&1>a)return f;if(0>a)return g?d-b:c-e}return Math.abs(g&&a>0||!g&&0>a?c-e:b-d)},calculateSplitPercentByControlPoint:function(a,b,c,d){return b?xd.calculateSplitPercent(a.x,c.x,c.x+c.width,d.x,d.x+d.width):xd.calculateSplitPercent(a.y,c.y,c.y+c.height,d.y,d.y+d.height)},calculateSplitPercent:function(a,b,c,d,e){if(a>=b&&c>=a)return 0;var f=xd.calculateGap(b,c,d,e);if(f>0&&a>=d&&e>=a)return 1;var g=d+e>b+c;if(f>0){if(a>Math.min(c,e)&&a<Math.max(b,d))return Math.abs(a-(g?c:b))/f;if(g){if(b>a)return(a-b)/(d-b)}else if(a>c)return(c-a)/(c-e)}return a>c?(g?a-c:c-a)/Math.abs(c-e):(g?a-b:b-a)/Math.abs(b-d)},calculateSplitLocation:function(a,b,c,d){return a===b>0?c+d+Math.abs(b):c-Math.abs(b)},calculateAngle:function(a,b){if(0!==a&&0!==b)return Math.atan2(a,b);if(0===a){if(b>0)return 0;if(0>b)return Math.PI}return a>0?Math.PI/2:-Math.PI/2},drawCorner:function(a,b){var c=a.size();if(!(3>c)){var d=b.getStyle("link.corner");if("none"!==d){for(var e,f,g,h,i=b.getStyle("link.xradius"),j=b.getStyle("link.yradius"),k=a.get(0),l=a.get(1),m=2;c>m;m++){var n=a.get(m),o=l.x-k.x,p=l.y-k.y,q=n.x-l.x,r=n.y-l.y,s=0===p;if(0===o&&0===r||0===p&&0===q)if(s?(e=Math.min(2===m?Math.abs(o):Math.abs(o)/2,i),f=Math.min(m===c-1?Math.abs(r):Math.abs(r)/2,j),g={x:l.x-(o>0?e:-e),y:l.y},h={x:l.x,y:l.y+(r>0?f:-f)}):(e=Math.min(m===c-1?Math.abs(q):Math.abs(q)/2,i),f=Math.min(2===m?Math.abs(p):Math.abs(p)/2,j),g={x:l.x,y:l.y-(p>0?f:-f)},h={x:l.x+(q>0?e:-e),y:l.y}),a.remove(l),m--,c--,(g.x!==k.x||g.y!==k.y)&&(a.add(g,m),m++,c++),"bevel"===d)a.add(h,m),m++,c++;else if("round"===d){var t=new me;t.add(l),t.add(h),a.add(t,m),m++,c++}k=l,l=n}h&&h.x===l.x&&h.y===l.y&&a.remove(l)}}},orthogonal:function(a,b,c,d,e,f){var g=f.getStyle("link.control.point"),h=null==g;if(g){var i=Tc.unionRect(b,c);Tc.containsPoint(i,g)||(e=xd.calculateIsHorizontalByControlPoint(g.x,g.y,i.y,i.x,i.y+i.height,i.x+i.width))}else g=xd.calculateControlPoint(a,e,b,c,f);e?xd.sideToSide(b,c,g,d,h):xd.topToBottom(b,c,g,d,h)},calculateIsHorizontalByControlPoint:function(a,b,c,d,e,f){return c>b&&c-b>d-a&&c-b>a-f||b>e&&b-e>d-a&&b-e>a-f?!1:!0},contains:function(a,b,c){return b>=a.x&&b<=a.x+a.width&&c>=a.y&&c<=a.y+a.height},topToBottom:function(a,b,c,d,e){var f=Math.max(a.y,b.y),g=Math.min(a.y+a.height,b.y+b.height),h=c?c.y:g+(f-g)/2,i=a.x+a.width/2,j=b.x+b.width/2;if(!e&&c&&(c.x>=a.x&&c.x<=a.x+a.width&&(i=c.x),c.x>=b.x&&c.x<=b.x+b.width&&(j=c.x)),xd.contains(b,i,h)||xd.contains(a,i,h)||d.add({x:i,y:h}),xd.contains(b,j,h)||xd.contains(a,j,h)||d.add({x:j,y:h}),0===d.size())if(c)xd.contains(b,c.x,h)||xd.contains(a,c.x,h)||d.add({x:c.x,y:h});else{var k=Math.max(a.x,b.x),l=Math.min(a.x+a.width,b.x+b.width);d.add({x:k+(l-k)/2,y:h})}},sideToSide:function(a,b,c,d,e){var f=Math.max(a.x,b.x),g=Math.min(a.x+a.width,b.x+b.width),h=c?c.x:g+(f-g)/2,i=a.y+a.height/2,j=b.y+b.height/2;if(!e&&c&&(c.y>=a.y&&c.y<=a.y+a.height&&(i=c.y),c.y>=b.y&&c.y<=b.y+b.height&&(j=c.y)),xd.contains(b,h,i)||xd.contains(a,h,i)||d.add({x:h,y:i}),xd.contains(b,h,j)||xd.contains(a,h,j)||d.add({x:h,y:j}),0===d.size())if(c)xd.contains(b,h,c.y)||xd.contains(a,h,c.y)||d.add({x:h,y:c.y});else{var k=Math.max(a.y,b.y),l=Math.min(a.y+a.height,b.y+b.height);d.add({x:h,y:k+(l-k)/2})}},flexionalHorizontal:function(a,b,c,d){var e=b.x+b.width<a.x,f=a.x+a.width<b.x,g=e?a.x:a.x+a.width,h=a.y+a.height/2,i=f?b.x:b.x+b.width,j=b.y+b.height/2,k=d,l=e?-k:k,m={x:g+l,y:h};l=f?-k:k;var n={x:i+l,y:j};if(e===f){var o=e?Math.min(g,i)-d:Math.max(g,i)+d;c.add({x:o,y:h}),c.add({x:o,y:j})}else if(m.x<n.x===e){var p=h+(j-h)/2;c.add(m),c.add({x:m.x,y:p}),c.add({x:n.x,y:p}),c.add(n)}else c.add(m),c.add(n)},flexionalVertical:function(a,b,c,d){var e=b.y+b.height<a.y,f=a.y+a.height<b.y,g=a.x+a.width/2,h=e?a.y:a.y+a.height,i=b.x+b.width/2,j=f?b.y:b.y+b.height,k=d,l=e?-k:k,m={x:g,y:h+l};l=f?-k:k;var n={x:i,y:j+l};if(e===f){var o=e?Math.min(h,j)-d:Math.max(h,j)+d;c.add({x:g,y:o}),c.add({x:i,y:o})}else if(m.y<n.y===e){var p=g+(i-g)/2;c.add(m),c.add({x:p,y:m.y}),c.add({x:p,y:n.y}),c.add(n)}else c.add(m),c.add(n)},rectanglePerimeter:function(a,b,c){var d=a.x+a.width/2,e=a.y+a.height/2,f=c.x-d,g=c.y-e,h=Math.atan2(g,f),i={x:0,y:0},j=Math.PI,k=Math.PI/2,l=k-h,m=Math.atan2(a.height,a.width);return-j+m>h||h>j-m?(i.x=a.x,i.y=e-a.width*Math.tan(h)/2):-m>h?(i.y=a.y,i.x=d-a.height*Math.tan(l)/2):m>h?(i.x=a.x+a.width,i.y=e+a.width*Math.tan(h)/2):(i.y=a.y+a.height,i.x=d+a.height*Math.tan(l)/2),c.x>=a.x&&c.x<=a.x+a.width?i.x=c.x:c.y>=a.y&&c.y<=a.y+a.height&&(i.y=c.y),c.x<a.x?i.x=a.x:c.x>a.x+a.width&&(i.x=a.x+a.width),c.y<a.y?i.y=a.y:c.y>a.y+a.height&&(i.y=a.y+a.height),i
},isSplitTypeLink:function(a){return a&&("orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.vertical"===a)},isOrthogonalOrFlexionalLink:function(a){if(a instanceof Ic.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return xd.isOrthogonalOrFlexionalType(b)},isOrthogonalLink:function(a){if(a instanceof Ic.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return xd.isOrthogonalType(b)},isOrthogonalOrFlexionalType:function(a){return"orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.H.V"===a||"orthogonal.vertical"===a||"orthogonal.V.H"===a||"extend.top"===a||"extend.left"===a||"extend.bottom"===a||"extend.right"===a||"flexional"===a||"flexional.horizontal"===a||"flexional.vertical"===a},isOrthogonalType:function(a){return"orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.H.V"===a||"orthogonal.vertical"===a||"orthogonal.V.H"===a||"extend.top"===a||"extend.left"===a||"extend.bottom"===a||"extend.right"===a},hasControlPoint:function(a){return"orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.vertical"===a||"extend.bottom"===a||"extend.left"===a||"extend.right"===a||"extend.top"===a},getControlPoint:function(a,b,c){if(!a)throw"link can't be null";var d=a.getStyle("link.type");if(!xd.hasControlPoint(d))return null;var e=a.getStyle("link.control.point");if(e)return e;var f,g;if(null==b?(f=a.getFromAgent().getRect(),g=a.getToAgent().getRect()):(f=xd.getLinkSourceBounds(b,c),g=xd.getLinkTargetBounds(b,c)),null==f||null==g)return null;var h=xd.isHorizontal(d,f,g,a);return xd.calculateControlPoint(a.getStyle("link.type"),h,f,g,a)},getSplitValueByControlPoint:function(a,b,c,d,e){if("extend.top"===b)return Math.min(c.y,d.y)-a.y;if("extend.left"===b)return Math.min(c.x,d.x)-a.x;if("extend.bottom"===b)return a.y-Math.max(c.y+c.height,d.y+d.height);if("extend.right"===b)return a.x-Math.max(c.x+c.width,d.x+d.width);var f;if(e){var g=c.x+c.x+c.width<d.x+d.x+d.width;return f=g?a.x-c.x+c.width:c.x-a.x,f>0?f:f>-c.width?0:f+c.width}var h=c.y+c.y+c.height<d.y+d.y+d.height;return f=h?a.y-c.y-c.height:c.y-a.y,f>0?f:f>-c.height?0:f+c.height},isHorizontalByControlPoint:function(a,b,c,d,e){var f=Tc.unionRect(c,d);return Tc.containsPoint(f,a)?xd.isHorizontal(b,c,d,e):xd.calculateIsHorizontalByControlPoint(a.x,a.y,f.y,f.x,f.y+f.height,f.x+f.width)},setParamsByControlPoint:function(a,b,c,d,e){var f=xd.isHorizontalByControlPoint(a,d,b,c,e),g=e.getStyle("link.control.point");if((g||"orthogonal"===d||"orthogonal.horizontal"===d||"orthogonal.vertical"===d)&&e.setStyle("link.type",f?"orthogonal.horizontal":"orthogonal.vertical"),g)return void e.setStyle("link.control.point",a);var h=xd.getSplitValueByControlPoint(a,d,b,c,f);if(xd.isExtendTypeLink(d))return void e.setStyle("link.extend",h);var i=xd.isSplitByPercent(d,e);return i?0===h?void e.setStyle("link.split.percent",0):void e.setStyle("link.split.percent",xd.calculateSplitPercentByControlPoint(a,f,b,c)):void e.setStyle("link.split.value",h)},getLinkNodeBounds:function(a,b,c,d,e,f){if(f){var g=f.getLocationZoom();f.getSizeZoom(a)}if(null==a)return null;var h;if(d)f?(h=a.getZoomBodyRect(),h.x+=b,h.y+=c):(h=a.getBodyRect(),h.x+=b,h.y+=c);else{var i=a.getNetwork().getPosition(e,a,null,b,c);h=f?{x:i.x*g,y:i.y*g,width:1,height:1}:{x:i.x,y:i.y,width:1,height:1}}return h},getLinkSourceBounds:function(a,b){var c=a._element,d=a.getNetwork().getElementUI(c.getFromAgent());if(null==d)return null;var e=c.getStyle("link.from.position"),f=c.getStyle("link.from.xoffset"),g=c.getStyle("link.from.yoffset"),h=c.getStyle("link.from.at.edge");return xd.getLinkNodeBounds(d,f,g,h,e,b)},getLinkTargetBounds:function(a,b){var c=a._element,d=a.getNetwork().getElementUI(c.getToAgent());if(null==d)return null;var e=c.getStyle("link.to.position"),f=c.getStyle("link.to.xoffset"),g=c.getStyle("link.to.yoffset"),h=c.getStyle("link.to.at.edge");return xd.getLinkNodeBounds(d,f,g,h,e,b)},orthogonalAndFlexional:function(a,b,c){var d=xd.getLinkSourceBounds(a,c);if(null==d)return null;var e=xd.getLinkTargetBounds(a,c);if(null==e)return null;var f=xd.calculateOrthogonalAndFlexionalLinkPoints(b,d,e,a._element);return xd.offsetLink(a,f),a.setHotSpot(xd.calculateCenterPoint(f)),"flexional"!==b&&xd.drawCorner(f,a._element),f},offsetLink:function(a,b){var c=a._element,d=c.isBundleAgent();if(!d){var e=xd.getBundleGap(a,!1);if(0!==e)for(var f,g,h=!1,i=!1,j=b.get(0),k=Jc.clone(j),l=1,m=b.size();m>l;l++){var n=b.get(l),o=n.x-k.x,p=n.y-k.y;k=Jc.clone(n),g=xd.calculateAngle(o,p),0===o?((g-f)%Math.PI===0&&(g-f)%(2*Math.PI)!==0&&(h=!h,h&&(p=-p)),(g-f)%Math.PI!==0&&(j.x+=0>p?e:-e),n.x+=0>p?e:-e):0===p&&((g-f)%Math.PI===0&&(g-f)%(2*Math.PI)!==0&&(i=!i,i&&(o=-o)),f&&(g-f)%Math.PI===0||(j.y-=0>o?e:-e),n.y-=0>o?e:-e),f=g,j=n}}},_getPointAngleDegree:function(a,b,c,d){var e=c-a,f=d-b,g=Math.atan2(f,e);return g=g/Math.PI*180,g=parseInt(g)+180,g%=360}};Jc.link=xd;var yd={findMoveToBottomDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),yd.findMoveToBottomDatas(a,b,e.getChildren())},findMoveToTopDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(c.size()-1-d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),yd.findMoveToTopDatas(a,b,e.getChildren())},findMoveUpDatas:function(a,b,c){for(var d=!1,e=0;e<c.size();e++){var f=c.get(e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),yd.findMoveUpDatas(a,b,f.getChildren())},findMoveDownDatas:function(a,b,c){for(var d=!1,e=0;e<c.size();e++){var f=c.get(c.size()-1-e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),yd.findMoveDownDatas(a,b,f.getChildren())},doLayout:function(a,b){b=b||{},b.type=b.type||"round",b.animate=b.animate||!0,b.elements=b.elements||new Ic.List,b.repulsion=b.repulsion||1,b.expandGroup=b.expandGroup||!1;var c=new Ic.layout.AutoLayouter(a.getElementBox());c.getElements=function(){}}};Jc.box=yd;var zd={scrollLeft:function(){return zd._filterResults(a.pageXOffset?a.pageXOffset:0,Oc.documentElement?Oc.documentElement.scrollLeft:0,Oc.body?Oc.body.scrollLeft:0)},scrollTop:function(){return zd._filterResults(a.pageYOffset?a.pageYOffset:0,Oc.documentElement?Oc.documentElement.scrollTop:0,Oc.body?Oc.body.scrollTop:0)},_filterResults:function(a,b,c){var d=a?a:0;return b&&(!d||d>b)&&(d=b),c&&(!d||d>c)?c:d},isSingleTouch:function(a){return a.touches&&1==a.touches.length},isMultiTouch:function(a){return a.touches&&a.touches.length>1},getDistance:function(a){if(!zd.isMultiTouch(a))return 0;var b=a.touches[0],c=a.touches[1];return Math.sqrt(Math.pow(b.clientX-c.clientX,2)+Math.pow(b.clientY-c.clientY,2))}};Jc.touch=zd;var Ad={_string:function(a,b,c,d){var e=c._stringPool.get();e.style.whiteSpace="nowrap",e.style.verticalAlign="middle",e.style.padding="0px 2px",Jc.setText(e,a,d),e.setAttribute("title",a),b.appendChild(e)},_boolean:function(a,b,c){var d=c._booleanPool.get();b._editInfo?(d._editInfo=b._editInfo,delete b._editInfo,d.disabled=!1):d.disabled=!0,d.keepDefault=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d.checked=a,b.appendChild(d),""===b.style.textAlign&&(b.style.textAlign="center")},_color:function(a,b,c){var d=c._colorPool.get();d.style.width="100%",d.style.height="100%",d.style.backgroundColor=a,d.setAttribute("title",a),b.appendChild(d)},render:function(a,b,c,d,e){if(null!=b){var f=Ad["_"+a];f?f(b,c,d,e):"boolean"==typeof b?Ad._boolean(b,c,d,e):Ad._string(b,c,d,e)}}};Jc.render=Ad;var Bd={toolTipDiv:null,getToolTipDiv:function(){if(!Bd.toolTipDiv){Bd.toolTipDiv=Oc.createElement("div");var a=Ce,b=Bd.toolTipDiv.style;b.position="absolute",b.color=a.TOOLTIP_COLOR,b.background=a.TOOLTIP_BACKGROUND,b.fontSize=a.TOOLTIP_FONT_SIZE,b.padding=a.TOOLTIP_PADDING,b.border=a.TOOLTIP_BORDER,b.borderRadius=a.TOOLTIP_BORDER_RADIUS,b.boxShadow=a.TOOLTIP_BOX_SHADOW,b.zIndex=a.TOOLTIP_ZINDEX,b.setProperty&&b.setProperty("-webkit-box-shadow",a.TOOLTIP_BOX_SHADOW,null)}return Bd.toolTipDiv},isToolTipVisible:function(){return Bd.getToolTipDiv().parentNode?!0:!1},hideToolTip:function(){if(Bd._clearTimeout(),Bd._clearDismiss(),Bd.isToolTipVisible()){var a=Bd.getToolTipDiv();a.parentNode&&a.parentNode.removeChild(a)}},showToolTip:function(a,b){return a&&b?void(Bd.isToolTipVisible()||Bd._reshow_timeout?Bd._showToolTip(a,b):(Bd._clearTimeout(),Bd._show_timeout=setTimeout(function(){Bd._showToolTip(a,b)},Ce.TOOLTIP_INITIAL_DELAY))):void Bd.hideToolTip()},_showToolTip:function(a,b){var c,d,e;a.target?(c=a.clientX,d=a.clientY):(c=a.x,d=a.y),e=Bd.getToolTipDiv(),Wc.clear(e),b instanceof Element?e.appendChild(b):e.innerHTML=b,e.style.left=c+Ce.TOOLTIP_XOFFSET+"px",e.style.top=d+Ce.TOOLTIP_YOFFSET+"px",e.parentNode||Oc.body.appendChild(e),Bd._clearDismiss(),Bd._dismiss_timeout=setTimeout(Bd.hideToolTip,Ce.TOOLTIP_DISMISS_DELAY),Bd._clearReshow(),Bd._reshow_timeout=setTimeout(Bd._clearReshow,Ce.TOOLTIP_RESHOW_DELAY)},_clearDismiss:function(){Bd._dismiss_timeout&&(clearTimeout(Bd._dismiss_timeout),Bd._dismiss_timeout=null)},_clearReshow:function(){Bd._reshow_timeout&&(clearTimeout(Bd._reshow_timeout),Bd._reshow_timeout=null)},_clearTimeout:function(){Bd._show_timeout&&(clearTimeout(Bd._show_timeout),Bd._show_timeout=null)},resetToolTip:function(){Bd.hideToolTip(),Bd.toolTipDiv=null}};Jc.popup=Bd;var Cd={handleClicked:function(a,b,c){if(Qc.isTouchable||0===b.button)if(c){var d=Dd(c);d&&d.onClick&&d.onClick(c,a),a.onClickElement(c,b),a.fireInteractionEvent({kind:"clickElement",event:b,element:c})}else a.onClickBackground(b),a.fireInteractionEvent({kind:"clickBackground",event:b})},handleDoubleClicked:function(a,b,c){if((Qc.isTouchable||0===b.button)&&!a.isEditingElement()){if(c){var d=Dd(c);d&&d.onDoubleClick&&d.onDoubleClick(c,a),a.onDoubleClickElement(c,b),a.fireInteractionEvent({kind:"doubleClickElement",event:b,element:c})}else a.onDoubleClickBackground(b),a.fireInteractionEvent({kind:"doubleClickBackground",event:b});c?c instanceof Ic.Link&&a.isDoubleClickToLinkBundle()?c.ISubNetwork&&a.isDoubleClickToSubNetwork()&&!Jc.isCtrlDown(b)?(a.isDoubleClickToEmptySubNetwork()||c.getChildrenSize()>0)&&a.setCurrentSubNetwork(c,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:c})}):c.reverseBundleExpanded()&&a.fireInteractionEvent({kind:"bundleLink",event:b,element:c}):c.ISubNetwork&&a.isDoubleClickToSubNetwork()?(a.isDoubleClickToEmptySubNetwork()||c.getChildrenSize()>0)&&a.setCurrentSubNetwork(c,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:c})}):c instanceof Ke&&a.isDoubleClickToGroupExpand()&&(c.reverseExpanded(),a.fireInteractionEvent({kind:"expandGroup",event:b,element:c})):a.isDoubleClickToUpSubNetwork()&&a.upSubNetwork(a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"upSubNetwork",event:b})})}},handleKeyDown:function(a,b){Jc.isCtrlDown(b)&&65==b.keyCode?(a.isKeyboardSelectEnabled()&&a.selectAll().size()>0&&a.fireInteractionEvent({kind:"selectAll"}),Wc.preventDefault(b)):46==b.keyCode?(a.isKeyboardRemoveEnabled()&&a.removeSelection()&&a.fireInteractionEvent({kind:"removeElement"}),Wc.preventDefault(b)):Jc.showVersion(b)},handleLongClicked:function(a,b,c){if(Qc.isTouchable||0===b.button)if(c){var d=Dd(c);d&&d.onLongClick&&d.onLongClick(c,a),a.onLongClickElement(c,b),a.fireInteractionEvent({kind:"longClickElement",event:b,element:c})}else a.onLongClickBackground(b),a.fireInteractionEvent({kind:"longClickBackground",event:b})}},Dd=function(a){if(a&&a._image){if("object"==typeof a._image)return a._image;var b=Jc.getImageAsset(a._image);if(b)return b._image}return null};Jc.interaction=Cd;var Ed=function(a){return a.trim()[0].match(/[mlhvcsqta]/i)?Kd(a):Gd(a)},Fd={},Gd=function(a){var b=Fd[a];return b?b:(Fd[a]=b=[],a.trim().split(" ").forEach(function(a){a=a.split(","),b.push(2===a.length?{x:parseFloat(a[0]),y:parseFloat(a[1])}:a[0])}),b)},Hd={},Id=/[mlhvcsqtaz][\d.,\-\s]*/gi,Jd=/-?(\d)+(\.(\d)+)?/g,Kd=function(a){var b,c=Hd[a];return c?c:(b=a.trim().match(Id),Hd[a]=c=[],b&&b.forEach(function(a){var b,d=a[0],e=a.match(Jd),f=e&&e.length;if(c.push(a={c:d}),f)switch(e.forEach(function(a,b){e[b]=parseFloat(a)}),d){case"M":case"m":case"L":case"l":for(b=0;f>b;b+=2)0!==b&&c.push(a={c:"M"===d||"L"===d?"L":"l"}),a.x=e[b],a.y=e[b+1];break;case"H":case"h":for(b=0;f>b;b++)0!==b&&c.push(a={c:d}),a.x=e[b];break;case"V":case"v":for(b=0;f>b;b++)0!==b&&c.push(a={c:d}),a.y=e[b];break;case"C":case"c":for(b=0;f>b;b+=6)0!==b&&c.push(a={c:d}),a.x1=e[b],a.y1=e[b+1],a.x2=e[b+2],a.y2=e[b+3],a.x=e[b+4],a.y=e[b+5];break;case"S":case"s":for(b=0;f>b;b+=4)0!==b&&c.push(a={c:d}),a.x2=e[b],a.y2=e[b+1],a.x=e[b+2],a.y=e[b+3];break;case"Q":case"q":for(b=0;f>b;b+=4)0!==b&&c.push(a={c:d}),a.x1=e[b],a.y1=e[b+1],a.x=e[b+2],a.y=e[b+3];break;case"T":case"t":for(b=0;f>b;b+=2)0!==b&&c.push(a={c:d}),a.x=e[b],a.y=e[b+1]}}),c)},Ld=function(a,b){var c,d,e,f,g,h;return"linear"===a.type?c=b.createLinearGradient(a.x1||0,a.y1||0,a.x2||0,a.y2||0):"radial"===a.type&&(d=a.fx||0,e=a.fy||0,f=a.cx||0,g=a.cy||0,h=a.r||0,null==a.fx&&(d=f),null==a.fy&&(e=g),c=b.createRadialGradient(d,e,0,f,g,h)),c&&a.stop&&a.stop.length&&a.stop.forEach(function(a){c.addColorStop(parseFloat(a.offset),se(a.color,b._color))}),c},Md=function(a){return a.replace(/[\s\r\t\n]+/gm," ").trim().replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/).map(function(a){return a.replace(")","").trim().split(/\s*\(\s*|\s+,?\s*|,\s*/).map(function(a,b){return 0===b?a:parseFloat(a)})})},Nd=function(a,b,c,d,e,f,g){var h,i,j,k,l=1;"object"!=typeof b&&(i=b,h=Jc.images[b],b=h&&h.getImage()),ce(b)?a.drawImage(h?h.getImage(c):b,Math.round(d.x),Math.round(d.y),d.width,d.height):b&&"object"==typeof b&&(a._data=e,a._view=f,i?(j=d.width/(b.w&&Yd(e,b,b,"w")||e.getWidth()),k=d.height/(b.h&&Yd(e,b,b,"h")||e.getHeight()),f&&(l=f.getSizeZoom?f.getSizeZoom()*f.getGraphicsZoom():f.getZoom()),!h._cache||Math.max(j*l,k*l)>1?Od(a,b,c,d,e,f,g):a.drawImage(c?h.getImage(c):h._cache,Math.round(d.x),Math.round(d.y),d.width,d.height)):Od(a,b,c,d,e,f,g),a._data=null,a._view=null)},Od=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=e&&e.getStyle("image.state");for(p=a._vector,w=a._color,q=a._fill,r=a._pattern,s=a._lineWidth,t=a._alpha,u=a._sx,v=a._sy,m=b,a._color=c,h=Yd(e,m,m,"v",f),i=h&&h.length,y=m.w&&Yd(e,m,m,"w")||e.getWidth(),z=m.h&&Yd(e,m,m,"h")||e.getHeight(),n=d.width/y,o=d.height/z,g===!0?(a._fill=null,a._pattern=null,a._lineWidth=null,a._alpha=null):(a._sx=n,a._sy=o),a.save(),a.translate(d.x+d.width/2,d.y+d.height/2),(1!==n||1!==o)&&a.scale(n,o),m.origin&&a.translate((m.origin.x-.5)*y,(m.origin.y-.5)*z),a._vector=m,m.clip&&(a.beginPath(),m.clip===!0?a.rect(-(m.origin?m.origin.x:.5)*y,-(m.origin?m.origin.y:.5)*z,y,z):m.clip.length?m.clip.forEach(function(b){a.drawShape(b)}):a.drawShape(m.clip),a.clip()),Td(e,m,m,a,f),j=0,i=h.length;i>j;j++)l=h[j],a._shapeData=l,f&&(f._shapeDataIndex=j,l.animate&&wc(l,m,e,f)),x=Yd(e,m,l,"state",f),Yd(e,m,l,"visible",f)===!1||x&&!(Array.isArray(x)?x.indexOf(A)>=0:x===A)||(k=Qd[l.shape],k&&(a.save(),"vector"===l.shape||"g"===l.shape?k(a,l,e,f):Td(e,m,l,a,f,function(){k(a,l,e,f)}),a.restore())),f&&(f._shapeDataIndex=null),a._shapeData=null;a.restore(),a._vector=p,a._shapeData=null,a._color=w,a._fill=q,a._pattern=r,a._lineWidth=s,a._alpha=t,a._sx=u,a._sy=v},Pd=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o=a._vector,p=o.origin,q=o.w&&Yd(d,o,o,"w")||d.getWidth(),r=o.h&&Yd(d,o,o,"h")||d.getHeight();if("string"==typeof b?(n=Jc.images[b],n&&(h=n.getWidth(),i=n.getHeight())):(h=b.w&&Yd(d,b,b,"w"),i=b.h&&Yd(d,b,b,"h")),h&&i&&c)for(j=c.w/h*a._sx,k=c.h/i*a._sy,f=c.x-q/2*(a._sx-1),g=c.y-r/2*(a._sy-1),p&&(f-=(p.x-.5)*q*(a._sx-1),g-=(p.y-.5)*r*(a._sy-1)),(1!==a._sx||1!==a._sy)&&(a.scale(1/a._sx,1/a._sy),f+=((p?p.x:.5)*q+c.x)*(a._sx-1),g+=((p?p.x:.5)*r+c.y)*(a._sy-1)),c={x:0,y:0,width:h,height:i},l=0;j>l;l++)for(m=0;k>m;m++)c.x=l*h+f,c.y=m*i+g,Nd(a,b,null,c,d,e,!0)},Qd={line:function(a,b,c,d){var e,f,g,h,i=Yd(c,a._vector,b,"p1",d),j=Yd(c,a._vector,b,"p2",d);i?(e=Zd(i.length?i[0]:i.x,a),f=$d(i.length?i[1]:i.y,a)):(e=Yd(c,a._vector,b,"x1",d,!0),f=Yd(c,a._vector,b,"y1",d,!1)),j?(g=Zd(j.length?j[0]:j.x,a),h=$d(j.length?j[1]:j.y,a)):(g=Yd(c,a._vector,b,"x2",d,!0),h=Yd(c,a._vector,b,"y2",d,!1)),a.moveTo(e,f),a.lineTo(g,h)},rect:function(a,b,c,d){var e,f,g,h,i=Yd(c,a._vector,b,"rect",d),j=Yd(c,a._vector,b,"r",d);i?(Array.isArray(i)?(e=i[0],f=i[1],g=i[2],h=i[3]):(e=i.x,f=i.y,g=i.w,h=i.h),e=Zd(e,a),f=$d(f,a),g=Zd(g,a),h=$d(h,a)):(e=Yd(c,a._vector,b,"x",d,!0),f=Yd(c,a._vector,b,"y",d,!1),g=Yd(c,a._vector,b,"w",d,!0),h=Yd(c,a._vector,b,"h",d,!1)),a.drawRoundRect(e,f,g,h,j),(a._gradientFunc||a._pattern)&&(a._rect={x:e,y:f,w:g,h:h})},circle:function(a,b,c,d){var e=Yd(c,a._vector,b,"cx",d,!0),f=Yd(c,a._vector,b,"cy",d,!1),g=a._vector.w&&Yd(c,a._vector,a._vector,"w")||c.getWidth(),h=a._vector.h&&Yd(c,a._vector,a._vector,"h")||c.getHeight(),i=_d(Yd(c,a._vector,b,"r",d),Math.min(g,h),b,a._vector),j=Yd(c,a._vector,b,"startAngle",d),k=Yd(c,a._vector,b,"endAngle",d),l=Yd(c,a._vector,b,"anticlockwise",d),m=Yd(c,a._vector,b,"close",d);null==j&&(j=0),null==k&&(k=360),null==l&&(l=!1),m&&a.moveTo(e,f),a.arc(e,f,i,j/180*Math.PI,k/180*Math.PI,l),m&&a.closePath(),(a._gradientFunc||a._pattern)&&(a._rect={x:e-i,y:f-i,w:2*i,h:2*i})},ellipse:function(a,b,c,d){var e=Yd(c,a._vector,b,"cx",d,!0),f=Yd(c,a._vector,b,"cy",d,!1),g=Yd(c,a._vector,b,"rx",d,!0),h=Yd(c,a._vector,b,"ry",d,!1),i=Yd(c,a._vector,b,"startAngle",d),j=Yd(c,a._vector,b,"endAngle",d),k=Yd(c,a._vector,b,"anticlockwise",d),l=Yd(c,a._vector,b,"close",d);null==i&&(i=0),null==j&&(j=360),null==k&&(k=!1),l&&a.moveTo(e,f),a.ellipse(e,f,g,h,0,i/180*Math.PI,j/180*Math.PI,k),l&&a.closePath(),(a._gradientFunc||a._pattern)&&(a._rect={x:e-g,y:f-h,w:2*g,h:2*h})},path:function(a,b,c,d){var e=Yd(c,a._vector,b,"data",d);a.drawPath(e)},text:function(a,b,c,d){var e=Yd(c,a._vector,b,"text",d),f=Yd(c,a._vector,b,"x",d,!0),g=Yd(c,a._vector,b,"y",d,!1),h=Yd(c,a._vector,b,"w",d,!1);if(null!=e){e=String(e);var i=e.split("\n"),j=2*a.measureText("e").width,k=vc(a,e,h);g-=(k.h/j-1)/2*j,i.forEach(function(b){if(h){var c,d,e,i,k,l=b.split(" "),m=l.length,n="";for(e=0;m>e;e++)if(c=l[e]+(e===m-1?"":" "),d=n+c,i=a.measureText(d).width,h>i)n=d;else if(i==h)a.fillText(n,f,g),n="",g+=j;else{for(k=0;k<c.length;k++)if(d=n+c.substr(0,k+1),a.measureText(d).width>h){a.fillText(d.substring(0,d.length-1),f,g),n=c.substring(k,c.length),g+=j;break}for(;n.length>0&&a.measureText(n).width>h;)for(k=0;k<n.length;k++)if(d=n.substr(0,k+1),a.measureText(d).width>h){a.fillText(n.substr(0,k),f,g),n=n.substring(k,n.length),g+=j;break}}a.fillText(n,f,g)}else a.fillText(b,f,g);g+=j})}},draw:function(a,b,c,d){var e,f,g=b.draw;"string"==typeof g&&((e=g.match(Wd))?(f="with(data) { "+e[1]+" }",g=new Function("g","data","view",f)):g=de[g]),"function"==typeof g&&g.call(a._vector,a,c,d)},vector:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r=a._vector,s=Yd(c,r,b,"name",d),t=Yd(c,r,b,"x",d,!0),u=Yd(c,r,b,"y",d,!1),v=Yd(c,r,b,"w",d),w=Yd(c,r,b,"h",d);if("string"==typeof s?(l=Jc.images[s],k=l&&l._image):k=s,k)if(ce(k))null!=v&&null!=w?a.drawImage(k,t,u,Zd(v,a),$d(w,a)):a.drawImage(k,t,u);else{for(m=Yd(c,k,k,"v",d),n=m&&m.length,o=k.w&&Yd(c,k,k,"w"),p=k.h&&Yd(c,k,k,"h"),null!=v&&null!=w?(v=Zd(v,a),w=$d(w,a)):(v=o,w=p),a.save(),h=a._lineWidth,i=a._fill,j=a._alpha,Td(c,k,k,a,d),Td(c,r,b,a,d),a.translate(t,u),a.scale(v/o,w/p),k.origin&&a.translate((k.origin.x-.5)*o,(k.origin.y-.5)*p),k.clip&&(a.beginPath(),k.clip===!0?a.rect(-(k.origin?k.origin.x:.5)*o,-(k.origin?k.origin.y:.5)*p,o,p):k.clip.length?k.clip.forEach(function(b){a.drawShape(b)}):a.drawShape(k.clip),a.clip()),q=a._shapeData,a._vector=k,e=0;n>e;e++)f=m[e],a._shapeData=f,d&&(d._shapeDataIndex.length?d._shapeDataIndex.push(e):d._shapeDataIndex=[d._shapeDataIndex,e],f.animate&&wc(f,r,c,d)),Yd(c,k,f,"visible",d)!==!1&&(g=Qd[f.shape],g&&(a.save(),"vector"===f.shape||"g"===f.shape?g(a,f,c,d):Td(c,k,f,a,d,function(){g(a,f,c,d)}),a.restore())),d&&d._shapeDataIndex.pop();a._vector=r,a._shapeData=q,a._lineWidth=h,a._fill=i,a._alpha=j,a.restore()}},g:function(a,b,c,d){var e,f,g,h,i,j=Yd(c,a._vector,b,"v",d);j&&j.length&&(a.save(),f=a._lineWidth,g=a._fill,h=a._alpha,i=a._shapeData,Td(c,a._vector,b,a,d),j.forEach(function(b){Yd(c,a._vector,b,"visible",d)!==!1&&(e=Qd[b.shape],e&&(a.save(),a._shapeData=b,"vector"===b.shape||"g"===b.shape?e(a,b,c,d):Td(c,a._vector,b,a,d,function(){e(a,b,c,d)}),a.restore()))}),a._lineWidth=f,a._fill=g,a._alpha=h,a._shapeData=i,a.restore())}};Qd.image=Qd.vector;var Rd=Object.keys(Qd),Sd={M:function(a,b){return a.moveTo(b.x,b.y),a._path_start=b,a._rect&&be(a._rect,b.x,b.y),b},m:function(a,b,c){return c&&(b={x:c.x+b.x,y:c.y+b.y}),a.moveTo(b.x,b.y),a._path_start=b,a._rect&&be(a._rect,b.x,b.y),b},Z:function(a){return a.closePath(),a._path_start},z:function(a){return a.closePath(),a._path_start},L:function(a,b){return a.lineTo(b.x,b.y),a._rect&&be(a._rect,b.x,b.y),b},l:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y};return a.lineTo(d.x,d.y),a._rect&&be(a._rect,d.x,d.y),d},H:function(a,b,c){var d={x:b.x,y:c.y};return a.lineTo(d.x,d.y),a._rect&&be(a._rect,d.x,d.y),d},h:function(a,b,c){var d={x:c.x+b.x,y:c.y};return a.lineTo(d.x,d.y),a._rect&&be(a._rect,d.x,d.y),d},V:function(a,b,c){var d={x:c.x,y:b.y};return a.lineTo(d.x,d.y),a._rect&&be(a._rect,d.x,d.y),d},v:function(a,b,c){var d={x:c.x,y:c.y+b.y};return a.lineTo(d.x,d.y),a._rect&&be(a._rect,d.x,d.y),d},Q:function(a,b){return a._preQ_x=b.x1,a._preQ_y=b.y1,a.quadraticCurveTo(b.x1,b.y1,b.x,b.y),a._rect&&(be(a._rect,b.x1,b.y1),be(a._rect,b.x,b.y)),b},q:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=a._preQ_x=c.x+b.x1,f=a._preQ_y=c.y+b.y1;return a.quadraticCurveTo(e,f,d.x,d.y),a._rect&&(be(a._rect,e,f),be(a._rect,d.x,d.y)),d},T:function(a,b,c){var d=a._preQ_x=2*c.x-a._preQ_x,e=a._preQ_y=2*c.y-a._preQ_y;return a.quadraticCurveTo(d,e,b.x,b.y),a._rect&&(be(a._rect,d,e),be(a._rect,b.x,b.y)),b},t:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=a._preQ_x=2*c.x-a._preQ_x,f=a._preQ_y=2*c.y-a._preQ_y;return a.quadraticCurveTo(e,f,d.x,d.y),a._rect&&(be(a._rect,e,f),be(a._rect,d.x,d.y)),d},C:function(a,b){return a._preC_x=b.x2,a._preC_y=b.y2,a.bezierCurveTo(b.x1,b.y1,b.x2,b.y2,b.x,b.y),a._rect&&(be(a._rect,b.x1,b.y1),be(a._rect,b.x2,b.y2),be(a._rect,b.x,b.y)),b},c:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=c.x+b.x1,f=c.y+b.y1,g=a._preC_x=c.x+b.x2,h=a._preC_y=c.y+b.y2;return a.bezierCurveTo(e,f,g,h,d.x,d.y),a._rect&&(be(a._rect,e,f),be(a._rect,g,h),be(a._rect,d.x,d.y)),d},S:function(a,b,c){var d=2*c.x-a._preC_x,e=2*c.y-a._preC_y;return a._preC_x=b.x2,a._preC_y=b.y2,a.bezierCurveTo(d,e,b.x2,b.y2,b.x,b.y),a._rect&&(be(a._rect,d,e),be(a._rect,b.x2,b.y2),be(a._rect,b.x,b.y)),b},s:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=2*c.x-a._preC_x,f=2*c.y-a._preC_y,g=a._preC_x=c.x+b.x2,h=a._preC_y=c.y+b.y2;return a.bezierCurveTo(e,f,g,h,d.x,d.y),a._rect&&(be(a._rect,e,f),be(a._rect,g,h),be(a._rect,d.x,d.y)),d}},Td=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t=Yd(a,b,c,"line",e),u=Yd(a,b,c,"fill",e),v=Yd(a,b,c,"gradient",e),w=Yd(a,b,c,"gradientColor",e),x=Yd(a,b,c,"pattern",e),y=Yd(a,b,c,"font",e),z=Yd(a,b,c,"textAlign",e)||"center",A=Yd(a,b,c,"textBaseline",e)||"middle",B=Yd(a,b,c,"translate",e),C=Yd(a,b,c,"rotate",e),D=Yd(a,b,c,"rotateOrigin",e),E=Yd(a,b,c,"scale",e),F=Yd(a,b,c,"transform",e),G=Yd(a,b,c,"alpha",e),H=d._lineWidth,I=d._fill,J=d._pattern,K=d._alpha,L=d._gradientFunc;if(t?(g=t.color,h=t.width,i=t.cap,j=t.join,k=t.miterLimit,l=t.dash,m=t.dashOffset):(g=Yd(a,b,c,"lineColor",e),h=Yd(a,b,c,"lineWidth",e),i=Yd(a,b,c,"lineCap",e),j=Yd(a,b,c,"lineJoin",e),k=Yd(a,b,c,"miterLimit",e),l=Yd(a,b,c,"lineDash",e),m=Yd(a,b,c,"lineDashOffset",e)),null!=g&&(d.strokeStyle=se(g,d._color)),null!=h&&(d.lineWidth=d._lineWidth=e&&e.getSizeZoom?h/e.getSizeZoom():h),null!=i&&(d.lineCap=i),null!=j&&(d.lineJoin=j),null!=k&&(d.miterLimit=k),null!=l&&(d.lineDash=l,d.setLineDash(l)),null!=m&&(d.lineDashOffset=m),x?d._pattern=x:(u&&(d.fillStyle=d._fill=se(u,d._color)),v&&("string"==typeof v?o=Zc[v]:(o=Zc[v.type],v.color&&(w=v.color),o||(v=Ld(v,d))),d._gradientFunc=o)),null!=y&&(d.font=y),null!=z&&(d.textAlign=z),null!=A&&(d.textBaseline=A),Ud(a,b,c,d,e),null!=F)"string"==typeof F&&(F=Md(F)),F.length&&F.forEach(function(a){var b=a[0];"matrix"===b?d.transform(a[1],a[2],a[3],a[4],a[5],a[6]):"translate"===b?d.translate(a[1]||0,a[2]||0):"scale"===b?d.scale(a[1]||1,a[2]||a[1]||1):"rotate"===b?a.length>2?(d.translate(a[2],a[3]),d.rotate(a[1]),d.translate(-a[2],-a[3])):d.rotate(a[1]):"skewX"===b?d.transform(1,0,Math.tan(a[1]*Math.PI/180),1,0,0):"skewY"===b&&d.transform(1,Math.tan(a[1]*Math.PI/180),0,1,0,0)});else{if(null!=B&&(Array.isArray(B)?(r=B[0],s=B[1]):"object"==typeof B?(r=B.x,s=B.y):(r=B,s=0),r=Zd(r,d),s=$d(s,d),(0!==r||0!==s)&&d.translate(r,s)),null!=C&&C%360!==0){var M,N;D&&(Array.isArray(D)?(M=D[0],N=D[1]):"object"==typeof D?(M=D.x,N=D.y):M=N=D,M=Zd(M,d),N=$d(N,d),(0!==M||0!==N)&&d.translate(M,N)),d.rotate(C*Math.PI/180),D&&(0!==M||0!==N)&&d.translate(-M,-N)}null!=E&&(Array.isArray(E)?(p=E[0],q=E[1]):"object"==typeof E?(p=E.x,q=E.y):p=q=E,(1!==p||1!==q)&&d.scale(p,q))}null!=G&&(d.globalAlpha=d._alpha=null!=K?K*G:G),f&&(d.beginPath(),f(),n=d._rect||c.rect,d._pattern?(d._lineWidth>0&&d.stroke(),d.clip(),Pd(d,d._pattern,n,a,e)):(o&&n&&(v=o(d,se(u||"#000000",d._color),se(w||"#FFFFFF",d._color),n.x,n.y,n.w,n.h)),v&&(d.fillStyle=d._fill=v),d._fill&&d.fill(),d._lineWidth>0&&d.stroke()),d._lineWidth=H,d._fill=I,d._pattern=J,d._alpha=K,d._gradientFunc=L,d._rect=null)},Ud=function(a,b,c,d,e){var f,g,h,i,j=Yd(a,b,c,"shadow",e);j?(f=j.offsetX,g=j.offsetY,h=j.blur,i=j.color):(f=Yd(a,b,c,"shadowOffsetX",e),g=Yd(a,b,c,"shadowOffsetY",e),h=Yd(a,b,c,"shadowBlur",e),i=Yd(a,b,c,"shadowColor",e)),null!=f&&(d.shadowOffsetX=f),null!=g&&(d.shadowOffsetY=g),null!=h&&(d.shadowBlur=h),null!=i&&(d.shadowColor=i)},Vd=/<%=([\s\S]+?)%>/,Wd=/<%([\s\S]+?)%>/,Xd=new RegExp([Vd.source,Wd.source].join("|")),Yd=function(a,c,d,e,f,g,h){var i,j,k,l,m,n=d[e],o=typeof n;if("string"===o&&(i=n.match(Xd))?(j="with(data) { "+(i[1]?"return "+i[1]:i[2])+" }",k=new Function("data","view",j),n=k.call(c,a,f)):"function"===o&&(n=n.call(c,a,f)),g===!0?(l=c.w&&Yd(a,c,c,"w")||a.getWidth(),(d.rel===!0||d.rel===b&&c.rel)&&1>=n&&n>=-1?n*=l:"string"==typeof n&&(n=parseInt(n)/100*l),n=n||0):g===!1&&(m=c.h&&Yd(a,c,c,"h")||a.getHeight(),(d.rel===!0||d.rel===b&&c.rel)&&1>=n&&n>=-1?n*=m:"string"==typeof n&&(n=parseInt(n)/100*m),n=n||0),h!==!1&&f&&a&&d.animate&&a._animates){var p,q=a._animates,r=f._shapeDataIndex;if(r.length)for(var s=0;s<r.length;s++)p=r[s],q=q[p];else p=r;var t=q[p],u=t[e];if(u)if(Array.isArray(u))for(var s=u.length-1;s>=0;s--){var v=u[s];if((v.stopped||v.time>0)&&v.started)return Ac(v,n)}else if(u.started)return Ac(u,n)}return n},Zd=function(a,c){if(!a)return 0;var d;return(c._shapeData.rel===!0||c._shapeData.rel===b&&c._vector.rel)&&1>=a&&a>=-1?(d=c._vector.w&&Yd(c._data,c._vector,c._vector,"w")||c._data.getWidth(),a*d):"string"==typeof a?parseInt(a)/100*d:a},$d=function(a,c){if(!a)return 0;var d;return(c._shapeData.rel===!0||c._shapeData.rel===b&&c._vector.rel)&&1>=a&&a>=-1?(d=c._vector.h&&Yd(c._data,c._vector,c._vector,"h")||c._data.getHeight(),a*d):"string"==typeof a?parseInt(a)/100*d:a},_d=function(a,c,d,e){return a?(d.rel===!0||d.rel===b&&e.rel)&&1>=a&&a>=-1?a*c:"string"==typeof a?parseInt(a)/100*c:a:0},ae=(a.CanvasRenderingContext2D||Lc.Context2d).prototype;ae.drawShape=function(a){var b=this,c=b._vector,d=b._shapeData,e=b._data,f=b._view,g=Qd[a.shape];g&&(b.save(),b._shapeData=a,"vector"===a.shape||"g"===a.shape?g(b,a,e,f):Td(e,c,a,b,f,function(){g(b,a,e,f)}),b._shapeData=d,b.restore())},ae.drawPath=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=this;if("string"==typeof a&&(a=Ed(a)),j=a?a.length:0,!(1>=j)){if((n._gradientFunc||n._pattern)&&(n._rect=k={x:0,y:0,w:0,h:0}),b=a&&a[0]&&a[0].c,b||(c=a&&a[0]&&null!=a[0].x,d="z"===a[j-1]||"Z"===a[j-1],d&&j--),b){for(e=0;j>e;e++)g=a[e],h=Sd[g.c],h&&(f=h(n,g,f));n._path_start=null,n._preC_x=null,n._preC_y=null,n._preQ_x=null,n._preQ_y=null}else if(c){for(i=a[0],l=Zd(i.x,n),m=$d(i.y,n),n.moveTo(l,m),k&&be(k,l,m),e=1;j>e;e++)i=a[e],l=Zd(i.x,n),m=$d(i.y,n),n.lineTo(l,m),k&&be(k,l,m);d&&n.closePath()}else{for(l=Zd(a[0],n),m=$d(a[1],n),n.moveTo(l,m),k&&be(k,l,m),e=2;j>e;e+=2)l=Zd(a[e],n),m=$d(a[e+1],n),n.lineTo(l,m),k&&be(k,l,m);d&&n.closePath()}return a}};var be=function(a,b,c){var d=Math.min(a.x,b),e=Math.max(a.x+a.w,b),f=Math.min(a.y,c),g=Math.max(a.y+a.h,c);a.x=d,a.y=f,a.w=e-d,a.h=g-f};ae._fillPath=function(a,b){var c=this;c.beginPath(),c.fillStyle=a,c.drawPath(b),c.fill()},ae._fillRect=function(a,b,c,d,e){var f=this;f.beginPath(),f.fillStyle=a,f.rect(b,c,d,e),f.fill()},ae.ellipse||(ae.ellipse=function(a,b,c,d){var e=this,f=.5522848,g=c*f,h=d*f,i=a+c,j=b+d,k=a-c,l=b-d;e.moveTo(k,b),e.bezierCurveTo(k,b-h,a-g,l,a,l),e.bezierCurveTo(a+g,l,i,b-h,i,b),e.bezierCurveTo(i,b+h,a+g,j,a,j),e.bezierCurveTo(a-g,j,k,b+h,k,b)}),ae.drawRoundRect=function(a,b,c,d,e){var f=this;if(!e)return void f.rect(a,b,c,d);var g,h,i,j;if(Array.isArray(e))if(1===e.length)g=h=i=j=e[0];else if(2===e.length)g=h=e[0],i=j=e[1];else{if(4!==e.length)return void f.rect(a,b,c,d);g=e[0],h=e[1],i=e[2],j=e[3]}else g=h=i=j=e;var k=a+c,l=b+d,m=d>c?2*c:2*d;g=m>g?g:m,h=m>h?h:m,i=m>i?i:m,j=m>j?j:m;var n=.292893218813453*j,o=.585786437626905*j;f.moveTo(k,l-j),f.quadraticCurveTo(k,l-o,k-n,l-n),f.quadraticCurveTo(k-o,l,k-j,l),n=.292893218813453*i,o=.585786437626905*i,f.lineTo(a+i,l),f.quadraticCurveTo(a+o,l,a+n,l-n),f.quadraticCurveTo(a,l-o,a,l-i),n=.292893218813453*g,o=.585786437626905*g,f.lineTo(a,b+g),f.quadraticCurveTo(a,b+o,a+n,b+n),f.quadraticCurveTo(a+o,b,a+g,b),n=.292893218813453*h,o=.585786437626905*h,f.lineTo(k-h,b),f.quadraticCurveTo(k-o,b,k-n,b+n),f.quadraticCurveTo(k,b+o,k,b+h),f.lineTo(k,l-j)};var ce=function(a){return Lc?a instanceof Lc||a instanceof Pc:a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement},de={},ee=function(a,b){"function"==typeof b&&(de[a]=b)},fe=function(a,b){"function"==typeof b&&Rd.indexOf(a)<0&&(Qd[a]=b)};!function(){for(var b=["webkit","moz"],c=0;c<b.length&&!a.requestAnimationFrame;++c){var d=b[c];a.requestAnimationFrame=a[d+"RequestAnimationFrame"],a.cancelAnimationFrame=a[d+"CancelAnimationFrame"]||a[d+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(a.navigator.userAgent)||!a.requestAnimationFrame||!a.cancelAnimationFrame){var e=0;a.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(e+16,b);return setTimeout(function(){a(e=c)},c-b)},a.cancelAnimationFrame=clearTimeout}}();var ge=Ic.Animate=function(a){var b=this;b.type=null==a.type?"number":a.type,b.delay=null==a.delay?0:a.delay,b.dur=null==a.dur?1e3:a.dur,b.interval=null==a.interval?0:a.interval,b.finish=null==a.finish?b.delay+b.dur+b.interval:a.finish,b.repeat=null==a.repeat?1:a.repeat,b.reverse=null==a.reverse?!0:a.reverse,b.easing=null==a.easing?"easeNone":a.easing,b.onUpdate=a.onUpdate,b.onDone=a.onDone,b.onStop=a.onStop,b.onPlay=a.onPlay,b.attr=a.attr,b.source=a.source,b.filter=a.filter,b.from=a.from,b.to=a.to,b.start=null,b.time=0,b.total=0,b.count=0,b.started=!1,b.stopped=!1,b.paused=!1,b.pausedTime=null,b.pausedTotal=0,b.id=ie++};Jc.ext("twaver.Animate",Object,{play:function(){return Bc(this)},stop:function(a){return Cc(this,a)},pause:function(){this.stopped||(this.paused=!0)},resume:function(){this.paused&&(this.paused=!1,je=!0)},clone:function(){return new ge(this)},chain:function(a){var b,c=this;return c.onDone?(b=c.onDone,c.onDone=function(){b.call(c),a.play()}):c.onDone=function(){a.play()},c}});var he={},ie=1,je=!1;!function Fg(a){requestAnimationFrame(Fg),je&&(je=!1,Gc(a))}(0);var ke={easeNone:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeBoth:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInStrong:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutStrong:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b
},easeBothStrong:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},elasticIn:function(a,b,c,d,e,f){var g;return 0===a?b:1===(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)},elasticOut:function(a,b,c,d,e,f){var g;return 0===a?b:1===(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},elasticBoth:function(a,b,c,d,e,f){var g;return 0===a?b:2===(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b)},backIn:function(a,c,d,e,f){return f===b&&(f=1.70158),a===e&&(a-=.001),d*(a/=e)*a*((f+1)*a-f)+c},backOut:function(a,b,c,d,e){return"undefined"==typeof e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backBoth:function(a,b,c,d,e){return"undefined"==typeof e&&(e=5.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},bounceIn:function(a,b,c,d){return c-ke.bounceOut(d-a,0,c,d)+b},bounceOut:function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceBoth:function(a,b,c,d){return d/2>a?.5*ke.bounceIn(2*a,0,c,d)+b:.5*ke.bounceOut(2*a-d,0,c,d)+.5*c+b}},le={draw:function(a,b){var c=null==b.getCurrentSubNetwork()?b.getElementBox():b.getCurrentSubNetwork(),d=c.getStyle("background.type");"image"==d?this.drawImage(a,c,b):"vector"==d?this.drawVector(a,c):"image.vector"==d?(this.drawImage(a,c,b),this.drawVector(a,c)):"vector.image"==d&&(this.drawVector(a,c),this.drawImage(a,c,b))},drawImage:function(a,b,c){var d=b.getStyle("background.image"),e=Jc.getImageAsset(d);if(null!=e){var f={x:0,y:0,width:a.canvas.width,height:a.canvas.height};"none"==b.getStyle("background.image.stretch")&&(f.width=e.getWidth(),f.height=e.getHeight());var g=b.getStyle("background.image.padding");if(g&&Tc.grow(f,g,g),"tile"==b.getStyle("background.image.stretch")){if(ce(e.getImage()))for(var h=0;h<f.width;h+=e.getWidth())for(var i=0;i<f.height;i+=e.getHeight())a.drawImage(e.getImage(),h,i)}else("fill"==b.getStyle("background.image.stretch")||"none"==b.getStyle("background.image.stretch"))&&Nd(a,e.getImage(),null,f,b,c)}},drawVector:function(a,b){var c={x:0,y:0,width:a.canvas.width,height:a.canvas.height},d=b.getStyle("background.outline.width"),e=(b.getStyle("background.outline.color"),b.getStyle("background.vector.fill")),f=b.getStyle("background.vector.fill.color"),g=b.getStyle("background.vector.padding"),h=b.getStyle("background.vector.shape"),i=b.getStyle("background.vector.pattern");g&&Tc.grow(c,g,g);var j=b.getStyle("background.vector.gradient");e&&(j?Xc.fill(a,f,j,b.getStyle("background.vector.gradient.color"),c):a.fillStyle=f,Xc.drawVector(a,h,i,c),a.fill()),d>0&&(a.lineWidth=d,a.strokeStyle=b.getStyle("background.outline.color"),Xc.drawVector(a,h,i,c),a.stroke())}};Ic.Pool=function(a,b){this.func="string"==typeof a?function(){return Oc.createElement(a)}:a,this.tagName=a,null!=b&&(this.redundancy=b)},Jc.ext("twaver.Pool",Object,{redundancy:2,currentIndex:-1,get:function(){if(this.currentIndex++,this.currentIndex===this.size()){var a=this.func();return a._pool=this,a.style.margin="0px",a.style.padding="0px",this.list||(this.list=new me),this.list.add(a),a}return this.list.get(this.currentIndex)},release:function(a){this.list&&this.list.remove(a)>=0&&(delete a._selectData,delete a._expandData,delete a._checkData,delete a._editInfo,delete a.keepDefault,a.style.margin="0px",a.style.padding="0px",a.style.backgroundColor="",a.removeAttribute("title"),"img"===this.tagName&&a.removeAttribute&&(a.removeAttribute("width"),a.removeAttribute("height"),a.removeAttribute("src")),this.list.add(a),this.currentIndex--)},reset:function(){this.currentIndex=-1},clear:function(){if(this.list)for(;this.redundancy+this.currentIndex<this.list.size()-1;)delete this.list.removeAt(this.list.size()-1)._pool},size:function(){return this.list?this.list.size():0}}),Ic.Util={getVersion:function(){return"5.1.5"},registerImage:function(a,b,c,d,e){Jc.registerImage(a,b,c,d,e)},getRegisteredImageNames:function(){return Jc.getRegisteredImageNames()},unregisterImage:function(a){Jc.unregisterImage(a)},getImageAsset:function(a){return Jc.getImageAsset(a)},validateLicense:function(a){Jc.validateLicense(a)},getLicense:function(){return Kc},isPermissionGIS:function(){return td()},moveElements:function(a,b,c,d,e){if((0!==b||0!==c)&&a&&!a.isEmpty()){var f,g,h=Ic.animate.AnimateManager;h.endAnimate(),a=vd.filterMovingElements(a),d&&(f=new me,g=new me),a.forEach(function(a){a instanceof Je&&(d?(f.add(a),g.add({x:a.getX()+b,y:a.getY()+c})):a.translate(b,c))}),d?h.start(new Ic.animate.AnimateLocation(f,g,e)):e&&e()}},isTypeOf:function(a,b){if(a===b)return!0;for(var c=a.superClass;c;){if(c===b.prototype)return!0;c=c.constructor.superClass}return!1},setFocus:function(a){if(Oc.activeElement!==a){var b,c,d,e=Oc.documentElement,f=Oc.body;e&&(Qc.isIE||Qc.isOpera||e.scrollLeft||e.scrollTop)?(b=e.scrollLeft,c=e.scrollTop,d=e):f&&(b=f.scrollLeft,c=f.scrollTop,d=f),a.focus(),d&&(d.scrollLeft=b,d.scrollTop=c)}},isOpera:Qc.isOpera,isIE:Qc.isIE,isFirefox:Qc.isFirefox,isChrome:Qc.isChrome,isSafari:Qc.isSafari,isIPhone:Qc.isIPhone,isIPod:Qc.isIPod,isIPad:Qc.isIPad,isAndroid:Qc.isAndroid,isWebOS:Qc.isWebOS,isTouchable:Qc.isTouchable,ext:function(a,b,c){Jc.ext(a,b,c)},getValue:function(a,b,c){return Jc.getValue(a,b,c)},setValue:function(a,b,c){Jc.setValue(a,b,c)},grow:function(a,b,c){Tc.grow(a,b,c)},containsPoint:function(){return Tc.containsPoint.apply(null,arguments)},intersects:function(a,b){return Tc.intersects(a,b)},getRect:function(a){return Tc.getRect(a)},unionRect:function(a,b){return Tc.unionRect(a,b)},createDiv:function(){return Wc.createDiv()},createCanvas:function(){return Wc.createCanvas()},setCanvas:function(){return Wc.setCanvas.apply(null,arguments)},drawVector:function(){Xc.drawVector.apply(null,arguments)},fill:function(){Xc.fill.apply(null,arguments)},getClass:function(a){return Jc.getClass(a)},getAllClassNames:function(){var a,b=[];for(a in Jc.classCache)b.push(a);return b},newInstance:function(){return Jc.newInstance.apply(null,arguments)},isDeserializing:function(){return Jc.isDeserializing},addEventListener:function(a,b,c,d){Wc.addEventListener(a,b,c,d)},removeEventListener:function(a,b,c){Wc.removeEventListener(a,b,c)},drawArrow:function(){ne.drawArrow.apply(null,arguments)},calculatePointAngleAlongLine:function(a,b,c,d,e){return Tc.calculatePointInfoAlongLineBySegments(a,b,c,d,e)},getSubNetwork:function(a){return vd.getSubNetwork(a)},transformPoint:function(a,b,c,d){return Tc.transformPoint(a,b,c,d)},getToolTipDiv:function(){return Bd.getToolTipDiv()},showToolTip:function(a,b){Bd.showToolTip(a,b)},hideToolTip:function(){Bd.hideToolTip()},resetToolTip:function(){Bd.resetToolTip()},setCSSStyle:function(a,b,c){Wc.setCSSStyle(a,b,c)},removeCSSStyle:function(a,b){Wc.removeCSSStyle(a,b)},getCSSStyle:function(a,b){return Wc.getCSSStyle(a,b)},toDegrees:function(a){return Tc.toDegrees(a)},toRadians:function(a){return Tc.toDegrees(a)},getRadiansBetweenLines:function(a,b){return Tc.getRadiansBetweenLines(a,b)},getElementsBounds:function(a,b){var c=null;return a.forEach(function(a){if(a.getRect){var d,e;b&&(e=b.getElementUI(a),e&&(d=e.getViewRect())),d||(d=a.getRect()),c=c?Ic.Util.unionRect(c,d):d}}),c},getPointIndex:function(a,b,c){if(c||(c=10),a)for(var d=a.size();d--;d>=0)if(Tc.getDistance(a.get(d),b)<=c)return d;return-1},registerVectorShape:function(a,b){Jc.g["_"+a]=b},rotateCanvas:function(a,b,c){a.translate(b.x+b.width/2,b.y+b.height/2),a.rotate(c*Math.PI/180),a.translate(-(b.x+b.width/2),-(b.y+b.height/2))},registerShape:function(a,b){fe(a,b)},registerDraw:function(a,b){ee(a,b)},getFilterColor:function(a,b){return se(a,b)},registerGifImage:function(a,b){var c=arguments,d=new XMLHttpRequest;d.overrideMimeType("text/plain; charset=x-user-defined"),d.onload=function(){var b=new Ee(d.response),e=new Fe(b);e.doParse();var f=setInterval(function(){if(e.loaded){clearInterval(f),Ic.Util.registerImage(a,e);for(var b=2;b<c.length;b++){var d=c[b];d.invalidateElementUIs&&d.invalidateElementUIs(),d.invalidateDisplay&&d.invalidateDisplay()}}},10)},d.open("POST",b,!0),d.send()},parseVectorData:function(a){return Ed(a)},getSharedLinks:function(a,b){var c=a.getLinks(),d=b.getLinks();if(c&&0!=c.size()&&d&&0!=d.size()){var e=c.size()>d.size()?c:d;return e.toList(function(c){return c.getFromNode()==a&&c.getToNode()==b||c.getFromNode()==b&&c.getToNode()==a})}return null},isSharedLinks:function(a,b){var c=!1,d=a.getLinks(),e=b.getLinks();if(d&&0!=d.size()&&e&&0!=e.size()){var f=d.size()>e.size()?d:e;f.forEach(function(d){return d.getFromNode()==a&&d.getToNode()==b||d.getFromNode()==b&&d.getToNode()==a?(c=!0,!1):!0})}return c},playAnimate:function(a){return Bc(a)},pauseAnimate:function(a){a.pause()},resumeAnimate:function(a){a.resume()},stopAnimate:function(a,b){Cc(a,b)},pauseAllAnimates:function(){Ec()},resumeAllAnimates:function(){Fc()},stopAllAnimates:function(a){Dc(a)}},Jc.ext("twaver.Util",Object,{});var me=function(){if(this._as=[],1===arguments.length){var a=arguments[0];if(a instanceof me&&(a=a._as),a instanceof Array)for(var b=a.length,c=0;b>c;c++)this._as.push(a[c]);else null!=a&&this._as.push(a)}else if(arguments.length>1)for(b=arguments.length,c=0;b>c;c++)this._as.push(arguments[c])};Ic.List=me,Jc.ext("twaver.List",Object,{size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(a,c){return c===b?this._as.push(a):this._as.splice(c,0,a)},addAll:function(a){if(a instanceof me&&(a=a._as),a instanceof Array)for(var b=a.length,c=0;b>c;c++)this._as.push(a[c]);else this._as.push(a)},get:function(a){return this._as[a]},remove:function(a){var b=this._as.indexOf(a);return b>=0&&b<this._as.length&&this.removeAt(b),b},removeAt:function(a){return this._as.splice(a,1)[0]},set:function(a,b){return this._as[a]=b},clear:function(){return this._as.splice(0,this._as.length)},contains:function(a){return this.indexOf(a)>=0},indexOf:function(a){return this._as.indexOf(a)},forEach:function(a,b){for(var c=this._as.length,d=0;c>d;d++){var e=this._as[d];b?a.call(b,e):a(e)}},forEachReverse:function(a,b){for(var c=this._as.length,d=c-1;d>=0;d--){var e=this._as[d];b?a.call(b,e):a(e)}},toArray:function(a,b){if(a){for(var c=[],d=this._as.length,e=0;d>e;e++){var f=this._as[e];b?a.call(b,f)&&c.push(f):a(f)&&c.push(f)}return c}return this._as.concat()},toList:function(a,b){if(a){for(var c=new me,d=this._as.length,e=0;d>e;e++){var f=this._as[e];b?a.call(b,f)&&c.add(f):a(f)&&c.add(f)}return c}return new me(this)},sort:function(a){return a?this._as.sort(a):this._as.sort(),this},toString:function(){return this._as.toString()}});var ne={shapeMap:{},init:function(){ne.register("arrow.standard",ne.createStandardArrow()),ne.register("arrow.delta",ne.createDeltaArrow()),ne.register("arrow.diamond",ne.createDiamondArrow()),ne.register("arrow.short",ne.createShortArrow()),ne.register("arrow.slant",ne.createSlantArrow())},createStandardArrow:function(){var a=new me;return a.add({x:-1,y:-5/9}),a.add({x:-0.75,y:0}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},createDeltaArrow:function(){var a=new me;return a.add({x:-1,y:-5/9}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},createDiamondArrow:function(){var a=new me;return a.add({x:-7/12,y:5/9}),a.add({x:-14/12,y:0}),a.add({x:-7/12,y:-5/9}),a.add({x:0,y:0}),a.add({x:-7/12,y:5/9}),a},createShortArrow:function(){var a=new me;return a.add({x:-8/12,y:6/9}),a.add({x:-5/12,y:0}),a.add({x:-8/12,y:-6/9}),a.add({x:0,y:0}),a.add({x:-8/12,y:6/9}),a},createSlantArrow:function(){var a=new me;return a.add({x:-1,y:-5/9}),a.add({x:-6.5/12,y:0}),a.add({x:-0.75,y:4/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},register:function(a,b){ne.shapeMap[a]=b},getShape:function(a){if(a)return ne.shapeMap[a];throw"shape type can't be null"},getArrowRect:function(a,b,c,d,e,f,g,h){var i=ne.getShape(c);if(!i||i.size()<=0)return null;h&&(f*=h.getLocationZoom(),g*=h.getLocationZoom());var j,k,l,m=Tc.calculatePointInfoAlongLine(a,b,f,g),n=m.point,o=m.angle,p=i._as,q=p.length,r=new me;for(l=new Sc(d,0,0,e,n.x,n.y),j=0;q>j;j++)r.add(l.transform(p[j]));for(l=Tc.createMatrix(o+Math.PI,n.x,n.y),j=0;q>j;j++)k=r.get(j),k instanceof me&&(k=k._as),k instanceof Array?(k[0]=l.transform(k[0]),k[1]=l.transform(k[1])):r.set(j,l.transform(k));return Tc.getLineRect(r)},drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l){i=i||0,j=j||0,k=k||0;var m=k>=0&&l;if(g||m){var n=ne.getShape(f);if(n&&!(n.size()<=0)){var o=Tc.calculatePointInfoAlongLine(d,e,i,j),p=o.point,q=o.angle;g&&(a.fillStyle=h),a.beginPath(),m&&(a.lineWidth=k,a.strokeStyle=l),ne._drawArrow(a,n,q,p,b,c),g&&a.fill(),m&&a.stroke()}}},_drawArrow:function(a,b,c,d,e,f){b=b._as;var g,h,i,j=b.length,k=new me;for(i=new Sc(e,0,0,f,d.x,d.y),g=0;j>g;g++)k.add(i.transform(b[g]));k=k._as,i=Tc.createMatrix(c+Math.PI,d.x,d.y);var l=k[0];for(l=i.transform(l),a.moveTo(l.x,l.y),g=1;j>g;g++)h=k[g],h instanceof me&&(h=h._as),h instanceof Array?(h[0]=i.transform(h[0]),h[1]=i.transform(h[1]),a.quadraticCurveTo(h[0].x,h[0].y,h[1].x,h[1].y)):(h=i.transform(h),a.lineTo(h.x,h.y))},drawLinkArrow:function(a,b,c,d){c.size()<2||(a._element.getStyle("arrow.from")&&ne._drawFromArrow(a,b,c,d),a._element.getStyle("arrow.to")&&ne._drawToArrow(a,b,c,d))},_drawFromArrow:function(a,b,c,d){var e=a._element,f=e.getStyle("arrow.from.fill"),g=e.getStyle("arrow.from.outline.width");if(f||g>=0){var h=e.getStyle("arrow.from.width"),i=e.getStyle("arrow.from.height"),j=e.getStyle("arrow.from.xoffset");if(j>0&&1>j){var k;k=a.getLineLength?a.getLineLength():a._element.getLineLength(),j*=k}else a.getLineLength&&(j+=ne.calculateArrowXOffsetAtEdge(c,a,!0,d));var l=e.getStyle("arrow.from.yoffset"),m=e.getStyle("arrow.from.shape");j=a._network._edgeDetect?0:j,l=a._network._edgeDetect?0:l,d&&(j*=d.getLocationZoom(),l*=d.getLocationZoom()),ne.drawArrow(b,h,i,c,!0,m,f,e.getStyle("arrow.from.color"),j,l,g,e.getStyle("arrow.from.outline.color"))}},_drawToArrow:function(a,b,c,d){var e=a._element,f=e.getStyle("arrow.to.fill"),g=e.getStyle("arrow.to.outline.width");if(f||g>=0){var h=e.getStyle("arrow.to.width"),i=e.getStyle("arrow.to.height"),j=e.getStyle("arrow.to.xoffset");if(j>0&&1>j){var k;k=a.getLineLength?a.getLineLength():a._element.getLineLength(),j*=k}else a.getLineLength&&(j+=ne.calculateArrowXOffsetAtEdge(c,a,!1));var l=e.getStyle("arrow.to.yoffset"),m=e.getStyle("arrow.to.shape");d&&(j*=d.getLocationZoom(),l*=d.getLocationZoom()),j=a._network._edgeDetect?0:j,l=a._network._edgeDetect?0:l,ne.drawArrow(b,h,i,c,!1,m,f,e.getStyle("arrow.to.color"),j,l,g,e.getStyle("arrow.to.outline.color"))}},calculateArrowXOffsetAtEdge:function(a,b,c,d){if(null==a||a.size()<2)return 0;var e=b._element,f=e.getStyle(c?"arrow.from.at.edge":"arrow.to.at.edge");if(!f)return 0;var g=b._network.getElementUI(c?e.getFromAgent():e.getToAgent());if(!g)return 0;if(d)var h=g.getZoomBodyRect();else var h=g._bodyRect;if(null==h)return 0;for(var i=Tc._getPoint(a.get(c?0:a.size()-1)),j=0,k=b.getLineLength();ne._containsByInt(h,Math.floor(i.x),Math.floor(i.y),!1)&&k>j;)i=Tc.calculatePointInfoAlongLine(a,c,j++).point;return j},_containsByInt:function(a,c,d,e){return e=e===b?!0:e,e?c>=Math.floor(a.x)&&c<=Math.floor(a.x+a.width)&&d>=Math.floor(a.y)&&d<=Math.floor(a.y+a.height):c>Math.floor(a.x)&&c<Math.floor(a.x+a.width)&&d>Math.floor(a.y)&&d<Math.floor(a.y+a.height)}};ne.init(),Jc.arrow=ne,Ic.EventDispatcher=function(){},Jc.ext("twaver.EventDispatcher",null,{contains:function(a,b){if(this._ls)for(var c,d=0,e=this._ls.size();e>d;d++)if(c=this._ls.get(d),a===c.l&&b===c.s)return!0;return!1},add:function(a,b,c){var d={l:a,s:b,a:c};this._ls||(this._ls=new me),this._f?(this._addPendings||(this._addPendings=new me),this._addPendings.add(d)):d.a?this._ls.add(d,0):this._ls.add(d)},remove:function(a,b){this._ls&&(this._f?(this._removePendings||(this._removePendings=new me),this._removePendings.add({l:a,s:b})):this._remove(a,b))},_remove:function(a,b){for(var c,d=0,e=this._ls.size();e>d;d++)if(c=this._ls.get(d),c.l===a&&c.s===b)return void this._ls.removeAt(d)},fire:function(a){if(this._ls){var b,c,d=this._ls.size();for(this._f=!0,b=0;d>b;b++)c=this._ls.get(b),c.s?c.l.call(c.s,a):c.l(a);if(this._f=!1,this._removePendings){for(d=this._removePendings.size(),b=0;d>b;b++)c=this._removePendings.get(b),this._remove(c.l,c.s);delete this._removePendings}if(this._addPendings){for(d=this._addPendings.size(),b=0;d>b;b++)c=this._addPendings.get(b),c.a?this._ls.add(c,0):this._ls.add(c);delete this._addPendings}}}}),Ic.ImageAsset=function(a,b,c,d,e){this._name=a,this._width=c,this._height=d,this._svg=e,this._edgeData,"string"==typeof b?this._src=b:"function"==typeof b?this._func=b:ce(b)?this._image=b:"object"==typeof b&&(this._image=b,this._width=b.w||b.width,this._height=b.h||b.height,b.cache!==!1&&ye(b)&&(we(a,b),this._cache=Be(b)))},Jc.ext("twaver.ImageAsset",Object,{getName:function(){return this._name},getSrc:function(){return this._src},isSvg:function(){return this._svg},getImage:function(a,b,c){if(!a||!this._image)return this._image;this._map||(this._map={});var d;d=this._svg&&3===arguments.length?a+","+b+","+c:a;var e=this._map[d];return e?e:(e=te(this._cache||this._image,re(a),this._svg?b:this.getWidth(),this._svg?c:this.getHeight()),this._map[d]=e,e)},getWidth:function(){return this._width},getHeight:function(){return this._height},getFunction:function(){return this._func},_createEdgeData:function(a){var b=300,c=b/a.width;a.height<a.width&&(c=b/a.height);var d=Math.floor(a.width*c),e=Math.floor(a.height*c);this.tempCanvas||(this.tempCanvas=Oc.createElement("canvas"),this.ctx=this.tempCanvas.getContext("2d")),this.tempCanvas.width=d,this.tempCanvas.height=e,this.ctx.clearRect(0,0,d,e),this.ctx.drawImage(a,0,0,d,e);for(var f=this.ctx.getImageData(0,0,d,e),g=!0,h=[],i=0,j=d,k=e;k>i;i++)for(var l=0;j>l;l++){var m=4*(i*j+l),n=this._isTransparentPoint(f.data,m),o=g!=n||!n&&(0==l||l==j-1);if(o){var p=n?1:0;h.push({x:l-p,y:i})}g=n}g=!0;for(var l=0,j=d,k=e;j>l;l++)for(var i=0;k>i;i++){var m=4*(i*j+l),n=this._isTransparentPoint(f.data,m),o=g!=n||!n&&(0==i||i==k-1);if(o){var p=n?1:0;h.push({x:l,y:i-p})}g=n}for(var q=j/2,r=k/2,s=[],t=0;360>t;t++)s.push({x:q,y:r,dist:0});for(var t=0,u=h.length;u>t;t++){var v=h[t],w=this._getPointAngleDegree(v.x,v.y,q,r),x=this._getPointDist(v.x,v.y,q,r);s[w].dist<x&&(s[w]={x:v.x,y:v.y,dist:x})}for(var t=0,u=s.length;u>t;t++){var o=s[t];o.x=o.x/c,o.y=o.y/c,delete o.dist}return s},_isTransparentPoint:function(a,b){return a[b]+a[b+1]+a[b+2]+a[b+3]==0},_getPointAngleDegree:function(a,b,c,d){var e=c-a,f=d-b,g=Math.atan2(f,e);return g=g/Math.PI*180,g=parseInt(g)+180,g%=360},_getPointDist:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)}});var oe={},pe=Wc.createCanvas();pe.width=1,pe.height=1;var qe=pe.getContext("2d"),re=function(a){a=a||"black";var b,c=oe[a];return c||(qe.clearRect(0,0,1,1),qe.fillStyle=a,qe.fillRect(0,0,1,1),b=qe.getImageData(0,0,1,1).data,c=oe[a]={r:b[0],g:b[1],b:b[2],a:b[3]}),c},se=function(a,b){if(!b)return a;b=re(b),a=re(a);var c=.3*a.r+.59*a.g+.11*a.b;return"rgba("+Math.floor(b.r*c/255)+","+Math.floor(b.g*c/255)+","+Math.floor(b.b*c/255)+","+a.a+")"},te=function(a,b,c,d){var e=Wc.createCanvas(c,d),f=e.getContext("2d");f.drawImage(a,0,0,c,d);try{for(var g=f.getImageData(0,0,c,d),h=g.data,i=0,j=h.length;j>i;i+=4){var k=.3*h[i+0]+.59*h[i+1]+.11*h[i+2];h[i+0]=Math.floor(b.r*k/255),h[i+1]=Math.floor(b.g*k/255),h[i+2]=Math.floor(b.b*k/255)}f.putImageData(g,0,0)}catch(l){return a}return e},ue={},ve=function(a,b){if(a){var c=typeof a;"string"===c&&(a.match(Xd)||Jc.images[a]||(ue[a]||(ue[a]=[])).push(b))}},we=function(a,b){b.pattern&&ve(b.pattern,a),b.v&&b.v.forEach(function(b){b.pattern&&ve(b.pattern,a)})},xe=function(a){var b=ue[a];b&&(b.forEach(function(a){var b=Jc.images[a];b._cache=Be(b._image)}),delete ue[a])},ye=function(a){return a.w&&a.h?ze(a):!1},ze=function(a){return!Object.keys(a).some(function(b){if(/^on/.test(b))return!1;var c=a[b],d=Ae(c);return d||"v"!==b||(d=c.some(function(a){if("vector"===a.shape){var b=Jc.images[a.name];if(b&&!b._cache)return!0}var c=Object.keys(a).some(function(b){return"state"===b||"animate"===b?!0:Ae(a[b])});return c?!0:"g"===a.shape&&a.v&&a.v.length?!ze(a):!1})),d})},Ae=function(a){var b=typeof a;return"string"===b&&a.match(Xd)||"function"===b},Be=function(a){var b=Wc.createCanvas(a.w,a.h),c=b.getContext("2d");return Od(c,a,null,{x:0,y:0,width:a.w,height:a.h}),b},Ce={COLORS:["#6495ED","#FFFF00","#00FFFF","#FF0000","#7FFF00","#E0A580","#5FC0CB","#FA00F0","#A1BC50","#FFD700","#4169E1","#E5A5F5","#1E90FF","#696969","#FF6347","#00BFEF","#FFD700","#80E090","#5F9EA0","#A000FF","#7FAF00","#228BA2","#FF00FF","#7FFFD4","#800000","#0000CD","#20B2AA","#D2691E","#6495BD","#DC143C","#F0A8AF","#008B8B","#800080","#B8860B","#4B0082","#00FF00","#FFA500","#FF4500","#FFFF00","#9ACD32","#00008B","#FF1493","#ADFF2F","#4682B4","#00C0B1"],CALL_LATER_DELAY:17,SCROLL_BAR_WIDTH:17,SELECT_COLOR:"#C2CFF1",FOCUS_ON_CLICK:!0,VIEW_POSITION:"absolute",VIEW_FONT_SIZE:"12px",VIEW_FONT_FAMILY:"arial, tahoma, helvetica, sans-serif",TOOLTIP_BACKGROUND:"lightyellow",TOOLTIP_FONT_SIZE:"12px",TOOLTIP_COLOR:"black",TOOLTIP_PADDING:"4px 8px",TOOLTIP_BORDER:"1px solid gray",TOOLTIP_BORDER_RADIUS:"6px",TOOLTIP_XOFFSET:12,TOOLTIP_YOFFSET:12,TOOLTIP_BOX_SHADOW:"0px 0px 3px #AAA",TOOLTIP_ZINDEX:1e5,TOOLTIP_INITIAL_DELAY:750,TOOLTIP_RESHOW_DELAY:500,TOOLTIP_DISMISS_DELAY:4e3,ZOOM_MAX:5,ZOOM_MIN:.1,ZOOM_INCREMENT:1.3,ZOOM_ANIMATE:!0,COLUMN_INNER_TEXT:!0,COLUMN_WIDTH:80,COLUMN_HORIZONTAL_ALIGN:"",COLUMN_PROPERTY_TYPE:"accessor",COLUMN_VALUE_TYPE:"string",COLUMN_EDITABLE:!1,COLUMN_SORTABLE:!0,COLUMN_VISIBLE:!0,COLUMN_RESIZABLE:!0,COLUMN_MOVABLE:!0,COLUMN_RENDER_CELL:null,COLUMN_RENDER_HEADER:null,PROPERTY_INNER_TEXT:!0,PROPERTY_HORIZONTAL_ALIGN:"",PROPERTY_PROPERTY_TYPE:"accessor",PROPERTY_VALUE_TYPE:"string",PROPERTY_EDITABLE:!1,PROPERTY_CATEGORY_NAME:null,PROPERTY_RENDER_NAME:null,PROPERTY_RENDER_VALUE:null,TAB_WIDTH:100,TAB_CLOSABLE:!1,TAB_RESIZABLE:!0,TAB_MOVABLE:!0,TAB_DISABLED:!1,TAB_VISIBLE:!0,ACCORDION_EXPAND_ICON:"expand_icon",ACCORDION_COLLAPSE_ICON:"collapse_icon",ACCORDION_TITLE_HEIGHT:20,ACCORDION_TITLE_BACKGROUND:"#EBEBEB",ACCORDION_BORDER_BOTTOM_COLOR:"lightgray",ACCORDION_ICON_POSITION:"left",TITLEPANE_TITLE_HEIGHT:20,TITLEPANE_TITLE_BACKGROUND:"#DDD",TITLEPANE_TITLE_HORIZONTAL_ALIGN:"left",BORDERPANE_HGAP:0,BORDERPANE_VGAP:0,CHARTPANE_TITLE_HEIGHT:20,CHARTPANE_TITLE_HORIZONTAL_ALIGN:"center",CHARTPANE_LEGEND_ORIENTATION:"bottom",CHARTPANE_LEGEND_WIDTH:80,LEGENDPANE_ICON_WIDTH:10,LEGENDPANE_ICON_HEIGHT:10,LEGENDPANE_ICON_RADIUS:0,LEGENDPANE_ROW_HEIGHT:20,LEGENDPANE_ORIENTATION:"horizontal",LEGENDPANE_HIDDEN_COLOR:"#BABBBC",LEGENDPANE_SELECT_BACKGROUND_COLOR:"#00007D",LEGENDPANE_SELECT_FOREGROUND_COLOR:"#FFFFFF",CHART_TOOLTIP_ENABLED:!0,CHART_SELECT_TOLERANCE:0,CHART_XGAP:6,CHART_YGAP:6,CHART_XZOOM_ENABLED:!0,CHART_YZOOM_ENABLED:!0,CHART_XTRANSLATE_ENABLED:!0,CHART_YTRANSLATE_ENABLED:!0,CHART_DOUBLE_CLICK_TO_RESET:!0,CHART_VALUE_VISIBLE:!0,CHART_VALUE_FONT:null,CHART_BACKGROUND_VISIBLE:!1,CHART_BACKGROUND_FILL:!0,CHART_BACKGROUND_FILL_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_OUTLINE_WIDTH:1,CHART_BACKGROUND_OUTLINE_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_GRADIENT:"linear.north",CHART_BACKGROUND_GRADIENT_COLOR:"#FFFFFF",PIECHART_TYPE:"oval",PIECHART_START_ANGLE:0,PIECHART_SELECT_OFFSET:5,PIECHART_SHADOW_OFFSET:1,PIECHART_SHADOW_COLOR:"#C2CFF1",PIECHART_LINE_RATE:.5,PIECHART_DONUT_RATE:.5,PIECHART_VALUE_POSITION:.5,BARCHART_TYPE:"default",BARCHART_UPPER_LIMIT:null,BARCHART_LOWER_LIMIT:0,BARCHART_XAXIS_LINE_COLOR:"#808080",BARCHART_XAXIS_LINE_WIDTH:1,BARCHART_XAXIS_TEXT_COLOR:"#000000",BARCHART_XAXIS_TEXT_FONT:null,BARCHART_YAXIS_LINE_COLOR:"#808080",BARCHART_YAXIS_LINE_WIDTH:1,BARCHART_YAXIS_TEXT_COLOR:"#000000",BARCHART_YAXIS_TEXT_FONT:null,BARCHART_XSCALE_TEXT_FONT:null,BARCHART_XSCALE_TEXT_COLOR:"#000000",BARCHART_XSCALE_TEXT_ORIENTATION:"horizontal",BARCHART_YSCALE_TEXT_VISIBLE:!0,BARCHART_YSCALE_TEXT_COLOR:"#000000",BARCHART_YSCALE_TEXT_FONT:null,BARCHART_YSCALE_LINE_COLOR:"#808080",BARCHART_YSCALE_LINE_WIDTH:.3,BARCHART_YSCALE_VALUE_GAP:0,BARCHART_YSCALE_PIXEL_GAP:20,BARCHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_INTERRUPTABLE:!0,LINECHART_UPPER_LIMIT:null,LINECHART_LOWER_LIMIT:null,LINECHART_XAXIS_LINE_COLOR:"#808080",LINECHART_XAXIS_LINE_WIDTH:1,LINECHART_XAXIS_TEXT_COLOR:"#000000",LINECHART_XAXIS_TEXT_FONT:null,LINECHART_YAXIS_LINE_COLOR:"#808080",LINECHART_YAXIS_LINE_WIDTH:1,LINECHART_YAXIS_TEXT_COLOR:"#000000",LINECHART_YAXIS_TEXT_FONT:null,LINECHART_XSCALE_TEXT_FONT:null,LINECHART_XSCALE_TEXT_COLOR:"#000000",LINECHART_XSCALE_TEXT_ORIENTATION:"horizontal",LINECHART_XSCALE_LINE_COLOR:"#808080",LINECHART_XSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_TEXT_VISIBLE:!0,LINECHART_YSCALE_TEXT_COLOR:"#000000",LINECHART_YSCALE_TEXT_FONT:null,LINECHART_YSCALE_LINE_COLOR:"#808080",LINECHART_YSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_VALUE_GAP:0,LINECHART_YSCALE_PIXEL_GAP:20,LINECHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_VALUESPANCOUNT:1,BUBBLECHART_UPPER_LIMIT:null,BUBBLECHART_LOWER_LIMIT:null,BUBBLECHART_XAXIS_UPPER_LIMIT:null,BUBBLECHART_XAXIS_LOWER_LIMIT:null,BUBBLECHART_XAXIS_LINE_COLOR:"#808080",BUBBLECHART_XAXIS_LINE_WIDTH:1,BUBBLECHART_XAXIS_TEXT_COLOR:"#000000",BUBBLECHART_XAXIS_TEXT_FONT:null,BUBBLECHART_YAXIS_LINE_COLOR:"#808080",BUBBLECHART_YAXIS_LINE_WIDTH:1,BUBBLECHART_YAXIS_TEXT_COLOR:"#000000",BUBBLECHART_YAXIS_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_COLOR:"#000000",BUBBLECHART_XSCALE_TEXT_ORIENTATION:"horizontal",BUBBLECHART_XSCALE_LINE_COLOR:"#808080",BUBBLECHART_XSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_TEXT_VISIBLE:!0,BUBBLECHART_YSCALE_TEXT_COLOR:"#000000",BUBBLECHART_YSCALE_TEXT_FONT:null,BUBBLECHART_YSCALE_LINE_COLOR:"#808080",BUBBLECHART_YSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_VALUE_GAP:0,BUBBLECHART_YSCALE_PIXEL_GAP:20,BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_SELECT_SHADOW_COLOR:"#000000",BUBBLECHART_SELECT_SHADOW_OFFSET:3,RADARCHART_AXIS_TEXT_FONT:null,RADARCHART_AXIS_TEXT_COLOR:"#000000",RADARCHART_AXIS_TEXT_VISIBLE:!0,RADARCHART_SCALE_TEXT_FONT:null,RADARCHART_SCALE_TEXT_COLOR:"#000000",RADARCHART_SCALE_TEXT_VISIBLE:!0,RADARCHART_AXIS_VISIBLE:!0,RADARCHART_AXIS_LINE_COLOR:"#808080",RADARCHART_AXIS_LINE_WIDTH:3,RADARCHART_AXIS_START_ANGLE:0,RADARCHART_RING_VISIBLE:!0,RADARCHART_RING_TYPE:"line",RADARCHART_RING_LINE_COLOR:"#808080",RADARCHART_RING_LINE_WIDTH:1,RADARCHART_SCALE_COUNT:5,RADARCHART_SCALE_MAXVALUE:1,RADARCHART_SCALE_MINVALUE:0,RADARCHART_ANCHOR_VISIBLE:!0,RADARCHART_AREA_FILL:!0,RADARCHART_AREA_FILL_ALPHA:.2,RADARCHART_AREA_SELECT_FILL_ALPHA:.5,DIALCHART_UPPER_LIMIT:100,DIALCHART_LOWER_LIMIT:0,DIALCHART_START_ANGLE:0,DIALCHART_END_ANGLE:360,DIALCHART_INNER_RADIUS:.8,DIALCHART_COLOR_RANGE_FILL_COLOR:"#808080",DIALCHART_OUTLINE_WIDTH:0,DIALCHART_OUTLINE_COLOR:"#808080",DIALCHART_SCALE_INSIDE:!0,DIALCHART_MAJOR_SCALE_COUNT:11,DIALCHART_MAJOR_SCALE_LINE_WIDTH:2,DIALCHART_MAJOR_SCALE_LINE_LENGTH:8,DIALCHART_MAJOR_SCALE_LINE_COLOR:"#000000",DIALCHART_MINOR_SCALE_COUNT:4,DIALCHART_MINOR_SCALE_LINE_WIDTH:1,DIALCHART_MINOR_SCALE_LINE_LENGTH:4,DIALCHART_MINOR_SCALE_LINE_COLOR:"#000000",DIALCHART_SCALE_TEXT_VISIBLE:!0,DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_TEXT_FONT:null,DIALCHART_SCALE_TEXT_COLOR:"#000000",DIALCHART_PIVOT_RADIUS:10,DIALCHART_PIVOT_FILL:!0,DIALCHART_PIVOT_FILL_COLOR:"#808080",DIALCHART_PIVOT_OUTLINE_WIDTH:0,DIALCHART_PIVOT_OUTLINE_COLOR:"#808080",DIALCHART_VALUE_POSITION:.5,DIALCHART_INNER_DARKER_RADIUS:10,DIALCHART_OUTER_BRIGHTER_RADIUS:10,DIALCHART_SELECT_SHADOW_COLOR:"#000000",DIALCHART_SELECT_SHADOW_OFFSET:3,TABPANE_TAB_GAP:1,TABPANE_TAB_RADIUS:0,TABPANE_TAB_HEIGHT:24,TABPANE_TAB_ORIENTATION:"top",TABPANE_RESIZE_TOLERANCE:3,TABPANE_TAB_BACKGROUND:"#EBEBEB",TABPANE_DISABLED_COLOR:"#BABBBC",TABPANE_SELECT_BACKGROUND:"white",TABPANE_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABPANE_INSERT_BACKGROUND:"orange",TABPANE_HORIZONTAL_ALIGN:"center",TABPANE_CLOSE_ICON:"close_icon",TABPANE_SELECT_NEXT_ON_CLOSE:!0,TABPANE_SELECT_NEXT_ON_INVISIBLE:!0,LISTBASE_INNER_TEXT:!0,LIST_ROW_HEIGHT:19,LIST_INDENT:2,LIST_ROW_LINE_WIDTH:0,LIST_ROW_LINE_COLOR:"#DDD",LIST_MAKE_VISIBLE_ON_SELECTED:!0,LIST_KEYBOARD_REMOVE_ENABLED:!0,LIST_KEYBOARD_SELECT_ENABLED:!0,TREE_ROW_HEIGHT:19,TREE_INDENT:16,TREE_ROW_LINE_WIDTH:0,TREE_ROW_LINE_COLOR:"#DDD",TREE_MAKE_VISIBLE_ON_SELECTED:!0,TREE_KEYBOARD_REMOVE_ENABLED:!0,TREE_KEYBOARD_SELECT_ENABLED:!0,TREE_EXPAND_ICON:"expand_icon",TREE_COLLAPSE_ICON:"collapse_icon",TREE_LINE_TYPE:"none",TREE_LINE_THICKNESS:2,TREE_LINE_COLOR:"#000000",TREE_LINE_ALPHA:1,TREE_LINE_DASH:[4,2],TABLE_ROW_HEIGHT:19,TABLE_ROW_LINE_WIDTH:1,TABLE_ROW_LINE_COLOR:"#DDD",TABLE_COLUMN_LINE_WIDTH:1,TABLE_COLUMN_LINE_COLOR:"#DDD",TABLE_MAKE_VISIBLE_ON_SELECTED:!0,TABLE_KEYBOARD_REMOVE_ENABLED:!0,TABLE_KEYBOARD_SELECT_ENABLED:!0,TABLE_EDITABLE:!1,TABLEHEADER_HEIGHT:24,TABLEHEADER_RESIZE_TOLERANCE:3,TABLEHEADER_BACKGROUND:"#EBEBEB",TABLEHEADER_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABLEHEADER_INSERT_BACKGROUND:"orange",TABLEHEADER_COLUMN_LINE_COLOR:"#DDD",TABLEHEADER_SORT_DESC_ICON:"sort_desc",TABLEHEADER_SORT_ASC_ICON:"sort_asc",TABLEHEADER_SORT_ICON_POSITION:"98% 50%",TREETABLE_ROW_HEIGHT:19,TREETABLE_INDENT:16,TREETABLE_ROW_LINE_WIDTH:1,TREETABLE_ROW_LINE_COLOR:"#DDD",TREETABLE_COLUMN_LINE_WIDTH:1,TREETABLE_COLUMN_LINE_COLOR:"#DDD",TREETABLE_MAKE_VISIBLE_ON_SELECTED:!0,TREETABLE_KEYBOARD_REMOVE_ENABLED:!0,TREETABLE_KEYBOARD_SELECT_ENABLED:!0,TREETABLE_EXPAND_ICON:"expand_icon",TREETABLE_COLLAPSE_ICON:"collapse_icon",TREETABLE_EDITABLE:!1,PROPERTYSHEET_AUTO_ADJUSTABLE:!0,PROPERTYSHEET_INDENT:16,PROPERTYSHEET_ROW_HEIGHT:19,PROPERTYSHEET_ROW_LINE_WIDTH:1,PROPERTYSHEET_COLUMN_LINE_WIDTH:1,PROPERTYSHEET_BORDER_COLOR:"#EBEBEB",PROPERTYSHEET_EXPAND_ICON:"expand_icon",PROPERTYSHEET_COLLAPSE_ICON:"collapse_icon",PROPERTYSHEET_PROPERTY_NAME_WIDTH:100,PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN:"",PROPERTYSHEET_SUM_WIDTH:200,PROPERTYSHEET_RESIZE_TOLERANCE:3,PROPERTYSHEET_EDITABLE:!1,PROPERTYSHEET_CATEGORIZABLE:!0,PROPERTYSHEET_EXPAND_CATEGORY:!0,POPUPMENU_SUBNENU_ENABLE_ICON:"submenu_enable_icon",POPUPMENU_SUBNENU_DISABLE_ICON:"submenu_disable_icon",POPUPMENU_CHECKBOX_SELECTED_ICON:"checkbox_selected_icon",POPUPMENU_CHECKBOX_UNSELECTED_ICON:"checkbox_unselected_icon",POPUPMENU_RADIOBUTTON_SELECTED_ICON:"radiobutton_selected_icon",POPUPMENU_RADIOBUTTON_UNSELECTED_ICON:"radiobutton_unselected_icon",SPLITPANE_ORIENTATION:"horizontal",SPLITPANE_POSITION:.5,SPLITPANE_DIVIDER_WIDTH:6,SPLITPANE_DIVIDER_BACKGROUND:"#CCCCFF",SPLITPANE_DIVIDER_OPACITY:.5,SPLITPANE_MASK_BACKGROUND:"",NODE_WIDTH:50,NODE_HEIGHT:50,IMAGE_NODE:"node_image",IMAGE_GROUP:"group_image",IMAGE_SUBNETWORK:"subnetwork_image",ICON_DATABOX:"databox_icon",ICON_DATA:"data_icon",ICON_NODE:"node_icon",ICON_LINK:"link_icon",ICON_GROUP:"group_icon",ICON_SUBNETWORK:"subnetwork_icon",ICON_GRID:"grid_icon",ICON_BUS:"bus_icon",ICON_SHAPENODE:"shapenode_icon",ICON_SHAPELINK:"shapelink_icon",ICON_LINKSUBNETWORK:"linksubnetwork_icon",ICON_SHAPESUBNETWORK:"shapesubnetwork_icon",LAYER_DEFAULT_ID:"default",LAYER_DEFAULT_NAME:"default",ATTACHMENT_POINTER_LENGTH:10,ATTACHMENT_POINTER_WIDTH:8,ATTACHMENT_CORNER_RADIUS:5,ATTACHMENT_CONTENT_WIDTH:30,ATTACHMENT_CONTENT_HEIGHT:20,ATTACHMENT_POSITION:"topright.topright",ATTACHMENT_XOFFSET:0,ATTACHMENT_YOFFSET:0,ATTACHMENT_PADDING:0,ATTACHMENT_PADDING_LEFT:0,ATTACHMENT_PADDING_RIGHT:0,ATTACHMENT_PADDING_TOP:0,ATTACHMENT_PADDING_BOTTOM:0,ATTACHMENT_DIRECTION:"right",ATTACHMENT_FILL:!1,ATTACHMENT_FILL_COLOR:"#000000",ATTACHMENT_GRADIENT:null,ATTACHMENT_GRADIENT_COLOR:"#FFFFFF",ATTACHMENT_OUTLINE_WIDTH:-1,ATTACHMENT_OUTLINE_COLOR:"#000000",ATTACHMENT_CAP:"butt",ATTACHMENT_JOIN:"miter",ATTACHMENT_SHADOWABLE:!0,NETWORK_TOOLTIP_ENABLED:!0,NETWORK_SELECT_MODE:"mix",NETWORK_MAKE_VISIBLE_ON_SELECTED:!0,NETWORK_NO_AGENT_LINK_VISIBLE:!1,NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE:!1,NETWORK_SUBNETWORK_ANIMATE:!0,NETWORK_SENDTOTOP_ON_SELECTED:!0,NETWORK_KEYBOARD_REMOVE_ENABLED:!0,NETWORK_KEYBOARD_SELECT_ENABLED:!0,NETWORK_RECT_SELECT_ENABLED:!0,NETWORK_DOUBLECLICK_TO_SUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_UPSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_LINKBUNDLE:!0,NETWORK_DOUBLECLICK_TO_GROUPEXPAND:!0,NETWORK_SELECT_OUTLINE_COLOR:"#2877A8",NETWORK_SELECT_OUTLINE_WIDTH:1,NETWORK_SELECT_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_OUTLINE_COLOR:"#2877A8",NETWORK_LAZYMOVE_OUTLINE_WIDTH:1,NETWORK_LAZYMOVE_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_FILL:!0,NETWORK_LAZYMOVE_ANIMATE:!0,NETWORK_RESIZE_POINT_SIZE:3,NETWORK_RESIZE_POINT_FILL_COLOR:"#FFFFFF",NETWORK_RESIZE_POINT_OUTLINE_COLOR:"#000000",NETWORK_RESIZE_POINT_OUTLINE_WIDTH:1,NETWORK_RESIZE_LINE_COLOR:"#000000",NETWORK_RESIZE_LINE_WIDTH:1,NETWORK_RESIZE_ANIMATE:!0,NETWORK_EDIT_POINT_SIZE:3,NETWORK_EDIT_POINT_FILL_COLOR:"#FFFF00",NETWORK_EDIT_POINT_OUTLINE_COLOR:"#000000",NETWORK_EDIT_POINT_OUTLINE_WIDTH:1,NETWORK_EDIT_LINE_COLOR:"rgba(184,211,240,0.7)",NETWORK_EDIT_LINE_WIDTH:2,NETWORK_ROTATE_POINT_SIZE:5,NETWORK_ROTATE_POINT_FILL_COLOR:"#FFFF00",NETWORK_ROTATE_POINT_OFFSET:15,NETWORK_ROTATE_POINT_OUTLINE_WIDTH:1,NETWORK_ROTATE_POINT_OUTLINE_COLOR:"rgba(0,0,0,1)",NETWORK_ROTATE_SCALE_FILL_COLOR:"rgb(227,166,103)",NETWORK_ROTATE_SCALE_FONT_COLOR:"#FFFFFF",NETWORK_ROTATE_SCALE_WIDTH:30,NETWORK_ROTATE_SCALE_HEIGHT:20,NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION:!0,NETWORK_LINK_FLOW_STEPPING:3,NETWORK_LINK_FLOW_COLOR:"#FF0000",NETWORK_LINK_FLOW_INTERVAL:600,NETWORK_SELECTION_TOLERANCE:2,NETWORK_TRANSPARENT_SELECTION_ENABLE:!1,SHOW_ALARM_IN_ATTACHMENT_DIV:!0,SHOW_LABEL_IN_ATTACHMENT_DIV:!1,SHOW_LABEL2_IN_ATTACHMENT_DIV:!1,SHOW_ICON_IN_ATTACHMENT_DIV:!1,SHOW_EDIT_IN_ATTACHMENT_DIV:!1,OVERVIEW_FILL_COLOR:"rgba(184,211,240,0.4)",OVERVIEW_OUTLINE_COLOR:"#B8D3F0",OVERVIEW_OUTLINE_WIDTH:1,OVERVIEW_SELECT_COLOR:"#0000FF",OVERVIEW_SELECT_WIDTH:1,OVERVIEW_PADDING:1,OVERVIEW_ANIMATE:!0,OVERVIEW_MAX_PACKING_WIDTH:-1,OVERVIEW_MAX_PACKING_HEIGHT:-1,TOUCH_MOVE_THRESHOLD:5,TOUCH_RECT_SELECT_THRESHOLD:20,TOUCH_ZOOM_THRESHOLD:30,LINK_BUNDLE_AGENT_FUNCTION:null,IS_LINK_ADJUSTED_TO_BOTTOM:!1,ELEMENTUI_FUNCTION:function(a,b){var c=b.getElementUIClass();
return c?new c(a,b):null},CANVASUI_FUNCTION:function(a,b){var c=b.getCanvasUIClass();return c?new c(a,b):null},VECTORUI_FUNCTION:function(a,b){var c=b.getVectorUIClass();return c?new c(a,b):null},KEEP_DEFAULT_FUNCTION:function(a){return a.target.keepDefault||a.target.getAttribute("keepDefault")?!0:a.target.parentNode&&(a.target.parentNode.keepDefault||a.target.parentNode.getAttribute("keepDefault"))?!0:a.shiftKey?!0:!1},SORT_FUNCTION:function(a,c){if(a===c)return 0;if(null==a&&null!=c)return 1;if(null!=a&&null==c)return-1;if(null==a&&null==c)return 0;var d,e=typeof a,f=typeof c;return"string"===e&&"string"===f&&(d=a.localeCompare(c)),"number"===e&&"number"===f&&(d=a-c),d===b&&(d=(""+a).localeCompare(""+c)),d>0?1:0>d?-1:0},CENTER_LOCATION:!1};!function(){var b=Ce;if(a.OverrideTWaverDefaults)for(var c in OverrideTWaverDefaults)b[c]=OverrideTWaverDefaults[c];b.FONT=b.VIEW_FONT_SIZE&&b.VIEW_FONT_FAMILY?b.VIEW_FONT_SIZE+" "+b.VIEW_FONT_FAMILY:Oc.createElement("canvas").getContext("2d").font,b.CHART_VALUE_FONT||(b.CHART_VALUE_FONT="10px "+b.VIEW_FONT_FAMILY),b.BARCHART_XSCALE_TEXT_FONT||(b.BARCHART_XSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.BARCHART_YSCALE_TEXT_FONT||(b.BARCHART_YSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.BARCHART_XAXIS_TEXT_FONT||(b.BARCHART_XAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BARCHART_YAXIS_TEXT_FONT||(b.BARCHART_YAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.LINECHART_XSCALE_TEXT_FONT||(b.LINECHART_XSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.LINECHART_YSCALE_TEXT_FONT||(b.LINECHART_YSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.LINECHART_XAXIS_TEXT_FONT||(b.LINECHART_XAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.LINECHART_YAXIS_TEXT_FONT||(b.LINECHART_YAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_XAXIS_TEXT_FONT||(b.BUBBLECHART_XAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_YAXIS_TEXT_FONT||(b.BUBBLECHART_YAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_XSCALE_TEXT_FONT||(b.BUBBLECHART_XSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_YSCALE_TEXT_FONT||(b.BUBBLECHART_YSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.RADARCHART_AXIS_TEXT_FONT||(b.RADARCHART_AXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.RADARCHART_SCALE_TEXT_FONT||(b.RADARCHART_SCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.DIALCHART_SCALE_TEXT_FONT||(b.DIALCHART_SCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY)}(),Ic.Defaults=Ce,Jc.ext("twaver.Defaults",Object,{}),Ic.Colors={orange:"#EC6C00",orange_light:"#EF8200",orange_dark:"#EA5404",gray_light:"#666666",gray_dark:"#242424",green_light:"#57AB9A",green_dark:"#238475",blue_light:"#61B6D8",blue_dark:"#0089C1"},Ic.SerializationSettings=function(){var a=Ic.SerializationSettings;this.isDataBoxSerializable=a.isDataBoxSerializable,this.isLayerBoxSerializable=a.isLayerBoxSerializable,this.isStyleSerializable=a.isStyleSerializable,this.isClientSerializable=a.isClientSerializable,this.isImageSerializable=a.isImageSerializable,this._pm=Jc.clone(a._pm),this._sm=Jc.clone(a._sm),this._cm=Jc.clone(a._cm)},function(){var a=Ic.SerializationSettings;a.isDataBoxSerializable=!0,a.isLayerBoxSerializable=!0,a.isStyleSerializable=!0,a.isClientSerializable=!0,a.isImageSerializable=!0,a._pm={},a._sm={},a._cm={},a.setPropertyType=function(b,c){a._pm[b]=c},a.getPropertyType=function(b){return a._pm[b]},a.setStyleType=function(b,c){a._sm[b]=c},a.getStyleType=function(b){return a._sm[b]},a.setClientType=function(b,c){a._cm[b]=c},a.getClientType=function(b){return a._cm[b]}}(),Jc.ext("twaver.SerializationSettings",Object,{setPropertyType:function(a,b){this._pm[a]=b},getPropertyType:function(a){return this._pm[a]},setStyleType:function(a,b){this._sm[a]=b},getStyleType:function(a){return this._sm[a]},setClientType:function(a,b){this._cm[a]=b},getClientType:function(a){return this._cm[a]}}),Ic.Styles={_m:{},setStyle:function(a,b){null==b?delete Ic.Styles._m[a]:Ic.Styles._m[a]=b},getStyle:function(a){return Ic.Styles._m[a]},getStyleProperties:function(){return Jc.keys(Ic.Styles._m)}},function(){var a=function(a,b){Ic.SerializationSettings.setPropertyType(a,b)};a("name","cdata"),a("name2","cdata"),a("icon","string"),a("toolTip","cdata"),a("parent","data"),a("layerId","string"),a("alarmState","alarmstate"),a("image","string"),a("location","point"),a("width","number"),a("height","number"),a("expanded","boolean"),a("host","data"),a("fromNode","data"),a("toNode","data"),a("points","list.point"),a("segments","list.string"),a("angle","number"),a("visible","boolean"),a=function(a,b,c){null==c&&(c=null!=b?typeof b:"string"),Ic.Styles.setStyle(a,b),Ic.SerializationSettings.setStyleType(a,c)},a("chart.color",null),a("chart.value",0),a("chart.values",null,"list.number"),a("chart.value.color","#000000"),a("chart.value.font",null),a("chart.line.width",2),a("chart.marker.size",6),a("chart.marker.shape","circle"),a("chart.bubble.shape","circle"),a("chart.names",null,"list.string"),a("chart.xaxis.values",null,"list.number"),a("chart.yaxis.values",null,"list.number"),a("dialchart.rear.extension",0),a("dialchart.base.width",5),a("dialchart.top.width",0),a("dialchart.radius",.8),a("inner.color",null),a("outer.shape","rectangle"),a("outer.color",null),a("outer.width",2),a("outer.padding",1),a("outer.padding.left",0),a("outer.padding.right",0),a("outer.padding.top",0),a("outer.padding.bottom",0),a("outer.cap","butt"),a("outer.join","miter"),a("shadow.color",null),a("shadow.xoffset",3),a("shadow.yoffset",3),a("shadow.blur",6),a("select.style","shadow"),a("select.color","rgba(0, 0, 0, 0.7)"),a("select.shape","rectangle"),a("select.width",2),a("select.padding",2),a("select.padding.left",0),a("select.padding.right",0),a("select.padding.top",0),a("select.padding.bottom",0),a("select.cap","butt"),a("select.join","miter"),a("whole.alpha",1),a("body.type","default"),a("network.label",null,"cdata"),a("image.padding",0),a("image.padding.left",0),a("image.padding.right",0),a("image.padding.top",0),a("image.padding.bottom",0),a("image.state",null),a("vector.shape","rectangle"),a("vector.fill",!0),a("vector.fill.color","#CCCCFF"),a("vector.outline.width",-1),a("vector.outline.pattern",null,"array.number"),a("vector.outline.color","#5B5B5B"),a("vector.gradient","none"),a("vector.gradient.color","#FFFFFF"),a("vector.padding",0),a("vector.padding.left",0),a("vector.padding.right",0),a("vector.padding.top",0),a("vector.padding.bottom",0),a("vector.cap","butt"),a("vector.join","miter"),a("vector.deep",0),a("group.shape","rectangle"),a("group.fill",!0),a("group.fill.color","#CCCCFF"),a("group.outline.width",-1),a("group.outline.color","#5B5B5B"),a("group.gradient","none"),a("group.gradient.color","#FFFFFF"),a("group.padding",5),a("group.padding.left",0),a("group.padding.right",0),a("group.padding.top",0),a("group.padding.bottom",0),a("group.cap","butt"),a("group.join","miter"),a("group.deep",1),a("label.alpha",1),a("label.color","#000000"),a("label.font",null),a("label.position","bottom.bottom"),a("label.direction","below"),a("label.corner.radius",0),a("label.pointer.length",0),a("label.pointer.width",8),a("label.xoffset",0),a("label.yoffset",2),a("label.padding",0),a("label.padding.left",0),a("label.padding.right",0),a("label.padding.top",0),a("label.padding.bottom",0),a("label.fill",!1),a("label.fill.color","#C0C0C0"),a("label.gradient","none"),a("label.gradient.color","#FFFFFF"),a("label.outline.width",-1),a("label.outline.color","#000000"),a("label.cap","butt"),a("label.join","miter"),a("label.shadowable",!0),a("label.align","center"),a("link.label.rotatable",!1),a("label2.alpha",1),a("label2.color","#000000"),a("label2.font",null),a("label2.position","top.top"),a("label2.direction","below"),a("label2.corner.radius",0),a("label2.pointer.length",0),a("label2.pointer.width",8),a("label2.xoffset",0),a("label2.yoffset",-2),a("label2.padding",0),a("label2.padding.left",0),a("label2.padding.right",0),a("label2.padding.top",0),a("label2.padding.bottom",0),a("label2.fill",!1),a("label2.fill.color","#C0C0C0"),a("label2.gradient","none"),a("label2.gradient.color","#FFFFFF"),a("label2.outline.width",-1),a("label2.outline.color","#000000"),a("label2.cap","butt"),a("label2.join","miter"),a("label2.shadowable",!0),a("link.label2.rotatable",!1),a("icons.names",null,"array.string"),a("icons.colors",null,"array.string"),a("icons.position",null,"array.string"),a("icons.orientation",null,"array.string"),a("icons.xoffset",[0],"array.number"),a("icons.yoffset",[0],"array.number"),a("icons.xgap",[1],"array.number"),a("icons.ygap",[1],"array.number"),a("alarm.alpha",1),a("alarm.color","#000000"),a("alarm.font",null),a("alarm.position","hotspot"),a("alarm.direction","aboveright"),a("alarm.corner.radius",5),a("alarm.pointer.length",10),a("alarm.pointer.width",8),a("alarm.xoffset",0),a("alarm.yoffset",0),a("alarm.padding",0),a("alarm.padding.left",0),a("alarm.padding.right",0),a("alarm.padding.top",0),a("alarm.padding.bottom",0),a("alarm.gradient","none"),a("alarm.gradient.color","#FFFFFF"),a("alarm.outline.width",-1),a("alarm.outline.color","#000000"),a("alarm.cap","butt"),a("alarm.join","miter"),a("alarm.shadowable",!0),a("link.color","#658DC1"),a("link.width",3),a("link.cap","butt"),a("link.join","miter"),a("link.type","arc"),a("link.pattern",null,"array.number"),a("link.extend",20),a("link.control.point",null,"point"),a("link.bundle.id",0),a("link.bundle.enable",!0),a("link.bundle.expanded",!0),a("link.bundle.independent",!1),a("link.bundle.offset",20),a("link.bundle.gap",12),a("link.bundle.group.gap",0),a("link.looped.gap",6),a("link.looped.direction","northwest"),a("link.looped.type","arc"),a("link.from.position","center"),a("link.from.xoffset",0),a("link.from.yoffset",0),a("link.from.at.edge",!0),a("link.to.position","center"),a("link.to.xoffset",0),a("link.to.yoffset",0),a("link.to.at.edge",!0),a("link.split.by.percent",!0),a("link.split.percent",.5),a("link.split.value",20),a("link.corner","round"),a("link.xradius",8),a("link.yradius",8),a("link.flow",!1),a("link.flow.converse",!1),a("link.handler.alpha",1),a("link.handler.color","#000000"),a("link.handler.font",null),a("link.handler.position","topleft.topleft"),a("link.handler.direction","below"),a("link.handler.corner.radius",0),a("link.handler.pointer.length",0),a("link.handler.pointer.width",8),a("link.handler.xoffset",0),a("link.handler.yoffset",0),a("link.handler.padding",0),a("link.handler.padding.left",0),a("link.handler.padding.right",0),a("link.handler.padding.top",0),a("link.handler.padding.bottom",0),a("link.handler.fill",!1),a("link.handler.fill.color","#C0C0C0"),a("link.handler.gradient","none"),a("link.handler.gradient.color","#FFFFFF"),a("link.handler.outline.width",-1),a("link.handler.outline.color","#000000"),a("link.handler.cap","butt"),a("link.handler.join","miter"),a("link.handler.shadowable",!0),a("follower.row.index",0),a("follower.column.index",0),a("follower.row.span",1),a("follower.column.span",1),a("follower.padding",0),a("follower.padding.left",0),a("follower.padding.right",0),a("follower.padding.top",0),a("follower.padding.bottom",0),a("follower.fill.cell",!0),a("follower.cell.position","center"),a("grid.row.count",1),a("grid.column.count",1),a("grid.row.percents",null,"array.number"),a("grid.column.percents",null,"array.number"),a("grid.border",1),a("grid.border.left",0),a("grid.border.right",0),a("grid.border.top",0),a("grid.border.bottom",0),a("grid.padding",1),a("grid.padding.left",0),a("grid.padding.right",0),a("grid.padding.top",0),a("grid.padding.bottom",0),a("grid.fill",!0),a("grid.fill.color","#C0C0C0"),a("grid.deep",1),a("grid.cell.deep",-1),a("shapelink.type","lineto"),a("shapenode.closed",!1),a("shapenode.pattern",null,"array.number"),a("bus.style","nearby"),a("arrow.from",!1),a("arrow.from.fill",!0),a("arrow.from.shape","arrow.standard"),a("arrow.from.color","#000000"),a("arrow.from.xoffset",0),a("arrow.from.yoffset",0),a("arrow.from.width",12),a("arrow.from.height",9),a("arrow.from.outline.color","#000000"),a("arrow.from.outline.width",-1),a("arrow.from.at.edge",!0),a("arrow.to",!1),a("arrow.to.fill",!0),a("arrow.to.shape","arrow.standard"),a("arrow.to.color","#000000"),a("arrow.to.xoffset",0),a("arrow.to.yoffset",0),a("arrow.to.width",12),a("arrow.to.height",9),a("arrow.to.outline.color","#000000"),a("arrow.to.outline.width",-1),a("arrow.to.at.edge",!0),a("background.image",null),a("background.type","none"),a("background.outline.width",-1),a("background.outline.color",null),a("background.vector.padding",0),a("background.image.padding",0),a("background.image.stretch","fill"),a("background.vector.fill",null),a("background.vector.fill.color",null),a("background.vector.gradient",!1),a("background.vector.gradient.color",null),a("background.vector.shape","rectangle"),a("background.outline.pattern",null,"array.number")}(),Jc.ext("twaver.Styles",Object,{}),Ic.PropertyChangeDispatcher=function(){this._dispatcher=new Ic.EventDispatcher},Jc.ext("twaver.PropertyChangeDispatcher",Object,{addPropertyChangeListener:function(a,b,c){this._dispatcher.add(a,b,c)},removePropertyChangeListener:function(a,b){this._dispatcher.remove(a,b)},firePropertyChange:function(a,b,c){if(b==c)return!1;var d={property:a,oldValue:b,newValue:c,source:this};return this._dispatcher.fire(d),this.onPropertyChanged(d),!0},onPropertyChanged:function(){}}),Ic.animate.Animate=function(){},Jc.ext("twaver.animate.Animate",Object,{current:0,step:8,delay:4,finishFunction:null,shouldBeFinished:!1,getCurrentDelay:function(){return this.delay*this.current+1},action:function(){}}),Ic.animate.AnimateProperty=function(a,b,c){this.objects=a,this.newValues=b,this.finishFunction=c,this.oldValues=new me;for(var d=this.objects.size(),e=0;d>e;e++){var f=this.objects.get(e);this.oldValues.add(this.getPropertyValue(f))}},Jc.ext("twaver.animate.AnimateProperty",Ic.animate.Animate,{action:function(a){for(var b=this.objects.size(),c=0;b>c;c++){var d=this.objects.get(c),e=this.oldValues.get(c),f=this.newValues.get(c);this.currentAction(d,e,f,a)}},getPropertyValue:function(){},currentAction:function(){}}),Ic.animate.AnimateBounds=function(a,b,c){this.node=a,this.newBounds=b,this.oldBounds=a.getRect(),this.finishFunction=c},Jc.ext("twaver.animate.AnimateBounds",Ic.animate.Animate,{shouldBeFinished:!0,action:function(a){var b=this.oldBounds,c=this.newBounds;this.node.setLocation(b.x+(c.x-b.x)*a,b.y+(c.y-b.y)*a),this.node.setSize(b.width+(c.width-b.width)*a,b.height+(c.height-b.height)*a)}}),Ic.animate.AnimateCenterLocation=function(a,b,c){Ic.animate.AnimateCenterLocation.superClass.constructor.call(this,a,b,c)},Jc.ext("twaver.animate.AnimateCenterLocation",Ic.animate.AnimateProperty,{getPropertyValue:function(a){return a.getCenterLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setCenterLocation(e,f)}}),Ic.animate.AnimateLocation=function(a,b,c){Ic.animate.AnimateLocation.superClass.constructor.call(this,a,b,c)},Jc.ext("twaver.animate.AnimateLocation",Ic.animate.AnimateProperty,{getPropertyValue:function(a){return a.getLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setLocation(e,f)}}),Ic.animate.AnimateScrollPosition=function(a,b,c){this.view=a,this.oldHorizontalOffset=a.scrollLeft,this.oldVerticalOffset=a.scrollTop,this.newHorizontalOffset=b,this.newVerticalOffset=c},Jc.ext("twaver.animate.AnimateScrollPosition",Ic.animate.Animate,{action:function(a){this.view.scrollLeft=this.oldHorizontalOffset+(this.newHorizontalOffset-this.oldHorizontalOffset)*a,this.view.scrollTop=this.oldVerticalOffset+(this.newVerticalOffset-this.oldVerticalOffset)*a}}),Ic.animate.AnimateZoom=function(a,b,c){this.view=a,this.oldZoom=a.getZoom(),this.newZoom=b,this.finishFunction=c},Jc.ext("twaver.animate.AnimateZoom",Ic.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setZoom(this.oldZoom+(this.newZoom-this.oldZoom)*a,!1)}}),Ic.animate.AnimateXZoom=function(a,b,c){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.finishFunction=c},Jc.ext("twaver.animate.AnimateXZoom",Ic.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1)}}),Ic.animate.AnimateYZoom=function(a,b,c){this.view=a,this.oldYZoom=a.getYZoom(),this.newYZoom=b,this.finishFunction=c},Jc.ext("twaver.animate.AnimateYZoom",Ic.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),Ic.animate.AnimateXYZoom=function(a,b,c,d){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.oldYZoom=a.getYZoom(),this.newYZoom=c,this.finishFunction=d},Jc.ext("twaver.animate.AnimateXYZoom",Ic.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1),this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),Ic.animate.AnimateSubNetwork=function(a,b,c){this.network=a,this.subNetwork=b,this.finishFunction=c},Jc.ext("twaver.animate.AnimateSubNetwork",Ic.animate.Animate,{shouldBeFinished:!0,action:function(a){a>.5?(this.network.getView().style.opacity=2*a-1,this.network._setCurrentSubNetwork(this.subNetwork)):this.network.getView().style.opacity=1-2*a}}),Ic.animate.AnimateManager={timer:null,animate:null,start:function(a,b){var c=Ic.animate.AnimateManager;a.current<0&&(a.current=0),b?Jc.callLater(c.startImpl,null,[a],b):c.startImpl(a)},startImpl:function(a){var b=Ic.animate.AnimateManager;b.animate&&b.endAnimate(),b.animate=a,b.timer=setTimeout(b.tick,a.getCurrentDelay())},tick:function(){var a=Ic.animate.AnimateManager,b=a.animate;if(b){if(b.current<0)return void b.current++;b.current<b.step&&(b.current++,b.action(b.current/b.step),a.timer=setTimeout(a.tick,b.getCurrentDelay())),b.current>=b.step&&a.endAnimate()}},endAnimate:function(){var a=Ic.animate.AnimateManager;if(a.animate){a.animate.shouldBeFinished&&a.animate.current<a.animate.step&&(a.animate.current=a.animate.step,a.animate.action(a.animate.current/a.animate.step));var b=a.animate.finishFunction;a.animate=null,a.timer&&(clearTimeout(a.timer),a.timer=null),b&&b()}else a.timer&&(clearTimeout(a.timer),a.timer=null)}},Ic.DataBox=function(a){Ic.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=a),this._dataList=new me,this._dataMap={},this._rootList=new me,this._rootMap={},this._clientMap={},this._dataBoxChangeDispatcher=new Ic.EventDispatcher,this._dataPropertyChangeDispatcher=new Ic.EventDispatcher,this._hierarchyChangeDispatcher=new Ic.EventDispatcher,this._selectionModel=new Ic.SelectionModel(this)},Jc.ext("twaver.DataBox",Ic.PropertyChangeDispatcher,{IClient:!0,__client:1,__new:1,_limit:-1,_name:"DataBox",_icon:Ce.ICON_DATABOX,__accessor:["name","icon","toolTip"],getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(a){var b=this._limit;this._limit=a,this.firePropertyChange("limit",b,a),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(a){for(0===arguments.length&&(a=1);a>0&&this._dataList.size()>0;){var b=this._dataList.get(0);this.remove(b),a--}},getSiblings:function(a){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var b=a.getParent();return b?b.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(a){return a.getParent()?a.getParent().getChildren().indexOf(a):this._rootList.indexOf(a)},getDatas:function(){return this._dataList},getDataAt:function(a){return this._dataList.get(a)},toDatas:function(a,b){return this._dataList.toList(a,b)},forEach:function(a,b){this._dataList.forEach(a,b)},forEachReverse:function(a,b){this._dataList.forEachReverse(a,b)},forEachByDepthFirst:function(a,b,c){if(b)this._depthFirst(a,b,c);else for(var d=this._rootList.size(),e=0;d>e;e++){var f=this._rootList.get(e);if(this._depthFirst(a,f,c)===!1)return}},_depthFirst:function(a,b,c){for(var d=b.getChildrenSize(),e=0;d>e;e++){var f=b.getChildAt(e);if(this._depthFirst(a,f,c)===!1)return!1}if(c){if(a.call(c,b)===!1)return!1}else if(a(b)===!1)return!1},forEachByBreadthFirst:function(a,b,c){var d=new me;for(b?d.add(b):this._rootList.forEach(d.add,d);d.size()>0;)if(b=d.removeAt(0),b.getChildren().forEach(d.add,d),c){if(a.call(c,b)===!1)return}else if(a(b)===!1)return},add:function(a,b){if(a){1===arguments.length&&(b=-1);var c=a.getId();if(this._dataMap.hasOwnProperty(c))throw"Data with ID '"+c+"' already exists";this._dataMap[c]=a,this._dataList.add(a),a.getParent()||(this._rootMap[c]=a,b>=0?this._rootList.add(a,b):this._rootList.add(a)),a.addPropertyChangeListener(this.handleDataPropertyChange,this,!0),this._dataBoxChangeDispatcher.fire({kind:"add",data:a}),this._checkLimit()}},remove:function(a){this.removeById(a.getId())},removeSelection:function(){this._selectionModel.toSelection().forEach(function(a){this.remove(a)},this)},removeById:function(a){var b=this.getDataById(a);b&&(b instanceof Ic.Link&&(b.setFromNode(null),b.setToNode(null)),b instanceof Je&&b.getLinks()&&b.getLinks().toList().forEach(function(a){this.remove(a)},this),b instanceof Je&&b.getFollowers()&&b.getFollowers().toList().forEach(function(a){a.setHost(null)}),b instanceof Ic.Follower&&b.getHost()&&b.setHost(null),b.toChildren().forEach(function(a){this.remove(a)},this),b.getParent()&&b.getParent().removeChild(b),this._dataList.remove(b),delete this._dataMap[a],this._rootMap[a]&&(delete this._rootMap[a],this._rootList.remove(b)),this._dataBoxChangeDispatcher.fire({kind:"remove",data:b}),b.removePropertyChangeListener(this.handleDataPropertyChange,this))},clear:function(){if(this._dataList.size()>0){this._dataList.forEach(function(a){a.removePropertyChangeListener(this.handleDataPropertyChange,this)},this);var a=this._dataList.toList();this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:a})}},getDataById:function(a){return this._dataMap[a]},containsById:function(a){return this._dataMap.hasOwnProperty(a)},contains:function(a){return a?this._dataMap[a._id]===a:!1},moveTo:function(a,b){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var c=this.getSiblings(a),d=c.indexOf(a);d===b||0>d||b>=0&&b<=c.size()&&(c.remove(a),b>c.size()&&b--,c.add(a,b),this._hierarchyChangeDispatcher.fire({data:a,oldIndex:d,newIndex:b}))},moveUp:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)-1)},moveDown:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)+1)},moveToTop:function(a){this.moveTo(a,0)},moveToBottom:function(a){var b=this.getSiblings(a);this.moveTo(a,b.size())},moveSelectionUp:function(a){a||(a=this._selectionModel);var b=new me;yd.findMoveUpDatas(a,b,this._rootList),b.forEach(this.moveUp,this)},moveSelectionDown:function(a){a||(a=this._selectionModel);var b=new me;yd.findMoveDownDatas(a,b,this._rootList),b.forEach(this.moveDown,this)},moveSelectionToTop:function(a){a||(a=this._selectionModel);var b=new me;yd.findMoveToTopDatas(a,b,this._rootList),b.forEach(this.moveToTop,this)},moveSelectionToBottom:function(a){a||(a=this._selectionModel);var b=new me;yd.findMoveToBottomDatas(a,b,this._rootList),b.forEach(this.moveToBottom,this)},handleDataPropertyChange:function(a){var b=a.source;if("parent"===a.property){var c=b.getId();b.getParent()?this._rootMap[c]&&(delete this._rootMap[c],this._rootList.remove(b)):this._rootMap[c]||(this._rootMap[c]=b,this._rootList.add(b))}this.onDataPropertyChanged(b,a),this._dataPropertyChangeDispatcher.fire(a)},onDataPropertyChanged:function(){},addDataBoxChangeListener:function(a,b,c){this._dataBoxChangeDispatcher.add(a,b,c)},removeDataBoxChangeListener:function(a,b){this._dataBoxChangeDispatcher.remove(a,b)},addDataPropertyChangeListener:function(a,b,c){this._dataPropertyChangeDispatcher.add(a,b,c)},removeDataPropertyChangeListener:function(a,b){this._dataPropertyChangeDispatcher.remove(a,b)},addHierarchyChangeListener:function(a,b,c){this._hierarchyChangeDispatcher.add(a,b,c)},removeHierarchyChangeListener:function(a,b){this._hierarchyChangeDispatcher.remove(a,b)},getRandomData:function(a){if(a){for(var b=new Ic.List,c=0;c<this._dataList.size()-1;c++){var d=this._dataList.get(c);d instanceof a&&b.add(d)}if(0==b.size())return null}var e=a?b.get(parseInt(Math.random()*b.size())):this._dataList.get(parseInt(Math.random()*this._dataList.size()));return e}}),Ic.ElementBox=function(){Ic.ElementBox.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new Ic.AlarmBox(this),this._layerBox=new Ic.LayerBox(this),this._alarmStatePropagator=new Ic.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0),this._indexChangeDispatcher=new Ic.EventDispatcher},Ic.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},Jc.ext("twaver.ElementBox",Ic.DataBox,{IStyle:!0,__style:1,_name:"ElementBox",add:function(a){if(a){if(!a.IElement)throw"Only IElement can be added into ElementBox";Ic.ElementBox.superClass.add.apply(this,arguments),this.adjustElementIndex(a)}},onDataPropertyChanged:function(a,b){Ic.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[b.property]&&this.adjustElementIndex(a),Ic.ElementBox.superClass.onDataPropertyChanged.apply(this,arguments)},addIndexChangeListener:function(a,b,c){this._indexChangeDispatcher.add(a,b,c)},removeIndexChangeListener:function(a,b){this._indexChangeDispatcher.remove(a,b)},sendToTop:function(a){if(this.contains(a)){if(a!==this.getDatas().get(this.size()-1)){var b=this.getDatas().indexOf(a);this.getDatas().removeAt(b),this.getDatas().add(a),this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:this.size()-1})}a instanceof Ic.Link&&(a.getFromAgent()&&!a.getFromAgent().isAdjustedToBottom()&&this.sendToTop(a.getFromAgent()),a.getToAgent()&&!a.getToAgent().isAdjustedToBottom()&&this.sendToTop(a.getToAgent())),a instanceof Je&&a.getFollowers()&&a.getFollowers().forEach(function(b){b.isRelatedTo(a)||a instanceof Ic.Follower&&b.isLoopedHostOn(a)||this.sendToTop(b)},this),a.ISubNetwork||a instanceof Ke&&!a.isExpanded()||a.getChildren().forEach(function(a){a instanceof Ic.Link||this.sendToTop(a)},this)}},sendToBottom:function(a,b){if(a!==b&&this.contains(a)&&(!b||this.contains(b))){var c=this.getDatas().remove(a),d=0;b&&(d=this.getDatas().indexOf(b)),this.getDatas().add(a,d),c!=d&&(this._indexChangeDispatcher.fire({element:a,oldIndex:c,newIndex:d}),!a.getParent()||a.getParent().ISubNetwork||a.getParent()instanceof Ic.Link||this.sendToBottom(a.getParent(),a))}},fireIndexChange:function(a,b,c){this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:c})},adjustElementIndex:function(a){this.contains(a)&&(a.isAdjustedToBottom()?(this.sendToBottom(a),a.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(a))},forEachByLayer:function(a,b,c){var d=this.size(),e=this.getDatas();if(b)for(var f=0;d>f;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}else this._layerBox.forEachByDepthFirst(function(b){for(var f=0;d>f;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}},null,this)},forEachByLayerReverse:function(a,b,c){var d=new me;this.forEachByLayer(function(a){d.add(a,0)},b),d.forEach(a,c)},getLayerBox:function(){return this._layerBox},getAlarmBox:function(){return this._alarmBox},getAlarmStatePropagator:function(){return this._alarmStatePropagator},startBatch:function(a,b){Ic._isInitializing=!0,Ic._bundleLinks={},Ic._links={},a.call(b);var c,d;for(var e in Ic._links)c=Ic._links[e],c._checkAgentNodeImpl();for(var e in Ic._bundleLinks)d=Ic._bundleLinks[e],vd.resetBundleLinks(d[0],d[1]);Ic._bundleLinks=null,Ic._links=null,Ic._isInitializing=!1}}),Ic.SelectionModel=function(a){Ic.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new me,this._selectionChangeDispatcher=new Ic.EventDispatcher,this._selectionMap={},this._setDataBox(a)},Jc.ext("twaver.SelectionModel",Ic.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(a){if(this._selectionMode!==a&&("noneSelection"===a||"singleSelection"===a||"multipleSelection"===a)){this.clearSelection();var b=this._selectionMode;this._selectionMode=a,this.firePropertyChange("selectionMode",b,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(a){if(!a)throw"dataBox can not be null";if(this._dataBox!==a){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var b=this._dataBox;this._dataBox=a,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",b,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(a){if("remove"===a.kind){var b=a.data;this.contains(b)&&(this._selectionList.remove(b),delete this._selectionMap[b.getId()],this.fireSelectionChange("remove",new me(b)))}else"clear"===a.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(a){if(this._filterFunction!==a){this.clearSelection();var b=this._filterFunction;this._filterFunction=a,this.firePropertyChange("filterFunction",b,this._filterFunction)}},fireSelectionChange:function(a,b,c){c&&(this._selectionList.forEach(function(a){c.contains(a)?c.remove(a):c.add(a)}),b=c.toList()),this._selectionChangeDispatcher.fire({kind:a,datas:new me(b)})},addSelectionChangeListener:function(a,b,c){this._selectionChangeDispatcher.add(a,b,c)},removeSelectionChangeListener:function(a,b){this._selectionChangeDispatcher.remove(a,b)},_filterList:function(a,b){for(var c=new me(a),d=0;d<c.size();d++){var e=c.get(d);(this._filterFunction&&!this._filterFunction(e)||b&&this.contains(e)||!b&&!this.contains(e)||!this._dataBox.contains(e))&&(c.removeAt(d),d--)}return c},appendSelection:function(a){if("noneSelection"!==this._selectionMode){var b=this._filterList(a,!0);if(!b.isEmpty()){var c=null;"singleSelection"===this._selectionMode&&(c=new me(this._selectionList),this._selectionList.clear(),this._selectionMap={},b=new me(b.get(b.size()-1)));for(var d=0;d<b.size();d++){var e=b.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("append",b,c)}}},removeSelection:function(a){var b=this._filterList(a);if(0!==b.size()){for(var c=0;c<b.size();c++){var d=b.get(c);this._selectionList.remove(d),delete this._selectionMap[d.getId()]}this.fireSelectionChange("remove",b)}},toSelection:function(a,b){return this._selectionList.toList(a,b)},getSelection:function(){return this._selectionList},setSelection:function(a){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=a)){var b=new me(this._selectionList);this._selectionList.clear(),this._selectionMap={};var c=this._filterList(a,!0);"singleSelection"===this._selectionMode&&c.size()>1&&(c=new me(c.get(c.size()-1)));for(var d=0;d<c.size();d++){var e=c.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("set",null,b)}},clearSelection:function(){if(this._selectionList.size()>0){var a=this._selectionList.toList();this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",a)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var a=this._dataBox.toDatas(),b=0,c=null;if(this._filterFunction)for(b=0;b<a.size();b++)c=a.get(b),this._filterFunction(c)||(a.removeAt(b),b--);var d=new me(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&a.size()>1&&(a=new me(a.get(a.size()-1))),b=0;b<a.size();b++)c=a.get(b),this._selectionList.add(c),this._selectionMap[c.getId()]=c;this.fireSelectionChange("all",null,d)
}},size:function(){return this._selectionList.size()},contains:function(a){return a?null!=this._selectionMap[a.getId()]:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(a){return a?"noneSelection"===this._selectionMode?!1:this._filterFunction&&!this._filterFunction(a)?!1:!0:!1}}),Ic.QuickFinder=function(a,b,c,d,e){if(this._map={},!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor","accessor"===this._propertyType&&(this._getter=Jc.getter(b)),this._valueFunction=d||this.getValue,this._filterFunction=e||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},Jc.ext("twaver.QuickFinder",Object,{_NULL_:"twaver-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(a){"add"===a.kind?this._addData(a.data):"remove"===a.kind?this._removeData(a.data):"clear"===a.kind&&(this._map={})},handleDataPropertyChange:function(a){if(this._filterFunction.call(this,a.source)){if("accessor"===this._propertyType&&this._propertyName===a.property);else if("style"===this._propertyType&&a.source.IStyle&&"S:"+this._propertyName===a.property);else if("client"!==this._propertyType||"C:"+this._propertyName!==a.property)return;var b=this._getMap(a.oldValue);b&&b.remove(a.source),this._addData(a.source)}},_getMap:function(a){return a=null==a?this._NULL_:a,this._map[a]},find:function(a){var b=this._getMap(a);return b?b.toList():new me},findFirst:function(a){var b=this._getMap(a);return!b||b.isEmpty()?null:b.get(0)},_addData:function(a){if(this._filterFunction.call(this,a)){var b=this._valueFunction.call(this,a),c=this._getMap(b);c||(c=new me,b=null==b?this._NULL_:b,this._map[b]=c),c.add(a)}},_removeData:function(a){if(this._filterFunction.call(this,a)){var b=this._valueFunction.call(this,a),c=this._getMap(b);c&&(c.remove(a),c.isEmpty()&&(b=null==b?this._NULL_:b,delete this._map[b]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(a){return("style"!==this._propertyType||a.IStyle)&&("accessor"!==this._propertyType||this._valueFunction!==this.getValue||a[this._getter])?!0:!1},getValue:function(a){return"accessor"===this._propertyType?a[this._getter]():"style"===this._propertyType&&a.getStyle?a.getStyle(this._propertyName):"client"===this._propertyType&&a.getClient?a.getClient(this._propertyName):null}}),Ic.PropertyPropagator=function(a,b,c){if(!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor","accessor"===this._propertyType&&(this._getter=Jc.getter(b),this._setter=Jc.setter(b)),this._enable=!1,this._isPropagating=!1},Jc.ext("twaver.PropertyPropagator",Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(a){this._enable!==a&&(this._enable=a,this._enable?(this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.forEach(function(a){this.propagate(a)},this)):(this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)))},handleDataBoxChange:function(a){a.data&&this.propagate(a.data)},handleDataPropertyChange:function(a){if(this.isInterestedProperty(a))this.propagate(a.source);else if("parent"===a.property){var b=a.oldValue;b&&this.propagate(b),this.propagate(a.source)}},isInterestedProperty:function(a){return"accessor"===this._propertyType&&this._propertyName===a.property?!0:"style"===this._propertyType&&a.IElement&&"S:"+this._propertyName===a.property?!0:"client"===this._propertyType&&"C:"+this._propertyName===a.property?!0:!1},propagate:function(a){a&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(a),this._isPropagating=!1)},propagateToTop:function(a){for(this.propagateToParent(null,a);a&&a.getParent();)this.propagateToParent(a,a.getParent()),a=a.getParent()},propagateToParent:function(){}}),Ic.AlarmStatePropagator=function(a){Ic.AlarmStatePropagator.superClass.constructor.call(this,a,"alarmState")},Jc.ext("twaver.AlarmStatePropagator",Ic.PropertyPropagator,{handleDataPropertyChange:function(a){"enablePropagation"===a.property?this.propagate(a.source):Ic.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,a)},propagateToParent:function(a,b){var c=null;b.getChildren().forEach(function(a){var b=a.getAlarmState().getHighestOverallAlarmSeverity();Ic.AlarmSeverity.compare(b,c)>0&&(c=b)}),b.getAlarmState().setPropagateSeverity(c)}}),Ic.AlarmSeverity=function(a,b,c,d,e){this.value=a,this.name=b,this.nickName=c,this.color=d,this.displayName=e},Jc.ext("twaver.AlarmSeverity",Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var a=Ic.AlarmSeverity;a.severities=new me,a._vm={},a._nm={},a._cp=function(a,b){if(a&&b){var c=a.value-b.value;return c>0?1:0>c?-1:0}return a&&!b?1:!a&&b?-1:0},a.forEach=function(b,c){a.severities.forEach(b,c)},a.getSortFunction=function(){return a._cp},a.setSortFunction=function(b){a._cp=b,a.severities.sort(b)},a.add=function(b,c,d,e,f){var g=new a(b,c,d,e,f);return a._vm[b]=g,a._nm[c]=g,a.severities.add(g),a.severities.sort(a._cp),g},a.remove=function(b){var c=a._nm[b];return c&&(delete a._nm[b],delete a._vm[c.value],a.severities.remove(c)),c},a.CRITICAL=a.add(500,"Critical","C","#FF0000"),a.MAJOR=a.add(400,"Major","M","#FFA000"),a.MINOR=a.add(300,"Minor","m","#FFFF00"),a.WARNING=a.add(200,"Warning","W","#00FFFF"),a.INDETERMINATE=a.add(100,"Indeterminate","N","#C800FF"),a.CLEARED=a.add(0,"Cleared","R","#00FF00"),a.isClearedAlarmSeverity=function(a){return a?0===a.value:!1},a.getByName=function(b){return a._nm[b]},a.getByValue=function(b){return a._vm[b]},a.clear=function(){a.severities.clear(),a._vm={},a._nm={}},a.compare=function(b,c){return a._cp(b,c)}}(),Ic.AlarmState=function(a){this._e=a,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},Jc.ext("twaver.AlarmState",Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var a=null;for(var b in this._am)b=Ic.AlarmSeverity.getByName(b),Ic.AlarmSeverity.isClearedAlarmSeverity(b)||0!==this.getAcknowledgedAlarmCount(b)&&(a=a&&Ic.AlarmSeverity.compare(a,b)>0?a:b);this._haa=a},_c2:function(){var a=null;for(var b in this._nm)b=Ic.AlarmSeverity.getByName(b),Ic.AlarmSeverity.isClearedAlarmSeverity(b)||0!==this.getNewAlarmCount(b)&&(a=a&&Ic.AlarmSeverity.compare(a,b)>0?a:b);this._hna=a},_c3:function(){if(!this._hna)return void(this._hls=!1);for(var a in this._nm)if(a=Ic.AlarmSeverity.getByName(a),!Ic.AlarmSeverity.isClearedAlarmSeverity(a)&&0!==this.getNewAlarmCount(a)&&Ic.AlarmSeverity.compare(this._hna,a)>0)return void(this._hls=!0);this._hls=!1},_c4:function(){var a=this._haa,b=this._hna,c=this._ps;this._hoa=a,Ic.AlarmSeverity.compare(b,this._hoa)>0&&(this._hoa=b),Ic.AlarmSeverity.compare(c,this._hoa)>0&&(this._hoa=c)},_c5:function(){var a=this._haa,b=this._hna;this._hta=a,Ic.AlarmSeverity.compare(b,this._hta)>0&&(this._hta=b)},increaseAcknowledgedAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._am[a.name];null==c&&(c=0),c+=b,this._am[a.name]=c,this._f()}},increaseNewAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._nm[a.name];null==c&&(c=0),c+=b,this._nm[a.name]=c,this._f()}},decreaseAcknowledgedAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._am[a.name];if(null==c&&(c=0),c-=b,0>c)throw"Alarm count can not be negative";this._am[a.name]=c,this._f()}},decreaseNewAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._nm[a.name];if(null==c&&(c=0),c-=b,0>c)throw"Alarm count can not be negative";this._nm[a.name]=c,this._f()}},acknowledgeAlarm:function(a){this.decreaseNewAlarm(a,1),this.increaseAcknowledgedAlarm(a,1)},acknowledgeAllAlarms:function(a){if(a){var b=this.getNewAlarmCount(a);this.decreaseNewAlarm(a,b),this.increaseAcknowledgedAlarm(a,b)}else for(var c in this._nm)this.acknowledgeAllAlarms(Ic.AlarmSeverity.getByName(c))},_c6:function(){this._aac=0;for(var a in this._am)a=Ic.AlarmSeverity.getByName(a),this._aac+=this.getAcknowledgedAlarmCount(a)},getAcknowledgedAlarmCount:function(a){if(a){var b=this._am[a.name];return null==b?0:b}return this._aac},getAlarmCount:function(a){return this.getAcknowledgedAlarmCount(a)+this.getNewAlarmCount(a)},_c7:function(){this._nac=0;for(var a in this._nm)a=Ic.AlarmSeverity.getByName(a),this._nac+=this.getNewAlarmCount(a)},getNewAlarmCount:function(a){if(a){var b=this._nm[a.name];return null==b?0:b}return this._nac},setNewAlarmCount:function(a,b){this._nm[a.name]=b,this._f()},removeAllNewAlarms:function(a){a?delete this._nm[a]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(a,b){this._am[a.name]=b,this._f()},removeAllAcknowledgedAlarms:function(a){a?delete this._am[a.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(a){if(this._ep||(a=null),this._ps!==a){var b=this._ps;this._ps=a,this._f(),this._e.firePropertyChange("propagateSeverity",b,a)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(a){var b=this._ep;this._ep=a,this._e.firePropertyChange("enablePropagation",b,a)&&(a||this.setPropagateSeverity(null))}}),Ic.AlarmBox=function(a){if(!a)throw"elementBox can not be null.";Ic.AlarmBox.superClass.constructor.call(this),this._elementBox=a,this._alarmElementMapping=new Ic.AlarmElementMapping(this,a),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},Jc.ext("twaver.AlarmBox",Ic.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(a){var b=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=a,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",b,a),a&&this.toDatas(function(a){return a.isCleared()}).forEach(this.remove,this)},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(a){if(!a)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==a){var b=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=a,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",b,a)}},handleElementBoxChange:function(a){"add"===a.kind?this.handleElementAdded(a.data):"remove"===a.kind?(this.handleElementRemoved(a.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(a.data)):"clear"===a.kind&&(a.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(a){"add"===a.kind?this._increaseAlarmState(a.data):"remove"===a.kind?this._decreaseAlarmState(a.data):"clear"===a.kind&&a.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(a){var b=a.source;b.isCleared()||("alarmSeverity"===a.property?this.handleAlarmSeverityChange(b,a):"acked"===a.property&&this.handleAckedChange(b,a)),"cleared"===a.property&&(b.isCleared()?(this._decreaseAlarmState(b,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(b)):this._increaseAlarmState(b,!0))},handleAckedChange:function(a,b){if(a.getAlarmSeverity()){var c=this.getCorrespondingElements(a);if(c)for(var d=0;d<c.size();d++){var e=c.get(d);b.oldValue?e.getAlarmState().decreaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(a.getAlarmSeverity()),b.newValue?e.getAlarmState().increaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().increaseNewAlarm(a.getAlarmSeverity())}}},handleAlarmSeverityChange:function(a,b){var c=b.oldValue,d=b.newValue,e=this.getCorrespondingElements(a);if(e)for(var f=0;f<e.size();f++){var g=e.get(f);c&&(a.isAcked()?g.getAlarmState().decreaseAcknowledgedAlarm(c):g.getAlarmState().decreaseNewAlarm(c)),d&&(a.isAcked()?g.getAlarmState().increaseAcknowledgedAlarm(d):g.getAlarmState().increaseNewAlarm(d))}},getCorrespondingAlarms:function(a){return this._alarmElementMapping.getCorrespondingAlarms(a)},getCorrespondingElements:function(a){return this._alarmElementMapping.getCorrespondingElements(a)},handleElementAdded:function(a){var b=this.getCorrespondingAlarms(a);if(b)for(var c=0;c<b.size();c++){var d=b.get(c);if(!d.isCleared()){var e=d.getAlarmSeverity();e&&(d.isAcked()?a.getAlarmState().increaseAcknowledgedAlarm(e):a.getAlarmState().increaseNewAlarm(e))}}},_increaseAlarmState:function(a,b){if(!a.isCleared()||b){var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().increaseAcknowledgedAlarm(c):f.getAlarmState().increaseNewAlarm(c)}}}},_decreaseAlarmState:function(a,b){if(!a.isCleared()||b){var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().decreaseAcknowledgedAlarm(c):f.getAlarmState().decreaseNewAlarm(c)}}}},handleElementRemoved:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(function(b){!b.isCleared()&&b.getAlarmSeverity()&&(b.isAcked()?a.getAlarmState().decreaseAcknowledgedAlarm(b.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(b.getAlarmSeverity()))})},removeAlarmsByElement:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(this.remove,this)},add:function(a){if(!a.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&a.isCleared()||Ic.AlarmBox.superClass.add.apply(this,arguments)}}),Ic.AlarmElementMapping=function(a,b){if(!b)throw"ElementBox can not be null";if(!a)throw"AlarmBox can not be null";this._elementBox=b,this._alarmBox=a,this._alarmsFinder=new Ic.QuickFinder(a,"elementId")},Jc.ext("twaver.AlarmElementMapping",Object,{getCorrespondingAlarms:function(a){return this._alarmsFinder.find(a.getId())},getCorrespondingElements:function(a){var b=this._elementBox.getDataById(a.getElementId());return new me(b)},dispose:function(){this._alarmsFinder.dispose(),delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),Ic.AlarmStateStatistics=function(a){Ic.AlarmStateStatistics.superClass.constructor.apply(this,arguments),this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.elementMap={},this.setElementBox(a)},Jc.ext("twaver.AlarmStateStatistics",Ic.PropertyChangeDispatcher,{getElementBox:function(){return this._elementBox},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._elementBox!==a){var b=this._elementBox;b&&(b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removeDataBoxChangeListener(this.handleElementBoxChange,this),this.severtiyMap={},this.elementMap={}),this._elementBox=a,this.reset(),a.addDataPropertyChangeListener(this.handleElementPropertyChange,this),a.addDataBoxChangeListener(this.handleElementBoxChange,this),this.firePropertyChange("elementBox",b,a)}},dispose:function(){this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange,this),delete this._elementBox},handleElementPropertyChange:function(a){"alarmState"===a.property&&(this.increase(a.source),this.fireAlarmStateChange())},handleElementBoxChange:function(a){"add"===a.kind?(this.increase(a.data),this.fireAlarmStateChange()):"remove"===a.kind?(this.decrease(a.data),this.fireAlarmStateChange()):"clear"===a.kind&&(this.severtiyMap={},this.elementMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,Ic.AlarmSeverity.forEach(function(a){var b=this.getSumInfo(a);this.sumAcked+=b.ackedCount,this.sumNew+=b.newCount,this.sumTotal+=b.totalCount},this),this.firePropertyChange("alarmState",!1,!0)},getNewAlarmCount:function(a){if(!a)return this.sumNew;var b=this.getSumInfo(a);return b.newCount},getAcknowledgedAlarmCount:function(a){if(!a)return this.sumAcked;var b=this.getSumInfo(a);return b.ackedCount},getTotalAlarmCount:function(a){if(!a)return this.sumTotal;var b=this.getSumInfo(a);return b.totalCount},getSumInfo:function(a){var b=this.severtiyMap[a.name];return b||(b={},b.newCount=0,b.ackedCount=0,b.totalCount=0,this.severtiyMap[a.name]=b),b},decrease:function(a){var b=this.elementMap[a.getId()];b&&(delete this.elementMap[a.getId()],Ic.AlarmSeverity.forEach(function(a){var c=b[a.name],d=this.getSumInfo(a);d.newCount=d.newCount-c.newCount,d.ackedCount=d.ackedCount-c.ackedCount,d.totalCount=d.totalCount-c.totalCount},this))},increase:function(a){if(this.decrease(a),!this._filterFunction||this._filterFunction(a)){var b={};this.elementMap[a.getId()]=b,Ic.AlarmSeverity.forEach(function(c){var d={};d.newCount=a.getAlarmState().getNewAlarmCount(c),d.ackedCount=a.getAlarmState().getAcknowledgedAlarmCount(c),d.totalCount=a.getAlarmState().getAlarmCount(c),b[c.name]=d;var e=this.getSumInfo(c);e.newCount=e.newCount+d.newCount,e.ackedCount=e.ackedCount+d.ackedCount,e.totalCount=e.totalCount+d.totalCount},this)}},reset:function(){this.severtiyMap={},this.elementMap={},this._elementBox.forEach(this.increase,this),this.fireAlarmStateChange()},setFilterFunction:function(a){var b=this._filterFunction;this._filterFunction=a,this.reset(),this.firePropertyChange("filterFunction",b,a)},getFilterFunction:function(){return _filterFunction}}),Ic.LayerBox=function(a){Ic.LayerBox.superClass.constructor.call(this),this._elementBox=a,this._defaultLayer=new Ic.Layer(Ce.LAYER_DEFAULT_ID,Ce.LAYER_DEFAULT_NAME),this.add(this._defaultLayer)},Jc.ext("twaver.LayerBox",Ic.DataBox,{_name:"LayerBox",getElementBox:function(){return this._elementBox},getDefaultLayer:function(){return this._defaultLayer},add:function(a){if(!a.ILayer)throw"Only ILayer can be added into LayerBox";Ic.LayerBox.superClass.add.apply(this,arguments)},removeById:function(a){if(a===this._defaultLayer.getId())throw"Cannot remove default layer";Ic.LayerBox.superClass.removeById.call(this,a)},getLayerByElement:function(a){if(!a)return null;if(a._layerId===Ce.LAYER_DEFAULT_ID)return this._defaultLayer;var b=this.getDataById(a.getLayerId());return b?b:this._defaultLayer},clear:function(){this.toDatas().forEach(function(a){a!=this._defaultLayer&&this.removeById(a.getId())},this)}}),Ic.BundleLinks=function(a,b){this._links=a,this._siblings=b;var c,d,e=Ic.Styles.getStyle("link.bundle.expanded");for(c=0;c<a.size();c++){d=a.get(c);var f=d.getStyle("link.bundle.expanded",!1);if(null!=f){e=f;break}}if(null==e&&(e=!0),Ce.LINK_BUNDLE_AGENT_FUNCTION){var g=Ce.LINK_BUNDLE_AGENT_FUNCTION(a);null==g?g=a.get(0):g!=a.get(0)&&(a.remove(g),a.add(g,0))}for(c=0;c<a.size();c++)a.get(c).setStyle("link.bundle.expanded",e)},Jc.ext("twaver.BundleLinks",Object,{getLinks:function(){return this._links},getSiblings:function(){return this._siblings},forEachSiblingLink:function(a,b){this._siblings.forEach(function(c){c.getLinks().forEach(a,b)})}});var De={bitsToNum:function(a){return a.reduce(function(a,b){return 2*a+b},0)},byteToBitArr:function(a){for(var b=[],c=7;c>=0;c--)b.push(!!(a&1<<c));return b},lzwDecode:function(a,b){for(var c,d,e=0,f=function(a){for(var c=0,d=0;a>d;d++)b.charCodeAt(e>>3)&1<<(7&e)&&(c|=1<<d),e++;return c},g=[],h=1<<a,i=h+1,j=a+1,k=[],l=function(){k=[],j=a+1;for(var b=0;h>b;b++)k[b]=[b];k[h]=[],k[i]=null};;)if(d=c,c=f(j),c!==h){if(c===i)break;if(c<k.length)d!==h&&k.push(k[d].concat(k[c][0]));else{if(c!==k.length)throw new Error("Invalid LZW code.");k.push(k[d].concat(k[d][0]))}g.push.apply(g,k[c]),k.length===1<<j&&12>j&&j++}else l();return g}},Ee=function(a){this.data=a,this.len=this.data.length,this.pos=0};Jc.ext(Ee,Object,{readByte:function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&this.data.charCodeAt(this.pos++)},readBytes:function(a){for(var b=[],c=0;a>c;c++)b.push(this.readByte());return b},read:function(a){for(var b="",c=0;a>c;c++)b+=String.fromCharCode(this.readByte());return b},readUnsigned:function(){var a=this.readBytes(2);return(a[1]<<8)+a[0]}});var Fe=function(a){var b,c=a,d=null,e=null,f=null,g=0,h=null,i=null,j=null;this.frames=[],this.size={};var k=this,l=Oc.createElement("canvas");this.loaded=!1;var m=function(){d=null,e=null,h=f,f=null,i=null};this.doParse=function(){Ge(c,t)};var n=function(a){b=a,k.size.width=b.width,k.size.height=b.height},o=function(a){p(),m(),d=a.transparencyGiven?a.transparencyIndex:null,e=a.delayTime,f=a.disposalMethod},p=function(){i&&k.frames.push({data:i.getImageData(0,0,b.width,b.height),delay:e})},q=function(a){i||(i=l.getContext("2d"));var c=k.frames.length,e=a.lctFlag?a.lct:b.gct;c>0&&(3===h?i.putImageData(k.frames[g].data,0,0):g=c-1,2===h&&(j||i.clearRect(j.leftPos,j.topPos,j.width,j.height)));var f=i.getImageData(a.leftPos,a.topPos,a.width,a.height);a.pixels.forEach(function(a,b){a!==d&&(f.data[4*b+0]=e[a][0],f.data[4*b+1]=e[a][1],f.data[4*b+2]=e[a][2],f.data[4*b+3]=255)}),i.putImageData(f,a.leftPos,a.topPos),j=a},r=function(){},s=function(a){return function(b){a(b)}},t={hdr:s(n),gce:s(o),com:s(r),app:{NETSCAPE:s(r)},img:s(q),eof:function(){p(),k.loaded=!0}}},Ge=function(a,b){b||(b={});var c=function(b){for(var c=[],d=0;b>d;d++)c.push(a.readBytes(3));return c},d=function(){var b,c;c="";do b=a.readByte(),c+=a.read(b);while(0!==b);return c},e=function(){var d={};if(d.sig=a.read(3),d.ver=a.read(3),"GIF"!==d.sig)throw new Error("Not a GIF file.");d.width=a.readUnsigned(),d.height=a.readUnsigned();var e=De.byteToBitArr(a.readByte());d.gctFlag=e.shift(),d.colorRes=De.bitsToNum(e.splice(0,3)),d.sorted=e.shift(),d.gctSize=De.bitsToNum(e.splice(0,3)),d.bgColor=a.readByte(),d.pixelAspectRatio=a.readByte(),d.gctFlag&&(d.gct=c(1<<d.gctSize+1)),b.hdr&&b.hdr(d)},f=function(c){var e=function(c){var d=(a.readByte(),De.byteToBitArr(a.readByte()));c.reserved=d.splice(0,3),c.disposalMethod=De.bitsToNum(d.splice(0,3)),c.userInput=d.shift(),c.transparencyGiven=d.shift(),c.delayTime=a.readUnsigned(),c.transparencyIndex=a.readByte(),c.terminator=a.readByte(),b.gce&&b.gce(c)},f=function(a){a.comment=d(),b.com&&b.com(a)},g=function(c){a.readByte();c.ptHeader=a.readBytes(12),c.ptData=d(),b.pte&&b.pte(c)},h=function(c){{var e=function(c){a.readByte();c.unknown=a.readByte(),c.iterations=a.readUnsigned(),c.terminator=a.readByte(),b.app&&b.app.NETSCAPE&&b.app.NETSCAPE(c)},f=function(a){a.appData=d(),b.app&&b.app[a.identifier]&&b.app[a.identifier](a)};a.readByte()}switch(c.identifier=a.read(8),c.authCode=a.read(3),c.identifier){case"NETSCAPE":e(c);break;default:f(c)}},i=function(a){a.data=d(),b.unknown&&b.unknown(a)};switch(c.label=a.readByte(),c.label){case 249:c.extType="gce",e(c);break;case 254:c.extType="com",f(c);break;case 1:c.extType="pte",g(c);break;case 255:c.extType="app",h(c);break;default:c.extType="unknown",i(c)}},g=function(e){var f=function(a,b){for(var c=new Array(a.length),d=a.length/b,e=function(d,e){var f=a.slice(e*b,(e+1)*b);c.splice.apply(c,[d*b,b].concat(f))},f=[0,4,2,1],g=[8,8,4,2],h=0,i=0;4>i;i++)for(var j=f[i];d>j;j+=g[i])e(j,h),h++;return c};e.leftPos=a.readUnsigned(),e.topPos=a.readUnsigned(),e.width=a.readUnsigned(),e.height=a.readUnsigned();var g=De.byteToBitArr(a.readByte());e.lctFlag=g.shift(),e.interlaced=g.shift(),e.sorted=g.shift(),e.reserved=g.splice(0,2),e.lctSize=De.bitsToNum(g.splice(0,3)),e.lctFlag&&(e.lct=c(1<<e.lctSize+1)),e.lzwMinCodeSize=a.readByte();var h=d();e.pixels=De.lzwDecode(e.lzwMinCodeSize,h),e.interlaced&&(e.pixels=f(e.pixels,e.width)),b.img&&b.img(e)},h=function(){var c={};switch(c.sentinel=a.readByte(),String.fromCharCode(c.sentinel)){case"!":c.type="ext",f(c);break;case",":c.type="img",g(c);break;case";":c.type="eof",b.eof&&b.eof(c);break;default:throw new Error("Unknown block: 0x"+c.sentinel.toString(16))}"eof"!==c.type&&setTimeout(h,0)},i=function(){e(),setTimeout(h,0)};i()},He=function(a,b,c){var d=Oc.createElement("canvas");return Ie(d,b.width,b.height),d.getContext("2d").clearRect(0,0,b.width,b.height),d.getContext("2d").putImageData(a[c].data,0,0),d},Ie=function(a,b,c){a.width=b,a.height=c,a.style.width=b+"px",a.style.height=c+"px"};Ic.Data=function(a){if(Ic.Data.superClass.constructor.apply(this,arguments),this._childList=new me,this._childMap={},this._clientMap={},a===b||null===a)this._id=Jc.id();else if("string"==typeof a||"number"==typeof a||"boolean"==typeof a)this._id=a;else{for(var c in a)if("clients"===c)for(var d in a.clients)this._clientMap[d]=a.clients[d];else if("styles"===c)for(var e in a.styles)this._styleMap[e]=a.styles[e];else null!=a[c]&&(this["_"+c]=a[c]);null==this._id&&(this._id=Jc.id())}},Jc.ext("twaver.Data",Ic.PropertyChangeDispatcher,{IData:!0,IClient:!0,__client:1,__new:1,_parent:null,__accessor:["name","name2","icon","toolTip"],_icon:Ce.ICON_DATA,getId:function(){return this._id},getChildren:function(){return this._childList},getChildrenSize:function(){return this._childList.size()},toChildren:function(a,b){return this._childList.toList(a,b)},addChild:function(a,c){return c===b&&(c=this._childList.size()),a&&a!==this?this._childMap[a.getId()]?!1:this.isDescendantOf(a)?!1:(a.getParent()&&a.getParent().removeChild(a),(0>c||c>this._childList.size())&&(c=this._childList.size()),this._childList.add(a,c),this._childMap[a._id]=a,a.setParent(this),this.firePropertyChange("children",null,a),this.onChildAdded(a,c),!0):!1},onChildAdded:function(){},removeChild:function(a){if(!a)return!1;if(!this._childMap[a._id])return!1;var b=this._childList.remove(a);return delete this._childMap[a._id],this.firePropertyChange("children",a,null),a.setParent(null),this.onChildRemoved(a,b),!0},onChildRemoved:function(){},getChildAt:function(a){return this._childList.get(a)},clearChildren:function(){if(0===this._childList.size())return!1;for(var a=this._childList.toArray(),b=a.length,c=0;b>c;c++)this.removeChild(a[c]);return this.onChildrenCleared(a),!0},onChildrenCleared:function(){},getParent:function(){return this._parent},setParent:function(a){if(!(this._isUpdatingParent||this._parent===a||this===a||a&&a.isDescendantOf(this))){var b=this._parent;this._parent=a,this._isUpdatingParent=!0,b&&b.removeChild(this),a&&a.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",b,a),this.onParentChanged(b,a)}},onParentChanged:function(){},hasChildren:function(){return this._childList.size()>0},isRelatedTo:function(a){return a?this.isDescendantOf(a)||a.isDescendantOf(this):!1},isParentOf:function(a){return a?null!=this._childMap[a._id]:!1},isDescendantOf:function(a){if(!a)return!1;if(!a.hasChildren())return!1;for(var b=this._parent;b;){if(a===b)return!0;b=b.getParent()}return!1},toString:function(){return this.getName()?this.getName():this._id}}),Ic.Alarm=function(a,b,c,d,e){Ic.Alarm.superClass.constructor.call(this,a),this._elementId=b,this._alarmSeverity=c,this._acked=d||!1,this._cleared=e||!1},Jc.ext("twaver.Alarm",Ic.Data,{IAlarm:!0,getElementId:function(){return this._elementId},__accessor:["acked","cleared","alarmSeverity"]}),Ic.Layer=function(a){Ic.Layer.superClass.constructor.call(this,a)},Jc.ext("twaver.Layer",Ic.Data,{ILayer:!0,__accessor:["visible","movable","editable","rotatable"],_visible:!0,_movable:!0,_editable:!0,_rotatable:!0,_name:"Default"}),Ic.Element=function(a){this._styleMap=this._styleMap||{},this._alarmState=new Ic.AlarmState(this),Ic.Element.superClass.constructor.call(this,a)},Jc.ext("twaver.Element",Ic.Data,{IElement:!0,IStyle:!0,__accessor:["layerId"],__bool:["visible"],__style:1,_layerId:Ce.LAYER_DEFAULT_ID,_visible:!0,getAlarmState:function(){return this._alarmState},isAdjustedToBottom:function(){return!1},getElementUIClass:function(){return null},getCanvasUIClass:function(){return null},getVectorUIClass:function(){return null},s:function(a,c){return c===b?this.getStyle(a):(this.setStyle(a,c),this)}}),Ic.Dummy=function(a){Ic.Dummy.superClass.constructor.call(this,a)},Jc.ext("twaver.Dummy",Ic.Element,{IDummy:!0});var Je=function(a){this._location={x:0,y:0},Je.superClass.constructor.call(this,a)};Ic.Node=Je,Je.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},Jc.ext("twaver.Node",Ic.Element,{_icon:Ce.ICON_NODE,_image:Ce.IMAGE_NODE,_angle:0,getLoopedLinks:function(){return this._loopedLinks},getLinks:function(){return this._links},getAgentLinks:function(){return this._agentLinks},getFollowers:function(){return this._followers},_addFollower:function(a){this._followers||(this._followers=new me),this._followers.add(a)},_removeFollower:function(a){this._followers.remove(a),this._followers.isEmpty()&&delete this._followers},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(a){this._allLinks||(this._allLinks=new me),this._fromLinks||(this._fromLinks=new me),this._allLinks.add(a),this._fromLinks.add(a),this._resetLinkSet()},_addToLink:function(a){this._allLinks||(this._allLinks=new me),this._toLinks||(this._toLinks=new me),this._allLinks.add(a),this._toLinks.add(a),this._resetLinkSet()},_removeFromLink:function(a){this._allLinks.remove(a),this._fromLinks.remove(a),0===this._allLinks.size()&&delete this._allLinks,0===this._fromLinks.size()&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(a){this._allLinks.remove(a),this._toLinks.remove(a),0===this._allLinks.size()&&delete this._allLinks,0===this._toLinks.size()&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){if(delete this._loopedLinks,!this._allLinks||0===this._allLinks.size())return void delete this._links;var a;this._allLinks.forEach(function(b){b.isLooped()&&(a||(a={}),a[b._id]||(this._loopedLinks||(this._loopedLinks=new me),this._loopedLinks.add(b),a[b._id]=b))},this),a?(this._links=new me,this._allLinks.forEach(function(b){a[b._id]?a[b._id]!==!1&&(a[b._id]=!1,this._links.add(b)):this._links.add(b)},this)):this._links=this._allLinks},hasAgentLinks:function(){return null!=this._agentLinks&&!this._agentLinks.isEmpty()},getFromAgentLinks:function(){return this._fromAgentLinks},getToAgentLinks:function(){return this._toAgentLinks},_addFromAgentLink:function(a){this._fromAgentLinks||(this._fromAgentLinks=new me),this._allAgentLinks||(this._allAgentLinks=new me),this._fromAgentLinks.add(a),this._allAgentLinks.add(a),this._resetAgentLinkSet()},_addToAgentLink:function(a){this._toAgentLinks||(this._toAgentLinks=new me),this._allAgentLinks||(this._allAgentLinks=new me),this._toAgentLinks.add(a),this._allAgentLinks.add(a),this._resetAgentLinkSet()
},_removeFromAgentLink:function(a){this._fromAgentLinks.remove(a),this._allAgentLinks.remove(a),0===this._fromAgentLinks.size()&&delete this._fromAgentLinks,0===this._allAgentLinks.size()&&delete this._allAgentLinks,this._resetAgentLinkSet()},_removeToAgentLink:function(a){this._toAgentLinks.remove(a),this._allAgentLinks.remove(a),0===this._toAgentLinks.size()&&delete this._toAgentLinks,0===this._allAgentLinks.size()&&delete this._allAgentLinks,this._resetAgentLinkSet()},_resetAgentLinkSet:function(){if(delete this._agentLinks,this._allAgentLinks&&0!==this._allAgentLinks.size()){var a={};this._allAgentLinks.forEach(function(b){a[b._id]?this._agentLinks||(this._agentLinks=new me):a[b._id]=b},this),this._agentLinks?this._allAgentLinks.forEach(function(b){a[b._id]&&(this._agentLinks.add(b),delete a[b._id])},this):this._agentLinks=this._allAgentLinks}},getImage:function(){return this._image},setImage:function(a){var b=this._image,c=this.getWidth(),d=this.getHeight();this._image=a,this.firePropertyChange("image",b,a),this.firePropertyChange("width",c,this.getWidth()),this.firePropertyChange("height",d,this.getHeight())},getX:function(){return this._location.x},getY:function(){return this._location.y},setX:function(a){this.setLocation(a,this._location.y)},setY:function(a){this.setLocation(this._location.x,a)},getLocation:function(){return this._location},setLocation:function(){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],Jc.num(a.x)&&Jc.num(a.y)&&(a.x!==this._location.x||a.y!==this._location.y)){var b=this._location;this._location=a,this.firePropertyChange("location",b,a)}},getCenterLocation:function(){return Ce.CENTER_LOCATION?this._location:{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},setCenterLocation:function(){var a;a=2===arguments.length?{x:arguments[0],y:arguments[1]}:Jc.clone(arguments[0]),Jc.num(a.x)&&Jc.num(a.y)&&(Ce.CENTER_LOCATION||(a.x-=this.getWidth()/2,a.y-=this.getHeight()/2),this.setLocation(a))},translate:function(a,b){this.setLocation(this.getX()+a,this.getY()+b)},getWidth:function(){if(Jc.num(this._width)&&this._width>=0)return this._width;if("object"!=typeof this._image){var a=Jc.getImageAsset(this._image);if(a){var b=a.getWidth();return Jc.num(b)&&b>=0?b:(a=a._image,Yd(this,a,a,"w"))}}else if(this._image)return this._image.w;return Ce.NODE_WIDTH},setWidth:function(a){var b=this._width;this._width=a,this.firePropertyChange("width",b,a)},getHeight:function(){if(Jc.num(this._height)&&this._height>=0)return this._height;if("object"!=typeof this._image){var a=Jc.getImageAsset(this._image);if(a){var b=a.getHeight();return Jc.num(b)&&b>=0?b:(a=a._image,Yd(this,a,a,"h"))}}else if(this._image)return this._image.h;return Ce.NODE_HEIGHT},setHeight:function(a){var b=this._height;this._height=a,this.firePropertyChange("height",b,a)},setSize:function(){2===arguments.length?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getRect:function(){var a=this.getOriginalRect();if(0===this._angle)return a;for(var b=Tc.createMatrix(this._angle*Math.PI/180,a.x+a.width/2,a.y+a.height/2),c=[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}],d=0,e=c.length;e>d;d++)c[d]=b.transform(c[d]);var f=Tc.getRect(c);return f},getOriginalRect:function(){var a=this,b=a.getWidth(),c=a.getHeight();return Ce.CENTER_LOCATION?{x:a._location.x-b/2,y:a._location.y-c/2,width:b,height:c}:{x:a.getX(),y:a.getY(),width:b,height:c}},getAngle:function(){return this._angle},setAngle:function(a){var b=this._angle;this._angle=a%360,this.firePropertyChange("angle",b,this._angle)},onParentChanged:function(a,b){Je.superClass.onParentChanged.call(this,a,b),this._checkLinkAgent()},_checkLinkAgent:function(){if(Ic._isInitializing){if(this._links)for(var a=this._links.size(),b=0;a>b;b++)this._links.get(b)._checkAgentNode()}else Ic.ElementBox.prototype.startBatch(function(){if(this._links)for(var a=this._links.size(),b=0;a>b;b++)this._links.get(b)._checkAgentNode()},this)},onPropertyChanged:function(a){if(Je.superClass.onPropertyChanged.call(this,a),this._followers)for(var b=this._followers.size(),c=0;b>c;c++)this._followers.get(c).handleHostPropertyChange(a);this.getParent()instanceof Ke&&Je.IS_INTERESTED_NODE_PROPERTY[a.property]&&this.getParent().updateLocationFromChildren()},getElementUIClass:function(){return Ic.network.NodeUI},getCanvasUIClass:function(){return Ic.canvas.NodeUI},getVectorUIClass:function(){return Ic.vector.NodeUI}}),Ic.Link=function(a,b,c){Ic.Link.superClass.constructor.call(this,a instanceof Je?null:a),a instanceof Je&&(c=b,b=a),this.setFromNode(b),this.setToNode(c)},Ic.Link.IS_INTERESTED_BUNDLE_STYLE={"link.bundle.enable":1,"link.bundle.id":1,"link.bundle.independent":1},Jc.ext("twaver.Link",Ic.Element,{_fromNode:null,_toNode:null,_fromAgent:null,_toAgent:null,_icon:Ce.ICON_LINK,getFromNode:function(){return this._fromNode},getToNode:function(){return this._toNode},getFromAgent:function(){return this._fromAgent},getToAgent:function(){return this._toAgent},setFromNode:function(a){if(this._fromNode!==a){var b=this._fromNode;this._fromNode=a,b&&b._removeFromLink(this),this._fromNode&&this._fromNode._addFromLink(this),this._checkAgentNode(),this.firePropertyChange("fromNode",b,a)}},setToNode:function(a){if(this._toNode!==a){var b=this._toNode;this._toNode=a,b&&b._removeToLink(this),this._toNode&&this._toNode._addToLink(this),this._checkAgentNode(),this.firePropertyChange("toNode",b,a)}},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},_checkAgentNode:function(){Ic._isInitializing?Ic._links[this._id]||(Ic._links[this._id]=this):this._checkAgentNodeImpl()},_checkAgentNodeImpl:function(){var a,b,c=vd.figureFromAgent(this),d=this;this._fromAgent!=c&&(a=this._fromAgent,this._fromAgent&&this._fromAgent._removeFromAgentLink(this),this._fromAgent=c,this._fromAgent&&this._fromAgent._addFromAgentLink(this),this.firePropertyChange("fromAgent",a,this._fromAgent),Ic._isInitializing?(a&&this._toAgent&&(b=a._id+":"+this._toAgent._id,Ic._bundleLinks[b]||(Ic._bundleLinks[b]=[a,this._toAgent])),this._fromAgent&&this._toAgent&&(b=this._fromAgent._id+":"+this._toAgent._id,Ic._bundleLinks[b]||(Ic._bundleLinks[b]=[this._fromAgent,this._toAgent]))):(vd.resetBundleLinks(a,d._toAgent),vd.resetBundleLinks(d._fromAgent,d._toAgent)));var e=vd.figureToAgent(this);this._toAgent!=e&&(a=this._toAgent,this._toAgent&&this._toAgent._removeToAgentLink(this),this._toAgent=e,this._toAgent&&this._toAgent._addToAgentLink(this),this.firePropertyChange("toAgent",a,this._toAgent),Ic._isInitializing?(a&&this._fromAgent&&(b=a._id+":"+this._fromAgent._id,Ic._bundleLinks[b]||(Ic._bundleLinks[b]=[a,this._fromAgent])),this._toAgent&&this._fromAgent&&(b=this._toAgent._id+":"+this._fromAgent._id,Ic._bundleLinks[b]||(Ic._bundleLinks[b]=[this._toAgent,this._fromAgent]))):(vd.resetBundleLinks(a,d._fromAgent),vd.resetBundleLinks(d._toAgent,d._fromAgent)))},_setBundleLinks:function(a){this._bundleLinks=a,this.firePropertyChange("bundleLinks",!0,!1)},getBundleLinks:function(){return this._bundleLinks},getBundleCount:function(){return this._bundleLinks?this._bundleLinks.getLinks().size():1},getBundleIndex:function(){return this._bundleLinks?this._bundleLinks.getLinks().indexOf(this):0},reverseBundleExpanded:function(){if(this._bundleLinks&&this._bundleLinks.getLinks().size()>0){var a,b,c=this._bundleLinks.getLinks(),d=!this.getStyle("link.bundle.expanded");for(a=0;a<c.size();a++)b=c.get(a),b.setStyle("link.bundle.expanded",d);var e=this._bundleLinks.getSiblings();for(a=0;a<e.size();a++){var f=e.get(a);if(f!=this._bundleLinks){c=f.getLinks();for(var g=0;g<c.size();g++)b=c.get(g),b.firePropertyChange("bundleLinks",null,f)}}return!0}return!1},isBundleAgent:function(){return null!=this._bundleLinks&&this._bundleLinks.getLinks().size()>1&&this===this._bundleLinks.getLinks().get(0)&&!this.getStyle("link.bundle.expanded")},onStyleChanged:function(a,b,c){Ic.Link.superClass.onStyleChanged.call(this,a,b,c),Ic.Link.IS_INTERESTED_BUNDLE_STYLE[a]&&vd.resetBundleLinks(this._toAgent,this._fromAgent)},getElementUIClass:function(){return Ic.network.LinkUI},getCanvasUIClass:function(){return Ic.canvas.LinkUI},getVectorUIClass:function(){return Ic.vector.LinkUI},isAdjustedToBottom:function(){return Ce.IS_LINK_ADJUSTED_TO_BOTTOM}}),Ic.Follower=function(a){this._isUpdatingFollower=!1,this._isUpdatingLocation=!1,Ic.Follower.superClass.constructor.call(this,a)},Ic.Follower.IS_INTERESTED_HOST_GRID_PROPERTY={location:1,width:1,height:1,"S:grid.row.count":1,"S:grid.column.count":1,"S:grid.row.percents":1,"S:grid.column.percents":1,"S:grid.border":1,"S:grid.border.left":1,"S:grid.border.right":1,"S:grid.border.top":1,"S:grid.border.bottom":1,"S:grid.padding":1,"S:grid.padding.left":1,"S:grid.padding.right":1,"S:grid.padding.top":1,"S:grid.padding.bottom":1},Ic.Follower.IS_INTERESTED_FOLLOWER_STYLE={"follower.row.index":1,"follower.column.index":1,"follower.row.span":1,"follower.column.span":1,"follower.padding":1,"follower.padding.left":1,"follower.padding.right":1,"follower.padding.top":1,"follower.padding.bottom":1},Jc.ext("twaver.Follower",Je,{_host:null,getHost:function(){return this._host},setHost:function(a){if(this!==a&&this._host!==a){var b=this._host;b&&b._removeFollower(this),this._host=a,this._host&&this._host._addFollower(this),this.firePropertyChange("host",b,a),this.onHostChanged(b,a)}},onStyleChanged:function(a,b,c){Ic.Follower.superClass.onStyleChanged.call(this,a,b,c),Ic.Follower.IS_INTERESTED_FOLLOWER_STYLE[a]&&this.updateFollower(null)},setLocation:function(){this._isUpdatingLocation||(this._isUpdatingLocation=!0,Ic.Follower.superClass.setLocation.apply(this,arguments),this._isUpdatingLocation=!1)},onHostChanged:function(){this.updateFollower(null)},handleHostPropertyChange:function(a){this.updateFollower(a)},updateFollower:function(a){this._isUpdatingFollower||Jc.isDeserializing||(this._isUpdatingFollower=!0,this.updateFollowerImpl(a),this._isUpdatingFollower=!1)},updateFollowerImpl:function(a){var b=this.getHost();if(b instanceof Ic.Grid){if(!a||Ic.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[a.property]){var c=this.getStyle("follower.row.index"),d=this.getStyle("follower.column.index"),e=b.getCellRect(c,d);if(!e)return;var f=this.getStyle("follower.row.span"),g=this.getStyle("follower.column.span");if(1!=f||1!=g){var h=b.getCellRect(c+f-1,d+g-1);h&&(e=Tc.unionRect(e,h))}if(Tc.addPadding(e,this,"follower.padding"),this.getStyle("follower.fill.cell"))this.setLocation(e.x,e.y),this.setWidth(e.width),this.setHeight(e.height);else{var i=this.getStyle("follower.cell.position");e=Vc.get(i,e,this.getRect()),this.setLocation(e.x,e.y)}}}else if(null!=a&&"location"===a.property){var j=a.oldValue,k=a.newValue,l=this.getLocation();this.setLocation(l.x+(k.x-j.x),l.y+(k.y-j.y))}},isHostOn:function(a){if(!a)return!1;for(var b={},c=this._host;c&&c!=this&&!b[c.getId()];){if(c===a)return!0;b[c.getId()]=c,c=c instanceof Ic.Follower?c.getHost():null}return!1},isLoopedHostOn:function(a){return this.isHostOn(a)&&a.isHostOn(this)}});var Ke=function(a){this._isUpdatingLocationFromChildren=!1,this._isAdjusting=!1,this._expanded=!1,Ke.superClass.constructor.call(this,a)};Ic.Group=Ke,Jc.ext("twaver.Group",Ic.Follower,{_image:Ce.IMAGE_GROUP,_icon:Ce.ICON_GROUP,isAdjustedToBottom:function(){return this.isExpanded()&&vd.hasAgentLinks(this)},onChildAdded:function(){Ke.superClass.onChildAdded.apply(this,arguments),this.updateLocationFromChildren()},onChildRemoved:function(){Ke.superClass.onChildRemoved.apply(this,arguments),this.updateLocationFromChildren()},updateLocationFromChildren:function(){if(!this._isAdjusting&&!Jc.isDeserializing){for(var a,b,c=0,d=this.getChildrenSize();d>c;c++)b=this.getChildAt(c),b instanceof Je&&(a=Tc.unionRect(a,this.getChildRect(b)));a&&(this._isUpdatingLocationFromChildren=!0,this.setLocation(a.x+a.width/2-this.getWidth()/2,a.y+a.height/2-this.getHeight()/2),this._isUpdatingLocationFromChildren=!1)}},getChildRect:function(a){var b;return a instanceof Je&&(a instanceof Ke?(a.isExpanded()&&a.getChildren().forEach(function(c){b=Tc.unionRect(b,a.getChildRect(c))}),b||(b=a.getRect())):b=a.getRect()),b},setLocation:function(){if(!this._isAdjusting){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Jc.isDeserializing&&!this._isUpdatingLocationFromChildren){this._isAdjusting=!0;var b=a.x-this.getX(),c=a.y-this.getY();vd.moveElements(this.getChildren(),b,c),this._isAdjusting=!1}Ke.superClass.setLocation.call(this,a)}},reverseExpanded:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._expanded},setExpanded:function(a){if(this._expanded!==a){var b=this._expanded;this._expanded=a,this.firePropertyChange("expanded",b,this._expanded),this._checkLinkAgent()}},_checkLinkAgent:function(){Ke.superClass._checkLinkAgent.call(this);for(var a=this.getChildrenSize(),b=0;a>b;b++){var c=this.getChildAt(b);c instanceof Je&&c._checkLinkAgent()}},getElementUIClass:function(){return Ic.network.GroupUI},getCanvasUIClass:function(){return Ic.canvas.GroupUI},getVectorUIClass:function(){return Ic.vector.GroupUI}}),Ic.SubNetwork=function(a){Ic.SubNetwork.superClass.constructor.call(this,a)},Jc.ext("twaver.SubNetwork",Ic.Follower,{ISubNetwork:!0,_image:Ce.IMAGE_SUBNETWORK,_icon:Ce.ICON_SUBNETWORK,_checkLinkAgent:function(){Ic.SubNetwork.superClass._checkLinkAgent.call(this);for(var a=this.getChildrenSize(),b=0;a>b;b++){var c=this.getChildAt(b);c instanceof Je&&c._checkLinkAgent()}}}),Ic.Grid=function(a){Ic.Grid.superClass.constructor.call(this,a)},Jc.ext("twaver.Grid",Ic.Follower,{_icon:Ce.ICON_GRID,_image:null,getCellObject:function(a,b){1===arguments.length&&(b=a.y,a=a.x);for(var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count"),e=0;c>e;e++)for(var f=0;d>f;f++){var g=this.getCellRect(e,f);if(Tc.containsPoint(g,a,b))return{rowIndex:e,columnIndex:f,rect:g}}return null},getCellRect:function(a,b){var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count");if(0>=c||0>=d)return null;if(0>a||a>=c)return null;if(0>b||b>=d)return null;var e=this.getRect();Tc.addPadding(e,this,"grid.border");var f=0,g=this.getStyle("grid.row.percents"),h=this.getStyle("grid.column.percents");if(g&&g.length===c){var i=0;for(f=0;a>f;f++)i+=e.height*g[f];e.y+=i,e.height=e.height*g[a]}else e.height=e.height/c,e.y+=e.height*a;if(h&&h.length===d){var j=0;for(f=0;b>f;f++)j+=e.width*h[f];e.x+=j,e.width=e.width*h[b]}else e.width=e.width/d,e.x+=e.width*b;return Tc.addPadding(e,this,"grid.padding"),e},getElementUIClass:function(){return Ic.network.GridUI},getCanvasUIClass:function(){return Ic.canvas.GridUI},getVectorUIClass:function(){return Ic.vector.GridUI}}),Ic.ShapeNode=function(a){this._isUpdatingShapeNode=!1,this._points=new me,Ic.ShapeNode.superClass.constructor.call(this,a)},Jc.ext("twaver.ShapeNode",Ic.Follower,{_icon:Ce.ICON_SHAPENODE,__accessor:["segments"],getElementUIClass:function(){return Ic.network.ShapeNodeUI},getCanvasUIClass:function(){return Ic.canvas.ShapeNodeUI},getVectorUIClass:function(){return Ic.vector.ShapeNodeUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new me),this._points=a,this.firePointsChange()},getSegments:function(){return this._segments},setSegments:function(a){a||(a=new me),this._segments=a,this._reCalculateLineLength(),this.firePointsChange()},addPoint:function(a,b){this._points.add(a,b),this.firePointsChange()},setPoint:function(a,b){this._points.set(a,b),this.firePointsChange()},removePoint:function(a){this._points.remove(a),this.firePointsChange()},removeAt:function(a){this._points.removeAt(a),this.firePointsChange()},setWidth:function(a){if(1>a&&(a=1),!this._isUpdatingShapeNode&&!Jc.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=0;b<this._points.size();b++){var c=this._points.get(b);c.x=(c.x-this.getX())*a/this.getWidth()+this.getX()}this.firePointsChange(),this._isUpdatingShapeNode=!1}Ic.ShapeNode.superClass.setWidth.apply(this,arguments)},setHeight:function(a){if(1>a&&(a=1),!this._isUpdatingShapeNode&&!Jc.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=0;b<this._points.size();b++){var c=this._points.get(b);c.y=(c.y-this.getY())*a/this.getHeight()+this.getY()}this.firePointsChange(),this._isUpdatingShapeNode=!1}Ic.ShapeNode.superClass.setHeight.apply(this,arguments)},setLocation:function(){if(!this._isUpdatingShapeNode&&!Jc.isDeserializing){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Jc.num(a.x)||!Jc.num(a.y))return;var b=a.x-this.getX(),c=a.y-this.getY();if(0===b&&0===c)return;this._isUpdatingShapeNode=!0;for(var d=0;d<this._points.size();d++){var e=this._points.get(d);e.x+=b,e.y+=c}this.firePointsChange(),this._isUpdatingShapeNode=!1}Ic.ShapeNode.superClass.setLocation.apply(this,arguments)},firePointsChange:function(){if(!this._isUpdatingShapeNode&&!Jc.isDeserializing){var a=Tc.getRect(this._points);a?(this._isUpdatingShapeNode=!0,Ce.CENTER_LOCATION?this.setLocation(a.x+a.width/2,a.y+a.height/2):this.setLocation(a.x,a.y),this.setWidth(a.width),this.setHeight(a.height),this._isUpdatingShapeNode=!1):(this._isUpdatingShapeNode=!0,this.setWidth(0),this.setHeight(0),this._isUpdatingShapeNode=!1)}this._reCalculateLineLength(),this.firePropertyChange("points",null,this._points)},_reCalculateLineLength:function(){this._lineLength=null!=this._points&&this._points.size()>0?Tc.calculateLineLength(this._points,this._segments):0},getLineLength:function(){return this._lineLength}}),Ic.Bus=function(a){this._styleMap={},this._styleMap["vector.fill"]=!1,this._styleMap["shapenode.closed"]=!1,Ic.Bus.superClass.constructor.call(this,a)},Jc.ext("twaver.Bus",Ic.ShapeNode,{_icon:Ce.ICON_BUS,firePointsChange:function(){var a=this._points.size();if(!Jc.isDeserializing&&a>=2)for(var b=this._points.get(0),c=1;a>c;c++){var d=this._points.get(c);Math.abs(d.x-b.x)>Math.abs(d.y-b.y)?d.y=b.y:d.x=b.x,b=d}Ic.Bus.superClass.firePointsChange.apply(this,arguments)}}),Ic.ShapeLink=function(a,b,c){this._points=new me,this._styleMap={},this._styleMap["link.bundle.enable"]=!1,Ic.ShapeLink.superClass.constructor.call(this,a,b,c)},Jc.ext("twaver.ShapeLink",Ic.Link,{_icon:Ce.ICON_SHAPELINK,getElementUIClass:function(){return Ic.network.ShapeLinkUI},getCanvasUIClass:function(){return Ic.canvas.ShapeLinkUI},getVectorUIClass:function(){return Ic.vector.ShapeLinkUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new me),this._points=a,this.firePointsChange()},addPoint:function(a,b){this._points.add(a,b),this.firePointsChange()},setPoint:function(a,b){this._points.set(a,b),this.firePointsChange()},removePoint:function(a){this._points.remove(a),this.firePointsChange()},removeAt:function(a){this._points.removeAt(a),this.firePointsChange()},firePointsChange:function(){this.firePropertyChange("points",null,this._points)}}),Ic.ShapeSubNetwork=function(a){Ic.ShapeSubNetwork.superClass.constructor.call(this,a)},Jc.ext("twaver.ShapeSubNetwork",Ic.ShapeNode,{ISubNetwork:!0,_icon:Ce.ICON_SHAPESUBNETWORK,_checkLinkAgent:function(){Ic.ShapeSubNetwork.superClass._checkLinkAgent.call(this);for(var a=this.getChildrenSize(),b=0;a>b;b++){var c=this.getChildAt(b);c instanceof Je&&c._checkLinkAgent()}}}),Ic.LinkSubNetwork=function(){Ic.LinkSubNetwork.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.LinkSubNetwork",Ic.Link,{ISubNetwork:!0,_icon:Ce.ICON_LINKSUBNETWORK}),Ic.RotatableNode=function(a){Ic.RotatableNode.superClass.constructor.call(this,a)},Jc.ext("twaver.RotatableNode",Ic.Follower,{getWidth:function(){return 0==this._angle?this._getOrignalWidth():this._getRotateRect().width},setWidth:function(){},getHeight:function(){return 0==this._angle?this._getOrignalHeight():this._getRotateRect().height},setHeight:function(){},getElementUIClass:function(){return Ic.network.RotatableNodeUI},getCanvasUIClass:function(){return Ic.canvas.RotatableNodeUI},getVectorUIClass:function(){return Ic.vector.RotatableNodeUI},_getRotateRect:function(){for(var a=this._getOrignalWidth(),b=this._getOrignalHeight(),c=Tc.createMatrix(this._angle*Math.PI/180,a/2,b/2),d=[{x:0,y:0},{x:a,y:0},{x:a,y:b},{x:0,y:b}],e=0,f=d.length;f>e;e++)d[e]=c.transform(d[e]);return Tc.getRect(d)},_getOrignalWidth:function(){return Ic.RotatableNode.superClass.getWidth.call(this)},_getOrignalHeight:function(){return Ic.RotatableNode.superClass.getHeight.call(this)}}),Ic.controls.ControlBase=function(){Ic.controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new me},Jc.ext("twaver.controls.ControlBase",Ic.PropertyChangeDispatcher,{addPool:function(a){this._pools.contains(a)||this._pools.add(a)},removePool:function(a){this._pools.remove(a)},adjustBounds:function(a){var b=this._view.style;b.position="absolute",b.left=a.x+"px",b.top=a.y+"px",b.width=a.width+"px",b.height=a.height+"px",this.invalidate&&this.invalidate()},getView:function(){return this._view},invalidate:function(a){this._invalidate||(this._invalidate=!0,Jc.callLater(this.validate,this,null,a))},validate:function(){this._invalidate&&(this._invalidate=!1,0===this._view.offsetWidth&&0===this._view.offsetHeight&&null!==this._reinvalidateCount?(this._reinvalidateCount===b&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl())},validateImpl:function(){}}),Ic.controls.ViewBase=function(){Ic.controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new Ic.EventDispatcher,this._viewDispatcher=new Ic.EventDispatcher},Jc.ext("twaver.controls.ViewBase",Ic.controls.ControlBase,{__bool:["focusOnClick"],_focusOnClick:Ce.FOCUS_ON_CLICK,getSelectionModel:function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},isShareSelectionModel:function(){return null==this._selectionModel},setShareSelectionModel:function(a){var b=null==this._selectionModel;b!==a&&(a?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new Ic.SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",b,a))},removeSelection:function(){if(0===this.getSelectionModel().size())return null;var a=this.getSelectionModel().toSelection();return a.forEach(function(a){this._box.remove(a)},this),a},selectAll:function(){var a=new me;return this._box.forEach(function(b){this.isVisible(b)&&a.add(b)},this),this.getSelectionModel().setSelection(a),a},isSelected:function(a){return this.getSelectionModel().contains(a)},isSelectable:function(a){return this.getSelectionModel().isSelectable(a)},getLabel:function(a){return a.getName()},getToolTip:function(a){return a.getToolTip()},getIcon:function(a){return a.getIcon()},getSelectColor:function(){return Ce.SELECT_COLOR},addViewListener:function(a,b,c){this._viewDispatcher.add(a,b,c)},removeViewListener:function(a,b){this._viewDispatcher.remove(a,b)},fireViewEvent:function(a){this._viewDispatcher.fire(a)},addInteractionListener:function(a,b,c){this._interactionDispatcher.add(a,b,c)},removeInteractionListener:function(a,b){this._interactionDispatcher.remove(a,b)},fireInteractionEvent:function(a){this._interactionDispatcher.fire(a)},invalidate:function(a){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),Jc.callLater(this.validate,this,null,a))},validate:function(){this._invalidate&&(this._invalidate=!1,Mc||0!==this._view.offsetWidth||0!==this._view.offsetHeight||null===this._reinvalidateCount?(this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating):(this._reinvalidateCount===b&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()))}}),Ic.controls.View=function(){Ic.controls.View.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.controls.View",Ic.controls.ViewBase,{_zoom:1,_maxZoom:Ce.ZOOM_MAX,_minZoom:Ce.ZOOM_MIN,getRootDiv:function(){return this._rootDiv},isValidEvent:function(a){return Wc.isValidEvent(this._view,a)},getAlarmFillColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b)return b.color}return null},getInnerColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:a.getStyle("inner.color")}return null},getOuterColor:function(a){if(a.IElement){var b=a.getAlarmState().getPropagateSeverity();return b?b.color:a.getStyle("outer.color")}return null},zoomOverview:function(a){var b=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(b,a)},getLogicalPoint:function(a){return Wc.getLogicalPoint(this._view,a,this.getZoom(),this._rootDiv)},centerByLogicalPoint:function(a,b,c){c&&Ic.animate.AnimateManager.endAnimate();var d=this._view.scrollWidth-this._view.clientWidth,e=this._view.scrollHeight-this._view.clientHeight,f=(a-this._view.clientWidth/this._zoom/2)*this._zoom,g=(b-this._view.clientHeight/this._zoom/2)*this._zoom;0>f&&(f=0),0>g&&(g=0),f>d&&(f=d),g>e&&(g=e),c?Ic.animate.AnimateManager.start(new Ic.animate.AnimateScrollPosition(this._view,f,g)):(this._view.scrollLeft=f,this._view.scrollTop=g)},panByOffset:function(a,b){a*=this.getZoom(),b*=this.getZoom();var c=this._view.scrollLeft+a,d=this._view.scrollTop+b,e=this._view.scrollWidth-this._view.clientWidth,f=this._view.scrollHeight-this._view.clientHeight;0>c&&(c=0),c>e&&(c=e),0>d&&(d=0),d>f&&(d=f);var g={x:(c-this._view.scrollLeft)/this.getZoom(),y:(d-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=c,this._view.scrollTop=d,g},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(!(0>a)){var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getZoom()>a&&this.setZoom(a)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(!(0>a)){var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getZoom()<a&&this.setZoom(a,!1)}},getZoom:function(){return this._zoom},onZoomChanged:function(){},zoomIn:function(a){this.setZoom(this._zoom*Ce.ZOOM_INCREMENT,a)},zoomOut:function(a){this.setZoom(this._zoom/Ce.ZOOM_INCREMENT,a)},zoomReset:function(a){this.setZoom(1,a)},checkZoom:function(a){return a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a},setZoom:function(a,b){if(Jc.num(a)&&!(0>=a)&&(a=this.checkZoom(a),a!==this._zoom))if(null==b&&(b=Ce.ZOOM_ANIMATE),b)Ic.animate.AnimateManager.start(new Ic.animate.AnimateZoom(this,a));else{var c=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,d=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,e=this._zoom;this._zoom=a,Wc.setZoom(this._rootDiv,a),this.firePropertyChange("zoom",e,a),this.onZoomChanged(e,a),this.centerByLogicalPoint(c,d,!1)}},setTouchZoom:function(a){this.setZoom(a,!1)}}),function(){var a=function(a,b,c,d){var e=new Pc;e.src=d,Ic.Util.registerImage(a,e,b,c)};a("subnetwork_image",64,46,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC"),a("bus_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC"),a("data_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=="),a("databox_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII="),a("grid_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=="),a("group_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=="),a("group_image",32,29,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC"),a("link_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=="),a("linksubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII="),a("node_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=="),a("node_image",30,32,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAgCAYAAAAFQMh/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAO0SURBVHjavJZJaF1lGIaffzzn3pvbxAyYJulgNKJIF7WkuhEHFCy40LpRBLdFcFi4ciOCC9dmU910WbduBEEoRhFEarJw2UaLJXFImya5ubln+AcX5+YG3ZjCaT44cDb/+5zv/Ybzi7npo7Mhhi+886c5hFBaLUshX9dKq8tW2bPjExOHweXW+vpZ7/1lrZWanz52jK+//f5QwC8+8xSrN2/Oa2OM10pJgKwoWd/cRQpRKyzEyMRIk9QatFIYY7xOEou1BoD1zS6ff/kTqbW1grtZyVsvz3N8cgRrDUli0dZabB+kpGSkYdHWUGfOSkT6prLH04m1GFOBBaAkKBkQsU5wACpBYyyJtfSt1hVYVGDZf68rpNjXs1b3rU72rZaAlhFJRMj6wJUm+1bv1diYqrmEFCgJQtaf8Z6gMaaqcbPRpJGmgxprCYhYK1iL/YwbaUqz0UTneUFeusG8uRARNYPLEAn95spLR54X6K+uLDI1NQ3A7e0ey3+UtBJDnfO004vc6WRMjg3zzeIPrK2toje3O6StLWII7GYFt7qOPNS7uTo9x25WEENgY2uLze0Oem9xhOBwwZM5j3WyVnDmPC54QnAoWWlrgBgj3nuc9+yWHq3rBe+Wlbb3nhjjPhiowM7TdQ7t6rW66xzOVeBBpw/AzlM4z3bpkTVnvF1W2t79B1xZXVI4x3bpUfcE7PC+/LfVUgic80giY6lhJDG1gmUESawY/QWhG0aLxBh2dnoMqcBrpyawNWdcuMCQCuzs9EiMoWG00GPDR2QrMVxdWqIsch5L1cCOukJowerKn/x9M6GVGMaGj0hx+uEHrypjzzwwN0cI4Z7et6SU/HbtGr4sftbNVvN9a5NP1m78elpK6a0x9wRalCUhBNUeai0Xhf5ASykXh4fbbxo9+nin2y2v3/i9B3jq29YRUA+dPN5ot1qmdOXS7dvldfHIiRky5wBJt9djfePONHA/4Or6KwJ/TYzet9pqNIBAqjVianSEtY1NgCeBd4FTQBuoq+AS6AC/AAvAj1OjIzAzPoqS8pyAFQHx/x4gzs7OxosXP4ufLizEkydORA5wrv+sKCnPzYyPooFHh5vppQiTB/n8PMt47523Of/qebIsY7fT4eOPPiRJkoMcnxVwCXhOH2kPXWi3WpMH7s48J5Ql1tpq3p3j6Pj44MJ4gJgUUlwQzz5xpgMMHbhFYyRNU55+/gWC93x35Qp5niHu7q60I9545aUeoO5qPkJAqupICOFuoQD+nwEAIKWd899qAZAAAAAASUVORK5CYII="),a("shapelink_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII="),a("shapenode_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC"),a("shapesubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII="),a("subnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII="),a=function(a,b,c,d){Ic.Util.registerImage(a,d,b,c)
},a("expand_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=="),a("collapse_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7"),a("close_icon",11,11,"data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs="),a("sort_desc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs="),a("sort_asc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs="),a("submenu_enable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAA7SURBVHjafI9BDgAgDMKqH3c/ryd1iTqOpARARQUYJG0/AWboB2yoAgTG8jtvtXvMSUdVEdXIeN2cAwDPLmAjfDYS7AAAAABJRU5ErkJggg=="),a("submenu_disable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABKSURBVHjafM9BDoAgDETRD1cTz0W9luDZxhUBCjpJkzZ9m0ESkrhLzW0fJ9JjpT4Zl+juBXmwoB0ACH/gOtNhX2B6AjDUtF3NdwAU6zx4LEQe5AAAAABJRU5ErkJggg=="),a("checkbox_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAflJREFUeNqkk09oE1EQxn+7btyIYBRCbayFtlhEtLeAin+KouDNo548eJHCQkFQC1K0Bw8VqT1EVIqo0IMUvejNg6AIIglSsdSCiA0WolaIOWi3+2fGw242CRFBHPjg8d7MfPO+mTEcxzkNDAF5/s1KwE0cxylWKhX1fV89r44gget6bVhd9bRcLqvjOEULyGezWTwvAMAwjIRCRAnD8I/0nZ05gLwZOTYeVBXQOIGgqgk+flrk3MUxVBWRyMeMw5oCG2eREFVBVZibf8+x4ydZLH9GVRISq5W5uXwhDKPSvnz9xolTZ/A29GNZFiJ1kjhBnVFVEw0a7MrQ8HlqbMZwXeYXlpL7ti/Usbz8Hd8PEBGmHzxk9kMVfI+BrWt4PHM/0abtC67r8vTZC4qlWY4c2s/Azh2MTxQwpIPduzZx99Z1bNtu1yBiFp6/fMXr4ht+/NzI+MQNBg/sxdccPbmAqcI1UqkUEresTQMR5ejhQbb19XJ25BJzC8Lbd3dIp22mCtPY9tokuDmB2VyBqtDb082VyxdYv26JXysrTF4dY0uuI3lvoKWCaOoMA1SF7q4u7t2eZObREw7u25MMTbPF8VGCqHNRB4IgQFXY3t/H6MhwLFirGYZBfeItoFSr1fKZTAbVaPbT6fRf19A0TarVKkDJ+N91/j0A8Y5o3Yt7KRAAAAAASUVORK5CYII="),a("checkbox_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAiUlEQVR42qXM3QYFIRiF4d3dJpIhI5FKJCOSSHe7f9gn4ztZo3Wwzt6HvTbHfhdCeD8Nvw27Ad57OI4xUsA5BwMpJQpYa2Eg50wBYwwMlFIocJ4nDFzXRQGtNQzUWilwHAcMtNYooJSCgd47BaSUMDDGoIAQAgbmnBTgnMPAWosCcP3fDdjZNvABvRhVEQglsV8AAAAASUVORK5CYII="),a("radiobutton_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXFJREFUeNrUUz9rwkAUv0syBVxMm01L2lIdilOg4BcQ7eKcIV/AqZAxo1/B2a/QoSSTH6AQCoFMJUSig5C0EiPEv8G+Z604eJNTHxz37vf73Y977+7obrcjlwRHLoyLDYTThWmav6AgKDA9wrg6UF8wvO12O8RFt9s9bwACwvP8U6lUajWbzbYsy/eIR1Hk27b9GgSBlef5O7OEzWZzC5ufNU17gc01gEQcmCOGHGqYJaxWq1qj0WhzHFfwfZ84jrPHVVUliqIUkPM87wOg4KzBcrm8liTpbr1ek8FgQNI03eOz2Yzouk6QQw3zBFmWUewDxnQ6JUmSHHsDRz9qmD0A8ns8HgcortfrRxxzxJBDDfMEi8XC7ff7b4Zh3FSr1UKlUtnjlFI0mCOHGqZBHMd+GIbWZDIROp1OCxqH74HA9Q17vZ7luq4liqJ/uoee/oVyufxX/wPctwqpfKAieB9OsVj8xMVoNDpv8D8/048AAwDskrF8QGeJUgAAAABJRU5ErkJggg=="),a("radiobutton_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATVJREFUeNrUU71qhEAQ9q8S0mhip3C5kCpcFcgjiJfmal/BKr2lr2DtK1wR9BkCaYRUQTzUQtDE5sB/MTOJAQs3jVUGhp2Z75vPnV2XHseRWmMMtdJWC3DzxDTNnyLHbWC5A7+coA/wt77vT5hYlrUsAASKZdkHWZb3mqYdJEm6wXqWZYHneccwDN1hGF6II3Rddw3Nj7quP0HzDko8OsZYQww5RIGmaXaqqh4YhrnA3cwda4ghh3gGdV1fiaK4bdt28cAQQw5RoCxLGr/2lyGHOAKAn0mShDAnteSIIYcoUFWV7zjOM5DPuJPfxik+I4Yc4gh5ngdRFLlpmnKGYew3YFiH6zvZtu36vu/yPB/Me+j5W1AU5XstiuIW7vseQmmCMvg/XgVBeMckjuNlgf/5mL4EGAAhHbltcqEYDQAAAABJRU5ErkJggg==")}(),Rc.__tree=function(a){a._rootVisible=!0,a._initTree=function(){this._rootData=null,this._expandMap={},this._levelMap={}},a.validateModel=function(){this._rowDatas.clear(),this._levelMap={},this._dataRowMap={},this._currentLevel=0,this._rootData?this._rootVisible?this.isVisible(this._rootData)&&this._buildData(this._rootData):this._buildChildren(this._rootData):this._buildChildren(),delete this._currentLevel},a._buildData=function(a){this._dataRowMap[a.getId()]=this._rowDatas.size(),this._rowDatas.add(a),this._levelMap[a.getId()]=this._currentLevel,this.isExpanded(a)&&(this._currentLevel++,this._buildChildren(a),this._currentLevel--)},a._buildChildren=function(a){var b=a?a.getChildren():this._box.getRoots(),c=this.getCurrentSortFunction();c&&this.isChildrenSortable(a)?b.toList(this.isVisible,this).sort(c).forEach(function(a){this._buildData(a)},this):b.forEach(function(a){this.isVisible(a)&&this._buildData(a)},this)},a.getLevel=function(a){return this._levelMap[a.getId()]},a.getToggleImage=function(a){return a.getChildrenSize()>0?this.isExpanded(a)?this._expandIcon:this._collapseIcon:null},a.isCheckable=function(){return this.isCheckMode()},a.isCheckMode=function(){return 1===Rc.__tree._checkMap[this._checkMode]},a.isChildrenSortable=function(){return!0},a.handleDataBoxChange=function(a){"remove"===a.kind?delete this._expandMap[a.data.getId()]:"clear"===a.kind&&(this._expandMap={}),this.invalidateModel()},a.isExpanded=function(a){return 1===this._expandMap[a.getId()]},a.expand=function(a){if(!this.isExpanded(a)){for(var b=a.getParent();null!=b&&b!==this._rootData;)this._expandMap[b.getId()]=1,b=b.getParent();this._expandMap[a.getId()]=1,this.invalidateModel()}},a.collapse=function(a){this.isExpanded(a)&&(delete this._expandMap[a.getId()],this.invalidateModel())},a.expandAll=function(){this._box.forEach(function(a){this._expandMap[a.getId()]=1},this),this.invalidateModel()},a.collapseAll=function(){this._expandMap={},this.invalidateModel()},a._handleClick=function(a){if(this.isFocusOnClick()&&Ic.Util.setFocus(this._view),!this._isValidating){var b;if(a.target._expandData)b=a.target._expandData,this.isExpanded(b)?(this.collapse(b),this.fireInteractionEvent({kind:"collapse",data:b})):(this.expand(b),this.fireInteractionEvent({kind:"expand",data:b}));else if(a.target._selectData||a.target.parentNode._selectData){if(this._handlePressSelection(a.target._selectData||a.target.parentNode._selectData,a),this.isCheckMode()){var c=this.getRowIndexAt(a);c>=0&&this.__handleClick(a)}}else this._treeColumn?(b=this.getDataAt(a),b&&(this.isCheckMode()?a.target._checkData||this.__handleClick(a):this._handlePressSelection(b,a))):this.isCheckMode()&&!a.target._checkData&&this.__handleClick(a);if(this._currentEditor&&!this._isCommitting&&(this._isCommitting=!0,this.commitEditValue(this._currentEditor._editInfo,this._currentEditor)),this.updateCurrentEditor){var d=this;setTimeout(function(){d.updateCurrentEditor(a)},0)}}},a.__handleClick=function(a){var b=this.getDataAt(a),c=this.getRowIndexByData(b);if(this._focusedRow!==c){var d=this._rowDatas.get(this._focusedRow);this._focusedRow=c,d&&this.invalidateData(d),this.invalidateData(b)}},a.handleChange=function(a){if(!(this._isCommitting||this._isCanceling||this._isValidating)){var b=a.target._checkData;if(b){var c,d=this.isSelected(b),e=this.getSelectionModel();if("default"===this._checkMode)d?e.removeSelection(b):e.appendSelection(b);else if("children"===this._checkMode)c=new me(b),c.addAll(b.getChildren());else if("descendant"===this._checkMode)c=new me,Jc.fillDescendant(b,c);else if("descendantAncestor"===this._checkMode&&(c=new me,Jc.fillDescendant(b,c),!d))for(var f=b.getParent();f;)c.add(f),f=f.getParent();d?e.removeSelection(c):e.appendSelection(c)}a.target._editInfo&&this.commitEditValue&&(this._isCommitting=!0,this.commitEditValue(a.target._editInfo,a.target))}},a.onLabelRendered=function(){},a._renderTree=function(a,b,c,d){var e=this._levelMap[b.getId()],f=this.getToggleImage(b),g=this.getLineType(),h=this._indent,i=this.__spanPool.get();i.style.width=f?this._indent*e+"px":this._indent*(e+1)+"px",i.style.display="inline-block",i.style.position="relative",i.style.verticalAlign="top",i.style.margin="0px 1px 0px 1px",i.style.width=(e+1)*h+"px",a.appendChild(i);var j=b,k=j.getParent(),l=0;if("dotted"===g||"solid"===g){if(null==k){var m=this.getIcon(b);this._addLine(i,b,m,!0)}for(;null!==k;){var n=k.getChildren(),o=j===n.get(n.size()-1),m=this.getIcon(j);j.setClient("isLast",o),0==l&&this._addLine(i,b,m,o),l++,j=k,k=k.getParent()}}if(f){var p=this.__imagePool.get();p.setAttribute("src",Jc.getImageSrc(f)),p.style.verticalAlign="middle",p._expandData=b,p.style.position="absolute",p.style.right="0px",p.style.top=this.getRowHeight()/2-p.height/2+"px",i.appendChild(p)}var q=this.isCheckable(b),r="disabled"===this.getUncheckableStyle();if(q||r){var s=this._addCheckBox(a,b,d);s.disabled=!q}var m=this.getIcon(b);if(m){var t=this.isCheckMode()||this._treeColumn?null:b;this._addIcon(a,b,m,t)}var u=this.getLabel(b);u&&(i=this.__textPool.get(),i.style.whiteSpace="nowrap",i.style.verticalAlign="middle",i.style.padding="1px 2px 1px 2px",Jc.setText(i,u,this._treeColumn?this._treeColumn.isInnerText():this._innerText),this.isCheckMode()||this._treeColumn?this._focusedRow===c&&(i.style.backgroundColor=this.getSelectColor(b)):(i._selectData=b,i.style.backgroundColor=d?this.getSelectColor(b):""),this.onLabelRendered(i,b,u,c,e,d),a.appendChild(i))}},Rc.__tree._checkMap={"default":1,children:1,descendant:1,descendantAncestor:1},Ic.Column=function(a){Ic.Column.superClass.constructor.call(this,a)},Jc.ext("twaver.Column",Ic.Data,{IColumn:!0,__property:1,__accessor:["width","horizontalAlign","valueType","propertyType","propertyName","editable","visible","sortable","resizable","movable","sortDirection","sortFunction","enumInfo"],__bool:["innerText"],_innerText:Ce.COLUMN_INNER_TEXT,_width:Ce.COLUMN_WIDTH,_horizontalAlign:Ce.COLUMN_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Ce.COLUMN_PROPERTY_TYPE,_valueType:Ce.COLUMN_VALUE_TYPE,_editable:Ce.COLUMN_EDITABLE,_sortable:Ce.COLUMN_SORTABLE,_visible:Ce.COLUMN_VISIBLE,_resizable:Ce.COLUMN_RESIZABLE,_movable:Ce.COLUMN_MOVABLE,_sortDirection:"asc",_sortFunction:Ce.SORT_FUNCTION,_enumInfo:null,renderCell:Ce.COLUMN_RENDER_CELL,renderHeader:Ce.COLUMN_RENDER_HEADER,setParent:function(){throw"parent not supported"}}),Ic.ColumnBox=function(){Ic.ColumnBox.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.ColumnBox",Ic.DataBox,{_name:"ColumnBox",add:function(a){if(!a.IColumn)throw"Only IColumn can be added into ColumnBox";Ic.ColumnBox.superClass.add.apply(this,arguments)}}),Ic.Property=function(a){Ic.Property.superClass.constructor.call(this,a)},Jc.ext("twaver.Property",Ic.Data,{IProperty:!0,__property:1,__accessor:["horizontalAlign","valueType","editable","propertyType","propertyName","categoryName","enumInfo"],__bool:["innerText"],_innerText:Ce.PROPERTY_INNER_TEXT,_horizontalAlign:Ce.PROPERTY_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Ce.PROPERTY_PROPERTY_TYPE,_valueType:Ce.PROPERTY_VALUE_TYPE,_editable:Ce.PROPERTY_EDITABLE,_categoryName:Ce.PROPERTY_CATEGORY_NAME,_enumInfo:null,renderName:Ce.PROPERTY_RENDER_NAME,renderValue:Ce.PROPERTY_RENDER_VALUE,isVisible:null,setParent:function(){throw"parent not supported"},setPropertyName:function(a){var b=this._propertyName;this._propertyName=a,this.firePropertyChange("propertyName",b,a)},setPropertyType:function(a){var b=this._propertyType;this._propertyType=a,this.firePropertyChange("propertyType",b,a)}}),Ic.PropertyBox=function(){Ic.PropertyBox.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.PropertyBox",Ic.DataBox,{_name:"PropertyBox",add:function(a){if(!a.IProperty)throw"Only IProperty can be added into PropertyBox";Ic.PropertyBox.superClass.add.apply(this,arguments)}}),Ic.Tab=function(a){Ic.Tab.superClass.constructor.call(this,a)},Jc.ext("twaver.Tab",Ic.Data,{ITab:!0,__accessor:["view","width","closable","resizable","movable","disabled","visible"],_icon:null,_width:Ce.TAB_WIDTH,_closable:Ce.TAB_CLOSABLE,_resizable:Ce.TAB_RESIZABLE,_movable:Ce.TAB_MOVABLE,_disabled:Ce.TAB_DISABLED,_visible:Ce.TAB_VISIBLE,setParent:function(){throw"parent not supported"}}),Ic.TabBox=function(){Ic.TabBox.superClass.constructor.apply(this,arguments),this.getSelectionModel().setSelectionMode("singleSelection")},Jc.ext("twaver.TabBox",Ic.DataBox,{_name:"TabBox",add:function(a){if(!a.ITab)throw"Only ITab can be added into TabBox";Ic.TabBox.superClass.add.apply(this,arguments)}}),Ic.controls.ListBase=function(a){Ic.controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new me,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new Ic.Pool("div",20),this.__imagePool=new Ic.Pool("img",20),this.__canvasPool=new Ic.Pool("canvas",20),this.__spanPool=new Ic.Pool("span",20),this.__textPool=new Ic.Pool("span",20),this.__checkBoxPool=new Ic.Pool("input",20),this.__linePool=new Ic.Pool("canvas",20),this._pools.add(this.__divPool),this._pools.add(this.__linePool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=Wc.createView("auto",!0),this._rootDiv=Wc.createDiv(),this._dataDiv=Wc.createDiv(),this._dataDiv.style.width="1px",this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new Ic.DataBox);var b=this;b.handleChange&&b._view.addEventListener("change",function(a){b.handleChange(a)},!1);var c;c=Qc.isMSToucheable?Ic.controls.ListBaseMSTouchInteraction:Qc.isTouchable?Ic.controls.ListBaseTouchInteraction:Ic.controls.ListBaseInteraction,c&&new c(this)},Jc.ext("twaver.controls.ListBase",Ic.controls.View,{__bool:["innerText"],_innerText:Ce.LISTBASE_INNER_TEXT,getDataDiv:function(){return this._dataDiv},getStartRowIndex:function(){return this._startRowIndex},getEndRowIndex:function(){return this._endRowIndex},getRowDatas:function(){return this._rowDatas},getRowIndexByData:function(a){return this._dataRowMap[a.getId()]},getRowIndexById:function(a){return this._dataRowMap[a]},getRowSize:function(){return this._rowDatas.size()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)}},onPropertyChanged:function(a){"zoom"===a.property?this.invalidate():this.invalidateModel()},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateData:function(a){this._invalidateDisplay||(this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[a.getId()]=a,this.invalidate())},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},Wc.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var c;if(this._invalidateDatas){for(c in this._invalidateDatas){var d=this._renderMap[c];d&&(Wc.release(d),this._dataDiv.removeChild(d),delete this._renderMap[c])}this._invalidateDatas=null}var e=this._view.scrollTop/this._zoom,f=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(e/this._rowHeight)-2,this._endRowIndex=Math.ceil((e+f)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());for(var g=this._rowHeight-this._rowLineWidth-2+"px",h=this._rowLineWidth+"px",i=this._startRowIndex;i<this._endRowIndex;i++){var j=this._rowDatas.get(i);c=j.getId();var k=this._renderMap[c];if(!k){k=this.__divPool.get();var l=k.style;l.position="absolute",l.whiteSpace="nowrap",l.lineHeight=g,l.top=i*this._rowHeight+"px",l.borderStyle="solid",l.borderWidth="0px",l.borderBottomWidth=h,l.borderBottomColor=this._rowLineColor,l.opacity=j.getStyle?j.getStyle("whole.alpha"):1,this._dataDiv.appendChild(k),this._renderMap[c]=k;var m=this.isSelected(j);this.renderData(k,j,i,m),this.onDataRendered(k,j,i,m)}}Jc.keys(this._renderMap).forEach(function(a){var b=this.getRowIndexById(a);if(b<this._startRowIndex||b>=this._endRowIndex){var c=this._renderMap[a];Wc.release(c),this._dataDiv.removeChild(c),delete this._renderMap[a]}},this),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b),this.adjustRowSize(),this.onValidated()},adjustRowSize:function(){var a,b,c=this._rowHeight-this._rowLineWidth+"px",d=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(a in this._renderMap)b=this._renderMap[a],b.style.height=c,b.style.width=d},onValidated:function(){},onDataRendered:function(){},_addCheckBox:function(a,b,c){var d=this.__checkBoxPool.get();return d.keepDefault=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d._checkData=b,d.checked=c,d.disabled=!1,a.appendChild(d),d},_addIcon:function(a,b,c,d){var e,f=Jc.getImageAsset(c),g=this.getInnerColor(b),h=this.getOuterColor(b),i=this.getAlarmFillColor(b);if(f&&f.getImage()){var j=f.getWidth(),k=f.getHeight();e=this.__canvasPool.get(),e.style.verticalAlign="middle",e.setAttribute("width",j),e.setAttribute("height",k);
var l=e.getContext("2d");l.clearRect(0,0,j,k);var m={x:0,y:0,width:j,height:k};Nd(l,c,g,m,b,this),h&&(l.lineWidth=2,l.strokeStyle=h,l.beginPath(),l.rect(0,0,j,k),l.closePath(),l.stroke()),i&&(l.fillStyle=Xc.createRadialGradient(l,i,"white",1,k-9,8,8,.75,.25),l.beginPath(),l.arc(5,k-5,4,0,2*Math.PI,!0),l.closePath(),l.fill())}else e=this.__imagePool.get(),e.style.verticalAlign="middle",e.setAttribute("src",Jc.getImageSrc(c));e.style.margin="0px 1px 0px 1px",e._selectData=d,a.appendChild(e)},_addLine:function(a,b,c,d){{var e,f,g=this.__linePool.get(),h=Jc.getImageAsset(c),i=this.getToggleImage(b),j=this._levelMap[b.getId()],k=this._indent,l=k,m=k,n=0;this.isCheckable(b),"disabled"===this.getUncheckableStyle()}n=2,h&&(l=h.getWidth(),m=h.getHeight()),d?(e=(j+n-1)*k+l,f=this.getRowHeight()):(e=(j+n-1)*k+l,f=this.getRowHeight()),a.style.width=(j+n-1)*k+"px",a.style.height=f+"px";{var o=this.getLineType(),p=this.getLineColor(),q=this.getLineAlpha(),r=this.getLineThickness(),s=this.getLineDash();Jc.getImageSrc(i)}g.style.verticalAlign="top",g.style.margin="0px 0px 0px 0px",g.style.zIndex=-1,g.setAttribute("width",e),g.setAttribute("height",f);var t=g.getContext("2d");t.lineWidth=r,t.strokeStyle=p,t.globalAlpha=q,"dotted"===o&&t.setLineDash(s);var u=2*(j+n);if(d){var v=b,w=v.getParent();t.clearRect(0,0,e,f);null===w&&0!==b.getChildrenSize()&&this.isExpanded(b)&&(t.moveTo((j+n+1)*e/u,f/2+m/2),t.lineTo((j+n+1)*e/u,f),t.stroke());for(var x=2*j-1;x>=1;x-=2){if(v.getClient("isLast")){if(v=w,w=v.getParent(),(x+1)/2!=j)continue}else v=w,w=v.getParent();x==2*j-1?(t.moveTo((x+n)*e/u,0),t.lineTo((x+n)*e/u,f/2),t.stroke(),t.moveTo((x+n)*e/u,f/2),t.lineTo((x+n+1)*e/u,f/2),t.stroke(),0!==b.getChildrenSize()&&this.isExpanded(b)&&(t.moveTo((x+n+2)*e/u,f/2+m/2),t.lineTo((x+n+2)*e/u,f),t.stroke())):(t.moveTo((x+n)*e/u,0),t.lineTo((x+n)*e/u,f),t.stroke())}}else{var v=b,w=v.getParent();t.clearRect(0,0,e,f);for(var x=2*j-1;x>=1;x-=2){if(v.getClient("isLast")){if(v=w,w=v.getParent(),(x+1)/2!=j)continue}else v=w,w=v.getParent();t.moveTo((x+n)*e/u,0),t.lineTo((x+n)*e/u,f),t.stroke(),x==2*j-1&&(t.moveTo((x+n)*e/u,f/2),t.lineTo((x+n+1)*e/u,f/2),t.stroke(),0!==b.getChildrenSize()&&this.isExpanded(b)&&(t.moveTo((x+n+2)*e/u,f/2+m/2),t.lineTo((x+n+2)*e/u,f),t.stroke()))}}return a.appendChild(g),g},isVisible:function(a){return this._box.contains(a)?this._visibleFunction?this._visibleFunction(a):!0:!1},handleDataBoxChange:function(){this.invalidateModel()},handlePropertyChange:function(a){"parent"===a.property?this.invalidateModel():this.invalidateData(a.source)},handleHierarchyChange:function(){this.invalidateModel()},handleSelectionChange:function(a){a.datas.forEach(function(a){this.invalidateData(a)},this),this.onSelectionChanged(a)},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowDatas.size()?c:-1},getDataAt:function(a){var b=this.getRowIndexAt(a);return b>=0?this._rowDatas.get(b):null},getCurrentSortFunction:function(){return this._sortFunction},validateModel:function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var a=this.getCurrentSortFunction();a&&this._rowDatas.sort(a);for(var b=this._rowDatas.size(),c=0;b>c;c++)this._dataRowMap[this._rowDatas.get(c).getId()]=c},_buildChildren:function(a){a.forEach(function(a){this._rowDatas.add(a),this._buildChildren(a.getChildren())},this)},_handlePressSelection:function(a,b){var c=this.getSelectionModel();if(Jc.isCtrlDown(b))c.contains(a)?c.removeSelection(a):c.appendSelection(a);else if(b.shiftKey&&c.getLastData()){var d=c.getLastData(),e=this.getRowIndexByData(d),f=this.getRowIndexByData(a),g=new me;for(g.add(this.getRowDatas().get(e));e!==f;)e+=f>e?1:-1,g.add(this.getRowDatas().get(e));c.setSelection(g)}else 1===c.size()&&c.contains(a)||c.setSelection(a);this.fireInteractionEvent({kind:2===b.detail?"doubleClick":"click",data:a})},_handleClick:function(a){this.isFocusOnClick()&&Ic.Util.setFocus(this._view);var b=this.getDataAt(a);if(b){if(this.isCheckMode()&&!a.target._checkData){var c=this.getRowIndexByData(b);if(this._focusedRow!==c){var d=this._rowDatas.get(this._focusedRow);this._focusedRow=c,d&&this.invalidateData(d),this.invalidateData(b)}}this.isCheckMode()||this._handlePressSelection(b,a)}if(this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor),this.updateCurrentEditor){var e=this;setTimeout(function(){e.updateCurrentEditor(a)},0)}},handleChange:function(a){if(!this._isCanceling&&!this._isValidating){var b=a.target._checkData;if(b){var c=this.isSelected(b),d=this.getSelectionModel();c?d.removeSelection(b):d.appendSelection(b)}a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)}},scrollToData:function(a){var b=this.getRowIndexById(a.getId());if(!(0>b)){var c=b*this._rowHeight*this._zoom,d=c+this._rowHeight*this._zoom,e=this._view.scrollTop;this._view.scrollTop>c&&(e=c),this._view.scrollTop+this._view.clientHeight<d&&(e=d-this._view.clientHeight),this._view.scrollTop!=e&&(this._view.scrollTop=e,this.invalidate())}},makeVisible:function(a){this.isVisible(a)&&(this.expand&&this.expand(a),Jc.callLater(this.scrollToData,this,[a],2*Ce.CALL_LATER_DELAY))},onSelectionChanged:function(a){this._makeVisibleOnSelected&&("append"===a.kind||"set"===a.kind||"all"===a.kind)&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(a){a.getParent()&&this.expand(a.getParent())},this),Jc.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],2*Ce.CALL_LATER_DELAY))},onShareSelectionModelChanged:function(){this.invalidateModel()}}),Ic.controls.TableBase=function(){this._columnBox=new Ic.ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),Ic.controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new Ic.Pool("div",20),this._stringPool=new Ic.Pool("span",20),this._booleanPool=new Ic.Pool("input",20),this._colorPool=new Ic.Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool)},Jc.ext("twaver.controls.TableBase",Ic.controls.ListBase,{getColumnBox:function(){return this._columnBox},handleColumnBoxChange:function(){this.invalidateDisplay()},handleColumnPropertyChange:function(a){a.source!==this._sortColumn||"sortDirection"!==a.property&&"sortFunction"!==a.property&&"sortable"!==a.property?this.invalidateDisplay():this.invalidateModel()},handleColumnHierarchyChange:function(){this.invalidateDisplay()},renderData:function(a,b,c,d){for(var e,f=this._columnBox.getRoots(),g=f.size(),h=0,i=this._rowHeight-this._rowLineWidth+"px",j=0;g>j;j++){var k=f.get(j),l=k.getWidth();0>l&&(l=0);var m=Math.min(this._columnLineWidth,l);if(k.isVisible()){var n=this._cellPool.get();e=n.style,e.position="absolute",e.whiteSpace="nowrap",e.verticalAlign="middle",e.textAlign=k.getHorizontalAlign(),e.overflow="hidden",e.textOverflow="ellipsis",e.left=h+"px",e.width=l-m+"px",e.height=i,e.borderStyle="solid",e.borderWidth="0px",e.borderRightWidth=m+"px",e.borderRightColor=this._columnLineColor,0===j?(e.borderLeftWidth=m+"px",e.borderLeftColor=this._columnLineColor):e.borderLeftWidth="0px",a.appendChild(n);var o={data:b,value:this.getValue(b,k),div:n,view:this,column:k,rowIndex:c,selected:d};this.renderCell(o),this.onCellRendered(o),h+=l}}e=a.style,e.width=h+"px",e.height=i,e.backgroundColor=this.isCheckMode()&&this._focusedRow===c||!this.isCheckMode()&&d?this.getSelectColor(b):""},adjustRowSize:function(){},onCellRendered:function(){},getCurrentSortFunction:function(){var a=this._sortColumn;if(a){var b=a.getSortFunction();if(b){var c=this,d="asc"===a.getSortDirection()?1:-1;return function(e,f){var g=c.getValue(e,a),h=c.getValue(f,a);return b.call(c,g,h,e,f)*d}}}return this._sortFunction},renderCell:function(a){var b=a.column;if(b.renderCell)return void b.renderCell(a);var c=a.value,d=b.getEnumInfo();d&&!Array.isArray(d)&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.div._editInfo=a),Ad.render(b.getValueType(),c,a.div,a.view,b.isInnerText())},getValue:function(a,b){return b.getValue(a,this)},setValue:function(a,b,c){b.setValue(a,c,this)},getColumnAt:function(a){var b=this.getLogicalPoint(a);if(!b)return null;for(var c=this._columnBox.getRoots(),d=0,e=c.size(),f=0;e>d;d++){var g=c.get(d),h=g.getWidth();if(0>h&&(h=0),b.x>f&&b.x<f+h)return g;f+=h}return null},isCellEditable:function(a,b){return this.isEditable()&&b.isEditable()},commitEditValue:function(a,b){if(!this._isCanceling){var c;c="checkbox"===b.type?b.checked:b.value;var d=a.column,e=d.getValueType();if("int"===e&&"string"==typeof c?c=parseInt(c):"number"===e&&"string"==typeof c&&(c=parseFloat(c)),this.setValue(a.data,d,c),this._currentEditor){var f=this._currentEditor;delete this._currentEditor,this._rootDiv.removeChild(f),Ic.Util.setFocus(this._view)}delete this._isCommitting}},cancelEditing:function(){if(this._currentEditor){this._isCanceling=!0;var a=this._currentEditor;delete this._currentEditor,this._rootDiv.removeChild(a),Ic.Util.setFocus(this._view),delete this._isCanceling}},updateCurrentEditor:function(a){var b=a.target;if(b!==this._currentEditor&&b.parentNode!==this._currentEditor){for(var c;b&&b!==this._view&&!(c=b._editInfo);)b=b.parentNode;if(c&&b===c.div&&(c.enumInfo?this._currentEditor=Wc.createSelect(c.enumInfo,c.value):(this._currentEditor=Oc.createElement("input"),null!=c.value&&(this._currentEditor.value=c.value)),this._currentEditor)){this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;13===a.keyCode?b.commitEditValue(a.target._editInfo,a.target):27===a.keyCode&&b.cancelEditing()},!1),this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;b._isCanceling||b.commitEditValue(a.target._editInfo,a.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=c;var d=this._currentEditor.style;d.position="absolute",d.margin="0px",d.border="0px",d.padding="0px",d.left=c.div.style.left,d.top=c.div.parentNode.style.top,d.width=c.div.style.width,d.height=c.div.style.height,this._rootDiv.appendChild(this._currentEditor),Ic.Util.setFocus(this._currentEditor)}}},onColumnSorted:function(){},getCurrentEditor:function(){return this._currentEditor}}),Ic.controls.List=function(){Ic.controls.List.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.controls.List",Ic.controls.ListBase,{__accessor:["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],__bool:["makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_rowHeight:Ce.LIST_ROW_HEIGHT,_indent:Ce.LIST_INDENT,_rowLineWidth:Ce.LIST_ROW_LINE_WIDTH,_rowLineColor:Ce.LIST_ROW_LINE_COLOR,_makeVisibleOnSelected:Ce.LIST_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Ce.LIST_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Ce.LIST_KEYBOARD_SELECT_ENABLED,isCheckMode:function(){return this._checkMode},setCheckMode:function(a){delete this._focusedRow;var b=this._checkMode;this._checkMode=a,this.firePropertyChange("checkMode",b,a)},isCheckable:function(){return this._checkMode===!0},renderData:function(a,b,c,d){var e;this._indent>0&&(e=this.__spanPool.get(),e.style.width=this._indent+"px",e.style.display="inline-block",a.appendChild(e));var f=this.isCheckable(b);f&&this._addCheckBox(a,b,d);var g=this.getIcon(b);g&&this._addIcon(a,b,g);var h=this.getLabel(b);if(h){e=this.__textPool.get();var i=e.style;i.whiteSpace="nowrap",i.verticalAlign="middle",i.padding="1px 2px 1px 2px",i.display="inline-block",Jc.setText(e,h,this._innerText),this.onLabelRendered(e,b,h,c,d),a.appendChild(e)}a.style.backgroundColor=this.isCheckMode()?this._focusedRow===c?this.getSelectColor(b):"":d?this.getSelectColor(b):""},onLabelRendered:function(){}}),Ic.controls.ListBaseInteraction=function(a){this.listBase=a,this.view=a._view;var b=this;this.view.addEventListener("scroll",function(a){b.handleScroll(a)},!1),this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("keydown",function(a){b.handleKeyDown(a)},!1)},Jc.ext("twaver.controls.ListBaseInteraction",Object,{handleMouseDown:function(a){var b=this.listBase;a.target!==b._currentEditor&&a.target.parentNode!==b._currentEditor&&b._handleClick(a)},handleKeyDown:function(a){var b=this.listBase;if(!b._currentEditor)if(Jc.isCtrlDown(a)&&65==a.keyCode)b.isKeyboardSelectEnabled()&&b.selectAll().size()>0&&b.fireInteractionEvent({kind:"selectAll"}),Wc.preventDefault(a);else if(46==a.keyCode)b.isKeyboardRemoveEnabled()&&b.removeSelection()&&b.fireInteractionEvent({kind:"removeElement"}),Wc.preventDefault(a);else if(b.isCheckMode()||38!==a.keyCode&&40!==a.keyCode&&37!==a.keyCode&&39!==a.keyCode)Jc.showVersion(a);else{var c=b.getSelectionModel().getLastData();if(c)if(38===a.keyCode||40===a.keyCode){var d=b.getRowDatas(),e=b.getRowIndexByData(c);e>=0&&(38===a.keyCode?0!==e&&(c=d.get(e-1),b.getSelectionModel().setSelection(c)):e!==d.size()-1&&(c=d.get(e+1),b.getSelectionModel().setSelection(c)))}else!b.expand||37!==a.keyCode&&39!==a.keyCode||c.hasChildren()&&(37===a.keyCode?b.collapse(c):b.expand(c));else b.getRowDatas().size()>0&&(c=b.getRowDatas().get(0),b.getSelectionModel().setSelection(c))}},handleScroll:function(){this.listBase.invalidate()}}),Ic.controls.ListBaseTouchInteraction=function(a){this.listBase=a,this.view=a._view,Wc.addEventListener("touchstart","handleTouchstart",this.view,this)},Jc.ext("twaver.controls.ListBaseTouchInteraction",Object,{handleTouchstart:function(a){Wc.preventDefault(a),this.lastPoint=this.listBase.getLogicalPoint(a),Wc.addEventListener("touchmove","handleTouchmove",this.view,this),Wc.addEventListener("touchend","handleTouchend",this.view,this),zd.isMultiTouch(a)&&(this.distance=zd.getDistance(a),this.zoom=this.listBase._zoom)},handleTouchmove:function(a){if(Wc.preventDefault(a),this.moved||(this.moved=!0),zd.isSingleTouch(a)){if(this.lastPoint){var b=this.listBase.getLogicalPoint(a),c=this.lastPoint.x-b.x,d=this.lastPoint.y-b.y,e=this.listBase.panByOffset(c,d);this.listBase.invalidate(),this.lastPoint.x-=c-e.x,this.lastPoint.y-=d-e.y}}else if(this.distance){var f=zd.getDistance(a)/this.distance;this.listBase.setZoom(this.zoom*f,!1)}},handleTouchend:function(a){Wc.preventDefault(a),this.moved||a.target===this.listBase._currentEditor||a.target.parentNode===this.listBase._currentEditor||this.listBase._handleClick(a),delete this.lastPoint,delete this.moved,delete this.distance,delete this.zoom,Wc.removeEventListener("touchmove",this.view,this),Wc.removeEventListener("touchend",this.view,this)}}),Ic.controls.ListBaseMSTouchInteraction=function(){Ic.controls.ListBaseMSTouchInteraction.superClass.constructor.apply(this,arguments),this._pointerMap={},this._pointerIdArray=[];var a=this;this.view.addEventListener("MSPointerDown",function(b){a.handleTouchstart(b)},!1),this.view.addEventListener("MSPointerMove",function(b){a.handleTouchmove(b)},!1),this.view.addEventListener("MSPointerUp",function(b){a.handleTouchend(b)},!1),this.view.addEventListener("MSPointerCancel",function(b){a.handleTouchend(b)},!1),this.superHandleMouseDown=Ic.controls.ListBaseMSTouchInteraction.superClass.handleMouseDown},Jc.ext("twaver.controls.ListBaseMSTouchInteraction",Ic.controls.ListBaseInteraction,{handleMouseDown:function(){},handleTouchstart:function(a){a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),this._pointerMap[a.pointerId]||null==this.listBase.getLogicalPoint(a)||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length&&a.pointerType==a.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(a),1==this._pointerIdArray.length?(this._startTouchPoint=this.listBase.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.listBase.getZoom())},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Tc.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.listBase.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var c=this.listBase.getLogicalPoint(a);if(null==c)return;var d=this._startTouchPoint.x-c.x,e=this._startTouchPoint.y-c.y,f=this.listBase.panByOffset(d,e);this.listBase.invalidate(),this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}},handleTouchend:function(a){if(this._startTouchPoint&&1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.listBase.getLogicalPoint(a);if(b){var c=new Date;c.getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,b)<=20&&this.superHandleMouseDown(a)}}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Tc.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Ic.controls.Tree=function(a){this._interactionDispatcher=new Ic.EventDispatcher,this._initTree(a),Ic.controls.Tree.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.controls.Tree",Ic.controls.ListBase,{__tree:1,__accessor:["rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_indent:Ce.TREE_INDENT,_rowHeight:Ce.TREE_ROW_HEIGHT,_rowLineWidth:Ce.TREE_ROW_LINE_WIDTH,_rowLineColor:Ce.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected:Ce.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Ce.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Ce.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon:Ce.TREE_EXPAND_ICON,_collapseIcon:Ce.TREE_COLLAPSE_ICON,_uncheckableStyle:"none",_lineType:Ce.TREE_LINE_TYPE,_lineColor:Ce.TREE_LINE_COLOR,_lineThickness:Ce.TREE_LINE_THICKNESS,_lineAlpha:Ce.TREE_LINE_ALPHA,_lineDash:Ce.TREE_LINE_DASH,getCheckMode:function(){return this._checkMode},setCheckMode:function(a){delete this._focusedRow;var b=this._checkMode;this._checkMode=a,this.firePropertyChange("checkMode",b,a)},renderData:function(a,b,c,d){this._renderTree(a,b,c,d)}}),Ic.controls.Table=function(){this._checkColumn=new Ic.Column,this._checkColumn.setName("check"),this._checkColumn.setEditable(!0),this._checkColumn.setWidth(40),this._checkColumn.setHorizontalAlign("center"),this._checkColumn.renderCell=this.renderCheckCell;var a=this;this._checkColumn.getValue=function(b){return a.isSelected(b)},Ic.controls.Table.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.controls.Table",Ic.controls.TableBase,{__accessor:["rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","sortFunction","visibleFunction","sortColumn"],__bool:["editable","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Ce.TABLE_EDITABLE,_rowHeight:Ce.TABLE_ROW_HEIGHT,_rowLineWidth:Ce.TABLE_ROW_LINE_WIDTH,_rowLineColor:Ce.TABLE_ROW_LINE_COLOR,_columnLineWidth:Ce.TABLE_COLUMN_LINE_WIDTH,_columnLineColor:Ce.TABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Ce.TABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Ce.TABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Ce.TABLE_KEYBOARD_SELECT_ENABLED,getCheckColumn:function(){return this._checkColumn},isCheckMode:function(){return this._columnBox.contains(this._checkColumn)},setCheckMode:function(a){a!==this.isCheckMode()&&(delete this._focusedRow,a?this._columnBox.add(this._checkColumn,0):this._columnBox.remove(this._checkColumn),this.firePropertyChange("checkMode",!a,a))},renderCheckCell:function(a){var b=a.view._booleanPool.get();b.disabled=!1,b.type="checkbox",b.style.margin="0px 2px",b.style.verticalAlign="middle",b.checked=a.selected;var c=a.div;c.appendChild(b),""===c.style.textAlign&&(c.style.textAlign="center"),b._checkData=a.data}}),Ic.controls.TableHeader=function(a){Ic.controls.TableHeader.superClass.constructor.apply(this,arguments),this._invalidateScroll=!1,this._invalidateDisplay=!1,this._divPool=new Ic.Pool("div"),this._imagePool=new Ic.Pool("img"),this._textPool=new Ic.Pool("span"),this._resizePool=new Ic.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._imagePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this._table=a,this._tableView=a.getView(),this._columnBox=a.getColumnBox(),this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this);var b=this;a.getView().addEventListener("scroll",function(){b.invalidateScroll()},!1),a.addPropertyChangeListener(function(){b.invalidateDisplay()},this),this._view=Wc.createView("hidden"),this._view.tabIndex=-1,this._view.style.background=Ce.TABLEHEADER_BACKGROUND,this._rootDiv=Wc.createDiv(),this._view.appendChild(this._rootDiv),this.invalidateDisplay();var c;c=Qc.isTouchable&&!Qc.isMSToucheable?Ic.controls.TableHeaderTouchInteraction:Ic.controls.TableHeaderInteraction,c&&new c(this)},Jc.ext("twaver.controls.TableHeader",Ic.controls.ControlBase,{__accessor:["height","moveBackground","insertBackground","columnLineColor","resizeTolerance","sortDescIcon","sortAscIcon","sortIconPosition"],_height:Ce.TABLEHEADER_HEIGHT,_moveBackground:Ce.TABLEHEADER_MOVE_BACKGROUND,_insertBackground:Ce.TABLEHEADER_INSERT_BACKGROUND,_columnLineColor:Ce.TABLEHEADER_COLUMN_LINE_COLOR,_resizeTolerance:Ce.TABLEHEADER_RESIZE_TOLERANCE,_sortDescIcon:Ce.TABLEHEADER_SORT_DESC_ICON,_sortAscIcon:Ce.TABLEHEADER_SORT_ASC_ICON,_sortIconPosition:Ce.TABLEHEADER_SORT_ICON_POSITION,getRootDiv:function(){return this._rootDiv},handleColumnBoxChange:function(){this.invalidateDisplay()},handleColumnPropertyChange:function(){this.invalidateDisplay()},handleColumnHierarchyChange:function(){this.invalidateDisplay()},onPropertyChanged:function(){this.invalidateDisplay()},invalidateScroll:function(){this._invalidateScroll||(this._invalidateScroll=!0,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateScroll=!0,this.invalidate())},validate:function(){this._invalidate&&(this._invalidate=!1,this._invalidateDisplay&&(this._invalidateDisplay=!1,this.validateDisplay()),this._invalidateScroll&&(this._invalidateScroll=!1,this._rootDiv.style.left=-this._tableView.scrollLeft+"px"))},validateDisplay:function(){Wc.release(this._rootDiv);for(var a=this._table.getZoom(),b=this.getHeight()+"px",c=this.getHeight()-2+"px",d=this._table.getColumnBox().getRoots(),e=d.size(),f=0,g=this._table._columnLineWidth*a,h=0;e>h;h++){var i=d.get(h);if(i.isVisible()){var j=i.getWidth()*a;0>j&&(j=0);var k=Math.min(g,j),l=this._divPool.get();l._column=i;var m=l.style;m.position="absolute",m.whiteSpace="nowrap",m.lineHeight=c,m.overflow="hidden",m.textOverflow="ellipsis",m.backgroundPosition=this._sortIconPosition?this._sortIconPosition:"",m.backgroundRepeat="no-repeat",m.backgroundImage="",m.textAlign=i.getHorizontalAlign(),m.borderStyle="solid",m.borderWidth="0px",m.borderRightWidth=k+"px",m.borderRightColor=this._columnLineColor,0===h?(m.borderLeftWidth=k+"px",m.borderLeftColor=this._columnLineColor):m.borderLeftWidth="0px",m.left=f+"px",m.width=j-k+"px",m.height=b,l._x=f,l._width=j-k,this._rootDiv.insertBefore(l,this._rootDiv.firstChild),this.renderColumn(l,i),this.onColumnRendered(l,i),f+=j,i.isResizable()&&(l=this._resizePool.get(),l._resizeColumn=i,m=l.style,m.position="absolute",m.backgroundColor="white",m.opacity=0,m.left=f-k-this._resizeTolerance+"px",m.width=k+2*this._resizeTolerance+"px",m.height=b,this._rootDiv.appendChild(l))}}this._pools.forEach(function(a){a.clear()}),this._rootDiv.style.width=f+"px",this._rootDiv.style.height=b},renderColumn:function(a,b){if(b.renderHeader)b.renderHeader(a);else{var c=this._textPool.get();if(c.style.whiteSpace="nowrap",c.style.verticalAlign="middle",c.style.padding="1px 2px 1px 2px",c.innerHTML=b.getName()?b.getName():b.getPropertyName(),c.setAttribute("title",c.innerHTML),a.appendChild(c),Qc.isOpera){var d=a.cloneNode(!1);d.style.left="0px",d.style.top="0px",d.style.opacity=0,a.appendChild(d)}}if(this._table.getSortColumn()===b&&b.isSortable()){var e="asc"===b.getSortDirection()?this._sortAscIcon:this._sortDescIcon,f=Jc.getImageSrc(e);if(this._sortIconPosition&&""!==this._sortIconPosition)a.style.backgroundImage="url("+f+")";else{var g=this._imagePool.get();g.setAttribute("src",f),g.style.verticalAlign="middle",a.appendChild(g)}}},onColumnRendered:function(){}}),Ic.controls.TableHeaderInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view;var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Jc.ext("twaver.controls.TableHeaderInteraction",Object,{handleMouseDown:function(a){if(0===a.button){if(this.movableDiv)return void this.handleMouseUp(a);this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this._startClient=Wc.getClientPoint(a),this.lastX=this.getX(a),this._startLogicalX=this.lastX,Wc.handle_mousedown(this,a)}},changeCursor:function(a){var b="";if(a.target._resizeColumn)b="ew-resize";else{var c=this.getColumnAt(a);c&&(c.isMovable()||c.isSortable())&&(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(null==this.lastX)return void this.changeCursor(a);if(Wc.target===this){var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeColumn){if(null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();10>c&&(c=10,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=Wc.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleMouseUp:function(a){if(0===a.button){var b;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else if(b=this.getColumnAt(a),b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?("desc"===d&&this.table.setSortColumn(null),b.setSortDirection("asc"===d?"desc":"asc")):this.table.setSortColumn(b),this.table.onColumnSorted(this.table.getSortColumn())}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX,delete this._startClient,delete this._startLogicalX},getColumnAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Wc.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){for(var b=this._startLogicalX+a.clientX-this._startClient.x+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1,h=0;d>h;h++){var i=c.get(h);if(i===this.movableDiv._column&&(g=!0),i.isVisible()){var j=i.getWidth()*e;if(0>=j)continue;if(b>=f&&f+j>=b){var k=f+j/2>b;!g||i===this.movableDiv._column&&k||h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),Ic.controls.TableHeaderTouchInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view,Wc.addEventListener("touchstart","handleTouchstart",this.view,this)},Jc.ext("twaver.controls.TableHeaderTouchInteraction",Object,{handleTouchstart:function(a){return Wc.preventDefault(a),this.movableDiv?void this.handleTouchend(a):(this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),Wc.addEventListener("touchmove","handleTouchmove",this.view,this),void Wc.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(a){if(Wc.preventDefault(a),null!=this.lastX){var b;if(this.resizeColumn){if(b=this.getX(a),null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();0>c&&(c=0,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){b=this.getX(a);var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=Wc.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleTouchend:function(a){Wc.preventDefault(a);var b;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else if(b=this.getColumnAt(a),b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?("desc"===d&&this.table.setSortColumn(null),b.setSortDirection("asc"===d?"desc":"asc")):this.table.setSortColumn(b)}this.clear(),Wc.removeEventListener("touchmove",this.view,this),Wc.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX},getColumnAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Wc.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){for(var b=this.getX(a)+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1,h=0;d>h;h++){var i=c.get(h);
if(i===this.movableDiv._column&&(g=!0),i.isVisible()){var j=i.getWidth()*e;if(0>=j)continue;if(b>=f&&f+j>=b){var k=f+j/2>b;!g||i===this.movableDiv._column&&k||h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),Ic.controls.TablePane=function(a,b){Ic.controls.TablePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._table=a,this._tableHeader=b?b:new Ic.controls.TableHeader(a),this._view=Wc.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._tableHeader.getView()),this._view.appendChild(this._table.getView());var c=this;this._tableHeader.addPropertyChangeListener(function(a){"height"===a.property&&c.invalidate()})},Jc.ext("twaver.controls.TablePane",Ic.controls.ControlBase,{onPropertyChanged:function(){this.invalidate()},getTable:function(){return this._table},getTableHeader:function(){return this._tableHeader},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._tableHeader.getHeight();this._tableHeader.adjustBounds({x:0,y:0,width:a,height:c}),this._table.adjustBounds({x:0,y:c,width:a,height:Math.max(0,b-c)})}}),Ic.controls.TreeTable=function(a){this._treeColumn=new Ic.Column,this._treeColumn.setName("tree"),this._treeColumn.setWidth(120),this._treeColumn.renderCell=this.renderTreeCell,this._treeColumn.getValue=this.getTreeValue,this._treeColumn.setValue=this.setTreeValue,this._initTree(a),Ic.controls.TreeTable.superClass.constructor.apply(this,arguments),this._columnBox.add(this._treeColumn)},Jc.ext("twaver.controls.TreeTable",Ic.controls.TableBase,{__tree:1,__accessor:["sortFunction","visibleFunction","checkMode","rootData","sortColumn","indent","rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["editable","rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Ce.TREETABLE_EDITABLE,_indent:Ce.TREETABLE_INDENT,_rowHeight:Ce.TREETABLE_ROW_HEIGHT,_rowLineWidth:Ce.TREETABLE_ROW_LINE_WIDTH,_rowLineColor:Ce.TREETABLE_ROW_LINE_COLOR,_columnLineWidth:Ce.TREETABLE_COLUMN_LINE_WIDTH,_columnLineColor:Ce.TREETABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Ce.TREETABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Ce.TREETABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Ce.TREETABLE_KEYBOARD_SELECT_ENABLED,_expandIcon:Ce.TREETABLE_EXPAND_ICON,_collapseIcon:Ce.TREETABLE_COLLAPSE_ICON,_lineType:Ce.TREE_LINE_TYPE,_lineColor:Ce.TREE_LINE_COLOR,_lineThickness:Ce.TREE_LINE_THICKNESS,_lineAlpha:Ce.TREE_LINE_ALPHA,_lineDash:Ce.TREE_LINE_DASH,getTreeColumn:function(){return this._treeColumn},renderTreeCell:function(a){a.view._renderTree(a.div,a.data,a.rowIndex,a.selected)},getTreeValue:function(a,b){return b.getLabel(a)},setTreeValue:function(a,b){a.setName(b)}}),Ic.controls.PropertySheet=function(a){Ic.controls.PropertySheet.superClass.constructor.apply(this,arguments),this._currentRowIndex=-1,this._currentEditor=null,this._currentData=null,this._invalidate=!1,this._resizeDiv=Wc.createDiv(),this._resizeDiv.style.backgroundColor="white",this._resizeDiv.style.opacity=0,this._resizeDiv.style.top="0px",this._categoryList=new me,this._categoryMap={},this._rowList=new me,this._propertyBox=new Ic.PropertyBox,this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox,this),this.__divPool=new Ic.Pool("div",2),this.__cellPool=new Ic.Pool("div",2),this.__imagePool=new Ic.Pool("img",2),this.__textPool=new Ic.Pool("span",2),this._stringPool=new Ic.Pool("span",2),this._booleanPool=new Ic.Pool("input",2),this._colorPool=new Ic.Pool("div",2),this._pools.add(this.__divPool),this._pools.add(this.__cellPool),this._pools.add(this.__imagePool),this._pools.add(this.__textPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this._view=Wc.createView("auto"),this._rootDiv=Wc.createDiv(),this._dataDiv=Wc.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new Ic.DataBox);var b=this;this._view.addEventListener("change",function(a){b.handleChange(a)},!1);var c;c=Qc.isMSToucheable?Ic.controls.PropertySheetMSTouchInteraction:Qc.isTouchable?Ic.controls.PropertySheetTouchInteraction:Ic.controls.PropertySheetInteraction,c&&new c(this)},Jc.ext("twaver.controls.PropertySheet",Ic.controls.View,{__accessor:["indent","rowHeight","sumWidth","propertyNameWidth","propertyNameHorizontalAlign","autoAdjustable","rowLineWidth","columnLineWidth","borderColor","categorizable","resizeTolerance","editable","selectColor","expandIcon","collapseIcon","sortFunction","visibleFunction"],_autoAdjustable:Ce.PROPERTYSHEET_AUTO_ADJUSTABLE,_selectColor:Ce.SELECT_COLOR,_categorizable:Ce.PROPERTYSHEET_CATEGORIZABLE,_editable:Ce.PROPERTYSHEET_EDITABLE,_propertyNameWidth:Ce.PROPERTYSHEET_PROPERTY_NAME_WIDTH,_propertyNameHorizontalAlign:Ce.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN,_sumWidth:Ce.PROPERTYSHEET_SUM_WIDTH,_indent:Ce.PROPERTYSHEET_INDENT,_rowHeight:Ce.PROPERTYSHEET_ROW_HEIGHT,_rowLineWidth:Ce.PROPERTYSHEET_ROW_LINE_WIDTH,_columnLineWidth:Ce.PROPERTYSHEET_COLUMN_LINE_WIDTH,_borderColor:Ce.PROPERTYSHEET_BORDER_COLOR,_expandIcon:Ce.PROPERTYSHEET_EXPAND_ICON,_collapseIcon:Ce.PROPERTYSHEET_COLLAPSE_ICON,_resizeTolerance:Ce.PROPERTYSHEET_RESIZE_TOLERANCE,getPropertyBox:function(){return this._propertyBox},getCurrentData:function(){return this._currentData},getDataDiv:function(){return this._dataDiv},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidate(),this.firePropertyChange("dataBox",b,this._box)}},invalidatePropertyBox:function(){this._isValidating||this.invalidate()},onPropertyChanged:function(a){"zoom"!==a.property&&this.invalidate()},isVisible:function(a){return a.isVisible&&!a.isVisible(this._currentData,this)?!1:this._visibleFunction?this._visibleFunction(a):!0},handlePropertyChange:function(a){this._currentData===a.source&&this.invalidate()},handleSelectionChange:function(){this._currentData!==this.getSelectionModel().getLastData()&&(this._currentRowIndex=-1,this.invalidate())},isExpanded:function(a){if(!a)return!0;var b=this._categoryMap[a];return b?b.isExpanded:Ce.PROPERTYSHEET_EXPAND_CATEGORY},expand:function(a){if(a){var b=this._categoryMap[a];b&&!b.isExpanded&&(b.isExpanded=!0,this.invalidate())}},expandAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!0)}this.invalidate()},collapse:function(a){if(a){var b=this._categoryMap[a];b&&b.isExpanded&&(b.isExpanded=!1,this.invalidate())}},collapseAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!1)}this.invalidate()},getCategoryName:function(a){if(!this.isCategorizable())return"null";var b=a.getCategoryName();return b?b:"null"},validateModel:function(){this._rowList.clear(),this._categoryList.clear();var a,b,c,d,e,f={},g=new me,h=this._currentData?this._propertyBox.getRoots():new me;for(d=h.size(),a=0;d>a;a++)e=h.get(a),this.isVisible(e)&&(g.add(e),c=this.getCategoryName(e),f[c]||(this._categoryList.add(c),f[c]={isExpanded:this.isExpanded(c),properties:new me}));for(this._sortFunction&&g.sort(this._sortFunction),this._categoryMap=f,d=g.size(),a=0;a<this._categoryList.size();a++){c=this._categoryList.get(a),"null"!==c&&this._rowList.add(c);var i=f[c];if(i.isExpanded)for(b=0;d>b;b++)e=g.get(b),this.getCategoryName(e)===c&&(i.properties.add(e),this._rowList.add({view:this,data:this._currentData,property:e,value:this._currentData?this.getValue(this._currentData,e):null}))}},adjustWidth:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight;a<=this._indent||0>=b||(a-=this._indent,this._rowList.size()*this._rowHeight>b&&(a-=Ce.SCROLL_BAR_WIDTH,0>=a)||(this._propertyNameWidth=0===this._sumWidth||this._propertyNameWidth>this._sumWidth?a/2:a*(this._propertyNameWidth/this._sumWidth),this._sumWidth=a,this._view.style.overflowX="hidden",this._view.style.overflowY="auto"))},validateDisplay:function(){var a=this._rowList.size(),b=this._borderColor,c=this._indent,d=this._rowHeight,e=this._propertyNameWidth,f=Math.max(0,this._sumWidth-e),g=this._rowLineWidth,h=this._columnLineWidth,i=d-g+"px",j=d-g-2+"px",k=c+"px",l=e-h+"px",m=f-h+"px",n=e+f+"px",o=g+"px",p=h+"px",q=e+"px",r=this._dataDiv,s=r.style;s.height=a*d+"px",s.width=c+e+f+"px";var t=this.__divPool.get();s=t.style,s.position="absolute",s.left="0px",s.top="0px",s.width=k,s.height=r.style.height,s.borderWidth="0px",s.backgroundColor=b,r.appendChild(t);for(var u=0;a>u;u++){var v=this._rowList.get(u),w=u*d+"px",x=this.__divPool.get();if(v.rowDiv=x,s=x.style,s.position="absolute",s.whiteSpace="nowrap",s.overflow="hidden",s.textOverflow="ellipsis",s.left=k,s.top=w,s.width=n,s.height=i,s.lineHeight=j,s.borderStyle="solid",s.borderWidth="0px",s.borderBottomWidth=o,s.borderBottomColor=b,r.appendChild(x),"string"==typeof v){s.backgroundColor=b,t=this.__divPool.get(),s=t.style,s.position="absolute",s.left="0px",s.top=w,s.width=k,s.height=i,s.lineHeight=j,s.borderWidth="0px",r.appendChild(t);var y=this.__imagePool.get(),z=this.isExpanded(v)?this._expandIcon:this._collapseIcon;y.setAttribute("src",Jc.getImageSrc(z)),s=y.style,s.verticalAlign="middle",y._expandData=v,t.appendChild(y),this.renderCategory(x,v),this.onCategoryRendered(x,v)}else{var A=v.property,B=this.__cellPool.get();v.nameRender=B,s=B.style,this._currentRowIndex===u&&(s.backgroundColor=this.getSelectColor()),s.position="absolute",s.verticalAlign="middle",s.textAlign=this._propertyNameHorizontalAlign,s.overflow="hidden",s.textOverflow="ellipsis",s.whiteSpace="nowrap",s.left="0px",s.top="0px",s.width=l,s.height=i,s.borderStyle="solid",s.borderWidth="0px",s.borderRightWidth=p,s.borderRightColor=b,x.appendChild(B),this.renderName(v),this.onNameRendered(v),B=this.__cellPool.get(),v.valueRender=B,s=B.style,s.position="absolute",s.verticalAlign="middle",s.textAlign=A.getHorizontalAlign(),s.whiteSpace="nowrap",s.overflow="hidden",s.textOverflow="ellipsis",s.left=q,s.top="0px",s.width=m,s.height=i,s.borderStyle="solid",s.borderWidth="0px",s.borderRightWidth=p,s.borderRightColor=b,x.appendChild(B),this.renderValue(v),this.onValueRendered(v)}}s=this._resizeDiv.style,s.left=c+e-h-this._resizeTolerance+"px",s.width=h+2*this._resizeTolerance+"px",s.height=r.style.height,r.appendChild(this._resizeDiv)},renderCategory:function(a,b){var c=this.__textPool.get(),d=c.style;d.fontWeight="bold",d.whiteSpace="nowrap",d.overflow="hidden",d.textOverflow="ellipsis",d.verticalAlign="middle",d.padding="1px 2px 1px 2px",c.innerHTML=b,c.setAttribute("title",b),a.appendChild(c)},onCategoryRendered:function(){},renderName:function(a){if(a.property.renderName)return void a.property.renderName(a);var b=this.__textPool.get(),c=b.style;c.fontWeight="",c.whiteSpace="nowrap",c.verticalAlign="middle",c.padding="1px 2px 1px 2px";var d=a.property.getName();d||(d=a.property.getPropertyName()),b.innerHTML=d,b.setAttribute("title",d),a.nameRender.appendChild(b)},onNameRendered:function(){},renderValue:function(a){var b=a.property;if(b.renderValue)return void b.renderValue(a);var c=a.value,d=b.getEnumInfo();d&&!Array.isArray(d)&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.valueRender._editInfo=a),Ad.render(b.getValueType(),c,a.valueRender,a.view,b.isInnerText())},onValueRendered:function(){},updateCurrentData:function(){this._currentData=this.getSelectionModel().getLastData()},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;Wc.release(this._dataDiv),this.updateCurrentData(),this.validateModel(),this.isAutoAdjustable()&&this.adjustWidth(),this.validateDisplay(),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b)},getValue:function(a,b){return a?b.getValue(a,this):null},setValue:function(a,b,c){a&&b.setValue(a,c,this)},isCellEditable:function(a,b){return a?this.isEditable()&&b.isEditable():!1},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowList.size()?c:-1},handleChange:function(a){this._isCommitting||this._isCanceling||this._isValidating||a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)},commitEditValue:function(a,b){var c;c="checkbox"===b.type?b.checked:b.value;var d=a.property,e=d.getValueType();if("int"===e&&"string"==typeof c)c=parseInt(c);else if("number"===e&&"string"==typeof c)c=parseFloat(c);else if("array.string"===e)c=c.split(",");else if("array.number"===e){c=c.split(",");for(var f=0,g=c.length;g>f;f++)c[f]=parseFloat(c[f])}this.setValue(a.data,d,c),Ic.Util.setFocus(this._view),this._currentEditor&&(this._rootDiv.removeChild(this._currentEditor),delete this._currentEditor),delete this._isCommitting},cancelEditing:function(){this._currentEditor&&(this._rootDiv.removeChild(this._currentEditor),delete this._currentEditor,delete this._isCanceling)},updateCurrentRowIndex:function(a){var b=this._rowList.size();(0>a||a>=b)&&(a=-1);var c,d=this._currentRowIndex;if(a!==d&&(d>=0&&b>d&&(c=this._rowList.get(d),c.nameRender&&(c.nameRender.style.backgroundColor="")),this._currentRowIndex=a),a>=0&&(c=this._rowList.get(a),c.nameRender&&(c.nameRender.style.backgroundColor=this.getSelectColor(),!this._currentEditor&&c.valueRender&&c.valueRender._editInfo))){var e=c.valueRender._editInfo;if(e.enumInfo?this._currentEditor=Wc.createSelect(e.enumInfo,e.value):(this._currentEditor=Oc.createElement("input"),null!=e.value&&(this._currentEditor.value=e.value)),this._currentEditor){this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;if(13===a.keyCode){if(b._isCommitting)return;b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target)}else 27===a.keyCode&&(b._isCanceling=!0,b.cancelEditing())},!1),this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;b._isCommitting||b._isCanceling||(b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target))},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=e;var f=this._currentEditor.style;f.position="absolute",f.margin="0px",f.border="0px",f.padding="0px",f.left=this._indent+this._propertyNameWidth+"px",f.top=c.rowDiv.style.top,f.width=c.valueRender.style.width,f.height=c.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor),Ic.Util.setFocus(this._currentEditor)}}}}),Ic.controls.PropertySheetInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv;var b=this;this.view.addEventListener("mousedown",function(a){0===a.button&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Jc.ext("twaver.controls.PropertySheetInteraction",Object,{minGap:10,handleMouseDown:function(a){if(a.target!==this.sheet._currentEditor&&a.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&Ic.Util.setFocus(this.view),!this.sheet._isValidating))if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target===this.resizeDiv)this.lastX=this.getX(a),Wc.handle_mousedown(this,a);else{this.sheet._currentEditor&&!this.sheet._isCommitting&&(this.sheet._isCommitting=!0,this.sheet.commitEditValue(this.sheet._currentEditor._editInfo,this.sheet._currentEditor));var c=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(c)}},handleMouseMove:function(a){if(null==this.lastX&&!Wc.target)return void this.changeCursor(a);if(Wc.target===this&&null!=this.lastX){var b=this.getX(a);if(null!=this.stopLeft){if(b<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(b>this.stopRight)return;delete this.stopRight}var c=this.sheet.getPropertyNameWidth()+(b-this.lastX);c<this.minGap?(c=this.minGap,this.stopLeft=b):c>this.sheet.getSumWidth()-this.minGap&&(c=this.sheet.getSumWidth()-this.minGap,this.stopRight=b),this.sheet.setPropertyNameWidth(c),this.lastX=b}},handleMouseUp:function(a){0===a.button&&(this.view.style.cursor="default",delete this.stopLeft,delete this.stopRight,delete this.lastX)},changeCursor:function(a){this.view.style.cursor=a.target===this.resizeDiv?"ew-resize":"default"},getX:function(a){return a.clientX/this.sheet.getZoom()}}),Ic.controls.PropertySheetTouchInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,Wc.addEventListener("touchstart","handleTouchstart",this.view,this)},Jc.ext("twaver.controls.PropertySheetTouchInteraction",Object,{minGap:10,handleTouchstart:function(a){Wc.preventDefault(a),a.target!==this.sheet._currentEditor&&a.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&Ic.Util.setFocus(this.view),this.sheet._isValidating||(a.target===this.resizeDiv&&(this.lastX=this.getX(a)),this.lastPoint=this.sheet.getLogicalPoint(a),zd.isMultiTouch(a)&&(this.distance=zd.getDistance(a),this.zoom=this.sheet.getZoom()),Wc.addEventListener("touchmove","handleTouchmove",this.view,this),Wc.addEventListener("touchend","handleTouchend",this.view,this)))},handleTouchmove:function(a){if(Wc.preventDefault(a),this.moved||(this.moved=!0),null!=this.lastX){var b=this.getX(a);if(null!=this.stopLeft){if(b<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(b>this.stopRight)return;delete this.stopRight}var c=this.sheet.getPropertyNameWidth()+(b-this.lastX);c<this.minGap?(c=this.minGap,this.stopLeft=b):c>this.sheet.getSumWidth()-this.minGap&&(c=this.sheet.getSumWidth()-this.minGap,this.stopRight=b),this.sheet.setPropertyNameWidth(c),this.lastX=b}else if(zd.isSingleTouch(a)){if(this.lastPoint){var d=this.sheet.getLogicalPoint(a),e=this.lastPoint.x-d.x,f=this.lastPoint.y-d.y,g=this.sheet.panByOffset(e,f);this.lastPoint.x-=e-g.x,this.lastPoint.y-=f-g.y}}else if(this.distance){var h=zd.getDistance(a)/this.distance;this.sheet.setZoom(this.zoom*h,!1)}},handleTouchend:function(a){if(Wc.preventDefault(a),!this.moved)if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target===this.resizeDiv);else{var c=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(c)}delete this.stopLeft,delete this.stopRight,delete this.lastX,delete this.lastPoint,delete this.distance,delete this.zoom,delete this.moved,Wc.removeEventListener("touchmove",this.view,this),Wc.removeEventListener("touchend",this.view,this)},getX:function(a){var b=a.changedTouches[0];return b.clientX}}),Ic.controls.PropertySheetMSTouchInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,this._pointerMap={},this._pointerIdArray=[];var b=this;this.view.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.view.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.view.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.view.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1),this.superHandleMouseDown=Ic.controls.PropertySheetMSTouchInteraction.superClass.handleMouseDown},Jc.ext("twaver.controls.PropertySheetMSTouchInteraction",Ic.controls.PropertySheetInteraction,{handleMouseDown:function(){},handleTouchstart:function(a){a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),this._pointerMap[a.pointerId]||null==this.sheet.getLogicalPoint(a)||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length&&a.pointerType==a.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(a),1==this._pointerIdArray.length?(this._startTouchPoint=this.sheet.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.sheet.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Tc.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.sheet.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var c=this.sheet.getLogicalPoint(a);if(null==c)return;var d=this._startTouchPoint.x-c.x,e=this._startTouchPoint.y-c.y,f=this.sheet.panByOffset(d,e);this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}},handleTouchend:function(a){if(1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.sheet.getLogicalPoint(a),c=new Date;c.getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,b)<=20&&this.superHandleMouseDown(a)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Tc.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Ic.controls.SplitPane=function(a,b,c,d){Ic.controls.SplitPane.superClass.constructor.apply(this,arguments),this._view=Wc.createView("hidden",!0),this._view.tabIndex=-1,this._dividerDiv=Wc.createDiv(),this._dividerDiv.tabIndex=-1,this._view.appendChild(this._dividerDiv),a&&this.setFirstView(a),b&&this.setNextView(b),c&&this.setOrientation(c),null!=d&&this.setPosition(d),this.setDividerDraggable(!0),this.invalidate();var e;e=Qc.isTouchable&&!Qc.isMSToucheable?Ic.controls.SplitPaneTouchInteraction:Ic.controls.SplitPaneInteraction,e&&new e(this)},Jc.ext("twaver.controls.SplitPane",Ic.controls.ControlBase,{__accessor:["orientation","dividerWidth","dividerBackground","dividerOpacity","maskBackground"],__bool:["dividerDraggable"],_position:Ce.SPLITPANE_POSITION,_orientation:Ce.SPLITPANE_ORIENTATION,_dividerWidth:Ce.SPLITPANE_DIVIDER_WIDTH,_dividerBackground:Ce.SPLITPANE_DIVIDER_BACKGROUND,_dividerOpacity:Ce.SPLITPANE_DIVIDER_OPACITY,_maskBackground:Ce.SPLITPANE_MASK_BACKGROUND,onPropertyChanged:function(){this.invalidate()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(a){if(0>a&&(a=0),a>1&&(a=1),a!==this._position){var b=this._position;this._position=a,this.firePropertyChange("position",b,a)}},setFirstView:function(a){if(this._firstView!==a){var b=this._firstView;b&&this._view.removeChild(b.getView?b.getView():b),this._firstView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("firstView",b,a)}},getFirstView:function(){return this._firstView},setNextView:function(a){if(this._nextView!==a){var b=this._nextView;b&&this._view.removeChild(b.getView?b.getView():b),this._nextView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("nextView",b,a)}},getNextView:function(){return this._nextView},validateImpl:function(){var a=this._position,b=this._view.offsetWidth,c=this._view.offsetHeight,d=this._dividerWidth;if(d>=8||0===d?this._coverDiv&&(this._dividerDiv.removeChild(this._coverDiv),delete this._coverDiv):this._coverDiv||(this._coverDiv=Wc.createDiv(),this._coverDiv.tabIndex=-1,this._dividerDiv.appendChild(this._coverDiv)),"horizontal"===this._orientation){d>b&&(d=b);var e=(b-d)*a,f=b-d-e+1;Jc.setViewBounds(this._firstView,{x:0,y:0,width:e,height:c}),Jc.setViewBounds(this._nextView,{x:e+d,y:0,width:f,height:c}),Jc.setViewBounds(this._dividerDiv,{x:e,y:0,width:d,height:c}),this._dividerDiv.position=e,this._coverDiv&&Jc.setViewBounds(this._coverDiv,{x:d/2-4,y:0,width:8,height:c})}else{d>c&&(d=c);var g=(c-d)*a,h=c-d-g;Jc.setViewBounds(this._firstView,{x:0,y:0,width:b,height:g}),Jc.setViewBounds(this._nextView,{x:0,y:g+d,width:b,height:h}),Jc.setViewBounds(this._dividerDiv,{x:0,y:g,width:b,height:d}),this._dividerDiv.position=g,this._coverDiv&&Jc.setViewBounds(this._coverDiv,{x:0,y:d/2-4,width:b,height:8})}var i=this._dividerDiv.style;i.background=this._dividerBackground}}),Ic.controls.SplitPaneInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv;var b=this;this.view.addEventListener("mousedown",function(a){0===a.button&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Jc.ext("twaver.controls.SplitPaneInteraction",Object,{handleMouseDown:function(a){if(this.splitPane.isDividerDraggable())if(this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=Wc.createDiv();var b=this.resizeDiv.style;b.left=this.dividerDiv.style.left,b.top=this.dividerDiv.style.top,b.width=this.dividerDiv.style.width,b.height=this.dividerDiv.style.height,b.opacity=this.splitPane.getDividerOpacity(),b.background=this.splitPane.getDividerBackground(),this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?a.clientX:a.clientY,this.resizeDiv.maskDiv=Wc.createDiv(),b=this.resizeDiv.maskDiv.style,b.left="0px",b.top="0px",b.width=this.view.clientWidth+"px",b.height=this.view.clientHeight+"px",b.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv),Wc.handle_mousedown(this,a),a.preventDefault()}},handleMouseMove:function(a){if(this.splitPane.isDividerDraggable())if(this.resizeDiv||Wc.target)this.resizeDiv&&Wc.target===this&&("horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition+"px");else{var b="horizontal"===this.splitPane._orientation?"ew-resize":"ns-resize";this.view.style.cursor=a.target===this.dividerDiv||a.target===this.splitPane._coverDiv?b:"default"}},handleMouseUp:function(a){this.splitPane.isDividerDraggable()&&0===a.button&&this.clear(a)},clear:function(a){if(this.resizeDiv){var b,c=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var d=this.view.clientWidth;c>d&&(c=d),b=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition,this.splitPane.setPosition(b/(d-c))}else{var e=this.view.clientHeight;c>e&&(c=e),b=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition,this.splitPane.setPosition(b/(e-c))}this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),Ic.controls.SplitPaneTouchInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv,Wc.addEventListener("touchstart","handleTouchstart",this.view,this)},Jc.ext("twaver.controls.SplitPaneTouchInteraction",Object,{handleTouchstart:function(a){if(Wc.preventDefault(a),this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=Wc.createDiv();var b=this.resizeDiv.style;b.left=this.dividerDiv.style.left,b.top=this.dividerDiv.style.top,b.width=this.dividerDiv.style.width,b.height=this.dividerDiv.style.height,b.opacity=this.splitPane.getDividerOpacity(),b.background=this.splitPane.getDividerBackground();var c=a.changedTouches[0];this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?c.clientX:c.clientY,this.resizeDiv.maskDiv=Wc.createDiv();var b=this.resizeDiv.maskDiv.style;b.left="0px",b.top="0px",b.width=this.view.clientWidth+"px",b.height=this.view.clientHeight+"px",b.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv)}Wc.addEventListener("touchmove","handleTouchmove",this.view,this),Wc.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(Wc.preventDefault(a),this.resizeDiv){var b=a.changedTouches[0];"horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition+"px"}else;},handleTouchend:function(a){Wc.removeEventListener("touchmove",this.view,this),Wc.removeEventListener("touchend",this.view,this),this.clear(a)},clear:function(a){var b=a.changedTouches[0];if(this.resizeDiv){var c=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var d=this.view.clientWidth;c>d&&(c=d);var e=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition;this.splitPane.setPosition(e/(d-c))}else{var f=this.view.clientHeight;c>f&&(c=f);var e=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition;this.splitPane.setPosition(e/(f-c))}this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),Ic.controls.TabPane=function(){Ic.controls.TabPane.superClass.constructor.apply(this,arguments),this._tabBox=new Ic.TabBox,this._tabBox.addDataBoxChangeListener(this.handleTabChange,this),this._tabBox.addDataPropertyChangeListener(this.handleTabChange,this),this._tabBox.addHierarchyChangeListener(this.handleTabChange,this),this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange,this),this._view=Wc.createView("hidden",!0),this._tabDiv=Wc.createDiv(),this._tabDiv.onmousedown=Wc.preventDefault,this._tabDiv.onkeydown=Wc.preventDefault,this._contentDiv=Wc.createDiv(),this._view.appendChild(this._tabDiv),this._view.appendChild(this._contentDiv),this._divPool=new Ic.Pool("div"),this._iconPool=new Ic.Pool("img"),this._closePool=new Ic.Pool("img"),this._textPool=new Ic.Pool("span"),this._resizePool=new Ic.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._closePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this.invalidateTab();var a;a=Qc.isTouchable&&!Qc.isMSToucheable?Ic.controls.TabPaneTouchInteraction:Ic.controls.TabPaneInteraction,a&&new a(this)},Jc.ext("twaver.controls.TabPane",Ic.controls.ControlBase,{__accessor:["tabGap","tabRadius","tabHeight","horizontalAlign","tabOrientation","resizeTolerance","tabBackground","selectBackground","moveBackground","insertBackground","closeIcon","disabledColor"],__bool:["selectNextOnClose","selectNextOnInVisible"],_tabGap:Ce.TABPANE_TAB_GAP,_tabRadius:Ce.TABPANE_TAB_RADIUS,_tabHeight:Ce.TABPANE_TAB_HEIGHT,_resizeTolerance:Ce.TABPANE_RESIZE_TOLERANCE,_tabOrientation:Ce.TABPANE_TAB_ORIENTATION,_tabBackground:Ce.TABPANE_TAB_BACKGROUND,_disabledColor:Ce.TABPANE_DISABLED_COLOR,_selectBackground:Ce.TABPANE_SELECT_BACKGROUND,_moveBackground:Ce.TABPANE_MOVE_BACKGROUND,_insertBackground:Ce.TABPANE_INSERT_BACKGROUND,_horizontalAlign:Ce.TABPANE_HORIZONTAL_ALIGN,_closeIcon:Ce.TABPANE_CLOSE_ICON,_selectNextOnClose:Ce.TABPANE_SELECT_NEXT_ON_CLOSE,_selectNextOnInVisible:Ce.TABPANE_SELECT_NEXT_ON_INVISIBLE,onPropertyChanged:function(){this.invalidateTab()},getTabBox:function(){return this._tabBox},getTabDiv:function(){return this._tabDiv},getContentDiv:function(){return this._contentDiv},handleTabChange:function(a){if(this._selectNextOnInVisible&&"visible"===a.property&&!a.newValue&&this._tabBox.getSelectionModel().contains(a.source)){for(var b,c,d=a.source,e=this._tabBox.getRoots().indexOf(d),f=this._tabBox.getRoots(),g=f.size(),h=e;g-1>h;)if(b=f.get(++h),b.isVisible()&&!b.isDisabled()){c=b;
break}if(!c)for(h=e;h>0;)if(b=f.get(--h),b.isVisible()&&!b.isDisabled()){c=b;break}this._tabBox.getSelectionModel().setSelection(c)}this.invalidateTab()},invalidateTab:function(a){this._invalidateTab||(this._invalidateTab=!0,this.invalidate(a))},validateImpl:function(){this._invalidateTab&&(this._invalidateTab=!1,this.validateTab());var a,b=this._view.offsetWidth,c=this._view.offsetHeight;"top"===this._tabOrientation?(this._tabDiv.style.top="0px",a={x:0,y:this._tabHeight,width:b,height:Math.max(0,c-this._tabHeight)}):(this._tabDiv.style.top=c-this._tabHeight+"px",a={x:0,y:0,width:b,height:Math.max(0,c-this._tabHeight)}),this._currentView&&Jc.setViewBounds(this._currentView,a)},getCurrentTab:function(){return this._currentTab},getCurrentView:function(){return this._currentView},onViewRemoved:function(){},onViewAdded:function(){},validateTab:function(){this._currentTab=this._tabBox.getSelectionModel().getLastData();var a=this._currentTab?this._currentTab.getView():null;if(a!==this._currentView){var b,c;this._currentView&&(b=this._currentView.getView?this._currentView.getView():this._currentView,b.style.visibility="hidden",this.onViewRemoved(this._currentView)),a&&(c=a.getView?a.getView():a,c.style.visibility="inherit",c.parentNode||this._contentDiv.appendChild(c),this.onViewAdded(a)),this._currentView=a}Wc.release(this._tabDiv);for(var d=this._tabBox.getRoots(),e=this._tabHeight+"px",f=this._tabHeight-2+"px",g=this._tabRadius+"px",h=d.size(),i=0,j=0;h>j;j++){var k=d.get(j);if(k.isVisible()){var l=this._currentTab===k,m=k.getWidth();0>m&&(m=0);var n=Math.min(this._tabGap,m),o=this._divPool.get();o._tab=k;var p=o.style;p.position="absolute",p.whiteSpace="nowrap",p.lineHeight=f,p.overflow="hidden",p.textOverflow="ellipsis",p.background=l?this._selectBackground:this._tabBackground,p.textAlign=this._horizontalAlign,"top"===this._tabOrientation?(p.borderTopLeftRadius=g,p.borderTopRightRadius=g,p.borderBottomLeftRadius="0px",p.borderBottomRightRadius="0px"):(p.borderTopLeftRadius="0px",p.borderTopRightRadius="0px",p.borderBottomLeftRadius=g,p.borderBottomRightRadius=g),p.left=i+"px",p.width=m-n+"px",p.height=e,o._x=i,o._width=m-n,this.renderTab(o,k),this.onTabRendered(o,k),this._tabDiv.insertBefore(o,this._tabDiv.firstChild),i+=m,k.isResizable()&&(o=this._resizePool.get(),o._resizeTab=k,p=o.style,p.position="absolute",p.backgroundColor="white",p.opacity=0,p.left=i-n-this._resizeTolerance+"px",p.width=n+2*this._resizeTolerance+"px",p.height=e,this._tabDiv.appendChild(o))}}this._tabDiv.style.left="0px",this._tabDiv.style.width=i+"px",this._tabDiv.style.height=this._tabHeight+"px",this._pools.forEach(function(a){a.clear()})},renderTab:function(a,b){if(b.renderTab)b.renderTab(a);else{var c=b.getIcon();if(c){var d=this._iconPool.get();d.setAttribute("src",Jc.getImageSrc(c)),d.style.paddingLeft="4px",d.style.verticalAlign="middle",a.appendChild(d)}var e=b.getName();if(e){var f=this._textPool.get();f.style.whiteSpace="nowrap",f.style.verticalAlign="middle",f.style.padding="2px 4px",f.innerHTML=e,a.appendChild(f)}if(Qc.isOpera){var g=a.cloneNode(!1);g.style.left="0px",g.style.top="0px",g.style.opacity=0,a.appendChild(g)}}if(b.isClosable()){var h=this._tabRadius/4+2,d=this._closePool.get();d._closeTab=b,d.setAttribute("src",Jc.getImageSrc(this._closeIcon)),d.style.position="absolute",d.style.top=h+"px",d.style.right=h+"px",a.appendChild(d)}a.style.color=b.isDisabled()?this.getDisabledColor():""},onTabRendered:function(){}}),Ic.controls.TabPaneInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv();var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Jc.ext("twaver.controls.TabPaneInteraction",Object,{handleMouseDown:function(a){if(0===a.button){if(this.movableDiv)return void this.handleMouseUp(a);this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this.lastX=this.getX(a),this._startClient=Wc.getClientPoint(a),this._startLogicalX=this.lastX,Wc.handle_mousedown(this,a)}},changeCursor:function(a){var b="";if(a.target._resizeTab)b="ew-resize";else{var c=this.getTabAt(a);!c||c.isDisabled()&&!c.isMovable()||(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(null==this.lastX)return void this.changeCursor(a);if(Wc.target===this){var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeTab){if(null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);10>c&&(c=10,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=Wc.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}}},handleMouseUp:function(a){if(0===a.button){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX,delete this._startLogicalX,delete this._startClient},getTabAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Wc.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){for(var b=this._startLogicalX+a.clientX-this._startClient.x,c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1,g=0;d>g;g++){var h=c.get(g);if(h===this.movableDiv._tab&&(f=!0),h.isVisible()){var i=h.getWidth();if(0>=i)continue;if(b>=e&&e+i>=b){var j=e+i/2>b;!f||h===this.movableDiv._tab&&j||g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),Ic.controls.TabPaneTouchInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv(),Wc.addEventListener("touchstart","handleTouchstart",this.view,this)},Jc.ext("twaver.controls.TabPaneTouchInteraction",Object,{handleTouchstart:function(a){return Wc.preventDefault(a),this.movableDiv?void this.handleTouchend(a):(this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),Wc.addEventListener("touchmove","handleTouchmove",this.view,this),void Wc.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(a){if(null!=this.lastX)if(this.resizeTab){var b=this.getX(a);if(null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);0>c&&(c=0,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var b=this.getX(a),d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=Wc.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleTouchend:function(a){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear(),Wc.removeEventListener("touchmove",this.view,this),Wc.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX},getTabAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Wc.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){for(var b=this.getX(a),c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1,g=0;d>g;g++){var h=c.get(g);if(h===this.movableDiv._tab&&(f=!0),h.isVisible()){var i=h.getWidth();if(0>=i)continue;if(b>=e&&e+i>=b){var j=e+i/2>b;!f||h===this.movableDiv._tab&&j||g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),Ic.controls.TitlePane=function(a,b,c){Ic.controls.TitlePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._titleDiv=Wc.createDiv(),this._titleDiv.tabIndex=-1,this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.fontWeight="bold",this._titleDiv.style.textOverflow="ellipsis",this._titleDiv.style.overflow="hidden",this._titleDiv.style.whiteSpace="nowrap",this._titleDiv.onmousedown=Wc.preventDefault,this._span=Oc.createElement("span"),this._span.style.verticalAlign="middle",this._span.style.paddingLeft="4px",this._span.style.paddingRight="4px",this._img=Oc.createElement("img"),this._img.style.verticalAlign="middle",this._img.style.paddingLeft="4px",this._view=Wc.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._titleDiv),b&&this.setTitle(b),a&&this.setContent(a),c&&this.setIcon(c)},Jc.ext("twaver.controls.TitlePane",Ic.controls.ControlBase,{__accessor:["icon","title","titleHeight","titleHorizontalAlign","titleBackground"],_titleHeight:Ce.TITLEPANE_TITLE_HEIGHT,_titleBackground:Ce.TITLEPANE_TITLE_BACKGROUND,_titleHorizontalAlign:Ce.TITLEPANE_TITLE_HORIZONTAL_ALIGN,onPropertyChanged:function(){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getContent:function(){return this._content},setContent:function(a){if(this._content!==a){var b=this._content;b&&this._view.removeChild(b.getView?b.getView():b),this._content=a,a&&this._view.appendChild(a.getView?a.getView():a),this.firePropertyChange("content",b,a)}},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._titleDiv.style;c.textAlign=this._titleHorizontalAlign,c.lineHeight=this._titleHeight-2+"px",c.background=this._titleBackground,Wc.clear(this._titleDiv),this._icon&&(this._img.setAttribute("src",Jc.getImageSrc(this._icon)),this._titleDiv.appendChild(this._img)),this._title&&(this._span.innerHTML=this._title,this._span.setAttribute("title",this._title),this._titleDiv.appendChild(this._span));var c=this._titleDiv.style;c.left="0px",c.top="0px",c.width=a+"px",c.height=this._titleHeight+"px",Jc.setViewBounds(this._content,{x:0,y:this._titleHeight,width:a,height:Math.max(b-this._titleHeight,0)})}}),Ic.controls.Accordion=function(){Ic.controls.Accordion.superClass.constructor.apply(this,arguments),this._titleMap={},this._titleList=new me,this._currentTitle=null,this._currentView=null,this._view=Wc.createView("hidden",!0),this.invalidate();var a=this;this._view.addEventListener("mousedown",function(b){a.handleMouseDown(b)},!1)},Jc.ext("twaver.controls.Accordion",Ic.controls.ControlBase,{__accessor:["expandIcon","collapseIcon","titleHeight","titleBackground","borderBottomColor","iconPosition"],_expandIcon:Ce.ACCORDION_EXPAND_ICON,_collapseIcon:Ce.ACCORDION_COLLAPSE_ICON,_titleHeight:Ce.ACCORDION_TITLE_HEIGHT,_titleBackground:Ce.ACCORDION_TITLE_BACKGROUND,_borderBottomColor:Ce.ACCORDION_BORDER_BOTTOM_COLOR,_iconPosition:Ce.ACCORDION_ICON_POSITION,onPropertyChanged:function(){this.invalidate()},handleMouseDown:function(a){if(0===a.button){var b=a.target._title;b||(b=a.target.parentNode._title),b&&(this._currentTitle===b?this.collapse():this.expand(b))}},getTitles:function(){return this._titleList},getCurrentTitle:function(){return this._currentTitle},add:function(a,b){if(this._titleMap[a])throw"Title ' + title + ' already exists";var c=Wc.createDiv();c._title=a,c.onmousedown=Wc.preventDefault,c.style.cursor="pointer",c.style.textAlign="left",c.style.textOverflow="ellipsis",c.style.whiteSpace="nowrap",c.style.overflow="hidden",c.style.borderBottomWidth="1px",c.style.borderBottomStyle="solid";var d=Oc.createElement("img");d.style.verticalAlign="middle",d.style.paddingLeft="4px";var e=Oc.createElement("span");if(e.style.verticalAlign="middle",e.style.paddingLeft="4px",e.innerHTML=a,e.setAttribute("title",a),this._view.appendChild(c),c.appendChild(d),c.appendChild(e),"right"==this._iconPosition){var f=d.style,g=(this._titleHeight-8)/2;f.marginTop=g+"px",f.right="15px",f.position="absolute"}this._titleMap[a]={content:b,titleDiv:c,span:e,img:d},this._titleList.add(a),this.invalidate()},remove:function(a){var b=this._titleMap[a];b&&this._view.removeChild(b.titleDiv),delete this._titleMap[a],this._titleList.remove(a),this.invalidate()},clear:function(){var a=this;Object.keys(a._titleMap).forEach(function(b){a._view.removeChild(a._titleMap[b].titleDiv)}),a._titleMap={},a._titleList.clear(),a.invalidate()},expand:function(a){this._titleMap[a]&&this._currentTitle!==a&&(this._currentTitle=a,this.onExpanded(a),this.invalidate())},onExpanded:function(){},collapse:function(){this._currentTitle&&(this.onCollapsed(this._currentTitle),this._currentTitle=null,this.invalidate())},onCollapsed:function(){},validateImpl:function(){var a=this._currentView;this._currentView=null;for(var b=this._view.offsetWidth,c=this._view.offsetHeight,d=this._titleList.size(),e=0,f=0;d>f;f++){var g=this._titleList.get(f),h=this._titleMap[g],i=h.titleDiv.style;i.lineHeight=this._titleHeight-3+"px",i.background=this._titleBackground,i.borderBottomColor=this._borderBottomColor,i.left="0px",i.top=e+"px",i.width=b+"px",i.height=this._titleHeight-1+"px";var j=this._currentTitle===g,k=j?this._expandIcon:this._collapseIcon;if(h.img.setAttribute("src",Jc.getImageSrc(k)),j){var l=Math.max(0,c-d*this._titleHeight);h.content&&(this._currentView=h.content.getView?h.content.getView():h.content,Jc.setViewBounds(h.content,{x:0,y:e+this._titleHeight,width:b,height:l})),e+=this._titleHeight+l}else e+=this._titleHeight}this._currentView&&this._currentView!==a&&this._view.appendChild(this._currentView),a&&a!==this._currentView&&this._view.removeChild(a)}}),Ic.controls.BorderPane=function(a,b,c,d,e){Ic.controls.BorderPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._view=Wc.createView("hidden",!0),this._view.tabIndex=-1,a&&this.setCenter(a),b&&this.setTop(b),c&&this.setRight(c),d&&this.setBottom(d),e&&this.setLeft(e)},Jc.ext("twaver.controls.BorderPane",Ic.controls.ControlBase,{__accessor:["hGap","vGap","topHeight","bottomHeight","leftWidth","rightWidth"],_hGap:Ce.BORDERPANE_HGAP,_vGap:Ce.BORDERPANE_VGAP,_topHeight:0,_bottomHeight:0,_leftWidth:0,_rightWidth:0,onPropertyChanged:function(){this.invalidate()},getCenter:function(){return this._center},setCenter:function(a){this._setContent("center",a)},getTop:function(){return this._top},setTop:function(a){this._setContent("top",a)},getRight:function(){return this._right},setRight:function(a){this._setContent("right",a)},getBottom:function(){return this._bottom},setBottom:function(a){this._setContent("bottom",a)},getLeft:function(){return this._left},setLeft:function(a){this._setContent("left",a)},_setContent:function(a,b){var c=this["_"+a];if(c!==b){if(c){var d=c.getView?c.getView():c;this._view.contains(d)&&this._view.removeChild(d)}this["_"+a]=b,b&&this._view.appendChild(b.getView?b.getView():b),this.firePropertyChange(a,c,b)}},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=0,d=0,e=a,f=b,g=0,h=0,i=0,j=0;this._top&&(g=this._topHeight||(this._top.getView?this._top.getView().offsetHeight:this._top.offsetHeight),d=g+this._vGap),this._bottom&&(h=this._bottomHeight||(this._bottom.getView?this._bottom.getView().offsetHeight:this._bottom.offsetHeight),f=b-h-this._vGap),this._left&&(i=this._leftWidth||(this._left.getView?this._left.getView().offsetWidth:this._left.offsetWidth),c=i+this._hGap),this._right&&(j=this._rightWidth||(this._right.getView?this._right.getView().offsetWidth:this._right.offsetWidth),e=a-j-this._hGap);var k=Math.max(0,e-c),l=Math.max(0,f-d);this._top&&Jc.setViewBounds(this._top,{x:0,y:0,width:a,height:g}),this._bottom&&Jc.setViewBounds(this._bottom,{x:0,y:f,width:a,height:h}),this._left&&Jc.setViewBounds(this._left,{x:0,y:d,width:i,height:l}),this._right&&Jc.setViewBounds(this._right,{x:e,y:d,width:j,height:l}),this._center&&Jc.setViewBounds(this._center,{x:c,y:d,width:k,height:l})}}),Ic.controls.PopupMenu=function(a){this._view=Wc.createDiv(),this._view.style.zIndex=100001,this._items=[],this._itemsMap={},this.setContextView(a);var b=this._view,c=this;b.addEventListener("mouseover",function(){c._mouseOver=!0},!1),b.addEventListener("mouseout",function(){c._mouseOver=!1},!1),b.oncontextmenu=function(a){a.preventDefault()},Wc.addEventListener("mousedown","_handleClick",b,this)},Jc.ext("twaver.controls.PopupMenu",Object,{_width:200,_menuItemHeight:25,_background:"#F9F9F9",_border:"2px outset white",_disabledColor:"#BABBBC",_focusColor:"#C2CFF1",_subMenuEnableIcon:Ce.POPUPMENU_SUBNENU_ENABLE_ICON,_subMenuDisableIcon:Ce.POPUPMENU_SUBNENU_DISABLE_ICON,_checkboxSelectedIcon:Ce.POPUPMENU_CHECKBOX_SELECTED_ICON,_checkboxUnselectedIcon:Ce.POPUPMENU_CHECKBOX_UNSELECTED_ICON,_radiobuttonSelectedIcon:Ce.POPUPMENU_RADIOBUTTON_SELECTED_ICON,_radiobuttonUnselectedIcon:Ce.POPUPMENU_RADIOBUTTON_UNSELECTED_ICON,getView:function(){return this._view},getContextView:function(){return this._contextView},setContextView:function(a){if(this._removeContextmenuListener(),this._contextView=a,a){var b=a.getView?a.getView():a;Qc.isTouchable?(b.addEventListener("touchstart",this._getTouchStartListener(),!1),b.addEventListener("touchmove",this._getTouchMoveListener(),!1),b.addEventListener("touchend",this._getTouchEndListener(),!1)):Wc.addEventListener("contextmenu","_handleContextmenu",b,this)}},getMenuItems:function(){return this._items},setMenuItems:function(a){if(this._items=[],this._itemsMap={},a)for(var b=0,c=a.length;c>b;b++)this.addMenuItem(a[b])},addMenuItem:function(a){a.separator!==!0&&(this._itemsMap[a.id||a.label]=a),this._items.push(a)},getMenuItem:function(a){return this._itemsMap[a]},addSeparator:function(){this.addMenuItem({separator:!0})},getMenuItemById:function(a){return this._itemsMap[a]},isVisible:function(a){return a.visible!==!1},isEnabled:function(a){return a.enabled!==!1},show:function(a){this.hide();var b,c,d=this._view,e=this._view.style;if(Qc.isTouchable?(b=a.changedTouches[0].clientX,c=a.changedTouches[0].clientY):(b=a.clientX,c=a.clientY),Wc.clear(d),this.renderMenu(d,this._items),0!==this._height){Wc.addEventListener(Qc.isTouchable?"touchstart":"mousedown","_handleBodyClicked",Oc.body,this);var f=Wc.windowWidth()-this._width-10,g=Wc.windowHeight()-this._height-10;b=b>f?f:b,c=c>g?g:c,b=0>b?0:b,c=0>c?0:c,e.left=b+zd.scrollLeft()+"px",e.top=c+zd.scrollTop()+"px",Oc.body.appendChild(d)}},_showMenuItem:function(a,b){this._hideMenuItem(b);var c=Oc.createElement("div");b.menuItem.childrenDiv=c;var d=c.style;d.color="#000000",d.position="absolute";var e=this._width,f=b.offsetTop,g=b.menuItem.items;if(this._itemsShow=!0,b.appendChild(c),Wc.clear(c),this.renderMenu(c,g),0!==this._height){var h=Wc.windowWidth()-this._width-10,i=Wc.windowHeight()-10,j=this._getPosition(this._view);e=j.left+this._width>h?-this._width:e,f=j.top+f+g.length*this._menuItemHeight>i?f-(g.length-1)*this._menuItemHeight:f,d.left=e+"px",d.top=f+"px",b.appendChild(c)}},hide:function(){Oc.body.contains(this._view)&&Oc.body.removeChild(this._view),delete this._mouseOver,delete this._itemsShow,Wc.removeEventListener(Qc.isTouchable?"touchstart":"mousedown",Oc.body,this)},_hideMenuItem:function(a){var b=a.menuItem.childrenDiv;b&&a.contains(b)&&a.removeChild(b),this._itemsShow=!1},dispose:function(){this._removeContextmenuListener(),this.hide()},onMenuShowing:function(){return!0},onAction:function(){},renderMenu:function(a,b){var c=a.style;c.background=this._background,c.border=this._border,c.width=this._width+"px",this._height=0,delete this._separator;for(var d,e=0,f=b.length;f>e;e++)if(d=b[e],this.isVisible(d))if(d.separator===!0)this._separator=!0;else{var g=Oc.createElement("div");this.isEnabled(d)&&this._addMouseoverListener(g,d),g.menuItem=d,a.appendChild(g),this.renderMenuItem(g,d),this.onMenuItemRendered(g,d),this._separator=!1,this._height+=this._menuItemHeight}},renderMenuItem:function(a,b){var c=a.style;c.height=this._menuItemHeight+"px",this._separator&&(c.borderTop="1px solid gray"),this.isEnabled(b)||(c.color=this._disabledColor);var d=Oc.createElement("span");c=d.style,c.position="absolute",c.width="25px",c.height=this._menuItemHeight+"px",c.lineHeight=this._menuItemHeight+"px",c.textAlign="center",a.appendChild(d);var e;if("check"===b.type?e=b.selected?this._checkboxSelectedIcon:this._checkboxUnselectedIcon:"radio"===b.type?e=b.selected?this._radiobuttonSelectedIcon:this._radiobuttonUnselectedIcon:b.icon&&(e=b.icon),e){var f=new Pc;f.src=Jc.getImageSrc(e),f.style.verticalAlign="middle",d.appendChild(f)}var g=Oc.createElement("label");if(Jc.setText(g,b.label,!0),c=g.style,c.position="absolute",c.height=this._menuItemHeight+"px",c.lineHeight=this._menuItemHeight+"px",c.left="25px",a.appendChild(g),b.items&&a.parentNode===this._view){var h=Oc.createElement("img");c=h.style,this.isEnabled(b)?h.setAttribute("src",Jc.getImageSrc(this._subMenuEnableIcon)):h.setAttribute("src",Jc.getImageSrc(this._subMenuDisableIcon));var i=(this._menuItemHeight-8)/2;c.marginTop=i+"px",c.right="5px",c.position="absolute",a.appendChild(h)}},onMenuItemRendered:function(){},_addMouseoverListener:function(a,b){var c=this;a.addEventListener(Qc.isTouchable?"touchstart":"mouseover",function(d){a.style.background=c._focusColor,a.style.color="#FFFFFF",this===d.relatedTarget||this.contains(d.relatedTarget)||b.items&&!c._itemsShow&&a.parentNode==c._view&&c._showMenuItem(d,a)},!1),a.addEventListener(Qc.isTouchable?"touchend":"mouseout",function(d){if(a.style.background=c._background,a.style.color="#000000",this!==d.relatedTarget&&!this.contains(d.relatedTarget)&&b.items&&a.parentNode===c._view){var e=d.clientX,f=d.clientY,g=b.childrenDiv,h=c._getPosition(g);(e<h.left+2||e>h.left+g.offsetWidth-2||f<h.top+2||f>h.top+g.offsetHeight-2)&&c._hideMenuItem(a)}},!1)},_getPosition:function(a){for(var b=0,c=0;a;)c+=a.offsetLeft,b+=a.offsetTop,a=a.offsetParent;return{left:c,top:b}},_removeContextmenuListener:function(){var a=this._contextView;a&&(a=a.getView?a.getView():a,Qc.isTouchable?(a.removeEventListener("touchstart",this._getTouchStartListener(),!1),a.removeEventListener("touchmove",this._getTouchMoveListener(),!1),a.removeEventListener("touchend",this._getTouchEndListener(),!1)):Wc.removeEventListener("contextmenu",a,this))},_handleContextmenu:function(a){this.onMenuShowing(a)===!0&&this.show(a),a.preventDefault()},_handleBodyClicked:function(a){if(Qc.isTouchable){for(var b=a.target;b&&b!==this._view;)b=b.parentElement;b!==this._view&&this.hide()}else this._mouseOver||this.hide()},_handleClick:function(a){if(0===a.button){for(var b=a.target;!b.menuItem&&b.parentElement;)b=b.parentElement;var c=b?b.menuItem:null;c&&this.isEnabled(c)&&("check"===c.type&&(c.selected=!c.selected),"radio"===c.type&&(c.groupName?(c.selected=!0,this._items.forEach(function(a){c!==a&&a.groupName===c.groupName&&(a.selected=!1),a.items&&a.items.forEach(function(a){c!==a&&a.groupName===c.groupName&&(a.selected=!1)})})):c.selected=!c.selected),c.action&&c.action(c),this.onAction(c),c.items&&c.items.length>0||this.hide())}},_getTouchStartListener:function(){if(!this._touchStartListener){var a=this;this._touchStartListener=function(){a._touchMoved=!1,a._lastTouch=new Date}}return this._touchStartListener},_getTouchMoveListener:function(){if(!this._touchMoveListener){var a=this;this._touchMoveListener=function(){a._touchMoved=!0}}return this._touchMoveListener},_getTouchEndListener:function(){if(!this._touchEndListener){var a=this;this._touchEndListener=function(b){!a._touchMoved&&(new Date).getTime()-a._lastTouch.getTime()>1e3&&a._handleContextmenu(b)}}return this._touchEndListener},getWidth:function(){return this._width},setWidth:function(a){this._width=a},getMenuItemHeight:function(){return this._menuItemHeight},setMenuItemHeight:function(a){this._menuItemHeight=a},getBackground:function(){return this._background},setBackground:function(a){this._background=a},getBorder:function(){return this._border},setBorder:function(a){this._border=a},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(a){this._disabledColor=a},getFocusColor:function(){return this._focusColor},setFocusColor:function(a){this._focusColor=a},getSubMenuEnableIcon:function(){return this._subMenuEnableIcon},setSubMenuEnableIcon:function(a){this._subMenuEnableIcon=a},getSubMenuDisableIcon:function(){return this._subMenuDisableIcon},setSubMenuDisableIcon:function(a){this._subMenuDisableIcon=a},getCheckboxSelectedIcon:function(){return this._checkboxSelectedIcon},setCheckboxSelectedIcon:function(a){this._checkboxSelectedIcon=a},getCheckboxUnselectedIcon:function(){return this._checkboxUnselectedIcon},setCheckboxUnselectedIcon:function(a){this._checkboxUnselectedIcon=a},getRadiobuttonSelectedIcon:function(){return this._radiobuttonSelectedIcon},setRadiobuttonSelectedIcon:function(a){this._radiobuttonSelectedIcon=a},getRadiobuttonUnselectedIcon:function(){return this._radiobuttonUnselectedIcon},setRadiobuttonUnselectedIcon:function(a){this._radiobuttonUnselectedIcon=a}}),Ic.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},Ic.charts.ChartBase=function(a){Ic.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new me,this._view=Wc.createView("hidden"),this._canvas=Wc.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(a?a:new Ic.ElementBox),this.invalidate();var b;b=Qc.isMSToucheable?Ic.charts.ChartMSTouchInteraction:Qc.isTouchable?Ic.charts.ChartTouchInteraction:Ic.charts.ChartInteraction,b&&new b(this),this.setToolTipEnabled(Ce.CHART_TOOLTIP_ENABLED)},Jc.ext("twaver.charts.ChartBase",Ic.controls.ViewBase,{__accessor:["xGap","yGap","xTranslate","yTranslate","valueVisible","sortFunction","visibleFunction","xTranslateEnabled","yTranslateEnabled","xZoomEnabled","yZoomEnabled","selectTolerance","backgroundVisible","backgroundFill","backgroundFillColor","backgroundOutlineWidth","backgroundOutlineColor","backgroundGradient","backgroundGradientColor","outerZoom"],__bool:["doubleClickToReset","focusOnClick"],_backgroundVisible:Ce.CHART_BACKGROUND_VISIBLE,_backgroundFill:Ce.CHART_BACKGROUND_FILL,_backgroundFillColor:Ce.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:Ce.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:Ce.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:Ce.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:Ce.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:Ce.CHART_SELECT_TOLERANCE,_doubleClickToReset:Ce.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:Ce.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_outerZoomL:1,_xGap:Ce.CHART_XGAP,_yGap:Ce.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:Ce.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:Ce.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:Ce.ZOOM_MAX,_minZoom:Ce.ZOOM_MIN,_xZoomEnabled:Ce.CHART_XZOOM_ENABLED,_yZoomEnabled:Ce.CHART_YZOOM_ENABLED,_valueVisible:Ce.CHART_VALUE_VISIBLE,_valueFont:Ce.CHART_VALUE_FONT,isToolTipEnabled:function(){return this._toolTipListener?!0:!1},setToolTipEnabled:function(a){if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){Bd.showToolTip(a,b.getToolTip(a))},this._canvas.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Bd.hideToolTip(),this._canvas.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getToolTip:function(a){if(this._toolTipInfos){var b=this.getLogicalPoint(a);b.x-=this._xTranslate,b.y-=this._yTranslate;for(var c=this._toolTipInfos.size(),d=c-1;d>=0;d--){var e=this._toolTipInfos.get(d);if(e.rect&&Tc.containsPoint(e.rect,b))return this.getToolTipByData(e.data,e)}}else{var f=this.tryGetDataAt(a);if(f)return this.getToolTipByData(f,{value:this.getValue(f)})}return null},getToolTipByData:function(a,c){return c.value!==b?this.formatValueText(c.value,a):null},addToolTipInfo:function(a,b,c,d,e,f,g){this._toolTipInfos&&this._toolTipInfos.add({data:f,rect:{x:a,y:b,width:c,height:d},value:e,index:g})},getLogicalPoint:function(a){return Wc.getLogicalPoint(this._canvas,a,this._outerZoom)},getTextSize:function(a,b){var c=Xc.getTextSize(a,b);return c.width&&(c.width+=4),c},getUniqueColor:function(a,c){if(null==a)return null;var d;if(!c&&(d=this._nonDataColors[a]))return d;var e=Xc.getColorArray(a);if(!c)return d=255!=e[3]?a:"rgba("+e[0]+","+e[1]+","+e[2]+",0.99)",this._nonDataColors[a]=d,d;var f="rgb("+e[0]+","+e[1]+","+e[2]+")";if(this._uniqueColors[f]===b||this._uniqueColors[f]===c);else{var g=1,h=-1,i=1;for(Qc.isOpera&&(e=[e[0],e[1],e[2]]);;){if(e[0]+=g,e[0]>=255?(e[0]=255,g=-1):e[0]<=0&&(e[0]=0,g=1),f="rgb("+e[0]+","+e[1]+","+e[2]+")",this._uniqueColors[f]===b||this._uniqueColors[f]===c)break;if(e[1]+=h,e[1]>=255?(e[1]=255,h=-1):e[1]<=0&&(e[1]=0,h=1),f="rgb("+e[0]+","+e[1]+","+e[2]+")",this._uniqueColors[f]===b||this._uniqueColors[f]===c)break;if(e[2]+=i,e[2]>=255?(e[2]=255,i=-1):e[2]<=0&&(e[2]=0,i=1),f="rgb("+e[0]+","+e[1]+","+e[2]+")",this._uniqueColors[f]===b||this._uniqueColors[f]===c)break}}return this._uniqueColors[f]=c,f},tryGetDataAt:function(a,b){if((null==b||0>b)&&(b=this._selectTolerance),a.target&&(a=Wc.getLogicalPoint(this._canvas,arguments[0],this._outerZoom)),!a)return null;var c=a.x-b,d=a.y-b,e=2*b+1,f=2*b+1;try{for(var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data,h=0,i=g.length;i>h;h+=4)if(255===g[h+3]){var j="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",k=this._uniqueColors[j];if(k)return k}}catch(l){}return null},_getPoint:function(){var a,b;if(2===arguments.length)a=arguments[0],b=arguments[1];
else if(arguments[0].target){var c=Wc.getLogicalPoint(this._canvas,arguments[0],this._outerZoom);if(!c)return null;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;return{x:a,y:b}},getDataAt:function(){var a=this._getPoint.apply(this,arguments),b=a.x,c=a.y;if(0>b||0>c||b>this._canvasWidth||c>this._canvasHeight)return null;try{var d=this._canvas.getContext("2d").getImageData(b,c,1,1).data;if(255===d[3]){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(a,b){this._backgroundRect=Jc.clone(b),null!=b&&b.width>0&&b.height>0&&this._backgroundVisible&&(this._backgroundFill&&Xc.fill(a,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),b),this._backgroundOutlineWidth>0&&(a.lineWidth=this._backgroundOutlineWidth,a.strokeStyle=this._backgroundOutlineColor),a.beginPath(),a.rect(b.x,b.y,b.width,b.height),a.closePath(),this._backgroundFill&&a.fill(),this._backgroundOutlineWidth>0&&a.stroke())},getName:function(a){return a.getName()},getColor:function(a){return a.getStyle?a.getStyle("chart.color"):a.getClient("chart.color")},getValue:function(a){return a.getStyle?a.getStyle("chart.value"):0},getValueColor:function(a){return a.getStyle?a.getStyle("chart.value.color"):Ic.Styles.getStyle("chart.value.color")},setValueFont:function(a){if(a!==this._valueFont){var b=a;this._valueFont=a,this.firePropertyChange("valueFont",b,a)}},getValueFont:function(a){if(a){var b=a.getStyle?a.getStyle("chart.value.font"):Ic.Styles.getStyle("chart.value.font");if(b)return b}return this._valueFont},formatValueText:function(a){return a},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(a){return this._internalVisibleFunction&&!this._internalVisibleFunction(a)?!1:this._visibleFunction?this._visibleFunction(a):!0},onPropertyChanged:function(a){Ic.charts.IS_INVALIDATE_PROPERTY[a.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)}},handleDataBoxChange:function(){this.invalidateModel()},handlePropertyChange:function(){this.invalidateModel()},handleHierarchyChange:function(){this.invalidateModel()},handleSelectionChange:function(){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new me,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(a,b){a.forEach(function(a){b.add(a),this._buildChildren(a.getChildren(),b)},this)},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this.invalidate())},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(a){a.IStyle?a.getStyle("chart.color")||a.setStyle("chart.color",Jc.nextColor()):a.getClient("chart.color")||a.setClient("chart.color",Jc.nextColor())}),this.validateModel());var a=this._canvas.getContext("2d");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute("width",this._canvasWidth),this._canvas.setAttribute("height",this._canvasHeight),a.clearRect(0,0,this._canvasWidth,this._canvasHeight),this._canvasWidth>0&&this._canvasHeight>0&&(a.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new me:null,this.validateDisplay(a,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,a.translate(-this._xTranslate,-this._yTranslate))},validateModel:function(){},validateDisplay:function(){},drawLine:function(a,b,c,d,e,f,g){c>0&&(a.lineWidth=c,a.strokeStyle=this.getUniqueColor(b),a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke())},drawValueTexts:function(a){this._valueTexts&&this._valueTexts.forEach(function(b){Xc.drawText(a,b.text,b,b.font,b.color)})},drawVerticalText:function(a,b,c,d,e){e=this.getUniqueColor(e),a.translate(c.x,c.y),a.rotate(-Math.PI/2),Xc.drawText(a,b,null,d,e),a.rotate(Math.PI/2),a.translate(-c.x,-c.y)},_getValueTextInfo:function(a,b){if(this._valueTexts){var c=this.formatValueText(b,a);if(c&&""!==c){var d=this.getValueColor(a),e={text:c,font:this.getValueFont(a),color:this.getUniqueColor(d,a)};return this._valueTexts.add(e),e}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(!(0>a)){var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getXZoom()>a&&this.setXZoom(a,!1),this.getYZoom()>a&&this.setYZoom(a,!1)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(!(0>a)){var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getXZoom()<a&&this.setXZoom(a),this.getYZoom()<a&&this.setYZoom(a)}},zoomIn:function(a){null==a&&(a=Ce.ZOOM_ANIMATE),a?Ic.animate.AnimateManager.start(new Ic.animate.AnimateXYZoom(this,this._xZoom*Ce.ZOOM_INCREMENT,this._yZoom*Ce.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(a){null==a&&(a=Ce.ZOOM_ANIMATE),a?Ic.animate.AnimateManager.start(new Ic.animate.AnimateXYZoom(this,this._xZoom/Ce.ZOOM_INCREMENT,this._yZoom/Ce.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(a){null==a&&(a=Ce.ZOOM_ANIMATE),a?Ic.animate.AnimateManager.start(new Ic.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(){},xZoomIn:function(a){this.setXZoom(this._xZoom*Ce.ZOOM_INCREMENT,a)},xZoomOut:function(a){this.setXZoom(this._xZoom/Ce.ZOOM_INCREMENT,a)},xZoomReset:function(a){this.setXZoom(1,a)},setXZoom:function(a,b){if(Jc.num(a)&&!(0>=a)&&(a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a!==this.xZoom))if(null==b&&(b=Ce.ZOOM_ANIMATE),b)Ic.animate.AnimateManager.start(new Ic.animate.AnimateXZoom(this,a));else{var c=this._xZoom,d=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/c*(a-c);this._xZoom=a,this.firePropertyChange("xZoom",c,a),this.onXZoomChanged(c,a),this.setXTranslate(d)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(){},yZoomIn:function(a){this.setYZoom(this._yZoom*Ce.ZOOM_INCREMENT,a)},yZoomOut:function(a){this.setYZoom(this._yZoom/Ce.ZOOM_INCREMENT,a)},yZoomReset:function(a){this.setYZoom(1,a)},setYZoom:function(a,b){if(Jc.num(a)&&!(0>=a)&&(a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a!==this.YZoom))if(null==b&&(b=Ce.ZOOM_ANIMATE),b)Ic.animate.AnimateManager.start(new Ic.animate.AnimateYZoom(this,a));else{var c=this._yZoom,d=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/c*(a-c);this._yZoom=a,this.firePropertyChange("yZoom",c,a),this.onYZoomChanged(c,a),this.setYTranslate(d)}}}),Ic.charts.ScaleChart=function(){Ic.charts.ScaleChart.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.charts.ScaleChart",Ic.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","xAxisText","xAxisLineColor","xAxisLineWidth","xAxisTextColor","xAxisTextFont","yAxisText","yAxisLineColor","yAxisLineWidth","yAxisTextColor","yAxisTextFont","xScaleTexts","xScaleTextFont","xScaleTextColor","xScaleTextOrientation","yScaleTextVisible","yScaleTextColor","yScaleTextFont","yScaleLineColor","yScaleLineWidth","yScaleValueGap","yScalePixelGap","yScaleMinTextVisible","valueSpanCount"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,null!=this._upperLimit&&(this._max=this._upperLimit),null!=this._lowerLimit&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},formatYScaleText:function(a){return a.toFixed(2)},_initRange:function(){null==this._lowerLimit&&(this._min>=this._max&&(this._min=this._max-.1*Math.abs(this._max)),this._min=this._min-.1*(this._max-this._min)),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.values.forEach(function(a){b.proportions.add(null==a?null:0==this._range?0:a/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new me(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new me,color:this.getUniqueColor(this.getColor(a),a)};this._initInfo&&this._initInfo(a,c),this._map[a.getId()]=c,(null==this._upperLimit||null==this._lowerLimit)&&b.forEach(function(a){null!=a&&(null==this._upperLimit&&a>this._max&&(this._max=a),null==this._lowerLimit&&a<this._min&&(this._min=a))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(a,b,c){var d=0;this._xAxisText&&(d=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var e=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(a){var b=this.getTextSize(this._xScaleTextFont,a),c="vertical"===this._xScaleTextOrientation?b.width:b.height;c>e&&(e=c)},this);var f=c-this._yGap-d-e,g=f-this._yGap,h=null==this._upperLimit?.9*g:g,i=0;this._yAxisText&&(i=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var j,k;this._yScaleValueGap>0?(j=Math.max(this._yScaleValueGap/this._range*h,1),k=this._yScaleValueGap):(j=Math.max(this._yScalePixelGap,1),k=this._range*(j/h));var l,m,n=0,o=new me;if(this._yScaleTextVisible){l=this._yScaleMinTextVisible?0:j;for(var p=this._min+(this._yScaleMinTextVisible?0:k);g+1>=l;){if(m=this.formatYScaleText(p)){var q=this.getTextSize(this._yScaleTextFont,m);q.width>n&&(n=q.width),o.add({text:m,size:q,cursor:l})}l+=j,p+=k}}var r={x:this._xGap+i+n,y:this._yGap,width:b-this._xGap-i-n-this._xGap,height:c-this._yGap-e-d-this._yGap};if(this.drawBackground(a,r),this._columnWidth=this._columnCount>0?r.width/(3*this._columnCount+1)*2:r.width/2,0===this._columnWidth&&(this._columnWidth=1),this._yScaleLineWidth>0)for(l=0;g+1>=l;)this.drawLine(a,this._yScaleLineColor,this._yScaleLineWidth,r.x,f-l,r.x+r.width,f-l),l+=j;this._xAxisText&&Xc.drawText(a,this._xAxisText,{x:r.x+r.width/2,y:f+e+d/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(a,this._yAxisText,{x:this._xGap+i/2,y:g/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(a,this._yAxisLineColor,this._yAxisLineWidth,r.x,r.y+r.height,r.x,r.y);var s=this.getUniqueColor(this._yScaleTextColor);o.forEach(function(b){var c={x:this._xGap+i+n-b.size.width/2,y:f-b.cursor};Xc.drawText(a,b.text,c,this._yScaleTextFont,s)},this);var t=r.y+r.height+e/2;s=this.getUniqueColor(this._xScaleTextColor);for(var u=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null,v=0;v<this._columnCount;v++){var w=r.x+this._columnWidth*(1+1.5*v);if(this._xScaleTexts&&v<this._xScaleTexts.size()&&(m=this._xScaleTexts.get(v))){var x={x:w,y:t};"vertical"===this._xScaleTextOrientation?this.drawVerticalText(a,m,x,this._yScaleTextFont,s):this._valueSpanCount?v%this._valueSpanCount==0&&Xc.drawText(a,m,x,this._xScaleTextFont,s):Xc.drawText(a,m,x,this._xScaleTextFont,s)}"default"!==this._type&&u&&(this._valueSpanCount?v%this._valueSpanCount==0&&this.drawLine(a,u,this._xScaleLineWidth,w,r.y+r.height,w,r.y):this.drawLine(a,u,this._xScaleLineWidth,w,r.y+r.height,w,r.y))}var y=f+this._min/k*j;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(a,r,h,y),this.drawLine(a,this._xAxisLineColor,this._xAxisLineWidth,r.x,r.y+r.height,r.x+r.width,r.y+r.height)}}),Ic.charts.PieChart=function(){this._sum=0,this._map={},Ic.charts.PieChart.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.charts.PieChart",Ic.charts.ChartBase,{__accessor:["type","selectOffset","startAngle","shadowColor","shadowOffset","lineRate","donutRate","valuePosition"],_type:Ce.PIECHART_TYPE,_lineRate:Ce.PIECHART_LINE_RATE,_donutRate:Ce.PIECHART_DONUT_RATE,_startAngle:Ce.PIECHART_START_ANGLE,_shadowColor:Ce.PIECHART_SHADOW_COLOR,_shadowOffset:Ce.PIECHART_SHADOW_OFFSET,_selectOffset:Ce.PIECHART_SELECT_OFFSET,_valuePosition:Ce.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)},this._sum+=b},this);var a=this._startAngle;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.proportion=0===this._sum?0:c.value/this._sum,"line"!==this._type&&(c.startAngle=a,c.arc=c.proportion*Math.PI*2,a+=c.arc)},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-2*this._xGap,height:c-2*this._yGap};if(this.drawBackground(a,d),Tc.grow(d,-4,-4),!(d.width<=0||d.height<=0)){var e=this._shadowOffset;if(e>0&&(a.shadowOffsetX=e,a.shadowOffsetY=e,a.shadowBlur=1.5*e,a.shadowColor=this._shadowColor),"oval"===this._type||"circle"===this._type){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;"circle"===this._type&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(0!==c.arc){var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}a.fillStyle=c.color,a.beginPath(),a.moveTo(f+d,g-e),Xc.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.closePath(),a.fill();var k=this._getValueTextInfo(b,c.value);if(k){var j=c.startAngle+c.arc/2;k.x=f+d+Math.cos(j)*h*this._valuePosition,k.y=g-e-Math.sin(j)*i*this._valuePosition}}},this)}else if("donut"===this._type||"ovalDonut"===this._type){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;"donut"===this._type&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(0!==c.arc){var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}var k=f+Math.cos(c.startAngle)*h*this._donutRate,l=g-Math.sin(c.startAngle)*i*this._donutRate,m=f+Math.cos(c.startAngle+c.arc)*h*this._donutRate,n=g-Math.sin(c.startAngle+c.arc)*i*this._donutRate;a.fillStyle=c.color,a.beginPath(),a.moveTo(k+d,l-e),Xc.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.lineTo(m+d,n-e),Xc.drawArc(a,f+d,g-e,c.startAngle+c.arc,-c.arc,h*this._donutRate,i*this._donutRate,!0),a.closePath(),a.fill();var o=this._getValueTextInfo(b,c.value);if(o){var j=c.startAngle+c.arc/2,p=this._donutRate+(1-this._donutRate)*this._valuePosition;o.x=f+d+Math.cos(j)*h*p,o.y=g-e-Math.sin(j)*i*p}}},this)}else if("line"===this._type){var j=d.height*this._lineRate;d.y=d.y+d.height/2-j/2,d.height=j;var k=d.x;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],e=d.width*c.proportion;if(0!==e){a.beginPath(),a.fillStyle=c.color;var f=this.isSelected(b)?-this._selectOffset:0;a.rect(k,d.y+f,e,d.height),a.closePath(),a.fill();var g=this._getValueTextInfo(b,c.value);g&&(g.x=k+e/2,g.y=d.y+d.height+f-d.height*this._valuePosition),k+=e}},this)}this._shadowOffset>0&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0),this.drawValueTexts(a)}}}),Ic.charts.BarChart=function(){Ic.charts.BarChart.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.charts.BarChart",Ic.charts.ScaleChart,{__accessor:["type"],_upperLimit:Ce.BARCHART_UPPER_LIMIT,_lowerLimit:Ce.BARCHART_LOWER_LIMIT,_type:Ce.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:Ce.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Ce.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:Ce.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Ce.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Ce.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Ce.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:Ce.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Ce.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Ce.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:Ce.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Ce.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:Ce.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Ce.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Ce.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:Ce.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Ce.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Ce.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:Ce.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Ce.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var a=this._type+"ValidateModel";this[a]&&(this._reset(),this[a]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(a){var b=this.getValue(a);null==this._upperLimit&&b>this._max&&(this._max=b),null==this._lowerLimit&&b<this._min&&(this._min=b),this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)}},this),this._initRange(),this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.proportion=0==this._range?0:b.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel()},stackValidateModel:function(){if(this._publishedDatas.forEach(function(a){var b=new me(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new me,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this),null==this._upperLimit||null==this._lowerLimit)for(var a=0;a<this._columnCount;a++){var b=0,c=0;this._publishedDatas.forEach(function(d){var e=this._map[d.getId()];if(e.values.size()>a){var f=e.values.get(a);null!=f&&(f>=0?b+=f:c+=f)}},this),null==this._upperLimit&&b>this._max&&(this._max=b),null==this._lowerLimit&&c<this._min&&(this._min=c)}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new me(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new me,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this);for(var a=new me,b=0;b<this._columnCount;b++){var c=0;this._publishedDatas.forEach(function(a){var d=this._map[a.getId()];if(d.values.size()>b){var e=d.values.get(b);null!=e&&(c+=e)}},this),a.add(c)}for(var b=0;b<this._columnCount;b++)this._publishedDatas.forEach(function(c){var d=this._map[c.getId()],e=a.get(b);if(0!==e&&d.values.size()>b){var f=d.values.get(b);if(null!=f)return void d.proportions.add(f/e)}d.proportions.add(null)},this);this._min=0,this._max=1,this._range=1},drawRect:function(a,b,c,d,e,f,g){a.fillStyle=b,c&&this._selectInfos.add({x:d,y:e,w:f,h:g,color:this.getUniqueColor(Xc.darker(b))}),a.beginPath(),a.rect(d,e,f,g),a.closePath(),a.fill()},drawContent:function(a,b,c,d){this._selectInfos=new me,this._toolTipInfos=this.isToolTipEnabled()?new me:null,"default"===this._type?this.drawDefaultContent(a,b,c,d):"group"===this._type?this.drawGroupContent(a,b,c,d):"percent"===this._type?this.drawPercentContent(a,b,c,d):"stack"===this._type?this.drawStackContent(a,b,c,d):"layer"===this._type&&this.drawLayerContent(a,b,c,d),this.drawValueTexts(a),this._selectInfos.forEach(function(b){a.lineWidth=2,a.strokeStyle=b.color,a.beginPath(),a.rect(b.x,b.y,b.w,b.h),a.closePath(),a.stroke()},this),delete this._selectInfos},drawDefaultContent:function(a,b,c,d){for(var e=this._publishedDatas.size(),f=this._columnWidth,g=0;e>g;g++){var h=this._publishedDatas.get(g),i=this._map[h.getId()],j=b.x+f*(.5+1.5*g),k=Math.abs(c*i.proportion),l=i.proportion>0?d-k:d;this.drawRect(a,i.color,this.isSelected(h),j,l,f,k),this.addToolTipInfo(j,l,f,k,i.value,h);var m=this._getValueTextInfo(h,i.value);if(m){var n=this.getTextSize(m.font,m.text);m.x=j+f/2,m.y=l-n.height/2+1}}},drawPercentContent:function(a,b,c,d){this.drawStackContent(a,b,c,d)},drawStackContent:function(a,b,c,d){for(var e=this._columnCount,f=this._columnWidth,g=0;e>g;g++){var h=d,i=b.x+f*(.5+1.5*g);this._publishedDatas.forEach(function(b){var d=this._map[b.getId()];if(g<d.proportions.size()){var e=d.proportions.get(g);if(null!=e){var j=c*e;h-=j,this.drawRect(a,d.color,this.isSelected(b),i,h,f,j),this.addToolTipInfo(i,h,f,j,d.values.get(g),b);var k=this._getValueTextInfo(b,d.values.get(g));k&&(k.x=i+f/2,k.y=h+j/2)}}},this)}},drawLayerContent:function(a,b,c,d){for(var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=3*g/8/e,i=0;f>i;i++){var j=b.x+g*(.5+1.5*i),k=0;this._publishedDatas.forEach(function(b){var f=this._map[b.getId()];if(i<f.proportions.size()){var l=f.proportions.get(i);if(null!=l){var m=c*l,n=d-m,o=j+g/2-g/8-h*(e-k),p=2*(g/8+h*(e-k));this.drawRect(a,f.color,this.isSelected(b),o,n,p,m),this.addToolTipInfo(o,n,p,m,f.values.get(i),b);var q=this._getValueTextInfo(b,f.values.get(i));if(q){var r=this.getTextSize(q.font,q.text);q.x=o+p/2,q.y=n-r.height/2+1}}}k++},this)}},drawGroupContent:function(a,b,c,d){for(var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=g/e,i=0;f>i;i++){var j=b.x+g*(.5+1.5*i),k=0;this._publishedDatas.forEach(function(b){var e=this._map[b.getId()];if(i<e.proportions.size()){var f=e.proportions.get(i);if(null!=f){var g=c*f,l=d-g;this.drawRect(a,e.color,this.isSelected(b),j+h*k,l,h,g),this.addToolTipInfo(j+h*k,l,h,g,e.values.get(i),b);var m=this._getValueTextInfo(b,e.values.get(i));if(m){var n=this.getTextSize(m.font,m.text);m.x=j+h*k+h/2,m.y=l-n.height/2+1}}}k++},this)}}}),Ic.charts.LineChart=function(){Ic.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Jc.ext("twaver.charts.LineChart",Ic.charts.ScaleChart,{__accessor:["xScaleLineColor","xScaleLineWidth","interruptable"],_interruptable:Ce.LINECHART_INTERRUPTABLE,_upperLimit:Ce.LINECHART_UPPER_LIMIT,_lowerLimit:Ce.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Ce.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Ce.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Ce.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Ce.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Ce.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Ce.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Ce.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Ce.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Ce.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Ce.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Ce.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Ce.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Ce.LINECHART_XSCALE_LINE_WIDTH,_valueSpanCount:Ce.LINECHART_VALUESPANCOUNT,_yScaleTextVisible:Ce.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Ce.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Ce.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Ce.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Ce.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Ce.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Ce.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Ce.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):Ic.Styles.getStyle("chart.line.width")},getMarkerShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):Ic.Styles.getStyle("chart.marker.shape")},getMarkerSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):Ic.Styles.getStyle("chart.marker.size")},_initInfo:function(a,b){b.markerShape=this.getMarkerShape(a),b.markerSize=this.getMarkerSize(a),b.lineWidth=this.getLineWidth(a),this.isSelected(a)&&(b.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var a=this._getPoint.apply(this,arguments),b=this.tryGetDataAt(a);if(!b)return-1;for(var c,d=this._map[b.getId()],e=d.points,f=d.markerSize,g=0,h=e.size();h>g;g++)if(c=e.get(g),c&&Tc.getDistance(a,c)<=f)return g;return-1},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new me:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.markerSize>0?new me:null;a.strokeStyle=f.color,a.lineWidth=f.lineWidth,a.beginPath();var h=f.proportions,i=null,j=h.size(),k=new me;f.points=k;for(var l=0;j>l;l++){var m=h.get(l);if(null!=m){var n={x:b.x+this._columnWidth*(1+1.5*l),y:d-c*m};k.add(n),null==i?a.moveTo(n.x,n.y):a.lineTo(n.x,n.y);var o=f.values.get(l),p=this._getValueTextInfo(e,o);if(p){var q=this.getTextSize(p.font,p.text);p.x=n.x,p.y=n.y-q.height/2+2}g&&g.add({point:n,value:o,data:e,index:l}),i=n}else this._interruptable&&(i=null,k.add(null))}if(a.stroke(),g){var r=f.markerSize/2;g.forEach(function(b){a.fillStyle=f.color;var c=b.point.x-r,d=b.point.y-r,e=f.markerSize,g=f.markerSize;Xc.drawVector(a,f.markerShape,null,c,d,e,g),a.fill(),this.addToolTipInfo(c,d,e,g,b.value,b.data,b.index)},this)}},this),this.drawValueTexts(a)}}),Ic.charts.BubbleChart=function(){Ic.charts.BubbleChart.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.charts.BubbleChart",Ic.charts.ScaleChart,{__accessor:["xAxisUpperLimit","xAxisLowerLimit","xScaleLineColor","xScaleLineWidth","selectShadowColor","selectShadowOffset"],_upperLimit:Ce.BUBBLECHART_UPPER_LIMIT,_lowerLimit:Ce.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:Ce.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:Ce.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Ce.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Ce.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Ce.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Ce.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Ce.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Ce.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Ce.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Ce.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Ce.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Ce.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Ce.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Ce.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Ce.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:Ce.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Ce.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Ce.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Ce.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Ce.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Ce.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Ce.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Ce.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:Ce.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Ce.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,null!=this._xAxisUpperLimit&&(this._xMax=this._xAxisUpperLimit),null!=this._xAxisLowerLimit&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(a){return a.getStyle?a.getStyle("chart.bubble.shape"):Ic.Styles.getStyle("chart.bubble.shape")},getSize:function(a,b){return b},getNames:function(a){return a.getStyle?a.getStyle("chart.names"):Ic.Styles.getStyle("chart.names")},getXAxisValues:function(a){return a.getStyle?a.getStyle("chart.xaxis.values"):Ic.Styles.getStyle("chart.xaxis.values")},getYAxisValues:function(a){return a.getStyle?a.getStyle("chart.yaxis.values"):Ic.Styles.getStyle("chart.yaxis.values")},_initXRange:function(){null==this._xAxisLowerLimit&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-.1*Math.abs(this._xMax)),this._xMin=this._xMin-.1*(this._xMax-this._xMin)),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.xAxisValues.forEach(function(a){b.xAxisProportions.add(null==a?null:0==this._xRange?0:a/this._xRange)},this),b.yAxisValues.forEach(function(a){b.yAxisProportions.add(null==a?null:0==this._range?0:a/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=null==this._xScaleTexts?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(a){var b=new me(this.getYAxisValues(a)),c=new me(this.getXAxisValues(a)),d=new me(this.getValues(a));d.size()>this._columnCount&&(this._columnCount=d.size());var e={data:a,values:d,yAxisValues:b,xAxisValues:c,yAxisProportions:new me,xAxisProportions:new me,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getShape(a)};this._map[a.getId()]=e,(null==this._upperLimit||null==this._lowerLimit)&&b.forEach(function(a){null!=a&&(null==this._upperLimit&&a>this._max&&(this._max=a),null==this._lowerLimit&&a<this._min&&(this._min=a))},this),(null==this._upperLimit||null==this._lowerLimit)&&c.forEach(function(a){null!=a&&(null==this._xAxisUpperLimit&&a>this._xMax&&(this._xMax=a),null==this._xAxisLowerLimit&&a<this._xMin&&(this._xMin=a))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new me:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.yAxisProportions,h=f.xAxisProportions,i=f.values,j=f.yAxisProportions.size(),k=this._selectShadowOffset;this.isSelected(e)&&k>0?(a.shadowOffsetX=k,a.shadowOffsetY=k,a.shadowBlur=2*k,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=f.color),a.fillStyle=f.color;for(var l=0;j>l;l++){var m=g.get(l),n=h.get(l);if(null!=m){var o={x:b.x+b.width*n,y:d-c*m},p=i.get(l),q=this.getSize(e,p),k=q/2,r=o.x-k,s=o.y-k,t=q,u=q;Xc.drawVector(a,f.anchorShape,null,r,s,t,u),a.fill(),this.addToolTipInfo(r,s,t,u,p,e,l);var v=this._getValueTextInfo(e,p);if(v){var q=this.getTextSize(v.font,v.text);v.x=o.x,v.y=o.y}}}},this),this.drawValueTexts(a)}}),Ic.charts.DialChart=function(){Ic.charts.DialChart.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.charts.DialChart",Ic.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","startAngle","endAngle","innerRadius","colorRangeFillColor","outlineWidth","outlineColor","majorScaleCount","majorScaleLineWidth","majorScaleLineLength","majorScaleLineColor","minorScaleCount","minorScaleLineWidth","minorScaleLineLength","minorScaleLineColor","scaleTextVisible","scaleUpperLimitTextVisible","scaleLowerLimitTextVisible","scaleTextFont","scaleTextColor","pivotRadius","pivotFillColor","pivotOutlineWidth","pivotOutlineColor","pivotGradient","pivotGradientColor","valuePosition","colorRangeList","innerDarkerRadius","outerBrighterRadius","selectShadowColor","selectShadowOffset"],__bool:["scaleInside","pivotFill"],_upperLimit:Ce.DIALCHART_UPPER_LIMIT,_lowerLimit:Ce.DIALCHART_LOWER_LIMIT,_startAngle:Ce.DIALCHART_START_ANGLE,_endAngle:Ce.DIALCHART_END_ANGLE,_innerRadius:Ce.DIALCHART_INNER_RADIUS,_colorRangeFillColor:Ce.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:Ce.DIALCHART_OUTLINE_WIDTH,_outlineColor:Ce.DIALCHART_OUTLINE_COLOR,_scaleInside:Ce.DIALCHART_SCALE_INSIDE,_majorScaleCount:Ce.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:Ce.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:Ce.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:Ce.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:Ce.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:Ce.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:Ce.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:Ce.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:Ce.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:Ce.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:Ce.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:Ce.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:Ce.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:Ce.DIALCHART_PIVOT_RADIUS,_pivotFill:Ce.DIALCHART_PIVOT_FILL,_pivotFillColor:Ce.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:Ce.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:Ce.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:Ce.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:Ce.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:Ce.DIALCHART_VALUE_POSITION,_innerDarkerRadius:Ce.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:Ce.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:Ce.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Ce.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(a){return a.toFixed(2)
},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var a=this._startAngle;0!=a&&(a=(a%360+360)%360,0==a&&(a=360)),this._positiveStartAngle=a;var b=this._endAngle;0!=b&&(b=(b%360+360)%360,0==b&&(b=360)),this._positiveEndAngle=b,this._whole=360==Math.abs(a-b),this._startAngleByRadian=a*Math.PI/180,this._endAngleByRadian=b*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a),angle:this._startAngleByRadian+(this._clockwise?-1:1)*b/this._valueRange*this._angleRange}},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-2*this._xGap,height:c-2*this._yGap};if(this.drawBackground(a,d),this._startAngleByRadian!=this._endAngleByRadian){var e,f,g=this._lowerLimit,h=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,i=0,j=0,k=null,l=null;if(this._scaleTextVisible)for(k=new me,e=0;e<this._majorScaleCount;e++)0==e&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(f=null,k.add({text:"",size:{width:0,height:0}})):(l=this.formatScaleText(g),f=this.getTextSize(this._scaleTextFont,l),k.add({text:l,size:f})),this._scaleInside||null==f||(f.width>i&&(i=f.width),f.height>j&&(j=f.height)),g+=h;if(this._angleRange<=Math.PI&&(i=Math.max(i,this._pivotRadius),j=Math.max(j,this._pivotRadius)),Tc.grow(d,-i,-j),this._calcluateCenterAndRadius(d),a.lineWidth=0,null==this._colorRangeList||0==this._colorRangeList.size())this._drawArcGroup(a,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(a,this._startAngleByRadian,this._endAngleByRadian,!0,!0);else{var m=this._angleRange/this._colorRangeList.size(),n=this._startAngleByRadian;for(e=0;e<this._colorRangeList.size();e++){var o=this.getUniqueColor(this._colorRangeList.get(e)),p=n+(this._clockwise?-1:1)*m;this._drawArcGroup(a,n,p,o),this._drawArcOutLine(a,n,n+(this._clockwise?-1:1)*m,0==e,e==this._colorRangeList.size()-1),n+=(this._clockwise?-1:1)*m}}var q,r,s,t,u,v,w,x,y=this._startAngleByRadian,z=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0;for(v=this._scaleInside?this._innerRadiusByPixel:this._outerRadius,w=v+this._majorScaleLineLength*(this._scaleInside?1:-1),x=v+this._minorScaleLineLength*(this._scaleInside?1:-1),e=0;e<this._majorScaleCount;e++){if(r=this._center.x+Math.cos(y)*v,s=this._center.y+Math.sin(-y)*v,t=this._center.x+Math.cos(y)*w,u=this._center.y+Math.sin(-y)*w,a.lineWidth=this._majorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),a.beginPath(),a.moveTo(r,s),a.lineTo(t,u),a.closePath(),a.stroke(),this._scaleTextVisible)if(0==e&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible);else{var A=k.get(e);if(A){var B=this.getScaleTextPosition(y/Math.PI*180,r,s,A.size.width,A.size.height);A.x=B.x,A.y=B.y}}if(this._whole||!this._whole&&e<this._majorScaleCount-1){var C=y,D=this._minorScaleCount>0?z/(this._minorScaleCount+1):0;for(q=0;q<this._minorScaleCount;q++)C+=(this._clockwise?-1:1)*D,r=this._center.x+Math.cos(C)*v,s=this._center.y+Math.sin(-C)*v,t=this._center.x+Math.cos(C)*x,u=this._center.y+Math.sin(-C)*x,a.lineWidth=this._minorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),a.beginPath(),a.moveTo(r,s),a.lineTo(t,u),a.closePath(),a.stroke()}y+=(this._clockwise?-1:1)*z}this._pivotFill&&Xc.fill(a,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,2*this._pivotRadius,2*this._pivotRadius),a.lineWidth=this._pivotOutlineWidth,a.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),a.beginPath(),a.arc(this._center.x,this._center.y,this._pivotRadius,0,2*Math.PI,!0),a.closePath(),this._pivotFill&&a.fill(),k&&k.forEach(function(b){b&&Xc.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=this._getDataStyle("dialchart.rear.extension",b),e=this._getDataStyle("dialchart.base.width",b),f=this._getDataStyle("dialchart.top.width",b),g=this._getDataStyle("dialchart.radius",b);g>=-1&&1>=g&&(g*=this._innerRadiusByPixel),a.fillStyle=c.color,a.lineWidth=0;var h=Tc.createMatrix(-c.angle,this._center.x,this._center.y),i=h.transform(this._center.x+g,this._center.y+f/2),j=h.transform(this._center.x+g,this._center.y-f/2),k=h.transform(this._center.x-d,this._center.y-e/2),l=h.transform(this._center.x-d,this._center.y+e/2),m=this._selectShadowOffset;this.isSelected(b)&&m>0?(a.shadowOffsetX=m,a.shadowOffsetY=m,a.shadowBlur=2*m,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=c.color),a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(j.x,j.y),a.lineTo(k.x,k.y),a.lineTo(l.x,l.y),a.lineTo(i.x,i.y),a.closePath(),a.fill();var n=this._getValueTextInfo(b,c.value);if(n){var o=h.transform(this._center.x+g*this._valuePosition,this._center.y);n.x=o.x,n.y=o.y}},this),this.drawValueTexts(a)}},_getDataStyle:function(a,b){return b.getStyle?b.getStyle(a):b.getClient(a)},_calcluateCenterAndRadius:function(a){{var b=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,c=this._clockwise?this._positiveStartAngle:this._positiveEndAngle;Math.abs(this._positiveEndAngle-this._positiveStartAngle)}b>=0&&90>b?c>=0&&90>=c?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):c>90&&180>=c?(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height+this._outerRadius)/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):b>=90&&180>b?c>=90&&180>=c?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):c>180&&270>=c?(this._outerRadius=Math.min(a.width,a.height/2),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+a.height/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):b>=180&&270>b?c>=180&&270>=c?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height-this._outerRadius)/2}):(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height-this._outerRadius)/2}):(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(a,b,c,d,e){if(!(this._outlineWidth<=0)){var f=Math.abs(b-c),g=this._center.x+Math.cos(b)*this._innerRadiusByPixel,h=this._center.y+Math.sin(-b)*this._innerRadiusByPixel,i=this._center.x+Math.cos(b)*this._outerRadius,j=this._center.y+Math.sin(-b)*this._outerRadius,k=this._center.x+Math.cos(c)*this._innerRadiusByPixel,l=this._center.y+Math.sin(-c)*this._innerRadiusByPixel,m=this._center.x+Math.cos(c)*this._outerRadius,n=this._center.y+Math.sin(-c)*this._outerRadius;this._clockwise?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),Xc.drawArc(a,this._center.x,this._center.y,c,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(g,h),a.stroke(),a.beginPath(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.moveTo(this._center.x,this._center.y),Xc.drawArc(a,this._center.x,this._center.y,b,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(m,n),a.stroke()):(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),Xc.drawArc(a,this._center.x,this._center.y,b,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(k,l),a.stroke(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),Xc.drawArc(a,this._center.x,this._center.y,c,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(i,j),a.stroke())}},_drawArcGroup:function(a,b,c,d){0!=this._outerBrighterRadiusByPixel&&this._drawArc(a,b,c,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,Xc.brighter(d)),this._drawArc(a,b,c,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,d),0!=this._innerDarkerRadiusByPixel&&this._drawArc(a,b,c,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,Xc.darker(d,20))},_drawArc:function(a,b,c,d,e,f){var g=Math.abs(b-c);a.lineWidth=0,a.fillStyle=f;{var h=this._center.x+Math.cos(b)*d,i=this._center.y+Math.sin(-b)*d,j=(this._center.x+Math.cos(b)*e,this._center.y+Math.sin(-b)*e,this._center.x+Math.cos(c)*d),k=this._center.y+Math.sin(-c)*d;this._center.x+Math.cos(c)*e,this._center.y+Math.sin(-c)*e}a.beginPath(),this._clockwise?(a.moveTo(j,k),Xc.drawArc(a,this._center.x,this._center.y,c,g,e,e,!0),a.lineTo(h,i),Xc.drawArc(a,this._center.x,this._center.y,b,-g,d,d,!0),a.closePath()):(a.moveTo(h,i),Xc.drawArc(a,this._center.x,this._center.y,b,g,e,e,!0),a.lineTo(j,k),Xc.drawArc(a,this._center.x,this._center.y,c,-g,d,d,!0),a.closePath()),a.fill()},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return 0==a&&(f=this._scaleInside?{x:b-d/2,y:c}:{x:b+d/2,y:c}),180==a&&(f=this._scaleInside?{x:b+d/2,y:c}:{x:b-d/2,y:c}),90==a&&(f=this._scaleInside?{x:b,y:c+e/2}:{x:b,y:c-e/2}),270==a&&(f=this._scaleInside?{x:b,y:c-e/2}:{x:b,y:c+e/2}),a>270&&360>a&&(f=this._scaleInside?{x:b-d/2,y:c-e/2}:{x:b+d/2,y:c+e/2}),a>180&&270>a&&(f=this._scaleInside?{x:b+d/2,y:c-e/2}:{x:b-d/2,y:c+e/2}),a>90&&180>a&&(f=this._scaleInside?{x:b+d/2,y:c+e/2}:{x:b-d/2,y:c-e/2}),a>0&&90>a&&(f=this._scaleInside?{x:b-d/2,y:c+e/2}:{x:b+d/2,y:c-e/2}),f}}),Ic.charts.RadarChart=function(){Ic.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Jc.ext("twaver.charts.RadarChart",Ic.charts.ChartBase,{__accessor:["axisTextVisible","axisTextFont","axisTextColor","scaleTextVisible","scaleTextFont","scaleTextColor","axisVisible","axisLineColor","axisLineWidth","axisStartAngle","ringVisible","ringType","ringLineColor","ringLineWidth","scaleCount","scaleMaxValue","scaleMinValue","anchorVisible","areaFillAlpha","areaSelectFillAlpha","axisList"],__bool:["areaFill"],_axisTextVisible:Ce.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:Ce.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:Ce.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:Ce.RADARCHART_SCALE_TEXT_VISIBLE,_scaleTextFont:Ce.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:Ce.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:Ce.RADARCHART_AXIS_VISIBLE,_axisLineColor:Ce.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:Ce.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:Ce.RADARCHART_AXIS_START_ANGLE,_ringVisible:Ce.RADARCHART_RING_VISIBLE,_ringType:Ce.RADARCHART_RING_TYPE,_ringLineColor:Ce.RADARCHART_RING_LINE_COLOR,_ringLineWidth:Ce.RADARCHART_RING_LINE_WIDTH,_scaleCount:Ce.RADARCHART_SCALE_COUNT,_scaleMaxValue:Ce.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:Ce.RADARCHART_SCALE_MINVALUE,_anchorVisible:Ce.RADARCHART_ANCHOR_VISIBLE,_areaFill:Ce.RADARCHART_AREA_FILL,_areaFillAlpha:Ce.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:Ce.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(a){return a.toFixed(2)},getAnchorSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):Ic.Styles.getStyle("chart.marker.size")},getAnchorShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):Ic.Styles.getStyle("chart.marker.shape")},getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):Ic.Styles.getStyle("chart.line.width")},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},tryGetDataAt:function(a,b){if((null==b||0>b)&&(b=this._selectTolerance),a.target&&(a=Wc.getLogicalPoint(this._canvas,arguments[0],1)),!a)return null;if(!this._areaFill){var c=a.x-b,d=a.y-b,e=2*b+1,f=2*b+1;try{for(var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data,h=0,i=g.length;i>h;h+=4)if(255===g[h+3]){var j="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",k=this._uniqueColors[j];if(k)return k}}catch(l){}return null}if(!this._center)return null;a={x:a.x-this._xTranslate,y:a.y-this._yTranslate};for(var h=this._publishedDatas.size()-1;h>=0;h--){var k=this._publishedDatas.get(h),m=this._map[k.getId()],n=Tc.isPointInPolygon(m.points,a);if(n)return k}return null},getDataAt:function(){var a,b;if(2===arguments.length)a=arguments[0],b=arguments[1];else if(arguments[0].target){var c=Wc.getLogicalPoint(this._canvas,arguments[0],1);if(!c)return;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;if(0>a||0>b||a>this._canvasWidth||b>this._canvasHeight)return null;if(!this._areaFill){try{var d=this._canvas.getContext("2d").getImageData(a,b,1,1).data;if(255===d[3]){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null}for(var h=this._publishedDatas.size()-1;h>=0;h--){var f=this._publishedDatas.get(h),i=this._map[f.getId()],j=Tc.isPointInPolygon(i.points,{x:a-this._xTranslate,y:b-this._yTranslate});if(j)return f}return null},validateModel:function(){if(this._map={},this._axisTexts=new me,this._axisMaxValues=new me,this._axisMinValues=new me,this._axisRangeValues=new me,this._axisCount=null==this._axisList?0:this._axisList.size(),0!=this._axisCount){this._averageAngleByRadian=2*Math.PI/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(a){if("string"==typeof a)this._axisTexts.add(a),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue);else{this._axisTexts.add(a.text);var b=isNaN(a.max)?this._scaleMaxValue:a.max,c=isNaN(a.min)?this._scaleMinValue:a.min;this._axisMaxValues.add(b),this._axisMinValues.add(c),this._axisRangeValues.add(b-c)}},this),this._publishedDatas.forEach(function(a){var b=new me(this.getValues(a)),c={data:a,values:b,proportions:new me,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getAnchorShape(a),anchorSize:this.getAnchorSize(a),lineWidth:this.getLineWidth(a),points:new me};this.isSelected(a)&&(c.lineWidth+=2),this._map[a.getId()]=c},this);for(var a=0;a<this._axisCount;a++)this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=0;if(c.values.size()>a){var e=c.values.get(a),f=this._axisMinValues.get(a),g=this._axisRangeValues.get(a);g>0&&(d=(e-f)/g)}c.proportions.add(d)},this)}},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-2*this._xGap,height:c-2*this._yGap};if(this.drawBackground(a,d),!(d.width<=0||d.height<=0||this._axisCount<3)){var e=0,f=0,g=0,h=null,i=null,j=null,k=null;if(this._axisTextVisible)for(k=new me,g=0;g<this._axisCount;g++)j=this._axisTexts.get(g),h=this.getTextSize(this._axisTextFont,j),k.add({text:j,size:h}),h.width>e&&(e=h.width),h.height>f&&(f=h.height);var l=d.width/2-e>d.height/2-f?d.height/2-2*f:d.width/2-e,m={x:d.x+d.width/2,y:d.y+d.height/2};this._center={x:m.x+this._xTranslate,y:m.y+this._yTranslate};var n=null;this._scaleTextVisible&&(n=new me);var o=this._axisStartAngle/180*Math.PI;for(g=0;g<this._axisCount;g++){var p=180*o/Math.PI,q=m.x+Math.cos(o)*l,r=m.y+Math.sin(-o)*l,s=null;n&&(s=new me,n.add(s)),this._ringVisible&&this._ringLineWidth>0&&(a.lineWidth=this._ringLineWidth,a.strokeStyle=this._ringLineColor);for(var t=1;t<=this._scaleCount;t++){var u=t/this._scaleCount,v=l*u,w=m.x+Math.cos(o)*v,x=m.y+Math.sin(-o)*v;if(this._ringVisible&&this._ringLineWidth>0){var y=m.x+Math.cos(o+this._averageAngleByRadian)*v,z=m.y+Math.sin(-o-this._averageAngleByRadian)*v;"line"==this._ringType?this.drawLine(a,this._ringLineColor,this._ringLineWidth,w,x,y,z):"arc"==this._ringType&&(a.beginPath(),a.moveTo(m.x,m.y),Xc.drawArc(a,m.x,m.y,o,this._averageAngleByRadian,v,v,!0),a.closePath(),a.stroke())}s&&(j=this.formatScaleText(this._axisMinValues.get(g)+this._axisRangeValues.get(g)*u,g),h=this.getTextSize(this._scaleTextFont,j),i=this.getScaleTextPosition(p,w,x,h.width,h.height),s.add({text:j,x:i.x,y:i.y}))}if(this._axisVisible&&this.drawLine(a,this._axisLineColor,this._axisLineWidth,m.x,m.y,q,r),k){var A=k.get(g);i=this.getAxisTextPosition(p,q,r,A.size.width,A.size.height),A.x=i.x,A.y=i.y}o+=this._averageAngleByRadian}this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.points.clear();var d=c.anchorSize>0?new me:null,e=c.proportions;if(a.lineWidth=0,a.globalAlpha=this.isSelected(b)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(a.fillStyle=c.color),this._drawItem(a,e,m,l,d,c),this._areaFill&&a.fill(),a.lineWidth=c.lineWidth,a.strokeStyle=c.color,a.globalAlpha=1,this._drawItem(a,e,m,l),a.lineWidth=0,null!=d&&d.size()>0){var f=c.anchorSize/2;d.forEach(function(b){a.fillStyle=c.color,Xc.drawVector(a,c.anchorShape,null,b.x-f,b.y-f,c.anchorSize,c.anchorSize),a.fill()})}},this),n&&n.forEach(function(b){b.forEach(function(b){Xc.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this)},this),k&&k.forEach(function(b){Xc.drawText(a,b.text,b,this._axisTextFont,this._axisTextColor)},this)}},_drawItem:function(a,b,c,d,e,f){var g=this._axisStartAngle/180*Math.PI,h=null;a.beginPath();for(var i=0;i<this._axisCount;i++){var j=b.get(i),k={x:c.x+Math.cos(g)*d*j,y:c.y+Math.sin(-g)*d*j};null==h?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),null!=e&&this._anchorVisible&&e.add(k),f&&f.points.add(k),0==i&&(h=k),g+=this._averageAngleByRadian}null!=h&&a.lineTo(h.x,h.y),a.closePath(),a.stroke()},getAxisTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return 0==a&&(f={x:b+d/2,y:c}),180==a&&(f={x:b-d/2,y:c}),90==a&&(f={x:b,y:c-e/2}),270==a&&(f={x:b,y:c+e/2}),a>270&&360>a&&(f={x:b+d/2,y:c+e/2}),a>180&&270>a&&(f={x:b-d/2,y:c+e/2}),a>90&&180>a&&(f={x:b-d/2,y:c-e/2}),a>0&&90>a&&(f={x:b+d/2,y:c-e/2}),f},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return 0==a&&(f={x:b,y:c+e/2}),180==a&&(f={x:b-d/2,y:c+e/2}),90==a&&(f={x:b+d/2,y:c}),270==a&&(f={x:b+d/2,y:c}),a>270&&360>a&&(f={x:b+d/2,y:c-e/2}),a>180&&270>a&&(f={x:b-d/2,y:c-e/2}),a>90&&180>a&&(f={x:b-d/2,y:c+e/2}),a>0&&90>a&&(f={x:b+d/2,y:c+e/2}),f}}),Ic.charts.LegendPane=function(a){Ic.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new Ic.Pool("div"),this._iconPool=new Ic.Pool("div"),this._textPool=new Ic.Pool("span"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=a,this._chart.addViewListener(this.handleViewChange,this),this._view=Wc.createView("hidden"),this._view.style.verticalAlign="middle",this._legendDiv=Wc.createDiv(),this._legendDiv.style.whiteSpace="nowrap",this._legendDiv.style.verticalAlign="middle",this._legendDiv.style.position="",this._view.appendChild(this._legendDiv),this._hiddenMap={};var b=this;this._chart._internalVisibleFunction=function(a){return!b.isHidden(a)};var c;c=Qc.isTouchable&&!Qc.isMSToucheable?Ic.charts.LegendPaneTouchInteraction:Ic.charts.LegendPaneInteraction,c&&new c(this)},Jc.ext("twaver.charts.LegendPane",Ic.controls.ControlBase,{__accessor:["iconWidth","iconHeight","iconRadius","rowHeight","orientation","hiddenColor","selectBackgroundColor","selectForegroundColor"],_iconWidth:Ce.LEGENDPANE_ICON_WIDTH,_iconHeight:Ce.LEGENDPANE_ICON_HEIGHT,_iconRadius:Ce.LEGENDPANE_ICON_RADIUS,_rowHeight:Ce.LEGENDPANE_ROW_HEIGHT,_orientation:Ce.LEGENDPANE_ORIENTATION,_hiddenColor:Ce.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:Ce.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:Ce.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(){this.invalidate()},getChart:function(){return this._chart},isHidden:function(a){return null!=this._hiddenMap[a.getId()]},handleViewChange:function(a){"validateEnd"===a.kind&&(this._invalidate=!0,this.validate())},validate:function(){if(this._invalidate){this._invalidate=!1,Wc.release(this._legendDiv),Jc.keys(this._hiddenMap).forEach(function(a){this._chart.getDataBox().containsById(a)||delete this._hiddenMap[a]},this);for(var a=new me(this._chart.getUnfilteredDatas()),b=0;b<a.size();b++){var c=a.get(b);this._chart.isVisible(c)||this.isHidden(c)||(a.removeAt(b),b--)}var d=a.size(),e=this._view.style,f="horizontal"===this._orientation;for(f?(e.textAlign="center",e.height=this._rowHeight+"px"):(e.textAlign="",e.height=this._rowHeight*d+"px"),e.lineHeight=this._rowHeight-2+"px",b=0;d>b;b++){var c=a.get(b),g=this._divPool.get();g._data=c,g.style.cursor="pointer",g.style.height=this._rowHeight+"px",g.style.display=f?"inline-block":"block",this._legendDiv.appendChild(g),this.renderLegend(g,c),this.onLegendRendered(g,c)}this._pools.forEach(function(a){a.clear()})}},renderLegend:function(a,b){var c=!this.isHidden(b),d=this._chart.isSelected(b),e=this._iconPool.get(),f=e.style;f.display="inline-block",f.verticalAlign="middle",f.marginLeft="4px",f.width=this.getIconWidth()+"px",f.height=this.getIconHeight()+"px",f.backgroundColor=c?this._chart.getColor(b):this.getHiddenColor(),a.appendChild(e);var g=this._textPool.get();f=g.style,f.paddingLeft="2px",f.paddingRight="4px",f.display="inline-block",f.verticalAlign="middle",f.color=c?d?this._selectForegroundColor:"":this.getHiddenColor(),g.innerHTML=this._chart.getName(b),a.appendChild(g),a.style.backgroundColor=c&&d?this._selectBackgroundColor:""},onLegendRendered:function(){}}),Ic.charts.ChartPane=function(a,b,c,d){Ic.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=a,this._legendPane=new Ic.charts.LegendPane(a),this._titleDiv=Wc.createDiv(),this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.whiteSpace="nowrap",this._view=Wc.createView("hidden"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var e=this;this._legendPane.addPropertyChangeListener(function(a){("rowHeight"===a.property||"orientation"===a.porperty)&&e.invalidate()}),arguments.length>1&&this.setTitle(b),arguments.length>2&&this.setLegendOrientation(c),arguments.length>3&&this.setLegendWidth(d)},Jc.ext("twaver.charts.ChartPane",Ic.controls.ControlBase,{__accessor:["title","titleHorizontalAlign","titleHeight","legendWidth"],_title:null,_titleHeight:Ce.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:Ce.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:Ce.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:Ce.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(a){if(this._legendOrientation!==a){var b=this._legendOrientation;this._legendOrientation=a,this.firePropertyChange("orientation",b,a),this._adjustLegendOrientation()}},_adjustLegendOrientation:function(){this._legendPane.setOrientation("left"===this._legendOrientation||"right"===this._legendOrientation?"vertical":"horizontal")},onPropertyChanged:function(){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var a,b=this._view.offsetWidth,c=this._view.offsetHeight,d=this._legendPane.getRowHeight();this._title&&""!==this._title?(a=this._titleHeight,this._titleDiv.innerHTML=this._title):(a=0,this._titleDiv.innerHTML=""),this._titleDiv.innerHTML=this._title?this._title:"",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+"px";var e=this._titleDiv.style;e.left="0px",e.top="0px",e.width=b+"px",e.height=a+"px";var f,g;"bottom"===this._legendOrientation?(f={x:0,y:a,width:b,height:Math.max(c-a-d,0)},g={x:0,y:Math.max(c-d,0),width:b,height:d}):"right"===this._legendOrientation?(f={x:0,y:a,width:Math.max(b-this._legendWidth,0),height:Math.max(c-a,0)},g={x:Math.max(b-this._legendWidth,0),y:a,width:this._legendWidth,height:Math.max(c-a,0)}):"top"===this._legendOrientation?(f={x:0,y:a+d,width:b,height:Math.max(c-a-d,0)},g={x:0,y:a,width:b,height:d}):"left"===this._legendOrientation&&(f={x:this._legendWidth,y:a,width:Math.max(b-this._legendWidth,0),height:Math.max(c-a,0)},g={x:0,y:a,width:this._legendWidth,height:Math.max(c-a,0)}),f&&this._chart.adjustBounds(f),g&&this._legendPane.adjustBounds(g)}}),Ic.charts.ChartInteraction=function(a){this.chart=a,this.canvas=a._canvas;var b=this;this.canvas.addEventListener("mousedown",function(a){0===a.button&&b.handleMouseDown(a),a.preventDefault()},!1);var c=Qc.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(c,function(a){b.handleMouseWheel(a)},!1)},Jc.ext("twaver.charts.ChartInteraction",Object,{handleMouseDown:function(a){this.chart.isFocusOnClick()&&Ic.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(a);var b=this.chart.tryGetDataAt(a);2===a.detail&&null==b?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=Wc.getClientPoint(a),Wc.handle_mousedown(this,a))},handleMouseMove:function(a){if(this.lastPoint){var b={x:this._startLogical.x+a.clientX-this._startClient.x,y:this._startLogical.y+a.clientY-this._startClient.y};!this.startPan&&Tc.getDistance(this.lastPoint,b)>3&&(this.startPan=!0,this.lastPoint=b),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.lastPoint.y),this.lastPoint=b)}},handleMouseUp:function(a){if(!this.startPan&&1===a.detail){var b=this.chart.tryGetDataAt(a),c=this.chart.getSelectionModel();b?Jc.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):Jc.isCtrlDown(a)||c.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(a){Wc.preventDefault(a);var b=Qc.isFirefox?-a.detail:a.wheelDelta;b>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>b&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),Ic.charts.ChartTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,Wc.addEventListener("touchstart","handleTouchstart",this.canvas,this)},Jc.ext("twaver.charts.ChartTouchInteraction",Object,{handleTouchstart:function(a){Wc.preventDefault(a),this.chart.isFocusOnClick()&&Ic.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(a),zd.isMultiTouch(a)&&(this.distance=zd.getDistance(a),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),Wc.addEventListener("touchmove","handleTouchmove",this.canvas,this),Wc.addEventListener("touchend","handleTouchend",this.canvas,this)},handleTouchmove:function(a){if(Wc.preventDefault(a),this.endPoint){var b=this.chart.getLogicalPoint(a);if(!this.moved&&Tc.getDistance(this.endPoint,b)>10&&(this.moved=!0,this.lastPoint=b),this.moved)if(zd.isSingleTouch(a))this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.endPoint.y),this.endPoint=b);else if(this.distance){var c=zd.getDistance(a)/this.distance,d=this.xZoom*c,e=this.yZoom*c;this.chart.isXZoomEnabled()&&this.chart.setXZoom(d,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(e,!1)}}},handleTouchend:function(a){if(Wc.preventDefault(a),!this.moved){this.endPoint=this.chart.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var c=this.chart.tryGetDataAt(a);if(b&&null==c)this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0));else{var d=this.chart.getSelectionModel();c?d.contains(c)||d.setSelection(c):d.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,Wc.removeEventListener("touchmove",this.canvas,this),Wc.removeEventListener("touchend",this.canvas,this)}}),Ic.charts.ChartMSTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,this._pointerMap={},this._pointerIdArray=[];var b=this;this.canvas.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.canvas.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.canvas.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.canvas.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1);var c=Qc.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(c,function(a){b.handleMouseWheel(a)},!1)},Jc.ext("twaver.charts.ChartMSTouchInteraction",Object,{handleTouchstart:function(a){this.chart.isFocusOnClick()&&Ic.Util.setFocus(this.canvas);var b=this.chart.getLogicalPoint(a);a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&b&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a);var c=this.chart.tryGetDataAt(a);if(1==this._pointerIdArray.length&&b){var d=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,b)<=10;d&&null==c?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0),this._startTouchPoint=null,this._startTouchTime=null,this._startClientPoint=null):(this._startTouchPoint=b,this._startTouchTime=new Date,this._startClientPoint={x:a.clientX,y:a.clientY},Wc.handle_mousedown(this,a))}else 2==this._pointerIdArray.length&&(this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom(),this._distance=this._getDistance())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Tc.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=3)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance,c=this.xZoom*b,d=this.yZoom*b;this.chart.isXZoomEnabled()&&this.chart.setXZoom(c,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(d,!1)}},handleTouchend:function(a){var b=this.chart.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b&&!this.moved){var c=this.chart.tryGetDataAt(a),d=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,b)<=10,e=this.chart.getSelectionModel();
c&&d?Jc.isCtrlDown(a)?e.contains(c)?e.removeSelection(c):e.appendSelection(c):e.contains(c)||e.setSelection(c):Jc.isCtrlDown(a)||e.clearSelection()}this.moved=!1,this._pointerMap={},this._pointerIdArray=[]},handleMouseWheel:function(a){Wc.preventDefault(a);var b=Qc.isFirefox?-a.detail:a.wheelDelta;b>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>b&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))},handle_mousemove:function(a){if(1==this._pointerIdArray.length&&this._startTouchPoint&&this._startClientPoint){var b={x:this._startTouchPoint.x+(a.clientX-this._startClientPoint.x)/this.chart.getXZoom(),y:this._startTouchPoint.y+(a.clientY-this._startClientPoint.y)/this.chart.getYZoom()};Tc.getDistance(this._startTouchPoint,b)>3&&(this.moved=!0,this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this._startTouchPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this._startTouchPoint.y),this._startClientPoint.x=a.clientX,this._startClientPoint.y=a.clientY)}},handle_mouseup:function(a){this.handleTouchend(a)},_getDistance:function(){return Tc.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Ic.charts.LegendPaneInteraction=function(a){this.legendPane=a;var b=this;this.legendPane._legendDiv.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1)},Jc.ext("twaver.charts.LegendPaneInteraction",Object,{handleMouseDown:function(a){if(0===a.button){var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}}),Ic.charts.LegendPaneTouchInteraction=function(a){this.legendPane=a,Wc.addEventListener("touchstart","handleTouchstart",this.legendPane._legendDiv,this)},Jc.ext("twaver.charts.LegendPaneTouchInteraction",Object,{handleTouchstart:function(a){Wc.preventDefault(a);var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}),Ic.network.Network=function(a){Ic.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new me,this._view=Wc.createView("auto"),this._rootDiv=Wc.createDiv(),this._topDiv=Wc.createDiv(),this._attachmentDiv=Wc.createDiv(),this._layersDiv=Wc.createDiv(),this._bottomDiv=Wc.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(a?a:new Ic.ElementBox),Qc.isMSToucheable?this.setMSTouchInteractions():Qc.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1);var b=this;this._flowLink=function(){if(!(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)){b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new Ic.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a);var c=b.getElementUI(a);c.drawBody()})}},this.setToolTipEnabled(Ce.NETWORK_TOOLTIP_ENABLED),this._view.addEventListener("scroll",function(){od.twm(b)}),this.addPropertyChangeListener(function(a){"zoom"===a.property&&od.twm(b)})},Jc.ext("twaver.network.Network",Ic.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:Ce.NETWORK_SELECT_MODE,_noAgentLinkVisible:Ce.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:Ce.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Ce.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Ce.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Ce.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:Ce.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:Ce.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:Ce.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:Ce.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:Ce.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Ce.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Ce.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Ce.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Ce.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:Ce.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:Ce.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Ce.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Ce.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:Ce.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Ce.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Ce.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Ce.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Ce.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:Ce.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Ce.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Ce.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Ce.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Ce.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Ce.NETWORK_EDIT_LINE_WIDTH,_resizePointSize:Ce.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Ce.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Ce.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Ce.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Ce.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Ce.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Ce.NETWORK_RESIZE_ANIMATE,_rotatePointSize:Ce.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Ce.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Ce.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Ce.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Ce.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Ce.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Ce.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Ce.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Ce.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Ce.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Ce.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Ce.NETWORK_SELECTION_TOLERANCE,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:Ic.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,getLabel:function(a){return a.getStyle("network.label")||a.getName()},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){if(this._toolTipEnabled=a,a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){var c=b.getElementAt(a);if(b._preElement!==c)if(b._preElement=c,c){var d=b.getToolTip(c);Bd.showToolTip({x:a.pageX,y:a.pageY},d);var e=Bd.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(Oc.documentElement.scrollLeft||Oc.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(Oc.documentElement.scrollTop||Oc.body.scrollTop)+"px")}}else Bd.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Bd.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){if(od.twm(this),this.__lics__){var a=0,b=null,c=null,d=null,e=this._invalidateElementVisibility;if(this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(e){e.validate();var f=e.getElement();if(e.setVisible(this.isVisible(f)),this._removeElementUIOnInvisible){if(b=this.getLayerDivByElement(f),e.isVisible()){if(e.getView().parentNode!==b)for(b.appendChild(e.getView()),c=e.getAttachments(),a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())}else if(e.getView().parentNode===b)for(b.removeChild(e.getView()),c=e.getAttachments(),a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(d.getView())}else if(!e.getView().parentNode)for(b=this.getLayerDivByElement(f),b.appendChild(e.getView()),c=e.getAttachments(),a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())},null,this)),this._invalidateElementIndex){this._invalidateElementIndex=!1;var f,g=this;this._box.getLayerBox().forEachByDepthFirst(function(a){var b,c=g._layerMap[a.getId()];g._box.forEachByLayer(function(a){var d=g._elementUIMap[a.getId()];if(d&&d.getView().parentNode===c){b=Wc.insertAfter(d.getView(),b);for(var e=d.getAttachments(),h=0;h<e.size();h++){var i=e.get(h);i.getView().parentNode===g._attachmentDiv&&(f=Wc.insertAfter(i.getView(),f))}}},a)})}if(e&&!this._invalidateElementVisibility){var h;for(var i in this._elementUIMap){var j=this._elementUIMap[i];j.isVisible()&&(h=Tc.unionRect(h,j.getViewRect()))}if(h=h?{x:0,y:0,width:h.x+h.width,height:h.y+h.height}:{x:0,y:0,width:0,height:0},h.x!==this._viewRect.x||h.y!==this._viewRect.y||h.width!==this._viewRect.width||h.height!==this._viewRect.height){var k=this._viewRect;this._viewRect=h,this._rootDiv.style.left="0px",this._rootDiv.style.top="0px",this._rootDiv.style.width=h.width+"px",this._rootDiv.style.height=h.height+"px",this.firePropertyChange("viewRect",k,h)}}}},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(vd.getSubNetwork(this._currentSubNetwork),a,b)},sendToTop:function(a){if(this.isVisible(a)){for(var b=a;this.isVisible(b.getParent())&&(b=b.getParent()););b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)}},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){Wc.clear(this._layersDiv),Wc.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var a=this;this._box.getLayerBox().forEachByDepthFirst(function(b){var c=Wc.createDiv();Wc.setVisible(c,b.isVisible()),a._layerMap[b.getId()]=c,a._layersDiv.appendChild(c),a._layerList.add(b)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,c){var d=Ic.animate.AnimateManager;if(d.endAnimate(),b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";d.start(new Ic.animate.AnimateSubNetwork(this,a,c))}else this._setCurrentSubNetwork(a),c&&c()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork!==a){if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility()}},isVisible:function(a){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(this._visibleFunction&&!this._visibleFunction(a))return!1;if(!this._box.getLayerBox().getLayerByElement(a).isVisible())return!1;if(vd.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof Ic.Link){if(!this.isNoAgentLinkVisible()){if(!a.getFromAgent()||!a.getToAgent())return!1;if(!this.isVisible(a.getFromAgent())||!this.isVisible(a.getToAgent()))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else for(var b=a.getParent();b&&!b.ISubNetwork;){if(b instanceof Ke&&(!b.isExpanded()||!this.isVisible(b)))return!1;b=b.getParent()}return a.IDummy?!1:!0},isMovable:function(a){return this._box.contains(a)?a instanceof Ic.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isMovable():!1},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isEditable():!1},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a){return null==this._linkableFunction||this._linkableFunction(a)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Ic.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange("elementBox",b,this._box)}},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},getElementUI:function(a){return a?this._elementUIMap[a.getId()]:null},getLayerDivByElement:function(a){var b=this._box.getLayerBox().getLayerByElement(a);return b?this._layerMap[b.getId()]:null},createElementUI:function(a){var b=this._elementUIMap[a.getId()];if(b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b)),b){var c=this.getLayerDivByElement(a);b.getView().parentNode!==c&&(c.appendChild(b.getView()),b.getAttachments().forEach(function(a){a.isShowInAttachmentDiv()&&a.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(a.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(a){if(a instanceof Ic.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},handleLayerBoxChange:function(){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){var b=a.source;if("visible"===a.property){var c=this._layerMap[b.getId()];Wc.setVisible(c,b.isVisible())}else"editable"===a.property&&this.invalidateSelectedElementUIs(!0);this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){var a;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(b){var c=this._layerMap[b.getId()];a=Wc.insertAfter(c,a),this._layerList.add(b)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this),this.invalidateElementVisibility();var b=this.getSelectionModel().getLastData();b&&("append"===a.kind||"set"===a.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b))},makeVisible:function(a){var b=this.getElementUI(a);if(b){var c=vd.getSubNetwork(a);if(c!==this._currentSubNetwork){var d=this;return void this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){Jc.callLater(d.makeVisible,d,[a])})}for(var e=a;(e=e.getParent())&&e!==c;)e instanceof Ke&&e.setExpanded(!0);var f=b.getUnionBodyBounds();if(f){var g={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};Tc.intersects(g,f)||this.isVisible(a)&&Jc.callLater(this.centerByLogicalPoint,this,[f.x+f.width/2,f.y+f.height/2])}}},handleElementBoxChange:function(a){var b=a.data;if("add"===a.kind)this.createElementUI(b),this.invalidateBundleLink(b);else if("remove"===a.kind){var c=this.getElementUI(b);if(c){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode===e&&e.removeChild(c.getView()),c.dispose(),delete this._elementUIMap[b.getId()]}b===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else"clear"===a.kind&&(this.forEachElementUI(function(a){a.dispose()}),this._elementUIMap={},this.updateLayers(),null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);if(c&&(c.handlePropertyChange(a),"layerId"===a.property)){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode!==e&&(e.appendChild(c.getView()),this.invalidateElementIndex())}this.invalidateBundleLink(b),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==a){var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||this.updateLayers()}},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},getSelectColor:function(a){return a.getStyle("select.color")},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&"shadow"===a.getStyle("select.style")?a.getStyle("select.color"):b},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(a){var b=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=a,this.firePropertyChange("removeElementUIOnInvisible",b,a),this.invalidateElementVisibility()},setDefaultInteractions:function(a,b){var c=[new Ic.network.interaction.SelectInteraction(this),new Ic.network.interaction.MoveInteraction(this,a),new Ic.network.interaction.DefaultInteraction(this)];b&&c.push(new Ic.network.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setPanInteractions:function(){this.setInteractions([new Ic.network.interaction.PanInteraction(this),new Ic.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(a,b){var c=[new Ic.network.interaction.SelectInteraction(this),new Ic.network.interaction.EditInteraction(this,a),new Ic.network.interaction.MoveInteraction(this,a),new Ic.network.interaction.DefaultInteraction(this)];b&&c.push(new Ic.network.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setCreateElementInteractions:function(a){this.setInteractions([new Ic.network.interaction.CreateElementInteraction(this,a),new Ic.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new Ic.network.interaction.CreateLinkInteraction(this,a),new Ic.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new Ic.network.interaction.CreateShapeLinkInteraction(this,a),new Ic.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new Ic.network.interaction.CreateShapeNodeInteraction(this,a),new Ic.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new Ic.network.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new Ic.network.interaction.MSTouchInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Ic.network.interaction.SelectInteraction(this),new Ic.network.interaction.MoveInteraction(this),new Ic.network.interaction.DefaultInteraction(this),new Ic.network.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},moveSelectedElements:function(a,b,c,d){if(0!==a||0!==b){var e=this.getMovableSelectedElementsRect();null!=e&&(this._limitElementInPositiveLocation&&(e.x+a<0&&(a=-e.x),e.y+b<0&&(b=-e.y)),Ic.Util.moveElements(this.getMovableSelectedElements(),a,b,c,d,this))}},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},hasMovableSelectedElements:function(){for(var a=this.getSelectionModel().getSelection(),b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(0===a.size())return null;for(var b=null,c=0,d=a.size();d>c;c++){var e=a.get(c);if(e instanceof Je){var f=this.getElementUI(e);f&&(b=Tc.unionRect(b,f.getViewRect()))}}return b},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getPosition:function(a,b,c,d,e){var f,g=b instanceof Ic.network.ElementUI?b:this.getElementUI(b);if(g)if("from"===a||"to"===a){if(g.getFromPosition&&(f="from"===a?g.getFromPosition(d,e):g.getToPosition(d,e)))return{x:f.x-c.width/2,y:f.y-c.height/2}}else f="hotspot"===a?g.getHotSpot():Vc.get(a,g.getBodyRect(),c);if(!f&&b.getRect&&(f=Vc.get(a,b.getRect(),c)),f)return{x:f.x+d,y:f.y+e};throw"position '"+a+"' object '"+b+"'"},getViewRect:function(){return this._viewRect?Jc.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(a,b,c){b?this._box.forEachReverse(function(d){if(this.getLayerByElement(d)===b){var e=this.getElementUI(d);e&&(c?a.call(c,e):a(e))}},this):this._layerList.forEachReverse(function(b){this.forEachElementUI(a,b,c)},this)},findFirstElement:function(a,b){for(var c=this._layerList.size()-1,d=this._box.size()-1,e=c;e>=0;e--)for(var f=this._layerList.get(e),g=d;g>=0;g--){var h=this._box.getDataAt(g);if(this.getLayerByElement(h)===f)if(b){if(a.call(b,h)===!0)return h}else if(a(h)===!0)return h}return null},getElementAt:function(a,b){if(1===arguments.length&&(b=!0),!this.isValidEvent(a))return null;a=this._getPoint(a),a||console.log("null");var c=a.x,d=a.y,e=this._selectionTolerance;if(e&&e>0){var f={x:c,y:d,width:0,height:0};Tc.grow(f,e,e)}return this.findFirstElement(function(a){if(b&&!this.isSelectable(a))return!1;var e=this.getElementUI(a);return e?f?!!e.intersectsTest(f):!!e.hitTest(c,d):!1},this)},_getPoint:function(a){return a?a.target?this.getLogicalPoint(a):a:null},getElementsAtRect:function(a,c,d,e){var f=new me;return e=e===b?!0:e,this.forEachElementUI(function(b){b.isVisible()&&(!d||d(b._element))&&(e&&this.isSelectable(b._element)||!e)&&(c?b.intersectsTest(a)&&f.add(b._element):Tc.contains(a,b.getViewRect())&&f.add(b._element))},null,this),f},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);return c?(a=this._getPoint(a),c.hitTest(a.x,a.y)):null},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Ce.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c){c||(c=Wc.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var d=c.getContext("2d");if(d.clearRect(0,0,a,b),0===this._view.clientWidth||0===this._view.clientHeight)return c;var e=a/this._view.scrollWidth*this._zoom,f=b/this._view.scrollHeight*this._zoom;return d.scale(e,f),Wc.forEach(this._view,function(a){if(("CANVAS"===a.tagName||"IMG"===a.tagName)&&!a._isIgnored){var b=a._viewRect;if(b)try{d.drawImage(a,b.x,b.y,b.width,b.height)}catch(a){}}}),c},toCanvasByRegion:function(a,b,c){c||(c=Wc.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e);var f=c.getContext("2d");return f.clearRect(0,0,d,e),0===this._view.clientWidth||0===this._view.clientHeight?c:(f.save(),f.scale(b,b),Wc.forEach(this._view,function(b){if(("CANVAS"===b.tagName||"IMG"===b.tagName)&&!b._isIgnored){var c=b._viewRect;if(c&&Tc.intersects(c,a))try{f.drawImage(b,c.x-a.x,c.y-a.y,c.width,c.height)}catch(b){}}}),f.restore(),c)},getGroupChildrenRects:function(a){var b=new me;return a.getChildren().forEach(function(a){if(a instanceof Je){var c=this.getElementUI(a);if(c){var d=c.getViewRect();d&&b.add(d)}}},this),b},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},onClickElement:function(){},onClickBackground:function(){},onDoubleClickElement:function(){},onDoubleClickBackground:function(){},onLongClickElement:function(){},onLongClickBackground:function(){},onMouseMove:function(){},onMouseEnter:function(){},onMouseLeave:function(){}}),Ic.network.Overview=function(a){Ic.network.Overview.superClass.constructor.apply(this,arguments),this._view=Wc.createView(),this._rootDiv=Wc.createDiv(),this._imageCanvas=Wc.createCanvas(),this._imageDiv=Wc.createDiv(),this._maskCanvas=Wc.createCanvas(),this._selectDiv=Wc.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,Wc.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(a);var b;b=Qc.isMSToucheable?Ic.network.OverviewMSTouchInteraction:Qc.isTouchable?Ic.network.OverviewTouchInteraction:Ic.network.OverviewInteraction,b&&new b(this)},Jc.ext("twaver.network.Overview",Ic.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Ce.OVERVIEW_FILL_COLOR,_outlineColor:Ce.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Ce.OVERVIEW_OUTLINE_WIDTH,_selectColor:Ce.OVERVIEW_SELECT_COLOR,_selectWidth:Ce.OVERVIEW_SELECT_WIDTH,_padding:Ce.OVERVIEW_PADDING,_animate:Ce.OVERVIEW_ANIMATE,_maxPackingWidth:Ce.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Ce.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(){this._invalidateMask()},setNetwork:function(a){a!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),Wc.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),Wc.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())
},_handleNetworkPropertyChange:function(a){("zoom"===a.property||"currentSubNetwork"===a.property||"elementBox"===a.property||"dataBox"===a.property)&&this.invalidate()},_handleNetworkViewChange:function(a){"validateEnd"===a.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Jc.callLater(this.validate,this,null,a))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Jc.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network._view.clientWidth&&0!==this._network._view.clientHeight){var a,b=this._maxPackingWidth>0&&this._maxPackingHeight>0;a=b?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Tc.grow(a,-this._padding,-this._padding);var c=Math.min(a.width/this._network._view.scrollWidth,a.height/this._network._view.scrollHeight);b&&(Wc.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),a.width=this._imageDiv._viewRect.width,a.height=this._imageDiv._viewRect.height);var d=this._network._view.scrollWidth*c,e=this._network._view.scrollHeight*c,f=a.x+(a.width-d)/2,g=a.y+(a.height-e)/2;if(this._isNetworkDirty){var h={x:f,y:g,width:d,height:e};this._network.toCanvas(h.width,h.height,this._imageCanvas),Wc.setDiv(this._imageDiv,h,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var i={x:this._network._view.scrollLeft*c,y:this._network._view.scrollTop*c,width:d*this._network._view.clientWidth/this._network._view.scrollWidth,height:e*this._network._view.clientHeight/this._network._view.scrollHeight},j=Wc.setCanvas(this._maskCanvas,f,g,d,e);j.lineWidth=0,j.fillStyle=this._fillColor,j.beginPath(),Xc.drawVector(j,"rectangle",null,f,g,d,e),j.fill(),j.clearRect(f+i.x,g+i.y,i.width,i.height);var k=this._outlineWidth<0?0:this._outlineWidth;j.lineWidth=k,j.strokeStyle=this._outlineColor,j.beginPath(),Xc.drawVector(j,"rectangle",null,f+i.x+k,g+i.y+k,i.width-2*k,i.height-2*k),k>=0&&j.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return Wc.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;Tc.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network._view.scrollWidth/this._network.getZoom(),(a.y-c.y)/c.height*this._network._view.scrollHeight/this._network.getZoom(),b),this._invalidateMask())}}),Ic.network.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Wc.addEventListener("touchstart","handleTouchstart",this.view,this)},Jc.ext("twaver.network.OverviewTouchInteraction",Object,{handleTouchstart:function(a){Wc.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),zd.isMultiTouch(a)&&(this.distance=zd.getDistance(a),this.zoom=this.network.getZoom()),Wc.addEventListener("touchmove","handleTouchmove",this.view,this),Wc.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(Wc.preventDefault(a),this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a),zd.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=zd.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?Jc.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,Wc.removeEventListener("touchmove",this.view,this),Wc.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Ic.network.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Wc.addEventListener("mousedown","handleMousedown",this.view,this)},Jc.ext("twaver.network.OverviewInteraction",Object,{handleMousedown:function(a){0===a.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Jc.isCtrlDown(a)&&(this.startPoint=this.endPoint,Wc.setVisible(this.overview._selectDiv,!0)),Wc.addEventListener("mousemove","handleMousemove",this.view,this),Wc.addEventListener("mouseup","handleMouseup",this.view,this))},handleMouseup:function(a){if(this.endPoint=this.overview.getLogicalPoint(a),"detail"in a&&2===a.detail)Jc.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(Wc.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,d=this.overview._selectDiv._viewRect.y,e=b.width/this.overview._selectDiv._viewRect.width,f=b.height/this.overview._selectDiv._viewRect.height,g=Math.min(e,f),h=this.network._view.scrollWidth/this.network.getZoom()*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),i=this.network._view.scrollHeight/this.network.getZoom()*((d-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);this.network.setZoom(g*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),Jc.callLater(this.network.centerByLogicalPoint,this.network,[h,i,this.overview._animate]),Wc.setVisible(this.overview._selectDiv,!1),Wc.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);if(this.endPoint=b,Wc.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),Wc.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,Wc.removeEventListener("mousemove",this.view,this),Wc.removeEventListener("mouseup",this.view,this))}}),Ic.network.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[];var b=this;this.view.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.view.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.view.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.view.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1)},Jc.ext("twaver.network.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){Wc.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Tc.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(null==c)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Tc.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?Jc.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Tc.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Ic.network.ElementUI=function(a,b){this._view=Wc.createDiv(),this._bodyView=Wc.createDiv(),this._view.appendChild(this._bodyView),this._network=a,this._element=b,this._attachments=new me,this._bodyBounds=new me,this.invalidate(!0)},Jc.ext("twaver.network.ElementUI",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:Ce.FONT},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?Jc.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},getUnionBodyBounds:function(){return Jc.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Jc.clone(this._bodyRect)},invalidate:function(a){a===b&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateMeasure:function(){},validate:function(){if(this._invalidateFlag){this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),Wc.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this.updateMeasure();var a=this._element.getStyle("whole.alpha");this._view.style.opacity=a,this._attachments.forEach(function(b){b.updateMeasure();var c=b.getAlpha();b._view.style.opacity=b.isShowInAttachmentDiv()?c*a:c});var b;this._bodyBounds.forEach(function(a){b=Tc.unionRect(b,a)}),this._unionBodyBounds=Jc.clone(b),this._attachments.forEach(function(a){b=Tc.unionRect(b,a.getViewRect())}),this._viewRect=b}},cleanUp:function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c],e=this[d];e&&!e.parentNode&&(this[d]=null)}},setVisible:function(a){this.isVisible()!==a&&(Wc.setVisible(this._view,a),this._attachments.forEach(function(b){b.isShowInAttachmentDiv()&&Wc.setVisible(b._view,a)}),this.invalidate(!0))},isVisible:function(){return Wc.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);null!=a&&""!==a?this._labelAttachment||(this._labelAttachment=new Ic.network.LabelAttachment(this,Ce.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);null!=a&&""!==a?this._alarmAttachment||(this._alarmAttachment=new Ic.network.AlarmAttachment(this,Ce.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new Ic.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new Ic.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return!0},handlePropertyChange:function(){this.invalidate(!0)},handleSelectionChange:function(){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(a){a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose()}),this._attachments.clear()},addAttachment:function(a){this._attachments.add(a),a.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(a.getView()):this._view.appendChild(a.getView()),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose(),this.invalidate(!1)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},addComponent:function(a){this._bodyView.appendChild(a)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return Jc.clone(this._viewRect)},setShadow:function(a,b,c){var d=a.isShadowable()&&this._shadowColor&&!this._editAttachment;d&&(this._shadowXOffset>0?c.width+=this._shadowXOffset:(c.x+=this._shadowXOffset,c.width+=-this._shadowXOffset),this._shadowYOffset>0?c.height+=this._shadowYOffset:(c.y+=this._shadowYOffset,c.height+=-this._shadowYOffset),Tc.grow(c,this._shadowBlur,this._shadowBlur));var e=Wc.setCanvas(b,c);return d&&(e.shadowOffsetX=this._shadowXOffset,e.shadowOffsetY=this._shadowYOffset,e.shadowBlur=this._shadowBlur,e.shadowColor=this._shadowColor),e},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},hit:function(){return!1},hitCanvas:function(a,b,c){for(var d=c.length,e=0;d>e;e++){var f=c[e],g=this[f];if(Xc.hit(g,a,b,this._network.getSelectionTolerance()))return!0}return!1},hitComponent:function(a,b,c){for(var d=c.length,e=0;d>e;e++){var f=c[e],g=this[f];if(g&&Tc.containsPoint(g._viewRect,a,b))return!0}return!1},hitTest:function(a,b){if(!this.isVisible()||!Tc.containsPoint(this._viewRect,a,b))return null;var c,d,e=this._attachments.size();for(c=e-1;c>=0;c--)if(d=this._attachments.get(c),d.isShowInAttachmentDiv()&&d.hit(a,b))return d;for(c=e-1;c>=0;c--)if(d=this._attachments.get(c),!d.isShowInAttachmentDiv()&&d.hit(a,b))return d;return Tc.containsPoint(this._unionBodyBounds,a,b)&&this.hit(a,b)?this:null},intersects:function(){return!1},intersectsComponent:function(a,b){for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this[e];if(f&&Tc.intersects(f._viewRect,a))return!0}return!1},intersectsCanvas:function(a,b){for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this[e];if(Xc.intersects(f,a))return!0}return!1},intersectsTest:function(a){if(!this.isVisible()||!Tc.intersects(this._viewRect,a))return null;var b,c,d=this._attachments.size();for(b=d-1;b>=0;b--)if(c=this._attachments.get(b),c.isShowInAttachmentDiv()&&c.intersects(a))return c;for(b=d-1;b>=0;b--)if(c=this._attachments.get(b),!c.isShowInAttachmentDiv()&&c.intersects(a))return c;return Tc.intersects(this._unionBodyBounds,a)&&this.intersects(a)?this:null}}),Ic.network.Attachment=function(a,b){this._view=Wc.createDiv(),this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._isShowInAttachmentDiv=b===!0,this._isShowInAttachmentDiv&&Wc.setVisible(this._view,a.isVisible())},Jc.ext("twaver.network.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return Jc.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(a,b){return Tc.containsPoint(this._viewRect,a,b)},intersects:function(a){return Tc.intersects(this._viewRect,a)}}),Ic.network.BasicAttachment=function(a,b){Ic.network.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=Wc.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},Jc.ext("twaver.network.BasicAttachment",Ic.network.Attachment,{calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+2*c,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);var l;if("aboveleft"===k)i.y=j.y-d-i.height,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("aboveright"===k)i.y=j.y-d-i.height,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("belowleft"===k)i.y=j.y+d,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("belowright"===k)i.y=j.y+d,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("leftabove"===k)i.y=j.y+c-i.height,i.x=j.x-d-i.width,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("leftbelow"===k)i.y=j.y-c,i.x=j.x-d-i.width,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("rightabove"===k)i.y=j.y+c-i.height,i.x=j.x+d,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("rightbelow"===k)i.y=j.y-c,i.x=j.x+d,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("above"===k)i.y=j.y-d-i.height,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y-d},{x:j.x+l,y:j.y-d}];else if("below"===k)i.y=j.y+d,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y+d},{x:j.x+l,y:j.y+d}];else if("left"===k)i.y=j.y-i.height/2,i.x=j.x-d-i.width,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+l},{x:j.x-d,y:j.y-l}];else{if("right"!==k)throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+l},{x:j.x+d,y:j.y-l}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var m=this.getPadding();0!=m&&Tc.grow(i,m,m),m=this.getPaddingLeft(),0!=m&&(i.x-=m,i.width+=m),m=this.getPaddingRight(),0!=m&&(i.width+=m),m=this.getPaddingTop(),0!=m&&(i.y-=m,i.height+=m),m=this.getPaddingBottom(),0!=m&&(i.height+=m),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},updateMeasure:function(){Ic.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var a=this.isFill(),b=this.getOutlineWidth();this._viewRect=Tc.getRect(this._pointers),this._viewRect=Tc.unionRect(this._viewRect,this._roundRect),b>0&&Tc.grow(this._viewRect,b/2,b/2);var c=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if((b>0||a)&&(c.beginPath(),Xc.drawRoundRect(c,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(c.moveTo(this._pointers[0].x,this._pointers[0].y),c.lineTo(this._pointers[1].x,this._pointers[1].y),c.lineTo(this._pointers[2].x,this._pointers[2].y)),c.closePath(),b>0&&(c.lineWidth=b,c.strokeStyle=this.getOutlineColor(),c.lineCap=this.getCap(),c.lineJoin=this.getJoin(),c.stroke()),a)){var d=this.getFillColor(),e=this.getGradient();e?Xc.fill(c,d,e,this.getGradientColor(),this._viewRect):c.fillStyle=d,c.fill()}return c},getRoundRect:function(){return Jc.clone(this._roundRect)},getContentRect:function(){return Jc.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(a){this._content!==a&&(this._content&&this._view.removeChild(this._content),this._content=a,a&&this._view.appendChild(a))},getContentWidth:function(){return Ce.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Ce.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Ce.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Ce.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Ce.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Ce.ATTACHMENT_POSITION},getXOffset:function(){return Ce.ATTACHMENT_XOFFSET},getYOffset:function(){return Ce.ATTACHMENT_YOFFSET},getPadding:function(){return Ce.ATTACHMENT_PADDING},getPaddingLeft:function(){return Ce.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Ce.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Ce.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Ce.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Ce.ATTACHMENT_DIRECTION},isFill:function(){return Ce.ATTACHMENT_FILL},getFillColor:function(){return Ce.ATTACHMENT_FILL_COLOR},getGradient:function(){return Ce.ATTACHMENT_GRADIENT},getGradientColor:function(){return Ce.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Ce.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Ce.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Ce.ATTACHMENT_CAP},getJoin:function(){return Ce.ATTACHMENT_JOIN},isShadowable:function(){return Ce.ATTACHMENT_SHADOWABLE},hit:function(a,b){return Tc.containsPoint(this._viewRect,a,b)?Tc.containsPoint(this._contentRect,a,b)?!0:Xc.hit(this._attachmentCanvas,a,b):!1},intersects:function(a){return Tc.intersects(this._viewRect,a)?Tc.intersects(this._contentRect,a)?!0:Xc.intersects(this._attachmentCanvas,a):!1}}),Ic.network.LabelAttachment=function(a,b){Ic.network.LabelAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.network.LabelAttachment",Ic.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("label.font"),b=this.getLabel();this._textSize=Xc.getTextSize(a,b);var c=Ic.network.LabelAttachment.superClass.updateMeasure.call(this),d=this._element.getStyle("label.align");Xc.drawText(c,b,this._contentRect,a,this.getStyle("label.color"),d)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Ic.network.AlarmAttachment=function(a,b){Ic.network.AlarmAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.network.AlarmAttachment",Ic.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("alarm.font"),b=this._network.getAlarmLabel(this._element);this._textSize=Xc.getTextSize(a,b),this._fillColor=this._network.getAlarmFillColor(this._element);var c=Ic.network.AlarmAttachment.superClass.updateMeasure.call(this);Xc.drawText(c,b,this._contentRect,a,this.getStyle("alarm.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Ic.network.LinkHandlerAttachment=function(a,b){Ic.network.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.network.LinkHandlerAttachment",Ic.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("link.handler.font"),b=this._network.getLinkHandlerLabel(this._element);this._textSize=Xc.getTextSize(a,b);var c=Ic.network.LabelAttachment.superClass.updateMeasure.call(this);Xc.drawText(c,b,this._contentRect,a,this.getStyle("link.handler.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Ic.network.EditAttachment=function(a,b){Ic.network.EditAttachment.superClass.constructor.call(this,a,b),this._attachmentDiv=Wc.createDiv(),this._view.appendChild(this._attachmentDiv)},Jc.ext("twaver.network.EditAttachment",Ic.network.Attachment,{updateMeasure:function(){Ic.network.EditAttachment.superClass.updateMeasure.call(this),this._viewRect=null,this._element instanceof Je&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Je)||this._element instanceof Ic.ShapeNode||this._element instanceof Ic.Grid||this._element instanceof Ic.Group||this._addRotatePoint(this._element),this._element instanceof Ic.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Ic.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof Ic.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addRotatePoint:function(a){var b=this._network.getRotatePointSize();if(!(0>=b)){var c=a.getOriginalRect();if(!this._rotateDiv){var d=Wc.createDiv();this._attachmentDiv.appendChild(d),this._rotateDiv=d}var e,f=this._network.getRotatePointOutlineWidth(),g=this._network.getRotatePointOutlineColor(),h=this._network.getRotatePointFillColor(),b=this._network.getRotatePointSize(),i=2*b,j={x:c.x+c.width/2-b,y:c.y-this._network.getRotatePointOffset()-i,width:i,height:i};e=0==a.angle?j:this._getRotateRect(j,a.getAngle(),{x:c.x+c.width/2,y:c.y+c.height/2});var k=Tc.unionRect(a.getRect(),e);this._viewRect=Tc.unionRect(k,this._viewRect),Wc.setDiv(this._rotateDiv,j,h,f,g),this._rotateDiv._viewRect=e,Wc.setBorderRaidus(this._rotateDiv,i+"px"),this._rotateAttachments(this._rotateDiv,i/2,f)
}},_addResizingPoint:function(a){var b=this._network.getResizePointSize();if(!(0>=b)){var c=a.getOriginalRect(),d=new me([{x:c.x,y:c.y},{x:c.x+c.width/2,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x,y:c.y+c.height/2},{x:c.x+c.width,y:c.y+c.height/2},{x:c.x,y:c.y+c.height},{x:c.x+c.width/2,y:c.y+c.height},{x:c.x+c.width,y:c.y+c.height}]);if(!this._resizeDivs){this._resizeDivs=new Array;for(var e=0;8>e;e++){var f=Wc.createDiv();this._attachmentDiv.appendChild(f),this._resizeDivs[e]=f}}if(this._resizeDivs){this._resizeRects=new Array;for(var e=0;8>e;e++){var g,h=d.get(e),i={x:h.x-b,y:h.y-b,width:2*b,height:2*b};g=0==a.getAngle()?i:this._getRotateRect(i,a.getAngle(),{x:c.x+c.width/2,y:c.y+c.height/2}),this._resizeRects[e]=g}}var j=this._network.getResizePointOutlineWidth(),k=this._network.getResizePointOutlineColor(),l=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,j,k,l,!0)}},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>=g)){var h=g+c;Tc.grow(a,h,h),this._viewRect=Tc.unionRect(a,this._viewRect);var i,j,k,l,m=2*g,n=new me;for(i=0,j=b.size();j>i;i++)k=b.get(i),l={x:k.x-g,y:k.y-g,width:m,height:m},n.add(l);var o;if(f)o=this._resizeDivs;else{if(this._controlDivs||(this._controlDivs=new Array),this._controlDivs.length<j)for(i=this._controlDivs.length;j>i;i++){var p=Wc.createDiv();this._attachmentDiv.appendChild(p),this._controlDivs[i]=p}else if(this._controlDivs.length>j){for(i=j;i<this._controlDivs.length;i++)this._attachmentDiv.removeChild(this._controlDivs[i]);this._controlDivs.splice(j)}o=this._controlDivs}for(i=0,j=n.size();j>i;i++)l=n.get(i),Wc.setDiv(o[i],l,e,c,d),Wc.setBorderRaidus(o[i],(f?"0":m)+"px"),this._rotateAttachments(o[i],m/2,c,b.get(i))}},_rotateAttachments:function(a,b,c,d){if(this._element instanceof Je){var e=this._element.getAngle();if(0==e)return;{var f=this._element.getOriginalRect(),g=a.style.left.split("px")[0],h=a.style.top.split("px")[0];f.x+f.width/2,f.y+f.height/2}d||(d={x:parseFloat(g)+b+c,y:parseFloat(h)+b+c});var i=Tc.createMatrix(e*Math.PI/180,f.x+f.width/2,f.y+f.height/2),j=i.transform(d);a.style.webkitTransform="rotate("+e+"deg)",a.style.mozTransform="rotate("+e+"deg)",a.style.OTransform="rotate("+e+"deg)",a.style.msTransform="rotate("+e+"deg)",a.style.transform="rotate("+e+"deg)",a.style.left=j.x-b-c+"px",a.style.top=j.y-b-c+"px"}},_addShapeLinkPoints:function(a){this._addEditPoints(a._element.getPoints())},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(xd.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var c=new me;c.add(b),this._addEditPoints(c)}}},_addEditPoints:function(a){var b=Tc.getRect(a);if(b){var c=this._network.getEditPointOutlineWidth(),d=this._network.getEditPointOutlineColor(),e=this._network.getEditPointFillColor();this._addPoints(b,a,c,d,e,!1)}},hit:function(a,b){if(!Tc.containsPoint(this._viewRect,a,b))return!1;var c;if(this._resizeDivs)for(c=this._resizeDivs.length-1;c>=0;c--)if(Tc.containsPoint(this._resizeRects[c],a,b))return!0;if(this._rotateDiv&&Tc.containsPoint(this._rotateDiv._viewRect,a,b))return!0;if(this._controlDivs)for(c=this._controlDivs.length-1;c>=0;c--)if(Tc.containsPoint(this._controlDivs[c]._viewRect,a,b))return!0;return!1},intersects:function(a){if(!Tc.intersects(this._viewRect,a))return!1;var b;if(this._resizeDivs)for(b=this._resizeDivs.length-1;b>=0;b--)if(Tc.intersects(this._resizeRects[b],a))return!0;if(this._rotateDiv&&Tc.containsPoint(this._rotateDiv._viewRect,a))return!0;if(this._controlDivs)for(b=this._controlDivs.length-1;b>=0;b--)if(Tc.intersects(this._controlDivs[b]._viewRect,a))return!0;return Tc.intersects(this._viewRect,a)?!1:!1},_getRotateRect:function(a,b,c){var d=Tc.createMatrix(b*Math.PI/180,c.x,c.y),e={x:a.x+a.width/2,y:a.y+a.height/2},f=d.transform(e),g=new Ic.List([{x:f.x-a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y+a.height/2},{x:f.x-a.width/2,y:f.y+a.height/2}]);return Tc.getRect(g)}}),Ic.network.IconsAttachment=function(a,b){Ic.network.IconsAttachment.superClass.constructor.call(this,a,b),this._iconsCanvas=null},Jc.ext("twaver.network.IconsAttachment",Ic.network.Attachment,{isShadowable:function(){return Ce.ATTACHMENT_SHADOWABLE},updateMeasure:function(){Ic.network.IconsAttachment.superClass.updateMeasure.call(this);var a=this._network.getIconsNames(this._element);if(a&&0!=a.length){var b=this._network.getIconsColors(this._element),c=this._element.getStyle("icons.orientation"),d=this._element.getStyle("icons.position"),e=this._element.getStyle("icons.xoffset"),f=this._element.getStyle("icons.yoffset"),g=this._element.getStyle("icons.xgap"),h=this._element.getStyle("icons.ygap"),i=this._getIconsSize(a,c,g,h);if(i){var j=this._network.getPosition(d,this._ui,i,e,f);this._viewRect={x:j.x,y:j.y,width:i.width,height:i.height},"top"===c?j.y+=i.height:"left"===c&&(j.x+=i.width),this._iconsCanvas||(this._iconsCanvas=Wc.createCanvas(),this._view.appendChild(this._iconsCanvas));var k=this._ui.setShadow(this,this._iconsCanvas,Jc.clone(this._viewRect)),l=j.x,m=j.y,n=0;for(var o in a){var p=null,q=null;b&&b.length>n&&(q=b[n++]);var r=Jc.getImageAsset(a[o]);if(null!=r){if("right"===c)p={x:l,y:m,width:r.getWidth(),height:r.getHeight()},l+=p.width+g;else if("left"===c)p={x:l-r.getWidth(),y:m,width:r.getWidth(),height:r.getHeight()},l-=p.width+g;else if("top"===c)p={x:l,y:m-r.getHeight(),width:r.getWidth(),height:r.getHeight()},m-=p.height+h;else{if("bottom"!==c)throw"Can not resolve '"+c+"' orientation";p={x:l,y:m,width:r.getWidth(),height:r.getHeight()},m+=p.height+h}Nd(k,r.getImage(q,p.width,p.height),q,p,this._element,this._network)}}}}},_getIconsSize:function(a,b,c,d){var e=0,f=0,g=null,h=null,i=null;for(var j in a)if(h=Jc.getImageAsset(a[j])){if("right"===b)g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},e+=g.width+c;else if("left"===b)g={x:e-h.getWidth(),y:f,width:h.getWidth(),height:h.getHeight()},e-=g.width+c;else if("top"===b)g={x:e,y:f-h.getHeight(),width:h.getWidth(),height:h.getHeight()},f-=g.height+d;else{if("bottom"!==b)throw"Can not resolve '"+b+"' orientation";g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},f+=g.height+d}i=null==i?Jc.clone(g):Tc.unionRect(i,g)}return i?{width:Math.abs(i.width),height:Math.abs(i.height)}:null}}),Ic.network.NodeUI=function(a,b){Ic.network.NodeUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.network.NodeUI",Ic.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(a){Ic.network.NodeUI.superClass.invalidate.call(this,a);var b=this._element.getAgentLinks();b&&b.forEach(function(a){this._network.invalidateElementUI(a,!1)},this)},updateMeasure:function(){Ic.network.NodeUI.superClass.updateMeasure.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=Tc.getHotSpot(b.x,b.y,b.width,b.height,a),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp(["_selectCanvas","_nodeCanvas","_nodeImage","_nodeComponent","_vectorCanvas","_outerCanvas"]);var c=this._element.getParent();c instanceof Ke&&this._network.invalidateElementUI(c,!1)},drawBody:function(){var a=this.getStyle("body.type");"default"===a?this.drawDefaultBody():"vector"===a?this.drawVectorBody():"default.vector"===a?(this.drawVectorBody(),this.drawDefaultBody()):"vector.default"===a?(this.drawDefaultBody(),this.drawVectorBody()):this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0})},drawOuterBorder:function(){var a=this._element,b=a.getStyle("outer.width");if(b>0){var c=this.getBodyRect();Tc.addPadding(c,a,"outer.padding",1),this._outerCanvas||(this._outerCanvas=Wc.createCanvas());var d=Jc.clone(c);Tc.grow(d,b/2,b/2);var e=Wc.setCanvas(this._outerCanvas,d);e.lineWidth=b,e.lineCap=a.getStyle("outer.cap"),e.lineJoin=a.getStyle("outer.join"),e.strokeStyle=this._outerColor,Xc.drawVector(e,a.getStyle("outer.shape"),null,c),e.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(d)}},drawSelectBorder:function(){var a=this._element,b=a.getStyle("select.width");if(b>0){var c=this.getBodyRect();Tc.addPadding(c,a,"select.padding",1),this._selectCanvas||(this._selectCanvas=Wc.createCanvas());var d=Jc.clone(c);Tc.grow(d,b/2,b/2);var e=Wc.setCanvas(this._selectCanvas,d);e.lineWidth=b,e.lineCap=a.getStyle("select.cap"),e.lineJoin=a.getStyle("select.join"),e.strokeStyle=a.getStyle("select.color"),Xc.drawVector(e,a.getStyle("select.shape"),null,c),e.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(d)}},drawDefaultBody:function(){var a=this._element,b=Jc.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return this.addBodyBounds(c),void(this._currentImageAsset=null);if(Tc.addPadding(c,this._element,"image.padding",1),b.getImage()){this._nodeCanvas||(this._nodeCanvas=Wc.createCanvas());var d=Jc.clone(c),e=this.setShadow(this,this._nodeCanvas,d);0!=a.getAngle()&&(c=a.getOriginalRect(),Ic.Util.rotateCanvas(e,c,a.getAngle())),Nd(e,a.getImage(),this.getInnerColor(),c,a,this._network),c=d,this.addComponent(this._nodeCanvas)}else if(b.getSrc())this._nodeImage||(this._nodeImage=Wc.createImg()),Wc.setImg(this._nodeImage,b.getSrc(),c),this.addComponent(this._nodeImage);else{if(!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this._nodeComponent=this._currentImageAsset!==b?b.getFunction()(this,c):b.getFunction()(this,c,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=Jc.clone(c)}this.addBodyBounds(c),this._currentImageAsset=b},hit:function(a,b){if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Jc.math.containsPoint(c,a,b))return!0}return this.hitCanvas(a,b,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.hitComponent(a,b,["_nodeImage","_nodeComponent"])},intersects:function(a){if(this._network._transparentSelectionEnable){var b=this.getBodyRect();if(Jc.math.intersects(b,a))return!0}return this.intersectsCanvas(a,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.intersectsComponent(a,["_nodeImage","_nodeComponent"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=Wc.createCanvas());var a=Xc.drawPath(this,this._vectorCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("vector.deep"),c=this._vectorCanvas.getContext("2d"),d=this.getBodyRect(),e=this.getStyle("vector.fill.color");if(0!==b&&e){var f=this._element.getAngle();0!=f&&(d=this._element.getOriginalRect(),Ic.Util.rotateCanvas(c,d,-f),Ic.Util.rotateCanvas(c,d,f)),"rectangle"===this.getStyle("vector.shape")&&Xc.draw3DRect(c,e,b,d)}this.addBodyBounds(a),this.addComponent(this._vectorCanvas)}}),Ic.network.LinkUI=function(a,b){Ic.network.LinkUI.superClass.constructor.call(this,a,b),this._linkCanvas=Wc.createCanvas()},Jc.ext("twaver.network.LinkUI",Ic.network.ElementUI,{isEditable:function(){return xd.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},hit:function(a,b){return this.hitCanvas(a,b,["_linkCanvas"])},intersects:function(a){return this.intersectsCanvas(a,["_linkCanvas"])},checkAttachments:function(){Ic.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);null!=a&&""!==a?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Ic.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Tc.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,Ic.network.LinkUI.superClass.invalidate.call(this,a)},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=xd.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=xd.createToPoint(this)),this._toPoint},updateMeasure:function(){Ic.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=this.getStyle("link.type"),d=new me;if(xd.isOrthogonalOrFlexionalLink(this._element))d=xd.orthogonalAndFlexional(this,c);else if(this._element.isLooped()){var e=this._network.getElementUI(this._element.getFromAgent());null!=e&&(this._hotSpot=xd.fillLoopedPoints(this,e.getBodyRect(),d))}else{if("arc"!==c&&"triangle"!==c&&"parallel"!==c)throw"Can not resolve link type '"+c+"'";this._hotSpot=xd.fillBundlePoints(this,c,a,b,d)}if(this._network._linkPathFunction){var f=this._network._linkPathFunction(this,d);f&&(d=f)}return d},drawLinePoints:function(a,b,c,d,e){if(a.lineWidth=c,a.strokeStyle=d,this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new ud(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset");this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),Xc._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var h=this._element.getStyle("link.flow.color");h=h?h:Ce.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=h,Xc._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),Xc.drawLinePoints(a,b,e),a.stroke()},drawBody:function(){var a=this.getLinkPoints();if(a&&!(a.size()<2)){var b=this._element,c=Tc.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===b.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=2*h}Tc.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(c=Tc.unionRect(c,ne.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(c=Tc.unionRect(c,ne.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"))));var i=this.setShadow(this,this._linkCanvas,c);i.lineCap=b.getStyle("link.cap"),i.lineJoin=b.getStyle("link.join");var j=b.getStyle("link.pattern");g&&this.drawLinePoints(i,a,e,b.getStyle("select.color"),j),this._outerColor&&this.drawLinePoints(i,a,d+2*f,this._outerColor,j),this.drawLinePoints(i,a,d,this._innerColor||b.getStyle("link.color"),j),this.addBodyBounds(c),this.addComponent(this._linkCanvas),ne.drawLinkArrow(this,i,a)}},getControlPoint:function(){return xd.getControlPoint(this._element,this)},setControlPoint:function(a){if(a){var b=this.getStyle("link.type");if(xd.hasControlPoint(b)){var c=xd.getLinkSourceBounds(this),d=xd.getLinkTargetBounds(this);xd.setParamsByControlPoint(a,c,d,b,this._element)}}},getLineLength:function(){return this._lineLength}}),Ic.network.GroupUI=function(a,b){Ic.network.GroupUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.network.GroupUI",Ic.network.NodeUI,{isEditable:function(){return!this._element.isExpanded()},drawBody:function(){this.getBodyRect();this._shapeRect?this.drawExpandedGroup():Ic.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=Wc.createCanvas());var a=Xc.drawPath(this,this._nodeCanvas,"group",!1,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");0!==b&&c&&"rectangle"===this.getStyle("group.shape")&&Xc.draw3DRect(this._nodeCanvas.getContext("2d"),c,b,this._bodyRect),this.addBodyBounds(a),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element;if(a.isExpanded()){var b=this.getChildrenRects();if(!b.isEmpty()){var c=a.getStyle("group.shape"),d=Uc[c];if(!d)throw"Can not resolve group shape '"+c+"'";this._shapeRect=d(b)}}return this._shapeRect?(Tc.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):Ic.network.GroupUI.superClass.createBodyRect.call(this)}}),Ic.network.GridUI=function(a,b){Ic.network.GridUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.network.GridUI",Ic.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?Ic.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var a=this.getStyle("grid.fill"),b=this.getStyle("grid.deep"),c=this.getStyle("grid.cell.deep");if(a||0!==b||0!==c){var d=this.getBodyRect(),e=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=Wc.createCanvas());var f=Jc.clone(d),g=this.setShadow(this,this._nodeCanvas,f);if(g.rect(d.x,d.y,d.width,d.height),this.addComponent(this._nodeCanvas),a&&(g.fillStyle=e,g.fill()),0!=b&&Xc.draw3DRect(g,e,b,d.x,d.y,d.width,d.height),0!=c)for(var h=this.getStyle("grid.row.count"),i=this.getStyle("grid.column.count"),j=0;h>j;j++)for(var k=0;i>k;k++){var l=this._element.getCellRect(j,k);null!=l&&Xc.draw3DRect(g,e,c,l.x,l.y,l.width,l.height)}this.addBodyBounds(f)}}}),Ic.network.ShapeNodeUI=function(a,b){Ic.network.ShapeNodeUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.network.ShapeNodeUI",Ic.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2)return void this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0});this._nodeCanvas||(this._nodeCanvas=Wc.createCanvas());var a=Xc.drawPath(this,this._nodeCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed"));this.addBodyBounds(a),this.addComponent(this._nodeCanvas),ne.drawLinkArrow(this,this._nodeCanvas.getContext("2d"),Tc.getPointObject(this._element._points,this._element._segments))},drawSelectBorder:function(){var a=this._element,b=a.getStyle("select.width");if(b>0){var c=this.getBodyRect();Tc.addPadding(c,a,"select.padding",1);var d=a.getStyle("vector.outline.width");d>0&&Tc.grow(c,d/2,d/2),this._selectCanvas||(this._selectCanvas=Wc.createCanvas());var e=Jc.clone(c);Tc.grow(e,b/2,b/2);var f=Wc.setCanvas(this._selectCanvas,e);f.lineWidth=b,f.lineCap=a.getStyle("select.cap"),f.lineJoin=a.getStyle("select.join"),f.strokeStyle=a.getStyle("select.color"),Xc.drawVector(f,a.getStyle("select.shape"),null,c),f.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(e)}}}),Ic.network.ShapeLinkUI=function(a,b){Ic.network.ShapeLinkUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.network.ShapeLinkUI",Ic.network.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new me,d=this.getStyle("shapelink.type");c.add(a),null!=this._element._points&&c.addAll(this._element._points),c.add(b);var e=c.size(),f=Math.floor(e/2);if(e%2===0){var g=c.get(f),h=c.get(f-1);this._hotSpot={x:(g.x+h.x)/2,y:(g.y+h.y)/2}}else this._hotSpot=Jc.clone(c.get(f));var i,j,k;if("lineto"===d);else if("quadto"===d){for(i=new me(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-1>j?new me([c.get(j++),c.get(j)]):c.get(j));c=i}else if("cubicto"===d){for(i=new me(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-2>j?new me([c.get(j++),c.get(j++),c.get(j)]):e-1>j?new me([c.get(j++),c.get(j)]):c.get(j));c=i}else{if("orthogonalto"!==d)throw"Can not resolve shapelink type '"+d+"'";for(k=c.get(0),i=new me(k),j=1,e=c.size();e>j;j++)if(e-1>j){var l=Jc.clone(c.get(j)),m=l.x,n=l.y,o=m-k.x,p=n-k.y;Math.abs(o)>Math.abs(p)?(l.x=m,l.y=k.y):(l.x=k.x,l.y=n),k=l,i.add(k)}else i.add(c.get(j));c=i}return c}}),Ic.network.RotatableNodeUI=function(a,b){Ic.network.RotatableNodeUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.network.RotatableNodeUI",Ic.network.NodeUI,{isEditable:function(){return!1},drawDefaultBody:function(){var a=this._element,b=Jc.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return this.addBodyBounds(c),void(this._currentImageAsset=null);if(Tc.addPadding(c,this._element,"image.padding",1),b.getImage()){this._nodeCanvas||(this._nodeCanvas=Wc.createCanvas());var d=Jc.clone(c),e=this.setShadow(this,this._nodeCanvas,d),f=this._element._getOrignalWidth(),g=this._element._getOrignalHeight(),h=this._element._getRotateRect();e.save(),e.translate(c.x-h.x+f/2,c.y-h.y+g/2),e.rotate(this._element._angle*Math.PI/180);var c={x:-f/2,y:-g/2,width:f,height:g};Nd(e,b.getImage(this._innerColor,c.width,c.height),this._innerColor,c,a,this._network),e.restore(),this.addComponent(this._nodeCanvas)}else if(b.getSrc());else if(!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this.addBodyBounds(c),this._currentImageAsset=b}}),Ic.network.interaction.BaseInteraction=function(a){this.network=a},Jc.ext("twaver.network.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];Wc.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)Wc.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){0===a.button&&(this._startLogical=this.network.getLogicalPoint(a),this._startClient=Wc.getClientPoint(a),this._startLogical&&Wc.handle_mousedown(this,a))},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Ic.network.interaction.SelectInteraction=function(a){Ic.network.interaction.SelectInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.network.interaction.SelectInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(a){if(this._button=a.button,this.network.isValidEvent(a)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!a.shiftKey){var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?Jc.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(Jc.isCtrlDown(a)||c.clearSelection(),this.end(a),this.network.getLogicalPoint(a)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(0!==this._button||this.network.isMovingElement()||this.network.isEditingElement())return void this.end(a);this._handle_mousemove(a),this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=Wc.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}));var b=Tc.getRect([this._startLogical,this._endLogical]);Wc.setDiv(this.mark,b,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())},end:function(a){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}var e=this;setTimeout(function(){e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null)},0),this.network.setSelectingElement(!1)}this._handle_mouseup(a)}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y}}),Ic.network.interaction.MoveInteraction=function(a,b){this.lazyMode=b,this.xoffset=0,this.yoffset=0,Ic.network.interaction.MoveInteraction.superClass.constructor.call(this,a),this.currentKeyEvent=null},Jc.ext("twaver.network.interaction.MoveInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown")},tearDown:function(){this.removeListener("mousedown","keydown"),this.end()},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup")},handle_keyup:function(){this.currentKeyEvent=null,this.removeListener("keyup")},isParenting:function(){return this._startLogical&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(a,b){var c=null;null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect(),this.parent=null);var d=this;if(a=this.network.getLogicalPoint(a),!b&&this.isParenting()){var e={};e.x=a.x-1,e.y=a.y-1,e.width=2,e.height=2;var f=this.network.getElementsAtRect(e,!0);if(f&&f.size()>0)for(var g=f.size(),h=0;g>h;h++){var i=f.get(h);if(!d.network.getElementBox().getSelectionModel().contains(i)){d.parent=i;break}}}null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect()),null==c||b?this.parentMark&&(this.network.getTopDiv().removeChild(this.parentMark),this.parentMark=null):(this.parentMark||(this.parentMark=Jc.html.createDiv(),this.network.getTopDiv().appendChild(this.parentMark)),Jc.html.setDiv(this.parentMark,c,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()))},handle_mousedown:function(a){if(0===a.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);this.network.isMovable(b)&&(this.end(a),this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()||!this._startLogical)return void this.end(a);if(this._handle_mousemove(a),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a});else{this.mark=Wc.createDiv();var b;this.network.getMovableSelectedElements().forEach(function(a){var c=this.getElementUI(a);c&&(b=Tc.unionRect(b,c.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),Wc.setDiv(this.mark,b,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else this.network.moveSelectedElements(this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=Wc.getClientPoint(a),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}));this.parentProcess(a,!1)},end:function(a){if(this._startLogical){if(this.lazyMode){if(this.mark){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.mark&&(b.network.getTopDiv().removeChild(b.mark),b.mark=null,b.network.setMovingElement(!1))};this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var b=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(b.parent)},this.network)}this.parentProcess(a,!0),this._handle_mouseup(a)}}}),Ic.network.interaction.DefaultInteraction=function(a){Ic.network.interaction.DefaultInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.network.interaction.DefaultInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(a){if(this.network.isValidEvent(a)){this.network.isFocusOnClick()&&Ic.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);2===a.detail?this.handleDoubleClicked(a,b):this.handleClicked(a,b)}},handleClicked:function(a,b){Cd.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){Cd.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){Cd.handleKeyDown(this.network,a)},handle_mousemove:function(a){var b=this.network.getElementAt(a),c=this._preElement,d=Dd(c),e=Dd(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this.network),this.network.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this.network),this.network.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this.network),this.network.onMouseMove(b,a),this._preElement=b}}),Ic.network.interaction.PanInteraction=function(a){Ic.network.interaction.PanInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.network.interaction.PanInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){this._startLogical=this.network.getLogicalPoint(a),this._startLogical&&(this._handle_mousedown(a),this.network.getView().style.cursor="pointer")},handle_mouseup:function(){this._clear()},handle_mousemove:function(a){if(this._startLogical){this._handle_mousemove(a);{var b=this._startLogical.x-this._endLogical.x,c=this._startLogical.y-this._endLogical.y;this.network.panByOffset(b,c)}this._startLogical=this._endLogical,this._startClient=Wc.getClientPoint(a)}},_clear:function(a){this._startLogical&&(this._handle_mouseup(a),this.network.getView().style.cursor=this._oldCursor)}}),Ic.network.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,this.editPointSize=a.getEditPointSize(),this.resizePointSize=a.getResizePointSize(),this.rotatePointSize=a.getRotatePointSize(),Ic.network.interaction.EditInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.network.interaction.EditInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null),this.rotateScale&&this.network.getTopDiv().contains(this.rotateScale)&&(this.network.getTopDiv().removeChild(this.rotateScale),this.rotateScale=null)
},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(0===a.button)if(!Jc.isAltDown(a)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Jc.isAltDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?Jc.isAltDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a)));else{var b=this.network.getElementAt(a),c=this.network.getLogicalPoint(a);if(b instanceof Ic.ShapeNode){var d=this.getPointIndex(b.getPoints(),c,!0);d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeNode=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}if(b instanceof Ic.ShapeLink){var e=new Ic.List(b.getPoints()),f=this.network.getElementUI(b);e.add(f.getFromPoint(),0),e.add(f.getToPoint());var d=this.getPointIndex(e,c)-1;d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeLink=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}}},handle_mouseup:function(a){if(this.isStart){var b=Jc.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new Ic.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection})});Ic.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&b){var e=this.shapeNode.getPoints().get(this.pointIndex);this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&b){var e=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.clear()},handle_mousemove:function(a){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.showRotateScale());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(a);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if(this.linkUI)return void this._handleMovingLinkControlPoint(a)}else if(this.network.isValidEvent(a)){if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var b=this.network.getElementAt(a),c=this.network.getElementUI(b);if(!c||!c.getEditAttachment())return void this.clear();var d=this.network.getLogicalPoint(a);if(b instanceof Je){if(this.node=b,this._isEditingShapeNode(d)||this._isResizingNode(d))return void this.network.setEditingElement(!0);if(this._isRotatingElement(d))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(b instanceof Ic.ShapeLink){if(this.shapeLink=b,this._isEditingShapeLink(d))return void this.network.setEditingElement(!0)}else if(c instanceof Ic.network.LinkUI&&xd.isOrthogonalLink(c._element)){this.linkUI=c;var e=this.linkUI.getControlPoint();return void(e&&this._contains(d,e,this.editPointSize)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}this.clear()}},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle();return this._isRotating(a,"crosshair",c,d)},_isRotating:function(a,b,c,d){var e=this.network.getRotatePointSize(),f={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-e},g=this._rotatePoint(f,d,c),h={x:g.x-e,y:g.y-e,width:2*e,height:2*e};return Tc.containsPoint(h,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=b.getCenterLocation();return Math.round(180*Math.atan2(c.x-a.x,a.y-c.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(a){if(this._handle_mousemove(a),!this.mouseMoved&&Jc.isCtrlDown(a)){var b=this._endLogical.x-this._startLogical.x,c=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal,this.mouseMoved=!0}var d=this.shapeNode.getPoints().get(this.pointIndex),e=Jc.clone(this._endLogical);this.horizontal&&(e.y=d.y),this.vertical&&(e.x=d.x),this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){if(this._handle_mousemove(a),!this.mouseMoved&&Jc.isCtrlDown(a)){var b=this._endLogical.x-this._startLogical.x,c=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal,this.mouseMoved=!0}var d=this.shapeLink.getPoints().get(this.pointIndex),e=Jc.clone(this._endLogical);this.horizontal&&(e.y=d.y),this.vertical&&(e.x=d.x),this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this._handle_mousemove(a),this.linkUI.setControlPoint(Jc.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(i,f,b),g.x=this._endLogical.x,g.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),"north"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),k.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(h,f,b),j.x=this._endLogical.x,j.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"west"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),n.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),l.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(j,f,b),h.x=this._endLogical.x,h.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"south"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),m.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}"southeast"===this.resizeDirection&&(this._transformPoint(g,f,b),i.x=this._endLogical.x,i.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),this.lazyMode?(this.mark||(this.mark=Wc.createDiv(),this.mark.style.webkitTransform="rotate("+b+"deg)",this.mark.style.mozTransform="rotate("+b+"deg)",this.mark.style.OTransform="rotate("+b+"deg)",this.mark.style.msTransform="rotate("+b+"deg)",this.mark.style.transform="rotate("+b+"deg)",this.network.getTopDiv().appendChild(this.mark)),Wc.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){if(this.node instanceof Ic.ShapeNode){this.shapeNode=this.node;for(var b=this.shapeNode.getPoints(),c=0,d=b.size();d>c;c++){var e=b.get(c);if(this._contains(a,e,this.editPointSize))return this._setCrossCursor(),this.pointIndex=c,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){for(var b=this.shapeLink.getPoints(),c=0,d=b.size();d>c;c++){var e=b.get(c);if(this._contains(a,e,this.editPointSize))return this._setCrossCursor(),this.pointIndex=c,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle(),e={x:c.x,y:c.y},f=this._rotatePoint(e,d,c);return this._isResizing(a,f.x,f.y,"northwest","nwse-resize")?!0:(e={x:c.x+c.width/2,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"north","ns-resize")?!0:(e={x:c.x+c.width,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"northeast","nesw-resize")?!0:(e={x:c.x,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"west","ew-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"east","ew-resize")?!0:(e={x:c.x,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southwest","nesw-resize")?!0:(e={x:c.x+c.width/2,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"south","ns-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=Tc.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){return this._contains(a,{x:b,y:c},this.resizePointSize)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:2*c,height:2*c};return Tc.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;for(var d,e=a.get(0),f=1;f<a.size();f++){if(d=a.get(f),this.isPointOnLine(b,e,d,6))return f;e=d}return e=a.get(0),c&&this.isPointOnLine(b,e,d,6)?a.size():0},showRotateScale:function(){this.rotateScale||(this.rotateScale=Jc.html.createCanvas());var a,b,c,d,e,f=(new Ic.List,this.network.getRotateScaleWidth()),g=this.network.getRotateScaleHeight(),h=this.network.getRotatePointSize(),i=this.node.getAngle(),j=this.node.getOriginalRect(),k={x:j.x+j.width/2,y:j.y-this.network.getRotatePointOffset()-h},l=this._rotatePoint(k,i,j),m="13px Arial",n=i+"°";this.node.getAngle()>=0&&this.node.getAngle()<=180?(b={x:l.x+h,y:l.y},c={x:b.x+f,y:b.y},d={x:c.x,y:c.y-g},e={x:b.x,y:d.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(b={x:l.x-h,y:l.y},c={x:b.x-f,y:b.y},d={x:c.x,y:c.y-g},e={x:b.x,y:d.y});var o=new Ic.List([b,c,d,e]),a=Jc.math.getRect(o),p=Jc.html.setCanvas(this.rotateScale,a);p.fillStyle=this.network.getRotateScaleFillColor(),p.fillRect(a.x,a.y,a.width,a.height),p.fillStyle=this.network.getRotateScaleFontColor(),p.textBaseline="middle",p.textAlign="center",p.font=m,p.fillText(n,a.x+a.width/2,a.y+a.height/2),this.network.getTopDiv().appendChild(this.rotateScale)},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}return(b>=360||-360>=b)&&(b%=360),b>22.5&&67.5>=b&&(c+=1),-22.5>b&&b>=-67.5&&(c-=1),b>67.5&&112.5>=b&&(c+=2),-67.5>b&&b>=-112.5&&(c-=2),b>112.5&&157.5>=b&&(c+=3),-112.5>b&&b>=-157.5&&(c-=3),b>157.5&&202.5>=b&&(c+=4),-157.5>b&&b>=-202.5&&(c-=4),b>202.5&&247.5>=b&&(c+=5),-202.5>b&&b>=-247.5&&(c-=5),b>247.5&&292.5>=b&&(c+=6),-247.5>b&&b>=-292.5&&(c-=6),b>292.5&&337.5>=b&&(c+=7),-292.5>b&&b>=-337.5&&(c-=7),c>8&&(c-=8),0>=c&&(c+=8),d[c]}}),Ic.network.interaction.CreateElementInteraction=function(a,b){b||(b=Je),this.elementFunction=Ic.Util.isTypeOf(b,Je)?function(a){var c=new b;return c instanceof Je&&c.setCenterLocation(a),c}:b,Ic.network.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.network.interaction.CreateElementInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),Ic.network.interaction.CreateLinkInteraction=function(a,b){b||(b=Ic.Link),this.linkFunction=Ic.Util.isTypeOf(b,Ic.Link)?function(a,c){var d=new b;return d instanceof Ic.Link&&(d.setFromNode(a),d.setToNode(c)),d}:b,Ic.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.network.interaction.CreateLinkInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){var a=this;setTimeout(function(){a._fromRectangle&&(a.network.getTopDiv().removeChild(a._fromRectangle),a._fromRectangle=null),a._currentRectangle&&(a.network.getTopDiv().removeChild(a._currentRectangle),a._currentRectangle=null),a._line&&(a.network.getTopDiv().removeChild(a._line),a._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(this.network.isValidEvent(a))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.updateMark()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.updateMark()))}},getFromNode:function(a){return this.getNode(a)},getToNode:function(a){return this.getNode(a)},getNode:function(a){var b=this.network.getElementAt(a);return b instanceof Je&&this.network.isLinkable(b)?b:null},updateMark:function(){var a;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(a=this.network.getElementUI(this.currentNode),this._currentRectangle=Wc.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),Wc.setDiv(this._currentRectangle,a._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var a=this.fromNode.getCenterLocation(),b=a.x,c=a.y,d=this.currentPoint.x,e=this.currentPoint.y;this._line||(this._line=Wc.createCanvas(),this.network.getTopDiv().appendChild(this._line));var f=Wc.setCanvas(this._line,Math.min(b,d),Math.min(c,e),Math.abs(b-d),Math.abs(c-e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),f.moveTo(b,c),f.lineTo(d,e),f.stroke()}else this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}),Ic.network.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=Ic.ShapeNode),this.shapeNodeFunction=Ic.Util.isTypeOf(b,Ic.ShapeNode)?function(a){var c=new b;return c instanceof Ic.ShapeNode&&a&&c.setPoints(a),c}:b,Ic.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.network.interaction.CreateShapeNodeInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.lastPoint=null,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b)if(2===a.detail){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new me),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this._handle_mousedown(a),this.points.size()>0&&Jc.isCtrlDown(a)&&(this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.horizontal=!1,this.vertical=!1),this.lastPoint=b,this.points.add(b),this.updateMark()}},handle_mousemove:function(a){if(this.points){if(this.currentPoint=this.network.getLogicalPoint(a),Jc.isCtrlDown(a)){var b=this.currentPoint.x-this.lastPoint.x,c=this.currentPoint.y-this.lastPoint.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal}else this.horizontal=!1,this.vertical=!1;this.horizontal&&(this.currentPoint.y=this.lastPoint.y),this.vertical&&(this.currentPoint.x=this.lastPoint.x),this.updateMark()}},updateMark:function(){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=Wc.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var a=new me(this.points);a.add(this.currentPoint);var b=Tc.getRect(a),c=this.network.getEditLineWidth();Jc.math.grow(b,c,c);var d=Wc.setCanvas(this.mark,b);d.lineWidth=c,d.strokeStyle=this.network.getEditLineColor(),d.beginPath(),Xc.drawLinePoints(d,a),d.stroke()}}}),Ic.network.interaction.CreateShapeLinkInteraction=function(a,b){Ic.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=Ic.ShapeLink),this.linkFunction=Ic.Util.isTypeOf(b,Ic.ShapeLink)?function(a,c,d){var e=new b;return e instanceof Ic.ShapeLink&&(e.setFromNode(a),e.setToNode(c),d&&e.setPoints(d)),e}:b},Jc.ext("twaver.network.interaction.CreateShapeLinkInteraction",Ic.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),Ic.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b)if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{if(this.points||(this.points=new me),this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b),this.updateMark()}else this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=Wc.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()},updateLine:function(){if(this.currentPoint&&this.polyline){var a=new me(this.points);a.add(this.fromNode.getCenterLocation(),0),a.add(this.currentPoint);var b=Tc.getRect(a),c=Wc.setCanvas(this.polyline,b);c.lineWidth=this.network.getEditLineWidth(),c.strokeStyle=this.network.getEditLineColor(),c.beginPath(),Xc.drawLinePoints(c,a),c.stroke()}}}),Ic.network.interaction.CreateOrthogonalLinkInteraction=function(a,b,c,d,e,f){Ic.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,a,b),this.linkType=c||"orthogonal",this.isByControlPoint=d,this.splitPercent=e,this.isSplitByPercent=f,this.link=new Ic.Link,this.link.setStyle("link.type",this.linkType),this.link.setStyle("link.split.by.percent",this.isSplitByPercent),xd.isFlexionalTypeLink(this.linkType)||xd.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=Ic.Styles.getStyle("link.extend")),this.link.setStyle("link.extend",this.splitPercent)):xd.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=Ic.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?this.link.setStyle("link.split.percent",this.splitPercent):this.link.setStyle("link.split.value",this.splitPercent))},Jc.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction",Ic.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),Ic.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var a=Ic.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);if(a.setStyle("link.type",this.linkType),a.setStyle("link.split.by.percent",this.isSplitByPercent),this.isByControlPoint){var b=xd.getControlPoint(a);if(b)return a.SetStyle("link.control.point",b),a}else xd.isFlexionalTypeLink(this.linkType)||xd.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=Ic.Styles.getStyle("link.extend")),a.setStyle("link.extend",this.splitPercent)):xd.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=Ic.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?a.setStyle("link.split.percent",this.splitPercent):a.setStyle("link.split.value",this.splitPercent));return a},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode)return;var a,b=this.network.getElementUI(this.fromNode);if(!b)return;if(a=b.getBodyRect(),null==a)return;var c;if(this.currentNode&&this.currentNode!==this.fromNode){var d=this.network.getElementUI(this.currentNode);if(!d)return;c=d.getBodyRect()}else c={x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1};if(!c)return;var e=xd.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,a,c,this.link);if(xd.drawCorner(e,this.link),e.size()<2)return;this.line||(this.line=Wc.createCanvas(),this.network.getTopDiv().appendChild(this.line));var f=Wc.setCanvas(this.line,Tc.getLineRect(e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),Xc.drawLinePoints(f,e),f.stroke()}else this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}),Ic.network.interaction.MagnifyInteraction=function(a,b,c,d,e){Ic.network.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.zoom=b||2,this.xRadius=c||100,this.yRadius=d||100,this.shape=e||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=Wc.createCanvas(),this.markCanvas._isIgnored=!0},Jc.ext("twaver.network.interaction.MagnifyInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove")},tearDown:function(){this.removeListener("mousemove"),this._clear()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);b&&(this.lastPoint||this.network.getView().appendChild(this.markCanvas),this.lastPoint=b,this.updateMark())},updateMark:function(){var a,b=this.network._zoom,c=this.zoom*b,d=this.lastPoint.x*b-this.xRadius,e=this.lastPoint.y*b-this.yRadius,f=2*this.xRadius,g=2*this.yRadius,h={x:this.lastPoint.x-this.xRadius/c,y:this.lastPoint.y-this.yRadius/c,width:f/c,height:g/c},i=this.borderWidth,j=Wc.createCanvas();j.width=f,j.height=g,this.network.toCanvasByRegion(h,c,j),Wc.setCanvas(this.markCanvas,d,e,f,g),a=this.markCanvas.getContext("2d"),a.save(),a.beginPath(),Xc.drawVector(a,this.shape,null,d,e,f,g),a.clip(),a.fillStyle=this.backgroundColor,a.beginPath(),a.rect(d,e,f,g),a.fill(),a.drawImage(j,d,e),a.restore(),a.beginPath(),a.lineWidth=i,Xc.drawVector(a,this.shape,null,d+i/2,e+i/2,f-i,g-i),a.strokeStyle=this.borderColor,a.stroke()},_clear:function(){this.lastPoint&&(this.network.getView().removeChild(this.markCanvas),this.lastPoint=null)},getZoom:function(){return this.zoom},setZoom:function(a){this.zoom=a,this.updateMark()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.updateMark()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.updateMark()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.updateMark()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.updateMark()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.updateMark()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.updateMark()}}),Ic.network.interaction.TouchInteraction=function(a){Ic.network.interaction.TouchInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.network.interaction.TouchInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Wc.addEventListener("touchstart","handleTouchstart",a,this),Wc.addEventListener("touchmove","handleTouchmove",a,this),Wc.addEventListener("touchend","handleTouchend",a,this),Wc.addEventListener("touchcancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();Wc.removeEventListener("touchstart",a,this),Wc.removeEventListener("touchmove",a,this),Wc.removeEventListener("touchend",a,this),Wc.removeEventListener("touchcancel",a,this)},handleTouchstart:function(a){if(Wc.preventDefault(a),a.touches&&1==a.touches.length){var b=this.network.getLogicalPoint(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b;var d=this;c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Cd.handleLongClicked(d.network,a,c)},1e3)}else a.touches&&2==a.touches.length&&(this._distance=zd.getDistance(a),this._zoom=this.network.getZoom(),this._startTouchPoint={x:a.touches[0].clientX,y:a.touches[0].clientY});this._touchCount=a.touches.length},handleTouchmove:function(a){if(Wc.preventDefault(a),2==this._touchCount&&a.touches&&2==a.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-zd.getDistance(a))>=Ce.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var b=zd.getDistance(a)/this._distance;this.network.setTouchZoom(this._zoom*b,!1)}else{var c=a.touches[0],d=this._startTouchPoint.x-c.clientX,e=this._startTouchPoint.y-c.clientY,f=this.network.panByOffset(d,e);this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}else if(1==this._touchCount&&a.touches&&1==a.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var g=this.network.getLogicalPoint(a),h=this.network.getElementAt(g);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==h&&this.network.getMovableSelectedElements().contains(h)){var d=g.x-this._startTouchPoint.x,e=g.y-this._startTouchPoint.y;(Math.abs(d)>=Ce.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Ce.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=g,this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}),this.timer&&clearTimeout(this.timer)))
}else{var d=g.x-this._startTouchPoint.x,e=g.y-this._startTouchPoint.y;(Math.abs(d)>=Ce.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Ce.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer)}}else{this._moveTouchPoint=this.network.getLogicalPoint(a);var d=this._moveTouchPoint.x-this._startTouchPoint.x,e=this._moveTouchPoint.y-this._startTouchPoint.y;if(Math.abs(d)>=Ce.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(e)>=Ce.TOUCH_RECT_SELECT_THRESHOLD){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=Wc.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.timer&&clearTimeout(this.timer));var i=Tc.getRect([this._startTouchPoint,this._moveTouchPoint]);Wc.setDiv(this.mark,i,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}}},handleTouchend:function(a){if(Wc.preventDefault(a),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1),this.timer&&clearTimeout(this.timer)}else if(this._startTouchPoint){this._zoomFlag=!1;var e=new Date,f=this.network.getLogicalPoint(a),g=this.network.getElementAt(this._startTouchPoint);this._startTouchPoint&&f&&e.getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,f)<=20&&(g?this.network.getSelectionModel().contains(g)||this.network.getSelectionModel().setSelection(g):this.network.getSelectionModel().clearSelection(),Cd.handleClicked(this.network,a,g),this.timer&&clearTimeout(this.timer),this._endTouchTime&&e.getTime()-this._endTouchTime.getTime()<=500&&Tc.getDistance(this._endTouchPoint,f)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Cd.handleDoubleClicked(this.network,a,g),this.timer&&clearTimeout(this.timer)):(this._endTouchTime=e,this._endTouchPoint=f))}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),Ic.network.interaction.MSTouchInteraction=function(a){Ic.network.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},Jc.ext("twaver.network.interaction.MSTouchInteraction",Ic.network.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Wc.addEventListener("MSPointerDown","handleTouchstart",a,this),Wc.addEventListener("MSPointerMove","handleTouchmove",a,this),Wc.addEventListener("MSPointerUp","handleTouchend",a,this),Wc.addEventListener("MSPointerCancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();Wc.removeEventListener("MSPointerDown",a,this),Wc.removeEventListener("MSPointerMove",a,this),Wc.removeEventListener("MSPointerUp",a,this),Wc.removeEventListener("MSPointerCancel",a,this)},handleTouchstart:function(a){if(this.network.isFocusOnClick()&&Ic.Util.setFocus(this.network._view),!this.network.isSelectingElement()||a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.network.getLogicalPoint(a),c=new Date;if(a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length){var d=this.network.getElementAt(b);this._startTouchElement=d,this._startClientPoint={x:a.clientX,y:a.clientY},Cd.handleClicked(this.network,a,d),this._startTouchTime&&this._startTouchPoint&&c.getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,b)<=20?(Cd.handleDoubleClicked(this.network,a,d),this._doubleClick=!0):(Wc.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=c);var e=this.network.getSelectionModel();d?Jc.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d):Jc.isCtrlDown(a)||e.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Tc.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),this.network.isSelectingElement()){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1)}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var e=-1,f=0;f<this._pointerIdArray.length;f++)if(this._pointerIdArray[f]==a.pointerId){e=f;break}e>=0&&this._pointerIdArray.splice(e,1),delete this._pointerMap[a.pointerId]},_getDistance:function(){return Tc.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){if(this._startTouchPoint&&1==this._pointerIdArray.length){if(this._moveTouchPoint={x:this._startTouchPoint.x+(a.clientX-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(a.clientY-this._startClientPoint.y)/this.network.getZoom()},Tc.getDistance(this._startTouchPoint,this._moveTouchPoint)<3)return;if(null==this._startTouchElement&&this.network.isRectSelectEnabled()){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=Wc.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}));var b=Tc.getRect([this._startTouchPoint,this._moveTouchPoint]);Wc.setDiv(this.mark,b,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}else{var c=this.network.getElementAt(this._moveTouchPoint),d=this._moveTouchPoint.x-this._startTouchPoint.x,e=this._moveTouchPoint.y-this._startTouchPoint.y;if(null!=this._startTouchElement||this.network.isRectSelectEnabled())(this.network.isMovingElement()||null!=this._startTouchElement&&c==this._startTouchElement&&this.network.getMovableSelectedElements().contains(c))&&(this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a})));else{this.network.panByOffset(-d,-e)}this._startClientPoint.x=a.clientX,this._startClientPoint.y=a.clientY}}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}}});var Le={_hitCanvas:null,getHitCanvas:function(a,b){null==this._hitCanvas&&(this._hitCanvas=Wc.createCanvas()),0==arguments.length&&(a=2,b=2),this._hitCanvas.setAttribute("width",""+a-1),this._hitCanvas.setAttribute("height",""+b-1),this._hitCanvas.setAttribute("width",""+a),this._hitCanvas.setAttribute("height",""+b);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,a,b),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(a,c,d){c!=b&&(a.fillStyle=c,a.fill()),d!=b&&(a.strokeStyle=d,a.stroke())},text:function(a,b,c,d,e,f){a.textAlign="center",a.textBaseline="middle",null!=e&&(a.fillStyle=e,a.fillText(b,c,d)),f&&(a.strokeStyle=f,a.strokeText(b,c,d))},circle:function(a,b,c,d,e,f){a.arc(b,c,d,0,2*Math.PI,!0),a.closePath(),this.render(a,e,f)},rect:function(a,b,c,d,e,f,g){a.rect(b,c,d,e),a.closePath(),this.render(a,f,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(a,b,c,d,e,f){var g=0;return 0>=e?g|=this.OUT_LEFT|this.OUT_RIGHT:c>a?g|=this.OUT_LEFT:a>c+e&&(g|=this.OUT_RIGHT),0>=f?g|=this.OUT_TOP|this.OUT_BOTTOM:d>b?g|=this.OUT_TOP:b>d+f&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(a,b,c,d,e,f,g,h){var i,j;if(0==(j=this.outcode(c,d,e,f,g,h)))return!0;for(;0!=(i=this.outcode(a,b,e,f,g,h));){if(0!=(i&j))return!1;if(0!=(i&(this.OUT_LEFT|this.OUT_RIGHT))){var k=e;0!=(i&this.OUT_RIGHT)&&(k+=g),b+=(k-a)*(d-b)/(c-a),a=k}else{var l=f;0!=(i&this.OUT_BOTTOM)&&(l+=h),a+=(l-b)*(c-a)/(d-b),b=l}}return!0}};Ic.canvas={},Ic.canvas.interaction={},Ic.canvas.Network=function(a){Ic.canvas.Network.superClass.constructor.apply(this,arguments),this._rootCanvas=Wc.createCanvas(),this._topCanvas=Wc.createCanvas(),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._visibleMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new Ic.List,this._topAttachmentList=new Ic.List,this.setElementBox(a?a:new Ic.ElementBox),Mc||(this._view=Wc.createView("hidden"),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),Qc.isMSToucheable?this.setMSTouchInteractions():Qc.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(Ic.Defaults.NETWORK_TOOLTIP_ENABLED));var b=this;this._flowLink=function(){if(!(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)){b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new Ic.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a);var c=b.getElementUI(a);c.invalidate(!1)})}}},Jc.ext("twaver.canvas.Network",Ic.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","paddingRight","paddingBottom"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable"],_currentSubNetwork:null,_subNetworkAnimate:Ic.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:Ic.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Ic.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Ic.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Ce.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:Ic.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:Ic.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Ic.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Ic.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Ic.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Ic.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:Ic.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Ic.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Ic.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:Ic.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:Ic.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Ic.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Ic.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Ic.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Ic.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:Ic.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Ic.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Ic.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Ic.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Ic.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Ic.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Ic.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:Ic.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Ic.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Ic.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Ic.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Ic.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Ic.Defaults.NETWORK_EDIT_LINE_WIDTH,_rotatePointSize:Ic.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Ic.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Ic.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Ic.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Ic.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Ce.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Ce.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Ce.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Ce.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Ce.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Ce.NETWORK_LINK_FLOW_INTERVAL,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_paddingRight:0,_paddingBottom:0,_transparentSelectionEnable:Ic.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,adjustBounds:function(a){if(Mc)this._rootCanvas=new Lc(a.width,a.height),this._topCanvas=new Lc(a.width,a.height),this.setViewRect(a.x,a.y,a.width,a.height);else{var b=!1,c=this._view.style;if(c.left==a.x+"px"&&c.top==a.y+"px"&&c.width==a.width+"px"&&c.height==a.height+"px"&&(b=!0),Ic.canvas.Network.superClass.adjustBounds.apply(this,arguments),1==b)return;var d=this._view.offsetWidth,e=this._view.offsetHeight;this._rootCanvas.setAttribute("width",d),this._rootCanvas.setAttribute("height",e),this._topCanvas.setAttribute("width",d),this._topCanvas.setAttribute("height",e),this.setViewRect(this.viewRect.x,this.viewRect.y,d,e)}this.invalidateElementVisibility()},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getBackgroundImage:function(){return this._backgroundImage},setBackgroundImage:function(a){if(this._backgroundImage!=a){var b=this._backgroundImage;this._backgroundImage=a;var c=this._backgroundImage;if(c&&!c._viewRect)if(c.width>0)c._viewRect={x:0,y:0,width:c.width,height:c.height},this.validateCanvasSize(),this.firePropertyChange("backgroundImage",b,c);else{var d=this;c.onload=function(){c._viewRect={x:0,y:0,width:c.width,height:c.height},d.validateCanvasSize(),d.firePropertyChange("backgroundImage",b,c),c.onload=null}}else this.firePropertyChange("backgroundImage",b,c),this.validateCanvasSize()}},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){if(!Mc&&od.twm(this),1==this._invalidateElementVisibility){this._invalidateElementVisibility=!1;var a,b,c,d=this.getElementBox().getDatas()._as,e=d.length,f={},g=this._visibleFunction,h=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(a=0;e>a;a++)b=d[a],f[b._id]=this.isVisible(b,g,h);if(this._visibleMap)for(a=0;e>a;a++)b=d[a],f[b._id]!==this._visibleMap[b._id]&&(c=this._elementUIMap[b._id],c&&c.invalidate());for(a=0;e>a;a++)b=d[a],c=this._elementUIMap[b._id],c&&c.validate();this._visibleMap=f,this.paintRoot()}this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Ic.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",b,this._box)}},handleElementBoxChange:function(a){var b=a.data;if("add"===a.kind)this.createElementUI(b),this.invalidateBundleLink(b);else if("remove"===a.kind){var c=this.getElementUI(b);c&&delete this._elementUIMap[b.getId()],b===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else"clear"===a.kind&&(this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);c&&c.handlePropertyChange(a),this.invalidateBundleLink(b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){"editable"===a.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this);var b=this.getSelectionModel().getLastData();b&&("append"===a.kind||"set"===a.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b)),this.invalidateElementVisibility()},sendToTop:function(a){if(this._box.contains(a)){for(var b=a;b._parent&&this.isVisible(b._parent)&&(b=b._parent););b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)}},getViewRect:function(){return this.viewRect?Jc.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(a,b){var c=this.viewRect.x,d=this.viewRect.y,e=this.viewRect.width,f=this.viewRect.height;this.setViewRect(c+a,d+b,e,f)},setViewRect:function(a,b,c,d){1==this.isLimitViewInCanvas()&&(0>a&&(a=0),c>this.realWidth?a=0:a+c>this.realWidth&&(a=this.realWidth-c),0>b&&(b=0),d>this.realHeight?b=0:b+d>this.realHeight&&(b=this.realHeight-d));var e=this.viewRect;(null==this.viewRect||a!=this.viewRect.x||b!=this.viewRect.y||c!=this.viewRect.width||d!=this.viewRect.height)&&(this.viewRect={x:a,y:b,width:c,height:d},this.firePropertyChange("viewRect",e,this.viewRect),this.invalidateElementVisibility())},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},dispose:function(){for(var a in this._elementUIMap){var b=this._elementUIMap[a];b.curInterval&&clearTimeout(b.curInterval)}},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(!this.isMovingElement()){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var a=this.getElementBox().getDatas(),b=a.size();if(b>0){for(var c={x:0,y:0,width:0,height:0},d=0;b>d;d++){var e=a.get(d);if(this._visibleMap[e._id]){var f=this._elementUIMap[e._id];f&&(c=Tc.unionRect(c,f._viewRect))}}var g=this.getBackgroundImage();if(g&&(c=Tc.unionRect(c,g._viewRect)),c.x<0&&(c.width+=c.x,c.x=0),c.y<0&&(c.height+=c.y,c.y=0),this.realWidth==(c.x+c.width)*this.getZoom()&&this.realHeight==(c.y+c.height)*this.getZoom())return;var h=this.getZoom();this.realWidth=(c.x+c.width)*h+this._paddingRight,this.realHeight=(c.y+c.height)*h+this._paddingBottom,this._unionBounds={x:c.x*h,y:c.y*h,width:c.width*h+this._paddingRight,height:c.height*h+this._paddingRight}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)}},getElementUI:function(a){return null==a?null:this._elementUIMap[a._id]},createElementUI:function(a){var b=this._elementUIMap[a.getId()];b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b))},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==a){var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},invalidateBundleLink:function(a){if(a instanceof Ic.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},paintRoot:function(){var a=this._rootCanvas.getContext("2d");if(a.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new Ic.List,this._topAttachmentList=new Ic.List,null!=this.getElementBox()){le.draw(a,this);var c=this.getElementBox().getDatas()._as,d=c.length;a.save(),a.scale(this.getZoom(),this.getZoom()),a.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom()),this.paintBottom(a);var e={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},f=this.getBackgroundImage(),g=this.getBackgroundImageRect();if(f instanceof Pc&&(g?a.drawImage(f,g.x,g.y,g.width,g.height):a.drawImage(f,0,0,f.width,f.height),f._viewRect={x:0,y:0,width:f.width,height:f.height}),"string"==typeof f){var h=Jc.getImageAsset(f),i={x:0,y:0,width:h.getWidth(),height:h.getHeight()};Nd(a,f,null,i,null,this)}var j,k,l,m,n=this._box._layerBox;if(1===n.size())for(j=0;d>j;j++)k=c[j],this._visibleMap[k._id]&&(l=this._elementUIMap[k._id],null!=l&&this._isInView(l,e)&&(l.paint(a),this.visibleList.add(k)));else n.forEachByDepthFirst(function(b){for(j=0;d>j;j++)k=c[j],n.getLayerByElement(k)===b&&this._visibleMap[k._id]&&(l=this._elementUIMap[k._id],null!=l&&this._isInView(l,e)&&(l.paint(a),this.visibleList.add(k)))},null,this);for(d=this._topAttachmentList.size(),j=0;d>j;j++)m=this._topAttachmentList.get(j),m.getElementUI().paintAttachment(a,m);if(this._xyz){var d,o=this._xyz,p=o.markText,q=o.type,r=(o.expired,o.innerHTML),s=0,t=0,u=this.viewRect;a.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),a.scale(1/this.getZoom(),1/this.getZoom());{this.getZoom()}p!=b&&null!=p&&""!=p||"2"==q?(a.font="15px Arial sans-serif",d=Jc.g.getTextSize(a.font,r),a.fillStyle="red",s=u.width-d.width,t=u.height-20):(a.font="10px Arial sans-serif",d=Jc.g.getTextSize(a.font,r),s=u.width/2-d.width/2,t=u.height/2),a.fillText(r,s,t)}a.restore()}},paintBottom:function(){},_isInView:function(a,b){return Tc.intersects(b,a._viewRect)},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(a){for(var b=this.markerList.size(),c=0;b>c;c++){var d=this.markerList.get(c);d.paint(a)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint:function(a){var b;if(Qc.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=this._view.getBoundingClientRect(),d=a.changedTouches[0],e=Qc.isAndroid?0:zd.scrollLeft(),f=Qc.isAndroid?0:zd.scrollTop();return b={x:(d.clientX+this.viewRect.x-c.left-e)/this._zoom,y:(d.clientY+this.viewRect.y-c.top-f)/this._zoom}}return b=Qc.isFirefox?{x:(a.layerX+this.viewRect.x)/this.getZoom(),y:(a.layerY+this.viewRect.y)/this.getZoom()}:{x:(a.offsetX+this.viewRect.x)/this.getZoom(),y:(a.offsetY+this.viewRect.y)/this.getZoom()}},getElementAt:function(a,b){if(null==this.visibleList)return null;1===arguments.length&&(b=!0);var c,d;if(c=a.target?this.getLogicalPoint(a):a,null!=this._topAttachmentList)for(var e=this._topAttachmentList.size(),f=e-1;f>=0;f--){var g=this._topAttachmentList.get(f);if(d=g.getElement(),(!b||this.isSelectable(d))&&g.hit(c.x,c.y))return d}if(null!=this.visibleList)for(var h=this.visibleList.size(),i=h-1;i>=0;i--){var j=this.visibleList.get(i),k=this.getElementUI(j);if((!b||this.isSelectable(j))&&k&&k.hit(c.x,c.y))return j}return null},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);if(!c)return null;var d;return d=a.target?this.getLogicalPoint(a):a,c.hitTest(d.x,d.y)},getElementsAtRect:function(a,c,d,e){var f=new Ic.List;if(null==this.visibleList)return f;e=e===b?!0:e;for(var g=this.visibleList.size(),h=g-1;h>=0;h--){var i=this.visibleList.get(h),j=this.getElementUI(i);j&&(!d||d(j._element))&&(e&&this.isSelectable(j._element)||!e)&&(c?j.intersects(a)&&f.add(i):Tc.contains(a,j.getViewRect())&&f.add(i))}return f},getPosition:function(a,b,c,d,e){var f,g=b instanceof Ic.canvas.ElementUI?b:this.getElementUI(b);if(g)if("from"===a||"to"===a){if(g.getFromPosition&&(f="from"===a?g.getFromPosition(d,e):g.getToPosition(d,e)))return{x:f.x-c.width/2,y:f.y-c.height/2}}else f="hotspot"===a?g.getHotSpot():Vc.get(a,g.getBodyRect(),c);if(!f&&b.getRect&&(f=Vc.get(a,b.getRect(),c)),f)return{x:f.x+d,y:f.y+e};throw"position '"+a+"' object '"+b+"'"},isValidEvent:function(a){if(!a)return!1;var b,c;if(a.currentTarget===this._view){if(Qc.isFirefox?(b=a.layerX,c=a.layerY):(b=a.offsetX,c=a.offsetY),1==this.isHScrollBarVisible()&&c>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&b>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)?a instanceof Ic.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){for(var a=this.getSelectionModel().getSelection(),b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(a,b,c,d){if(0!==a||0!==b){var e=this.getMovableSelectedElementsRect();null!=e&&(this._limitElementInPositiveLocation&&(e.x+a<0&&(a=-e.x),e.y+b<0&&(b=-e.y)),Ic.Util.moveElements(this.getMovableSelectedElements(),a,b,c,d,this))}},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(0===a.size())return null;for(var b=null,c=0,d=a.size();d>c;c++){var e=a.get(c);if(e instanceof Je){var f=this.getElementUI(e);f&&(b=Tc.unionRect(b,f.getViewRect()))}}return b},isVisible:function(a,b,c){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(3!==arguments.length&&(b=this._visibleFunction),b&&!b(a))return!1;if(!(c||this._box._layerBox.getLayerByElement(a))._visible)return!1;if(vd.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof Ic.Link){if(!this._noAgentLinkVisible){if(!a._fromAgent||!a._toAgent)return!1;if(!this.isVisible(a._fromAgent,b,c)||!this.isVisible(a._toAgent,b,c))return!1
}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else for(var d=a._parent;d&&!d.ISubNetwork;){if(d instanceof Ic.Group&&(!d.isExpanded()||!this.isVisible(d,b,c)))return!1;d=d._parent}return a.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a){return null==this._linkableFunction||this._linkableFunction(a)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&"shadow"===a.getStyle("select.style")?a.getStyle("select.color"):b},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a){this.setInteractions([new Ic.canvas.interaction.DefaultInteraction(this),new Ic.canvas.interaction.SelectInteraction(this),new Ic.canvas.interaction.MoveInteraction(this,a),new Ic.canvas.interaction.ScrollInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new Ic.canvas.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new Ic.canvas.interaction.ScrollInteraction(this),new Ic.canvas.interaction.MSTouchInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new Ic.canvas.interaction.DefaultInteraction(this),new Ic.canvas.interaction.SelectInteraction(this),new Ic.canvas.interaction.EditInteraction(this,a),new Ic.canvas.interaction.MoveInteraction(this,a),new Ic.canvas.interaction.ScrollInteraction(this)])},setCreateElementInteractions:function(a){this.setInteractions([new Ic.canvas.interaction.DefaultInteraction(this),new Ic.canvas.interaction.CreateElementInteraction(this,a)])},setCreateLinkInteractions:function(a){this.setInteractions([new Ic.canvas.interaction.DefaultInteraction(this),new Ic.canvas.interaction.CreateLinkInteraction(this,a),new Ic.canvas.interaction.ScrollInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new Ic.canvas.interaction.DefaultInteraction(this),new Ic.canvas.interaction.CreateShapeLinkInteraction(this,a),new Ic.canvas.interaction.ScrollInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new Ic.canvas.interaction.DefaultInteraction(this),new Ic.canvas.interaction.CreateShapeNodeInteraction(this,a),new Ic.canvas.interaction.ScrollInteraction(this)])},setPanInteractions:function(){this.setInteractions([new Ic.canvas.interaction.DefaultInteraction(this),new Ic.canvas.interaction.PanInteraction(this),new Ic.canvas.interaction.ScrollInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Ic.canvas.interaction.DefaultInteraction(this),new Ic.canvas.interaction.SelectInteraction(this),new Ic.canvas.interaction.MoveInteraction(this),new Ic.canvas.interaction.ScrollInteraction(this),new Ic.canvas.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(a){if(a){var b=a.getToolTip();return b?b:a.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){if(this._toolTipEnabled=a,a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){if(b.isMovingElement())return void Bd.hideToolTip();var c=b.getElementAt(a);if(b._preElement!==c)if(b._preElement=c,c){var d=b.getToolTip(c);Bd.showToolTip({x:a.pageX,y:a.pageY},d);var e=Bd.getToolTipDiv(),e=Bd.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(Oc.documentElement.scrollLeft||Oc.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(Oc.documentElement.scrollTop||Oc.body.scrollTop)+"px")}}else Bd.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Bd.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(a){a=this.checkZoom(a);var b=this._zoom;if(this._zoom!=a){var c={x:(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*a,y:(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*a};this._zoom=a,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(c.x-this.viewRect.width/2,c.y-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",b,this._zoom)}},getZoom:function(){return this._zoom},setTouchZoom:function(a){this.setZoom(a,!1)},zoomOverview:function(){if(!(this.realWidth<=0||this.realHeight<=0)){var a=this.realWidth/this.getZoom(),b=this.realHeight/this.getZoom(),c=this.viewRect.width/a,d=this.viewRect.height/b,e=Math.min(c,d);this.setZoom(e)}},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(1.2*this.getZoom())},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(vd.getSubNetwork(this._currentSubNetwork),a,b)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,c){if(Ic.animate.AnimateManager.endAnimate(),b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var d=new Ic.animate.AnimateSubNetwork(this,a,c);Ic.animate.AnimateManager.start(d)}else this._setCurrentSubNetwork(a),c&&c()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork!==a){if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility(),this.invalidateCanvasSize()}},makeVisible:function(a){var b=this.getElementUI(a);if(b){var c=vd.getSubNetwork(a);if(c!==this._currentSubNetwork){var d=this;return void this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){Jc.callLater(d.makeVisible,d,[a])})}for(var e=a;(e=e.getParent())&&e!==c;)e instanceof Ic.Group&&e.setExpanded(!0);var f=b.getViewRect();if(f){var g={x:f.x*this.getZoom(),y:f.y*this.getZoom(),width:f.width*this.getZoom(),height:f.height*this.getZoom()};Tc.intersects(this.viewRect,g)||this.isVisible(a)&&Jc.callLater(this.centerByLogicalPoint,this,[g.x+g.width/2,g.y+g.height/2])}}},centerByLogicalPoint:function(a,b){var c=a-this.viewRect.width/2,d=b-this.viewRect.height/2;this.setViewRect(c,d,this.viewRect.width,this.viewRect.height)},panByOffset:function(a,b){this.setViewOffSet(a,b)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Ce.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c){c||(c=Wc.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var d=c.getContext("2d");if(d.clearRect(0,0,a,b),le.draw(d,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;var e=a/this.realWidth*this._zoom,f=b/this.realHeight*this._zoom;d.scale(e,f);var g=this.getBackgroundImage();if(g&&g._viewRect){var h=g._viewRect;try{d.drawImage(g,h.x,h.y,h.width,h.height)}catch(i){}}var j=this.getElementBox().getDatas()._as,k=j.length;this._topAttachmentList=new Ic.List;var l,m,n,o,p,q,r=this.getElementBox().getLayerBox(),s=r.getRoots(),t=s.size();if(1===t)for(n=0;k>n;n++)o=j[n],this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],null!=p&&p.paint(d));else for(l=0;t>l;l++)for(m=s.get(l),n=0;k>n;n++)o=j[n],r.getLayerByElement(o)===m&&this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],null!=p&&p.paint(d));for(k=this._topAttachmentList.size(),n=0;k>n;n++)q=this._topAttachmentList.get(n),q.getElementUI().paintAttachment(d,q);return c},toCanvasByRegion:function(a,b,c){c||(c=Wc.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e),c._viewRect?(c._viewRect.width=d,c._viewRect.height=e):c._viewRect={x:0,y:0,width:d,height:e};var f=c.getContext("2d");if(f.clearRect(0,0,d,e),le.draw(f,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;f.save(),f.scale(b,b),f.beginPath(),f.translate(-a.x,-a.y);var g=this.getElementBox().getDatas()._as,h=g.length;this._topAttachmentList=new Ic.List;var i=this.getBackgroundImage();if(i&&i._viewRect&&Tc.intersects(a,i._viewRect)){var a=Tc.intersection(a,i._viewRect),j=i._viewRect;try{f.drawImage(i,j.x,j.y,j.width,j.height)}catch(k){}}var l,m,n,o,p,q,r=this.getElementBox().getLayerBox(),s=r.getRoots(),t=s.size();if(1===t)for(n=0;h>n;n++)o=g[n],this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],null!=p&&Tc.intersects(a,p._viewRect)&&p.paint(f));else for(l=0;t>l;l++)for(m=s.get(l),n=0;h>n;n++)o=g[n],r.getLayerByElement(o)===m&&this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],null!=p&&Tc.intersects(a,p._viewRect)&&p.paint(f));for(h=this._topAttachmentList.size(),n=0;h>n;n++)q=this._topAttachmentList.get(n),q.getElementUI().paintAttachment(f,q);return f.restore(),c},getGroupChildrenRects:function(a){var b=new me;return a.getChildren().forEach(function(a){if(a instanceof Je){var c=this.getElementUI(a);if(c){var d=c.getViewRect();d&&b.add(d)}}},this),b},getBackgroundImageRect:function(){return null},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},onClickElement:function(){},onClickBackground:function(){},onDoubleClickElement:function(){},onDoubleClickBackground:function(){},onLongClickElement:function(){},onLongClickBackground:function(){},onMouseMove:function(){},onMouseEnter:function(){},onMouseLeave:function(){}}),Ic.canvas.Overview=function(a){Ic.canvas.Overview.superClass.constructor.apply(this,a),this._view=Wc.createView(),this._rootDiv=Wc.createDiv(),this._imageCanvas=Wc.createCanvas(),this._imageDiv=Wc.createDiv(),this._maskCanvas=Wc.createCanvas(),this._selectDiv=Wc.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,Wc.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(a);var b;b=Qc.isMSToucheable?Ic.canvas.OverviewMSTouchInteraction:Qc.isTouchable?Ic.canvas.OverviewTouchInteraction:Ic.canvas.OverviewInteraction,b&&new b(this)},Jc.ext("twaver.canvas.Overview",Ic.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Ce.OVERVIEW_FILL_COLOR,_outlineColor:Ce.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Ce.OVERVIEW_OUTLINE_WIDTH,_selectColor:Ce.OVERVIEW_SELECT_COLOR,_selectWidth:Ce.OVERVIEW_SELECT_WIDTH,_padding:Ce.OVERVIEW_PADDING,_animate:Ce.OVERVIEW_ANIMATE,_maxPackingWidth:Ce.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Ce.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(){this._invalidateMask()},setNetwork:function(a){a!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),Wc.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),Wc.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(a){("zoom"===a.property||"currentSubNetwork"===a.property||"elementBox"===a.property||"dataBox"===a.property||"canvasSizeChange"===a.property)&&this.invalidate()},_handleNetworkViewChange:function(a){"validateEnd"===a.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Jc.callLater(this.validate,this,null,a))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Jc.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var a,b=this._maxPackingWidth>0&&this._maxPackingHeight>0;a=b?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Tc.grow(a,-this._padding,-this._padding);var c=Math.min(a.width/this._network.getCanvasSize().width,a.height/this._network.getCanvasSize().height);b&&(Wc.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),a.width=this._imageDiv._viewRect.width,a.height=this._imageDiv._viewRect.height);var d=this._network.getCanvasSize().width*c,e=this._network.getCanvasSize().height*c,f=a.x+(a.width-d)/2,g=a.y+(a.height-e)/2;if(this._isNetworkDirty){var h={x:f,y:g,width:d,height:e};this._network.toCanvas(h.width,h.height,this._imageCanvas),Wc.setDiv(this._imageDiv,h,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var i={x:this._network.getViewRect().x*c,y:this._network.getViewRect().y*c,width:d*this._network._view.clientWidth/this._network.getCanvasSize().width,height:e*this._network._view.clientHeight/this._network.getCanvasSize().height};i.x=i.x<0?0:i.x,i.y=i.y<0?0:i.y;var j=Wc.setCanvas(this._maskCanvas,f,g,d,e);j.lineWidth=0,j.fillStyle=this._fillColor,j.beginPath(),Xc.drawVector(j,"rectangle",null,f,g,d,e),j.fill(),j.clearRect(f+i.x,g+i.y,i.width,i.height);var k=this._outlineWidth<0?0:this._outlineWidth;j.lineWidth=k,j.strokeStyle=this._outlineColor;var l=i.width-2*k,m=i.height-2*k;l=Math.min(l,d-2-i.x-this._outlineWidth),m=Math.min(m,e-2-i.y-this._outlineWidth),j.beginPath(),Xc.drawVector(j,"rectangle",null,f+i.x+k,g+i.y+k,l,m),k>=0&&j.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return Wc.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;Tc.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network.getCanvasSize().width,(a.y-c.y)/c.height*this._network.getCanvasSize().height,b),this._invalidateMask())}}),Ic.canvas.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Wc.addEventListener("touchstart","handleTouchstart",this.view,this)},Jc.ext("twaver.canvas.OverviewTouchInteraction",Object,{handleTouchstart:function(a){Wc.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),zd.isMultiTouch(a)&&(this.distance=zd.getDistance(a),this.zoom=this.network.getZoom()),Wc.addEventListener("touchmove","handleTouchmove",this.view,this),Wc.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a),zd.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=zd.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?Jc.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,Wc.removeEventListener("touchmove",this.view,this),Wc.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Ic.canvas.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[];var b=this;this.view.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.view.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.view.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.view.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1)},Jc.ext("twaver.canvas.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){Wc.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Tc.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(null==c)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Tc.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?Jc.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Tc.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Ic.canvas.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Wc.addEventListener("mousedown","handleMousedown",this.view,this)},Jc.ext("twaver.canvas.OverviewInteraction",Object,{handleMousedown:function(a){0===a.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Jc.isCtrlDown(a)&&(this.startPoint=this.endPoint,Wc.setVisible(this.overview._selectDiv,!0)),Wc.addEventListener("mousemove","handleMousemove",this.view,this),Wc.addEventListener("mouseup","handleMouseup",this.view,this))},handleMouseup:function(a){if(this.endPoint=this.overview.getLogicalPoint(a),"detail"in a&&2===a.detail)Jc.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(Wc.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,d=this.overview._selectDiv._viewRect.y,e=b.width/this.overview._selectDiv._viewRect.width,f=b.height/this.overview._selectDiv._viewRect.height,g=Math.min(e,f);this.network.setZoom(g*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var h=this.network.getCanvasSize().width*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),i=this.network.getCanvasSize().height*((d-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);Jc.callLater(this.network.centerByLogicalPoint,this.network,[h,i,this.overview._animate]),Wc.setVisible(this.overview._selectDiv,!1),Wc.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);if(this.endPoint=b,Wc.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),Wc.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,Wc.removeEventListener("mousemove",this.view,this),Wc.removeEventListener("mouseup",this.view,this))}}),Ic.canvas.ElementUI=function(a,b){this._network=a,this._element=b,this._attachments=new Ic.List,this._bodyBounds=new Ic.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Jc.ext("twaver.canvas.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(){this.invalidate(!0)},handleSelectionChange:function(){this.invalidate(!0)},invalidate:function(a){a===b&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(a){a.validate()});var a;this._bodyBounds.forEach(function(b){a=Tc.unionRect(a,b)}),this._unionBodyBounds=Jc.clone(a),this._attachments.forEach(function(b){a=Tc.unionRect(a,b.getViewRect())}),this._viewRect=a}},validateImpl:function(){},setShadow:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return b.shadowOffsetX===this._shadowXOffset&&b.shadowOffsetY===this._shadowYOffset&&b.shadowBlur===this._shadowBlur?b:(c&&(b.shadowOffsetX=this._shadowXOffset,b.shadowOffsetY=this._shadowYOffset,b.shadowBlur=this._shadowBlur,b.shadowColor=this._shadowColor),b)},clearShadow:function(a){(0!=a.shadowOffsetX||0!=a.shadowOffsetY||0!=a.shadowBlur)&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return c&&(this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset),Tc.grow(b,this._shadowBlur,this._shadowBlur)),b},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},addAttachment:function(a){this._attachments.add(a)},removeAttachment:function(a){this._attachments.remove(a)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);null!=a&&""!==a?this._labelAttachment||(this._labelAttachment=new Ic.canvas.LabelAttachment(this,Ce.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);null!=a&&""!==a?this._alarmAttachment||(this._alarmAttachment=new Ic.canvas.AlarmAttachment(this,Ce.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new Ic.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new Ic.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:Ic.Defaults.FONT},paint:function(a){a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore()},paintBody:function(){},paintAttachments:function(a){a.beginPath();for(var b=this._attachments.size(),c=0;b>c;c++){var d=this._attachments.get(c);1==this._hitTest&&0==d.isShowOnTop()&&this.paintAttachment(a,d),1==this._intersectTest&&this.paintAttachment(a,d),0==this._hitTest&&0==this._intersectTest&&(d.isShowOnTop()?this._network._topAttachmentList.add(d):this.paintAttachment(a,d))}},paintAttachment:function(a,b){a.beginPath(),b.paint(a),this.clearShadow(a)},getViewRect:function(){return Jc.clone(this._viewRect)},getUnionBodyBounds:function(){return Jc.clone(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Jc.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?Jc.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(){return!1},intersects:function(a){return Tc.contains(a,this.getViewRect())?!0:!1},hitCanvasRectAtBody:function(a){var b=Le.getHitCanvas(a.width,a.height),c=Le.getCtx(b);if(c.save(),c.translate(-a.x,-a.y),this._element.getImage){var d=Jc.getImageAsset(this._element.getImage());if(d&&d.getImage()instanceof Fe)return 1}this.paintBody(c);try{for(var e=c.getImageData(0,0,a.width,a.height),f=e.data,g=0;g<e.width;g++)for(var h=0;h<e.height;h++){var i=4*(h*e.width+g),j=f[i+3];if(0!==j)return c.restore(),1}}catch(k){if(Le.disposeHitCanvas(),Tc.contains(this.getUnionBodyBounds(),a))return 0}return c.restore(),-1},hitCanvasRectAtAttachments:function(a){var b=Le.getHitCanvas(a.width,a.height),c=Le.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintAttachments(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),1}}catch(j){Le.disposeHitCanvas()}return c.restore(),-1},hitCanvasRect:function(a){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var b=Tc.intersection(a,this._viewRect),c=this.hitCanvasRectAtBody(b);if(1==c)return this._intersectTest=!1,!0;var d=this.hitCanvasRectAtAttachments(b);return 1==d?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==c)},hitCanvasPoint:function(a,b){if(!Tc.containsPoint(this._viewRect,a,b))return!1;this._hitTest=!0;var c=this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2});return this._hitTest=!1,c},hitTest:function(a,b){if(!Tc.containsPoint(this._viewRect,a,b))return null;var c={x:a-1,y:b-1,width:2,height:2},d=Tc.intersection(c,this._viewRect),e=this.hitCanvasRectAtBody(d);if(1==e)return this;for(var f=this._attachments.size(),g=0;f>g;g++){var h=this._attachments.get(g);if(h.hit(a,b))return h}return 0==e?this:null}}),Ic.canvas.NodeUI=function(a,b){Ic.canvas.NodeUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.NodeUI",Ic.canvas.ElementUI,{invalidate:function(a){Ic.canvas.NodeUI.superClass.invalidate.call(this,a),this.curInterval&&clearInterval(this.curInterval);
var b=this._element.getAgentLinks();b&&b.forEach(function(a){this._network.invalidateElementUI(a,!1)},this);var c=this._element.getParent();c instanceof Ic.Group&&this._network.invalidateElementUI(c,!1)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){Ic.canvas.NodeUI.superClass.validateImpl.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=Tc.getHotSpot(b.x,b.y,b.width,b.height,a),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&Ic.canvas.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var a=this.getStyle("body.type");"default"===a?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===a?this.addBodyBounds(this.getVectorBody()):"default.vector"===a?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===a&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var a=this._element,b=Jc.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return c;Tc.addPadding(c,this._element,"image.padding",1),this._defaultRect=c;var d=Jc.clone(c);return this.appendShadowBound(this,d),c=d},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(a){var b=this._element,c=b.getStyle(a+".width");if(c>0){var d=this.getBodyRect();Tc.addPadding(d,b,a+".padding",1);var e=Jc.clone(d);return Tc.grow(e,c/2,c/2),e}return null},getPathRect:function(a,b){var c=this._element,d=this.getBodyRect();b&&Tc.addPadding(d,c,a+".padding",1);var e=Jc.clone(d),f=c.getStyle(a+".outline.width");return f>0&&Tc.grow(e,f/2,f/2),this.appendShadowBound(this,e),e},paintBody:function(a){this.curInterval&&clearInterval(this.curInterval);var b=this.getStyle("body.type");"default"===b?this.drawDefaultBody(a):"vector"===b?this.drawVectorBody(a):"default.vector"===b?(this.drawVectorBody(a),this.drawDefaultBody(a)):"vector.default"===b&&(this.drawDefaultBody(a),this.drawVectorBody(a)),this._outerColor&&this.drawOuterBorder(a),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(a)},drawOuterBorder:function(a){var b=this._element,c=b.getStyle("outer.width");if(c>0){var d=this.getBodyRect();Tc.addPadding(d,b,"outer.padding",1),a.lineWidth=c,a.lineCap=b.getStyle("outer.cap"),a.lineJoin=b.getStyle("outer.join"),a.strokeStyle=this._outerColor,Xc.drawVector(a,b.getStyle("outer.shape"),null,d),a.stroke()}},drawDefaultBody:function(a){var b=this._element,c=Jc.getImageAsset(b.getImage()),d=this._defaultRect;if(c&&c.getImage()){0!=b.getAngle()&&(a.save(),d=b.getOriginalRect(),Ic.Util.rotateCanvas(a,d,b.getAngle())),this.setShadow(this,a);if(c.getImage()instanceof Fe){var e,f=c.getImage().frames,g=c.getImage().size,h=0;e=He(f,g,0),a.drawImage(e,d.x,d.y,d.width,d.height),this.curInterval=setInterval(function(){h=(h+f.length)%f.length,e=He(f,g,h),a.drawImage(e,d.x,d.y,d.width,d.height),h++},100)}else Nd(a,b.getImage(),this.getInnerColor(),d,b,this._network);0!=b.getAngle()&&a.restore()}},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getBodyRect();Tc.addPadding(d,b,"select.padding",1);var e=Jc.clone(d);Tc.grow(e,c/2,c/2),a.lineWidth=c,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),Xc.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}},drawVectorBody:function(a){this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color"),d=this.getBodyRect();if(0!==b&&c){var e=this._element.getAngle();0!=e&&(a.save(),d=this._element.getOriginalRect(),Ic.Util.rotateCanvas(a,d,e)),"rectangle"===this.getStyle("vector.shape")&&Xc.draw3DRect(a,c,b,d),0!=e&&a.restore()}},drawPath:function(a,b,c,d,e,f,g){var h=this._element,i=this.getBodyRect();c&&Tc.addPadding(i,h,b+".padding",1);var j=h.getStyle(b+".outline.width");this.setShadow(this,a),0!=h.getAngle()&&(h instanceof Ke||(i=h.getOriginalRect()),a.save(),Ic.Util.rotateCanvas(a,i,h.getAngle()));var k,l=h.getStyle(b+".fill");if(l){k=this._innerColor&&!vd.hasDefault(this._element)?this._innerColor:h.getStyle(b+".fill.color");var m=h.getStyle(b+".gradient");m?Xc.fill(a,k,m,h.getStyle(b+".gradient.color"),i):a.fillStyle=k}var n=h.getStyle(b+".shape");l&&(a.beginPath(),e?Xc.drawLinePoints(a,e,null,f,g):Xc.drawVector(a,n,null,i),a.fill()),j>0&&(a.lineWidth=j,a.lineCap=h.getStyle(b+".cap"),a.lineJoin=h.getStyle(b+".join"),a.strokeStyle=h.getStyle(b+".outline.color"),a.beginPath(),e?Xc.drawLinePoints(a,e,d,f,g):Xc.drawVector(a,n,d,i),a.stroke()),0!=h.getAngle()&&a.restore()},hit:function(a,b){if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Jc.math.containsPoint(c,a,b))return!0}return Tc.containsPoint(this.getViewRect(),a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Ic.canvas.NodeUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Jc.math.intersects(c,a))return!0}return Tc.intersects(a,this.getViewRect())?this.hitCanvasRect(a):!1}}),Ic.canvas.LinkUI=function(a,b){Ic.canvas.LinkUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.LinkUI",Ic.canvas.ElementUI,{isEditable:function(){return xd.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,Ic.canvas.LinkUI.superClass.invalidate.call(this,a)},validateImpl:function(){this.validateBodyBounds(),Ic.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var a=this.getLinkPoints();if(a&&!(a.size()<2)){var b=this._element,c=Tc.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===b.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=2*h}Tc.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(c=Tc.unionRect(c,ne.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(c=Tc.unionRect(c,ne.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset")))),this.appendShadowBound(this,c),this.addBodyBounds(c)}},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(a){var b=this._linkPoints;if(b&&!(b.size()<2)){var c=this._element,d=c.getStyle("link.width"),e=d;if(this._outerColor){var f=c.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===c.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=c.getStyle("select.width");e+=2*h}this.setShadow(this,a),a.lineCap=c.getStyle("link.cap"),a.lineJoin=c.getStyle("link.join");var i=c.getStyle("link.pattern");g&&this.drawLinePoints(a,b,e,c.getStyle("select.color"),i),this._outerColor&&this.drawLinePoints(a,b,d+2*f,this._outerColor,i),this.drawLinePoints(a,b,d,this._innerColor||c.getStyle("link.color"),i),ne.drawLinkArrow(this,a,b)}},drawLinePoints:function(a,b,c,d,e){if(a.lineWidth=c,a.strokeStyle=d,this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new ud(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset"),h=Math.floor(g/(e[0]+e[1]));h>2&&(g-=(e[0]+e[1])*h),this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),Xc._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var i=this._element.getStyle("link.flow.color");i=i?i:Ce.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=i,Xc._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),Xc.drawLinePoints(a,b,e),a.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Tc.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=xd.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=xd.createToPoint(this)),this._toPoint},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=this.getStyle("link.type"),d=new Ic.List;if(xd.isOrthogonalOrFlexionalLink(this._element))d=xd.orthogonalAndFlexional(this,c);else if(this._element.isLooped()){var e=this._network.getElementUI(this._element.getFromAgent());null!=e&&(this._hotSpot=xd.fillLoopedPoints(this,e.getBodyRect(),d))}else{if("arc"!==c&&"triangle"!==c&&"parallel"!==c)throw"Can not resolve link type '"+c+"'";this._hotSpot=xd.fillBundlePoints(this,c,a,b,d)}if(this._network._linkPathFunction){var f=this._network._linkPathFunction(this,d);f&&(d=f)}return d},checkAttachments:function(){Ic.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);null!=a&&""!==a?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Ic.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return xd.getControlPoint(this._element,this)},setControlPoint:function(a){if(a){var b=this.getStyle("link.type");if(xd.hasControlPoint(b)){var c=xd.getLinkSourceBounds(this),d=xd.getLinkTargetBounds(this);xd.setParamsByControlPoint(a,c,d,b,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(a,b){return Tc.containsPoint(this.getViewRect(),a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Ic.canvas.LinkUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(0==Tc.intersects(a,this.getViewRect()))return!1;var c=this.getLinkPoints(),d=c.size();if(2==d)for(var e=0;d>e;e+=2){var f=c.get(e);if(d>e+1){var g=c.get(e+1);if(Le.intersectsLine(f.x,f.y,g.x,g.y,a.x,a.y,a.width,a.height))return!0}}return this.hitCanvasRect(a)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Tc.getAngle(this._fromPoint,this._toPoint)),this._angle||0}}),Ic.canvas.GroupUI=function(a,b){Ic.canvas.GroupUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.GroupUI",Ic.canvas.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(a){this._shapeRect?this.drawExpandedGroup(a):Ic.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect("group",!1)):Ic.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(a){this.drawPath(a,"group",!1,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");0!==b&&c&&"rectangle"===this.getStyle("group.shape")&&Xc.draw3DRect(a,c,b,this._bodyRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element,b=this._network;if(a.isExpanded()){a.getChildren().forEach(function(a){var c=b.getElementUI(a);c&&c.validate()});var c=this.getChildrenRects();if(!c.isEmpty()){var d=a.getStyle("group.shape"),e=Uc[d];if(!e)throw"Can not resolve group shape '"+d+"'";this._shapeRect=e(c)}}return this._shapeRect?(Tc.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):Ic.canvas.GroupUI.superClass.createBodyRect.call(this)}}),Ic.canvas.ShapeNodeUI=function(a,b){Ic.canvas.ShapeNodeUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.ShapeNodeUI",Ic.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect("vector",!0)},drawDefaultBody:function(a){this._element._points.size()<2||(this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed")),ne.drawLinkArrow(this,a,Tc.getPointObject(this._element._points,this._element._segments)))},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getBodyRect();Tc.addPadding(d,b,"select.padding",1),Tc.grow(d,c/2,c/2);var e=b.getStyle("vector.outline.width");e>0&&Tc.grow(d,e/2,e/2),a.lineWidth=c,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),Xc.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}}}),Ic.canvas.ShapeLinkUI=function(a,b){Ic.canvas.ShapeLinkUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.ShapeLinkUI",Ic.canvas.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new Ic.List,d=this.getStyle("shapelink.type");c.add(a),null!=this._element._points&&c.addAll(this._element._points),c.add(b);var e=c.size(),f=Math.floor(e/2);if(e%2===0){var g=c.get(f),h=c.get(f-1);this._hotSpot={x:(g.x+h.x)/2,y:(g.y+h.y)/2}}else this._hotSpot=Jc.clone(c.get(f));var i,j,k;if("lineto"===d);else if("quadto"===d){for(i=new Ic.List(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-1>j?new Ic.List([c.get(j++),c.get(j)]):c.get(j));c=i}else if("cubicto"===d){for(i=new Ic.List(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-2>j?new Ic.List([c.get(j++),c.get(j++),c.get(j)]):e-1>j?new Ic.List([c.get(j++),c.get(j)]):c.get(j));c=i}else{if("orthogonalto"!==d)throw"Can not resolve shapelink type '"+d+"'";for(k=c.get(0),i=new Ic.List(k),j=1,e=c.size();e>j;j++)if(e-1>j){var l=Jc.clone(c.get(j)),m=l.x,n=l.y,o=m-k.x,p=n-k.y;Math.abs(o)>Math.abs(p)?(l.x=m,l.y=k.y):(l.x=k.x,l.y=n),k=l,i.add(k)}else i.add(c.get(j));c=i}return c}}),Ic.canvas.GridUI=function(a,b){Ic.canvas.GridUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.GridUI",Ic.canvas.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?Ic.network.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage())Ic.canvas.GridUI.superClass.validateBodyBounds.call(this);else{var a=this.getBodyRect(),b=Jc.clone(a);this.appendShadowBound(this,b),this.addBodyBounds(b)}},drawGridBody:function(a){var b=this.getStyle("grid.fill"),c=this.getStyle("grid.deep"),d=this.getStyle("grid.cell.deep");if(b||0!==c||0!==d){a.beginPath();var e=this._element.getRect(),f=this.getDyeColor("grid.fill.color");if(this.setShadow(this,a),b&&(a.fillStyle=f,a.rect(e.x,e.y,e.width,e.height),a.fill()),a.closePath(),this.clearShadow(a),a.beginPath(),0!=c&&Xc.draw3DRect(a,f,c,e.x,e.y,e.width,e.height),a.closePath(),0!=d)for(var g=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count"),i=0;g>i;i++)for(var j=0;h>j;j++){var k=this._element.getCellRect(i,j);null!=k&&(a.beginPath(),Xc.draw3DRect(a,f,d,k.x,k.y,k.width,k.height),a.closePath())}}}}),Ic.canvas.RotatableNodeUI=function(a,b){Ic.canvas.RotatableNodeUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.RotatableNodeUI",Ic.canvas.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var a=this._element,b=Jc.getImageAsset(a.getImage()),c=this.getBodyRect();return b?(Tc.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(a){var b=this._element,c=Jc.getImageAsset(b.getImage()),d=this.getBodyRect();if(Tc.addPadding(d,this._element,"image.padding",1),c.getImage()){var e=this._element._getOrignalWidth(),f=this._element._getOrignalHeight(),g=this._element._getRotateRect();a.save(),a.translate(d.x-g.x+e/2,d.y-g.y+f/2),a.rotate(this._element._angle*Math.PI/180);var d={x:-e/2,y:-f/2,width:e,height:f};Nd(a,c.getImage(this._innerColor,d.width,d.height),this._innerColor,d,b,this._network),a.restore()}else if(c.getSrc());else if(!c.getFunction())throw"ImageAsset '"+b.getImage()+" ' is empty"}}),Ic.canvas.Attachment=function(a,b){this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._showOnTop=b},Jc.ext("twaver.canvas.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return Jc.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(){},hit:function(a,b){return Tc.containsPoint(this._viewRect,a,b)?this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2}):!1},hitCanvasRect:function(a){var b=Le.getHitCanvas(a.width,a.height),c=Le.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paint(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),!0}}catch(j){Le.disposeHitCanvas()}return c.restore(),!1}}),Ic.canvas.BasicAttachment=function(a,b){Ic.canvas.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Jc.ext("twaver.canvas.BasicAttachment",Ic.canvas.Attachment,{paint:function(a){Ic.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),c=this.getOutlineWidth();if(this.getElementUI().setShadow(this,a),(c>0||b)&&(Xc.drawRoundRect(a,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(a.moveTo(this._pointers[0].x,this._pointers[0].y),a.lineTo(this._pointers[1].x,this._pointers[1].y),a.lineTo(this._pointers[2].x,this._pointers[2].y)),a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b)){var d=this.getFillColor(),e=this.getGradient();e?Xc.fill(a,d,e,this.getGradientColor(),this._viewRect):a.fillStyle=d,a.fill()}},validate:function(){Ic.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();this._viewRect=Tc.getRect(this._pointers),this._viewRect=Tc.unionRect(this._viewRect,this._roundRect),a>0&&Tc.grow(this._viewRect,a/2,a/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+2*c,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);var l;if("aboveleft"===k)i.y=j.y-d-i.height,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("aboveright"===k)i.y=j.y-d-i.height,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("belowleft"===k)i.y=j.y+d,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("belowright"===k)i.y=j.y+d,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("leftabove"===k)i.y=j.y+c-i.height,i.x=j.x-d-i.width,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("leftbelow"===k)i.y=j.y-c,i.x=j.x-d-i.width,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("rightabove"===k)i.y=j.y+c-i.height,i.x=j.x+d,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("rightbelow"===k)i.y=j.y-c,i.x=j.x+d,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("above"===k)i.y=j.y-d-i.height,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y-d},{x:j.x+l,y:j.y-d}];else if("below"===k)i.y=j.y+d,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y+d},{x:j.x+l,y:j.y+d}];else if("left"===k)i.y=j.y-i.height/2,i.x=j.x-d-i.width,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+l},{x:j.x-d,y:j.y-l}];else{if("right"!==k)throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+l},{x:j.x+d,y:j.y-l}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var m=this.getPadding();0!=m&&Tc.grow(i,m,m),m=this.getPaddingLeft(),0!=m&&(i.x-=m,i.width+=m),m=this.getPaddingRight(),0!=m&&(i.width+=m),m=this.getPaddingTop(),0!=m&&(i.y-=m,i.height+=m),m=this.getPaddingBottom(),0!=m&&(i.height+=m),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},getContentWidth:function(){return Ic.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Ic.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Ic.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Ic.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Ic.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Ic.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return Ic.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return Ic.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return Ic.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return Ic.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Ic.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Ic.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Ic.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Ic.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return Ic.Defaults.ATTACHMENT_FILL},getFillColor:function(){return Ic.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return Ic.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return Ic.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Ic.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Ic.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Ic.Defaults.ATTACHMENT_CAP},getJoin:function(){return Ic.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return Ic.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Jc.clone(this._roundRect)},getContentRect:function(){return Jc.clone(this._contentRect)}}),Ic.canvas.LabelAttachment=function(a,b){Ic.canvas.LabelAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.LabelAttachment",Ic.canvas.BasicAttachment,{paint:function(a){var b=this._element instanceof Ic.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var c=this._viewRect.x+this._viewRect.width/2,d=this._viewRect.y+this._viewRect.height/2;a.translate(c,d),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-c,-d)}Ic.canvas.LabelAttachment.superClass.paint.apply(this,arguments);var e=this._element.getStyle("label.align");Xc.drawText(a,this.text,this._contentRect,this.font,this.getStyle("label.color"),e),b&&a.restore()},validate:function(){this.font=this.getFont("label.font"),this.text=this.getLabel(),this._textSize=Xc.getTextSize(this.font,this.text),Ic.canvas.LabelAttachment.superClass.validate.call(this)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Ic.canvas.AlarmAttachment=function(a,b){Ic.canvas.AlarmAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.AlarmAttachment",Ic.canvas.BasicAttachment,{paint:function(a){Ic.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),Xc.drawText(a,this.text,this._contentRect,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=Xc.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),Ic.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Ic.canvas.LinkHandlerAttachment=function(a,b){Ic.canvas.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.LinkHandlerAttachment",Ic.canvas.BasicAttachment,{paint:function(a){Ic.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),Xc.drawText(a,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=Xc.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),Ic.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Ic.canvas.IconsAttachment=function(a,b){Ic.canvas.IconsAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.IconsAttachment",Ic.canvas.Attachment,{isShadowable:function(){return Ic.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(Ic.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var a=this._makeGroup(this.iconsNames),b=this._makeGroup(this._network.getIconsColors(this._element));len=a.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[];var c,d;for(i=0;len>i;i++){var e=a[i],f=this.iconsOrientation[i]||"right",g=this.iconsPosition[i]||"topleft.bottomright",h=this.iconsXgap[i]||1,j=this.iconsYgap[i]||1,k=this.iconsXoffset[i]||0,l=this.iconsYoffset[i]||0;
d=null,c=this._getIconsSize(e,f,h,j),c&&(d=this._network.getPosition(g,this._ui,c,k,l),"top"===f?d.y+=c.height:"left"===f&&(d.x+=c.width)),this.locations.push(d),this.iconsSizes.push(c)}var m=null;for(i=0;i<this.locations.length;i++)d=this.locations[i],c=this.iconsSizes[i],null!=d&&(m=null==m?{x:d.x,y:d.y,width:c.width,height:c.height}:Tc.unionRect(m,{x:d.x,y:d.y,width:c.width,height:c.height}));this._viewRect=m||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=a,this.colorGroups=b}},_makeGroup:function(a){if(!Array.isArray(a))return[[a]];var b,c,d,e=[],f=!1,g=a.length;for(b=0;g>b;b++)c=a[b],Array.isArray(c)?(f=!0,e.push(c)):(d=[c],e.push(d));return f||(e.length=0,e.push(a)),e},_makeArray:function(a,b,c){if(Array.isArray(a))return a;for(var d=[],e=0;b>e;e++)d.push(a||c);return d},paint:function(a){if(Ic.canvas.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var b,c,d,e,f,g,h,i,j,k;for(b=0;b<this.iconsGroups.length;b++)if(c=this.locations[b]){f=c.x,g=c.y,e=this.iconsGroups[b],h=this.colorGroups[b],i=this.iconsOrientation[b],j=this.iconsXgap[b]||1,k=this.iconsYgap[b]||1,d=0;for(var l in e){var m=null,n=null;h&&h.length>d&&(n=h[d++]);var o=Jc.getImageAsset(e[l]);if(null!=o){if("right"===i)m={x:f,y:g,width:o.getWidth(),height:o.getHeight()},f+=m.width+j;else if("left"===i)m={x:f-o.getWidth(),y:g,width:o.getWidth(),height:o.getHeight()},f-=m.width+j;else if("top"===i)m={x:f,y:g-o.getHeight(),width:o.getWidth(),height:o.getHeight()},g-=m.height+k;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";m={x:f,y:g,width:o.getWidth(),height:o.getHeight()},g+=m.height+k}Nd(a,o.getImage(n,m.width,m.height),n,m,this._element,this._network)}}}}},_getIconsSize:function(a,b,c,d){var e=0,f=0,g=null,h=null,i=null;for(var j in a)if(h=Jc.getImageAsset(a[j])){if("right"===b)g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},e+=g.width+c;else if("left"===b)g={x:e-h.getWidth(),y:f,width:h.getWidth(),height:h.getHeight()},e-=g.width+c;else if("top"===b)g={x:e,y:f-h.getHeight(),width:h.getWidth(),height:h.getHeight()},f-=g.height+d;else{if("bottom"!==b)throw"Can not resolve '"+b+"' orientation";g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},f+=g.height+d}i=null==i?Jc.clone(g):Tc.unionRect(i,g)}return i?{width:Math.abs(i.width),height:Math.abs(i.height)}:null}}),Ic.canvas.EditAttachment=function(a,b){Ic.canvas.EditAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.canvas.EditAttachment",Ic.canvas.Attachment,{paint:function(a){Ic.canvas.EditAttachment.superClass.paint.apply(this,arguments),this._viewRect=null,this.paintResizingPoints(a),this.paintEditPoints(a),this.paintRotatePoints(a)},paintResizingPoints:function(a){var b=this.resizingPoints.size();if(!(0>=b)){var c=2*this.resizePointSize,d=2*this.resizePointSize,e=this._network.getResizePointFillColor(),f=this._network.getResizePointOutlineWidth(),g=this._network.getResizePointOutlineColor(),h=this._element.getAngle(),i=this._element.getOriginalRect();a.lineWidth=f;for(var j=0;b>j;j++){var k=this.resizingPoints.get(j),l={x:k.x-this.resizePointSize,y:k.y-this.resizePointSize,width:2*this.resizePointSize,height:2*this.resizePointSize},m=this._getRotateRect(l,h,{x:i.x+i.width/2,y:i.y+i.height/2});a.save(),Ic.Util.rotateCanvas(a,m,h),Le.rect(a,m.x,m.y,c,d),a.restore()}a.fillStyle=e,a.strokeStyle=g,a.fill(),a.stroke()}},paintEditPoints:function(a){var b=this.editPoints.size();if(!(0>=b)){var c=this._network.getEditPointOutlineColor(),d=this._network.getEditPointFillColor(),e=this._network.getEditPointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=0;b>f;f++){var g=this.editPoints.get(f);a.beginPath(),Le.circle(a,g.x,g.y,this.editPointSize,d,c),a.closePath()}}},paintRotatePoints:function(a){var b=this.rotatePoints.size();if(!(0>=b)){var c=this._network.getRotatePointOutlineColor(),d=this._network.getRotatePointFillColor(),e=this._network.getRotatePointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=0;b>f;f++){var g=this.rotatePoints.get(f);a.beginPath(),Le.circle(a,g.x,g.y,this.rotatePointSize,d,c),a.closePath()}}},validate:function(){Ic.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new Ic.List,this.editPoints=new Ic.List,this.rotatePoints=new Ic.List,this._element instanceof Ic.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Je)||this._element instanceof Ic.ShapeNode||this._element instanceof Ic.Grid||this._element instanceof Ic.Group||this._addRotatePoint(this._element),this._element instanceof Ic.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Ic.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof Ic.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(a){var b=a.getOriginalRect();if(b){var c=this._network.getResizePointSize();if(!(0>=c)){var d=new me([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),e=this._network.getResizePointOutlineWidth(),f=this._network.getResizePointOutlineColor(),g=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,e,f,g,!0)}}},_addRotatePoint:function(a){var b=a.getOriginalRect();if(b){var c=this._network.getRotatePointSize();if(!(0>=c)){var d=2*c,e=new Ic.List([{x:b.x+b.width/2,y:b.y-this._network.getRotatePointOffset()-d/2}]),f=a.getAngle();0!=f&&(e=this._rotatePointList(e,f,a.getOriginalRect()));var g=e.get(0),h={x:g.x-d/2,y:g.y-d/2,width:d,height:d},i=this._network.getRotatePointOutlineWidth(),j=this.rotatePointSize+i;Tc.grow(b,j,j);var k=Tc.unionRect(a.getRect(),h);this._viewRect=Tc.unionRect(k,this._viewRect),this.rotatePoints=e}}},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addShapeLinkPoints:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(xd.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var c=new Ic.List;c.add(b),this._addEditPoints(c)}}},_addEditPoints:function(a){var b=Tc.getRect(a);if(b){var c=this._network.getEditPointSize();if(!(0>=c)){var d=this._network.getEditPointOutlineWidth();this._addPoints(b,a,d,!1)}}},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>g)){var h=g+c;Tc.grow(a,h,h),this._viewRect=Tc.unionRect(a,this._viewRect),1==f?this.resizingPoints=b:this.editPoints=b}},_rotatePoint:function(a,b,c){var d=Tc.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Ic.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e},_getRotateRect:function(a,b,c){var d=Tc.createMatrix(b*Math.PI/180,c.x,c.y),e={x:a.x+a.width/2,y:a.y+a.height/2},f=d.transform(e),g=new Ic.List([{x:f.x-a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y+a.height/2},{x:f.x-a.width/2,y:f.y+a.height/2}]);return Tc.getRect(g)}}),Ic.canvas.interaction.BaseInteraction=function(a){this.network=a},Jc.ext("twaver.canvas.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(a){var b=a.x*this.network.getZoom()-this.network.getViewRect().x,c=a.y*this.network.getZoom()-this.network.getViewRect().y;return{x:b,y:c}},convertFromUIToMarkerRect:function(a,b,c){var d=this.network.getZoom();return{x:a.x*d-this.network.getViewRect().x+b*d,y:a.y*d-this.network.getViewRect().y+c*d,width:a.width*d,height:a.height*d}},getMarkerPoint:function(a){var b;if(Qc.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=a.changedTouches[0];return b={x:c.clientX,y:c.clientY}}return b=Qc.isFirefox?{x:a.layerX,y:a.layerY}:{x:a.offsetX,y:a.offsetY}},paint:function(){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];Wc.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)Wc.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){0===a.button&&(this._startLogical=this.network.getLogicalPoint(a),this._startClient=Wc.getClientPoint(a),this._startLogical&&Wc.handle_mousedown(this,a))},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Ic.canvas.interaction.SelectInteraction=function(a){Ic.canvas.interaction.SelectInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.canvas.interaction.SelectInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(a){if(null!=this.startPoint&&null!=this.endPoint){var b=this.convertPointFromView(this.startPoint),c=this.convertPointFromView(this.endPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Tc.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Le.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}},handle_mousedown:function(a){if(this.network.isValidEvent(a)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!a.shiftKey){var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?Jc.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(Jc.isCtrlDown(a)||c.clearSelection(),this.end(a),this.startPoint=this.network.getLogicalPoint(a),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener("mousemove"))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.end(a);var b=this.network.getLogicalPoint(a);b&&(this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:a}:{kind:"selectBetween",event:a}),this.endPoint=b,this.repaint())},end:function(a){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var b=Tc.getRect([this.startPoint,this.endPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}this.network.setSelectingElement(!1),this.removeListener("mousemove"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y}}),Ic.canvas.interaction.MoveInteraction=function(a,b){this.lazyMode=b,Ic.canvas.interaction.MoveInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.canvas.interaction.MoveInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","keydown","mouseout"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","keydown","mouseout"),this.end(),this.network.removeMarker(this)},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup")},handle_keyup:function(){this.currentKeyEvent=null,this.removeListener("keyup")},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(a,b){var c=null;this.parent=null;var d=this;if(!b&&this.isParenting()){var e={},f=this.network.getLogicalPoint(a);e.x=f.x-1,e.y=f.y-1,e.width=2,e.height=2;var g=this.network.getElementsAtRect(e,!0);if(g&&g.size()>0)for(var h=g.size(),i=0;h>i;i++){var j=g.get(i);if(!d.network.getElementBox().getSelectionModel().contains(j)){d.parent=j;break}}}else this.parent=null;null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==c||b?null:c},paint:function(a){if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;a.beginPath();var b=this.dragPoint.x-this.pressPoint.x,c=this.dragPoint.y-this.pressPoint.y,d=this.network.getMovableSelectedElements(),e=d.size(),f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,g=this.network.getLazyMoveOutlineWidth(),h=this.network.getLazyMoveOutlineColor();a.strokeStyle=h,a.lineWidth=g,a.fillStyle=f;for(var i=0;e>i;i++){var j=d.get(i),k=this.network.getElementUI(j);if(k){var l=this.convertFromUIToMarkerRect(k.getViewRect(),b,c);Le.rect(a,l.x,l.y,l.width,l.height)}}a.fill(),a.stroke()}if(this.parentRect){a.beginPath();var f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,g=this.network.getLazyMoveOutlineWidth(),h=this.network.getLazyMoveOutlineColor();a.strokeStyle=h,a.lineWidth=g,a.fillStyle=f;var l=this.parentRect;Le.rect(a,l.x,l.y,l.width,l.height),a.fill(),a.stroke()}},handle_mousedown:function(a){if(0===a.button&&this.network.isValidEvent(a)&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);this.network.isMovable(b)&&(this.end(a),this.lastPoint=this.network.getLogicalPoint(a),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener("mousemove"))}},handle_mouseup:function(a){this.end(a)},handle_mouseout:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements())return void this.end(a);var b=this.network.getLogicalPoint(a);b&&this.lastPoint&&(this.xoffset=b.x-this.lastPoint.x,this.yoffset=b.y-this.lastPoint.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1||(this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a}):(this.network.moveSelectedElements(this.xoffset,this.yoffset),this.lastPoint=b,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))),this.parentProcess(a,!1),this.lazyMode&&(this.dragPoint=b),(this.lazyMode||this.isParenting())&&this.repaint()))},end:function(a){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.network.setMovingElement(!1)},d=this.dragPoint.x-this.pressPoint.x,e=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(d,e,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var b=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(b.parent)},this.network)}this.parentProcess(a,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.removeListener("mousemove"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),Ic.canvas.interaction.ScrollInteraction=function(a){Ic.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,a),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},Jc.ext("twaver.canvas.interaction.ScrollInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout"),Qc.isFirefox?Wc.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):Wc.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),Wc.addEventListener("mouseup","handleMouseUp",a,this),Wc.addEventListener("mousemove","handleMouseMove",a,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout"),Qc.isFirefox?Wc.removeEventListener("DOMMouseScroll",this.network.getView(),this):Wc.removeEventListener("mousewheel",this.network.getView(),this),Wc.removeEventListener("mouseup",a,this),Wc.removeEventListener("mousemove",a,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.network.removeMarker(this)},handleViewRectChange:function(a){("viewRect"==a.property||"canvasSizeChange"==a.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var a=this.network.getViewRect().height,b=this.network.getViewRect().width,c=this.network.getViewRect().x,d=this.network.getViewRect().y,e=this.network.getCanvasSize(),f=e.width,g=e.height;if(f>b&&(0>c||c+b>f))return void this.repaint();if(g>a&&(0>d||d+a>g))return void this.repaint();var h=0,i=g>a,j=f>b,k=this.getScrollBarWidth();if(g>a){h=j?a*(a-k)/g:a*a/g;var l=d/(g-a)*(a-h-k);this.vThumbRect={x:b-k,y:l,width:k,height:h}}var m=0;if(f>b){m=i?b*(b-k)/f:b*b/f;var n=c/(f-b)*(b-m-k);this.hThumbRect={x:n,y:a-k,width:m,height:k}}this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d+f,e,c,b)},scrollYOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d,e+f,c,b)},handle_mousedown:function(a){if(1!=this.network.isValidEvent(a)){var b=this.getMarkerPoint(a);this.hBarDownPoint=null,this.vBarDownPoint=null,null!=this.vThumbRect&&Tc.containsPoint(this.vThumbRect,b.x,b.y)&&(this.vBarDownPoint={x:a.screenX,y:a.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),null!=this.hThumbRect&&Tc.containsPoint(this.hThumbRect,b.x,b.y)&&(this.hBarDownPoint={x:a.screenX,y:a.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)}},handle_mouseover:function(){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(){0!=this.scrollBarVisible&&(this.scrollBarVisible=!1,this.repaint())},handleMouseUp:function(){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(a){var b={x:a.screenX,y:a.screenY},c=this.network.getCanvasSize(),d=this.network.getViewRect().height,e=this.network.getViewRect().width,f=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var g=b.x-this.hBarDownPoint.x;return this.hBarDownPoint=b,void this.network.setViewOffSet(g*c.width/(e-f),0)}if(null!=this.vBarDownPoint){var h=b.y-this.vBarDownPoint.y;return this.vBarDownPoint=b,void this.network.setViewOffSet(0,h*c.height/(d-f))}},handleMouseWheel:function(a){var b=!1;a.wheelDelta!==a.wheelDeltaX?(a.wheelDelta?a.wheelDelta>0&&(b=!0):a.detail<0&&(b=!0),this.scrollYOffset(b)):(a.wheelDelta?a.wheelDelta>0&&(b=!0):a.detail<0&&(b=!0),this.scrollYOffset(b))},paintRoundRect:function(a,b,c,d,e,f,g,h){a.beginPath(),a.globalAlpha=c,a.fillStyle=b,Xc.drawRoundRect(a,d,e,f,g,h),a.fill()},paint:function(a){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var b=this.getScrollBarWidth(),c=this.network.getViewRect().height,d=this.network.getViewRect().width;a.save();var e,f=this.getScrollBarColor();null!=this.hThumbRect&&(e=a.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,0,c-b,d-b,b,b/2),this.paintRoundRect(a,e,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),null!=this.vThumbRect&&(e=a.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,d-b,0,b,c-b,b/2),this.paintRoundRect(a,e,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),a.restore()}}}),Ic.canvas.interaction.DefaultInteraction=function(a){Ic.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.canvas.interaction.DefaultInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(a){if(this.network.isValidEvent(a)){this.network.isFocusOnClick()&&Ic.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);2===a.detail?this.handleDoubleClicked(a,b):this.handleClicked(a,b)}},handleClicked:function(a,b){Cd.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){Cd.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){Cd.handleKeyDown(this.network,a)},handle_mousemove:function(a){var b=this.network.getElementAt(a),c=this._preElement,d=Dd(c),e=Dd(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this.network),this.network.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this.network),this.network.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this.network),this.network.onMouseMove(b,a),this._preElement=b}}),Ic.canvas.interaction.PanInteraction=function(a){Ic.canvas.interaction.PanInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.canvas.interaction.PanInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown","mouseup")},handle_mousedown:function(a){this.network.isValidEvent(a)&&(this.lastPoint=this.getMarkerPoint(a),this.lastPoint&&(this.addListener("mousemove"),this.network.getView().style.cursor="pointer"))},handle_mouseup:function(){this._clear()},handle_mousemove:function(a){if(this.lastPoint){var b=this.getMarkerPoint(a);if(b){var c=b.x-this.lastPoint.x,d=b.y-this.lastPoint.y;this.network.panByOffset(-c,-d),this.lastPoint=b}}},_clear:function(){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener("mousemove"))}}),Ic.canvas.interaction.CreateElementInteraction=function(a,b){b||(b=Ic.Node),this.elementFunction=Ic.Util.isTypeOf(b,Ic.Node)?function(a){var c=new b;return c instanceof Ic.Node&&c.setCenterLocation(a),c}:b,Ic.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.canvas.interaction.CreateElementInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),Ic.canvas.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,this.editPointSize=a.getEditPointSize(),this.resizePointSize=a.getResizePointSize(),this.rotatePointSize=a.getRotatePointSize(),Ic.canvas.interaction.EditInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.canvas.interaction.EditInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(a){if(1==this.lazyMode&&null!=this.resizingRect){a.lineWidth=this.network.getResizeLineWidth();var b=this.convertFromUIToMarkerRect(this.resizingRect,0,0);a.save(),Ic.Util.rotateCanvas(a,b,this.node.getAngle()),a.beginPath(),Le.rect(a,b.x,b.y,b.width,b.height,null,this.network.getResizeLineColor()),a.restore()}this.isStartRotate&&this.showRotateScale(a)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(0===a.button)if(!Jc.isAltDown(a)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Jc.isAltDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?Jc.isAltDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a)));else{var b=this.network.getElementAt(a),c=this.network.getLogicalPoint(a);if(b instanceof Ic.ShapeNode){var d=this.getPointIndex(b.getPoints(),c,!0);d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeNode=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}if(b instanceof Ic.ShapeLink){var e=new Ic.List(b.getPoints()),f=this.network.getElementUI(b);e.add(f.getFromPoint(),0),e.add(f.getToPoint());var d=this.getPointIndex(e,c)-1;d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeLink=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}}},handle_mouseup:function(a){if(this.isStart){var b=this.network.getLogicalPoint(a);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new Ic.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection})});Ic.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&b?(this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.clear()},handle_mousemove:function(a){if(this.network.isValidEvent(a)){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(a);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if(this.linkUI)return void this._handleMovingLinkControlPoint(a)}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var b=this.network.getElementAt(a),c=this.network.getElementUI(b);if(!c||!c.getEditAttachment())return void this.clear();var d=this.network.getLogicalPoint(a);if(b instanceof Ic.Node){if(this.node=b,this._isEditingShapeNode(d)||this._isResizingNode(d))return void this.network.setEditingElement(!0);if(this._isRotatingElement(d))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(b instanceof Ic.ShapeLink){if(this.shapeLink=b,this._isEditingShapeLink(d))return void this.network.setEditingElement(!0)}else if(c instanceof Ic.canvas.LinkUI&&xd.isOrthogonalLink(c._element)){this.linkUI=c;var e=this.linkUI.getControlPoint();return void(e&&this._contains(d,e,this.editPointSize)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}this.clear()}},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle();return this._isRotating(a,"crosshair",c,d)},_isRotating:function(a,b,c,d){var e=this.network.getRotatePointSize(),f={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-e},g=this._rotatePoint(f,d,c),h={x:g.x-e,y:g.y-e,width:2*e,height:2*e};return Tc.containsPoint(h,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=b.getCenterLocation();return Math.round(180*Math.atan2(c.x-a.x,a.y-c.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(a){var b=this.network.getLogicalPoint(a);
this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){var b=this.network.getLogicalPoint(a);this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this.linkUI.setControlPoint(this.network.getLogicalPoint(a)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(i,f,b),g.x=this._endLogical.x,g.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),"north"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),k.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(h,f,b),j.x=this._endLogical.x,j.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"west"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),n.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),l.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(j,f,b),h.x=this._endLogical.x,h.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"south"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),m.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}"southeast"===this.resizeDirection&&(this._transformPoint(g,f,b),i.x=this._endLogical.x,i.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){if(this.node instanceof Ic.ShapeNode){this.shapeNode=this.node;for(var b=this.shapeNode.getPoints(),c=0,d=b.size();d>c;c++){var e=b.get(c);if(this._contains(a,e,this.editPointSize))return this._setCrossCursor(),this.pointIndex=c,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){for(var b=this.shapeLink.getPoints(),c=0,d=b.size();d>c;c++){var e=b.get(c);if(this._contains(a,e,this.editPointSize))return this._setCrossCursor(),this.pointIndex=c,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle(),e={x:c.x,y:c.y},f=this._rotatePoint(e,d,c);return this._isResizing(a,f.x,f.y,"northwest","nwse-resize")?!0:(e={x:c.x+c.width/2,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"north","ns-resize")?!0:(e={x:c.x+c.width,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"northeast","nesw-resize")?!0:(e={x:c.x,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"west","ew-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"east","ew-resize")?!0:(e={x:c.x,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southwest","nesw-resize")?!0:(e={x:c.x+c.width/2,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"south","ns-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=Tc.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){return this._contains(a,{x:b,y:c},this.resizePointSize)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:2*c,height:2*c};return Tc.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;for(var d,e=a.get(0),f=1;f<a.size();f++){if(d=a.get(f),this.isPointOnLine(b,e,d,6))return f;e=d}return e=a.get(0),c&&this.isPointOnLine(b,e,d,6)?a.size():0},showRotateScale:function(a){var b,c,d,e,f,g=(new Ic.List,this.network.getRotateScaleWidth()),h=this.network.getRotateScaleHeight(),i=this.network.getRotatePointSize(),j=this.node.getAngle(),k=this.node.getOriginalRect(),l={x:k.x+k.width/2,y:k.y-this.network.getRotatePointOffset()-i},m=this._rotatePoint(l,j,k),n="13px Arial",o=j+"°";this.node.getAngle()>=0&&this.node.getAngle()<=180?(c={x:m.x+i,y:m.y},d={x:c.x+g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(c={x:m.x-i,y:m.y},d={x:c.x-g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y});var p=new Ic.List([c,d,e,f]),b=Jc.math.getRect(p);a.fillStyle=this.network.getRotateScaleFillColor(),a.fillRect(b.x,b.y,b.width,b.height),a.fillStyle=this.network.getRotateScaleFontColor(),a.textBaseline="middle",a.textAlign="center",a.font=n,a.fillText(o,b.x+b.width/2,b.y+b.height/2)},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}return(b>=360||-360>=b)&&(b%=360),b>22.5&&67.5>=b&&(c+=1),-22.5>b&&b>=-67.5&&(c-=1),b>67.5&&112.5>=b&&(c+=2),-67.5>b&&b>=-112.5&&(c-=2),b>112.5&&157.5>=b&&(c+=3),-112.5>b&&b>=-157.5&&(c-=3),b>157.5&&202.5>=b&&(c+=4),-157.5>b&&b>=-202.5&&(c-=4),b>202.5&&247.5>=b&&(c+=5),-202.5>b&&b>=-247.5&&(c-=5),b>247.5&&292.5>=b&&(c+=6),-247.5>b&&b>=-292.5&&(c-=6),b>292.5&&337.5>=b&&(c+=7),-292.5>b&&b>=-337.5&&(c-=7),c>8&&(c-=8),0>=c&&(c+=8),d[c]}}),Ic.canvas.interaction.CreateLinkInteraction=function(a,b){b||(b=Ic.Link),this.linkFunction=Ic.Util.isTypeOf(b,Ic.Link)?function(a,c){var d=new b;return d instanceof Ic.Link&&(d.setFromNode(a),d.setToNode(c)),d}:b,Ic.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.canvas.interaction.CreateLinkInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(a){a.beginPath();var b,c;a.lineWidth=this.network.getEditLineWidth();var d=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(b=this.network.getElementUI(this.currentNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),Le.rect(a,c.x,c.y,c.width,c.height,null,d)),this.fromNode&&(b=this.network.getElementUI(this.fromNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),Le.rect(a,c.x,c.y,c.width,c.height,null,d)),this.currentPoint&&this.paintLine(a),a.closePath()},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.convertPointFromView(this.fromNode.getCenterLocation()),d=c.x,e=c.y,f=this.currentPoint.x,g=this.currentPoint.y;a.strokeStyle=b,a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(this.network.isValidEvent(a))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.repaint()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.repaint()))}},getFromNode:function(a){return this.getNode(a)},getToNode:function(a){return this.getNode(a)},getNode:function(a){var b=this.network.getElementAt(a);return b instanceof Je&&this.network.isLinkable(b)?b:null}}),Ic.canvas.interaction.CreateShapeLinkInteraction=function(a,b){Ic.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=Ic.ShapeLink),this.linkFunction=Ic.Util.isTypeOf(b,Ic.ShapeLink)?function(a,c,d){var e=new b;return e instanceof Ic.ShapeLink&&(e.setFromNode(a),e.setToNode(c),d&&e.setPoints(d)),e}:b},Jc.ext("twaver.canvas.interaction.CreateShapeLinkInteraction",Ic.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,Ic.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{if(this.points||(this.points=new Ic.List),this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}},paintLine:function(a){if(this.currentPoint){var b,c=new Ic.List;if(b=this.convertPointFromView(this.fromNode.getCenterLocation()),c.add(b,0),this.points&&this.points.size()>0)for(var d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.currentPoint,c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Xc.drawLinePoints(a,c),a.stroke()}}}),Ic.canvas.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=Ic.ShapeNode),this.shapeNodeFunction=Ic.Util.isTypeOf(b,Ic.ShapeNode)?function(a){var c=new b;return c instanceof Ic.ShapeNode&&a&&c.setPoints(a),c}:b,Ic.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.canvas.interaction.CreateShapeNodeInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){for(var b,c=new Ic.List,d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.convertPointFromView(this.currentPoint),c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Xc.drawLinePoints(a,c),a.stroke()}},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){if(2===a.detail){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Ic.List),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}this.repaint()}},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint(a),this.repaint())}}),Ic.canvas.interaction.MagnifyInteraction=function(a,b,c,d,e){Ic.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.zoom=b||2,this.xRadius=c||100,this.yRadius=d||100,this.shape=e||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=Wc.createCanvas()},Jc.ext("twaver.canvas.interaction.MagnifyInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.network.removeMarker(this)},paint:function(a){if(this.point){var b=this.network._zoom,c=this.zoom*b,d=this.point.x*b-this.network.viewRect.x-this.xRadius,e=this.point.y*b-this.network.viewRect.y-this.yRadius,f=2*this.xRadius,g=2*this.yRadius,h={x:this.point.x-this.xRadius/c,y:this.point.y-this.yRadius/c,width:f/c,height:g/c},i=this.borderWidth,j=Wc.createCanvas();j.width=f,j.height=g,this.network.toCanvasByRegion(h,c,j),a.save(),a.beginPath(),Xc.drawVector(a,this.shape,null,d,e,f,g),a.clip(),a.fillStyle=this.backgroundColor,a.beginPath(),a.rect(d,e,f,g),a.fill(),a.drawImage(j,d,e),a.restore(),a.beginPath(),a.lineWidth=i,Xc.drawVector(a,this.shape,null,d+i/2,e+i/2,f-i,g-i),a.strokeStyle=this.borderColor,a.stroke()}},handle_mousemove:function(a){this.point=this.network.getLogicalPoint(a),this.point&&this.repaint()},getZoom:function(){return this.zoom},setZoom:function(a){this.zoom=a,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.network.repaintTopCanvas()}}),Ic.canvas.interaction.TouchInteraction=function(a){Ic.canvas.interaction.TouchInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.canvas.interaction.TouchInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Wc.addEventListener("touchstart","handleTouchstart",a,this),Wc.addEventListener("touchmove","handleTouchmove",a,this),Wc.addEventListener("touchend","handleTouchend",a,this),Wc.addEventListener("touchcancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Wc.removeEventListener("touchstart",this.network.getView(),this),Wc.removeEventListener("touchmove",a,this),Wc.removeEventListener("touchend",a,this),Wc.removeEventListener("touchcancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(Wc.preventDefault(a),a.touches&&1==a.touches.length){var b=this.network.getLogicalPoint(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b,this._startTouchClient=this.getMarkerPoint(a),c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Cd.handleLongClicked(self.network,a,c)},1e3)}else a.touches&&2==a.touches.length&&(this._distance=zd.getDistance(a),this._zoom=this.network.getZoom());this._touchCount=a.touches.length},handleTouchmove:function(a){if(Wc.preventDefault(a),2==this._touchCount&&a.touches&&2==a.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-zd.getDistance(a))>=Ce.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var b=zd.getDistance(a)/this._distance;this.network.setTouchZoom(this._zoom*b,!1)}else{var c=this.getMarkerPoint(a),d=this._startTouchClient.x-c.x,e=this._startTouchClient.y-c.y;this.network.panByOffset(d,e),this._startTouchClient=c}else if(1==this._touchCount&&a.touches&&1==a.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var f=this.network.getLogicalPoint(a),g=this.network.getElementAt(f);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==g&&this.network.getMovableSelectedElements().contains(g)){var d=f.x-this._startTouchPoint.x,e=f.y-this._startTouchPoint.y;(Math.abs(d)>=Ce.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Ce.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=f,this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}),this.timer&&clearTimeout(this.timer)))}else{var d=f.x-this._startTouchPoint.x,e=f.y-this._startTouchPoint.y;(Math.abs(d)>=Ce.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Ce.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer);var c=this.getMarkerPoint(a),d=this._startTouchClient.x-c.x,e=this._startTouchClient.y-c.y;this.network.panByOffset(d,e),this._startTouchClient=c}}else{var h=this.network.getLogicalPoint(a);if(!h)return;var d=h.x-this._startTouchPoint.x,e=h.y-this._startTouchPoint.y;Math.abs(d)>=Ce.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(e)>=Ce.TOUCH_RECT_SELECT_THRESHOLD&&(this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.timer&&clearTimeout(this.timer)),this._moveTouchPoint=h,this.repaint())}},handleTouchend:function(a){if(Wc.preventDefault(a),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=Tc.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){this._zoomFlag=!1;var f=new Date,g=this.network.getLogicalPoint(a),h=this.network.getElementAt(this._startTouchPoint);g&&f.getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,g)<=20&&(h?this.network.getSelectionModel().contains(h)||this.network.getSelectionModel().setSelection(h):this.network.getSelectionModel().clearSelection(),Cd.handleClicked(this.network,a,h),this.timer&&clearTimeout(this.timer),this._endTouchTime&&f.getTime()-this._endTouchTime.getTime()<=500&&Tc.getDistance(this._endTouchPoint,g)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Cd.handleDoubleClicked(this.network,a,h)):(this._endTouchTime=f,this._endTouchPoint=g))}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Tc.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Le.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),Ic.canvas.interaction.MSTouchInteraction=function(a){Ic.network.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},Jc.ext("twaver.canvas.interaction.MSTouchInteraction",Ic.canvas.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Wc.addEventListener("MSPointerDown","handleTouchstart",a,this),Wc.addEventListener("MSPointerMove","handleTouchmove",a,this),Wc.addEventListener("MSPointerUp","handleTouchend",a,this),Wc.addEventListener("MSPointerCancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Wc.removeEventListener("MSPointerDown",a,this),Wc.removeEventListener("MSPointerMove",a,this),Wc.removeEventListener("MSPointerUp",a,this),Wc.removeEventListener("MSPointerCancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(this.network.isFocusOnClick()&&Ic.Util.setFocus(this.network._view),!this.network.isSelectingElement()||a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.network.getLogicalPoint(a),c=new Date;if(a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length){var d=this.network.getElementAt(b);this._startTouchElement=d,this._startClientPoint={x:a.clientX,y:a.clientY},Cd.handleClicked(this.network,a,d),this._startTouchTime&&this._startTouchPoint&&c.getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,b)<=20?(Cd.handleDoubleClicked(this.network,a,d),this._doubleClick=!0):(Wc.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=c);var e=this.network.getSelectionModel();d?Jc.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d):Jc.isCtrlDown(a)||e.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Tc.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),this.network.isSelectingElement()){var b=Tc.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var f=-1,g=0;g<this._pointerIdArray.length;g++)if(this._pointerIdArray[g]==a.pointerId){f=g;break}f>=0&&this._pointerIdArray.splice(f,1),delete this._pointerMap[a.pointerId],this._startTouchPoint=null,this._moveTouchPoint=null},_getDistance:function(){return Tc.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){var b={x:a.clientX,y:a.clientY};if(!(Tc.getDistance(this._startClientPoint,b)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(b.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(b.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint(a);if(!c)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:a}:{kind:"selectStart",event:a}),this.repaint()}else{var d=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&d==this._startTouchElement&&this.network.getMovableSelectedElements().contains(d)){var e=this._moveTouchPoint.x-this._startTouchPoint.x,f=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}}else{var e=this._startClientPoint.x-b.x,f=this._startClientPoint.y-b.y;this.network.panByOffset(e,f)}this._startClientPoint=b}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Tc.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Le.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}}});var Me=function(a,b){Jc.registerImage(a,b),Ne[a]=1},Ne={};Me("node_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,23.5c0,0.276-0.224,0.5-0.5,0.5h-31C0.224,24,0,23.776,0,23.5v-2C0,21.224,0.224,21,0.5,21h31  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"15.9995",y1:"21",x2:"15.9995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,22.3c0-0.165-0.134-0.3-0.3-0.3H3.3C3.134,22,3,22.135,3,22.3V24h12V22.3z",gradient:{id:"SVGID_2_",type:"linear",x1:"9",y1:"22",x2:"9",y2:"25",stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"}]}},{shape:"path",data:"M31,20H1V1c0-0.553,0.448-1,1-1h28c0.553,0,1,0.447,1,1V20z",gradient:{id:"SVGID_3_",type:"linear",x1:"15.9995",y1:"-0.1221",x2:"15.9995",y2:"19.9471",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:1,w:28,h:18,fill:"#FFFFFF"},{shape:"rect",x:3,y:2,w:26,h:16,gradient:{id:"SVGID_4_",type:"linear",x1:"15.9995",y1:"2.0654",x2:"15.9995",y2:"17.3835",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"9.649,17.034 6.815,17.034 9.935,2.966 12.768,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"12.065,17.034 10.815,17.034 13.935,2.966 15.185,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"14.065,17.034 13.315,17.034 16.435,2.966 17.185,2.966 z",fill:"#FFFFFF"}]}),Me("group_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,16.5c0,0.276-0.224,0.5-0.5,0.5h-24C7.224,17,7,16.776,7,16.5v-1C7,15.224,7.224,15,7.5,15h24   c0.276,0,0.5,0.224,0.5,0.5V16.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"19.5",y1:"15",x2:"19.5",y2:"17",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M19,16.5c0-0.277-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.223-0.5,0.5V17h9V16.5z",gradient:{id:"SVGID_2_",type:"linear",x1:"14.4995",y1:"15.9209",x2:"14.4995",y2:"17.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,14H8V1c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V14z",gradient:{id:"SVGID_3_",type:"linear",x1:"19.5",y1:"0",x2:"19.5",y2:"14.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:1,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:10,y:2,w:19,h:10,gradient:{id:"SVGID_4_",type:"linear",x1:"19.5",y1:"1.9619",x2:"19.5",y2:"11.9744",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M25,23.5c0,0.276-0.224,0.5-0.5,0.5h-24C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h24   c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:"12.4995",y1:"22",x2:"12.4995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,23.5c0-0.277-0.224-0.5-0.5-0.5h-8C3.224,23,3,23.223,3,23.5V24h9V23.5z",gradient:{id:"SVGID_6_",type:"linear",x1:"7.5",y1:"22.9209",x2:"7.5",y2:"24.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M24,21H1V8c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V21z",gradient:{id:"SVGID_7_",type:"linear",x1:"12.4995",y1:"7",x2:"12.4995",y2:"21.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:8,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:3,y:9,w:19,h:10,gradient:{id:"SVGID_8_",type:"linear",x1:"12.4995",y1:"8.9619",x2:"12.4995",y2:"18.9749",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}}]}),Me("subnetwork_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,14.499c0,0.276-0.224,0.5-0.5,0.5h-20c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h20c0.276,0,0.5,0.224,0.5,0.5V14.499z",gradient:{id:"SVGID_1_",type:"linear",x1:21.5,y1:12.999,x2:21.5,y2:14.9995,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M22,14.499c0-0.277-0.224-0.5-0.5-0.5h-7c-0.276,0-0.5,0.223-0.5,0.5v0.5h8V14.499z",gradient:{id:"SVGID_2_",type:"linear",x1:18,y1:13.9199,x2:18,y2:15.0449,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,11.499c0,0.276-0.224,0.5-0.5,0.5h-18c-0.276,0-0.5-0.224-0.5-0.5v-11c0-0.276,0.224-0.5,0.5-0.5  h18c0.276,0,0.5,0.224,0.5,0.5V11.499z",gradient:{id:"SVGID_3_",type:"linear",x1:21.5,y1:-.9502,x2:21.5,y2:12.5498,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:13,y:.999,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:14,y:1.999,w:15,h:8,gradient:{id:"SVGID_4_",type:"linear",x1:21.5,y1:1.9312,x2:21.5,y2:9.6537,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M21,23.5c0,0.276-0.224,0.5-0.5,0.5h-20C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h20  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:10.4995,y1:22,x2:10.4995,y2:24,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:22,y:20.5,w:3,h:1.999,gradient:{id:"SVGID_6_",type:"linear",x1:-464.9424,y1:-722.2754,x2:-462.9424,y2:-722.2754,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:28,y:16,w:2,h:3,gradient:{id:"SVGID_7_",type:"linear",x1:29,y1:16,x2:29,y2:19,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M11,23.5c0-0.277-0.224-0.5-0.5-0.5h-7C3.224,23,3,23.223,3,23.5V24h8V23.5z",gradient:{id:"SVGID_8_",type:"linear",x1:7,y1:22.9209,x2:7,y2:24.0459,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M20,20.5c0,0.276-0.224,0.5-0.5,0.5h-18C1.224,21,1,20.776,1,20.5v-11C1,9.224,1.224,9,1.5,9h18  C19.776,9,20,9.224,20,9.5V20.5z",gradient:{id:"SVGID_9_",type:"linear",x1:10.4995,y1:8.0508,x2:10.4995,y2:21.5513,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:10,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:3,y:11,w:15,h:8,gradient:{id:"SVGID_10_",type:"linear",x1:10.4995,y1:10.9321,x2:10.4995,y2:18.6551,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"M32,22.7c0,0.165-0.135,0.3-0.301,0.3h-5.4C26.134,23,26,22.865,26,22.7v-2.4  c0-0.165,0.134-0.3,0.299-0.3h5.4C31.865,20,32,20.135,32,20.3V22.7z",gradient:{id:"SVGID_11_",type:"linear",x1:29,y1:20,x2:29,y2:23,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Me("bus_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:4,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M7,4c0,0.552-0.448,1-1,1H3C2.448,5,2,4.552,2,4V3c0-0.552,0.448-1,1-1h3c0.552,0,1,0.448,1,1V4z",gradient:{id:"SVGID_1_",type:"linear",x1:4.5,y1:2,x2:4.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M6,5.5C6,5.776,5.776,6,5.5,6h-2C3.224,6,3,5.776,3,5.5l0,0C3,5.224,3.224,5,3.5,5h2  C5.776,5,6,5.224,6,5.5L6,5.5z",gradient:{id:"SVGID_2_",type:"linear",x1:4.5,y1:6,x2:4.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:12,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M15,4c0,0.552-0.447,1-1,1h-3c-0.553,0-1-0.448-1-1V3c0-0.552,0.447-1,1-1h3c0.553,0,1,0.448,1,1V4z",gradient:{id:"SVGID_3_",type:"linear",x1:12.5,y1:2,x2:12.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M14,5.5C14,5.776,13.777,6,13.5,6h-2C11.225,6,11,5.776,11,5.5l0,0C11,5.224,11.225,5,11.5,5h2  C13.777,5,14,5.224,14,5.5L14,5.5z",gradient:{id:"SVGID_4_",type:"linear",x1:12.5,y1:6,x2:12.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:10,w:1,h:1,fill:"#232424"},{shape:"path",data:"M6,13c0-0.553,0.448-1,1-1h3c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V13z",gradient:{id:"SVGID_5_",type:"linear",x1:-1428.3853,y1:-571.5747,x2:-1428.3853,y2:-568.5747,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#232424"},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M7,11.5C7,11.223,7.224,11,7.5,11h2c0.277,0,0.5,0.223,0.5,0.5l0,0c0,0.275-0.223,0.5-0.5,0.5h-2  C7.224,12,7,11.775,7,11.5L7,11.5z",gradient:{id:"SVGID_6_",type:"linear",x1:-1428.3862,y1:-567.5737,x2:-1428.3862,y2:-568.5737,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,7.5C15,7.776,14.777,8,14.5,8h-12C2.224,8,2,7.776,2,7.5l0,0C2,7.224,2.224,7,2.5,7h12  C14.777,7,15,7.224,15,7.5L15,7.5z",gradient:{id:"SVGID_7_",type:"linear",x1:8.4995,y1:6.1152,x2:8.4995,y2:7.5558,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,9.5c0,0.275-0.223,0.5-0.5,0.5h-12C2.224,10,2,9.775,2,9.5l0,0C2,9.223,2.224,9,2.5,9h12  C14.777,9,15,9.223,15,9.5L15,9.5z",gradient:{id:"SVGID_8_",type:"linear",x1:8.4995,y1:8.1147,x2:8.4995,y2:9.556,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Me("data_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,12c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12   z",gradient:{id:"SVGID_1_",type:"linear",x1:10.5,y1:6.959,x2:10.5,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:8,y:9,w:5,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:10.5,y1:8.6997,x2:10.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,14.5c0,0.275-0.225,0.5-0.5,0.5h-8C6.224,15,6,14.775,6,14.5l0,0C6,14.223,6.224,14,6.5,14h8   C14.775,14,15,14.223,15,14.5L15,14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:10.5,y1:13.125,x2:10.5,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:14,w:1,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:14.0049,x2:8.4995,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,4H6c0,0-0.152-0.275-0.5-1C5.021,2,5.021,2,4,2C3.057,2,2,2,2,2C1.448,2,1,2.448,1,3v8  c0,0.553,0.448,1,1,1h3v-1H2V3h2.387l1.024,1.998L12,5v1h1V5C13,4.448,12.553,4,12,4z",gradient:{id:"SVGID_5_",type:"linear",x1:6.9995,y1:2.0527,x2:6.9995,y2:11.4757,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,5L5.411,4.998L4.387,3H2v8h3v-0.645V7.254V7c0-0.552,0.448-1,1-1h0.324h3.032H12V5z",gradient:{id:"SVGID_6_",type:"linear",x1:6.9995,y1:2.9902,x2:6.9995,y2:11.0032,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Me("grid_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,14c0,0.553-0.447,1-1,1H3c-0.552,0-1-0.447-1-1V3c0-0.552,0.448-1,1-1h11c0.553,0,1,0.448,1,1V14  z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:2.1255,x2:8.4995,y2:14.909,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:11,h:11,fill:"#FFFFFF"},{shape:"rect",x:3,y:5,w:11,h:1,gradient:{id:"SVGID_2_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:8,w:11,h:1,gradient:{id:"SVGID_3_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:11,w:11,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:3.2095,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:11,y:3,w:1,h:11,gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:3.209,x2:11.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:3,w:1,h:11,gradient:{id:"SVGID_6_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:5,y:3,w:1,h:11,gradient:{id:"SVGID_7_",type:"linear",x1:5.5,y1:3.209,x2:5.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Me("databox_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,6h-12H2v0.5v7C2,13.776,2.224,14,2.5,14h12c0.276,0,0.5-0.224,0.5-0.5v-7V6H14.5z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:6.0625,x2:8.4995,y2:14.063,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M14.776,5.553l-1.553-3.105C13.101,2.201,12.775,2,12.5,2h-8C4.225,2,3.899,2.201,3.776,2.447  L2.224,5.553L2,6h0.5h12H15L14.776,5.553z",gradient:{id:"SVGID_2_",type:"linear",x1:8.5005,y1:3.104,x2:8.5005,y2:-5.6467,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"12,2 9.5,2 7.5,2 5,2 3,6 7.5,6 9.5,6 14,6 z",gradient:{id:"SVGID_3_",type:"linear",x1:8.5005,y1:9.2295,x2:8.5005,y2:5.4586,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M11.5,9c0,0.276-0.224,0.5-0.5,0.5H6C5.724,9.5,5.5,9.276,5.5,9l0,0c0-0.276,0.224-0.5,0.5-0.5h5  C11.276,8.5,11.5,8.724,11.5,9L11.5,9z",fill:"#FFFFFF"}]}),Me("group_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,8.5C15,8.776,14.776,9,14.5,9h-10C4.224,9,4,8.776,4,8.5v-7C4,1.224,4.224,1,4.5,1h10    C14.776,1,15,1.224,15,1.5V8.5z",gradient:{id:"SVGID_1_",type:"linear",x1:9.5,y1:.9512,x2:9.5,y2:8.9787,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:5,y:2,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:6,y:3,w:7,h:4,gradient:{id:"SVGID_2_",type:"linear",x1:9.5,y1:3.02,x2:9.5,y2:6.9606,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,10.5c0,0.276-0.224,0.5-0.5,0.5h-12C3.224,11,3,10.776,3,10.5l0,0C3,10.224,3.224,10,3.5,10h12    C15.776,10,16,10.224,16,10.5L16,10.5z",gradient:{id:"SVGID_3_",type:"linear",x1:9.5,y1:9.9941,x2:9.5,y2:10.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:6,y:10.001,w:2,h:.999,gradient:{id:"SVGID_4_",type:"linear",x1:7,y1:10.0059,x2:7,y2:10.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,12.5c0,0.276-0.224,0.5-0.5,0.5h-10C1.224,13,1,12.776,1,12.5v-7C1,5.224,1.224,5,1.5,5h10    C11.776,5,12,5.224,12,5.5V12.5z",gradient:{id:"SVGID_5_",type:"linear",x1:6.4995,y1:4.9512,x2:6.4995,y2:12.9792,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:6,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:3,y:7,w:7,h:4,gradient:{id:"SVGID_6_",type:"linear",x1:6.4995,y1:7.02,x2:6.4995,y2:10.9611,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M13,14.5c0,0.276-0.224,0.5-0.5,0.5h-12C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h12    C12.776,14,13,14.224,13,14.5L13,14.5z",gradient:{id:"SVGID_7_",type:"linear",x1:6.4995,y1:13.9941,x2:6.4995,y2:14.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:14.001,w:2,h:.999,gradient:{id:"SVGID_8_",type:"linear",x1:4,y1:14.0059,x2:4,y2:14.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Me("link_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:2.5,y:2.5},p2:{x:13.5,y:13.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:11.5371,y1:11.5371,x2:14.2155,y2:14.2155,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:3,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:1.4956,y1:1.4956,x2:4.1473,y2:4.1473,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:3,cy:3,rx:1,ry:1,fill:"#FFFFFF"}]}),Me("linksubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,7.661c0-1.202-0.642-2.247-1.596-2.835C12.848,3.188,11.314,2,9.486,2  c-1.587,0-2.95,0.902-3.649,2.211C4.573,4.22,3.548,5.194,3.438,6.432C3.389,6.429,3.342,6.417,3.292,6.417  C2.026,6.417,1,7.443,1,8.708C1,9.975,2.026,11,3.292,11h8.371l0,0C13.506,11,15,9.506,15,7.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.959,x2:7.9995,y2:11.0921,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,10C2.58,10,2,9.42,2,8.708c0-0.712,0.58-1.292,1.292-1.292C3.286,7.422,3.332,7.427,3.379,7.43  l0.969,0.058L4.435,6.52C4.5,5.779,5.106,5.216,5.844,5.211l0.595-0.004l0.28-0.524C7.273,3.645,8.334,3,9.486,3  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,6.11,14,6.851,14,7.661C14,8.951,12.951,10,11.661,10H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.292,10h8.37c1.11,0,2.04-0.781,2.276-1.821c-0.131-0.615-0.5-1.158-1.058-1.501l-0.307-0.189  l-0.116-0.341C12.021,4.863,10.828,4,9.486,4C8.334,4,7.273,4.645,6.719,5.682l-0.28,0.524L5.844,6.211  C5.106,6.216,4.5,6.779,4.435,7.52L4.349,8.487L3.379,8.43C3.332,8.427,3.286,8.422,3.292,8.417c-0.535,0-0.994,0.328-1.19,0.792  C2.297,9.672,2.757,10,3.292,10z",gradient:{id:"SVGID_2_",type:"linear",x1:8.019,y1:4.084,x2:8.019,y2:9.8062,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"line",p1:{x:8.01,y:8.01},p2:{x:13.186,y:13.186},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:8,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:6.7881,y1:6.7881,x2:9.9924,y2:9.9924,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:8,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:11.5791,y1:11.5791,x2:14.3132,y2:14.3132,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Me("node_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,11.5c0,0.276-0.224,0.5-0.5,0.5h-13C1.224,12,1,11.776,1,11.5v-9C1,2.224,1.224,2,1.5,2h13  C14.776,2,15,2.224,15,2.5V11.5z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.939,x2:7.9995,y2:11.9739,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:3,w:12,h:8,fill:"#FFFFFF"},{shape:"rect",x:3,y:4,w:10,h:6,gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:4.0513,x2:7.9995,y2:9.865,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.5c0,0.276-0.224,0.5-0.5,0.5h-15C0.224,15,0,14.776,0,14.5v-1C0,13.224,0.224,13,0.5,13h15  c0.276,0,0.5,0.224,0.5,0.5V14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:7.9995,y1:13.0508,x2:7.9995,y2:14.9258,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M9,14.5C9,14.224,8.776,14,8.5,14h-5C3.224,14,3,14.224,3,14.5V15h6V14.5z",gradient:{id:"SVGID_4_",type:"linear",x1:5.9995,y1:14.0508,x2:5.9995,y2:15.9258,stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"},{offset:"0.4637",color:"#449981"},{offset:"0.7764",color:"#2C8E73"},{offset:"1",color:"#218A6E"}]}}]}),Me("shapelink_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:7.5,y:2.5},p2:{x:2.5,y:7.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"line",p1:{x:2.5,y:7.5},p2:{x:8.5,y:13.5},lineColor:"url(#SVGID_2_)",lineWidth:1},{shape:"line",p1:{x:9,y:13.186},p2:{x:13.5,y:6.5},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:7,cy:3,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:5.5864,y1:1.5864,x2:8.4149,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:7,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5864,y1:6.5864,x2:3.4142,y2:9.4142,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:8,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:6.5869,y1:11.5869,x2:9.4147,y2:14.4147,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:8,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:7,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:11.5859,y1:5.5859,x2:14.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:7,rx:1,ry:1,fill:"#FFFFFF"}]}),Me("shapenode_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,3h-9l-4,4v7h13L9,8.5L14.5,3z M12.086,13H2.5V7.414L5.914,4h6.172l-4.5,4.5L12.086,13z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:3.209,x2:7.9995,y2:13.6621,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:6,cy:3,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:4.5859,y1:1.5859,x2:7.4151,y2:4.4151,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:6,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:11.5869,y1:1.5864,x2:14.4153,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:9,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:7.5864,y1:6.5864,x2:10.4149,y2:9.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:9,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:7,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5859,y1:5.5859,x2:3.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:7,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12.825,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:11.4111,y1:11.5869,x2:14.2396,y2:14.4153,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:12.825,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Me("shapesubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,6.661c0-1.202-0.642-2.247-1.596-2.835C12.848,2.188,11.314,1,9.486,1  c-1.587,0-2.95,0.902-3.649,2.211C4.573,3.22,3.548,4.194,3.438,5.432C3.389,5.429,3.342,5.417,3.292,5.417  C2.026,5.417,1,6.443,1,7.708S2.026,10,3.292,10h8.371l0,0C13.506,10,15,8.505,15,6.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.3755,x2:7.9995,y2:9.733,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,9C2.58,9,2,8.42,2,7.708s0.58-1.292,1.292-1.292C3.286,6.422,3.332,6.427,3.379,6.43l0.969,0.058  L4.435,5.52C4.5,4.779,5.106,4.216,5.844,4.211l0.595-0.004l0.28-0.524C7.273,2.645,8.334,2,9.486,2  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,5.11,14,5.851,14,6.661C14,7.951,12.951,9,11.661,9H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.272,9h8.37c1.11,0,2.039-0.689,2.275-1.729c-0.131-0.615-0.499-1.249-1.057-1.593l-0.307-0.189  l-0.116-0.341C12.002,3.863,10.809,3,9.468,3C8.314,3,7.254,3.645,6.7,4.682L6.42,5.207L5.825,5.211  C5.087,5.216,4.481,5.779,4.416,6.52L4.33,7.487L3.36,7.43C3.313,7.427,3.267,7.422,3.272,7.417c-0.535,0-0.994,0.327-1.19,0.792  C2.278,8.672,2.738,9,3.272,9z",gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:3.459,x2:7.9995,y2:8.4597,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M11.516,7.102h-8l2.469,6h8.5L11.516,7.102z M5.024,8.123h5.905l1.938,3.979H6.662L5.024,8.123z",gradient:{id:"SVGID_3_",type:"linear",x1:7.4443,y1:7.1724,x2:10.1111,y2:12.8383,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"5,8.112 10.904,8.112 12.842,12.092 6.638,12.092 z",fill:"#FFFFFF"},{shape:"ellipse",cx:5,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:3,y1:8,x2:7,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:5,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:10,y1:8,x2:14,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:12,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:7,cy:12,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:5,y1:12,x2:9,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:7,cy:12,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:14,cy:12,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:12,y1:12,x2:16,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:14,cy:12,rx:1,ry:1,fill:"#FFFFFF"}]}),Me("subnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:10,y:14.001,w:2,h:1,gradient:{id:"SVGID_1_",type:"linear",x1:11,y1:14.0059,x2:11,y2:14.9481,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:14,y:10.001,w:1,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:14.5,y1:10.0117,x2:14.5,y2:11.8962,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,6.001c0,0.552-0.447,1-1,1H8c-0.552,0-1-0.448-1-1v-4c0-0.552,0.448-1,1-1h7   c0.553,0,1,0.448,1,1V6.001z",gradient:{id:"SVGID_3_",type:"linear",x1:11.5,y1:.96,x2:11.5,y2:6.2265,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:2.001,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:9,y:3.001,w:5,h:2,gradient:{id:"SVGID_4_",type:"linear",x1:11.5,y1:2.7007,x2:11.5,y2:5.0337,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,8.501c0,0.276-0.225,0.5-0.5,0.5h-8c-0.276,0-0.5-0.224-0.5-0.5l0,0c0-0.276,0.224-0.5,0.5-0.5   h8C15.775,8.001,16,8.225,16,8.501L16,8.501z",gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:7.126,x2:11.5,y2:8.5535,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:8.001,w:1,h:.999,gradient:{id:"SVGID_6_",type:"linear",x1:9.5,y1:8.0063,x2:9.5,y2:8.9477,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M9,12c0,0.553-0.447,1-1,1H1c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12z   ",gradient:{id:"SVGID_7_",type:"linear",x1:4.4995,y1:6.959,x2:4.4995,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:1,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:2,y:9,w:5,h:2,gradient:{id:"SVGID_8_",type:"linear",x1:4.5,y1:8.6997,x2:4.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M9,14.5C9,14.776,8.775,15,8.5,15h-8C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h8   C8.775,14,9,14.224,9,14.5L9,14.5z",gradient:{id:"SVGID_9_",type:"linear",x1:4.4995,y1:13.125,x2:4.4995,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:14,w:1,h:1,gradient:{id:"SVGID_10_",type:"linear",x1:2.5,y1:14.0049,x2:2.5,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.501c0,0.276-0.224,0.5-0.5,0.5h-2c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h2c0.276,0,0.5,0.224,0.5,0.5V14.501z",gradient:{id:"SVGID_11_",type:"linear",x1:14.5,y1:13.0117,x2:14.5,y2:14.8962,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]});
var Le={_hitCanvas:null,getHitCanvas:function(a,b){null==this._hitCanvas&&(this._hitCanvas=Wc.createCanvas()),0==arguments.length&&(a=2,b=2),this._hitCanvas.setAttribute("width",""+a-1),this._hitCanvas.setAttribute("height",""+b-1),this._hitCanvas.setAttribute("width",""+a),this._hitCanvas.setAttribute("height",""+b);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,a,b),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(a,c,d){c!=b&&(a.fillStyle=c,a.fill()),d!=b&&(a.strokeStyle=d,a.stroke())},text:function(a,b,c,d,e,f){a.textAlign="center",a.textBaseline="middle",null!=e&&(a.fillStyle=e,a.fillText(b,c,d)),f&&(a.strokeStyle=f,a.strokeText(b,c,d))},circle:function(a,b,c,d,e,f){a.arc(b,c,d,0,2*Math.PI,!0),a.closePath(),this.render(a,e,f)},rect:function(a,b,c,d,e,f,g){a.rect(b,c,d,e),a.closePath(),this.render(a,f,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(a,b,c,d,e,f){var g=0;return 0>=e?g|=this.OUT_LEFT|this.OUT_RIGHT:c>a?g|=this.OUT_LEFT:a>c+e&&(g|=this.OUT_RIGHT),0>=f?g|=this.OUT_TOP|this.OUT_BOTTOM:d>b?g|=this.OUT_TOP:b>d+f&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(a,b,c,d,e,f,g,h){var i,j;if(0==(j=this.outcode(c,d,e,f,g,h)))return!0;for(;0!=(i=this.outcode(a,b,e,f,g,h));){if(0!=(i&j))return!1;if(0!=(i&(this.OUT_LEFT|this.OUT_RIGHT))){var k=e;0!=(i&this.OUT_RIGHT)&&(k+=g),b+=(k-a)*(d-b)/(c-a),a=k}else{var l=f;0!=(i&this.OUT_BOTTOM)&&(l+=h),a+=(l-b)*(c-a)/(d-b),b=l}}return!0}};Ic.vector={},Ic.vector.interaction={},Ic.vector.Network=function(a){Ic.vector.Network.superClass.constructor.apply(this,arguments),this.zoomManager=new Ic.vector.PhysicalZoomManager(this),this._view=Wc.createView("hidden"),this._rootCanvas=Wc.createCanvas(),this._topCanvas=Wc.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._zoomMap={},this._viewRectMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new Ic.List,this._topAttachmentList=new Ic.List,this.setElementBox(a?a:new Ic.ElementBox),Qc.isMSToucheable?this.setMSTouchInteractions():Qc.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1);var b=this;this._flowLink=function(){if(!(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)){b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new Ic.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a),b.invalidateElementUI(a)})}},this.setToolTipEnabled(Ic.Defaults.NETWORK_TOOLTIP_ENABLED),this._paintAll=!0,this._dirtyRects=new me,this._invalidateMap={},this._invalidateAll=!0,b._count=0,b._invalidate=!0,function c(a){requestAnimationFrame(c),b._invalidate&&(b._count++,b._now=a,b.validate())}(0)},Jc.ext("twaver.vector.Network",Ic.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","edgeDetect","dragToPan","wheelToZoom","asyncZoomAndViewRect","debug"],_currentSubNetwork:null,_subNetworkAnimate:Ic.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!1,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:Ic.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Ic.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Ic.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Ce.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:Ic.Defaults.VECTORUI_FUNCTION,_doubleClickToUpSubNetwork:Ic.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Ic.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Ic.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Ic.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Ic.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:Ic.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Ic.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Ic.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:Ic.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:Ic.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Ic.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Ic.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Ic.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Ic.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:Ic.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Ic.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Ic.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Ic.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Ic.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Ic.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Ic.Defaults.NETWORK_RESIZE_ANIMATE,_rotatePointSize:Ic.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Ic.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Ic.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Ic.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Ic.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Ce.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Ce.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Ce.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Ce.NETWORK_ROTATE_SCALE_FONT_COLOR,_editPointSize:Ic.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Ic.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Ic.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Ic.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Ic.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Ic.Defaults.NETWORK_EDIT_LINE_WIDTH,_limitElementInPositiveLocation:!1,_linkFlowInterval:Ce.NETWORK_LINK_FLOW_INTERVAL,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:Ic.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_edgeDetect:!1,_dragToPan:!0,_wheelToZoom:!0,_asyncZoomAndViewRect:!0,_debug:!1,adjustBounds:function(a){var b=!1,c=this._view.style;if(c.left==a.x+"px"&&c.top==a.y+"px"&&c.width==a.width+"px"&&c.height==a.height+"px"&&(b=!0),Ic.vector.Network.superClass.adjustBounds.apply(this,arguments),1!=b){var d=this._view.offsetWidth,e=this._view.offsetHeight;this._rootCanvas.setAttribute("width",d),this._rootCanvas.setAttribute("height",e),this._topCanvas.setAttribute("width",d),this._topCanvas.setAttribute("height",e),this.setViewRect(this.viewRect.x,this.viewRect.y,d,e),this.invalidateElementVisibility()}},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getLabel2:function(a){return a.getStyle("network.label")||a.getName2()},setZoomManager:function(a){var b=this.zoomManager;b!=a&&(this.zoomManager=a,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.invalidateElementUIs(),this.firePropertyChange("zoomManager",b,a))},getZoomManager:function(){return this.zoomManager},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){var a,b,c,d,e=this.getElementBox().getDatas()._as,f=e.length,g={},h=this._visibleFunction,i=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(a=0;f>a;a++)c=e[a],g[c._id]=this.isVisible(c,h,i);var j=this.getGraphicsZoom(),k=null,l={x:this.viewRect.x/j,y:this.viewRect.y/j,width:this.viewRect.width/j,height:this.viewRect.height/j};if(this._invalidateAll){if(this._visibleMap)for(a=0;f>a;a++)c=e[a],g[c._id]!==this._visibleMap[c._id]&&(d=this._elementUIMap[c._id],d&&d.invalidate());for(a=0;f>a;a++)c=e[a],d=this._elementUIMap[c._id],d&&d.validate();this._paintAll=!0}else if(this._paintAll){for(b in this._invalidateMap)d=this._elementUIMap[b],d&&d.invalidate();for(b in this._invalidateMap)d=this._elementUIMap[b],d&&d.validate()}else{for(b in this._invalidateMap)d=this._elementUIMap[b],d&&(this._dirtyRects.add(d.getZoomViewRect(!1)),d.invalidate());for(b in this._invalidateMap)d=this._elementUIMap[b],d&&(d.validate(),this._dirtyRects.add(d.getZoomViewRect(!0)))}this._paintAll?k=l:(this._dirtyRects.forEach(function(a){k=null==k?Jc.cloneRect(a):Tc.unionRect(k,a)}),k?(Tc.grow(k,2,2),k=Tc.intersection(k,l)):k=l),this._visibleMap=g,k&&this.paintRoot(k),this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas()),this.paintTop()},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Ic.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",b,this._box)}},handleElementBoxChange:function(a){var b=a.data;if("add"===a.kind)this.createElementUI(b),this.invalidateBundleLink(b);else if("remove"===a.kind){var c=this.getElementUI(b);c&&(this._dirtyRects.add(c.getZoomViewRect()),delete this._elementUIMap[b.getId()]),b===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),delete this._invalidateMap[b._id]}else"clear"===a.kind&&(this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),this._paintAll=!0);this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);c&&(this.invalidateElementUI(b),c.handlePropertyChange(a)),this.invalidateBundleLink(b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){"editable"===a.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(a){var b=this.getSelectionModel().getLastData();b&&("append"===a.kind||"set"===a.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b)),a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a),this.invalidateElementUI(b)},this),this.invalidateElementVisibility()},sendToTop:function(a){if(this._box.contains(a)){for(var b=a;b._parent&&this.isVisible(b._parent)&&(b=b._parent););b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)}},getViewRect:function(){return this.viewRect?Jc.cloneRect(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(a,b){var c=this.viewRect.x,d=this.viewRect.y,e=this.viewRect.width,f=this.viewRect.height;this.setViewRect(c+a,d+b,e,f)},setViewRect:function(a,b,c,d){1==this.isLimitViewInCanvas()&&(0>a&&(a=0),c>this.realWidth?a=0:a+c>this.realWidth&&(a=this.realWidth-c),0>b&&(b=0),d>this.realHeight?b=0:b+d>this.realHeight&&(b=this.realHeight-d));var e=this.viewRect;(null==this.viewRect||a!=this.viewRect.x||b!=this.viewRect.y||c!=this.viewRect.width||d!=this.viewRect.height)&&(this.viewRect={x:a,y:b,width:c,height:d},this.firePropertyChange("viewRect",e,this.viewRect),this.invalidateElementVisibility(),this._paintAll=!0)},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},setZoomVisibilityThresholds:function(a){var b=this._visibilityThresholds;this._zoomVisibilityThresholds=a,this.firePropertyChange("zoomVisibilityThresholds",b,a),this.invalidateElementVisibility()},getZoomVisibilityThresholds:function(){return this._zoomVisibilityThresholds||{}},invalidateElementVisibility:function(){this.invalidate()},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var a,b=this.getElementBox().getDatas(),c=b.size();if(c>0){for(var d=0;c>d;d++){var e=b.get(d);if(this._visibleMap[e._id]){var f=this._elementUIMap[e._id];f&&(a=a?Tc.unionRect(a,f.getZoomViewRect(!0)):Jc.cloneRect(f.getZoomViewRect(!0)))}}null==a&&(a={x:0,y:0,width:0,height:0});var g=this.getGraphicsZoom();if(this.realWidth==(a.x+a.width)*g&&this.realHeight==(a.y+a.height)*g)return;this.realWidth=(a.x+a.width)*g,this.realHeight=(a.y+a.height)*g,this._unionBounds={x:a.x*g,y:a.y*g,width:a.width*g,height:a.height*g}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(a){return null==a?null:this._elementUIMap[a._id]},getUnionBounds:function(){return this._unionBounds},getZoomBodyRect:function(a){var b=this.getElementUI(a);return b?b.getZoomBodyRect():null},getShapeNodeZoomPoints:function(a){if(a._points){var b=this.getElementUI(a);if(b)return b._getZoomPoints()}return null},createElementUI:function(a){var b=this._elementUIMap[a.getId()];if(!b){if(b=this._elementUIFunction(this,a),!b){var c=a.getClassName(),d=c.substr(c.indexOf(".")+1)+"UI",e=Ic.vector[d];e&&(b=new e(this,a))}b&&(this._elementUIMap[a.getId()]=b)}return this._invalidateMap&&(this._invalidateMap[a._id]=a),b},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==a){var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(a){if(!this._invalidateAll){this._invalidateMap[a._id]=a;{this.getElementUI(a)}if(a instanceof Je){var b=a.getAgentLinks();null!=b&&b.forEach(this.invalidateElementUI,this);var c=a.getParent();c instanceof Ic.Group&&this.invalidateElementUI(c)}this.invalidateElementVisibility()}},invalidateElementUIs:function(){this._invalidateAll=!0,this._invalidateMap={},this._visibleMap={},this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.invalidate()},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},invalidateBundleLink:function(a){if(a instanceof Ic.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},paintRoot:function(a){var c=this._rootCanvas.getContext("2d");c.save();var d=this.getGraphicsZoom();c.beginPath(),c.rect(a.x*d-this.viewRect.x,a.y*d-this.viewRect.y,a.width*d,a.height*d),c.clip(),c.clearRect(a.x*d-this.viewRect.x,a.y*d-this.viewRect.y,a.width*d,a.height*d),this.visibleList=new Ic.List,this._topAttachmentList=new Ic.List,le.draw(c,this);var e=this.getElementBox().getDatas()._as,f=e.length,g=this.zoomManager;g._zoomGraphicsBegin(c),this.paintBottom(c,a);var h,i,j,k,l=this._box._layerBox;if(1===l.size())for(h=0;f>h;h++)i=e[h],this._visibleMap[i._id]&&(j=this._elementUIMap[i._id],null!=j&&this._isInView(j,a)&&j.paint(c),this.visibleList.add(i));else l.forEachByDepthFirst(function(b){for(h=0;f>h;h++)i=e[h],l.getLayerByElement(i)===b&&this._visibleMap[i._id]&&(j=this._elementUIMap[i._id],null!=j&&this._isInView(j,a)&&j.paint(c),this.visibleList.add(i))},null,this);for(f=this._topAttachmentList.size(),h=0;f>h;h++)k=this._topAttachmentList.get(h),k.getElementUI().paintAttachment(c,k);if(this._xyz!==b){var f,m=this._xyz,n=m.markText,o=m.type,p=(m.expired,m.innerHTML),q=0,r=0,s=this.viewRect;c.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),c.scale(1/this.getZoom(),1/this.getZoom());var d=this.getZoom();n!=b&&null!=n&&""!=n||"2"==o?(c.font="15px Arial sans-serif",f=Jc.g.getTextSize(c.font,p),c.fillStyle="red",q=s.width-f.width,r=s.height-20):(c.font="10px Arial sans-serif",f=Jc.g.getTextSize(c.font,p),q=s.width/2-f.widht/2,r=s.height/2),c.fillText(p,q,r)}c.restore(),this._invalidateMap={},this._invalidateAll=!1,this._paintAll=!1,this._dirtyRects=new me},paintBottom:function(){},paintTop:function(){},_isInView:function(a,b){return Tc.intersects(b,a.getZoomViewRect())},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(a){for(var b=this.markerList.size(),c=0;b>c;c++){var d=this.markerList.get(c);d.paint(a)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint2:function(a){return this.zoomManager._getLogicalPoint(a)},getLogicalPoint:function(a){return this.zoomManager._getLogicalPoint(a,!0)},getElementAt:function(a){if(null==this.visibleList)return null;var b;if(b=a.target?this.getLogicalPoint2(a):a,null!=this._topAttachmentList)for(var c=this._topAttachmentList.size(),d=c-1;d>=0;d--){var e=this._topAttachmentList.get(d);if(e.hit(b.x,b.y))return e.getElement()}if(null!=this.visibleList)for(var f=this.visibleList.size(),g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);if(i&&i.hit(b.x,b.y))return h}return null},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);if(!c)return null;var d;return d=a.target?this.getLogicalPoint2(a):a,c.hitTest(d.x,d.y)},getElementsAtRect:function(a,c,d,e){var f=new Ic.List;if(null==this.visibleList)return f;e=e===b?!0:e;for(var g=this.visibleList.size(),h=g-1;h>=0;h--){var i=this.visibleList.get(h),j=this.getElementUI(i);j&&(!d||d(j._element))&&(e&&this.isSelectable(j._element)||!e)&&(c?j.intersects(a)&&f.add(i):Tc.contains(a,j.getZoomViewRect(ld))&&f.add(i))}return f},getPosition:function(a,b,c,d,e,f){var g,h=b instanceof Ic.vector.ElementUI?b:this.getElementUI(b);if(h)if("from"===a||"to"===a){if(h.getFromPosition&&(g="from"===a?h.getFromPosition(d,e):h.getToPosition(d,e)))return{x:g.x-c.width/2,y:g.y-c.height/2}}else g="hotspot"===a?f?h.getZoomHotSpot(this.zoomManager):h.getHotSpot():Vc.get(a,f?h.getZoomBodyRect():h.getBodyRect(),c);if(!g&&b.getRect&&(g=Vc.get(a,b.getRect(),c)),g)return{x:g.x+d,y:g.y+e};throw"position '"+a+"' object '"+b+"'"},isValidEvent:function(a){if(!a)return!1;var b,c;if(a.currentTarget===this._view){if(Qc.isFirefox?(b=a.layerX,c=a.layerY):(b=a.offsetX,c=a.offsetY),1==this.isHScrollBarVisible()&&c>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&b>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)?a instanceof Ic.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){for(var a=this.getSelectionModel().getSelection(),b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(a,b,c,d){if(0!==a||0!==b){var e=this.getMovableSelectedElementsRect();null!=e&&(this._limitElementInPositiveLocation&&(e.x+a<0&&(a=-e.x),e.y+b<0&&(b=-e.y)),Ic.Util.moveElements(this.getMovableSelectedElements(),a,b,c,d,this))}},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(0===a.size())return null;for(var b=null,c=0,d=a.size();d>c;c++){var e=a.get(c);if(e instanceof Je){var f=this.getElementUI(e);f&&(b=Tc.unionRect(b,f.getViewRect()))}}return b},isVisible:function(a,b,c){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(3!==arguments.length&&(b=this._visibleFunction),b&&!b(a))return!1;if(!(c||this._box._layerBox.getLayerByElement(a))._visible)return!1;if(vd.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(!this.zoomManager.isElementVisible(a))return!1;if(a instanceof Ic.Link){if(!this._noAgentLinkVisible){if(!a._fromAgent||!a._toAgent)return!1;if(!this.isVisible(a._fromAgent,b,c)||!this.isVisible(a._toAgent,b,c))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else for(var d=a._parent;d&&!d.ISubNetwork;){if(d instanceof Ic.Group&&(!d.isExpanded()||!this.isVisible(d,b,c)))return!1;d=d._parent}return a.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a,b){return null==this._linkableFunction||this._linkableFunction(a,b)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&"shadow"===a.getStyle("select.style")?a.getStyle("select.color"):b},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a){this.setInteractions([new Ic.vector.interaction.DefaultInteraction(this,a)])},setTouchInteractions:function(){this.setInteractions([new Ic.vector.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new Ic.vector.interaction.ScrollInteraction(this),new Ic.vector.interaction.MSTouchInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new Ic.vector.interaction.EditInteraction(this,a),new Ic.vector.interaction.DefaultInteraction(this)])},setCreateElementInteractions:function(a){this.setInteractions([new Ic.vector.interaction.CreateElementInteraction(this,a),new Ic.vector.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new Ic.vector.interaction.CreateLinkInteraction(this,a),new Ic.vector.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new Ic.vector.interaction.CreateShapeLinkInteraction(this,a),new Ic.vector.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new Ic.vector.interaction.CreateShapeNodeInteraction(this,a),new Ic.vector.interaction.DefaultInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(a){if(a){var b=a.getToolTip();return b?b:a.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){if(this._toolTipEnabled=a,a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){if(b.isMovingElement())return void Bd.hideToolTip();var c=b.getElementAt(a);if(b._preElement!==c)if(b._preElement=c,c){var d=b.getToolTip(c);Bd.showToolTip({x:a.pageX,y:a.pageY},d);var e=Bd.getToolTipDiv(),e=Bd.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(Oc.documentElement.scrollLeft||Oc.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(Oc.documentElement.scrollTop||Oc.body.scrollTop)+"px")}}else Bd.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Bd.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(a,b){if(a=this.checkZoom(a),this.isAsyncZoomAndViewRect())var c=this._zoomMap[this._currentSubNetwork].zoom;else var c=this._zoom;if(a!=c){var d=this.getViewRect();b||(b={x:d.width/2,y:d.height/2});var e=this.viewRect,f=b.x-(b.x+e.x)*a/c,g=b.y-(b.y+e.y)*a/c;this.isAsyncZoomAndViewRect()?this._zoomMap[this._currentSubNetwork].zoom=a:this._zoom=a,this._paintAll=!0,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.zoomManager._invalidateZoom(),this.setViewRect(-f,-g,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",c,this._zoom)}},getZoom:function(){if(this.isAsyncZoomAndViewRect()){var a=this._zoomMap[this._currentSubNetwork];return a||(this._zoomMap[this._currentSubNetwork]={zoom:1}),this._zoomMap[this._currentSubNetwork].zoom}return this._zoom},getSizeZoom:function(a){return this.zoomManager.getSizeZoom(a)},getLocationZoom:function(){return this.zoomManager.getLocationZoom()},getGraphicsZoom:function(){return this.zoomManager.getGraphicsZoom()},zoomOverview:function(a){if(!(this._unionBounds.width<=0||this._unionBounds.width<=0)){var b=this.getZoom(),c=this._unionBounds,d=c.width/b,e=c.height/b,f=this.viewRect.width/d,g=this.viewRect.height/e,h=Math.min(f,g);this.setZoom(h);var i=this.getZoom();if(this.setViewRect(this._unionBounds.x*i/b,this._unionBounds.y*i/b,this.viewRect.width,this.viewRect.height),1!=this.getLocationZoom()){var j=null==arguments[1]?5:arguments[1];if(j>0){j--;var k=this;setTimeout(function(){k.zoomOverview(a,j)},25)}}}},zoomReset:function(a){this.setZoom(1,a)},zoomIn:function(a){this.setZoom(1.2*this.getZoom(),a)},zoomOut:function(a){this.setZoom(this.getZoom()/1.2,a)},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(vd.getSubNetwork(this._currentSubNetwork),a,b)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,c){if(Ic.animate.AnimateManager.endAnimate(),b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var d=new Ic.animate.AnimateSubNetwork(this,a,c);Ic.animate.AnimateManager.start(d)}else this._setCurrentSubNetwork(a),c&&c()
},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork!==a){if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";if(this.isAsyncZoomAndViewRect()){var b=this._viewRectMap[this._currentSubNetwork];this._viewRectMap[this._currentSubNetwork]=b?this.viewRect:this.viewRect?this.viewRect:{x:0,y:0,width:this.viewRect.width,height:this.viewRect.height}}var c=this._currentSubNetwork;if(this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",c,a),this.isAsyncZoomAndViewRect()){this._viewRectMap[this._currentSubNetwork]||(this._viewRectMap[this._currentSubNetwork]={x:0,y:0,width:this.viewRect.width,height:this.viewRect.height});var b=this._viewRectMap[this._currentSubNetwork];this.setViewRect(b.x,b.y,b.width,b.height),this.invalidateElementUIs()}this.invalidateElementVisibility(),this.invalidateCanvasSize(),this._paintAll=!0}},makeVisible:function(a){var b=this.getElementUI(a);if(b){var c=vd.getSubNetwork(a);if(c!==this._currentSubNetwork){var d=this;return void this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){Jc.callLater(d.makeVisible,d,[a])})}for(var e=a;(e=e.getParent())&&e!==c;)e instanceof Ic.Group&&e.setExpanded(!0);var f=b.getViewRect();if(f){var g,h=b.getZoomViewRect(this.zoomManager);g=f.x==h.x&&f.y==h.y&&f.width==h.width&&f.height==h.height?{x:f.x*this.getGraphicsZoom(),y:f.y*this.getGraphicsZoom(),width:f.width*this.getGraphicsZoom(),height:f.height*this.getGraphicsZoom()}:h,Tc.intersects(this.viewRect,g)||this.isVisible(a)&&Jc.callLater(this.centerByLogicalPoint,this,[g.x+g.width/2,g.y+g.height/2])}}},centerByLogicalPoint:function(a,b){var c=a-this.viewRect.width/2,d=b-this.viewRect.height/2;this.setViewRect(c,d,this.viewRect.width,this.viewRect.height)},panByOffset:function(a,b){this.setViewOffSet(a,b)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Ce.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c,d,e,f){c||(c=Wc.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var g=c.getContext("2d");if(g.translate(-e,-f),g.clearRect(0,0,a,b),le.draw(g,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;a/this.realWidth*this.getGraphicsZoom(),b/this.realHeight*this.getGraphicsZoom();g.scale(d,d);var h=this.getElementBox().getDatas()._as,i=h.length;this._topAttachmentList=new Ic.List;var j,k,l,m,n,o,p=this.getElementBox().getLayerBox(),q=p.getRoots(),r=q.size();if(1===r)for(l=0;i>l;l++)m=h[l],this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));else for(j=0;r>j;j++)for(k=q.get(j),l=0;i>l;l++)m=h[l],p.getLayerByElement(m)===k&&this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));for(i=this._topAttachmentList.size(),l=0;i>l;l++)o=this._topAttachmentList.get(l),o.getElementUI().paintAttachment(g,o);return c},toCanvasByRegion:function(a,b,c){c||(c=Wc.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e),c._viewRect?(c._viewRect.width=d,c._viewRect.height=e):c._viewRect={x:0,y:0,width:d,height:e};var f=c.getContext("2d");if(f.clearRect(0,0,d,e),le.draw(f,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;f.save(),f.scale(b,b),f.beginPath(),f.translate(-a.x,-a.y);var g=this.getElementBox().getDatas()._as,h=g.length;this._topAttachmentList=new Ic.List;var i,j,k,l,m,n,o=this.getElementBox().getLayerBox(),p=o.getRoots(),q=p.size();if(1===q)for(k=0;h>k;k++)l=g[k],this._visibleMap[l._id]&&(m=this._elementUIMap[l._id],null!=m&&Tc.intersects(a,m.getZoomViewRect())&&m.paint(f));else for(i=0;q>i;i++)for(j=p.get(i),k=0;h>k;k++)l=g[k],o.getLayerByElement(l)===j&&this._visibleMap[l._id]&&(m=this._elementUIMap[l._id],null!=m&&Tc.intersects(a,m.getZoomViewRect())&&m.paint(f));for(h=this._topAttachmentList.size(),k=0;h>k;k++)n=this._topAttachmentList.get(k),n.getElementUI().paintAttachment(f,n);return f.restore(),c},getGroupChildrenRects:function(a){return this.zoomManager._getGroupChildrenRects(a)},convertPointFromView:function(a){return this.zoomManager._convertPointFromView(a)},getOffset:function(a,b){return this.zoomManager._getOffset(a,b)},panToCenter:function(){this.setViewRect((this.realWidth-this.viewRect.width)/2,(this.realHeight-this.viewRect.height)/2,this.viewRect.width,this.viewRect.height)},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},invalidate:function(){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}))},validate:function(){this._invalidate&&(this._invalidate=!1,this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),this._isValidating=!1)},onClickElement:function(){},onClickBackground:function(){},onDoubleClickElement:function(){},onDoubleClickBackground:function(){},onLongClickElement:function(){},onLongClickBackground:function(){},onMouseMove:function(){},onMouseEnter:function(){},onMouseLeave:function(){}}),Ic.vector.Overview=function(a){Ic.vector.Overview.superClass.constructor.apply(this,a),this._view=Wc.createView(),this._rootDiv=Wc.createDiv(),this._imageCanvas=Wc.createCanvas(),this._imageDiv=Wc.createDiv(),this._maskCanvas=Wc.createCanvas(),this._selectDiv=Wc.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,Wc.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=Wc.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(a);var b;b=Qc.isMSToucheable?Ic.vector.OverviewMSTouchInteraction:Qc.isTouchable?Ic.vector.OverviewTouchInteraction:Ic.vector.OverviewInteraction,b&&new b(this)},Jc.ext("twaver.vector.Overview",Ic.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Ce.OVERVIEW_FILL_COLOR,_outlineColor:Ce.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Ce.OVERVIEW_OUTLINE_WIDTH,_selectColor:Ce.OVERVIEW_SELECT_COLOR,_selectWidth:Ce.OVERVIEW_SELECT_WIDTH,_padding:Ce.OVERVIEW_PADDING,_animate:Ce.OVERVIEW_ANIMATE,_maxPackingWidth:Ce.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Ce.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(){this._invalidateMask()},setNetwork:function(a){a!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),Wc.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),Wc.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(a){("zoom"===a.property||"currentSubNetwork"===a.property||"elementBox"===a.property||"dataBox"===a.property||"canvasSizeChange"===a.property)&&this.invalidate()},_handleNetworkViewChange:function(a){"validateEnd"===a.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Jc.callLater(this.validate,this,null,a))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Jc.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var a,b=this._maxPackingWidth>0&&this._maxPackingHeight>0;a=b?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Tc.grow(a,-this._padding,-this._padding),b&&(Wc.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),a.width=this._imageDiv._viewRect.width,a.height=this._imageDiv._viewRect.height);var c=this._network.getGraphicsZoom(),d=this._network._unionBounds;d=Tc.unionRect(d,{x:this._network.getViewRect().x,y:this._network.getViewRect().y,width:d.x,height:d.y}),d={x:d.x/c,y:d.y/c,width:d.width/c,height:d.height/c};var e={x:this._network.viewRect.x/c,y:this._network.viewRect.y/c,width:this._network.viewRect.width/c,height:this._network.viewRect.height/c},f=Tc.unionRect(d,e),g=Math.min(a.width/f.width,a.height/f.height),h=f.width*g,i=f.height*g,j=f.width*g,k=f.height*g,l=a.x+(a.width-j)/2,m=a.y+(a.height-k)/2;if(this._isNetworkDirty){var n={x:l,y:m,width:j,height:k};this._network.toCanvas(h,i,this._exportImageCanvas,g,f.x*g,f.y*g),this._imageCanvas.setAttribute("width",j),this._imageCanvas.setAttribute("height",k),this._imageCtx.drawImage(this._exportImageCanvas,(d.x-f.x)*g*c,(d.y-f.y)*g*c,h,i),Wc.setDiv(this._imageDiv,n,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var o={x:(e.x-f.x)*g,y:(e.y-f.y)*g,width:e.width*g,height:e.height*g},p=Wc.setCanvas(this._maskCanvas,l,m,j,k);p.lineWidth=0,p.fillStyle=this._fillColor,Xc.drawVector(p,"rectangle",null,l,m,j,k),p.closePath(),p.fill(),p.stroke(),p.clearRect(l+o.x,m+o.y,o.width,o.height),p.lineWidth=this._outlineWidth,p.strokeStyle=this._outlineColor;var q=o.width-2*this._outlineWidth,r=o.height-2*this._outlineWidth;q=Math.min(q,j-2-o.x-this._outlineWidth),r=Math.min(r,k-2-o.y-this._outlineWidth),Xc.drawVector(p,"rectangle",null,l+o.x+this._outlineWidth,m+o.y+this._outlineWidth,q,r),p.closePath(),p.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return Wc.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;Tc.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network.getCanvasSize().width,(a.y-c.y)/c.height*this._network.getCanvasSize().height,b),this._invalidateMask())}}),Ic.vector.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Wc.addEventListener("touchstart","handleTouchstart",this.view,this)},Jc.ext("twaver.vector.OverviewTouchInteraction",Object,{handleTouchstart:function(a){Wc.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),zd.isMultiTouch(a)&&(this.distance=zd.getDistance(a),this.zoom=this.network.getZoom()),Wc.addEventListener("touchmove","handleTouchmove",this.view,this),Wc.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a),zd.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=zd.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?Jc.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,Wc.removeEventListener("touchmove",this.view,this),Wc.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Ic.vector.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[];var b=this;this.view.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.view.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.view.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.view.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1)},Jc.ext("twaver.vector.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){Wc.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Tc.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(null==c)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Tc.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?Jc.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Tc.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Ic.vector.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Wc.addEventListener("mousedown","handleMousedown",this.view,this)},Jc.ext("twaver.vector.OverviewInteraction",Object,{handleMousedown:function(a){this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Jc.isCtrlDown(a)&&(this.startPoint=this.endPoint,Wc.setVisible(this.overview._selectDiv,!0)),Wc.addEventListener("mousemove","handleMousemove",this.view,this),Wc.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(a){if(this.endPoint=this.overview.getLogicalPoint(a),"detail"in a&&2===a.detail)Jc.callLater(this.network.zoomReset,this.network,[this.endPoint,this.overview._animate]);else if(Wc.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,d=this.overview._selectDiv._viewRect.y,e=b.width/this.overview._selectDiv._viewRect.width,f=b.height/this.overview._selectDiv._viewRect.height,g=Math.min(e,f);this.network.setZoom(g*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var h=this.network.getCanvasSize().width*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),i=this.network.getCanvasSize().height*((d-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);Jc.callLater(this.network.centerByLogicalPoint,this.network,[h,i,this.overview._animate]),Wc.setVisible(this.overview._selectDiv,!1),Wc.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);if(this.endPoint=b,Wc.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),Wc.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,Wc.removeEventListener("mousemove",this.view,this),Wc.removeEventListener("mouseup",this.view,this))}}),Ic.vector.ElementUI=function(a,b){this._network=a,this._element=b,this._attachments=new Ic.List,this._bodyBounds=new Ic.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Jc.ext("twaver.vector.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(){},handleSelectionChange:function(){},invalidate:function(a){a===b&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this.invalidateZoom())},invalidateZoom:function(){this._zoomBodyRect=null,this._zoomViewRect=null,this._zoomHotSpot=null},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){var a=this;if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(a){a.validate()});var b;this._bodyBounds.forEach(function(a){b=Tc.unionRect(b,a)}),null==b&&(b=Jc.cloneRect(this._element.getLocation()),b.width=0,b.height=0),this._unionBodyBounds={x:b.x,y:b.y,width:b.width,height:b.height},this._attachments.forEach(function(c){b=c instanceof Ic.vector.EditAttachment?c.getElementUI()instanceof Ic.vector.LinkUI?Tc.unionRect(b,c._viewRect):Tc.unionRect(b,a._network.zoomManager._reverseElementZoomRect(a,c._viewRect)):c.getElementUI()instanceof Ic.vector.LinkUI?Tc.unionRect(b,a._network.zoomManager._getAttachmentZoomOutLineRect(c,c._viewRect)):c.getElementUI()instanceof Ic.vector.GroupUI&&c.getElementUI()._shapeRect?c instanceof Ic.vector.IconsAttachment?Tc.unionRect(b,c._viewRect):Tc.unionRect(b,a._network.zoomManager._getAttachmentZoomOutLineRect(c,c._viewRect)):Tc.unionRect(b,c._viewRect)}),this._viewRect=b}},validateImpl:function(){},setShadow:function(a,b){var c=this._network.zoomManager,d=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(b.shadowOffsetX===this._shadowXOffset&&b.shadowOffsetY===this._shadowYOffset&&b.shadowBlur===this._shadowBlur)return b;if(d){var e=c.getGraphicsZoom(),f=c.getSizeZoom();e*=f,e>1&&(e=1),b.shadowOffsetX=this._shadowXOffset*e,b.shadowOffsetY=this._shadowYOffset*e,b.shadowBlur=this._shadowBlur*e,b.shadowColor=this._shadowColor}return b},clearShadow:function(a){(0!=a.shadowOffsetX||0!=a.shadowOffsetY||0!=a.shadowBlur)&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){var d=this._network.zoomManager,e=d.getGraphicsZoom(),f=d.getSizeZoom();e*=f,e>1&&(e=1),this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var g=this._shadowBlur;g=Math.ceil(g/e),Tc.grow(b,g+1,g+1)}return b},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},addAttachment:function(a){this._attachments.add(a),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),this.invalidate(!1)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkLabel2Attachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);null!=a&&""!==a?this._labelAttachment||(this._labelAttachment=new Ic.vector.LabelAttachment(this,Ce.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var a=this._network.getLabel2(this._element);null!=a&&""!==a?this._label2Attachment||(this._label2Attachment=new Ic.vector.Label2Attachment(this,Ce.SHOW_LABEL2_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);null!=a&&""!==a?this._alarmAttachment||(this._alarmAttachment=new Ic.vector.AlarmAttachment(this,Ce.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new Ic.vector.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new Ic.vector.EditAttachment(this,Ce.SHOW_EDIT_IN_ATTACHMENT_DIV),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:Ic.Defaults.FONT},paint:function(a){if(a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore(),this._network.isDebug()){var b=this.getZoomViewRect();a.beginPath(),a.strokeStyle="yellow",a.lineWidth=1,a.strokeRect(b.x,b.y,b.width,b.height),a.stroke()}},paintBody:function(){},getZoomBodyRect:function(){return this._network.zoomManager._getElementZoomRect(this,this.getBodyRect())},getZoomHotSpot:function(){return this._zoomHotSpot||(this._zoomHotSpot=this._network.zoomManager._getZoomHotSpot(this,this._hotSpot)),Jc.clone(this._zoomHotSpot)},getZoomPointers:function(a,b){return this._network.zoomManager._getZoomPointers(a,this,b)},_getZoomViewRect:function(a,b){var c=this._network.zoomManager;if(b){var d=Jc.cloneRect(c._getAttachmentZoomRect(b,a));return d}var e=c.getLocationZoom(),f=c.getSizeZoom(this),g=this._bodyRect?this._bodyRect:this.getBodyRect();a=a||{x:g.x,y:g.y,width:0,height:0};var h=g.x+g.width/2,i=g.y+g.height/2;return{x:h*e+(a.x-h)*f,y:i*e+(a.y-i)*f,width:a.width*f,height:a.height*f}},getZoomViewRect:function(a){{var b=this._network.zoomManager,c=b.getLocationZoom();b.getGraphicsZoom()}if(1==c)return Jc.cloneRect(this._viewRect);if(!this._zoomViewRect||a){var d,e=this._getZoomViewRect(Jc.cloneRect(this._unionBodyBounds),!1);d=Tc.unionRect(d,e);this._attachments.forEach(function(a){d=a instanceof Ic.vector.EditAttachment?Tc.unionRect(d,a._viewRect):Tc.unionRect(d,a.getZoomViewRect())}),this._zoomViewRect=d}return Jc.cloneRect(this._zoomViewRect)},paintAttachments:function(a){a.beginPath();for(var b=this._attachments.size(),c=0;b>c;c++){var d=this._attachments.get(c);1==this._hitTest&&0==d.isShowOnTop()&&this.paintAttachment(a,d),1==this._intersectTest&&this.paintAttachment(a,d),0==this._hitTest&&0==this._intersectTest&&(d.isShowOnTop()?this._network._topAttachmentList.add(d):this.paintAttachment(a,d))}},paintAttachment:function(a,b){var c=this._network.zoomManager;c.isAttachmentVisible(this._element)&&(b!=this._labelAttachment&&b!=this._label2Attachment||c.isLabelVisible(this._element))&&(b!=this._alarmAttachment||c.isAlarmBalloonVisible(this._element))&&(a.beginPath(),b.paint(a),this.clearShadow(a))},getViewRect:function(){return Jc.cloneRect(this._viewRect)},getUnionBodyBounds:function(){return Jc.cloneRect(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(a){return a==b&&(a=!0),this._bodyRect||(this._bodyRect=this.createBodyRect()),a?Jc.cloneRect(this._bodyRect):this._bodyRect},getHotSpot:function(){return this._hotSpot?Jc.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(){return!1},intersects:function(a){return Tc.contains(a,this.getZoomViewRect())?!0:!1},hitCanvasRectAtBody:function(a){var b=Le.getHitCanvas(a.width,a.height),c=Le.getCtx(b);if(c.save(),c.translate(-a.x,-a.y),this._element.getImage){var d=Jc.getImageAsset(this._element.getImage());if(d&&d.getImage()instanceof Fe)return 1}this.paintBody(c);try{for(var e=c.getImageData(0,0,a.width,a.height),f=e.data,g=0;g<e.width;g++)for(var h=0;h<e.height;h++){var i=4*(h*e.width+g),j=f[i+3];if(0!==j)return c.restore(),1}}catch(k){if(Le.disposeHitCanvas(),Tc.contains(this.getUnionBodyBounds(),a))return 0}return c.restore(),-1},hitCanvasRectAtAttachments:function(a){var b=Le.getHitCanvas(a.width,a.height),c=Le.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintAttachments(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),1}}catch(j){Le.disposeHitCanvas()}return c.restore(),-1},hitCanvasRect:function(a){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var b=Tc.intersection(a,this.getZoomViewRect()),c=this.hitCanvasRectAtBody(b);if(1==c)return this._intersectTest=!1,!0;var d=this.hitCanvasRectAtAttachments(b);return 1==d?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==c)},hitCanvasPoint:function(a,b){if(!Tc.containsPoint(this.getZoomViewRect(),a,b))return!1;this._hitTest=!0;var c=this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2});return this._hitTest=!1,c},hitTest:function(a,b){if(!Tc.containsPoint(this.getZoomViewRect(),a,b))return null;var c={x:a-1,y:b-1,width:2,height:2},d=Tc.intersection(c,this.getZoomViewRect()),e=this.hitCanvasRectAtBody(d);if(1==e)return this;for(var f=this._attachments.size(),g=0;f>g;g++){var h=this._attachments.get(g);if(h.hit(a,b))return h}return 0==e?this:null}}),Ic.vector.NodeUI=function(a,b){Ic.vector.NodeUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.NodeUI",Ic.vector.ElementUI,{invalidate:function(a){this.curInterval&&clearInterval(this.curInterval),Ic.vector.NodeUI.superClass.invalidate.call(this,a)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){Ic.vector.NodeUI.superClass.validateImpl.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=Tc.getHotSpot(b.x,b.y,b.width,b.height,a),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&Ic.vector.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var a=this.getStyle("body.type");"default"===a?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===a?this.addBodyBounds(this.getVectorBody()):"default.vector"===a?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===a&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var a=this._element,b=this.getBodyRect();if(!a.getImage()||"string"==typeof a.getImage()&&!Jc.getImageAsset(a.getImage()))return b;Tc.addPadding(b,this._element,"image.padding",1);var c=Jc.cloneRect(b);return this.appendShadowBound(this,c),b=c},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(a){var b=this._element,c=b.getStyle(a+".width");if(c>0){var d=this.getBodyRect();Tc.addPadding(d,b,a+".padding",1);var e=Jc.cloneRect(d);return Tc.grow(e,2*c,2*c),e}return null},getPathRect:function(a,b){{var c=this._element,d=this.getBodyRect();this._network.zoomManager.getSizeZoom()}b&&Tc.addPadding(d,c,a+".padding",1);var e=Jc.cloneRect(d),f=c.getStyle(a+".outline.width");if(f>0)if(this._getZoomPoints){for(var g=this._element._points,h=g.size(),i=0,j=0;h>j;j++){if(0==j)var k=g.get(j),l=g.get(h-1),m=g.get(j+1);else if(j==h-1)var k=g.get(j),l=g.get(j-1),m=g.get(0);else var k=g.get(j),l=g.get(j-1),m=g.get(j+1);var n=Tc.getCenterPoint(l,m),o=Tc.getAngle(n,k),p=Math.abs(5*(f+1)*Math.sin(o));i=p>i?p:i,p=Math.abs(5*(f+1)*Math.cos(o)),i=p>i?p:i}Tc.grow(e,i,i)}else Tc.grow(e,f/2,f/2);return this.appendShadowBound(this,e),e},getZoomPathRect:function(a,b){{var c=this._element,d=this.getZoomBodyRect();this._network.zoomManager.getSizeZoom()}b&&Tc.addPadding(d,c,a+".padding",1);var e=Jc.cloneRect(d),f=c.getStyle(a+".outline.width");if(f>0)if(this._getZoomPoints){for(var g=this._getZoomPoints(),h=g.size(),i=0,j=0;h>j;j++){if(0==j)var k=g.get(j),l=g.get(h-1),m=g.get(j+1);else if(j==h-1)var k=g.get(j),l=g.get(j-1),m=g.get(0);else var k=g.get(j),l=g.get(j-1),m=g.get(j+1);var n=Tc.getCenterPoint(l,m),o=Tc.getAngle(n,k),p=Math.abs(5*(f+1)*Math.sin(o));i=p>i?p:i,p=Math.abs(5*(f+1)*Math.cos(o)),i=p>i?p:i}Tc.grow(e,i,i)}else Tc.grow(e,f/2,f/2);return this.appendShadowBound(this,e),e},paintBody:function(a){this.curInterval&&clearInterval(this.curInterval);var b=this.getStyle("body.type");"default"===b?this.drawDefaultBody(a):"vector"===b?this.drawVectorBody(a):"default.vector"===b?(this.drawVectorBody(a),this.drawDefaultBody(a)):"vector.default"===b&&(this.drawDefaultBody(a),this.drawVectorBody(a)),this._outerColor&&this.drawOuterBorder(a),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(a)
},drawOuterBorder:function(a){var b=this._element,c=b.getStyle("outer.width");if(c>0){var d=this.getZoomBodyRect();Tc.addPadding(d,b,"outer.padding",1),a.lineWidth=c,a.lineCap=b.getStyle("outer.cap"),a.lineJoin=b.getStyle("outer.join"),a.strokeStyle=this._outerColor,Xc.drawVector(a,b.getStyle("outer.shape"),null,d),a.stroke()}},drawDefaultBody:function(a){var b,c=this._element;if(c.getImage()&&("string"!=typeof c.getImage()||(b=Jc.getImageAsset(c.getImage())))){var d=this.getZoomBodyRect();Tc.addPadding(d,this._element,"image.padding",1),0!=c.getAngle()&&(a.save(),d=c.getOriginalRect(),d=this._network.zoomManager._getElementZoomRect(this,d),Ic.Util.rotateCanvas(a,d,c.getAngle())),this.setShadow(this,a);if(b&&b.getImage()instanceof Fe){var e,f=b.getImage().frames,g=b.getImage().size,h=0;e=He(f,g,0),a.drawImage(e,d.x,d.y,d.width,d.height),this.curInterval=setInterval(function(){h=(h+f.length)%f.length,e=He(f,g,h),a.drawImage(e,d.x,d.y,d.width,d.height),h++},100)}else Nd(a,c.getImage(),this.getInnerColor(),d,c,this._network);0!=c.getAngle()&&a.restore()}},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getZoomBodyRect();Tc.addPadding(d,b,"select.padding",1);var e=Jc.cloneRect(d);Tc.grow(e,c/2,c/2),a.lineWidth=c,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),Xc.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}},drawVectorBody:function(a){this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color");if(0!==b&&c&&"rectangle"===this.getStyle("vector.shape")){var d=this.getZoomBodyRect(),e=this._element.getAngle();if(0!=e){a.save();var f=this._element.getOriginalRect();f=this._network.zoomManager._getElementZoomRect(this,f),Ic.Util.rotateCanvas(a,f,e)}Xc.draw3DRect(a,c,b,d),0!=e&&a.restore()}},drawPath:function(a,b,c,d,e,f,g){var h=this._network.zoomManager,i=this._element,j=null;j="group"==b?this._shapeRect:this.getZoomBodyRect(),c&&Tc.addPadding(j,i,b+".padding",1);var k=i.getStyle(b+".outline.width");this.setShadow(this,a),0!=i.getAngle()&&(i instanceof Ke||(j=i.getOriginalRect(),j=h._getElementZoomRect(this,j)),a.save(),Ic.Util.rotateCanvas(a,j,i.getAngle()));var l,m=i.getStyle(b+".fill");if(m){l=this._innerColor&&!vd.hasDefault(this._element)?this._innerColor:i.getStyle(b+".fill.color");var n=i.getStyle(b+".gradient");n?Xc.fill(a,l,n,i.getStyle(b+".gradient.color"),j):a.fillStyle=l}var o=i.getStyle(b+".shape");m&&(a.beginPath(),e?Xc.drawLinePoints(a,e,null,f,g):Xc.drawVector(a,o,null,j),a.fill()),k>0&&(a.lineWidth=k,a.lineCap=i.getStyle(b+".cap"),a.lineJoin=i.getStyle(b+".join"),a.strokeStyle=i.getStyle(b+".outline.color"),a.beginPath(),e?Xc.drawLinePoints(a,e,d,f,g):Xc.drawVector(a,o,d,j),a.stroke()),0!=i.getAngle()&&a.restore()},hit:function(a,b){if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Jc.math.containsPoint(c,a,b))return!0}return Tc.containsPoint(this.getZoomViewRect(),a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Ic.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Jc.math.intersects(c,a))return!0}return Tc.intersects(a,this.getZoomViewRect())?this.hitCanvasRect(a):!1}}),Ic.vector.LinkUI=function(a,b){Ic.vector.LinkUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.LinkUI",Ic.vector.ElementUI,{isEditable:function(){return xd.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,Ic.vector.LinkUI.superClass.invalidate.call(this,a)},invalidateZoom:function(){this._fromPoint=null,this._toPoint=null,this._linkPoints=null,Ic.vector.LinkUI.superClass.invalidateZoom.call(this)},validateImpl:function(){this.validateBodyBounds(),Ic.vector.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var a=this.getLinkPoints();if(a&&!(a.size()<2)){var b=this._element,c=Tc.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===b.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=2*h}Tc.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(c=this._network._edgeDetect?Tc.unionRect(c,ne.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),0,0,this._network.zoomManager)):Tc.unionRect(c,ne.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset"),this._network.zoomManager))),b.getStyle("arrow.to")&&(c=this._network._edgeDetect?Tc.unionRect(c,ne.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),0,0,this._network.zoomManager)):Tc.unionRect(c,ne.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"),this._network.zoomManager))),this.appendShadowBound(this,c),this.addBodyBounds(c),this._growLinkJoinBounds(c,e)}},_growLinkJoinBounds:function(){},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(a){var b=this.getLinkPoints();if(b&&!(b.size()<2)){var c=this._element,d=c.getStyle("link.width"),e=d;if(this._outerColor){var f=c.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===c.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=c.getStyle("select.width");e+=2*h}this.setShadow(this,a),a.lineCap=c.getStyle("link.cap"),a.lineJoin=c.getStyle("link.join");var i=c.getStyle("link.pattern");g&&this.drawLinePoints(a,b,e,c.getStyle("select.color"),i),this._outerColor&&this.drawLinePoints(a,b,d+2*f,this._outerColor,i),this.drawLinePoints(a,b,d,this._innerColor||c.getStyle("link.color"),i),ne.drawLinkArrow(this,a,b,this._network.zoomManager)}},drawLinePoints:function(a,b,c,d,e){if(a.lineWidth=c,a.strokeStyle=d,this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new ud(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset"),h=Math.floor(g/(e[0]+e[1]));h>2&&(g-=(e[0]+e[1])*h),this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),Xc._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var i=this._element.getStyle("link.flow.color");i=i?i:Ce.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=i,Xc._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),Xc.drawLinePoints(a,b,e),a.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Tc.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=xd.createFromPoint(this,this._network.zoomManager)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=xd.createToPoint(this,this._network.zoomManager)),this._toPoint},getZoomBodyRect:function(){return this.getBodyRect()},getZoomViewRect:function(){return this._viewRect},createLinkPoints:function(){var a=this._network.zoomManager,b=this.getStyle("link.type"),c=new Ic.List;if(xd.isOrthogonalOrFlexionalLink(this._element))c=xd.orthogonalAndFlexional(this,b,a);else if(this._element.isLooped()){var d=this._network.getElementUI(this._element.getFromAgent());null!=d&&(this._hotSpot=xd.fillLoopedPoints(this,d.getZoomBodyRect(),c))}else{if("arc"!==b&&"triangle"!==b&&"parallel"!==b)throw"Can not resolve link type '"+b+"'";var e=this.getFromPoint(),f=this.getToPoint();this._hotSpot=xd.fillBundlePoints(this,b,e,f,c,a)}if(this._network._linkPathFunction){var g=this._network._linkPathFunction(this,c);g&&(c=g)}return c},checkAttachments:function(){Ic.vector.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);null!=a&&""!==a?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Ic.vector.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return xd.getControlPoint(this._element,this,this._network.zoomManager)},setControlPoint:function(a){if(a){var b=this.getStyle("link.type");if(xd.hasControlPoint(b)){var c=xd.getLinkSourceBounds(this,this._network.zoomManager),d=xd.getLinkTargetBounds(this,this._network.zoomManager);xd.setParamsByControlPoint(a,c,d,b,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(a,b){return Tc.containsPoint(this._viewRect,a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Ic.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(0==Tc.intersects(a,this._viewRect))return!1;var c=this.getLinkPoints(),d=c.size();if(2==d)for(var e=0;d>e;e+=2){var f=c.get(e);if(d>e+1){var g=c.get(e+1);if(Le.intersectsLine(f.x,f.y,g.x,g.y,a.x,a.y,a.width,a.height))return!0}}return this.hitCanvasRect(a)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Tc.getAngle(this._fromPoint,this._toPoint)),this._angle||0},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var d=this._shadowBlur;Tc.grow(b,d+1,d+1)}return b}}),Ic.vector.GroupUI=function(a,b){Ic.vector.GroupUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.GroupUI",Ic.vector.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(a){this._shapeRect?this.drawExpandedGroup(a):Ic.vector.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){if(this.getBodyRect(),this._shapeRect){var a=this.getPathRect("group",!1),b=this.getStyle("group.deep");Tc.grow(a,b+1,b+1),this.addBodyBounds(a)}else Ic.vector.GroupUI.superClass.validateBodyBounds.call(this)},getZoomBodyRect:function(){return this._element.isExpanded()?this.getBodyRect():Ic.vector.GroupUI.superClass.getZoomBodyRect.call(this)},getZoomViewRect:function(){return this._element.isExpanded()?this.getViewRect():Ic.vector.GroupUI.superClass.getZoomViewRect.call(this)},drawExpandedGroup:function(a){this.drawPath(a,"group",!1,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");0!==b&&c&&"rectangle"===this.getStyle("group.shape")&&Xc.draw3DRect(a,c,b,this._shapeRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element,b=this._network;if(a.isExpanded()){a.getChildren().forEach(function(a){var c=b.getElementUI(a);c&&c.validate()});var c=this.getChildrenRects();if(!c.isEmpty()){var d=a.getStyle("group.shape"),e=Uc[d];if(!e)throw"Can not resolve group shape '"+d+"'";this._shapeRect=e(c)}}return this._shapeRect?(Tc.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):Ic.vector.GroupUI.superClass.createBodyRect.call(this)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var d=this._shadowBlur;Tc.grow(b,d+1,d+1)}return b}}),Ic.vector.ShapeNodeUI=function(a,b){Ic.vector.ShapeNodeUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.ShapeNodeUI",Ic.vector.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this._reverseZoomPathRect()},drawDefaultBody:function(a){this._element._points.size()<2||(this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._getZoomPoints(),this._element._segments,this._element.getStyle("shapenode.closed")),ne.drawLinkArrow(this,a,Tc.getPointObject(this._element._points,this._element._segments)))},invalidateZoom:function(){this._zoomPoints=null,Ic.vector.LinkUI.superClass.invalidateZoom.call(this)},_getZoomPoints:function(){return this._zoomPoints=this._network.zoomManager._getShapeNodeZoomPoints(this,this._element._points),this._zoomPoints},_reverseZoomPathRect:function(){return this._network.zoomManager._reverseElementZoomRect(this,this.getZoomPathRect("vector",!0))}}),Ic.vector.ShapeLinkUI=function(a,b){Ic.vector.ShapeLinkUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.ShapeLinkUI",Ic.vector.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new Ic.List,d=this.getStyle("shapelink.type");c.add(a),null!=this._element._points&&c.addAll(this._network.zoomManager._getShapeLinkZoomPoints(this._element._points)),c.add(b);var e=c.size(),f=Math.ceil(e/2);if(e%2===0){var g=c.get(f),h=c.get(f-1);this._hotSpot={x:(g.x+h.x)/2,y:(g.y+h.y)/2}}else this._hotSpot=Jc.clone(c.get(f));var i,j,k;if("lineto"===d);else if("quadto"===d){for(i=new Ic.List(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-1>j?new Ic.List([c.get(j++),c.get(j)]):c.get(j));c=i}else if("cubicto"===d){for(i=new Ic.List(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-2>j?new Ic.List([c.get(j++),c.get(j++),c.get(j)]):e-1>j?new Ic.List([c.get(j++),c.get(j)]):c.get(j));c=i}else{if("orthogonalto"!==d)throw"Can not resolve shapelink type '"+d+"'";for(k=c.get(0),i=new Ic.List(k),j=1,e=c.size();e>j;j++)if(e-1>j){var l=Jc.clone(c.get(j)),m=l.x,n=l.y,o=m-k.x,p=n-k.y;Math.abs(o)>Math.abs(p)?(l.x=m,l.y=k.y):(l.x=k.x,l.y=n),k=l,i.add(k)}else i.add(c.get(j));c=i}return c},_growLinkJoinBounds:function(a,b){Tc.grow(a,3*b,3*b)}}),Ic.vector.GridUI=function(a,b){Ic.vector.GridUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.GridUI",Ic.vector.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?Ic.network.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage())Ic.vector.GridUI.superClass.validateBodyBounds.call(this);else{var a=this.getBodyRect(),b=Jc.clone(a),c=this._element.getStyle("outer.width");Tc.grow(b,c,c),this.appendShadowBound(this,b),this.addBodyBounds(b)}},_getZoomCellRect:function(a,b){var c=this._element.getCellRect(a,b),d=this._element.getRect(),e=d.x+d.width/2,f=d.y+d.height/2,g=this.getZoomBodyRect(),h=g.width/d.width,i=g.x+g.width/2,j=0==e?1:i/e;return{x:e*j+(c.x-e)*h,y:f*j+(c.y-f)*h,width:c.width*h,height:c.height*h}},drawGridBody:function(a){var b=this.getStyle("grid.fill"),c=this.getStyle("grid.deep"),d=this.getStyle("grid.cell.deep");if(b||0!==c||0!==d){a.beginPath();var e=this.getZoomBodyRect(),f=this.getDyeColor("grid.fill.color");if(this.setShadow(this,a),b&&(a.fillStyle=f,a.rect(e.x,e.y,e.width,e.height),a.fill()),a.closePath(),this.clearShadow(a),a.beginPath(),0!=c&&Xc.draw3DRect(a,f,c,e.x,e.y,e.width,e.height),a.closePath(),0!=d)for(var g=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count"),i=0;g>i;i++)for(var j=0;h>j;j++){var k=this._getZoomCellRect(i,j);null!=k&&(a.beginPath(),Xc.draw3DRect(a,f,d,k.x,k.y,k.width,k.height),a.closePath())}}}}),Ic.vector.RotatableNodeUI=function(a,b){Ic.vector.RotatableNodeUI.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.RotatableNodeUI",Ic.vector.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var a=this._element,b=Jc.getImageAsset(a.getImage()),c=this.getBodyRect();return b?(Tc.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(a){var b=this._element,c=Jc.getImageAsset(b.getImage()),d=this.getBodyRect();if(Tc.addPadding(d,this._element,"image.padding",1),c.getImage()){var e=this._element._getOrignalWidth(),f=this._element._getOrignalHeight(),g=this._element._getRotateRect();a.save(),a.translate(d.x-g.x+e/2,d.y-g.y+f/2),a.rotate(this._element._angle*Math.PI/180),a.drawImage(c.getImage(this._innerColor),-e/2,-f/2,e,f),a.restore()}else if(c.getSrc());else if(!c.getFunction())throw"ImageAsset '"+b.getImage()+" ' is empty"}}),Ic.vector.Attachment=function(a,b){this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._showOnTop=b},Jc.ext("twaver.vector.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return Jc.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(){},getZoomViewRect:function(){var a=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._viewRect);return a},hit:function(a,b){return Tc.containsPoint(this.getZoomViewRect(),a,b)?this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2}):!1},hitCanvasRect:function(a){var b=Le.getHitCanvas(a.width,a.height),c=Le.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paint(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),!0}}catch(j){Le.disposeHitCanvas()}return c.restore(),!1}}),Ic.vector.BasicAttachment=function(a,b){Ic.vector.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Jc.ext("twaver.vector.BasicAttachment",Ic.vector.Attachment,{paint:function(a){Ic.vector.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),c=this.getOutlineWidth(),d=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._roundRect);if(this.getElementUI().setShadow(this,a),c>0||b){if(Xc.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Xc.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}},validate:function(){Ic.vector.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();(null==a||0>=a)&&(a=1),this._viewRect=Tc.getRect(this._pointers),this._viewRect=Tc.unionRect(this._viewRect,this._roundRect),a>0&&Tc.grow(this._viewRect,2*a,2*a),this._viewRect=this._ui.appendShadowBound(this,this._viewRect);var b=this._element instanceof Ic.Link&&this._element.getStyle("link.label.rotatable");if(b){var c=this._viewRect.x+this._viewRect.width/2,d=this._viewRect.y+this._viewRect.height/2,e=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:c-e,y:d-e,width:2*e,height:2*e}}},calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+c,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h,!1);var l;if("aboveleft"===k)i.y=j.y-d-i.height,i.x=j.x-(i.width-c),l=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("aboveright"===k)i.y=j.y-d-i.height,i.x=j.x-c,l=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("belowleft"===k)i.y=j.y+d,i.x=j.x-(i.width-c),l=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("belowright"===k)i.y=j.y+d,i.x=j.x-c,l=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("leftabove"===k)i.y=j.y+c-i.height,i.x=j.x-d-i.width,l=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("leftbelow"===k)i.y=j.y-c,i.x=j.x-d-i.width,l=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("rightabove"===k)i.y=j.y+c-i.height,i.x=j.x+d,l=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("rightbelow"===k)i.y=j.y-c,i.x=j.x+d,l=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("above"===k)i.y=j.y-d-i.height,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y-d},{x:j.x+l,y:j.y-d}];else if("below"===k)i.y=j.y+d,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y+d},{x:j.x+l,y:j.y+d}];else if("left"===k)i.y=j.y-i.height/2,i.x=j.x-d-i.width,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+l},{x:j.x-d,y:j.y-l}];else{if("right"!==k)throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+l},{x:j.x+d,y:j.y-l}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h,!1),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var m=this.getPadding();0!=m&&Tc.grow(i,m,m),m=this.getPaddingLeft(),0!=m&&(i.x-=m,i.width+=m),m=this.getPaddingRight(),0!=m&&(i.width+=m),m=this.getPaddingTop(),0!=m&&(i.y-=m,i.height+=m),m=this.getPaddingBottom(),0!=m&&(i.height+=m),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},getContentWidth:function(){return Ic.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Ic.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Ic.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Ic.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Ic.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Ic.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return Ic.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return Ic.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return Ic.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return Ic.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Ic.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Ic.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Ic.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Ic.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return Ic.Defaults.ATTACHMENT_FILL},getFillColor:function(){return Ic.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return Ic.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return Ic.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Ic.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Ic.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Ic.Defaults.ATTACHMENT_CAP},getJoin:function(){return Ic.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return Ic.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Jc.clone(this._roundRect)},getContentRect:function(){return Jc.clone(this._contentRect)}}),Ic.vector.LabelAttachment=function(a,b){Ic.vector.LabelAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.LabelAttachment",Ic.vector.BasicAttachment,{paint:function(a){var b=this._element instanceof Ic.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var c=this.getZoomViewRect(),d=c.x+c.width/2,e=c.y+c.height/2;a.translate(d,e),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-d,-e)}Ic.vector.LabelAttachment.superClass.paint.apply(this,arguments);var f=this._network.zoomManager,g=f._getAttachmentZoomRect(this,this._contentRect),h=this._element.getStyle("label.align");if(f._drawText(this,a,this.text,g,this.font,this.getStyle("label.color"),h),b&&a.restore(),this._network.isDebug()){var i=f.getAttachmentSizeZoom(this),j=g;j.width*=i,j.height*=i,a.beginPath(),a.strokeStyle="red",a.lineWidth=2,a.strokeRect(j.x,j.y,j.width,j.height),a.stroke()}},validate:function(){this.font=this.getFont("label.font"),this.text=this.getLabel(),this._textSize=Xc.getTextSize(this.font,this.text),Ic.vector.LabelAttachment.superClass.validate.call(this)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Ic.vector.Label2Attachment=function(a,b){Ic.vector.Label2Attachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.Label2Attachment",Ic.vector.BasicAttachment,{paint:function(a){var b=this._element instanceof Ic.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var c=this.getZoomViewRect(),d=c.x+c.width/2,e=c.y+c.height/2;a.translate(d,e),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-d,-e)}Ic.vector.Label2Attachment.superClass.paint.apply(this,arguments);var f=this._network.zoomManager,g=f._getAttachmentZoomRect(this,this._contentRect),h=this._element.getStyle("label.align");if(f._drawText(this,a,this.text,g,this.font,this.getStyle("label2.color"),h),b&&a.restore(),this._network.isDebug()){var i=f.getAttachmentSizeZoom(this),j=g;j.width*=i,j.height*=i,a.beginPath(),a.strokeStyle="red",a.lineWidth=2,a.strokeRect(j.x,j.y,j.width,j.height),a.stroke()}},validate:function(){this.font=this.getFont("label2.font"),this.text=this.getLabel(),this._textSize=Xc.getTextSize(this.font,this.text),Ic.vector.LabelAttachment.superClass.validate.call(this)},getLabel:function(){return this._network.getLabel2(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),Ic.vector.AlarmAttachment=function(a,b){Ic.vector.AlarmAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.AlarmAttachment",Ic.vector.BasicAttachment,{paint:function(a){Ic.vector.AlarmAttachment.superClass.paint.apply(this,arguments);var b=this._network.zoomManager,c=b._getAttachmentZoomRect(this,this._contentRect);b._drawText(this,a,this.text,c,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=Xc.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),Ic.vector.AlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")
}}),Ic.vector.LinkHandlerAttachment=function(a,b){Ic.vector.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.LinkHandlerAttachment",Ic.vector.BasicAttachment,{paint:function(a){var b=this._network.zoomManager;Ic.vector.LinkHandlerAttachment.superClass.paint.apply(this,arguments);var c=b._getAttachmentZoomRect(this,this._contentRect);b._drawText(this,a,this.linkHandlerLabel,c,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=Xc.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),Ic.vector.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Ic.vector.IconsAttachment=function(a,b){Ic.vector.IconsAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.IconsAttachment",Ic.vector.Attachment,{isShadowable:function(){return Ic.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(Ic.vector.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var a=this._makeGroup(this.iconsNames),b=this._makeGroup(this._network.getIconsColors(this._element)),c=this._network.zoomManager;len=a.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[],this.iconsOrientations=[];var d,e,f;for(i=0;len>i;i++){var g=a[i],f=this.iconsOrientation[i]||"right",h=this.iconsPosition[i]||"topleft.bottomright",j=this.iconsXgap[i]||1,k=this.iconsYgap[i]||1,l=this.iconsXoffset[i]||0,m=this.iconsYoffset[i]||0;e=null,d=this._getIconsSize(g,f,j,k,c),d&&(e=this._network.getPosition(h,this._ui,d,l,m),this._iconLocation=e,"top"===f?e.y+=d.height:"left"===f&&(e.x+=d.width)),this.locations.push(e),this.iconsSizes.push(d),this.iconsOrientations.push(f)}var n=null;for(i=0;i<this.locations.length;i++)e=this.locations[i],d=this.iconsSizes[i],f=this.iconsOrientations[i],null!=e&&(n=null==n?"top"===f?{x:e.x,y:e.y-d.height,width:d.width,height:d.height}:"left"===f?{x:e.x-d.width,y:e.y,width:d.width,height:d.height}:{x:e.x,y:e.y,width:d.width,height:d.height}:"top"===f?Tc.unionRect(n,{x:e.x,y:e.y-d.height,width:d.width,height:d.height}):"left"===f?Tc.unionRect(n,{x:e.x-d.width,y:e.y,width:d.width,height:d.height}):Tc.unionRect(n,{x:e.x,y:e.y,width:d.width,height:d.height}));this._viewRect=c?n||this.getElementUI().getViewRect():n||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=a,this.colorGroups=b}},_makeGroup:function(a){if(!Array.isArray(a))return[[a]];var b,c,d,e=[],f=!1,g=a.length;for(b=0;g>b;b++)c=a[b],Array.isArray(c)?(f=!0,e.push(c)):(d=[c],e.push(d));return f||(e.length=0,e.push(a)),e},_makeArray:function(a,b,c){if(Array.isArray(a))return a;for(var d=[],e=0;b>e;e++)d.push(a||c);return d},paint:function(a){if(Ic.vector.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var b,c,d,e,f,g,h,i,j,k,l=this._network.zoomManager;for(b=0;b<this.iconsGroups.length;b++)if(c=this.locations[b]){f=c.x,g=c.y,e=this.iconsGroups[b],h=this.colorGroups[b],i=this.iconsOrientation[b],j=this.iconsXgap[b]||1,k=this.iconsYgap[b]||1,d=0;for(var m in e){var n=null,o=null;h&&h.length>d&&(o=h[d++]);var p=Jc.getImageAsset(e[m]);if(null!=p){if(l&&this._ui instanceof Ic.vector.GroupUI&&this._ui._shapeRect){var q=l.getAttachmentSizeZoom(this),r=p.getWidth()*q,s=p.getHeight()*q;if("right"===i)n={x:f,y:g,width:r,height:s},f+=n.width+j;else if("left"===i)n={x:f-r,y:g,width:r,height:s},f-=n.width+j;else if("top"===i)n={x:f,y:g-s,width:r,height:s},g-=n.height+k;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";n={x:f,y:g,width:r,height:s},g+=n.height+k}}else{if("right"===i)n={x:f,y:g,width:p.getWidth(),height:p.getHeight()},f+=n.width+j;else if("left"===i)n={x:f-p.getWidth(),y:g,width:p.getWidth(),height:p.getHeight()},f-=n.width+j;else if("top"===i)n={x:f,y:g-p.getHeight(),width:p.getWidth(),height:p.getHeight()},g-=n.height+k;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";n={x:f,y:g,width:p.getWidth(),height:p.getHeight()},g+=n.height+k}n=l._getAttachmentZoomOutLineRect(this,n)}Nd(a,p.getImage(o,n.width,n.height),o,n,this._element,this._network)}}}}},_getIconsSize:function(a,b,c,d,e){var f=0,g=0,h=null,i=null,j=null;for(var k in a)if(i=Jc.getImageAsset(a[k])){if("right"===b)h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},f+=h.width+c;else if("left"===b)h={x:f-i.getWidth(),y:g,width:i.getWidth(),height:i.getHeight()},f-=h.width+c;else if("top"===b)h={x:f,y:g-i.getHeight(),width:i.getWidth(),height:i.getHeight()},g-=h.height+d;else{if("bottom"!==b)throw"Can not resolve '"+b+"' orientation";h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},g+=h.height+d}j=null==j?Jc.clone(h):Tc.unionRect(j,h)}return j?e&&this._ui instanceof Ic.vector.GroupUI&&this._ui._shapeRect?{width:Math.abs(j.width)*e.getAttachmentSizeZoom(this),height:Math.abs(j.height)*e.getAttachmentSizeZoom(this)}:{width:Math.abs(j.width),height:Math.abs(j.height)}:null}}),Ic.vector.EditAttachment=function(a,b){Ic.vector.EditAttachment.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.EditAttachment",Ic.vector.Attachment,{paint:function(a){Ic.vector.EditAttachment.superClass.paint.apply(this,arguments),this.paintResizingPoints(a),this.paintEditPoints(a),this.paintRotatePoints(a)},paintResizingPoints:function(a){var b=this.resizingPoints.size();if(!(0>=b)){var c=2*this.resizePointSize,d=2*this.resizePointSize,e=this._network.getResizePointFillColor(),f=this._network.getResizePointOutlineWidth(),g=this._network.getResizePointOutlineColor(),h=this._element.getAngle(),i=this._network.zoomManager,j=i._getElementZoomRect(this.getElementUI(),this._element.getOriginalRect());a.lineWidth=f;for(var k=this.resizingPoints,l=0;b>l;l++){var m=k.get(l),n={x:m.x-this.resizePointSize,y:m.y-this.resizePointSize,width:2*this.resizePointSize,height:2*this.resizePointSize},o=this._getRotateRect(n,h,{x:j.x+j.width/2,y:j.y+j.height/2});a.save(),Ic.Util.rotateCanvas(a,o,h),Le.rect(a,o.x,o.y,c,d),a.restore()}if(a.fillStyle=e,a.strokeStyle=g,a.fill(),a.stroke(),this._network.isDebug()){var p=this.getViewRect("resize");a.beginPath(),a.strokeStyle="red",a.lineWidth=1,a.strokeRect(p.x,p.y,p.width,p.height),a.stroke();var p=i._getElementZoomRect(this.getElementUI(),this.getElementUI()._viewRect);a.beginPath(),a.strokeStyle="#FD7766",a.lineWidth=1,a.strokeRect(p.x,p.y,p.width,p.height),a.stroke()}}},paintEditPoints:function(a){var b=this.editPoints.size();if(!(0>=b)){var c=this._network.getEditPointOutlineColor(),d=this._network.getEditPointFillColor(),e=this._network.getEditPointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=this.editPoints,g=0;b>g;g++){var h=f.get(g);a.beginPath(),Le.circle(a,h.x,h.y,this.editPointSize,d,c),a.closePath()}if(this._network.isDebug()){var i=this.getViewRect("edit");a.beginPath(),a.strokeStyle="blue",a.lineWidth=1,a.strokeRect(i.x,i.y,i.width,i.height),a.stroke()}}},paintRotatePoints:function(a){var b=this.rotatePoints.size();if(!(0>=b)){var c=this._network.getRotatePointOutlineColor(),d=this._network.getRotatePointFillColor(),e=this._network.getRotatePointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=this.rotatePoints,g=0;b>g;g++){var h=f.get(g);a.beginPath(),Le.circle(a,h.x,h.y,this.rotatePointSize,d,c),a.closePath(),a.beginPath()}if(this._network.isDebug()){var i=this.getViewRect("rotate");a.beginPath(),a.strokeStyle="green",a.lineWidth=1,a.strokeRect(i.x,i.y,i.width,i.height),a.stroke()}}},getViewRect:function(a){if(a){if("resize"===a)return this._resizeRect;if("rotate"===a)return this._rotateRect;if("edit"===a)return this._editRect}return this._viewRect||{x:0,y:0,width:0,height:0}},validate:function(){Ic.vector.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new Ic.List,this.editPoints=new Ic.List,this.rotatePoints=new Ic.List,this._element instanceof Ic.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Je)||this._element instanceof Ic.ShapeNode||this._element instanceof Ic.Grid||this._element instanceof Ic.Group||this._addRotatePoint(this._element),this._element instanceof Ic.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Ic.vector.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof Ic.vector.LinkUI&&this._addLinkControlPoint(this._ui);var a=this._network.getResizePointOutlineWidth(),b=this.getElementUI().getZoomBodyRect(),c=2*Math.sqrt(2);if(this._resizeOffset=(this.resizePointSize+a+1)*c,Tc.grow(b,this._resizeOffset,this._resizeOffset),this._resizeRect=b,a=this._network.getEditPointOutlineWidth(),this.editPoints.size()>0){var d=Tc.getRect(this.editPoints);Tc.grow(d,2*this.editPointSize+2*a),b=Tc.unionRect(b,d)}if(this._editRect=d,a=this._network.getRotatePointOutlineWidth(),this.rotatePoints.size()>0){var e=this.rotatePoints.get(0),f={x:e.x-this.rotatePointSize-a-1,y:e.y-this.rotatePointSize-a-1,width:2*this.rotatePointSize+2*a+2,height:2*this.rotatePointSize+2*a+2};b=Tc.unionRect(b,f),this._rotateRect=f}this._viewRect=b},_addResizingPoint:function(a){var b=this._network.zoomManager._getElementZoomRect(this.getElementUI(),a.getOriginalRect());if(b){var c=this._network.getResizePointSize();if(!(0>=c)){var d=new me([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),e=this._network.getResizePointOutlineWidth(),f=this._network.getResizePointOutlineColor(),g=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,e,f,g,!0)}}},_addRotatePoint:function(a){var b=this._network.zoomManager._getElementZoomRect(this.getElementUI(),a.getOriginalRect());if(b){var c=this._network.getRotatePointSize();if(!(0>=c)){var d=2*c,e=new Ic.List([{x:b.x+b.width/2,y:b.y-this._network.getRotatePointOffset()-d/2}]),f=a.getAngle();0!=f&&(e=this._rotatePointList(e,f,b));var g=e.get(0),h={x:g.x-d/2,y:g.y-d/2,width:d,height:d},i=this._network.getRotatePointOutlineWidth(),j=this.rotatePointSize+i;Tc.grow(b,j,j);{Tc.unionRect(a.getRect(),h)}this.rotatePoints=e}}},_addShapeNodePoint:function(a){var b=this._network.zoomManager._getShapeNodeZoomPoints(this.getElementUI(),a.getPoints());this._addEditPoints(b)},_addShapeLinkPoints:function(a){var b=this._network.zoomManager._getShapeLinkZoomPoints(a.getPoints());this._addEditPoints(b)},_addLinkControlPoint:function(a){if(xd.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var c=new Ic.List;c.add(b),this._addEditPoints(c)}}},_addEditPoints:function(a){var b=Tc.getRect(a);if(b){var c=this._network.getEditPointSize();if(!(0>=c)){var d=this._network.getEditPointOutlineWidth();this._addPoints(b,a,d,!1)}}},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>g)){var h=g+c;Tc.grow(a,h,h),1==f?this.resizingPoints=b:this.editPoints=b}},_rotatePoint:function(a,b,c){var d=Tc.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Ic.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e},_getRotateRect:function(a,b,c){var d=Tc.createMatrix(b*Math.PI/180,c.x,c.y),e={x:a.x+a.width/2,y:a.y+a.height/2},f=d.transform(e),g=new Ic.List([{x:f.x-a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y+a.height/2},{x:f.x-a.width/2,y:f.y+a.height/2}]);return Tc.getRect(g)}}),Ic.vector.BaseZoomManager=function(a){this.network=a,this.visibilityThresholds=a.visibilityThresholds},Jc.ext("twaver.vector.BaseZoomManager",Object,{getZoom:function(){return this.network.getZoom()},getGraphicsZoom:function(){return 1},getSizeZoom:function(){return 1},getAttachmentSizeZoom:function(a){var b=a.getElementUI();return this.getSizeZoom(b)},getLocationZoom:function(){return 1},_getZoomVisibilityThresholds:function(){return this.network.getZoomVisibilityThresholds()},_convertPointFromView:function(a){var b=a.x*this.getGraphicsZoom()-this.network.getViewRect().x,c=a.y*this.getGraphicsZoom()-this.network.getViewRect().y;return{x:b,y:c}},_getElementViewRect:function(a,b){var c=this.getLocationZoom(),d=this.getSizeZoom(a);if(1==c&&1==d)return b;var e=this._getZoomPoint(a),f=e.x,g=e.y;return null==b&&console.log("View rect is null"),{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d,width:b.width*d,height:b.height*d}},_invalidateZoom:function(){this.network.invalidateElementUIs()},_getGroupChildrenRects:function(a){var b=new me;return a.getChildren().forEach(function(a){if(a instanceof Je){var c=this.network.getElementUI(a);if(c){var d=c.getZoomViewRect(this);d&&b.add(d)}}},this),b},_zoomGraphicsBegin:function(a){var b=this.network,c=this.getGraphicsZoom();a.scale(c,c),a.translate(Math.floor(-b.viewRect.x/c),Math.floor(-b.viewRect.y/c))},_getEditZoomPoints:function(a,b){var c=this.getLocationZoom(),d=this.getSizeZoom(a);if(1==c&&1==d||a instanceof Ic.vector.LinkUI&&!(a instanceof Ic.vector.ShapeLinkUI))return b;var e;e=a instanceof Ic.vector.ShapeLinkUI?Tc.getCenterPoint(Tc.getRect(b)):this._getZoomPoint(a);var f=e.x,g=e.y;if(b.forEach){var h,i=new me;return b.forEach(function(a){a instanceof me?(h=new me,a.forEach(function(a){h.add({x:f*c+(a.x-f)*d,y:g*c+(a.y-g)*d})}),i.add(h)):i.add({x:f*c+(a.x-f)*d,y:g*c+(a.y-g)*d})}),i}return b.x?{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d}:void 0},_getShapeNodeZoomPoints:function(a,b,c){var d=this.getLocationZoom(),e=this.getSizeZoom(a);if(1==d&&1==e)return b;c&&(d=1/d,e=1/e);var f,g=Tc.getRect(b),h=g.x+g.width/2,i=g.y+g.height/2,j=new me;return b.forEach(function(a){a instanceof me?(f=new me,a.forEach(function(a){f.add({x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e})}),j.add(f)):j.add({x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e})}),j},_getShapeLinkZoomPoints:function(a,b){var c=this.getLocationZoom(),d=c;if(1==c&&1==d)return a;b&&(c=1/c,d=1/d);var e,f=Tc.getRect(a),g=f.x+f.width/2,h=f.y+f.height/2,i=new me;return a.forEach(function(a){a instanceof me?(e=new me,a.forEach(function(a){e.add({x:g*c+(a.x-g)*d,y:h*c+(a.y-h)*d})}),i.add(e)):i.add({x:g*c+(a.x-g)*d,y:h*c+(a.y-h)*d})}),i},_getLogicalPoint:function(a,b){var c,d=b?this.getZoom():this.getGraphicsZoom(),e=this.network;if(Qc.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var f=this._view.getBoundingClientRect(),g=a.changedTouches[0],h=Qc.isAndroid?0:zd.scrollLeft(),i=Qc.isAndroid?0:zd.scrollTop();return c={x:(g.clientX+this.viewRect.x-f.left-h)/d,y:(g.clientY+this.viewRect.y-f.top-i)/d}}return c=Qc.isFirefox?{x:(a.layerX+e.viewRect.x)/d,y:(a.layerY+e.viewRect.y)/d}:{x:(a.offsetX+e.viewRect.x)/d,y:(a.offsetY+e.viewRect.y)/d}},_getVisibleRect:function(a){return a},_getElementZoomRect:function(a,b){var c=this.getLocationZoom(),d=this.getSizeZoom(a);if(1==c&&1==d)return Jc.cloneRect(b);var e=null!=a?this._getZoomPoint(a):{x:b.x+b.width/2,y:b.y+b.height/2},f=e.x,g=e.y;return{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d,width:b.width*d,height:b.height*d}},_reverseElementZoomRect:function(a,b){var c=this.getLocationZoom(),d=this.getSizeZoom(a);if(1==c&&1==d)return Jc.cloneRect(b);var e=null!=a?this._getZoomPoint(a):{x:b.x+b.width/2,y:b.y+b.height/2},f=e.x,g=e.y;return{x:f+(b.x-f*c)/d,y:g+(b.y-g*c)/d,width:b.width/d,height:b.height/d}},_getZoomContentRect:function(a,c,d,e,f,g){var h=this.getSizeZoom(a.getElementUI()),i=this.getAttachmentSizeZoom(a),j=a.getElementUI();return g==b?j instanceof Ic.vector.GroupUI&&j._shapeRect?{x:e.x*f+1*(c.x-e.x)+(d.x-c.x)*i,y:e.y*f+1*(c.y-e.y)+(d.y-c.y)*i,width:d.width,height:d.height}:{x:e.x*f+(c.x-e.x)*h+(d.x-c.x)*i,y:e.y*f+(c.y-e.y)*h+(d.y-c.y)*i,width:d.width,height:d.height}:{x:e.x*f+(c.x-e.x)*h+(d.x-c.x)*i,y:e.y*f+(c.y-e.y)*h+(d.y-c.y)*i+g*(a.textHeight-4)*i,width:d.width,height:a.textHeight}},_getAttachmentZoomRect:function(a,c,d){var e=this.getLocationZoom(),f=a.getElementUI(),g=this.getSizeZoom(a.getElementUI()),h=this.getAttachmentSizeZoom(a),i=a._pointers;if(1==e&&1==h&&1==g)return d==b?c:{x:c.x,y:c.y+d*(a.textHeight-4),width:c.width,height:a.textHeight};var f=a.getElementUI(),j=this._getZoomPoint(f,a),k=(j.x,j.y,a.getPosition?a.getPosition():"center"),l=i?i[0]:Oe.get(k,c);return d==b?f instanceof Ic.vector.LinkUI||f instanceof Ic.vector.GroupUI&&f._shapeRect?this._getZoomContentRect(a,l,c,j,1):this._getZoomContentRect(a,l,c,j,e):this._getZoomContentRect(a,l,c,j,e,d)},_getZoomPoint:function(a,b){var c,d,e=a._element;if(e instanceof Ic.Follower&&e.getHost()&&e.getHost()instanceof Ic.Grid)return c=e.getHost(),d=c.getRect(),{x:d.x+d.width/2,y:d.y+d.height/2};if(d=a.getBodyRect(),a instanceof Ic.vector.LinkUI&&b&&b.getPosition){{b.getXOffset(),b.getYOffset()}if("from"===b.getPosition())return a._fromPoint;if("to"===b.getPosition())return a._toPoint}return{x:d.x+d.width/2,y:d.y+d.height/2}},_getZoomPointers:function(a,b,c){if(c){var d=this._getZoomPoint(b),e=this.getLocationZoom(),f=this.getSizeZoom(b),g=this.getAttachmentSizeZoom(a),h=c[0];return b instanceof Ic.vector.LinkUI?[{x:d.x+(h.x-d.x)*f,y:d.y+(h.y-d.y)*f},{x:d.x+(h.x-d.x)*f+(c[1].x-h.x)*g,y:d.y+(h.y-d.y)*f+(c[1].y-h.y)*g},{x:d.x+(h.x-d.x)*f+(c[2].x-h.x)*g,y:d.y+(h.y-d.y)*f+(c[2].y-h.y)*g}]:b instanceof Ic.vector.GroupUI&&b._shapeRect?[{x:d.x+1*(h.x-d.x),y:d.y+1*(h.y-d.y)},{x:d.x+1*(h.x-d.x)+(c[1].x-h.x)*g,y:d.y+1*(h.y-d.y)+(c[1].y-h.y)*g},{x:d.x+1*(h.x-d.x)+(c[2].x-h.x)*g,y:d.y+1*(h.y-d.y)+(c[2].y-h.y)*g}]:[{x:d.x*e+(h.x-d.x)*f,y:d.y*e+(h.y-d.y)*f},{x:d.x*e+(h.x-d.x)*f+(c[1].x-h.x)*g,y:d.y*e+(h.y-d.y)*f+(c[1].y-h.y)*g},{x:d.x*e+(h.x-d.x)*f+(c[2].x-h.x)*g,y:d.y*e+(h.y-d.y)*f+(c[2].y-h.y)*g}]}},_getZoomHotSpot:function(a,b){if(b){var c=this._getZoomPoint(a),d=this.getLocationZoom(),e=this.getSizeZoom(a);return{x:c.x*d+(b.x-c.x)*e,y:c.y*d+(b.y-c.y)*e}}return null},limitZoom:function(a){return a},_isVisible:function(a){var b,c=this._getZoomVisibilityThresholds(),d=c[a];if(null!=d){var e=c.zoomName;if(b="sizeZoom"==e?this.getSizeZoom():"locationZoom"==e?this.getLocationZoom():"graphicsZoom"==e?this.getGraphicsZoom():this.getZoom(),d>b)return!1}return!0},isElementVisible:function(a){var b=this.getZoom(),c=this._isVisible("element",b);return c&&a instanceof Ic.Link?this.isLinkVisible(a):c},isLinkVisible:function(){var a=this.getZoom();return this._isVisible("link",a)},isLabelVisible:function(){var a=this.getZoom();return this._isVisible("label",a)},isAttachmentVisible:function(){var a=this.getZoom();return this._isVisible("attachment",a)},isAlarmBalloonVisible:function(){var a=this.getZoom();return this._isVisible("alarmBallon",a)},_getAttachmentOutLineWidth:function(a){return a.getOutlineWidth()},_getAttachmentZoomOutLineRect:function(a,b){var c=this.getLocationZoom(),d=this.getAttachmentSizeZoom(a);if(1==c&&1==d)return b;var e=this._getAttachmentZoomRect(a,b,null),f=a.getElement();return this.isAttachmentVisible(f)?(a instanceof Ic.vector.LabelAttachment||a instanceof Ic.vector.Label2Attachment)&&!this.isLabelVisible(f)?{x:e.x,y:e.x,width:0,height:0}:a instanceof Ic.vector.AlarmAttachment&&!this.isAlarmBalloonVisible(f)?{x:e.x,y:e.x,width:0,height:0}:{x:e.x,y:e.y,width:e.width*d,height:e.height*d}:{x:e.x,y:e.x,width:0,height:0}},_drawText:function(a,b,c,d,e,f,g){var h=this.getLocationZoom(),i=this.getAttachmentSizeZoom(a);1!=h&&1!=i?(b.translate(d.x,d.y),b.scale(i,i),Xc.drawText(b,c,{x:0,y:0,width:d.width,height:d.height},e,f,g),b.scale(1/i,1/i),b.translate(-d.x,-d.y)):Xc.drawText(b,c,d,e,f,g)},_getOffset:function(a,b){var c=this.getLocationZoom();return{x:(a.x-b.x)/c,y:(a.y-b.y)/c}}});var Oe={"topleft.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"topleft.topright":function(a){return{x:a.x,y:a.y+a.height}},"top.top":function(a){return{x:a.x+a.width/2,y:a.y+a.height}},"topright.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"topright.topright":function(a){return{x:a.x,y:a.y+a.height}},topleft:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},top:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},topright:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"topleft.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"topleft.bottomright":function(a){return{x:a.x,y:a.y}},"top.bottom":function(a){return{x:a.x+a.width/2,y:a.y}},"topright.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"topright.bottomright":function(a){return{x:a.x,y:a.y}},"left.left":function(a){return{x:a.x+a.width,y:a.y+a.height/2}},left:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"left.right":function(a){return{x:a.x,y:a.y+a.height/2}},center:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"right.left":function(a){return{x:a.x+a.width,y:a.y+a.height/2}},right:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"right.right":function(a){return{x:a.x,y:a.y+a.height/2}},"bottomleft.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"bottomleft.topright":function(a){return{x:a.x,y:a.y+a.height}},"bottom.top":function(a){return{x:a.x+a.width/2,y:a.y+a.height}},"bottomright.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"bottomright.topright":function(a){return{x:a.x,y:a.y+a.height}},bottomleft:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},bottom:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},bottomright:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"bottomleft.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"bottomleft.bottomright":function(a){return{x:a.x,y:a.y}},"bottom.bottom":function(a){return{x:a.x+a.width/2,y:a.y}},"bottomright.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"bottomright.bottomright":function(a){return{x:a.x,y:a.y}},from:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},to:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},get:function(a,b){if(!b)throw"rect can not be null";var c=Oe[a];if(c)return c(b);throw"Can not resolve '"+a+"' position"}};Ic.vector.PhysicalZoomManager=function(){Ic.vector.PhysicalZoomManager.superClass.constructor.apply(this,arguments)},Jc.ext("twaver.vector.PhysicalZoomManager",Ic.vector.BaseZoomManager,{getGraphicsZoom:function(){return this.getZoom()},_invalidateZoom:function(){}}),Ic.vector.LogicalZoomManager=function(a,b){Ic.vector.LogicalZoomManager.superClass.constructor.apply(this,arguments),this.sizeChange=b},Jc.ext("twaver.vector.LogicalZoomManager",Ic.vector.BaseZoomManager,{getLocationZoom:function(){return this.getZoom()},getSizeZoom:function(){return this.sizeChange?this.getZoom():1}}),Ic.vector.MixedZoomManager=function(a,b){Ic.vector.MixedZoomManager.superClass.constructor.call(this,a,b)},Jc.ext("twaver.vector.MixedZoomManager",Ic.vector.LogicalZoomManager,{}),function(){function a(a){d[a]=function(){return this.getZoom()>1?b[a].apply(this,arguments):c[a].apply(this,arguments)}}var b=Ic.vector.LogicalZoomManager.prototype,c=Ic.vector.PhysicalZoomManager.prototype,d=Ic.vector.MixedZoomManager.prototype;for(var e in c)"function"==typeof c[e]&&"constructor"!=e&&(b.hasOwnProperty(e)||c.hasOwnProperty(e))&&a(e);d._invalidateZoom=function(){this.network.invalidateElementUIs()}}(),Ic.vector.interaction.BaseInteraction=function(a){this.network=a},Jc.ext("twaver.vector.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},getOffset:function(a,b){return this.network.getOffset(a,b)},convertPointFromView:function(a){return this.network.convertPointFromView(a)},convertFromUIToMarkerRect:function(a,b,c,d){var e=this.network.zoomManager,f=e.getLocationZoom(),g=e.getGraphicsZoom(),h=e.getSizeZoom(this.network.getElementUI(d));return{x:a.x*f*g-this.network.getViewRect().x+b*f*g,y:a.y*f*g-this.network.getViewRect().y+c*f*g,width:a.width*h*g,height:a.height*h*g}},getMarkerPoint:function(a){var b;if(Qc.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=a.changedTouches[0];return b={x:c.clientX,y:c.clientY}}return b=Qc.isFirefox?{x:a.layerX,y:a.layerY}:{x:a.offsetX,y:a.offsetY}},paint:function(){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];Wc.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)Wc.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){0===a.button&&(this._startLogical=this.network.getLogicalPoint2(a),this._startClient=Wc.getClientPoint(a),this._startLogical&&Wc.handle_mousedown(this,a))},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getGraphicsZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getGraphicsZoom()}},_handle_mouseup:function(){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Ic.vector.interaction.DefaultInteraction=function(a,b){Ic.vector.interaction.DefaultInteraction.superClass.constructor.call(this,a),this.lazyMode=b},Jc.ext("twaver.vector.interaction.DefaultInteraction",Ic.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout","keydown"),Qc.isFirefox?Wc.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):Wc.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),Wc.addEventListener("mouseup","handle_mouseup",a,this),this._oldCursor=this.network.getView().style.cursor,this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this),this.network.getView().oncontextmenu=function(a){a.preventDefault()},this._createZoomDiv()},tearDown:function(){this.removeListener("mousedown","mousemove","mouseover","mouseout","mouseup","keydown"),Qc.isFirefox?Wc.removeEventListener("DOMMouseScroll",this.network.getView(),this):Wc.removeEventListener("mousewheel",this.network.getView(),this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.end(),this.network.removeMarker(this),this._zoomDiv=null},_createZoomDiv:function(){if(null==this._zoomDiv){this._zoomDiv=Oc.createElement("div"),this._zoomLabel=Oc.createElement("span"),this._zoomLabel.style.display="block",this._zoomLabel.style.textAlign="center";var b=Oc.createElement("button");b.innerHTML="Reset to default",this._zoomDiv.appendChild(this._zoomLabel),this._zoomDiv.appendChild(b);var c=Ce,d=this._zoomDiv.style;d.position="absolute",d.color=c.TOOLTIP_COLOR,d.background=c.TOOLTIP_BACKGROUND,d.fontSize=c.TOOLTIP_FONT_SIZE,d.padding=c.TOOLTIP_PADDING,d.border=c.TOOLTIP_BORDER,d.borderRadius=c.TOOLTIP_BORDER_RADIUS,d.boxShadow=c.TOOLTIP_BOX_SHADOW,d.zIndex=c.TOOLTIP_ZINDEX,d.setProperty&&d.setProperty("-webkit-box-shadow",c.TOOLTIP_BOX_SHADOW,null);var e=this;b.onclick=function(){e.network.setZoom(1),e._setZoomDivVisible(!1)};var f=this._zoomDiv,g=function(){return f.style.opacity=parseFloat(f.style.opacity)-.05,parseFloat(f.style.opacity)<=.05?(e._setZoomDivVisible(!1),void(f._clearTimeout=null)):void(f._clearTimeout=setTimeout(f._clearFunc,100))};f._clearFunc=g,f.onmouseover=function(b){b||(b=a.event);for(var c=b.relatedTarget?b.relatedTarget:b.fromElement;c&&c!=f;)c=c.parentNode;c!=f&&(f._clearTimeout&&(clearTimeout(f._clearTimeout),f._clearTimeout=null),f.style.opacity=1)},f.onmouseout=function(b){b||(b=a.event);for(var c=b.relatedTarget?b.relatedTarget:b.toElement;c&&c!=f;)c=c.parentNode;c!=f&&(f._clearTimeout=setTimeout(f._clearFunc,10))}}},_isZoomDivVisible:function(){return null!=this._zoomDiv&&null!=this._zoomDiv.parentNode},_setZoomDivVisible:function(a,b,c){var d=this._zoomDiv;if(a){this._zoomLabel.innerHTML=c,d.style.opacity=1,this._isZoomDivVisible()||this.network.getView().appendChild(d),d.style.left=Ce.TOOLTIP_XOFFSET+"px",d.style.top=Ce.TOOLTIP_YOFFSET+"px";d._clearTimeout&&(clearTimeout(d._clearTimeout),d._clearTimeout=null),d._clearTimeout=setTimeout(d._clearFunc,250)}else d.parentNode&&d.parentNode.removeChild(d)},handleViewRectChange:function(a){("viewRect"==a.property||"canvasSizeChange"==a.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var a=this.network.getViewRect().height,b=this.network.getViewRect().width,c=this.network.getViewRect().x,d=this.network.getViewRect().y,e=this.network.getCanvasSize(),f=this.network._unionBounds,g=f.x,h=f.y,i=f.width,j=f.height,k=e.width,l=e.height,m=b,n=a,o=!1,p=!1;(c>g||k>b+c)&&(p=!0),(d>h||l>d+a)&&(o=!0);var q,r,s,t=0,u=0,v=0,w=0,x=m,y=n,z=this.getScrollBarWidth();p&&(o&&(x-=z),w=z,u=n-z,c>g&&c+b>k?(q=c-g,q=q*x/(q+m),t=q,v=x-q):g>c&&k>c+b?(q=k-(c+b),q=x*q/(q+m),t=0,v=x-q):(r=c-g,s=k-(c+b),r=x*r/i,s=x*s/i,t=r,v=m-r-s),this.hThumbRect={x:t,y:u,width:v,height:w}),t=0,u=0,v=0,w=0,x=m,y=n,o&&(p&&(y-=z),v=z,t=m-z,d>h&&d+a>l?(q=d-h,q=y*q/(q+n),u=q,w=y-q):h>d&&l>d+a?(q=l-(d+a),q=y*q/(q+n),u=0,w=y-q):(r=d-h,s=l-(d+a),r=y*r/j,s=y*s/j,u=r,w=y-r-s),this.vThumbRect={x:t,y:u,width:v,height:w}),this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d+f,e,c,b)},scrollYOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;
a&&(f=-30),this.network.setViewRect(d,e+f,c,b)},handle_mouseover:function(){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(){0!=this.scrollBarVisible&&(this.scrollBarVisible=!1,this.repaint())},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup"),Cd.handleKeyDown(this.network,a)},handle_keyup:function(){this.currentKeyEvent=null,this.removeListener("keyup")},start:function(b){this.end(b,!0),this.lastPoint=this.network.getLogicalPoint2(b),this.startPoint=this.network.getLogicalPoint2(b),this.lastPanPoint=this.getMarkerPoint(b),this.lazyMode&&(this.pressPoint=this.lastPoint),Wc.addEventListener("mousemove","handle_mousemove",a,this)},end:function(b,c){if(this.vBarDownPoint=null,this.hBarDownPoint=null,c||(this.network.getView().style.cursor=this._oldCursor),this.isMoving){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var d=this,e=function(){d.network.fireInteractionEvent({kind:"lazyMoveEnd",event:b}),d.network.setMovingElement(!1)},f=this.getOffset(this.dragPoint,this.pressPoint),g=f.x,h=f.y;this.network.moveSelectedElements(g,h,this.network.isLazyMoveAnimate(),e)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:b}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var d=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(d.parent)},this.network)}this.parentProcess(b,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null,this.repaint()}if(this.isSelecting&&this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var i=Tc.getRect([this.startPoint,this.endPoint]),j=this.network.getElementsAtRect(i,this.getIntersectMode(),this.network.getRectSelectFilter());if(j&&j.size()>0){var k=this.network.getSelectionModel(),l=k.toSelection();j.forEach(function(a){k.contains(a)?l.remove(a):l.add(a)},this),k.setSelection(l)}this.network.fireInteractionEvent({kind:"selectEnd",event:b})}this.network.setSelectingElement(!1),this.startPoint=null,this.endPoint=null,this.repaint()}this.isMouseDown=!1,Wc.removeEventListener("mousemove",a,this)},_isDragToSelect:function(){return!this.network._dragToPan},handle_mousedown:function(a){var b=this.network;if(a.target==b.getView()||a.target==b._topCanvas||a.target==b._rootCanvas){if(this.isMoving=!1,this.isSelecting=!1,this.hBarDownPoint=null,this.vBarDownPoint=null,this._setZoomDivVisible(!1),!this.network.isValidEvent(a)){var c=this.getMarkerPoint(a);return this.start(a),null!=this.vThumbRect&&Tc.containsPoint(this.vThumbRect,c.x,c.y)&&(this.vBarDownPoint={x:a.screenX,y:a.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),void(null!=this.hThumbRect&&Tc.containsPoint(this.hThumbRect,c.x,c.y)&&(this.hBarDownPoint={x:a.screenX,y:a.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x))}this.network.isFocusOnClick()&&Ic.Util.setFocus(this.network.getView());var d=this.network.getElementAt(a);if(this.network.isSelectingElement()||this.network.isEditingElement()||null==d||(this.network.isMovable(d)?this.isMoving=!0:this.network.getView().style.cursor="pointer",this.start(a)),!this.network.isSelectingElement()&&!this.network.isEditingElement()){var e=this.network.getSelectionModel();null==d?(Jc.isCtrlDown(a)?this.isSelecting=!0:this._isDragToSelect(a)?(this.isSelecting=!0,e.clearSelection()):this.network.isRectSelectEnabled()&&(e.clearSelection(),this.network.getView().style.cursor="pointer"),this.start(a)):Jc.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d)}2===a.detail?this.handleDoubleClicked(a,d):this.handleClicked(a,d),this.isMouseDown=!0}},handle_mousemove:function(a){this._setZoomDivVisible(!1);var b=this.network.getLogicalPoint2(a);if(b){var c={x:a.screenX,y:a.screenY},d=this.network.getCanvasSize(),e=this.network.getViewRect().height,f=this.network.getViewRect().width,g=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var h=c.x-this.hBarDownPoint.x;return this.hBarDownPoint=c,void this.network.setViewOffSet(h*d.width/(f-g),0)}if(null!=this.vBarDownPoint){var i=c.y-this.vBarDownPoint.y;return this.vBarDownPoint=c,void this.network.setViewOffSet(0,i*d.height/(e-g))}if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.isMoving||!this.isMouseDown||Jc.isCtrlDown(a))if(this.isSelecting&&(Jc.isCtrlDown(a)||this._isDragToSelect()))this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:a}:{kind:"selectBetween",event:a}),this.endPoint=b,this.repaint();else if(this.isMoving||this.isSelecting||!this.isMouseDown)this.end(a);else{if(!this.lastPanPoint||!this.network._dragToPan)return;var b=this.getMarkerPoint(a);if(!b)return;var j=b.x-this.lastPanPoint.x,k=b.y-this.lastPanPoint.y;this.network.panByOffset(-j,-k),this.lastPanPoint=b}else{var l=this.getOffset(b,this.lastPoint);if(this.xoffset=l.x,this.yoffset=l.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a}):(this.network.moveSelectedElements(this.xoffset,this.yoffset),this.lastPoint=b,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))),this.parentProcess(a,!1),this.lazyMode&&(this.dragPoint=b),(this.lazyMode||this.isParenting())&&this.repaint()}}},handleMouseWheel:function(a){if(!this.network._wheelToZoom)return void this._handleMouseWheelScroll(a);Wc.preventDefault(a);var b={x:a.offsetX||a.layerX,y:a.offsetY||a.layerY},c=this.network.getZoom();a.wheelDelta&&a.wheelDelta>0||a.detail&&a.detail<0?this.network.setZoom(1.1*c,b):this.network.setZoom(c/1.1,b),this._setZoomDivVisible(!0,a,"Zoom : "+parseFloat(this.network.getZoom().toFixed(4)))},_handleMouseWheelScroll:function(a){Wc.preventDefault(a);var b=!1,c=this._getVisibleScrollBar();null!=c&&(b=a.wheelDelta?a.wheelDelta>0:a.detail<0,"v"==c?this.scrollYOffset(b):this.scrollXOffset(b))},handle_mouseup:function(a){this.end(a)},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(a,b){var c=null;this.parent=null;var d=this;if(!b&&this.isParenting()){var e={},f=this.network.getLogicalPoint2(a);e.x=f.x-1,e.y=f.y-1,e.width=2,e.height=2;var g=this.network.getElementsAtRect(e,!0);if(g&&g.size()>0)for(var h=g.size(),i=0;h>i;i++){var j=g.get(i);if(!d.network.getElementBox().getSelectionModel().contains(j)){d.parent=j;break}}}else this.parent=null;null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==c||b?null:c},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y},_getVisibleScrollBar:function(){return 0==this.network.isScrollBarVisible()?null:null!=this.vThumbRect?"v":null!=this.hThumbRect?"h":null},paintScroll:function(a){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var b=this.getScrollBarWidth(),c=this.network.getViewRect().height,d=this.network.getViewRect().width;a.save();var e,f=this.getScrollBarColor();null!=this.hThumbRect&&(e=a.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,0,c-b,d-b,b,b/2),this.paintRoundRect(a,e,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),null!=this.vThumbRect&&(e=a.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,d-b,0,b,c-b,b/2),this.paintRoundRect(a,e,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),a.restore()}},paintRoundRect:function(a,b,c,d,e,f,g,h){a.beginPath(),a.globalAlpha=c,a.fillStyle=b,Xc.drawRoundRect(a,d,e,f,g,h),a.fill()},paint:function(a){if(this.paintScroll(a),this.network.isSelectingElement()){if(null==this.startPoint||null==this.endPoint)return;var b=this.convertPointFromView(this.startPoint),c=this.convertPointFromView(this.endPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Tc.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Le.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}else{if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;a.beginPath();var k=this.getOffset(this.dragPoint,this.pressPoint),l=k.x,m=k.y,n=this.network.getMovableSelectedElements(),o=n.size(),p=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,i=this.network.getLazyMoveOutlineWidth(),q=this.network.getLazyMoveOutlineColor();a.strokeStyle=q,a.lineWidth=i,a.fillStyle=p;for(var r=0;o>r;r++){var s=n.get(r),t=this.network.getElementUI(s);if(t){var u=this.convertFromUIToMarkerRect(t.getViewRect(),l,m);Le.rect(a,u.x,u.y,u.width,u.height)}}a.fill(),a.stroke()}if(this.parentRect){a.beginPath();var p=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,i=this.network.getLazyMoveOutlineWidth(),q=this.network.getLazyMoveOutlineColor();a.strokeStyle=q,a.lineWidth=i,a.fillStyle=p;var u=this.parentRect;Le.rect(a,u.x,u.y,u.width,u.height),a.fill(),a.stroke()}}},handleClicked:function(a,b){Cd.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){Cd.handleDoubleClicked(this.network,a,b)}}),Ic.vector.interaction.CreateElementInteraction=function(a,b){b||(b=Ic.Node),this.elementFunction=Ic.Util.isTypeOf(b,Ic.Node)?function(a){var c=new b;return c instanceof Ic.Node&&c.setCenterLocation(a),c}:b,Ic.vector.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.vector.interaction.CreateElementInteraction",Ic.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint2(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),Ic.vector.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,this.editPointSize=a.getEditPointSize(),this.resizePointSize=a.getResizePointSize(),this.rotatePointSize=a.getRotatePointSize(),Ic.vector.interaction.EditInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.vector.interaction.EditInteraction",Ic.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(a){if(1==this.lazyMode&&null!=this.resizingRect){a.lineWidth=this.network.getResizeLineWidth();var b=this.convertFromUIToMarkerRect(this.resizingRect,0,0,this.node);a.save(),Ic.Util.rotateCanvas(a,b,this.node.getAngle()),a.beginPath(),Le.rect(a,b.x,b.y,b.width,b.height,null,this.network.getResizeLineColor()),a.restore()}this.isStartRotate&&this.showRotateScale(a)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(0===a.button)if(!Jc.isAltDown(a)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Jc.isAltDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?Jc.isAltDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a)));else{var b=this.network.getElementAt(a),c=this.network.getLogicalPoint2(a);if(b instanceof Ic.ShapeNode){var d=this.getPointIndex(this.network.getShapeNodeZoomPoints(b),c,!0);d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeNode=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}if(b instanceof Ic.ShapeLink){var e=new Ic.List(b.getPoints()),f=this.network.getElementUI(b);e.add(f.getFromPoint(),0),e.add(f.getToPoint());var d=this.getPointIndex(e,c)-1;d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeLink=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}}},handle_mouseup:function(a){if(this.isStart){var b=this.network.getLogicalPoint2(a);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new Ic.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection})});Ic.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this._resetShapeNodePoints(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&b?(this._resetShapeLinkPoints(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&b&&(this._setLinkControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.clear()},handle_mousemove:function(a){if(this.network.isValidEvent(a)){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(a);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if(this.linkUI)return void this._handleMovingLinkControlPoint(a)}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var b=this.network.getElementAt(a),c=this.network.getElementUI(b);if(!c||!c.getEditAttachment())return void this.clear();var d=this.network.getLogicalPoint2(a);if(b instanceof Ic.Node){if(this.node=b,this._isEditingShapeNode(d)||this._isResizingNode(d))return void this.network.setEditingElement(!0);if(this._isRotatingElement(d))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(b instanceof Ic.ShapeLink){if(this.shapeLink=b,this._isEditingShapeLink(d))return void this.network.setEditingElement(!0)}else if(c instanceof Ic.vector.LinkUI&&xd.isOrthogonalLink(c._element)){this.linkUI=c;var e=this.linkUI.getControlPoint();return void(e&&this._contains(d,e,this.editPointSize)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}this.clear()}},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(0>=b)return!1;var c=this.network.zoomManager,d=this.network.getElementUI(this.node),e=c.getSizeZoom(d),f=c._getElementZoomRect(d,this.node.getOriginalRect()),g=this.node.getAngle();return this._isRotating(a,"crosshair",f,g,e)},_isRotating:function(a,b,c,d){var e=this.network.getRotatePointSize(),f={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-e},g=this._rotatePoint(f,d,c),h={x:g.x-e,y:g.y-e,width:2*e,height:2*e};return Tc.containsPoint(h,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint2(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=this.network.getZoomBodyRect(b),d=Tc.getCenterPoint(c);return Math.round(180*Math.atan2(d.x-a.x,a.y-d.y)/Math.PI+180)},_resetShapeNodePoints:function(a){var b=this.network.getShapeNodeZoomPoints(this.shapeNode);b.set(this.pointIndex,a);var c=this.network.getElementUI(this.shapeNode),d=this.network.zoomManager._getShapeNodeZoomPoints(c,b,!0);this.shapeNode.setPoints(d)},_handleMovingShapeNodePoint:function(a){var b=this.network.getLogicalPoint2(a);this._resetShapeNodePoints(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_resetShapeLinkPoints:function(a){var b=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink._points);b.set(this.pointIndex,a);var c=this.network.zoomManager._getShapeLinkZoomPoints(b,!0);this.shapeLink.setPoints(c)},_handleMovingShapeLinkPoint:function(a){var b=this.network.getLogicalPoint2(a);this._resetShapeLinkPoints(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_setLinkControlPoint:function(a){var b=this.linkUI.getControlPoint(),c=this.linkUI.getControlPoint(),d=(this.network.zoomManager,{x:a.x-c.x,y:a.y-c.y});b.x+=d.x,b.y+=d.y,this.linkUI.setControlPoint(b)},_handleMovingLinkControlPoint:function(a){var b=this.network.getLogicalPoint2(a);this._setLinkControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},convertFromUIToMarkerRect:function(a,b,c,d){var e=this.network.zoomManager,f=e.getLocationZoom(),g=e.getGraphicsZoom(),h=this.network.getElementUI(d),i=e.getSizeZoom(h),j=a.x+a.width/2,k=a.y+a.height/2,l=j-a.x,m=k-a.y;return{x:j*f*g-this.network.getViewRect().x+b*f*g-l*i*g,y:k*f*g-this.network.getViewRect().y+c*f*g-m*i*g,width:a.width*i*g,height:a.height*i*g}},_getReverseZoomPoint:function(a,b,c){var d=this.network.zoomManager,e=d.getLocationZoom(),f=d.getSizeZoom(this.network.getElementUI(a));return b.x*=e,b.y*=e,{x:b.x/e+(c.x-b.x)/f,y:b.y/e+(c.y-b.y)/f}},_getReverseZoomRect:function(a,b){var c=this.network.zoomManager,d=c.getLocationZoom(),e=c.getSizeZoom(f);if(d==e)return a;var f=this.network.getElementUI(b),g=f.getBodyRect(),h=g.x+g.width/2,i=g.y+g.height/2,j={x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e,width:a.width*e,height:a.height*e};return h=j.x+j.width/2,i=j.y+j.height/2,{x:h/d+(j.x-h)*e,y:i/d+(j.y-i)*e,width:a.width,height:a.height}},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0},o=this._getReverseZoomPoint(this.node,Jc.clone(f),this._endLogical);if("northwest"===this.resizeDirection&&(this._transformPoint(i,f,b),g.x=o.x,g.y=o.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),"north"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),k.y=p.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(h,f,b),j.x=o.x,j.y=o.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"west"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),n.x=p.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),l.x=p.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(j,f,b),h.x=o.x,h.y=o.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"south"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),m.y=p.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}"southeast"===this.resizeDirection&&(this._transformPoint(g,f,b),i.x=o.x,i.y=o.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),this.resizingRect=this._getReverseZoomRect(this.resizingRect,this.node),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){if(this.node instanceof Ic.ShapeNode){this.shapeNode=this.node;for(var b=this.network.getShapeNodeZoomPoints(this.node),c=0,d=b.size();d>c;c++){var e=b.get(c);if(this._contains(a,e,this.editPointSize))return this._setCrossCursor(),this.pointIndex=c,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){for(var b=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink.getPoints()),c=0,d=b.size();d>c;c++){var e=b.get(c);if(this._contains(a,e,this.editPointSize))return this._setCrossCursor(),this.pointIndex=c,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(0>=b)return!1;var c=this.network.zoomManager,d=this.network.getElementUI(this.node),e=c._getElementZoomRect(d,this.node.getOriginalRect()),f=this.node.getAngle(),g={x:e.x,y:e.y},h=this._rotatePoint(g,f,e);return this._isResizing(a,h.x,h.y,"northwest","nwse-resize")?!0:(g={x:e.x+e.width/2,y:e.y},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"north","ns-resize")?!0:(g={x:e.x+e.width,y:e.y},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"northeast","nesw-resize")?!0:(g={x:e.x,y:e.y+e.height/2},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"west","ew-resize")?!0:(g={x:e.x+e.width,y:e.y+e.height/2},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"east","ew-resize")?!0:(g={x:e.x,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"southwest","nesw-resize")?!0:(g={x:e.x+e.width/2,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"south","ns-resize")?!0:(g={x:e.x+e.width,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=Tc.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){return this._contains(a,{x:b,y:c},this.resizePointSize)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:2*c,height:2*c};return Tc.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;for(var d,e=a.get(0),f=1;f<a.size();f++){if(d=a.get(f),this.isPointOnLine(b,e,d,6))return f;e=d}return e=a.get(0),c&&this.isPointOnLine(b,e,d,6)?a.size():0},showRotateScale:function(a){var b,c,d,e,f,g=(new Ic.List,this.network.getRotateScaleWidth()),h=this.network.getRotateScaleHeight(),i=this.network.getRotatePointSize(),j=this.node.getAngle(),k=this.network.zoomManager,l=this.network.getElementUI(this.node),m=k._getElementZoomRect(l,this.node.getOriginalRect()),n={x:m.x+m.width/2,y:m.y-this.network.getRotatePointOffset()-i},o=this._rotatePoint(n,j,m),p="13px Arial",q=j+"°",r=this.network.getViewRect();1===k.getLocationZoom()&&(a.translate(-r.x,-r.y),a.scale(this.network.getZoom(),this.network.getZoom())),this.node.getAngle()>=0&&this.node.getAngle()<=180?(c={x:o.x+i,y:o.y},d={x:c.x+g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(c={x:o.x-i,y:o.y},d={x:c.x-g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y});var s=new Ic.List([c,d,e,f]),b=Jc.math.getRect(s);1!==k.getLocationZoom()&&(b.x-=r.x,b.y-=r.y),a.fillStyle=this.network.getRotateScaleFillColor(),a.fillRect(b.x,b.y,b.width,b.height),a.fillStyle=this.network.getRotateScaleFontColor(),a.textBaseline="middle",a.textAlign="center",a.font=p,a.fillText(q,b.x+b.width/2,b.y+b.height/2),1===k.getLocationZoom()&&(a.scale(1/this.network.getZoom(),1/this.network.getZoom()),a.translate(r.x,r.y))},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}return(b>=360||-360>=b)&&(b%=360),b>22.5&&67.5>=b&&(c+=1),-22.5>b&&b>=-67.5&&(c-=1),b>67.5&&112.5>=b&&(c+=2),-67.5>b&&b>=-112.5&&(c-=2),b>112.5&&157.5>=b&&(c+=3),-112.5>b&&b>=-157.5&&(c-=3),b>157.5&&202.5>=b&&(c+=4),-157.5>b&&b>=-202.5&&(c-=4),b>202.5&&247.5>=b&&(c+=5),-202.5>b&&b>=-247.5&&(c-=5),b>247.5&&292.5>=b&&(c+=6),-247.5>b&&b>=-292.5&&(c-=6),b>292.5&&337.5>=b&&(c+=7),-292.5>b&&b>=-337.5&&(c-=7),c>8&&(c-=8),0>=c&&(c+=8),d[c]}}),Ic.vector.interaction.CreateLinkInteraction=function(a,b){b||(b=Ic.Link),this.linkFunction=Ic.Util.isTypeOf(b,Ic.Link)?function(a,c){var d=new b;return d instanceof Ic.Link&&(d.setFromNode(a),d.setToNode(c)),d}:b,Ic.vector.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.vector.interaction.CreateLinkInteraction",Ic.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(a){a.beginPath();var b,c;a.lineWidth=this.network.getEditLineWidth();var d=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(b=this.network.getElementUI(this.currentNode).getZoomViewRect(!0),c=this.convertFromUIToMarkerRect(b,0,0),Le.rect(a,c.x,c.y,c.width,c.height,null,d)),this.fromNode&&(b=this.network.getElementUI(this.fromNode).getZoomViewRect(!0),c=this.convertFromUIToMarkerRect(b,0,0),Le.rect(a,c.x,c.y,c.width,c.height,null,d)),this.currentPoint&&this.paintLine(a),a.closePath()},convertFromUIToMarkerRect:function(a,b,c){var d=this.network.zoomManager,e=d.getGraphicsZoom();return{x:a.x*e-this.network.getViewRect().x+b*e,y:a.y*e-this.network.getViewRect().y+c*e,width:a.width*e,height:a.height*e}},getZoomNodeRectOrPoint:function(a,b){var c=this.network.getElementUI(a).getZoomBodyRect();return b?{x:c.x+c.width/2,y:c.y+c.height/2}:c},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.network.getElementUI(this.fromNode).getZoomBodyRect(),d=this.convertPointFromView({x:c.x+c.width/2,y:c.y+c.height/2}),e=d.x,f=d.y,g=this.currentPoint.x,h=this.currentPoint.y;a.strokeStyle=b,a.beginPath(),a.moveTo(e,f),a.lineTo(g,h),a.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(this.network.isValidEvent(a))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;this.fromNode?(this.currentNode=this.getToNode(a,this.fromNode),this.currentPoint=b,this.repaint()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.repaint()))
}},getFromNode:function(a){return this.getNode(a)},getToNode:function(a,b){return this.getNode(a,b)},getNode:function(a,b){var c=this.network.getElementAt(a);return c instanceof Je&&this.network.isLinkable(c,b)?c:null}}),Ic.vector.interaction.CreateShapeLinkInteraction=function(a,b){Ic.vector.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=Ic.ShapeLink),this.linkFunction=Ic.Util.isTypeOf(b,Ic.ShapeLink)?function(a,c,d){var e=new b;if(e instanceof Ic.ShapeLink&&(e.setFromNode(a),e.setToNode(c),d)){var f=this.network.zoomManager;e.setPoints(f._getShapeLinkZoomPoints(d,!0))}return e}:b},Jc.ext("twaver.vector.interaction.CreateShapeLinkInteraction",Ic.vector.interaction.CreateLinkInteraction,{clear:function(){this.points=null,Ic.vector.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){var b=this.network.getLogicalPoint2(a);if(b){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{if(this.points||(this.points=new Ic.List),this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}},paintLine:function(a){if(this.currentPoint){var b,c=new Ic.List;if(b=this.convertPointFromView(this.getZoomNodeRectOrPoint(this.fromNode,!0)),c.add(b,0),this.points&&this.points.size()>0)for(var d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.currentPoint,c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Xc.drawLinePoints(a,c),a.stroke()}}}),Ic.vector.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=Ic.ShapeNode),this.shapeNodeFunction=Ic.Util.isTypeOf(b,Ic.ShapeNode)?function(a){var c=new b;if(c instanceof Ic.ShapeNode){var d=this.network.zoomManager,e=this.network.createElementUI(c);if(a){var f=d._getShapeNodeZoomPoints(e,a,!0);e.invalidateZoom(),c.setPoints(f)}}return c}:b,Ic.vector.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.vector.interaction.CreateShapeNodeInteraction",Ic.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){for(var b,c=new Ic.List,d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.convertPointFromView(this.currentPoint),c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Xc.drawLinePoints(a,c),a.stroke()}},handle_mousedown:function(a){var b=this.network.getLogicalPoint2(a);if(b){if(2===a.detail){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Ic.List),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}this.repaint()}},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint2(a),this.repaint())}}),Ic.vector.interaction.MagnifyInteraction=function(a,b,c,d){Ic.vector.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.scale=b||2,this.xRadius=c||100,this.yRadius=d||100,this.markCanvas=Wc.createCanvas()},Jc.ext("twaver.vector.interaction.MagnifyInteraction",Ic.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.addListener("mousewheel"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.removeListener("mousewheel"),this.network.removeMarker(this)},paint:function(a){if(this.point){var b=this.network.zoomManager,c=b.getLocationZoom(),d=b.getGraphicsZoom(),e=(b.getSizeZoom(),this.network.getZoom(),this.xRadius/this.scale/d),f=this.yRadius/this.scale/d;if("mousewheel"===this.mouseFlag){var g={x:this.zoomPoint.x-e,y:this.zoomPoint.y-f,width:2*e,height:2*f};this.network.toCanvasByRegion(g,this.scale*d,this.markCanvas,"white");var h={x:this.zoomPoint.x-this.xRadius-this.network.viewRect.x,y:this.zoomPoint.y-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}else{var g={x:this.point.x*c-e,y:this.point.y*c-f,width:2*e,height:2*f};this.network.toCanvasByRegion(g,this.scale*d,this.markCanvas,"white");var h={x:this.point.x*c*d-this.xRadius-this.network.viewRect.x,y:this.point.y*c*d-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}a.drawImage(this.markCanvas,h.x,h.y),a.beginPath(),a.arc(h.x+h.width/2,h.y+h.height/2,Math.min(g.width*d-1,g.height*d-1),0,2*Math.PI,!0),a.strokeStyle="black",a.stroke(),this.mouseFlag=null}},handle_mousemove:function(a){this.point=this.network.getLogicalPoint(a),this.point&&(this.mouseFlag="mousemove",this.repaint())},handle_mousewheel:function(a){var b=this.network.zoomManager,c=b.getLocationZoom();1!==c&&(this.zoomPoint=this.network.getLogicalPoint2(a)),this.zoomPoint&&(this.mouseFlag="mousewheel",this.repaint())}}),Ic.vector.interaction.TouchInteraction=function(a){Ic.vector.interaction.TouchInteraction.superClass.constructor.call(this,a)},Jc.ext("twaver.vector.interaction.TouchInteraction",Ic.vector.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Wc.addEventListener("touchstart","handleTouchstart",a,this),Wc.addEventListener("touchmove","handleTouchmove",a,this),Wc.addEventListener("touchend","handleTouchend",a,this),Wc.addEventListener("touchcancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Wc.removeEventListener("touchstart",this.network.getView(),this),Wc.removeEventListener("touchmove",a,this),Wc.removeEventListener("touchend",a,this),Wc.removeEventListener("touchcancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(Wc.preventDefault(a),a.touches&&1==a.touches.length){var b=this.network.getLogicalPoint2(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b,this._startTouchClient=this.getMarkerPoint(a),c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null)}else a.touches&&2==a.touches.length&&(this._distance=zd.getDistance(a),this._zoom=this.network.getZoom());this._touchCount=a.touches.length},handleTouchmove:function(a){if(Wc.preventDefault(a),2==this._touchCount&&a.touches&&2==a.touches.length){var b=zd.getDistance(a)/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._touchCount&&a.touches&&1==a.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint2(a),d=this.network.getElementAt(c);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==d&&this.network.getMovableSelectedElements().contains(d)){var e=c.x-this._startTouchPoint.x,f=c.y-this._startTouchPoint.y;this._startTouchPoint=c,this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}else{var g=this.getMarkerPoint(a),e=this._startTouchClient.x-g.x,f=this._startTouchClient.y-g.y;this.network.panByOffset(e,f),this._startTouchClient=g}}else{var h=this.network.getLogicalPoint2(a);if(!h)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:a}:{kind:"selectStart",event:a}),this._moveTouchPoint=h,this.repaint()}},handleTouchend:function(a){if(Wc.preventDefault(a),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=Tc.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){var f=new Date,g=this.network.getLogicalPoint2(a),h=this.network.getElementAt(this._startTouchPoint);g&&f.getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,g)<=20&&(h?this.network.getSelectionModel().contains(h)||this.network.getSelectionModel().setSelection(h):this.network.getSelectionModel().clearSelection(),Cd.handleClicked(this.network,a,h),this._endTouchTime&&f.getTime()-this._endTouchTime.getTime()<=500&&Tc.getDistance(this._endTouchPoint,g)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Cd.handleDoubleClicked(this.network,a,h)):(this._endTouchTime=f,this._endTouchPoint=g))}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Tc.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Le.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),Ic.vector.interaction.MSTouchInteraction=function(a){Ic.network.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},Jc.ext("twaver.vector.interaction.MSTouchInteraction",Ic.vector.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Wc.addEventListener("MSPointerDown","handleTouchstart",a,this),Wc.addEventListener("MSPointerMove","handleTouchmove",a,this),Wc.addEventListener("MSPointerUp","handleTouchend",a,this),Wc.addEventListener("MSPointerCancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Wc.removeEventListener("MSPointerDown",a,this),Wc.removeEventListener("MSPointerMove",a,this),Wc.removeEventListener("MSPointerUp",a,this),Wc.removeEventListener("MSPointerCancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(this.network.isFocusOnClick()&&Ic.Util.setFocus(this.network._view),!this.network.isSelectingElement()||a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.network.getLogicalPoint2(a),c=new Date;if(a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length){var d=this.network.getElementAt(b);this._startTouchElement=d,this._startClientPoint={x:a.clientX,y:a.clientY},Cd.handleClicked(this.network,a,d),this._startTouchTime&&this._startTouchPoint&&c.getTime()-this._startTouchTime.getTime()<=500&&Tc.getDistance(this._startTouchPoint,b)<=20?(Cd.handleDoubleClicked(this.network,a,d),this._doubleClick=!0):(Wc.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=c);var e=this.network.getSelectionModel();d?Jc.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d):Jc.isCtrlDown(a)||e.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Tc.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),this.network.isSelectingElement()){var b=Tc.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var f=-1,g=0;g<this._pointerIdArray.length;g++)if(this._pointerIdArray[g]==a.pointerId){f=g;break}f>=0&&this._pointerIdArray.splice(f,1),delete this._pointerMap[a.pointerId],this._startTouchPoint=null,this._moveTouchPoint=null},_getDistance:function(){return Tc.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){var b={x:a.clientX,y:a.clientY};if(!(Tc.getDistance(this._startClientPoint,b)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(b.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(b.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint2(a);if(!c)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:a}:{kind:"selectStart",event:a}),this.repaint()}else{var d=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&d==this._startTouchElement&&this.network.getMovableSelectedElements().contains(d)){var e=this._moveTouchPoint.x-this._startTouchPoint.x,f=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}}else{var e=this._startClientPoint.x-b.x,f=this._startClientPoint.y-b.y;this.network.panByOffset(e,f)}this._startClientPoint=b}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Tc.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Le.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}}}),Ic.XmlSerializer=function(a,b,c){this.dataBox=a,this.settings=b?b:new Ic.SerializationSettings,this.filterFunction=c,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},Jc.ext("twaver.XmlSerializer",Object,{serialize:function(){return this.xmlString="<twaver version='"+Ic.Util.getVersion()+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</twaver>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()];this.xmlString+="<data class='"+a.getClassName()+"' ref='"+c+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+a.getId()+"'"),this.xmlString+=">\n",a.serializeXml(this,b),this.xmlString+="</data>\n"}a.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(a,b,c){var d=this.settings.getPropertyType(b);if(d){var e=Jc.getValue(a,b,d),f=Jc.getValue(c,b,d);e!==f&&this.serializeValue("p",b,e,f,d)}},serializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(b);if(d){var e=a.getStyle(b),f=c.getStyle(b);e!=f&&this.serializeValue("s",b,e,f,d)}},serializeClientXml:function(a,b,c){var d=this.settings.getClientType(b);if(null!=d){var e=a.getClient(b),f=c.getClient(b);e!=f&&this.serializeValue("c",b,e,f,d)}},serializeValue:function(a,b,c,d,e){if(null==c)this.xmlString+="	<"+a+" n='"+b+"' none=''/>\n";else if("cdata"===e)this.xmlString+="	<"+a+" n='"+b+"'><![CDATA["+c+"]]></"+a+">\n";else if("data"===e){var f=this.refMap[c.getId()];null!=f&&(this.xmlString+="	<"+a+" n='"+b+"' ref='"+f+"'/>\n")}else"point"===e?d&&c.x===d.x&&c.y===d.y||(this.xmlString+="	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"'/>\n"):"list.point"===e?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<p x='"+a.x+"' y='"+a.y+"'/>\n"},this),this.xmlString+="	</"+a+">\n"):"list.string"===e||"list.number"===e?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<s>"+a+"</s>\n"},this),this.xmlString+="	</"+a+">\n"):this.xmlString+="rectangle"===e?"	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"' w='"+c.width+"' h='"+c.height+"'/>\n":"	<"+a+" n='"+b+"'>"+c+"</"+a+">\n"},deserialize:function(a,b){Jc.isDeserializing=!0,this.xmlString=a;var c=Jc.xml(a).documentElement;this.refMap={},this.idMap={};var d,e,f,g=new me,h=new me,i=c.getElementsByTagName("data"),j=i.length;for(f=0;j>f;f++){e=i[f];var k=e.getAttribute("class"),l=this.settings.getPropertyType("id");if(l&&e.hasAttribute("id")){var m=null;if("string"===l)m=e.getAttribute("id");else if("int"===l)m=parseInt(e.getAttribute("id"));else{if("number"!==l)throw"Unsupported id type '"+l+"'";m=parseFloat(e.getAttribute("id"))}if("remove"===e.getAttribute("action")){this.dataBox.removeById(m);continue}d=this.dataBox.getDataById(m),d||(d=Jc.newInstance(k,m))}else d=Jc.newInstance(k);if(e.hasAttribute("ref")){var n=e.getAttribute("ref");this.refMap[n]=d}g.add(d),h.add(e),this.idMap[d.getId()]=d}for(this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),j=g.size(),f=0;j>f;f++)d=g.get(f),e=h.get(f),d.deserializeXml(this,e);for(f=0;j>f;f++)d=g.get(f),this.dataBox.containsById(d.getId())||(b&&!d.getParent()&&d.setParent(b),this.dataBox.add(d));this.settings.isDataBoxSerializable&&1===c.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,c.getElementsByTagName("dataBox")[0]),Jc.isDeserializing=!1},deserializePropertyXml:function(a,b,c){var d=this.settings.getPropertyType(c);d&&Jc.setValue(a,c,this.deserializeValue(b,d))},deserializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientXml:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if(a.hasAttribute("@none"))return null;if("string"===b)return a.textContent;if("number"===b)return parseFloat(a.textContent);if("boolean"===b)return"true"===a.textContent;if("int"===b)return parseInt(a.textContent);if("point"===b)return{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y"))};if("data"===b){var c=a.getAttribute("ref"),d=this.refMap[c];return d?d:this.idMap[c]}var e,f,g,h;if("list.point"===b){var i=new me,j=a.getElementsByTagName("p");for(e=j.length,h=0;e>h;h++){var k=j[h];i.add({x:parseFloat(k.getAttribute("x")),y:parseFloat(k.getAttribute("y"))})}return i}if("list.string"===b){var l=new me;for(g=a.getElementsByTagName("s"),e=g.length,h=0;e>h;h++)l.add(g[h].textContent);return l}if("list.number"===b){for(f=new me,g=a.getElementsByTagName("s"),e=g.length,h=0;e>h;h++)f.add(parseFloat(g[h].textContent));return f}if("array.string"===b)return a.textContent.split(",");if("array.number"===b){for(f=a.textContent.split(","),e=f.length,h=0;e>h;h++)f[h]=parseFloat(f[h]);return f}return"rectangle"===b?{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y")),width:parseFloat(a.getAttribute("w")),height:parseFloat(a.getAttribute("h"))}:a.textContent}}),Jc.addMethod(Ic.Data,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b),this.serializePropertyXml(a,"parent",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c,d,e,f,g=b.getElementsByTagName("p"),h=g.length;for(c=0;h>c;c++)d=g[c],d.hasAttribute("n")&&this.deserializePropertyXml(a,d,d.getAttribute("n"));if(a.settings.isClientSerializable)for(e=b.getElementsByTagName("c"),h=e.length,c=0;h>c;c++)f=e[c],f.hasAttribute("n")&&this.deserializeClientXml(a,f,f.getAttribute("n"))},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),Jc.addMethod(Ic.Element,{serializeXml:function(a,b){if(a.settings.isStyleSerializable&&this._styleMap)for(var c in this._styleMap)this.serializeStyleXml(a,c,b);Ic.Element.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"layerId",b),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===a.settings.getPropertyType("alarmState")&&(a.xmlString+="	<p n='alarmState'>\n",Ic.AlarmSeverity.forEach(function(b){var c=this.getNewAlarmCount(b);c>0&&(a.xmlString+="		<n n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),Ic.AlarmSeverity.forEach(function(b){var c=this.getAcknowledgedAlarmCount(b);c>0&&(a.xmlString+="		<a n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),a.xmlString+="	</p>\n")},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeXml:function(a,b){if(Ic.Element.superClass.deserializeXml.call(this,a,b),a.settings.isStyleSerializable){var c,d,e=b.getElementsByTagName("s"),f=e.length;for(c=0;f>c;c++)d=e[c],d.hasAttribute("n")&&this.deserializeStyleXml(a,d,d.getAttribute("n"))}},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializePropertyXml:function(a,b,c){if("alarmState"===c){if("alarmstate"===a.settings.getPropertyType("alarmState")){var d,e,f,g=b.getElementsByTagName("n");for(e=0;e<g.length;e++)f=g[e],d=Ic.AlarmSeverity.getByName(f.getAttribute("n")),this._alarmState.setNewAlarmCount(d,parseInt(f.getAttribute("c")));for(g=b.getElementsByTagName("a"),e=0;e<g.length;e++)f=g[e],d=Ic.AlarmSeverity.getByName(f.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(d,parseInt(f.getAttribute("c")))}}else Ic.Element.superClass.deserializePropertyXml.call(this,a,b,c)}}),Jc.addMethod(Je,{serializeXml:function(a,b){Je.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"image",b),this.serializePropertyXml(a,"location",b),Jc.num(this._width)&&this._width>=0&&this.serializePropertyXml(a,"width",b),Jc.num(this._height)&&this._height>=0&&this.serializePropertyXml(a,"height",b)}}),Jc.addMethod(Ic.Link,{serializeXml:function(a,b){Ic.Link.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"fromNode",b),this.serializePropertyXml(a,"toNode",b)}}),Jc.addMethod(Ic.Follower,{serializeXml:function(a,b){Ic.Follower.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"host",b)}}),Jc.addMethod(Ke,{serializeXml:function(a,b){Ke.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"expanded",b)}}),Jc.addMethod(Ic.ShapeNode,{serializeXml:function(a,b){Ic.ShapeNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b),this.serializePropertyXml(a,"segments",b)}}),Jc.addMethod(Ic.ShapeLink,{serializeXml:function(a,b){Ic.ShapeLink.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b)}}),Jc.addMethod(Ic.RotatableNode,{serializeXml:function(a,b){Ic.RotatableNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"angle",b)}}),Jc.addMethod(Ic.DataBox,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c,d,e,f,g=b.getElementsByTagName("p"),h=g.length;for(c=0;h>c;c++)d=g[c],d.hasAttribute("n")&&this.deserializePropertyXml(a,d,d.getAttribute("n"));if(a.settings.isClientSerializable)for(e=b.getElementsByTagName("c"),h=e.length,c=0;h>c;c++)f=e[c],f.hasAttribute("n")&&this.deserializeClientXml(a,f,f.getAttribute("n"))},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),Jc.addMethod(Ic.ElementBox,{serializeXml:function(a,b){if(a.settings.isLayerBoxSerializable&&(a.xmlString+="	<layerBox>\n",this._layerBox.forEachByDepthFirst(function(b){a.xmlString+=this._layerBox.getDefaultLayer()===b?"		<layer ":"		<layer id='"+b.getId()+"' ",b.getName()&&(a.xmlString+="name='"+b.getName()+"' "),a.xmlString+="visible='"+b.isVisible()+"' editable='"+b.isEditable()+"' movable='"+b.isMovable()+"'/>\n"},null,this),a.xmlString+="	</layerBox>\n"),a.settings.isStyleSerializable&&this._styleMap)for(var c in this._styleMap)this.serializeStyleXml(a,c,b);Ic.ElementBox.superClass.serializeXml.call(this,a,b)},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializeXml:function(a,b){if(Ic.ElementBox.superClass.deserializeXml.call(this,a,b),a.settings.isLayerBoxSerializable&&1==b.getElementsByTagName("layerBox").length){this._layerBox.clear();for(var c=b.getElementsByTagName("layerBox")[0].getElementsByTagName("layer"),d=0;d<c.length;d++){var e,f=c[d];if(f.hasAttribute("id")){var g=a.settings.getPropertyType("layerId");if("string"===g)e=new Ic.Layer(f.getAttribute("id"));else if("int"===g)e=new Ic.Layer(parseInt(f.getAttribute("id")));else{if("number"!==g)throw"Unsupported layer id type '"+g+"'";e=new Ic.Layer(parseFloat(f.getAttribute("id")))}this._layerBox.add(e)}else e=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(e);f.hasAttribute("name")&&e.setName(f.getAttribute("name")),f.hasAttribute("visible")&&e.setVisible("true"===f.getAttribute("visible")),f.hasAttribute("editable")&&e.setEditable("true"===f.getAttribute("editable")),f.hasAttribute("movable")&&e.setMovable("true"===f.getAttribute("movable"))}}if(a.settings.isStyleSerializable)for(var h=b.getElementsByTagName("s"),i=h.length,d=0;i>d;d++){var j=h[d];j.hasAttribute("n")&&this.deserializeStyleXml(a,j,j.getAttribute("n"))}}}),Ic.JsonSerializer=function(a,b,c){this.dataBox=a,this.settings=b?b:new Ic.SerializationSettings,this.filterFunction=c,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},Jc.ext("twaver.JsonSerializer",Object,{serialize:function(){return this.jsonObject={version:Ic.Util.getVersion(),platform:"html5"},this.settings.isImageSerializable&&(this.jsonObject.images={}),this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var a={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=a,this.dataBox.serializeJson(this,this.dataBox.newInstance(),a),Jc.isEmptyObject(a.p)&&delete a.p,Jc.isEmptyObject(a.s)&&delete a.s,Jc.isEmptyObject(a.c)&&delete a.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()],d={"class":a.getClassName(),ref:c,p:{},s:{},c:{}};if(this.settings.getPropertyType("id")&&(this.jsonObject.id=a.getId()),this.jsonObject.datas.push(d),a.serializeJson(this,b,d),Jc.isEmptyObject(d.p)&&delete d.p,Jc.isEmptyObject(d.s)&&delete d.s,Jc.isEmptyObject(d.c)&&delete d.c,this.settings.isImageSerializable&&a.getImage){var e=a.getImage();if("string"==typeof e&&!Ne[e]&&!this.jsonObject.images[e]){var f=Jc.getImageAsset(e),g=f&&f.getImage();g&&!ce(g)&&(this.jsonObject.images[e]=g)}}}a.getChildren().forEach(this.serializeData,this)},serializePropertyJson:function(a,b,c,d){var e=this.settings.getPropertyType(b);if(e){var f=Jc.getValue(a,b,e),g=Jc.getValue(c,b,e);f!==g&&this.serializeValue(b,f,g,e,d.p)}},serializeStyleJson:function(a,b,c,d){var e=this.settings.getStyleType(b);if(e){var f=a.getStyle(b),g=c.getStyle(b);f!=g&&this.serializeValue(b,f,g,e,d.s)}},serializeClientJson:function(a,b,c,d){var e=this.settings.getClientType(b);if(null!=e){var f=a.getClient(b),g=c.getClient(b);f!=g&&this.serializeValue(b,f,g,e,d.c)}},serializeValue:function(a,b,c,d,e){if(null==b)e[a]=null;else if(b instanceof me)e[a]=b._as;else if("data"===d){var f=this.refMap[b.getId()];null!=f&&(e[a]=f)}else e[a]=b},deserialize:function(a,b){Jc.isDeserializing=!0,this.jsonObject=JSON.parse(a);var c=this.jsonObject.images;this.settings.isImageSerializable&&c&&Object.keys(c).forEach(function(a){Jc.registerImage(a,c[a])}),this.refMap={},this.idMap={};for(var d,e=new me,f=new me,g=this.jsonObject.datas.length,h=0;g>h;h++){var i=this.jsonObject.datas[h],j=i["class"],k=this.settings.getPropertyType("id");if(k&&null!=i.id){if("remove"===i.action){this.dataBox.removeById(i.id);continue}d=this.dataBox.getDataById(i.id),d||(d=Jc.newInstance(j,i.id))}else d=Jc.newInstance(j);null!=i.ref&&(this.refMap[i.ref]=d),e.add(d),f.add(i),this.idMap[d.getId()]=d}for(this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),g=e.size(),h=0;g>h;h++)d=e.get(h),d.deserializeJson(this,f.get(h));for(h=0;g>h;h++)d=e.get(h),this.dataBox.containsById(d.getId())||(b&&!d.getParent()&&d.setParent(b),this.dataBox.add(d));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),Jc.isDeserializing=!1},deserializePropertyJson:function(a,b,c){var d=this.settings.getPropertyType(c);
d&&Jc.setValue(a,c,this.deserializeValue(b,d))},deserializeStyleJson:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientJson:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if("data"===b){var c=this.refMap[a];return c?c:this.idMap[a]}return"array.number"===b?a:a instanceof Array?new me(a):a}}),Jc.addMethod(Ic.Data,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c),this.serializePropertyJson(a,"parent",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),Jc.addMethod(Ic.Element,{serializeJson:function(a,b,c){if(a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleJson(a,d,b,c);if(Ic.Element.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"layerId",b,c),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===a.settings.getPropertyType("alarmState")){var e={n:{},a:{}};c.p.alarmState=e,Ic.AlarmSeverity.forEach(function(a){var b=this.getNewAlarmCount(a);b>0&&(e.n[a.name]=b)},this._alarmState),Ic.AlarmSeverity.forEach(function(a){var b=this.getAcknowledgedAlarmCount(a);b>0&&(e.a[a.name]=b)},this._alarmState),Jc.isEmptyObject(e.n)&&delete e.n,Jc.isEmptyObject(e.a)&&delete e.a,Jc.isEmptyObject(e)&&delete c.p.alarmState}},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeJson:function(a,b){if(Ic.Element.superClass.deserializeJson.call(this,a,b),a.settings.isStyleSerializable)for(var c in b.s)this.deserializeStyleJson(a,b.s[c],c)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializePropertyJson:function(a,b,c){if("alarmState"===c){if("alarmstate"===a.settings.getPropertyType("alarmState")){var d;for(d in b.n)this._alarmState.setNewAlarmCount(Ic.AlarmSeverity.getByName(d),b.n[d]);for(d in b.a)this._alarmState.setAcknowledgedAlarmCount(Ic.AlarmSeverity.getByName(d),b.a[d])}}else Ic.Element.superClass.deserializePropertyJson.call(this,a,b,c)}}),Jc.addMethod(Je,{serializeJson:function(a,b,c){Je.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"image",b,c),this.serializePropertyJson(a,"location",b,c),Jc.num(this._width)&&this._width>=0&&this.serializePropertyJson(a,"width",b,c),Jc.num(this._height)&&this._height>=0&&this.serializePropertyJson(a,"height",b,c)}}),Jc.addMethod(Ic.Link,{serializeJson:function(a,b,c){Ic.Link.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"fromNode",b,c),this.serializePropertyJson(a,"toNode",b,c)}}),Jc.addMethod(Ic.Follower,{serializeJson:function(a,b,c){Ic.Follower.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"host",b,c)}}),Jc.addMethod(Ke,{serializeJson:function(a,b,c){Ke.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"expanded",b,c)}}),Jc.addMethod(Ic.ShapeNode,{serializeJson:function(a,b,c){Ic.ShapeNode.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"points",b,c),this.serializePropertyJson(a,"segments",b,c)}}),Jc.addMethod(Ic.ShapeLink,{serializeJson:function(a,b,c){Ic.ShapeLink.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"points",b,c)}}),Jc.addMethod(Ic.RotatableNode,{serializeJson:function(a,b,c){Ic.RotatableNode.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"angle",b,c)}}),Jc.addMethod(Ic.DataBox,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),Jc.addMethod(Ic.ElementBox,{serializeJson:function(a,b,c){if(a.settings.isLayerBoxSerializable&&(c.layers=[],this._layerBox.forEachByDepthFirst(function(a){var b={};c.layers.push(b),this._layerBox.getDefaultLayer()!==a&&(b.id=a.getId()),a.getName()&&(b.name=a.getName()),b.visible=a.isVisible(),b.editable=a.isEditable(),b.movable=a.isMovable()},null,this)),a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleJson(a,d,b,c);Ic.ElementBox.superClass.serializeJson.call(this,a,b,c)},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializeJson:function(a,b){if(Ic.ElementBox.superClass.deserializeJson.call(this,a,b),a.settings.isLayerBoxSerializable&&b.layers&&(this._layerBox.clear(),b.layers))for(var c=b.layers.length,d=0;c>d;d++){var e,f=b.layers[d];null!=f.id?(e=new Ic.Layer(f.id),this._layerBox.add(e)):(e=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(e)),f.name&&e.setName(f.name),null!=f.visible&&e.setVisible(f.visible),null!=f.editable&&e.setEditable(f.editable),null!=f.movable&&e.setMovable(f.movable)}if(a.settings.isStyleSerializable)for(var g in b.s)this.deserializeStyleJson(a,b.s[g],g)}}),Ic.layout.SpringLayouter=function(a){this._network=a,this._damper=1,this._maxMotion=0,this._motionRatio=0,this._isAdjusting=!1,this._timer=null,this._snodeMap={},this._snodes=new me,this._slinks=new me,this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this),this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this)},Jc.ext("twaver.layout.SpringLayouter",Object,{_nodeRepulsionFactor:.6,_linkRepulsionFactor:.6,_limitBounds:null,_interval:50,_stepCount:10,_motionLimit:.01,start:function(){if(!this._timer){var b=this,c=function(){b.relax.call(b)};this._timer=a.setInterval(c,this._interval),this._damper=1}},stop:function(){this._timer&&(a.clearInterval(this._timer),this._timer=null)},relax:function(){if(!(this._damper<.1&&this._maxMotion<this._motionLimit)){this._rebuild();for(var a=this._snodes.size(),b=0;b<this._stepCount;b++){this._slinks.forEach(this._relaxLink,this);for(var c=0;a>c;c++)for(var d=0;a>d;d++){var e=this._snodes.get(c),f=this._snodes.get(d);e!=f&&this._relaxNodePair(e,f)}this._moveNodes()}this._isAdjusting=!0;for(var b=0;a>b;b++){var g=this._snodes.get(b);g.fix||g.element.setLocation(g.x,g.y)}this._isAdjusting=!1}},isRunning:function(){return!!this._timer},getNetwork:function(){return this._network},isVisible:function(a){return this._network.isVisible(a)},isMovable:function(a){return this._network.isMovable(a)?this._network.getSelectionModel().contains(a)?!1:a instanceof Ke?!1:!0:!1},getNodeRepulsionFactor:function(){return this._nodeRepulsionFactor},setNodeRepulsionFactor:function(a){.02>a&&(a=.02),this._nodeRepulsionFactor=a,this._damper=1},getLinkRepulsionFactor:function(){return this._linkRepulsionFactor},setLinkRepulsionFactor:function(a){.02>a&&(a=.02),this._linkRepulsionFactor=a,this._damper=1},getStepCount:function(){return this._stepCount},setStepCount:function(a){this._stepCount=a,this._damper=1},getInterval:function(){return this._interval},setInterval:function(b){if(this._interval!==b&&(this._interval=b,this._timer)){a.clearInterval(this._timer);var c=this,d=function(){c.relax.call(c)};this._timer=a.setInterval(d,this._interval)}},getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(a){this._limitBounds=a,this._damper=1},_handleDataPropertyChange:function(){this._isAdjusting||(this._damper=1)},_handleDataBoxChange:function(){this._damper=0===this._network.getElementBox().size()?0:1},_handleNetworkPropertyChange:function(a){if("elementBox"===a.property){var b=a.oldValue;null!=b&&(b.removeDataBoxChangeListener(this._handleDataBoxChange,this),b.removeDataPropertyChangeListener(this._handleDataPropertyChange,this)),this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this)}},_relaxLink:function(a){var b=a.toNode.x-a.fromNode.x,c=a.toNode.y-a.fromNode.y,d=Math.sqrt(b*b+c*c),e=.25*b,f=.25*c;e/=100*a.length;var g=a.length,h=100*g,i=f;f/=h,i/=100*a.length,a.toNode.dx=a.toNode.dx-e*d,a.toNode.dy=a.toNode.dy-f*d,a.fromNode.dx=a.fromNode.dx+e*d,a.fromNode.dy=a.fromNode.dy+f*d},_relaxNodePair:function(a,b){var c=0,d=0,e=a.x-b.x,f=a.y-b.y,g=e*e+f*f;0===g?(c=Math.random(),d=Math.random()):36e4>g&&(c=e/g,d=f/g);var h=a.repulsion*b.repulsion/100,i=.25*h;a.dx+=c*i,a.dy+=d*i,b.dx-=c*i,b.dy-=d*i},_moveNodes:function(){for(var a=this._maxMotion,b=0,c=0,d=this._snodes.size();d>c;c++){var e=this._snodes.get(c),f=e.dx,g=e.dy;f*=this._damper,g*=this._damper,e.dx=f/2,e.dy=g/2;var h=Math.sqrt(f*f+g*g);if(!e.fix)if(e.x=e.x+Math.max(-30,Math.min(30,f)),e.y=e.y+Math.max(-30,Math.min(30,g)),this._limitBounds){e.x<this._limitBounds.x&&(e.x=this._limitBounds.x,this._adjustLocation(1,0)),e.y<this._limitBounds.y&&(e.y=this._limitBounds.y,this._adjustLocation(0,1));var i,j=this._network.getElementUI(e.element);i=j?j._viewRect:e.element.getRect(),i&&(e.x+i.width>this._limitBounds.x+this._limitBounds.width&&(e.x=this._limitBounds.x+this._limitBounds.width-i.width,this._adjustLocation(-1,0)),e.y+i.height>this._limitBounds.y+this._limitBounds.height&&(e.y=this._limitBounds.y+this._limitBounds.height-i.height,this._adjustLocation(0,-1)))}else e.x<1&&this._adjustLocation(1,0),e.y<1&&this._adjustLocation(0,1);b=Math.max(h,b)}this._maxMotion=b,this._motionRatio=this._maxMotion>0?a/this._maxMotion-1:0,this._damp()},_damp:function(){this._motionRatio<=.001&&((this._maxMotion<.2||this._maxMotion>1&&this._damper<.9)&&this._damper>.01?this._damper-=.01:this._maxMotion<.4&&this._damper>.003?this._damper-=.003:this._damper>1e-4&&(this._damper-=1e-4)),this._maxMotion<this._motionLimit&&(this._damper=0)},_rebuild:function(){this._snodeMap={},this._snodes.clear(),this._slinks.clear(),this._network.getElementBox().forEach(function(a){this.isVisible(a)&&(a instanceof Ic.Link?this._addLink(a):a instanceof Je&&this._addNode(a))},this)},_addNode:function(a){var b=this._snodeMap[a.getId()];return b?b:(b={},b.element=a,b.repulsion=this._getRepulsion(a),b.x=a.getX(),b.y=a.getY(),b.dx=0,b.dy=0,b.fix=!this.isMovable(a),this._snodeMap[a.getId()]=b,this._snodes.add(b),b)},_addLink:function(a){var b={};b.fromNode=this._addNode(a.getFromNode()),b.toNode=this._addNode(a.getToNode()),b.element=a;var c,d,e=this._network.getElementUI(a.getToNode()),f=this._network.getElementUI(a.getFromNode());e&&e._viewRect&&f&&f._viewRect?(c=e._viewRect.width+f._viewRect.width,d=e._viewRect.height+f._viewRect.height):(c=a.getToNode().getWidth()+a.getFromNode().getWidth(),d=a.getToNode().getHeight()+a.getFromNode().getHeight()),b.length=Math.floor(Math.sqrt(c*c+d*d)*this._linkRepulsionFactor),b.length<=0&&(b.length=100),this._slinks.add(b)},_getRepulsion:function(a){var b,c=this._network.getElementUI(a);if(c&&c._viewRect){var d=c._viewRect;b=Math.floor(Math.sqrt(d.width*d.width+d.height*d.height)*this._nodeRepulsionFactor)}else b=100;return 0>=b&&(b=100),b},_adjustLocation:function(a,b){for(var c=0,d=this._snodes.size();d>c;c++){var e,f=this._snodes.get(c),g=this._network.getElementUI(f.element);if(e=g?g._viewRect:f.element.getRect(),!e)return;a>0?(!this._limitBounds||f.x+e.width+a<this._limitBounds.x+this._limitBounds.width)&&(f.x+=a):(!this._limitBounds||f.x+a>this._limitBounds.x)&&(f.x+=a),b>0?(!this._limitBounds||f.y+e.height+b<this._limitBounds.y+this._limitBounds.height)&&(f.y+=b):(!this._limitBounds||f.y+b>this._limitBounds.y)&&(f.y+=b)}}}),Ic.layout.CloudLayouter=function(a){Ic.layout.CloudLayouter.superClass.constructor.apply(this,arguments),this._network=a,this._centerX=0,this._centerY=0,this._radius=1,this._rect=null,this._localPoint=null,this._lastWidth=-1e3,this._lastHeight=-1e3,this._nodes=new me,this._sa=0,this._ca=0,this._sb=0,this._cb=0,this._sc=0,this._cc=0,this._lasta=0,this._lastb=0,this._active=!1,this._horizontalElliptical=1,this._verticalElliptical=1,this._timer=null,this._centering=!1,this._centeringNode=null,this._freeze=!1,this._network.setInteractions("twaver.network.Network"===this._network.getClassName()?[new Ic.network.interaction.SelectInteraction(this._network)]:[new Ic.canvas.interaction.SelectInteraction(this._network)])},Jc.ext("twaver.layout.CloudLayouter",Ic.PropertyChangeDispatcher,{__accessor:["updateNodeFunction","mouseMoveFunction","mouseOverFunction","percentPadding","ceaseRate","ceaseLimit"],__bool:["elliptical","active","updateLayoutRectOnResized","reloadOnDataBoxChanged"],_moveSpeed:2,_ceaseRate:.9,_ceaseLimit:.01,_percentPadding:.2,_elliptical:!0,_interval:50,_reloadOnDataBoxChanged:!0,_updateLayoutRectOnResized:!0,getNetwork:function(){return this._network},isLayoutable:function(a){return this._network.isVisible(a)&&this._network.isMovable(a)},start:function(b){if(0===arguments.length&&(b=!0),!this._timer){this._installListeners(),b&&this.updateLayoutRect(!0);var c=this,d=function(){c._update.call(c)};this._timer=a.setInterval(d,this._interval),this._update()}},stop:function(){this._timer&&(a.clearInterval(this._timer),this._timer=null)},isRunning:function(){return!!this._timer},getInterval:function(){return this._interval},setInterval:function(b){if(this._interval!==b){var c=this._interval;if(this._interval=b,this._timer){a.clearInterval(this._timer);var d=this,e=function(){d._update.call(d)};this._timer=a.setInterval(e,this._interval)}this.firePropertyChange("interval",c,b)}},getMoveSpeed:function(){return this._moveSpeed},setMoveSpeed:function(a){var b=this._moveSpeed;this._moveSpeed=a,this.firePropertyChange("moveSpeed",b,a)},getLayoutRect:function(){var a=this._network.getView().offsetWidth/this._network.getZoom(),b=this._network.getView().offsetHeight/this._network.getZoom(),c=a*this._percentPadding,d=b*this._percentPadding;return{x:c,y:d,width:a-2*c,height:b-2*d}},getCount:function(){return this._nodes.size()},updateLayoutRect:function(a){var b=this._radius;if(this._rect=this.getLayoutRect(),this._rect.width<=2&&(this._rect.width=2),this._rect.height<=2&&(this._rect.height=2),this._radius=Math.min(this._rect.width/2,this._rect.height/2),this.isElliptical()?(this._horizontalElliptical=this._rect.width/2/this._radius,this._verticalElliptical=this._rect.height/2/this._radius):(this._horizontalElliptical=1,this._verticalElliptical=1),this._centerX=this._rect.x+this._rect.width/2,this._centerY=this._rect.y+this._rect.height/2,a)this.reload();else{this._lasta=1,this._lastb=1;for(var c=this._nodes.size(),d=0;c>d;d++){var e=this._nodes.get(d);e.cx*=this._radius/b,e.cy*=this._radius/b,e.cz*=this._radius/b}this._freeze?this._updateNodes(0,0,0):this._update()}this._lastWidth=this._network.getView().offsetWidth,this._lastHeight=this._network.getView().offsetHeight},reload:function(){this._freeze=!1,this._centeringNode=null,this._localPoint=null,this._centering=!1,this._nodes=new me,this._box.forEach(function(a){if(a&&this.isLayoutable(a)){var b={};b.node=a,this._nodes.add(b)}},this),this._sineCosine(0,0,0),this._active=!1,this._lasta=1,this._lastb=1;for(var a=0,b=0,c=this._nodes.size(),d=0;c>d;d++){a=Math.acos(-1+(2*(d+1)-1)/c),b=Math.sqrt(c*Math.PI)*a;var e=this._nodes.get(d);e.cx=this._radius*Math.cos(b)*Math.sin(a),e.cy=this._radius*Math.sin(b)*Math.sin(a),e.cz=this._radius*Math.cos(a)}},_sineCosine:function(a,b,c){var d=Math.PI/180;this._sa=Math.sin(a*d),this._ca=Math.cos(a*d),this._sb=Math.sin(b*d),this._cb=Math.cos(b*d),this._sc=Math.sin(c*d),this._cc=Math.cos(c*d)},handleSelectionChange:function(){this.centerNode(this._network.getSelectionModel().getLastData())},handleDataBoxChange:function(a){(this._reloadOnDataBoxChanged||"clear"===a.kind)&&this.reload()},handleMouseMove:function(a){this._centering||this._updateLogicalPoint(a),this._active=this._mouseMoveFunction?this._mouseMoveFunction(a):!0},handleMouseOver:function(a){this._centering||this._updateLogicalPoint(a),this._active=this._mouseOverFunction?this._mouseOverFunction(a):!0},_updateLogicalPoint:function(a){this._localPoint=this._network.getLogicalPoint(a)},handleRollOut:function(){this._active=!1},handleResize:function(a){if("validateEnd"===a.kind){if(!this._updateLayoutRectOnResized)return;if(Math.abs(this._network.getView().offsetWidth-this._lastWidth)<=2&&Math.abs(this._network.getView().offsetHeight-this._lastHeight)<=2)return;this.updateLayoutRect()}},handleNetworkPropertyChange:function(a){"elementBox"===a.property&&(this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this.reload()),"zoom"===a.property&&(this._localPoint=null,this.updateLayoutRect())},_adjustIndex:function(){this._nodes.sort(this._sortFunction);for(var a=this._nodes.size(),b=0;a>b;b++){var c=this._nodes.get(b).node,d=this._box.getDatas().indexOf(c);this._box.getDatas().removeAt(d),this._box.getDatas().add(c,b),this._box.fireIndexChange(c,d,b),this.updateNode(c,b,a,this._nodes.get(b).alpha)}},_sortFunction:function(a,b){return b.cz>a.cz?1:b.cz<a.cz?-1:0},updateNode:function(a,b,c,d){this._updateNodeFunction&&this._updateNodeFunction(a,b,c,d)},_update:function(){if(!this._freeze){var a,b;if(this._centering&&this._centeringNode){var c=this.isAtCenter(this._centeringNode.node,this._centeringNode.perspective,this._centeringNode.cx,this._centeringNode.cy,this._centeringNode.cz);if(c)return this._freeze=!0,this._centering=!1,void(this._centeringNode=null)}if(!this._freeze&&(this._active||this._centering)&&this._localPoint?this.isElliptical()?(a=(this._centerY-this._localPoint.y)/(this._rect.height/2)*this._moveSpeed,b=(this._localPoint.x-this._centerX)/(this._rect.width/2)*this._moveSpeed):(a=(this._centerY-this._localPoint.y)/this._radius*this._moveSpeed,b=(this._localPoint.x-this._centerX)/this._radius*this._moveSpeed):(a=this._lasta*this._ceaseRate,b=this._lastb*this._ceaseRate),this._lasta=a,this._lastb=b,Math.abs(a)>this._ceaseLimit||Math.abs(b)>this._ceaseLimit){var d=0;this._sineCosine(a,b,d);for(var e=0,f=this._nodes.size();f>e;e++){var g=this._nodes.get(e),h=g.cx,i=g.cy*this._ca+g.cz*-this._sa,j=g.cy*this._sa+g.cz*this._ca,k=h*this._cb+j*this._sb,l=i,m=h*-this._sb+j*this._cb,n=k*this._cc+l*-this._sc,o=k*this._sc+l*this._cc,p=m;g.cx=n,g.cy=o,g.cz=p;var q=2*this._radius;q/=q+p,g.perspective=q,g.alpha=(this._radius-p)/(2*this._radius);var r=this._horizontalElliptical*n*q-2*this._horizontalElliptical+this._centerX,s=o*q*this._verticalElliptical+this._centerY;g.node.setCenterLocation(r,s)}this._adjustIndex()}}},centerNode:function(a){if(a&&this.isLayoutable(a)){if(this._centeringNode&&a===this._centeringNode.node&&this._freeze)return;for(var b=0,c=this._nodes.size();c>b;b++){var d=this._nodes.get(b);if(d&&a===d.node){this._centering=!0,this._freeze=!1,this._active=!0,this._centeringNode=d,this._localPoint=this.createControlPoint(this._centeringNode.node);break}}}else this._centering=!1,this._freeze=!1,this._active=!1,this._localPoint=null},createControlPoint:function(a){var b=a.getCenterLocation(),c=this.getLayoutRect(),d=c.x+c.width/2,e=c.y+c.height/2,f=Math.atan2(b.y-e,b.x-d),g=c.width+c.height;return{x:d+g*Math.cos(f),y:e+g*Math.sin(f)}},isAtCenter:function(a,b,c,d,e){if(this._moveSpeed<=0)return!0;var f=16/this._moveSpeed;return f>20?f=20:2>f&&(f=2),-e/Math.sqrt(c*c+d*d)>f},_updateNodes:function(a,b,c){this._sineCosine(a,b,c);for(var d=0,e=this._nodes.size();e>d;d++){var f=this._nodes.get(d),g=f.cx,h=f.cy*this._ca+f.cz*-this._sa,i=f.cy*this._sa+f.cz*this._ca,j=g*this._cb+i*this._sb,k=h,l=g*-this._sb+i*this._cb,m=j*this._cc+k*-this._sc,n=j*this._sc+k*this._cc,o=l;f.cx=m,f.cy=n,f.cz=o;var p=2*this._radius;p/=p+o,f.perspective=p;var q=this._horizontalElliptical*m*p-2*this._horizontalElliptical+this._centerX,r=n*p*this._verticalElliptical+this._centerY;f.node.setCenterLocation(q,r)}this._adjustIndex()},_installListeners:function(){this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._network.addViewListener(this.handleResize,this),Wc.addEventListener("mouseout","handleRollOut",this._network.getView(),this),Wc.addEventListener("mousemove","handleMouseMove",this._network.getView(),this),Wc.addEventListener("mouseover","handleMouseOver",this._network.getView(),this),this._network.addPropertyChangeListener(this.handleNetworkPropertyChange,this)},_uninstallListeners:function(){this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._network.removeViewListener(this.handleResize,this),Wc.removeEventListener("mouseout",this._network.getView(),this),Wc.removeEventListener("mousemove",this._network.getView(),this),Wc.removeEventListener("mouseover",this._network.getView(),this),this._network.removePropertyChangeListener(this.handleNetworkPropertyChange,this)}}),Ic.layout.AutoLayouter=function(a){this._box=a},Jc.ext("twaver.layout.AutoLayouter",Object,{_expandGroup:!1,_repulsion:1,_type:null,_animate:!0,_explicitXOffset:Number.NaN,_explicitYOffset:Number.NaN,_xOffset:0,_yOffset:0,isExpandGroup:function(){return this._expandGroup},setExpandGroup:function(a){this._expandGroup=a},getRepulsion:function(){return this._repulsion},setRepulsion:function(a){this._repulsion=a},getType:function(){return this._type},isAnimate:function(){return this._animate},setAnimate:function(a){this._animate=a},getElementBox:function(){return this._box},getExplicitXOffset:function(){return this._explicitXOffset},setExplicitXOffset:function(a){this._explicitXOffset=a},getExplicitYOffset:function(){return this._explicitYOffset},setExplicitYOffset:function(a){this._explicitYOffset=a},getDimension:function(a){if(a instanceof Ke&&a.getChildrenSize()>0){for(var b=null,c=0,d=a.getChildrenSize();d>c;c++){var e=a.getChildAt(c);e instanceof Je&&(b=b?Tc.unionRect(b,e.getRect()):e.getRect())}return b?{width:b.width,height:b.height}:null}return{width:a.getWidth(),height:a.getHeight()}},isVisible:function(){return!0},isMovable:function(){return!0},getGroupLayoutType:function(){return this._type},getElements:function(){var a,b=this._box,c=b.getSelectionModel().size()>1;c?a=b.getSelectionModel().getSelection():(a=new me,b.forEachByBreadthFirst(a.add,null,a)),this._xOffset=-1,this._yOffset=-1;for(var d=new me,e=0,f=a.size();f>e;e++){var g=a.get(e);this.isVisible(g)&&(g instanceof Ic.Link?d.add(g):this.isMovable(g)&&g instanceof Je&&(d.add(g),c&&((this._xOffset<0||g.getX()<this._xOffset)&&(this._xOffset=g.getX()),(this._yOffset<0||g.getY()<this._yOffset)&&(this._yOffset=g.getY()))))}return c||(this._xOffset=isNaN(this._explicitXOffset)?50/this._repulsion:this._explicitXOffset,this._yOffset=isNaN(this._explicitYOffset)?50/this._repulsion:this._explicitYOffset),d},getLayoutResult:function(a){var b={};return this.doLayoutImpl(a,null,b),b},doLayout:function(a,b){return this.doLayoutImpl(a,b)},doLayoutImpl:function(a,b,c){var d=this,e=b;b=function(){d._box._layoutMovingElements=!1,e&&e()},this._type=a;var f=null;if("round"===a?f=new bg:"symmetry"===a?f=new pg:"hierarchic"===a?f=new zg:("topbottom"===a||"bottomtop"===a||"rightleft"===a||"leftright"===a)&&(f=new Pf),null==f)return!1;d._box._layoutMovingElements=!0;var g={},h=this.getElements(),i=new qg(this,h,!0,null);h=i.process();var j=new kg(this,h,a,!0,null);try{f.i2(j)}catch(k){return i.resetGroup(),null!=b&&b(),!1}var l,m;for(l in j._a){m=j._a[l];var n=j.g4(m);g[l]={x:n.x+this._xOffset,y:n.y+this._yOffset}}var o;if("rightleft"===a||"leftright"===a||"bottomtop"===a){var p=qg.createMatrix(a),q=Number.MAX_VALUE,r=Number.MAX_VALUE;for(l in g){m=j._a[l],o=g[l];var s=p.transform(o);o.x=s.x,o.y=s.y;var t;"rightleft"===a||"leftright"===a?(t=s.x-j.g9(m)/2/this._repulsion,q>t&&(q=t),t=s.y-j.gj(m)/2/this._repulsion,r>t&&(r=t)):(t=s.x-j.gj(m)/2/this._repulsion,q>t&&(q=t),t=s.y-j.g9(m)/2/this._repulsion,r>t&&(r=t))}for(l in g)m=j._a[l],o=g[l],o.x=o.x-q+this._xOffset,o.y=o.y-r+this._yOffset}if(null==c&&this._animate){var u=new me,v=new me;for(l in g)u.add(j._a[l].node),v.add(g[l]);Ic.animate.AnimateManager.endAnimate(),Ic.animate.AnimateManager.start(new Ic.animate.AnimateCenterLocation(u,v,function(){i.resetGroup(),null!=b&&Jc.callLater(b)}))}else{for(l in g)m=j._a[l],o=g[l],null==c?m.node.setCenterLocation(o.x,o.y):c[m.node.getId()]=o;i.resetGroup(),null!=b&&Jc.callLater(b)}return!0}});var Pe=function(a,b){this.x=a,this.y=b};Jc.ext(Pe,Object,{equals:function(a){return this===a?!0:a instanceof Pe?a.x==this.x&&a.y==this.y:!1}});var Qe=function(a,b){this.width=a,this.height=b};Jc.ext(Qe,Object,{});var Re=function(a,b){this.x=a,this.y=b};Jc.ext(Re,Object,{});var Se=function(){2===arguments.length?(Se.superClass.constructor.call(this,arguments[1].width,arguments[1].height),this.x=arguments[0].x,this.y=arguments[0].y):(Se.superClass.constructor.call(this,arguments[2],arguments[3]),this.x=arguments[0],this.y=arguments[1])};Jc.ext(Se,Qe,{});var Te=function(a,b){if(Te.a2(a.x,b.x))this._a=1,this._b=0,this._c=-a.x;else{this._b=-1;var c=(b.y-a.y)/(b.x-a.x),d=a.y-a.x*c;this._a=c,this._c=d}};Jc.ext(Te,Object,{a3:function(){return this._a},a4:function(){return this._b},a5:function(){return this._c}}),Te.a6=function(a,b){if(Te.a1(a.a3())&&Te.a1(b.a3()))return null;if(Te.a1(a.a4())&&Te.a1(b.a4()))return null;if(Te.a1(b.a4())){var c=a;a=b,b=c}var d,e,f=a.a3(),g=a.a4(),h=-a.a5();Te.a1(a.a3())?(d=b.a4(),e=-b.a5()):(d=b.a4()-b.a3()/a.a3()*a.a4(),e=-b.a5()-b.a3()/a.a3()*-a.a5());var i=e/d,j=(h-i*g)/f;return new Pe(j,i)},Te.a1=function(a){return Te.a2(a,0)},Te.a2=function(a,b){return Math.abs(a-b)<1e-5};var Ue=function(a){if(this._a=new of,a)for(var b=0;b<a.size();b++)this._a.aa(a.get(b))};Jc.ext(Ue,Object,{c:function(){return this._a.ah()},d:function(){return this._a.ah()},a:function(){for(var a=new me,b=this.c();b.i1();b.i2())a.add(b.i6(),0);return new Ue(a)},b:function(){return this._a.ay()}});var Ve=function(a,b){this.x=a,this.y=b};Jc.ext(Ve,Object,{a:function(a,b){this.x=a,this.y=b}});var We=function(a,b){this.x=a||0,this.y=b||0};Jc.ext(We,Object,{b:function(){return new We(this.x,this.y)},a:function(a){this.z=a},c:function(){return this.x},d:function(){return this.y},f:function(a,b){this.x=a,this.y=b}});var Xe=function(a){this._c=new of,a?(this.ac(a.a8().b()),this.ad(a.a9().b())):(this.ac(new We),this.ad(new We))};Jc.ext(Xe,Object,{a6:function(){return this.a5(this)},ac:function(a){a.a(this),this._a=a},ad:function(a){a.a(this),this._b=a},a8:function(){return this._a},a9:function(){return this._b},a1:function(a,b){return this.a4(a,b,this.aa())},a2:function(){return this._c.ay()},a7:function(a){return this._c.ak(a)},aa:function(){return 0===this._c.ay()?null:this._c.as()},a3:function(){this._c.af()},i2:function(a){var b=this.a7(a);return null!=b?new Pe(b.x,b.y):null},i1:function(){return this.a2()},i6:function(){var a=this.a8();return new Pe(a.c(),a.d())},i7:function(){var a=this.a9();return new Pe(a.c(),a.d())},i8:function(a){this.a8().f(a.x,a.y)},i9:function(a){this.a9().f(a.x,a.y)},i3:function(a,b,c){var d=this.a7(a);null!=d&&d.a(b,c)},i4:function(a,b){this.a1(a,b)},i5:function(){this.a3()}});var Ye=function(a){Ye.superClass.constructor.call(this,a)};Jc.ext(Ye,Xe,{a5:function(a){return new Ye(a)},a4:function(a,b,c){var d=new Ve(a,b);return this.ab(d,c),d},ab:function(a,b){this._c.an(a,this._c.al(b))}});var Ze=function(){if(2===arguments.length){var a=arguments[0],b=arguments[1];this._s=!1,this._w=30,this._h=30,this._x=a-this._w/2,this._y=b-this._h/2}else{var c=arguments[0];this._s=c._s,this._w=c._w,this._h=c._h,this._x=c._x,this._y=c._y}};Jc.ext(Ze,Object,{m3:function(){return this.m2(this)},m4:function(){return this._x+this._w/2},m5:function(){return this._y+this._h/2},m6:function(a,b){this._x=a-this._w/2,this._y=b-this._h/2},i1:function(){return this._x},i2:function(){return this._y},i5:function(a,b){this._x=a,this._y=b},i3:function(){return this._w},i4:function(){return this._h},i6:function(a,b){var c=(this._w-a)/2,d=(this._h-b)/2;this._x+=c,this._y+=d,this._w=a,this._h=b},m1:function(a){var b,c,d,e;a.width<=0?(b=this._x,c=this._x+this._w,d=this._y,e=this._y+this._h):(b=Math.min(this._x,a.x),c=Math.max(this._x+this._w,a.x+a.width),d=Math.min(this._y,a.y),e=Math.max(this._y+this._h,a.y+a.height)),a.x=b,a.y=d,a.width=c-b,a.height=e-d}});var $e=function(a){a?$e.superClass.constructor.call(this,a):$e.superClass.constructor.call(this,0,0)};Jc.ext($e,Ze,{m2:function(a){return new $e(a)}});var _e={};_e.a2=function(a){var b=Lf.a2(Eg.a(a.xa()));return _e.a4(a,b,_e.a3(a,b))},_e.a3=function(a,b){for(var c=a.x9();c.i1();c.i2())b.i7(c.i9(),-1);for(var d=0,e=new uf(a.xa()),f=a.x9();f.i1();f.i2()){var g=f.i9();-1===b.i2(g)&&_e.a(g,e,b,d++)}return d},_e.a6=function(a){for(var b=new pf,c=_e.a2(a),d=0;d<c.length-1;d++){var e=a.xo(c[d].x2(),c[d+1].x3());b.aa(e)}return b},_e.a4=function(a,b,c){for(var d=[],e=0;c>e;e++)d[e]=new Hf;for(var f=a.x9();f.i1();f.i2())d[b.i2(f.i9())].ae(f.i9());return d},_e.a=function(a,b,c,d){for(b.c(a),c.i7(a,d);!b.a();){a=b.b();for(var e=a.ag();null!=e;e=e.a8()){var f=e.a3();-1===c.i2(f)&&(c.i7(f,d),b.c(f))}for(var g=a.ae();null!=g;g=g.a7()){var h=g.a2();-1===c.i2(h)&&(c.i7(h,d),b.c(h))}}},_e.a1=function(a,b,c){var d=new jf(b,c);return d.a8(a),d._i},_e.a5=function(a,b,c){for(var d=[],e=0;c>e;e++)d[e]=new pf;for(var f=a.xf();f.i1();f.i2())d[b.i2(f.i8())].aa(f.i8());return d},_e.a7=function(a){var b=new pf,c=Lf.a3(Eg.b(a.xa())),d=Lf.a4(Eg.a(a.xh())),e=_e.a1(a,d,c),f=_e.a5(a,d,e);if(f.length>1){for(var g=new Hf,h=0;h<f.length;h++){var i=f[h],j=null;if(1===i.ay()){var k=i.c2();1===k.a2().ad()?j=k.a2():1===k.a3().ad()&&(j=k.a3())}else{for(var l=i.c1();l.i1();l.i2()){var m=l.i8();if(c.i4(m.a2()))if(null==j)j=m.a2();else if(j!==m.a2()){j=null;break}if(c.i4(m.a3()))if(null!=j){if(j!==m.a3()){j=null;break}}else j=m.a3()}if(null!=j){var n=i.c2();j=n.a2()!==j?n.a2():n.a3()}}null!=j&&g.aa(j)}for(var o,p=g.x4();!g.ar();p=o)o=g.x4(),b.ac(a.xo(p,o))}return b};var af=function(){this._c=0,this._d=0,this._e=0,this._b=!0,this._f=!1};Jc.ext(af,Object,{a6:function(a){this._f=a},a7:function(a){this._b=a},a8:function(a){0!==a.x0()&&this.a9(a,a.x9().i9())},a9:function(a,b){if(this._xx=a.xk(),this._c=a.xl(),this._d=0,this._e=0,this.a0(b),this._b)for(var c=a.x9();c.i1();c.i2()){var d=c.i9();null==this._xx.i1(d)&&(this.a1(d),this.a0(d))}a.xi(this._xx),a.xj(this._c)},a0:function(a){var b=++this._d;this._xx.z1(a,af._B),this.a5(a,b);for(var c=this._f?a.ap():a.af();c.i1();c.i2()){var d=c.i8();if(!this._c.i4(d)){this._c.i7(d,!0);var e=d.a1(a);null==this._xx.i1(e)?(this.a3(d,e,!0),this.a0(e),this.a2(d,e)):this.a3(d,e,!1)}}this.a4(a,b,++this._e),this._xx.z1(a,af._C)},a5:function(){},a4:function(){},a3:function(){},a2:function(){},a1:function(){}}),af._B={},af._C={};var bf=function(a){this._a=a};Jc.ext(bf,af,{a5:function(a){var b=this._a._ah.i2(a);this._a._ad[b].ae(a)}});var cf=function(a){this._a=a
};Jc.ext(cf,af,{a2:function(a,b){var c=a.a1(b),d=this._a[c.al()],e=this._a[b.al()];e._a+1>d._a?(d._c=d._a,d._b=d._d,d._a=e._a+1,d._d=a):e._a+1>d._c&&(d._c=e._a+1,d._b=a)}});var df=function(a){this._a=a};Jc.ext(df,af,{a3:function(a,b,c){c&&a.a2()===b&&this._a.ac(a)}});var ef=function(){this._a=0,this._c=0};Jc.ext(ef,Object,{});var ff=function(){this._a=0};Jc.ext(ff,Object,{a1:function(a,b){this._a=0;for(var c=b.length-1;c>=0;c--)b[c]=-1;for(var d=a.x9();d.i1();d.i2()){var e=d.i9();if(0===e.ak()){this.a2(e,e.al(),b);break}}for(var f=a.x9();f.i1();f.i2()){var g=f.i9(),h=g.al();-1===b[h]&&this.a2(g,h,b)}},a2:function(a,b,c){c[b]=-2;for(var d=a.ag();null!=d;){var e=d.a3(),f=e.al();switch(c[f]){case-1:this.a2(e,f,c);case-2:default:d=d.a8()}}c[b]=this._a++}});var gf={};gf.a1=function(a){var b=new hf;return b.a8(a),b._n},gf.a2=function(a){var b=a.x9(),c=null,d=0;for(b.i4();b.i1();b.i2())0===b.i9().ak()&&(c=b.i9(),d++);if(1===d)return c;for(d=0,b.i4();b.i1();b.i2())0===b.i9().ao()&&(c=b.i9(),d++);return 1===d?c:gf.a8(a)},gf.a8=function(a){var b=Eg.a(a.x0()),c=Lf.a2(b);return gf.a6(a,c)},gf.a6=function(a,b){var c=a.xd(),d=Eg.d(1),e=Eg.a(a.x0(),-1),f=gf.a4(a,c);gf.a7(c,b,d,e,-1);for(var g=f.c1();g.i1();g.i2())a.x3(g.i8());return d[0]},gf.a7=function(a,b,c,d,e){for(var f=0,g=a.ag();null!=g;g=g.a8()){var h=g.a3(),i=gf.a7(h,b,c,d,e);i>e&&(e=i),f+=d[h.al()]}for(var j=f*(a._g.xa()-1-f),k=a.ag();null!=k;k=k.a8())for(var l=k.a3(),m=k.a8();null!=m;m=m.a8()){var n=m.a3();j+=d[l.al()]*d[n.al()]}return b.i7(a,j),d[a.al()]=f+1,j>e&&(e=j,c[0]=a),e},gf.a4=function(a,b){var c=new pf,d=new df(c);d.a6(!1),d.a9(a,b);for(var e=c.c1();e.i1();e.i2())a.x3(e.i8());return c},gf.a3=function(a){return gf.a4(a,gf.a2(a))};var hf=function(){this._n=!0,this.a6(!1)};Jc.ext(hf,af,{a3:function(a,b,c){c||(this._n=!1)},a1:function(){this._n=!1}});var jf=function(a,b){this._i=0,this._m=b,this._j=a,this._l=!1};Jc.ext(jf,af,{a8:function(a){this._h=Eg.a(a.x0()),this._k=Eg.a(a.x0()),this._g=new uf(a.xh()),jf.superClass.a8.call(this,a)},a5:function(a,b){this._k[a.al()]=this._h[a.al()]=b},a3:function(a,b,c){if(this._g.c(a),!c){var d=a.a1(b);this._h[d.al()]=Math.min(this._h[d.al()],this._k[b.al()])}},a1:function(){this._l=!1},a2:function(a,b){var c=a.a1(b);if(this._h[b.al()]>=this._k[c.al()]){for(;this._g.d()!==a;this._j.i5(this._g.b(),this._i));this._j.i5(this._g.b(),this._i),this._i++,this._g.a()?this._l?this._m.i5(c,!0):this._l=!0:this._m.i5(c,!0)}this._h[c.al()]=Math.min(this._h[c.al()],this._h[b.al()])}});var kf=function(a,b){this._h=!1,this._i=a,this._g=b};Jc.ext(kf,Object,{z1:function(a,b){a._c[this._i]=b},i1:function(a){return a._c[this._i]},i5:function(a,b){a._c[this._i]=b},i4:function(a){return a._c[this._i]},i7:function(a,b){a._c[this._i]=b},i2:function(a){var b=a._c[this._i];return null==b?0:b},i6:function(a,b){a._c[this._i]=b},i3:function(a){var b=a._c[this._i];return null==b?0:b},c:function(){return this._h},d:function(){this._h=!0}});var lf=function(a,b){this._c=!1,this._d=a,this._b=b};Jc.ext(lf,Object,{i8:function(a,b){a._c[this._d]=b},i1:function(a){return a._c[this._d]},i7:function(a,b){a._c[this._d]=b},i4:function(a){var b=a._c[this._d];return null==b?!1:b},i5:function(a,b){a._c[this._d]=Eg.a(b)},i2:function(a){var b=a._c[this._d];return null==b?0:b},i6:function(a,b){a._c[this._d]=Eg.a(b)},i3:function(a){var b=a._c[this._d];return null==b?0:b},a:function(){return this._c},b:function(){this._c=!0}});var mf=function(a){this._bb=a,this.i4()};Jc.ext(mf,Object,{i1:function(){return null!=this._aa},i2:function(){this._aa=this._aa._a},i3:function(){this._aa=this._aa._b},i4:function(){this._aa=this._bb._b},i5:function(){this._aa=this._bb._c},i7:function(){return this._bb.ay()},i6:function(){return this._aa._c}});var nf=function(a){nf.superClass.constructor.call(this,a)};Jc.ext(nf,mf,{i8:function(){return this.i6()}});var of=function(a){if(this._id=Jc.id(),this._a=0,a)for(a.i4();a.i1();a.i2())this.ae(a.i6())};Jc.ext(of,Object,{ac:function(a){var b=this.ag(a);return null==this._b?this._b=this._c=b:(this._b._b=b,b._a=this._b,this._b=b),this._a++,b},ae:function(a){var b=this.ag(a);return null==this._c?this._b=this._c=b:(this._c._a=b,b._b=this._c,this._c=b),this._a++,b},z1:function(a){a._b=null,a._a=null,null==this._c?this._b=this._c=a:(this._c._a=a,a._b=this._c,this._c=a),this._a++},ad:function(a){a._b=null,a._a=null,null==this._b?this._b=this._c=a:(this._b._b=a,a._a=this._b,this._b=a),this._a++},aa:function(a){return this.ae(a),!0},ab:function(a){for(;a.i1();a.i2())this.ae(a.i6())},ao:function(a,b){if(b===this._b)return this.ac(a);if(null==b)return this.ae(a);var c=this.ag(a);return this.aq(c,b),c},aq:function(a,b){if(null==b)this.ad(a);else if(b===this._b)this.ad(a);else{if(null==this._c)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._b;b._b=a,a._a=b,c._a=a,a._b=c}this._a++}},ap:function(a,b){if(null==b)this.z1(a);else if(b===this._c)this.z1(a);else{if(null==this._b)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._a;b._a=a,a._a=c,c._b=a,a._b=b}this._a++}},an:function(a,b){if(b===this._c)return this.ae(a);if(null==b)return this.ac(a);var c=this.ag(a);return this.ap(c,b),c},ay:function(){return this._a},ar:function(){return 0===this._a},af:function(){this._b=this._c=null,this._a=0},am:function(){return this._b._c},at:function(){var a=this.am();return this.aw(this._b),a},as:function(){return this._c._c},au:function(){return this.aw(this._c)},ak:function(a){for(var b=0,c=this._b;null!=c;){if(a===b)return c._c;c=c._a,b++}return null},aj:function(a){return null==a._a?this._b:a._a},ai:function(a){return null==a._b?this._c:a._b},aw:function(a){return a!==this._b?a._b._a=a._a:this._b=a._a,a!==this._c?a._a._b=a._b:this._c=a._b,this._a--,a._c},av:function(a){return this.aw(a._aa)},ah:function(){return new mf(this)},al:function(a){for(var b=this._b;null!=b;){if(null==b._c&&null==a)return b;if(b._c===a)return b;b=b._a}return null},a0:function(){for(var a=Eg.d(this._a),b=0,c=this._b;null!=c;)a[b]=c._c,c=c._a,b++;return a},ax:function(){for(var a=this._b;null!=a;a=a._b){var b=a._a;a._a=a._b,a._b=b}var c=this._b;this._b=this._c,this._c=c},a1:function(a){var b=this.a0();b.sort(a);for(var c=0,d=this._b;null!=d;)d._c=b[c],d=d._a,c++},a2:function(){var a=this.a0();a.sort(Eg.c);for(var b=0,c=this._b;null!=c;)c._c=a[b],c=c._a,b++},az:function(a){null==this._b?(this._b=a._b,this._c=a._c):null!=a._b&&(this._c._a=a._b,a._b._b=this._c,this._c=a._c),this._a+=a._a,a._b=a._c=null,a._a=0},ag:function(a){return new sf(a)}});var pf=function(a){pf.superClass.constructor.call(this,a)};Jc.ext(pf,of,{c1:function(){return new nf(this)},c2:function(){return this.am()},c3:function(){return this.at()}});var qf=function(){this._c=0};Jc.ext(qf,Object,{a:function(a){this._c++,a._b=this._b,a._a=null,null!=this._b?(this._b._a=a,this._b=a):this._b=this._a=a},b:function(a,b){if(null==b)return void this.a(a);var c=b._b;null!=c?c._a=a:this._a=a,a._b=c,a._a=b,b._b=a,this._c++},c:function(a){var b=a._a,c=a._b;this._c--,null!=b?b._b=c:this._b=c,null!=c?c._a=b:this._a=b}});var rf=function(a,b){this._p=a,this._j=b,this._o=a._o[b]};Jc.ext(rf,Object,{i1:function(){return null!=this._o},i2:function(){this._o=this._o._k[this._j]},i3:function(){this._o=this._o._f[this._j]},i4:function(){this._o=this._p._o[this._j]},i5:function(){this._o=this._p._q[this._j]},i7:function(){return this._p._n[this._j]},i6:function(){return this._o},i8:function(){return this._o}});var sf=function(a){this._c=a};Jc.ext(sf,Object,{a:function(){return this._a},b:function(){return this._b},c:function(a){this._c=a},d:function(){return this._c}});var tf=function(a,b,c,d){this._r=a,this._s=b,this._q=c,this._p=d};Jc.ext(tf,Object,{i1:function(a){return this._p[a.a5()]},i3:function(a){return this._r[a.a5()]},i2:function(a){return this._s[a.a5()]},i4:function(a){return this._q[a.a5()]},i8:function(a,b){this._p[a.a5()]=b},i6:function(a,b){this._r[a.a5()]=b},i5:function(a,b){this._s[a.a5()]=b},i7:function(a,b){this._q[a.a5()]=b}});var uf=function(a){this._a=Eg.d(a),this._b=-1};Jc.ext(uf,Object,{d:function(){return this._a[this._b]},b:function(){return this._a[this._b--]},c:function(a){this._a[++this._b]=a},a:function(){return this._b<0}});var vf=function(){};Jc.ext(vf,Object,{a0:function(a){this._c=Eg.d(a)}});var wf=function(a,b,c,d,e,f,g){this._g=0,a.xt(this,b,c,d,e,f,g)};Jc.ext(wf,vf,{a5:function(){return this._h._u&&this._h.b1(),this._g},a2:function(){return this._d},a3:function(){return this._e},a1:function(a){return this._d!==a?this._d:this._e},a4:function(){for(var a=0;1>=a;a++)this._k[a]=null,this._f[a]=null},a8:function(){return this._k[0]},a7:function(){return this._k[1]},a6:function(a,b,c,d){this.a0(d),this._h=a,this._k=Eg.d(2),this._f=Eg.d(2),this._d=b,this._e=c}});var xf=function(a){this._j=0,this._h=a,this.i4()};Jc.ext(xf,Object,{i2:function(){this._k=this._k._k[this._j],null==this._k&&0===this._j&&(this._k=this._h._o[1],this._j=1)},i3:function(){this._k=this._k._f[this._j],null==this._k&&1===this._j&&(this._k=this._h._q[0],this._j=0)},i4:function(){this._k=this._h._o[0],null==this._k?(this._k=this._h._o[1],this._j=1):this._j=0},i5:function(){this._k=this._h._q[1],null==this._k?(this._k=this._h._q[0],this._j=0):this._j=1},i1:function(){return null!=this._k},i6:function(){return this._k},i8:function(){return this._k},i7:function(){return this._h.ad()}});var yf=function(){this._a=dg._A,this._b=dg._A,this._c=new me};Jc.ext(yf,Object,{i1:function(){return this._c.size()},i2:function(a){return this._c.get(a)},i3:function(a,b,c){this._c.set(a,new Pe(b,c))},i4:function(a,b){this._c.add(new Pe(a,b))},i5:function(){this._c.clear()},i6:function(){return this._a},i7:function(){return this._b},i8:function(a){this._a=a},i9:function(a){this._b=a}});var zf=function(){this._x=0,this._y=0,this._w=0,this._h=0};Jc.ext(zf,Object,{i5:function(a,b){this._x=a,this._y=b},i6:function(a,b){this._w=a,this._h=b},i4:function(){return this._h},i3:function(){return this._w},i1:function(){return this._x},i2:function(){return this._y}});var Af=function(a,b,c,d){this._m=a,this._n=b,this._l=c,this._k=d};Jc.ext(Af,Object,{i1:function(a){return this._k[a.al()]},i3:function(a){return this._m[a.al()]},i2:function(a){return this._n[a.al()]},i4:function(a){return this._l[a.al()]},z1:function(a,b){this._k[a.al()]=b},i6:function(a,b){this._m[a.al()]=b},i7:function(a,b){this._n[a.al()]=b},i5:function(a,b){this._l[a.al()]=b}});var Bf=function(a,b){this._b=a,this._r=b,this._a=[];for(var c=this._b-1;c>=0;c--)this._a.push(c);this._c=new me};Jc.ext(Bf,Object,{a1:function(a){var b;if(0===this._a.length){this.a2(a,this._b,this._b+this._r);for(var c=this._b+this._r-1;c>this._b;c--)this._a.push(c);b=this._b,this._b+=this._r}else b=this._a.pop();return b},b:function(a){var b=this.a1(a),c=new kf(b,this);return this._c.add(c),this.a4(a,b),c},c:function(a){var b=this.a1(a),c=new lf(b,this);return this._c.add(c),this.a4(a,b),c},a2:function(a,b,c){for(var d=a._a;null!=d;d=d._a){var e=Eg.d(c);Eg.f(d._c,e,b),d._c=e}},a3:function(a,b,c){var d=Eg.d(c);Eg.f(a._c,d,b),a._c=d},a4:function(a,b){for(var c=a._a;null!=c;c=c._a)c._c[b]=null},a5:function(a,b){if(a instanceof kf){var c=a;if(c.c())throw"Error";c.d();var d=a._i;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}},a6:function(a,b){if(a instanceof lf){var c=a;if(c.a())throw"Error";c.b();var d=c._d;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}}});var Cf=function(a){this._id=Jc.id(),this._p=0,a.xs(this)};Jc.ext(Cf,vf,{ad:function(){return this._n[0]+this._n[1]},ak:function(){return this._n[1]},ao:function(){return this._n[0]},al:function(){return this._g._y&&this._g.c(),this._p},ag:function(){return this._o[0]},ae:function(){return this._o[1]},af:function(){return new xf(this)},am:function(){return new rf(this,1)},ap:function(){return new rf(this,0)},an:function(){return new Ef(this)},aq:function(){return new Df(this,1)},aw:function(){return new Df(this,0)},ah:function(a){for(var b=this._o[0];null!=b;b=b._k[0])if(b.a3()===a)return b;return null},ai:function(a){for(var b=this._o[1];null!=b;b=b._k[1])if(b.a2()===a)return b;return null},aj:function(a){var b=this.ah(a);return null==b&&(b=this.ai(a)),b},au:function(a){this.at(a,1,Eg.d(this.ak()))},av:function(a){this.at(a,0,Eg.d(this.ao()))},as:function(a,b){this.a0(b),this._g=a,this._o=Eg.d(2),this._q=Eg.d(2),this._n=Eg.a(2)},ab:function(a,b,c,d,e){if(null==b)return void this.aa(a,c,d);var f;if(f=b._d===b._e?d:this!==b._d?1:0,0===e){var g=b._k[f];a._f[d]=b,a._k[d]=g,b._k[f]=a,null==g?this._q[c]=a:g._d===g._e?g._f[d]=a:g._f[this!==g._d?1:0]=a}else{var h=b._f[f];a._k[d]=b,a._f[d]=h,b._f[f]=a,null==h?this._o[c]=a:h._d===h._e?h._k[d]=a:h._k[this!==h._d?1:0]=a}this._n[c]++},aa:function(a,b,c){var d=this._q[b];a._k[c]=null,null==d?(this._o[b]=a,a._f[c]=null):(a._f[c]=d,d._d===d._e?d._k[c]=a:d._k[this!==d._d?1:0]=a),this._q[b]=a,this._n[b]++},ar:function(a,b,c){var d,e;d=a._k[c],e=a._f[c],null==d?this._q[b]=e:d._f[d._d!==this?1:0]=e,null==e?this._o[b]=d:e._k[e._d!==this?1:0]=d,this._n[b]--},ac:function(){for(var a=0;1>=a;a++)this._o[a]=null,this._q[a]=null,this._n[a]=0},at:function(a,b,c){if(!(this._n[b]<2)){var d,e=this._n[b],f=0;for(d=this._o[b];null!=d;d=d._k[b])c[f]=d,f++;Eg.s(c,e,a);var g=this._o[b]=c[0];g._f[b]=null;for(var h=1;e>h;)d=c[h],d._f[b]=g,g._k[b]=d,h++,g=d;this._q[b]=d,d._k[b]=null}}});var Df=function(a,b){Df.superClass.constructor.call(this,a,b),this._h=1!==b?1:0};Jc.ext(Df,rf,{i6:function(){return this.i9()},i9:function(){return 0!==this._h?this._o._e:this._o._d}});var Ef=function(a){Ef.superClass.constructor.call(this,a)};Jc.ext(Ef,xf,{i6:function(){return this._k.a1(this._h)},i9:function(){return this._k.a1(this._h)}});var Ff=function(a){Ff.superClass.constructor.call(this,a)};Jc.ext(Ff,mf,{i9:function(){return this.i6()}});var Gf=function(a){this._o=a,this._c=a._a};Jc.ext(Gf,Object,{i1:function(){return null!=this._c},i2:function(){this._c=this._c._a},i3:function(){this._c=this._c._b},i5:function(){this._c=this._o._b},i4:function(){this._c=this._o._a},i7:function(){return this._o._c},i6:function(){return this._c},i9:function(){return this._c},i8:function(){return this._c}});var Hf=function(a){if(a&&a.length){Hf.superClass.constructor.call(this);for(var b=0;b<a.length;b++)this.ae(a[b])}else Hf.superClass.constructor.call(this,a)};Jc.ext(Hf,of,{x1:function(){return new Ff(this)},x2:function(){return this.am()},x3:function(){return this.as()},x4:function(){return this.at()}});var If=function(a){this._d=a,If.superClass.constructor.call(this)};Jc.ext(If,Hf,{});var Jf=function(a){this._a=a,this._b=new pf,this._c=new Hf};Jc.ext(Jf,Object,{a:function(){for(var a=this._a.x9();a.i1();a.i2())this.e(a.i9())},b:function(){this.c(),this.d()},c:function(){for(;!this._c.ar();){var a=this._c.x4();this._a.xq(a)||this.g(a)}},d:function(){for(;!this._b.ar();){var a=this._b.c3();this._a.xp(a)||this.f(a)}},e:function(a){for(var b=a.af();b.i1();b.i2())this._b.ac(b.i8()),this._a.h1(b.i8());this._c.ac(a),this._a.h2(a)},f:function(a){this._a.u1(a)},g:function(a){this._a.h3(a)}}),Jf.h=function(a,b){for(b.i4();b.i1();b.i2()){var c=b.i8();a.xq(c.a2())||a.h3(c.a2()),a.xq(c.a3())||a.h3(c.a3()),a.xp(c)||a.u1(c)}},Jf.i=function(a,b){for(b.i4();b.i1();b.i2()){var c=b.i8();a.xp(c)&&a.h1(c),0===c.a2().ad()&&a.h2(c.a2()),0===c.a3().ad()&&a.h2(c.a3())}};var Kf=function(){this._g=arguments[0],this._f=this._g.xk(),this._h=this._g.xk(),this._d=new of,this._e=0,1!==arguments.length&&this.a(arguments[1],arguments[2],arguments[3],arguments[4])};Jc.ext(Kf,Object,{a:function(a,b,c,d){for(var e=Eg.d(c-b+1),f=b;c>=f;f++)e[f]=new If(f);for(var g=this._g.x9();g.i1();g.i2()){var h=g.i9();(null==d||d.i4(h))&&(this._f.z1(h,e[a.i2(h)-b].ac(h)),this._e++)}for(var i=0;i<e.length;i++)for(var j=e[i],k=this._d.ae(j),l=j.x1();l.i1();l.i2())this._h.z1(l.i9(),k)},c:function(){this._g.xi(this._h),this._g.xi(this._f)},e:function(){return 0===this._e},g:function(){for(;this._d.am().ar();this._d.at());this._e--;var a=this._d.am().x4();return this._h.z1(a,null),this._f.z1(a,null),a},f:function(){for(;this._d.as().ar();this._d.au());this._e--;var a=this._d.as().x4();return this._h.z1(a,null),this._f.z1(a,null),a},d:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.a();null!=f?(e=f.d(),this._h.z1(a,f)):(e=new If(d._d+1),this._h.z1(a,this._d.ae(e))),d.aw(b),this._f.z1(a,e.ac(a))},b:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.b();null!=f?(e=f.d(),this._h.z1(a,f)):(e=new If(d._d-1),this._h.z1(a,this._d.ac(e))),d.aw(b),this._f.z1(a,e.ac(a))}});var Lf={};Lf.a1=function(a){return new Af(a,null,null,null)},Lf.a2=function(a){return new Af(null,a,null,null)},Lf.a3=function(a){return new Af(null,null,a,null)},Lf.a4=function(a){return new tf(null,a,null,null)},Lf.a5=function(a){return new tf(null,null,a,null)},Lf.a6=function(a){return new tf(null,null,null,a)};var Mf=function(){if(2===arguments.length){this._a=new of,this._b=new of,this._c=0;var a=arguments[0],b=arguments[1],c=new Nf(a._j2.gj(b)/2,0);this._a.ac(c),c=new Nf(a._j2.gj(b)/2,0),this._b.ac(c)}else this._a=arguments[1],this._b=arguments[2],this._c=arguments[3]};Jc.ext(Mf,Object,{});var Nf=function(a,b){this._b=a,this._a=b};Jc.ext(Nf,Object,{});var Of=function(){this._cx=!0,this._cs=new $f,this._ct=new Yf,this._cw=new Zf};Jc.ext(Of,Object,{i5:function(a){this._cx=a},k:function(){var a=new _f(this);return this._cx&&(this._cs.w1(a),a=this._cs),this._cw.w1(a),a=this._cw,this._ct.w1(a),a=this._ct},i2:function(a){this.k().i2(a)},i1:function(a){return this.k().i1(a)}});var Pf=function(){Pf.superClass.constructor.call(this),this._jv=20,this._jw=40,this._jx=function(a,b){var c=a.a3(),d=b.a3(),e=c._g;return Math.floor(100*(e.g5(c)-e.g5(d)))}};Jc.ext(Pf,Of,{i4:function(a){return gf.a1(a)},i3:function(a){if(!this.i4(a))throw"Error";var b=gf.a3(a);if(this._j2=a,this._j3=new Qf(a),lg.c(a),this._jy=a.xk(),!a.xb()){this.bu();var c=this._j3.c1();this.f(c),this.b(this._j3),this.c(this._j3)}for(var d;!b.ar();a.x3(d))d=b.c3(),lg.b(a.g2(d))},bu:function(){if(null!=this._jx)for(var a=this._j2.x9();a.i1();a.i2())a.i9().av(this._jx)},c:function(a){for(var b=this.a2(a),c=Eg.a(b.length),d=0;d<b.length;d++){for(var e=b[d],f=0,g=e.ah();g.i1();g.i2()){var h=g.i6();f=Math.max(f,this._j2.g9(h))}c[d]=f}for(var i=-this._jw,j=0;j<b.length;j++){i+=this._jw+c[j];for(var k=b[j],l=k.ah();l.i1();l.i2()){var m=l.i6();this._j2.s2(m,this._j2.g5(m),i-c[j]/2)}}},a2:function(a){for(var b=Eg.d(a.b()),c=0,d=a.b();d>c;c++)b[c]=new of;return a.c1(),this.a1(a.c1(),0,b),b},a1:function(a,b,c){c[b].ae(a);for(var d=a.aw();d.i1();d.i2())this.a1(d.i9(),b+1,c)},b:function(a){var b=a.c1();this._j2.s2(b,0,this._j2.g6(b)),this.g(b)},g:function(a){for(var b=a.aw();b.i1();b.i2()){var c=b.i9(),d=this._jy.i1(c);this._j2.s2(c,this._j2.g5(a)+d._c,this._j2.g6(c)),this.g(c)}},f:function(a){if(this._j3.c2(a))return void this._jy.z1(a,new Mf(this,a));var b=a.aw(),c=b.i9();b.i2(),this.f(c);var d=this._jy.i1(c),e=new Mf(this,d._a,d._b,0);if(!b.i1())return e._a.ac(new Nf(this._j2.gj(a)/2,0)),e._b.ac(new Nf(this._j2.gj(a)/2,0)),void this._jy.z1(a,e);for(;b.i1();){c=b.i9(),b.i2(),this.f(c),d=this._jy.i1(c);for(var f=e._b.ah(),g=d._a.ah(),h=2147483647,i=0,j=0;f.i1()&&g.i1();){var k=f.i6();f.i2();var l=g.i6();g.i2(),j+=k._a,i+=l._a,h=Math.min(h,i-j-k._b-l._b)}d._c=this._jv-h,i+=d._c;var m=d._b.am();if(m._a=d._c,f.i1()&&!g.i1())for(var n=j-this.a3(d._b);f.i1();n=0){var o=f.i6();f.i2(),d._b.ae(new Nf(o._b,o._a+n))}else if(!f.i1()&&g.i1()){var p=this.a3(e._a);for(p=i-p;g.i1();p=0){var q=g.i6();g.i2(),e._a.ae(new Nf(q._b,q._a+p))}}e._b=d._b}this._jy.z1(a,e);for(var r=-d._c/2,s=a.aw();s.i1();){var t=s.i9();s.i2();var u=this._jy.i1(t);u._c+=r;var v=u._b.am();v._a+=r,v=u._a.am(),v._a+=r}e._a.ac(new Nf(this._j2.gj(a)/2,0)),e._b.ac(new Nf(this._j2.gj(a)/2,0))},a3:function(a){for(var b=0,c=a.ah();c.i1();c.i2()){var d=c.i6();b+=d._a}return b}});var Qf=function(a){this._b=a,this.a()};Jc.ext(Qf,Object,{c1:function(){return null==this._a&&this.a(),this._a},b:function(){return null==this._a?-1:this.d(this._a)},d:function(a){for(var b=0,c=a.aw();c.i1();c.i2())b=Math.max(b,this.d(c.i9()));return b+1},c2:function(a){return 0===a.ao()},a:function(){for(var a=this._b.x9();a.i1();a.i2())if(0===a.i9().ak())return void(this._a=a.i9())}});var Rf=function(a){this._d=0,this._e=0,this._f=0,this._a=0,this._b=0,this._g=a,this._c=new of};Jc.ext(Rf,Object,{a:function(){return this._d+this._e+this._f}});var Sf=function(){Sf.superClass.constructor.call(this),this._kl=340,this._km=360,this._kk=40,this._ko=.5};Jc.ext(Sf,Of,{ic:function(){return this._km},ia:function(){return this._kl},i9:function(){return this._ko},i3:function(a){if(!gf.a1(a))throw"Error";this._a=a;var b=this.i8(),c=gf.a4(a,b);lg.c(a),this._kn=Eg.d(a.x0());for(var d=a.x9();d.i1();d.i2()){var e=d.i9();e!==b?this.aa(e,new Rf(this._kk+this.q(e.aq().i9()))):this.aa(e,new Rf(this._kk))}this.s(b),a.s2(b,0,0),this.t(b);for(var f;!c.ar();a.x3(f))f=c.c3()},i4:function(a){return gf.a1(a)},i0:function(a){return this._kn[a.al()]},i8:function(){return gf.a2(this._a)},i7:function(a){for(var b,c=this.ib(a);;){if(b=this.i6(a),c>=b)break;for(var d=a.aw();d.i1();d.i2()){var e=d.i9();this.i0(e)._g*=1+this._ko}}var f=(c-b)/(2*a.ao());b=0;for(var g=a.aw();g.i1();g.i2()){var h=this.i0(g.i9());h._d+=f,h._e+=f,b+=h._d+h._e}this.id(a)},id:function(a){for(var b=Eg.d(a.ao()),c=0,d=a.ap();d.i1();)b[c]=d.i8(),d.i2(),c++;var e=this;b.sort(function(a,b){var c=a.a3(),d=b.a3(),f=e.i0(c).a()-e.i0(d).a();return f>0?1:f>=0?0:-1});for(var f=0;f<b.length;f++)this._a.h1(b[f]);for(var g=0;g<b.length;g+=2)this._a.u1(b[g]);for(c=b.length-1,c%2===0&&c--;c>0;c-=2)this._a.u1(b[c])},ib:function(a){return 0===a.ak()?this._km:2===a.ao()?Math.min(180,this._kl):this._kl},i6:function(a){for(var b=0,c=a.ap();c.i1();c.i2()){for(var d,e=c.i8(),f=e.a3(),g=this.i0(f),h=-g._g,i=g._b,j=g._c,k=0,l=k+1,m=j._b,n=m.d();l>k;l=(d.y-i)/(d.x-h))d=n,m=j.ai(m),n=m.d(),k=(n.y-d.y)/(n.x-d.x);for(g._d=180*-Math.atan(l)/Math.PI,k=0,l=k-1,m=j._b,n=m.d();m.a().d().x===n.x;n=m.d())m=m.a();for(var o;k>l;l=(o.y-i)/(o.x-h))o=n,m=j.aj(m),n=m.d(),k=(n.y-o.y)/(n.x-o.x);g._e=180*Math.atan(l)/Math.PI,b+=g._d+g._e}return b},aa:function(a,b){this._kn[a.al()]=b},p:function(a){var b=this.i0(a),c=new of,d=2*this.q(a);c.aa(new Pe(0,0)),c.aa(new Pe(0,d)),c.aa(new Pe(d,d)),c.aa(new Pe(d,0)),b._c=c,b._a=d/2,b._b=d/2},r:function(a){if(0===a.ao())this.p(a);else{var b=this.i0(a),c=this.q(a),d=new of;d.aa(new Pe(-c,-c)),d.aa(new Pe(-c,c)),d.aa(new Pe(c,-c)),d.aa(new Pe(c,c));for(var e=a.aw();e.i1();e.i2()){var f=this.i0(e.i9());d.az(f._c)}for(var g=dg.h(d),h=Number.MAX_VALUE,i=Number.MAX_VALUE,j=Number.MIN_VALUE,k=Number.MIN_VALUE,l=g.ah();l.i1();l.i2()){var m=l.i6();m.x<h&&(h=m.x),m.x>j&&(j=m.x),m.y<i&&(i=m.y),m.y>k&&(k=m.y)}for(var n=new of,o=g.ah();o.i1();o.i2()){var p=o.i6();n.aa(new Pe(p.x-h,p.y-i))}b._c=n,b._a=-h,b._b=-i}},s:function(a){if(0===a.ao())this.r(a);else{for(var b=a.aw();b.i1();b.i2())this.s(b.i9());this.i7(a);for(var c=0,d=a.aw();d.i1();d.i2()){var e=d.i9(),f=this.i0(e),g=180-(360-this.ib(a))/2-c-(f._e+f._f);c+=f.a(),g=g/180*Math.PI;for(var h=Math.sin(g),i=Math.cos(g),j=f._c._b;null!=j;j=j.a()){var k=j.d(),l=k.x+f._g,m=k.y-f._b,n=new Pe(l*i-h*m,l*h+i*m);j.c(n)}var o=f._a+f._g;f._a=o*i,f._b=o*h}this.r(a)}},t:function(a){var b=this._a.g4(a),c=0;if(a.ak()>0){var d=a.aq().i9(),e=this._a.g4(d);c=Math.PI+Math.atan2(e.y-b.y,e.x-b.x)}for(var f=a.aw();f.i1();f.i2()){var g=f.i9(),h=this.i0(g);if(0!==c){var i=Math.cos(c),j=Math.sin(c),k=h._a*i-j*h._b,l=h._a*j+i*h._b;h._a=k,h._b=l}this._a.s2(g,b.x+h._a,b.y+h._b),this.t(g)}},q:function(a){return 1.41*(Math.max(this._a.gj(a),this._a.g9(a))/2)}});var Tf=function(){};Jc.ext(Tf,Object,{i2:function(a){return a.ad()},i1:function(){throw"Error"},i3:function(){throw"Error"},i4:function(){throw"Error"}});var Uf=function(a){this._a=a};Jc.ext(Uf,Object,{i2:function(a){for(var b=0,c=a.an();c.i1();c.i2())null!=this._a.i1(c.i9())&&b++;return b},i4:function(a){return null==this._a.i1(a)},i1:function(){throw"Error"},i3:function(){throw"Error"}});var Vf=function(){Vf.superClass.constructor.call(this),this._kq=!1,this._kp=90};Jc.ext(Vf,Sf,{a:function(a,b){this._kr=b,this._ks=a,this._kq=!0},i7:function(a){if(!this.u(a))return void Vf.superClass.i7.call(this,a);for(var b=this.i9(),c=this.ib(a),d=(360-c)/2+c,e=new pf(a.ap());;){var f=this.i6(a);f=(360-c)/2;for(var g=null,h=null,i=e._b;null!=i;i=i.a()){var j=i.d(),k=j.a3(),l=this.i0(k),m=this._ks.i3(j),n=m-(f+l._e);if(n>=0&&m+l._d>=d&&(n=f+l.a()<=d?d-f-l.a():2*(d-(m+l._d))),l._f=0,n>=0)l._f=n,g=i,h=l;else{for(-n>l._d+l._e?n=(l._d+l._e)/2:n/=-2,f-=n,d>=f&&f+l.a()>d&&(f+=n,n=f+l.a()-d,f-=n);null!=g&&n>h._f;h=this.i0(g.d().a3()))if(n-=h._f,h._f=0,g=g.b(),null==g){h=null;break}null!=g?h._f-=n:f+=n}f+=l.a()}if(d>=f){for(var o=0,p=(360-c)/2,q=a.ap();q.i1();q.i2()){var r=q.i8(),s=r.a3(),t=this._ks.i3(r),u=this.i0(s),v=p+u._f+u._e;o<Math.abs(v-t)&&(o=Math.abs(v-t)),p+=u.a()}if(o<=this._kp)break}for(var w=a.aw();w.i1();w.i2()){var x=w.i9();this.i0(x)._g*=1+b}}},ib:function(a){return this.u(a)?0===a.ak()?this.ic():this.ia():Vf.superClass.ib.call(this,a)},u:function(a){return this._kq&&0!==a.ao()?null!=this._ks.i1(a.ag()):!1}});var Wf=function(a){this._a=a};Jc.ext(Wf,Object,{i1:function(a){return this._a.i1(a)},i2:function(){throw"Error"},i3:function(){throw"Error"},i4:function(){throw"Error"}});var Xf=function(){};Jc.ext(Xf,Object,{w1:function(a){this._bb=a},w2:function(){return this._bb},w4:function(a){null!=this._bb&&this._bb.i2(a)},w3:function(a){return null!=this._bb?this._bb.i1(a):!0}});var Yf=function(){this._cg=45,this._ce=400,this._ch=400,this._cf=0};Jc.ext(Yf,Xf,{i1:function(a){if(null!=this.w2()){for(var b=!0,c=a.xk(),d=_e.a3(a,c),e=Eg.d(d),f=Eg.d(d),g=0;d>g;g++)e[g]=new Hf,f[g]=new pf;for(var h=a.xf();h.i1();h.i2()){var i=h.i8();f[c.i2(i.a2())].aa(i),a.h1(i)}for(var j=a.x9();j.i1();j.i2()){var k=j.i9();e[c.i2(k)].aa(k),a.h2(j.i9())}for(var l=0;d>l;l++){for(var m=e[l].x1();m.i1();m.i2())a.h3(m.i9());for(var n=f[l].c1();n.i1();n.i2())a.u1(n.i8());b=this.w3(a);for(var o=f[l].c1();o.i1();o.i2())a.h1(o.i8());for(var p=e[l].x1();p.i1();p.i2())a.h2(p.i9());if(!b)break}for(var q=0;d>q;q++)for(var r=e[q].x1();r.i1();r.i2())a.h3(r.i9());for(var s=0;d>s;s++)for(var t=f[s].c1();t.i1();t.i2())a.u1(t.i8());return a.xi(c),b}return!0},i2:function(a){if(!a.xb()){for(var b=a.xk(),c=_e.a3(a,b),d=Eg.d(c),e=Eg.d(c),f=Eg.d(c),g=Eg.d(c),h=0;c>h;h++)d[h]=new Hf,e[h]=new pf;for(var i=a.xf();i.i1();i.i2()){var j=i.i8();e[b.i2(j.a2())].aa(j),a.h1(j)}for(var k=a.x9();k.i1();k.i2()){var l=k.i9();d[b.i2(l)].aa(l),a.h2(k.i9())}for(var m=0;c>m;m++){for(var n=d[m].x1();n.i1();n.i2())a.h3(n.i9());for(var o=e[m].c1();o.i1();o.i2())a.u1(o.i8());this.w4(a);var p=a.g3();f[m]=new Se(p.x,p.y,p.width,p.height);var q={};if(g[m]=q,this._cf>0){var r=this._cg+Math.ceil((p.width+1)/this._cf)*this._cf,s=this._cg+Math.ceil((p.height+1)/this._cf)*this._cf;q.x=p.x,q.y=p.y,q.width=r,q.height=s}else q.x=p.x,q.y=p.y,q.width=p.width+this._cg,q.height=p.height+this._cg;for(var t=e[m].c1();t.i1();t.i2())a.h1(t.i8());for(var u=d[m].x1();u.i1();u.i2())a.h2(u.i9())}for(var v=0;c>v;v++)for(var w=d[v].x1();w.i1();w.i2())a.h3(w.i9());for(var x=0;c>x;x++)for(var y=e[x].c1();y.i1();y.i2())a.u1(y.i8());if(lg.a(g,null,this._ce/this._ch),this._cf<=0)for(var z=0;z<g.length;z++)this.w5(a,d[z],e[z],new Pe(g[z].x,g[z].y),f[z]);else for(var A=0;A<g.length;A++){var B=Math.floor((g[A].x-f[A].x)/this._cf)*this._cf,C=Math.floor((g[A].y-f[A].y)/this._cf)*this._cf,D=f[A].x+B,E=f[A].y+C;this.w5(a,d[A],e[A],new Pe(D,E),f[A])}a.xi(b)}},w5:function(a,b,c,d,e){for(var f=-e.x+d.x,g=-e.y+d.y,h=b.x1();h.i1();h.i2()){var i=a.ga(h.i9());a.s4(h.i9(),new Pe(i.x+f,i.y+g))}for(var j=c.c1();j.i1();j.i2()){for(var k=j.i8(),l=new me,m=a.gp(k).c();m.i1();m.i2()){var n=m.i6();l.add(new Pe(n.x+f,n.y+g))}a.s5(k,new Ue(l))}}});var Zf=function(){};Jc.ext(Zf,Xf,{i1:function(a){return this.w3(a)},i2:function(a){this.w7(a),null!=this.w2()&&this.w4(a),this.w6(a)},w7:function(a){this.e(a),this.k(a),this.i(a)},e:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},w6:function(a){this.l(a),this.j(a),this.f(a)},l:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},j:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},k:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},f:function(a){null!=this._ca&&(a.x1("A",this._ca),this._ca=null,this._b6=null),null!=this._b8&&(a.x1("B",this._b8),this._b8=null,this._b9=null)},i:function(a){this._ca=a.xc("A"),null!=this._ca&&(this._b6=new Wf(this._ca),a.x1("A",this._b6)),this._b8=a.xc("B"),null!=this._b8&&(this._b9=new Wf(this._b8),a.x1("B",this._b9))}});var $f=function(){this._a=new pf,this._c=10};Jc.ext($f,Xf,{i2:function(a){this._b=a.xl(),this.w9(a),this.w4(a),this.c(a),this.w8(a,this._b),a.xj(this._b)},i1:function(a){if(null==this.w2())return!0;this._b=a.xl(),this.w9(a);var b=this.w3(a);return this.c(a),a.xj(this._b),b},w8:function(a,b){for(var c=a.xf();c.i1();c.i2()){var d=c.i8();if(null!=b.i1(d)){var e=b.i1(d);lg.g(a,d,e,this._c)}}},w9:function(a){for(var b=a.xk(),c=a.x9();c.i1();c.i2()){for(var d=c.i9(),e=d.af();e.i1();e.i2()){var f=e.i8(),g=f.a1(d),h=b.i1(g);if(h!==f)if(null==h)b.z1(g,f);else{null==this._b.i1(h)&&this._b.i8(h,new pf);var i=this._b.i1(h);i.aa(f),this._a.ac(f),a.h1(f)}}for(var j=d.af();j.i1();j.i2()){var k=j.i8(),l=k.a1(d);b.z1(l,null)}}a.xi(b)},c:function(a){for(;!this._a.ar();a.u1(this._a.c3()));}});var _f=function(a){this._a=a};Jc.ext(_f,Object,{i2:function(a){this._a.i3(a)},i1:function(a){return this._a.i4(a)}});var ag=function(){ag.superClass.constructor.call(this),this._jo=30,this._jp=new eg,this._jt=5};Jc.ext(ag,Of,{i4:function(){return!0},i3:function(a){this._ju=a,lg.c(a);for(var b=this._jp.i1(a),c=0,d=a.x9();d.i1();d.i2())c=Math.max(c,this.e(d.i9()));c<this._jt&&(c=this._jt),this.a(b,c)},a:function(a,b){var c=a.i7(),d=2*Math.PI/c,e=0,f=Eg.a(c);a.i4();for(var g=0;c>g;)f[g]=this.e(a.i9())+this._jo,e+=f[g],g++,a.i2();var h=e/c,i=e/(2*Math.PI);b>i&&(i=b),a.i4();for(var j=0,k=0;c>k;){var l=d/h*f[k];j+=l/2;var m=Math.cos(j)*i,n=Math.sin(j)*i;j+=l/2,this._ju.s2(a.i9(),m,n),k++,a.i2()}return i},e:function(a){var b=this._ju.gj(a),c=this._ju.g9(a);return c>=b?c:b}});var bg=function(){bg.superClass.constructor.call(this),this._jm=new ag,this._jk=new Vf};Jc.ext(bg,Of,{i4:function(){return!0},i3:function(a){if(!(a.x0()<2)){this._jn=a,lg.c(this._jn),lg.e(this._jn);var b=new jg(this._jn);b.a1(),b.h();var c=new Jf(this._jn);c.a();for(var d=b.x9();d.i1();d.i2()){var e=d.i9(),f=b.c2(e);if(f.ay()>1){var g=b.d1(e);Jf.h(this._jn,g.c1()),this._jm.i3(this._jn);var h=this._jn.g3();b.s7(e,h.width,h.height)}else if(1===f.ay()){var i=f.x2();b.s8(e,this._jn.gm(i)),this._jn.s2(i,0,0)}else b.s7(e,1,1);Jf.i(this._jn,this._jn.xf())}c.b();var j=this.a7(b);gf.a4(b,j);var k=b.xk(),l=b.xl();this.a2(b,l,k),this.a1(b,l),this.a3(b,j,l),this._jk.a(l,k),this._jk.i3(b),this.a5(b,j,k);for(var m=b.x9();m.i1();m.i2())for(var n=m.i9(),o=b.g4(n),p=b.c2(n).x1();p.i1();p.i2()){var q=p.i9();this._jn.s2(q,o.x+this._jn.g5(q),o.y+this._jn.g6(q))}}},a7:function(a){for(var b=-1,c=null,d=a.x9();d.i1();d.i2()){var e=d.i9();a.c2(e).ay()>b&&(c=e,b=a.c2(e).ay())}return c},a1:function(a,b){for(var c=function(a,c){var d=b.i3(a)-b.i3(c);return d>0?1:d>=0?0:-1},d=a.x9();d.i1();d.i2())d.i9().av(c)},a2:function(a,b,c){for(var d=Eg.a(this._jn.x0()),e=a.x9();e.i1();e.i2())for(var f=e.i9(),g=a.c2(f),h=g.x1();h.i1();h.i2()){var i=h.i9();d[i.al()]=f.al()}var j=gf.a2(a);this.a4(a,j,d,b,c)},a3:function(a,b,c){if(a.c2(b).ay()>1){for(var d=0,e=0,f=0,g=b.ap();g.i1();g.i2()){var h=g.i8(),i=c.i3(h);i-d>e&&(e=i-d,f=(d+i)/2),d=i}360-d>e&&(f=(360+d)/2),this.a6(a,b,f);for(var j=b.ap();j.i1();j.i2()){var k=j.i8(),l=c.i3(k);for(l-=f;0>l;l+=360);c.i6(k,l)}b.av(function(a,b){var d=c.i3(a)-c.i3(b);return d>0?1:d>=0?0:-1
})}},a4:function(a,b,c,d,e){for(var f=b.al(),g=e.i3(b),h=b.ap();h.i1();h.i2()){for(var i=h.i8(),j=a.b(i),k=0,l=0,m=0,n=0,o=j.c1();o.i1();o.i2()){var p=o.i8(),q=null,r=null;c[p.a2().al()]===f?(q=p.a2(),r=p.a3()):(q=p.a3(),r=p.a2()),m-=this._jn.g5(q),n+=this._jn.g6(q),k-=this._jn.g5(r),l+=this._jn.g6(r)}if(0!==m||0!==n){var s;for(s=180*Math.atan2(n,m)/Math.PI-g;0>s;s+=360);d.i6(i,s)}if(0!==k&&0!==l){var t=180*Math.atan2(l,k)/Math.PI;0>t&&(t+=360),e.i6(i.a3(),t)}this.a4(a,i.a3(),c,d,e)}},a5:function(a,b,c){for(var d=a.g4(b),e=b.ap();e.i1();e.i2()){var f=e.i8(),g=f.a3(),h=a.g4(g),i=h.x-d.x,j=h.y-d.y,k=180*Math.atan2(j,i)/Math.PI;if(null!=c.i1(g)){var l=c.i3(g);k+=l}this.a6(a,g,k),this.a5(a,g,c)}},a6:function(a,b,c){c=c/180*Math.PI;var d=a.c2(b);if(!(d.ay()<=1))for(var e=d.x1();e.i1();e.i2()){var f=e.i9(),g=this._jn.g5(f),h=this._jn.g6(f),i=Math.cos(c),j=Math.sin(c),k=g*i-j*h,l=g*j+i*h;this._jn.s2(f,k,l)}}});var cg=function(){this._a=(new Date).getTime()};Jc.ext(cg,Object,{b:function(){return(new Date).getTime()-this._a}});var dg={};dg._A=new Pe(0,0),dg.b=function(a,b,c){return dg.c(a.x,a.y,b.x,b.y,c.x,c.y)},dg.c=function(a,b,c,d,e,f){c-=a,d-=b,e-=a,f-=b;var g=e*d-f*c;return g>=0?0>=g?0:-1:1},dg.d=function(a,b,c){return dg.b(a,b,c)>0},dg.f=function(a,b,c){return dg.b(a,b,c)<0},dg.g=function(a,b,c){return 0===dg.b(a,b,c)},dg.h=function(a){return dg.i(a)},dg.i=function(a){var b=new of(a.ah()),c=new of;if(b.a2(),b.ar())return c;var d=b.at();for(c.ae(d);!b.ar()&&d.equals(b.am());b.at());if(b.ar())return c;d=b.at();for(var e=c.ae(d),f=b.ah();f.i1();f.i2()){var g=f.i6();if(!g.equals(d))if(d=g,2===c.ay()&&dg.g(c.am(),c.as(),g))e.c(g);else{var h;for(h=e;!dg.f(c.ai(h).d(),h.d(),g);h=c.ai(h));var i;for(i=e;!dg.d(c.aj(i).d(),i.d(),g);i=c.aj(i));for(;i!==c.aj(h);c.aw(c.aj(h)));e=c.an(g,h)}}return c},dg.j=function(){return dg.k(Number.MAX_VALUE)},dg.k=function(a){return Math.floor(Math.random()*a)},dg.l=function(a,b){return Math.random()*(b-a)+a};var eg=function(){};Jc.ext(eg,Object,{i1:function(a){this._b=a;var b=new pf;b=_e.a6(a),b.az(_e.a7(a));for(var c=this.a1();!b.ar();a.x5(b.c3()));return c.x1()},a1:function(){if(this._b.x0()<3)return new Hf(this._b.x9());for(var a=this._b.xk(),b=this._b.xk(),c=this._b.xl(),d=new Kf(this._b,new Tf,0,this.a3(this._b)),e=this._b.x0(),f=new pf,g=new pf,h=new Jf(this._b);e>3;e--){for(var i=d.g(),j=i.an();j.i1();j.i2())a.z1(j.i9(),e),b.i5(j.i9(),!1);for(var k=i.an();k.i1();k.i2())for(var l=k.i9(),m=l.ap();m.i1();m.i2()){var n=m.i8();a.i2(n.a3())===e&&(g.aa(n),b.i5(n.a2(),!0),b.i5(n.a3(),!0))}if(g.ay()<i.ad()-1){for(var o=null,p=i.an();p.i1();p.i2()){var q=p.i9();if(a.i2(q)===e&&!b.i4(q))if(null==o)o=q;else{var r=this._b.xo(o,q);c.i7(r,!0),g.aa(r),o=null}}if(null!=o)for(var s=i.an();s.i1();s.i2()){var t=s.i9();if(t!==o&&null==t.aj(o)){var u=this._b.xo(o,t);c.i7(u,!0),g.aa(u);break}}if(g.ay()<i.ad()-1){for(var v=2147483647,w=null,x=i.an();x.i1();x.i2()){var y=x.i9();y.ad()<v&&(w=y,v=y.ad())}for(var z=i.an();z.i1();z.i2()){var A=z.i9();if(null==w.aj(A)&&w!==A){var B=this._b.xo(w,A);if(c.i7(B,!0),g.aa(B),g.ay()>=i.ad()-1)break}}}}for(var C=i.an();C.i1();C.i2())d.b(C.i9());for(var D=g.c1();D.i1();D.i2()){var E=D.i8();c.i4(E)&&(d.d(E.a2()),d.d(E.a3()))}f.az(g),h.e(i)}h.b(),d.c();for(var F=f.c1();F.i1();F.i2()){var G=F.i8();null!=G._h&&(c.i4(G)?this._b.x5(G):this._b.h1(G))}var H=this.a4(this._b),I=new Hf,J=H.ak(0),K=H.ak(1),L=null;L=J.a2()===K.a2()||J.a2()===K.a3()?J.a3():J.a2(),I.aa(L);for(var M=H.c1();M.i1();M.i2()){var N=M.i8();L=N.a1(L),I.aa(L)}for(var O=f.c1();O.i1();O.i2()){var P=O.i8();c.i4(P)||null!=P._h||this._b.u1(P)}return this._b.xi(b),this._b.xj(c),this._b.xi(a),this.a2(I),I},a2:function(a){if(a.ay()<this._b.x0()){for(var b=this._b.xk(),c=a._b;null!=c;c=c.a()){var d=c.d();b.z1(d,c)}var e;for(e=new Kf(this._b,new Uf(b),0,a.ay(),new Uf(b));!e.e();){for(var f=e.f(),g=f.an();g.i1();g.i2()){var h=g.i9();if(null!=b.i1(h)){var i=b.i1(h),j=a.ai(i).d(),k=null;k=null!=f.aj(j)?a.ao(f,i):a.an(f,i),b.z1(f,k);break}}for(var l=f.an();l.i1();l.i2()){var m=l.i9();null==b.i1(m)&&e.d(m)}}this._b.xi(b),e.c()}},a3:function(a){for(var b=0,c=a.x9();c.i1();c.i2())b=Math.max(b,c.i9().ad());return b},a4:function(a){for(var b=[],c=0,d=a.x0();d>c;c++)b[c]=new ef;var e=new cf(b);e.a6(!1),e.a8(a);for(var f=-1,g=null,h=a.x9();h.i1();h.i2()){var i=h.i9(),j=b[i.al()];j._a+j._c>f&&(f=j._a+j._c,g=i)}for(var k=new pf,l=g,m=b[l.al()]._d;null!=m;m=b[l.al()]._d)k.ac(m),l=m.a1(l);l=g;for(var n=b[l.al()]._b;null!=n;n=b[l.al()]._d)k.ae(n),l=n.a1(l);return k}});var fg=function(){this._v=new qf,this._x=new qf,this._z=new Bf(3,5),this._w=new Bf(3,5),this._y=!1,this._u=!1,this._t={}};Jc.ext(fg,Object,{xm:function(){var a=new Cf(this);return a},xo:function(a,b){return this.xn(a,null,b,null,0,0)},xn:function(a,b,c,d,e,f){return new wf(this,a,b,c,d,e,f)},x4:function(a){this.b3(a)},b3:function(a){for(var b;null!=(b=a._o[0]);)this.x5(b);for(;null!=(b=a._o[1]);)this.x5(b);this._v.c(a),a._g=null,this._y=!0},x5:function(a){this.a11(a)},a11:function(a){if(a._h!==this)throw"Error";var b=a.a2(),c=a.a3();this.a12(a,b,c),this._x.c(a),a._h=null,this._u=!0},x7:function(a){a._p=this._v._c,a._g=this,a.ac(),a._c.length<this._z._b&&this._z.a3(a,a._c.length,this._z._b),this._v.a(a),this._y=!0},x8:function(a){if(null!=a._h)throw"Error";a._c.length<this._w._b&&this._w.a3(a,a._c.length,this._w._b),null==a._a||a._a._h!==this?this._x.a(a):this._x.b(a,a._a),a._h=this,a.a4(),this.b2(a,a.a2(),null,a.a3(),null,0,0),this._u=!0},xr:function(a,b,c){var d=a.a2(),e=a.a3();null==a._h?(a._d=b,a._e=c):(d!==b&&(d.ar(a,0,0),a._d=b,b.ab(a,null,0,0,0)),e!==c&&(e.ar(a,1,1),a._e=c,c.ab(a,null,1,1,0)))},x3:function(a){this.xr(a,a.a3(),a.a2())},h1:function(a){this.a11(a)},u1:function(a){this.x8(a)},h2:function(a){this.x4(a)},h3:function(a){this.x7(a)},xa:function(){return this._v._c},x0:function(){return this._v._c},xh:function(){return this._x._c},xg:function(){return this._x._c},xb:function(){return 0===this._v._c},xq:function(a){return a._g===this},xp:function(a){return a._h===this},xd:function(){return this._v._a},x9:function(){return new Gf(this._v)},xf:function(){return new Gf(this._x)},x2:function(a,b){var c=Eg.d(this.xh());if(null!=a&&null!=b)for(var d=this.x9();d.i1();d.i2())d.i9().at(a,1,c),d.i9().at(b,0,c);else if(null==b&&null!=a)for(var e=this.x9();e.i1();e.i2())e.i9().at(a,1,c);else if(null!=b&&null==a)for(var f=this.x9();f.i1();f.i2())f.i9().at(b,0,c)},xk:function(){return this._z.b(this._v)},xl:function(){return this._w.c(this._x)},xi:function(a){this._z.a5(a,this._v)},xj:function(a){this._w.a6(a,this._x)},xc:function(a){return this._t[a]},x1:function(a,b){this._t[a]=b},x6:function(a){delete this._t[a]},b2:function(a,b,c,d,e,f,g){b.ab(a,c,0,0,f),d.ab(a,e,1,1,g)},a12:function(a,b,c){b.ar(a,0,0),c.ar(a,1,1)},c:function(){for(var a=0,b=this.x9();b.i1();b.i2())b.i9()._p=a++;this._y=!1},b1:function(){for(var a=0,b=this.xf();b.i1();b.i2())b.i8()._g=a++;this._u=!1},xs:function(a){a.as(this,this._z._b),a._p=this._v._c,this._v.a(a)},xt:function(a,b,c,d,e,f,g){a.a6(this,b,d,this._w._b),a._g=this._x._c,this._x.a(a),this.b2(a,a.a2(),c,a.a3(),e,f,g)}});var gg=function(){gg.superClass.constructor.call(this)};Jc.ext(gg,fg,{gb:function(a){return this.g1(a)},g7:function(a){return this.g2(a)},g5:function(a){var b=this.g1(a);return b.i1()+b.i3()/2},g6:function(a){var b=this.g1(a);return b.i2()+b.i4()/2},g4:function(a){return new Pe(this.g5(a),this.g6(a))},gi:function(a){return this.g1(a).i1()},gh:function(a){return this.g1(a).i2()},ga:function(a){var b=this.g1(a);return new Pe(b.i1(),b.i2())},gj:function(a){return this.g1(a).i3()},g9:function(a){return this.g1(a).i4()},gm:function(a){return new Qe(this.gj(a),this.g9(a))},s1:function(a,b){this.s2(a,b.x,b.y)},s2:function(a,b,c){var d=this.g1(a);d.i5(b-d.i3()/2,c-d.i4()/2)},s7:function(a,b,c){this.g1(a).i6(b,c)},s8:function(a,b){this.s7(a,b.width,b.height)},s3:function(a,b,c){this.g1(a).i5(b,c)},s4:function(a,b){this.s3(a,b.x,b.y)},gp:function(a){for(var b=this.g2(a),c=new me,d=0;d<b.i1();d++)c.add(b.i2(d));return new Ue(c)},gf:function(a){for(var b=this.g2(a),c=new of,d=0;d<b.i1();d++)c.aa(b.i2(d));return c},gc:function(a){var b=new me;b.add(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.add(c.i6());return b.add(this.gl(a)),new Ue(b)},gd:function(a){var b=new of;b.aa(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.aa(c.i6());return b.aa(this.gl(a)),b},m1:function(a,b){var c=this.g2(a);c.i5();var d=b.ah(),e=d.i6();this.gx(a,e);var f=b.as();for(d.i2();d.i6()!==f;d.i2()){var g=d.i6();c.i4(g.x,g.y)}this.gy(a,f)},s5:function(a,b){var c=this.g2(a);c.i5();for(var d=b.d();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},s6:function(a,b){var c=this.g2(a);c.i5();for(var d=b.ah();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},m2:function(a,b,c){this.gx(a,b),this.gy(a,c)},gn:function(a){return this.g2(a).i6()},gk:function(a){return this.g2(a).i7()},gt:function(a,b){this.g2(a).i8(b)},gz:function(a,b){this.g2(a).i9(b)},gs:function(a){var b=this.g2(a).i6();if(null==b)return this.g4(a.a2());var c=new Pe(this.g5(a.a2())+b.x,this.g6(a.a2())+b.y);return c},gl:function(a){var b=this.g2(a).i7();if(null==b)return this.g4(a.a3());var c=new Pe(this.g5(a.a3())+b.x,this.g6(a.a3())+b.y);return c},gx:function(a,b){var c=new Pe(b.x-this.g5(a.a2()),b.y-this.g6(a.a2()));this.g2(a).i8(c)},gy:function(a,b){var c=new Pe(b.x-this.g5(a.a3()),b.y-this.g6(a.a3()));this.g2(a).i9(c)},g8:function(){for(var a=new pf,b=this.xf();b.i1();b.i2())a.aa(b.i8());return a},g3:function(){for(var a,b,c=a=Number.MAX_VALUE,d=b=Number.MIN_VALUE,e=this.x9();e.i1();e.i2()){var f=this.ga(e.i9()),g=this.gm(e.i9());c=Math.min(f.x,c),a=Math.min(f.y,a),d=Math.max(f.x+g.width,d),b=Math.max(f.y+g.height,b)}for(var h=this.xf();h.i1();h.i2())for(var i=this.gp(h.i8()).c();i.i1();i.i2()){var j=i.i6();c=Math.min(j.x,c),a=Math.min(j.y,a),d=Math.max(j.x,d),b=Math.max(j.y,b)}return{x:Math.floor(c),y:Math.floor(a),width:Math.floor(d-c),height:Math.floor(b-a)}}});var hg=function(){hg.superClass.constructor.call(this),this.a(new $e,new Ye)};Jc.ext(hg,gg,{a:function(a,b){this._a3=a,this._a4=b},xo:function(a,b){return this.l2(a,b,this._a4.a6())},l2:function(a,b,c){return this.l1(a,null,b,null,0,0,c)},xn:function(a,b,c,d,e,f){return this.l1(a,b,c,d,e,f,this._a4.a6())},l1:function(a,b,c,d,e,f,g){var h=new wf(this,a,b,c,d,e,f);return h._l=g,h},xm:function(){var a=new Cf(this);return a._r=this._a3.m3(),a},g3:function(){for(var a={x:0,y:0,width:-1,height:-1},b=this.x9();b.i1();b.i2())b.i9()._r.m1(a);return a},g1:function(a){return a._r},g2:function(a){return a._l},g5:function(a){return a._r.m4()},g6:function(a){return a._r.m5()},gi:function(a){return a._r.i1()},gh:function(a){return a._r.i2()},gj:function(a){return a._r.i3()},g9:function(a){return a._r.i4()},s2:function(a,b,c){a._r.m6(b,c)},s7:function(a,b,c){a._r.i6(b,c)},s3:function(a,b,c){a._r.i5(b,c)}});var ig=function(){ig.superClass.constructor.call(this),this._ap=this.xk(),this._as=this.xl()};Jc.ext(ig,gg,{g1:function(a){var b=this._ap.i1(a);return null==b&&(b=new zf,this._ap.z1(a,b)),b},g2:function(a){var b=this._as.i1(a);return null==b&&(b=new yf,this._as.i8(a,b)),b}});var jg=function(a){jg.superClass.constructor.call(this),this._ay=a,this._a0=this.xk(),this._au=this.xl()};Jc.ext(jg,ig,{c2:function(a){var b=this._a0.i1(a);return b},a2:function(a,b){this._a0.z1(a,b)},h:function(){null==this._az&&(this._az=this.xk());for(var a=Eg.a(this._ay.x0()+1),b=1,c=this.x9();c.i1();){for(var d=this.c2(c.i9()),e=d.x1();e.i1();e.i2()){var f=e.i9();a[f.al()]=b}for(var g=new pf,h=d.x1();h.i1();h.i2())for(var i=h.i9(),j=a[i.al()],k=i.ap();k.i1();k.i2()){var l=k.i8(),m=l.a3(),n=a[m.al()];n===j&&g.ac(l)}this._az.z1(c.i9(),g),c.i2(),b++}},d1:function(a){return this._az.i1(a)},b:function(a){return this._au.i1(a)},a3:function(a,b){this._au.i8(a,b)},a1:function(){var a=this._ay.xk(),b=Lf.a4(Eg.a(this._ay.xh())),c=_e.a1(this._ay,b,a),d=_e.a5(this._ay,b,c);this.d2(a,d),this._ay.xi(a)},c1:function(a){for(var b=null,c=-1,d=0,e=a.length;e>d;d++){var f=a[d];f.ay()>c&&(b=f,c=f.ay())}return b},d2:function(a,b){for(var c=this._ay.xl(),d=this._ay.xk(),e=b.length,f=0;e>f;f++)for(var g=b[f],h=g.c1();h.i1();h.i2())c.i8(h.i8(),g);var i=this.c1(b);this.a4(i,a,c,new me,d);var j={};e=b.length;for(var k=0;e>k;k++){var l=b[k];if(l.ay()>1){var m=this.xm();j[l._id]=m}}for(var n=this._ay.x9();n.i1();n.i2()){var o=n.i9();if(a.i4(o)&&null==d.i1(o)){var p=this.xm();j[o._id]=p;var q=new Hf;q.aa(o),this.a2(p,q)}}var r=Eg.d(2);e=b.length;for(var s=0;e>s;s++){var t=b[s];if(1===t.ay()){var u=t.c2();r[0]=u.a2(),r[1]=u.a3();for(var v=0;2>v;v++){var w=r[v];if(1===w.ad()){var x=this.xm();j[w._id]=x;var y=new Hf;y.aa(w),this.a2(x,y)}}}}for(var z=this._ay.x9();z.i1();z.i2()){var A=z.i9();if(null!=d.i1(A))for(var B=d.i1(A),C=j[B._id],D=A.af();D.i1();D.i2()){var E=D.i8();if(c.i1(E)!==B){var F=j[c.i1(E)._id];if(null==F){var G=E.a1(A),H=d.i1(G);F=null!=H?j[H._id]:j[G._id]}var I=C.aj(F),J=null;null==I?(I=this.xo(C,F),J=new pf):J=this.b(I),J.aa(E),this.a3(I,J)}}else if(a.i4(A))for(var K=j[A._id],L=A.af();L.i1();L.i2()){var M=L.i8(),N=M.a1(A),O=j[N._id];if(null!=O){var P=K.aj(O);if(null==P){var Q=this.xo(K,O),R=new pf;R.aa(M),this.a3(Q,R)}}}}if(2===this._ay.x0()&&1===this._ay.xg()){var S=this._ay.xf().i8(),T=j[S.a2()._id],U=j[S.a3()._id];if(null!=U&&null!=T&&null==U.aj(T)){var V=this.xo(T,U),W=new pf;W.aa(S),this.a3(V,W)}}var X=Eg.a(this._ay.x0()),Y=1;e=b.length;for(var Z=0;e>Z;Z++){var $=b[Z],_=j[$._id];if(null!=_){var ab=this.c2(_);null==ab&&(ab=new Hf,this.a2(_,ab));for(var bb=$.c1();bb.i1();bb.i2()){var cb=bb.i8(),db=cb.a2();X[db.al()]===Y||a.i4(db)&&d.i1(db)!==$||(X[db.al()]=Y,ab.aa(db)),db=cb.a3(),X[db.al()]===Y||a.i4(db)&&d.i1(db)!==$||(X[db.al()]=Y,ab.aa(db))}}}this._ay.xj(c),this._ay.xi(d)},a4:function(a,b,c,d,e){if(!d.contains(a)){d.add(a);for(var f=[],g=a.c1();g.i1();g.i2()){var h=g.i8();f[0]=h.a2(),f[1]=h.a3();for(var i=0;2>i;i++){var j=f[i];if(b.i4(j)&&null==e.i1(j)){a.ay()>1&&e.z1(j,a);for(var k=j.af();k.i1();k.i2()){var l=c.i1(k.i8());this.a4(l,b,c,d,e)}}}}}}});var kg=function(a,b,c,d,e){this._a={},kg.superClass.constructor.call(this);var f,g,h=new me;for(f=0,g=b.size();g>f;f++){var i=b.get(f);if(i instanceof Ic.Link)h.add(i);else{var j=d&&null==e&&i instanceof Ke;j&&i.setExpanded(!0);var k=a.getDimension(i);if(j&&i.setExpanded(!1),null==k)continue;var l=this.xm(),m=a._repulsion;"rightleft"===c||"leftright"===c?this.s7(l,k.height*m,k.width*m):this.s7(l,k.width*m,k.height*m),l.node=i,this._a[i.getId()]=l}}for(f=0,g=h.size();g>f;f++){var n=h.get(f),o=n.getFromAgent(),p=n.getToAgent(),q=this._a[o.getId()],r=this._a[p.getId()];null!=q&&null!=r&&q!==r&&this.xo(q,r)}};Jc.ext(kg,hg,{});var lg={};lg._D=new Ue,lg._E=new Pe(0,0),lg.b=function(a){if(a.i1()>0){for(var b=new me,c=a.i1()-1;c>=0;c--)b.add(a.i2(c));a.i5();for(var d=0,e=b.size();e>d;d++){var f=b.get(d);a.i4(f.x,f.y)}}var g=a.i6();a.i8(a.i7()),a.i9(g)},lg.c=function(a){lg.d(a,!0)},lg.d=function(a,b){if(b)for(var c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,lg._E),a.gz(d,lg._E),a.s5(d,lg._D)}else for(var e=a.xf();e.i1();e.i2())a.s5(e.i8(),lg._D)},lg.e=function(a){for(var b=new Pe(0,0),c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,b),a.gz(d,b)}},lg.f=function(a,b,c,d){for(var e=a.gc(b).b(),f=Eg.d(e),g=0,h=a.gc(b).c();h.i1();h.i2()){var i=h.i6();(0>=g||!i.equals(f[g-1]))&&(f[g]=new Pe(i.x,i.y),g++)}if(e=g,!(2>e)){var j=new me,k=new Re(f[1].x-f[0].x,f[1].y-f[0].y),l=lg.i(k);l.x*=d,l.y*=d;for(var m=lg.h(f[0],l),n=lg.h(f[1],l),o=new Te(m,n),p=1;e-1>p;p++){var q=o,r=lg.i(new Re(f[p+1].x-f[p].x,f[p+1].y-f[p].y));r.x*=d,r.y*=d;var s=lg.h(f[p],r),t=lg.h(f[p+1],r);o=new Te(s,t);var u=Te.a6(q,o);null!=u&&j.add(new Pe(u.x,u.y))}var v=new Re(f[e-1].x-f[e-2].x,f[e-1].y-f[e-2].y);v=lg.i(v),v.x*=d,v.y*=d;var w=lg.h(f[e-1],v),x=new Ue(j);b.a2()===c.a2()?(a.s5(c,x),a.m2(c,m,w)):(a.s5(c,x.a()),a.m2(c,w,m))}},lg.g=function(a,b,c,d){for(var e=d,f=c.c1();f.i1();f.i2()){var g=f.i8();lg.f(a,b,g,e),0>e&&(e-=d),e=-e}},lg.a=function(a,b,c){return lg.j(a,b,c,1)},lg.l=function(a,b,c){if(null==a||a.length<1)return null!=b&&(b.x=0,b.y=0,b.width=0,b.height=0),{width:0,height:0};for(var d=0,e=0,f=0;f<a.length;f++){var g=a[f];d=Math.max(d,g.width),e=Math.max(e,g.height)}var h,i,j=d*e*a.length,k=Math.sqrt(j/c),l=j/k,m=Math.floor(l/d),n=Math.ceil(l/d),o=Math.ceil(a.length/m),p=Math.ceil(a.length/n);n*p>m*o?(h=m,i=o):(h=n,i=p);var q,r=0,s=0,t=0,u=0;if(d>e)for(var v=0;v<a.length;v++)q=a[v],q.x=s*d,q.y=r*e,t=Math.max(t,q.x+q.width),u=Math.max(u,q.y+q.height),++s>=h&&(r++,s=0);else for(var w=0;w<a.length;w++)q=a[w],q.x=s*d,q.y=r*e,t=Math.max(t,q.x+q.width),u=Math.max(u,q.y+q.height),++r>=i&&(s++,r=0);return null!=b&&(b.x=0,b.y=0,b.width=t,b.height=u),{width:i,height:h}},lg.j=function(a,b,c){if(null==a||a.length<1)return null!=b&&(b.x=0,b.y=0,b.width=0,b.height=0),0;for(var d,e,f=d=a[0].width,g=e=a[0].height,h=a.length,i=1;h>i;i++){var j=a[i].width;f=Math.min(f,j),d=Math.max(d,j);var k=a[i].height;g=Math.min(g,k),e=Math.max(e,k)}if(g/e>.95&&f/d>.95)return lg.l(a,b,c).width;for(var l=new of,m=0,n=0;h>n;n++){var o=a[n];l.aa(a[n]),m=Math.floor(m+o.width*o.height)}l.a1(function(a,b){var c=Math.floor(b.height)-Math.floor(a.height);return 0===c?Math.floor(b.width)-Math.floor(a.width):c});var p=0,q=0,r=Math.floor(c*Math.sqrt(m/c)),s=r,t=0,u=new of;do{var v=new of;u.aa(v);for(var w,x,y=w=x=0,z=l.ah();z.i1();z.i2()){var A=z.i6();y+A.width>s&&v.ay()>0?(x=Math.max(x,y),v=new of,v.aa(A),u.aa(v),y=Math.floor(A.width)):(v.aa(A),y=Math.floor(y+A.width)),1===v.ay()&&(w=Math.floor(w+v.am().height))}x=Math.max(x,y),c*w>x&&t!==x&&(u.af(),s=Math.floor(1.1*s),t=x)}while(u.ar());for(var B=0,C=u.ah();C.i1();C.i2()){for(var D=0,E=C.i6(),F=E.ah();F.i1();F.i2()){var G=F.i6();G.x=D,G.y=B,D+=G.width}p=Math.max(p,D),B+=lg.k(E),q=Math.max(q,B)}return null!=b&&(b.x=0,b.y=0,b.width=p,b.height=q),u.ay()},lg.k=function(a){for(var b=0,c=a.ah();c.i1();c.i2())b=Math.max(c.i6().height,b);return b},lg.h=function(a,b){return new Pe(a.x+b.x,a.y+b.y)},lg.i=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);return new Re(-a.y/b,a.x/b)};var mg=function(a){this._a=a,this._b=!1};Jc.ext(mg,Object,{a:function(){return this._b},b:function(){return this._a},c:function(){return 1===this._a},d:function(){return 2===this._a},e:function(){return 4===this._a},f:function(){return 8===this._a},g:function(){return 0===this._a}}),mg.h=function(a,b){var c=a.xc("A");return null==c?null:c.i1(b)},mg.i=function(a,b){var c=a.xc("B");return null==c?null:c.i1(b)},mg.j=function(a){switch(a){case 1:return mg.k;case 2:return mg.l}return null},mg.k=new mg(1),mg.l=new mg(2);var ng=function(a,b,c,d,e){this._o=0,this._l=0,this._i=0,this._d=0,this._f=0,this._b=a,this._a=1e-4,this._r=b,this._p=1,this._e=(e.gj(a)+e.g9(a))/4;var f=.45*c*Math.sqrt(d);this._k=dg.l(-f,f),this._h=dg.l(-f,f),this._g=dg.l(-f,f)};Jc.ext(ng,Object,{});var og=function(){this._a=0,this._c=0,this._b=0};Jc.ext(og,Object,{});var pg=function(){pg.superClass.constructor.call(this),this._dj=0,this._dh=0,this._dq=0,this._dp=0,this._dt=0,this._de=0,this._d3=0,this._dr=0,this._ed=0,this._dw=.65,this._ea=1,this._dl=80,this._dx=3,this._d8=!0,this._eb=3e5,this._ee=2,this._di=2,this._df=1e3};Jc.ext(pg,Of,{i4:function(){return!0},i3:function(a){if(null!=a&&(this._d5=a,this.s(a))){var b=new og,c=0,d=Math.floor(this._dx*this._dz.length*this._dz.length+20*this._dz.length);d=Math.max(d,1e4);var e=this._ea*this._ea*this._dz.length,f=this._df;try{for(;this._dj>e&&d>c;c++){var g=this.b(2147483647&c);0===f--&&(this._dy.b()>this._eb&&(c=d),f=this._df),this.h(g,b),this.d(g,b),this.i(g,b),this._d8?(this.g(g,b),this.j(g,b)):(this.f(g,b),this.c(g,b));var h=Math.sqrt(b._a*b._a+b._c*b._c+b._b*b._b);this.ac(g,b,h),this.aa(g,b,h)}}catch(i){}finally{this.r()}}},s:function(a){if(null==a||a.xa()<1)return!1;this._d5=a,this._dp=1,this._dy=new cg,this._dt=a.x0(),this._d2=Eg.d(this._dt),this._df=1+1e5/this._dt,this._ed=1/(2*this._di),this._de=this._ed*this._ee/(.05*this._dl),this._d3=Math.pow(this._dl,-1)*this._ed,this._dr=Math.pow(this._dl,3)*this._ed,this._dj=0,this._du=new og,this._dq=Math.max(20*this._dl,10);var b=Math.max(.1,Math.min(this._dw*this._dl,this._dq)),c=this._dt;lg.c(a),this._dz=Eg.d(c);for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=new ng(e,b,this._dl,this._dt,a);this._dz[--c]=f,this._dj+=f._r,this._dh+=f._r*f._r,this._du._a+=f._k,this._du._c+=f._h,this._du._b+=f._g,this._d2[e.al()]=f}return this._d8=!1,this._dz.length>0},b:function(a){var b=this._dz.length,c=b-a%b-1,d=dg.k(c+1),e=this._dz[d];return this._dz[d]=this._dz[c],this._dz[c]=e,e},f:function(a,b){for(var c,d,e=c=d=0,f=a._b.ae();null!=f;f=f.a7()){var g,h=this._d2[f.a2().al()],i=h._k-a._k,j=h._h-a._h,k=h._g-a._g,l=i*i+j*j+k*k,m=Math.sqrt(l),n=m-(h._e+a._e);0>=n||(g=n*n*this._d3/m,e+=i*g,c+=j*g,d+=k*g)}for(var o=a._b.ag();null!=o;o=o.a8()){var p,q=this._d2[o.a3().al()],r=q._k-a._k,s=q._h-a._h,t=q._g-a._g,u=r*r+s*s+t*t,v=Math.sqrt(u),w=v-(q._e+a._e);0>=w||(p=w*w*this._d3/v,e+=r*p,c+=s*p,d+=t*p)}b._a+=e,b._c+=c,b._b+=d},g:function(a,b){var c,d,e=c=d=0;this._dp++,a._f=this._dp;for(var f=a._b.ae();null!=f;f=f.a7()){var g=this._d2[f.a2().al()];g._f=this._dp;var h=g._k-a._k,i=g._h-a._h,j=g._g-a._g,k=h*h+i*i+j*j,l=Math.sqrt(k);if(0!==l){var m=Math.max(1e-6,l-(a._e+g._e)),n=-this._ef[f.a5()]/(m*m);n+=m*m*this._d1[f.a5()],n/=l,e+=h*n,c+=i*n,d+=j*n}}for(var o=a._b.ag();null!=o;o=o.a8()){var p=this._d2[o.a3().al()];p._f=this._dp;var q=p._k-a._k,r=p._h-a._h,s=p._g-a._g,t=q*q+r*r+s*s,u=Math.sqrt(t);if(0!==u){var v=Math.max(1e-6,u-(a._e+p._e)),w=-this._ef[o.a5()]/(v*v);w+=v*v*this._d1[o.a5()],w/=u,e+=q*w,c+=r*w,d+=s*w}}b._a+=e,b._c+=c,b._b+=d},j:function(a,b){for(var c,d,e=c=d=0,f=this._dt-1;f>=0;f--){var g=this._d2[f];if(g._f!==a._f){var h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(0!==k){var l=Math.sqrt(k),m=Math.max(1e-6,l-(a._e+g._e)),n=this._dr/(m*m*l);e+=h*n,c+=i*n,d+=j*n}}}b._a+=e,b._c+=c,b._b+=d},c:function(a,b){for(var c,d,e=c=d=0,f=this._dt-1;f>=0;f--){var g=this._d2[f],h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(0!==k){var l,m=Math.sqrt(k),n=m-(a._e+g._e);l=0>=n?this._dr/(1e-8*m):this._dr/(n*n*m),e+=h*l,c+=i*l,d+=j*l}}b._a+=e,b._c+=c,b._b+=d},i:function(a,b){var c=this._du._b/this._dt-a._g;b._b+=c*this._dl*this._dt/this._dh},d:function(a,b){if(0!==this._de){var c=this._du._a/this._dt-a._k,d=this._du._c/this._dt-a._h,e=this._du._b/this._dt-a._g;b._a+=c*this._de,b._c+=d*this._de,b._b+=e*this._de}},h:function(a,b){var c=.05*(a._r+2);c>0&&(b._a=dg.l(-c,c),b._c=dg.l(-c,c),b._b=dg.l(-c,c))},ac:function(a,b,c){if(0!==c&&0!==a._a){var d=b._a*a._o+b._c*a._l+b._b*a._i,e=d/(c*a._a);this._dh-=a._r*a._r,this._dj-=a._r,a._r+=a._p*e>0?.45*e:.15*e,a._r>this._dq?a._r=this._dq:a._r<.1&&(a._r=.1),this._dj+=a._r,this._dh+=a._r*a._r,a._p=e}},aa:function(a,b,c){if(c>0){var d=a._r/c,e=b._a*d,f=b._c*d,g=b._b*d;a._k+=e,a._h+=f,a._g+=g,this._du._a+=e,this._du._c+=f,this._du._b+=g,a._a=c,a._o=b._a,a._l=b._c,a._i=b._b}},r:function(){for(var a=this._d2.length-1;a>=0;a--){var b=this._d2[a];this._d5.s2(b._b,b._k,b._h)}}});var qg=function(a,b,c,d){this._e=a,this._f=b,this._a=c,this._b=d,this._c={}};Jc.ext(qg,Object,{resetGroup:function(){if(this._a&&null==this._b)for(var a in this._c){var b=this._c[a];b.group.setExpanded(this._e.isExpandGroup()?!0:b.b)}},process:function(){for(var a=new me,b=0,c=this._f.size();c>b;b++){var d=this._f.get(b);if(d instanceof Ic.Link)d.isLooped()||a.add(d);else{if(null==this._b&&d.getParent()instanceof Ke)continue;(null==this._b||null!=this._b&&this._b!==d)&&a.add(d),null==this._b&&d instanceof Ke&&this.layoutGroup(d)}}return a},layoutGroup:function(a){if(this._a&&null==this._c[a.getId()]&&null==this._b){this._c[a.getId()]={group:a,b:a.isExpanded()};var b=this._e.getGroupLayoutType(a);if(b){a.setExpanded(!0);for(var c,d=new me,e=a.getChildren(),f=0,g=e.size();g>f;f++)if(c=e.get(f),c instanceof Ke&&(this.layoutGroup(c),c.setExpanded(!1)),c instanceof Ic.Link||d.contains(c)||d.add(c),c instanceof Je){var h=c.getLinks();if(null!=h)for(var i=0,j=h.size();j>i;i++){var k=h.get(i);d.contains(k)||d.add(k)}}var l=new kg(this._e,d,b,this._a,this._b);try{var m=null;if("round"===b?m=new bg:"symmetry"===b?m=new pg:"hierarchic"===b?m=new zg:("topbottom"===b||"bottomtop"===b||"rightleft"===b||"leftright"===b)&&(m=new Pf),null!=m){m.i2(l);var n=qg.createMatrix(b),o={},p={};for(var q in l._a){var r=l._a[q],s=r.node,t=l.g4(r);if(o[q]=s.getCenterLocation(),null!=n){var u=n.transform(t);s.setCenterLocation(u.x,u.y)}else s.setCenterLocation(t.x,t.y);p[q]=s.getCenterLocation()}}}catch(v){}for(e=a.getChildren(),f=0,g=e.size();g>f;f++)c=e.get(f),c instanceof Ke&&c.setExpanded(!0)}}}}),qg.createMatrix=function(a){return"rightleft"===a?Tc.createMatrix(Math.PI/2,0,0):"leftright"===a?Tc.createMatrix(-Math.PI/2,0,0):"bottomtop"===a?Tc.createMatrix(Math.PI,0,0):null};var rg=function(){};Jc.ext(rg,Object,{i1:function(a,b,c){var d=this.a1(a,b);return this.a2(a,b,c),d},a1:function(a,b){var c=rg.i4(a);c.ax();for(var d=0,e=c.x1();e.i1();e.i2())b.i7(e.i9(),-1);for(var f=c.x1();f.i1();f.i2()){for(var g=f.i9(),h=-1,i=g.aq();i.i1();i.i2())h=Math.max(h,b.i2(i.i9()));b.i7(g,h+1),d=Math.max(d,h+1)}return d+1},a2:function(a,b,c){c.az(rg.i3(a,b))}}),rg.i3=function(a,b){for(var c=new pf,d=a.xf();d.i1();d.i2()){var e=d.i8();b.i2(e.a2())>b.i2(e.a3())&&(a.x3(e),c.ac(e))}return c},rg.i4=function(a){var b=Eg.a(a.xa());return(new ff).a1(a,b),rg.i2(a,b)},rg.i2=function(a,b){for(var c=Eg.d(a.x0()),d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();c[b[f]]=e}return new Hf(c)};var sg=function(){sg.superClass.constructor.call(this),this.c0()};Jc.ext(sg,pf,{c0:function(){this._bc=1,this._bd=0}});var tg=function(){this._m1=20,this._m2=60,this._m3=5,this._m4=0};Jc.ext(tg,Object,{i4:function(a){this._m3=a},i5:function(a){this._m4=a},i3:function(a){this._m1=a},i6:function(a){this._m2=a},i2:function(a){this._m5=a},t1:function(){return this._m2},a1:function(a,b){for(var c=Eg.d(b.length),d=0;d<b.length;d++)c[d]=b[d].x1();this.a2(a,c)},a2:function(a,b){for(var c=Eg.a(b.length),d=0,e=0;e<b.length;e++){var f=0,g=b[e];for(g.i4();g.i1();g.i2())f=Math.max(f,a.g9(g.i9()));for(c[e]=f,g.i4();g.i1();g.i2()){var h=(c[e]-a.g9(g.i9()))/2;a.s4(g.i9(),new Pe(a.gi(g.i9()),d+h))}var i=this.t1();d+=c[e]+i,g.i4()}},i1:function(a,b,c){this._m6=a,this.t2(b,c)}});var ug=function(){ug.superClass.constructor.call(this)};Jc.ext(ug,tg,{t2:function(a){var b=this._m6;this._a=b.xc("D"),this._h=b.xc("C"),this.a1(b,a),this.tg(b,a),this.tf(a,Lf.a5(this._e),this._m5,this._l),this.tb(b,this._f[0]),this.ta(a),this.th(b,this._f[0],a),this.b(a),this.tb(b,this._f[1]),this.ta(a),this.th(b,this._f[1],a),this.b(a),this.a11(this._f[1]),this.a12(a),this.tb(b,this._f[2]),this.ta(a),this.th(b,this._f[2],a),this.b(a),this.tb(b,this._f[3]),this.ta(a),this.th(b,this._f[3],a),this.b(a),this.a11(this._f[3]),this.a12(a),this.tc(b),this.tj()},a11:function(a){for(var b=0;b<a.length;b++)a[b]=-a[b]},b:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.ax()}for(var d=0;d<a.length;d++)for(var e=0,f=null,g=a[d].x1();g.i1();g.i2()){var h=g.i9(),i=h.al();this._l[i]=e++,this._b[i]=f,this._k[i]=null,null!=f&&(this._k[f.al()]=h),f=h}var j=this._a;this._a=this._h,this._h=j;for(var k=this._m6.xf();k.i1();k.i2()){var l=k.i8(),m=this._m6.gn(l);this._m6.gt(l,new Pe(-m.x,m.y));var n=this._m6.gk(l);this._m6.gz(l,new Pe(-n.x,n.y))}var o=this._l,p=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:o[a.a2().al()]-o[b.a2().al()]},q=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:o[a.a3().al()]};this._m6.x2(p,q)},a12:function(a){for(var b=this._m6.xf();b.i1();b.i2()){var c=b.i8();this._m6.x3(c);var d=this._m6.gn(c),e=this._m6.gk(c);this._m6.gz(c,d),this._m6.gt(c,e)}for(var f=new of,g=0;g<a.length;g++)f.ae(a[g]);for(var h=0;h<a.length;h++)a[h]=f.au();var i=this._l,j=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:i[a.a2().al()]-i[b.a2().al()]},k=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:i[a.a3().al()]};this._m6.x2(j,k)},tg:function(a,b){var c=a.x0(),d=a.xg();this._l=Eg.a(c),this._b=Eg.d(c),this._k=Eg.d(c),this._m=Eg.d(c),this._i=Eg.d(c),this._o=Eg.d(c),this._f=Eg.e(4,c),this._c=Eg.a(c),this._g=Eg.a(c),this._j=Eg.a(c),this._d=Eg.b(c),this._e=Eg.b(d);for(var e=0;e<b.length;e++)for(var f=0,g=null,h=b[e].x1();h.i1();h.i2()){var i=h.i9(),j=i.al();this._l[j]=f++,this._b[j]=g,this._k[j]=null,null!=g&&(this._k[g.al()]=i),g=i}var k=this._l,l=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:k[a.a2().al()]-k[b.a2().al()]},m=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:k[a.a3().al()]};a.x2(l,m)},tb:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=d.al();this._m[e]=d,this._i[e]=d,b[e]=Number.MAX_VALUE,this._o[e]=d,this._c[e]=Number.MAX_VALUE,this._d[e]=!1,this._j[e]=this._g[e]=0}},ta:function(a){for(var b=1;b<a.length;b++)for(var c=-1,d=a[b]._b;null!=d;d=d.a()){var e=d.d(),f=e.al(),g=e.ak();if(0!==g){var h,i=Math.floor((g+1)/2),j=Math.ceil((g+1)/2),k=1;for(h=e.ae();i>k;h=h.a7())k++;for(var l=!1;j>=k&&!l;k++){var m=this._m6.g2(h),n=h.a2(),o=n.al();this._i[f]===e&&!this._e[h.a5()]&&c<this._l[o]&&(c=this._l[o],this._i[o]=e,this._m[f]=this._m[o],this._i[f]=this._m[f],l=!0,this._j[o]=m.i6().x,this._g[f]=m.i7().x),h=h.a7()}}}},th:function(a,b,c){for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();this._m[f]===e&&this.td(a,e,b)}for(var g=0;g<c.length;g++){var h=c[g].x1();if(h.i1()){var i=c[g].x1().i9(),j=i.al();this._o[this._m[j].al()]===i&&this.tk(a,i,b)}}for(var k=a.x9();k.i1();k.i2()){var l=k.i9(),m=l.al(),n=this._c[this._o[this._m[m].al()].al()];n<Number.MAX_VALUE&&(b[m]+=n)}},td:function(a,b,c){var d=b.al();if(c[d]===Number.MAX_VALUE){c[d]=0;var e=b,f=0;do{var g=e.al();if(g!==d&&(f-=this._g[g]),this._l[g]>0){var h=this._b[g],i=this._m[this._b[g].al()],j=i.al();this.td(a,i,c),this._o[d]===b&&(this._o[d]=this._o[j]),this._o[d]===this._o[j]&&(c[d]=Math.max(c[d],c[h.al()]+this.ti(a,h,e)-f))}f+=this._j[g],e=this._i[g]}while(e!==b);f=0,e=b;do{var k=e.al();k!==d&&(f-=this._g[k]),c[k]=c[d]+f,f+=this._j[k],e=this._i[k]}while(e!==b)}},tk:function(a,b,c){var d=b.al();if(!this._d[d]){this._d[d]=!0;var e=b;do{var f=e.al(),g=this._k[f];if(null!=g){var h=g.al(),i=this._o[this._m[h].al()];if(i!==this._o[d]){var j=c[h]-c[d]-this.ti(a,e,g);this._c[i.al()]!==Number.MAX_VALUE&&(j+=this._c[i.al()]),this._c[this._o[d].al()]=Math.min(this._c[this._o[d].al()],j)}else this.tk(a,this._m[h],c)}e=this._i[f]}while(e!==b)}},tc:function(a){for(var b=Eg.a(4),c=Eg.a(4),d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();c[0]+=this._f[0][f],c[1]+=this._f[1][f],c[2]+=this._f[2][f],c[3]+=this._f[3][f]}c[0]/=a.xa(),c[1]/=a.xa(),c[2]/=a.xa(),c[3]/=a.xa();for(var g=a.x9();g.i1();g.i2()){var h=g.i9(),i=h.al(),j=a.g4(h);b[0]=this._f[0][i]-c[0],b[1]=this._f[1][i]-c[1],b[2]=this._f[2][i]-c[2],b[3]=this._f[3][i]-c[3],b.sort(Eg.n);var k=(b[1]+b[2])/2;a.s1(h,new Pe(k,j.y))}},ti:function(a,b,c){var d,e=a.gj(b),f=a.gj(c);return d=e>1&&f>1?this._m1+(e+f)/2:this._m3+(e+f)/2,this._l[b.al()]<this._l[c.al()]?(null!=this._a&&(d+=this._a.i3(c)),null!=this._h&&(d+=this._h.i3(b))):(null!=this._a&&(d+=this._a.i3(b)),null!=this._h&&(d+=this._h.i3(c))),d},tj:function(){this._l=null,this._b=null,this._k=null,this._e=null,this._m=null,this._i=null,this._f=null,this._c=null,this._o=null,this._d=null,this._j=null,this._g=null},tf:function(a,b,c,d){for(var e=a.length,f=2;e-1>f;f++)for(var g=-1,h=0,i=0,j=a[f].x1(),k=a[f].x1();k.i1();k.i2()){var l=k.i9(),m=null,n=!1;if(1===l.ak()&&(m=l.ae().a2(),null!=c.i1(m)&&null!=c.i1(l)&&(n=!0)),i===a[f].ay()-1||n){for(var o=n?d[m.al()]:a[f-1].ay();i>=h;h++){for(var p=j.i9(),q=p.am();q.i1();q.i2()){var r=q.i8(),s=d[r.a2().al()];(g>s||s>o)&&b.i7(q.i8(),!0)}j.i2()}g=o}i++}}});var vg=function(a,b){this._b=20,this._a=b,this._d=a,this._f={}};Jc.ext(vg,Object,{a3:function(a){this._b=a},a4:function(a,b,c,d,e){if(this.a2(a)){var f=this.b2(a);f._o=b,f._m=e,f._n=d,f._f=c}},b2:function(a){var b=this._f[a._id];return null==b&&(b=new wg,this._f[a._id]=b),b
},a2:function(a){return null!=this._f[a._id]},c:function(){for(var a=Lf.a1(Eg.a(this._d.xa())),b=Lf.a1(Eg.a(this._d.xa())),c=this._d.x9();c.i1();c.i2()){var d=c.i9();if(this.a2(d)){var e=this.b2(d);a.i6(d,this._b*(e.c()-1)),b.i6(d,this._b*(e.b()-1))}}this._d.x1("D",a),this._d.x1("C",b)},g:function(){this._d.x6("D"),this._d.x6("C")},f:function(){for(var a=this._d.x9();a.i1();a.i2()){var b=a.i9();if(this.a2(b)){var c=this._d.gi(b),d=this._d.gh(b),e=this._d.gj(b),f=this._d.g9(b),g=this.b2(b),h=g._q.ay()+g._b.ay()+g._f,i=g._d.ay()+g._g.ay()+g._o,j=g._i.ay()+g._l.ay()+g._n,k=g._h.ay()+g._k.ay()+g._m,l=this._a.a7(e,h),m=this._a.a7(e,i),n=this._a.a7(f,k),o=this._a.a7(f,j);g.a2(this._a.a8(e,h,l),this._a.a8(e,i,m),this._a.a8(f,k,n),this._a.a8(f,j,o));for(var p=g._j.c1();p.i1();p.i2()){var q=p.i8(),r=this.a1(q),s=this.b1(q),t=new of;r.b()===s.b()?(r.c()?(t.aa(new Pe(c+g._g._bd*m+g._c,d)),t.aa(new Pe(c+g._g._bd*m+g._c,d-this._b)),g._g._bd++,t.aa(new Pe(c+g._g._bd*m+g._c,d-this._b)),t.aa(new Pe(c+g._g._bd*m+g._c,d)),g._g._bd++,g._g._bc=Math.max(g._g._bc,2)):r.d()?(t.aa(new Pe(c+g._b._bd*l+g._p,d+f)),t.aa(new Pe(c+g._b._bd*l+g._p,d+f+this._b)),g._b._bd++,t.aa(new Pe(c+g._b._bd*l+g._p,d+f+this._b)),t.aa(new Pe(c+g._b._bd*l+g._p,d+f)),g._b._bd++,g._b._bc=Math.max(g._b._bc,2)):r.f()?(t.aa(new Pe(c,d+g._i._bd*o+g._a)),t.aa(new Pe(c-this._b,d+g._i._bd*o+g._a)),g._i._bd++,t.aa(new Pe(c-this._b,d+g._i._bd*o+g._a)),t.aa(new Pe(c,d+g._i._bd*o+g._a)),g._i._bd++,g._i._bc=Math.max(g._i._bc,2)):r.e()&&(t.aa(new Pe(c+e,d+g._h._bd*n+g._e)),t.aa(new Pe(c+e+this._b,d+g._h._bd*n+g._e)),g._h._bd++,t.aa(new Pe(c+e+this._b,d+g._h._bd*n+g._e)),t.aa(new Pe(c+e,d+g._h._bd*n+g._e)),g._h._bd++,g._h._bc=Math.max(g._h._bc,2)),this._d.m1(q,t)):r.c()||s.c()?r.e()||s.e()?(t.aa(new Pe(c+e-g._d._bd*m-g._c,d)),t.aa(new Pe(c+e-g._d._bd*m-g._c,d-this._b*g._d._bc)),t.aa(new Pe(c+e+this._b*g._h._bc,d-this._b*g._d._bc)),t.aa(new Pe(c+e+this._b*g._h._bc,d+g._h._bd*n+g._e)),t.aa(new Pe(c+e,d+g._h._bd*n+g._e)),g._d._bd++,g._d._bc++,g._h._bd++,g._h._bc++,s.c()&&t.ax(),this._d.m1(q,t)):r.f()||s.f()?(t.aa(new Pe(c+g._g._bd*m+g._c,d)),t.aa(new Pe(c+g._g._bd*m+g._c,d-this._b*g._g._bc)),t.aa(new Pe(c-this._b*g._i._bc,d-this._b*g._g._bc)),t.aa(new Pe(c-this._b*g._i._bc,d+g._i._bd*o+g._a)),t.aa(new Pe(c,d+g._i._bd*o+g._a)),g._g._bd++,g._g._bc++,g._i._bd++,g._i._bc++,s.c()&&t.ax(),this._d.m1(q,t)):(r.d()||s.d())&&(t.aa(new Pe(c+e-g._d._bd*m-g._c,d)),t.aa(new Pe(c+e-g._d._bd*m-g._c,d-this._b*g._d._bc)),t.aa(new Pe(c+e+this._b*g.b(),d-this._b*g._d._bc)),t.aa(new Pe(c+e+this._b*g.b(),d+f+this._b*g._q._bc)),t.aa(new Pe(c+e-g._q._bd*l-g._p,d+f+this._b*g._q._bc)),t.aa(new Pe(c+e-g._q._bd*l-g._p,d+f)),g._d._bd++,g._d._bc++,g._k._bc++,g._h._bc++,g._q._bc++,g._q._bd++,s.c()&&t.ax(),this._d.m1(q,t)):r.d()||s.d()?r.e()||s.e()?(t.aa(new Pe(c+e-g._q._bd*l-g._p,d+f)),t.aa(new Pe(c+e-g._q._bd*l-g._p,d+f+this._b*g._q._bc)),t.aa(new Pe(c+e+this._b*g._k._bc,d+f+this._b*g._q._bc)),t.aa(new Pe(c+e+this._b*g._k._bc,d+f-g._k._bd*n-g._e)),t.aa(new Pe(c+e,d+f-g._k._bd*n-g._e)),g._q._bd++,g._q._bc++,g._k._bd++,g._k._bc++,s.d()&&t.ax(),this._d.m1(q,t)):(r.f()||s.f())&&(t.aa(new Pe(c+g._b._bd*l+g._p,d+f)),t.aa(new Pe(c+g._b._bd*l+g._p,d+f+this._b*g._b._bc)),t.aa(new Pe(c-this._b*g._l._bc,d+f+this._b*g._b._bc)),t.aa(new Pe(c-this._b*g._l._bc,d+f-g._l._bd*o-g._a)),t.aa(new Pe(c,d+f-g._l._bd*o-g._a)),g._b._bd++,g._b._bc++,g._l._bd++,g._l._bc++,s.d()&&t.ax(),this._d.m1(q,t)):(t.aa(new Pe(c,d+f-g._l._bd*o-g._a)),t.aa(new Pe(c-this._b*g._l._bc,d+f-g._l._bd*o-g._a)),t.aa(new Pe(c-this._b*g._l._bc,d+f+this._b*g.a1())),t.aa(new Pe(c+e+this._b*g._k._bc,d+f+this._b*g.a1())),t.aa(new Pe(c+e+this._b*g._k._bc,d+f-g._k._bd*n-g._e)),t.aa(new Pe(c+e,d+f-g._k._bd*n-g._e)),g._l._bd++,g._l._bc++,g._b._bc++,g._q._bc++,g._k._bc++,g._k._bd++,s.f()&&t.ax(),this._d.m1(q,t))}}}},a5:function(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=b[c],f=d.x1();f.i1();f.i2()){var g=f.i9();if(this.a2(g)){var h=this.b2(g);e._g=Math.max(e._g,this._b*(h.d()-1)),e._j=Math.max(e._j,this._b*(h.a1()-1))}}},a1:function(a){var b=this._d.xc("A"),c=null;if(null!=b&&(c=b.i1(a)),null==c||c.g()){var d=this._d.xc("B");if(null==d)return mg.j(1);var e=d.i1(a);if(null==e||e.g())return mg.j(1);if(e.c())return mg.j(8);if(e.f())return mg.j(1);if(e.d())return mg.j(4);if(e.e())return mg.j(2)}return c},b1:function(a){var b=this._d.xc("B"),c=null;if(null!=b&&(c=b.i1(a)),null==c||c.g()){var d=this._d.xc("A");if(null==d)return mg.j(8);var e=d.i1(a);if(null==e||e.g())return mg.j(8);if(e.c())return mg.j(8);if(e.f())return mg.j(1);if(e.d())return mg.j(4);if(e.e())return mg.j(2)}return c}});var wg=function(){this._o=0,this._f=0,this._n=0,this._m=0,this._c=0,this._p=0,this._e=0,this._a=0,this._j=new pf,this._g=new sg,this._d=new sg,this._b=new sg,this._q=new sg,this._h=new sg,this._k=new sg,this._i=new sg,this._l=new sg};Jc.ext(wg,Object,{a1:function(){return Math.max(this._q._bc,this._b._bc)},d:function(){return Math.max(this._d._bc,this._g._bc)},b:function(){return Math.max(this._k._bc,this._h._bc)},c:function(){return Math.max(this._l._bc,this._i._bc)},a2:function(a,b,c,d){this._c=b,this._a=d,this._p=a,this._e=c,this._g.c0(),this._d.c0(),this._b.c0(),this._q.c0(),this._k.c0(),this._h.c0(),this._l.c0(),this._i.c0()}});var xg=function(a,b,c,d){this._k=20,this._r=.5,this._d=a,this._c=b,this._j=c,this._m=d,this._i=null!=a.xc("A")||null!=a.xc("B"),this._t=new Ag(a,b,c,d),this._b=new vg(a,this)};Jc.ext(xg,Object,{a6:function(a){this._k=a,this._t.a1(a),this._b.a3(a)},g1:function(){return this._k},a9:function(a){return this.c1(),a},a5:function(a){return this.a1(),a},b3:function(a){return this.c1(),a=this.c4(a),this._b.c(),a},g2:function(a){return this._b.g(),a},e2:function(a){a=this.f(a),this._b.f()},e1:function(){this._t.d(),null!=this._n&&this._d.xi(this._n),this.a1(),this._d=null},a1:function(){this._i&&(null!=this._q&&(this._d.x1("A",this._q),this._q=null),null!=this._p&&(this._d.x1("B",this._p),this._p=null),null!=this._h&&(this._d.xj(this._h),this._h=null),null!=this._l&&(this._d.xj(this._l),this._l=null))},c1:function(){if(this._i){null==this._h&&(this._h=this._d.xl()),null==this._l&&(this._l=this._d.xl());for(var a=this._d.xf();a.i1();a.i2()){var b=a.i8(),c=null!=this._j.i1(b.a2()),d=null!=this._j.i1(b.a3());if(c&&!d){var e=this._j.i1(b.a2());this._m.i4(e)?this._l.i8(b,mg.h(this._d,e)):this._l.i8(b,mg.i(this._d,e))}else if(!c&&d){var f=this._j.i1(b.a3());this._m.i4(f)?this._h.i8(b,mg.i(this._d,f)):this._h.i8(b,mg.h(this._d,f))}else c||d||(this._m.i4(b)?(this._h.i8(b,mg.i(this._d,b)),this._l.i8(b,mg.h(this._d,b))):(this._h.i8(b,mg.h(this._d,b)),this._l.i8(b,mg.i(this._d,b))))}this._q=this._d.xc("A"),this._p=this._d.xc("B"),this._d.x1("A",this._h),this._d.x1("B",this._l)}},c4:function(a){this._n=this._d.xk(),this._a=this._d.xl(),this._g=this._d.xl();for(var b=new pf,c=new pf,d=new pf,e=new pf,f=new pf,g=new pf,h=new pf,i=new pf,j=new pf,k=this._d.xk(),l=0;l<a.length;l++)for(var m=0,n=a[l].x1();n.i1();)k.i6(n.i9(),m),n.i2(),m++;for(var o=function(a,b){var c=k.i3(a.a3())-k.i3(b.a3());return 0>=c?c>=0?0:-1:1},p=function(a,b){var c=k.i3(a.a2())-k.i3(b.a2());return 0>=c?c>=0?0:-1:1},q=0;q<a.length;q++)for(var r=a[q],s=r._b;null!=s;s=s.a()){var t=s.d();t.av(o),t.au(p);var u=0;b.af(),c.af(),d.af(),e.af(),f.af(),g.af(),h.af(),i.af(),j.af();for(var v=t.ap();v.i1();){var w=v.i8(),x=this.b1(w);null==x||x.d()||x.g()?d.aa(w):x.e()?b.aa(w):x.f()?(c.aa(w),j.aa(w)):x.c()&&(i.aa(w),j.aa(w)),v.i2(),u++}u=0;for(var y=t.am();y.i1();){var z=y.i8(),A=this.a2(z);null==A||A.c()||A.g()?e.aa(z):A.e()?b.aa(z):A.f()?(c.aa(z),j.aa(z)):A.d()&&(g.aa(z),j.aa(z)),y.i2(),u++}var B=k.i3(t);if(!j.ar())for(var C=.1/j.ay(),D=B-.4;!j.ar();D+=C){var E=j.c3();if(E.a2()===t){var F=this._d.xm();this._n.z1(F,E.a2()),this._d.s7(F,1,1),this._c.z1(F,this._c.i1(t)),k.i6(F,D),this._a.i8(E,this._d.gn(E)),this._d.gt(E,dg._A),this._d.xr(E,F,E.a3()),r.ao(F,s)}else{var G=this._d.xm();this._n.z1(G,E.a3()),this._d.s7(G,1,1),this._c.z1(G,this._c.i1(t)),k.i6(G,D),this._g.i8(E,this._d.gk(E)),this._d.gz(E,dg._A),this._d.xr(E,E.a2(),G),r.ao(G,s)}}if(!b.ar())for(var H=.1/b.ay(),I=B+.1;!b.ar();I+=H){var J=b.c3();if(J.a2()===t){var K=this._d.xm();this._n.z1(K,J.a2()),this._d.s7(K,1,1),this._c.z1(K,this._c.i1(t)),k.i6(K,I),this._a.i8(J,this._d.gn(J)),this._d.gt(J,dg._A),this._d.xr(J,K,J.a3()),s=r.an(K,s)}else{var L=this._d.xm();this._n.z1(L,J.a3()),this._d.s7(L,1,1),this._c.z1(L,this._c.i1(t)),k.i6(L,I),this._g.i8(J,this._d.gk(J)),this._d.gz(J,dg._A),this._d.xr(J,J.a2(),L),s=r.an(L,s)}}var M=xg._z;this._b.a2(t)&&(M=this._b.b2(t));var N=M._b.ay()+g.ay()+t.ao()+f.ay()+M._q.ay();if(N>0)for(var O=this._d.g9(t)/2,P=this._d.gj(t),Q=this.a7(P,N),R=-.5*P+this.a8(this._d.gj(t),N,Q)+Q*(M._b.ay()+g.ay()),S=t.ap();S.i1();S.i2()){var T=S.i8();this.c2(T)||null!=this._j.i1(T.a2())||(this._d.g2(T).i8(new Pe(R,O)),R+=Q)}var U=this._t.a3(t),V=0,W=0,X=0,Y=0;if(null!=U&&(V=U._e.ay(),W=U._c.ay(),X=U._b.ay(),Y=U._d.ay()),N=M._g.ay()+V+i.ay()+t.ak()+h.ay()+W+M._d.ay(),N>0){for(var Z=this._d.gj(t),$=this.a7(Z,N),_=this.a8(Z,N,$),ab=-.5*Z+_+$*(M._g.ay()+V+i.ay()),bb=-this._d.g9(t)/2,cb=t.am();cb.i1();cb.i2()){var db=cb.i8();this.d1(db)||null!=this._j.i1(db.a3())||(this._d.g2(db).i9(new Pe(ab,bb)),ab+=$)}if(null!=U){for(var eb=-.5*Z+_+$*(M._g.ay()+i.ay()+U._e.ay()-1),fb=U._e.c1();fb.i1();fb.i2()){var gb=fb.i8();this._d.u1(gb),gb.a2()!==t||this.c2(gb)?this.d1(gb)||(this._d.g2(fb.i8()).i9(new Pe(eb,bb)),eb-=$):(this._d.g2(fb.i8()).i8(new Pe(eb,bb)),eb-=$),this._d.h1(gb)}eb=.5*Z-_-$*(M._d.ay()+h.ay());for(var hb=U._c.c1();hb.i1();hb.i2()){var ib=hb.i8();this._d.u1(ib),ib.a2()!==t||this.c2(ib)?this.d1(ib)||(this._d.g2(hb.i8()).i9(new Pe(eb,bb)),eb-=$):(this._d.g2(hb.i8()).i8(new Pe(eb,bb)),eb-=$),this._d.h1(ib)}}}this._b.a2(t)&&this._b.a4(t,V+i.ay()+t.ak()+h.ay()+W,g.ay()+t.ao()+f.ay(),X+c.ay(),Y+b.ay())}return this._d.xi(k),a},a7:function(a,b){return 1>=b?0:a/(b-1+2*this._r)},a8:function(a,b,c){return 1>=b?.5*a:.5*(a-c*(b-1))},f:function(a){var b=this.g1();this._f=this._d.xk();for(var c=0;c<a.length;c++)for(var d=a[c],e=d._b;null!=e;){var f=e.d(),g=this._n.i1(f);if(null!=g||this._t.b2(f))e=e.a();else{var h=new Hf,i=new Hf,j=new Hf,k=new Hf,l=new Hf,m=new Hf,n=new pf,o=new pf,p=new Dg(h,i,j,k,l,m,n,o);this._f.z1(f,p),n.ab(f.am()),o.ab(f.ap());for(var q=e.b();null!=q&&this._n.i1(q.d())===f;q=q.b()){var r=q.d(),s=this.c3(r);s.f()?i.ac(r):s.c()?k.ac(r):s.d()&&m.ac(r)}var t;for(t=e.a();null!=t&&this._n.i1(t.d())===f;t=t.a()){var u=t.d(),v=this.c3(u);v.e()?h.aa(u):v.c()?j.aa(u):v.d()&&l.aa(u)}e=t}}for(var w=this.d2(a),x=0,y=0;y<a.length;y++){var z=w[y];y>0&&(x+=w[y-1]._j+w[y-1]._h+w[y-1]._b),x+=z._g+z._f+z._a+z._d;for(var A=a[y].x1();A.i1();A.i2()){var B=A.i9();this._d.s3(B,this._d.gi(B),this._d.gh(B)+x)}z._c+=x,z._i+=x}for(var C=0;C<a.length;C++)for(var D=a[C],E=D.x1();E.i1();E.i2()){var F=E.i9();null!=this._n.i1(F)&&D.av(E)}for(var G=this,H=function(a,b){return G.a3(a)?G.a3(b)&&G._d.gi(a)>=G._d.gi(b)?-1:1:G.a3(b)?-1:G._d.gi(a)>=G._d.gi(b)?1:-1},I=function(a,b){return G.a3(a)?G.a3(b)?G._d.gi(a)>=G._d.gi(b)?1:-1:1:G.a3(b)?-1:G._d.gi(a)>=G._d.gi(b)?-1:1},J=0;J<a.length;J++)for(var K=w[J],L=a[J].x1();L.i1();L.i2()){var M=L.i9();if(!this._t.b2(M)){var N=this._f.i1(M),O=N._d,P=N._a,Q=N._b,R=N._h,S=N._f,T=N._c,U=N._g,V=N._e,W=0,X=0,Y=0,Z=0,$=M.ao(),_=M.ak(),ab=this._d.gi(M),bb=this._d.gh(M),cb=this._d.gj(M),db=this._d.g9(M),eb=this._t.a3(M),fb=xg._z;if(this._b.a2(M)&&(fb=this._b.b2(M)),null!=eb){if(W=eb._d.ay(),X=eb._b.ay(),Y=eb._e.ay(),Z=eb._c.ay(),W>0)for(var gb=fb._h.ay()+O.ay()+W+fb._k.ay(),hb=this.a7(db,gb),ib=this.a8(db,gb,hb),jb=bb+ib+hb*(fb._h.ay()+this.a4(O)),kb=eb._d.c1();kb.i1();kb.i2()){var lb=kb.i8();this._d.u1(lb),lb.a2()===M?this.c2(lb)||this._d.gx(lb,new Pe(ab+cb,jb)):(this.d1(lb),this._d.gy(lb,new Pe(ab+cb,jb))),jb+=hb,this._d.h1(lb)}if(X>0)for(var mb=fb._i.ay()+P.ay()+X+fb._l.ay(),nb=this.a7(db,mb),ob=this.a8(db,mb,nb),pb=bb+ob+nb*(fb._i.ay()+this.a4(P)),qb=eb._b.c1();qb.i1();qb.i2()){var rb=qb.i8();this._d.u1(rb),rb.a2()===M?this.c2(rb)||this._d.gx(rb,new Pe(ab,pb)):this.d1(rb)||this._d.gy(rb,new Pe(ab,pb)),pb+=nb,this._d.h1(rb)}}if(O.ay()>0){O.a1(H);for(var sb=fb._h.ay()+O.ay()+W+fb._k.ay(),tb=this.a7(db,sb),ub=this.a8(db,sb,tb),vb=bb+ub+tb*fb._h.ay(),wb=!0;!O.ar();){var xb=O.x4();if(this.a3(xb)){wb&&(wb=!1,vb+=tb*W);var yb=xb.ag(),zb=this._d.gd(yb),Ab=zb.at();if(zb.ac(new Pe(Ab.x,K.b())),this.c2(yb)){var Bb=this._a.i1(yb);zb.ac(new Pe(Ab.x,Bb.y+this._d.g6(M))),zb.ac(new Pe(Bb.x+this._d.g5(M),Bb.y+this._d.g6(M)))}else zb.ac(new Pe(Ab.x,vb)),zb.ac(new Pe(ab+cb,vb));this._d.xr(yb,M,yb.a3()),this._d.m1(yb,zb)}else{var Cb=xb.ae(),Db=this._d.gd(Cb),Eb=Db.au();if(Db.ae(new Pe(Eb.x,K.a())),this.d1(Cb)){var Fb=this._g.i1(Cb);Db.ae(new Pe(Eb.x,Fb.y+this._d.g6(M))),Db.ae(new Pe(Fb.x+this._d.g5(M),Fb.y+this._d.g6(M)))}else Db.ae(new Pe(Eb.x,vb)),Db.ae(new Pe(ab+cb,vb));this._d.xr(Cb,Cb.a2(),M),this._d.m1(Cb,Db)}this._d.x4(xb),vb+=tb}}if(P.ay()>0){P.a1(I);for(var Gb=fb._i.ay()+P.ay()+X+fb._l.ay(),Hb=this.a7(db,Gb),Ib=this.a8(db,Gb,Hb),Jb=bb+Ib+Hb*fb._i.ay(),Kb=!0;!P.ar();){var Lb=P.x4();if(this.a3(Lb)){Kb&&(Kb=!1,Jb+=Hb*X);var Mb=Lb.ag(),Nb=this._d.gd(Mb),Ob=Nb.at();if(Nb.ac(new Pe(Ob.x,K.b())),this.c2(Mb)){var Pb=this._a.i1(Mb);Nb.ac(new Pe(Ob.x,Pb.y+this._d.g6(M))),Nb.ac(new Pe(Pb.x+this._d.g5(M),Pb.y+this._d.g6(M)))}else Nb.ac(new Pe(Ob.x,Jb)),Nb.ac(new Pe(ab,Jb));this._d.xr(Mb,M,Mb.a3()),this._d.m1(Mb,Nb)}else{var Qb=Lb.ae(),Rb=this._d.gd(Qb),Sb=Rb.au();if(Rb.ae(new Pe(Sb.x,K.a())),this.d1(Qb)){var Tb=this._g.i1(Qb);Rb.ae(new Pe(Sb.x,Tb.y+this._d.g6(M))),Rb.ae(new Pe(Tb.x+this._d.g5(M),Tb.y+this._d.g6(M)))}else Rb.ae(new Pe(Sb.x,Jb)),Rb.ae(new Pe(ab,Jb));this._d.xr(Qb,Qb.a2(),M),this._d.m1(Qb,Rb)}this._d.x4(Lb),Jb+=Hb}}var Ub=fb._g.ay()+fb._d.ay()+_+R.ay()+Q.ay()+Y+Z;cb=this._d.gj(M);var Vb=this.a7(cb,Ub),Wb=this.a8(cb,Ub,Vb);Ub=fb._b.ay()+fb._q.ay()+$+T.ay()+S.ay();var Xb=this.a7(cb,Ub),Yb=this.a8(cb,Ub,Xb);if(R.ay()>0)for(var Zb,$b=Vb,_b=b,ac=this._d.gi(M)+Wb+$b*(fb._g.ay()+R.ay()-1),bc=this._d.gh(M),cc=K._c-K._g-R.ay()*_b;!R.ar();this._d.x4(Zb)){Zb=R.x4();var dc=Zb.ag(),ec=this._d.gd(dc),fc=ec.at();if(ec.ac(new Pe(fc.x,K.b())),ec.ac(new Pe(fc.x,cc)),this.c2(dc)){var gc=this._a.i1(dc);ec.ac(new Pe(gc.x+this._d.g5(M),cc)),ec.ac(new Pe(gc.x+this._d.g5(M),gc.y+this._d.g6(M)))}else ec.ac(new Pe(ac,cc)),ec.ac(new Pe(ac,bc)),ac-=$b;cc+=_b,this._d.xr(dc,M,dc.a3()),this._d.m1(dc,ec)}if(Q.ay()>0)for(var hc,ic=Vb,jc=b,kc=this._d.gi(M)+this._d.gj(M)-Wb-ic*fb._d.ay(),lc=this._d.gh(M),mc=K._c-K._g-jc;!Q.ar();this._d.x4(hc)){hc=Q.x4();var nc=hc.ag(),oc=this._d.gd(nc),pc=oc.at();if(oc.ac(new Pe(pc.x,K.b())),oc.ac(new Pe(pc.x,mc)),this.c2(nc)){var qc=this._a.i1(nc);oc.ac(new Pe(qc.x+this._d.g5(M),mc)),oc.ac(new Pe(qc.x+this._d.g5(M),qc.y+this._d.g6(M)))}else oc.ac(new Pe(kc,mc)),oc.ac(new Pe(kc,lc)),kc-=ic;mc-=jc,this._d.xr(nc,M,nc.a3()),this._d.m1(nc,oc)}if(T.ay()>0)for(var rc,sc=Xb,tc=b,uc=this._d.gi(M)+Yb+sc*(fb._b.ay()+T.ay()-1),vc=this._d.gh(M)+this._d.g9(M),wc=vc+T.ay()*tc;!T.ar();this._d.x4(rc)){rc=T.x4();var xc=rc.ae(),yc=this._d.gd(xc),zc=yc.au();if(yc.ae(new Pe(zc.x,K.a())),yc.ae(new Pe(zc.x,wc)),this.d1(xc)){var Ac=this._g.i1(xc);yc.ae(new Pe(Ac.x+this._d.g5(M),wc)),yc.ae(new Pe(Ac.x+this._d.g5(M),Ac.y+this._d.g6(M)))}else yc.ae(new Pe(uc,wc)),yc.ae(new Pe(uc,vc)),uc-=sc;wc-=tc,this._d.xr(xc,xc.a2(),M),this._d.m1(xc,yc)}if(S.ay()>0)for(var Bc,Cc=Xb,Dc=b,Ec=this._d.gi(M)+this._d.gj(M)-Yb-Xb*fb._q.ay(),Fc=this._d.gh(M)+this._d.g9(M),Gc=Fc+Dc;!S.ar();this._d.x4(Bc)){Bc=S.x4();var Hc=Bc.ae(),Ic=this._d.gd(Hc),Jc=Ic.au();if(Ic.ae(new Pe(Jc.x,K.a())),Ic.ae(new Pe(Jc.x,Gc)),this.d1(Hc)){var Kc=this._g.i1(Hc);Ic.ae(new Pe(Kc.x+this._d.g5(M),Gc)),Ic.ae(new Pe(Kc.x+this._d.g5(M),Kc.y+this._d.g6(M)))}else Ic.ae(new Pe(Ec,Gc)),Ic.ae(new Pe(Ec,Fc)),Ec-=Cc;Gc+=Dc,this._d.xr(Hc,Hc.a2(),M),this._d.m1(Hc,Ic)}for(;!V.ar();){var Lc=V.c3(),Mc=this._d.gl(Lc);K.a()+12<Mc.y&&this._d.g7(Lc).i4(Mc.x,K.a())}for(;!U.ar();){var Nc=U.c3(),Oc=this._d.gs(Nc);if(K.b()-12>Oc.y){var Pc=this._d.gf(Nc);Pc.ac(new Pe(Oc.x,K.b())),this._d.s6(Nc,Pc)}}}}for(var Qc=0;Qc<a.length;Qc++)for(var Rc=a[Qc],Sc=Rc._b;null!=Sc;Sc=Sc.a()){var Tc=Sc.d(),Uc=this._t.a3(Tc);null!=Uc&&null!=Uc._a&&(this._d.x4(Uc._a),Rc.aw(Sc.b()))}return this._d.xi(this._f),this._d.xj(this._a),this._d.xj(this._g),a},c3:function(a){return this.a3(a)?this.b1(a.ag()):this.a2(a.ae())},b1:function(a){return null==this._h?xg.s:this._h.i1(a)},a2:function(a){return null==this._l?xg.u:this._l.i1(a)},c2:function(a){if(null==a)return!1;var b=this.b1(a);return null!=b&&b.a()},d1:function(a){if(null==a)return!1;var b=this.a2(a);return null!=b&&b.a()},a3:function(a){return 1===a.ao()},b2:function(a){return 1===a.ak()},a4:function(a){for(var b=0,c=a._b;null!=c;c=c.a())this.b2(c.d())&&b++;return b},d2:function(a){for(var b=this._k,c=Eg.d(a.length+1),d=0;d<a.length;d++){var e=a[d],f=new Bg;c[d]=f,f._c=Number.MAX_VALUE,f._i=Number.MIN_VALUE;for(var g=e.x1();g.i1();g.i2()){var h=g.i9(),i=this._d.gb(h);f._c=Math.min(f._c,i.i2()),f._i=Math.max(f._i,i.i2()+i.i4())}}this._b.a5(a,c);for(var j=0;j<a.length;j++)for(var k=c[j],l=a[j].x1();l.i1();l.i2()){var m=l.i9(),n=this._f.i1(m);null!=n&&(k._h=Math.max(k._h,Math.max(n._f.ay()*b,n._c.ay()*b)),k._f=Math.max(k._f,Math.max(n._b.ay()*b,n._h.ay()*b)))}return c}}),xg.s=mg.j(2),xg.u=mg.j(1),xg._z=new wg;var yg=function(){this._af=0,this._b=0};Jc.ext(yg,Object,{ib:function(a){this._af=a},ia:function(a,b,c){this.a6(a,b,c),this.b2(!1);var d=this.g();if(this.o()&&d>0){for(var e=this.r(),f=0;20>f&&d>0&&this.o();f++){this.b2(!0);var g=this.g();d>g&&(this.a7(e),d=g)}this.b3(e),this.b1()}return this.c()},a6:function(a,b,c){this._b=(new Date).getTime(),this._ac=a,this._ah=b;var d=this;this._p=function(a,b){var c=d._n[a.al()]-d._n[b.al()];return c>0?1:c>=0?0:-1},this._ad=Eg.d(c);for(var e=0;e<this._ad.length;e++)this._ad[e]=new Hf;this._ab=Eg.a(this._ac.x0()),this._f=Eg.d(this._ac.x0()),this._n=Eg.a(this._ac.x0()+1);var f=this._ab;this._o=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,g=c.a2(),h=d.a2(),i=f[g.al()]-f[h.al()];if(0===i){var j=yg.b(mg.h(e,c),e.gn(c)),k=yg.b(mg.h(e,d),e.gn(d)),l=j-k;if(0===l){var m=f[c.a3().al()]-f[d.a3().al()];if(0===m){var n=yg.a(mg.i(e,c),e.gk(c)),o=yg.a(mg.i(e,d),e.gk(d));return n-o}return m}return l}return i},this._l=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,g=c.a3(),h=d.a3(),i=f[g.al()]-f[h.al()];if(0===i){var j=yg.a(mg.i(e,c),e.gk(c)),k=yg.a(mg.i(e,d),e.gk(d)),l=j-k;if(0===l){var m=f[c.a2().al()]-f[d.a2().al()];if(0===m){var n=yg.b(mg.h(e,c),e.gn(c)),o=yg.b(mg.h(e,d),e.gn(d));return n-o}return m}return l}return i},this._z=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,f=yg.b(mg.h(e,c),e.gn(c)),g=yg.b(mg.h(e,d),e.gn(d));return f-g},this._e=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,f=yg.a(mg.i(e,c),e.gk(c)),g=yg.a(mg.i(e,d),e.gk(d));return f-g},this._ac.x2(this._e,this._z)},c:function(){this._ah=null,this._aa=null,this._f=null,this._n=null,this._p=null,this._o=null,this._l=null,this._ac=null;var a=this._ad;return this._ad=null,a},o:function(){var a=(new Date).getTime()-this._b;return a<=this._af},m:function(){for(var a=this,b=function(b,c){return Math.ceil(a._n[b.a3().al()])-Math.ceil(a._n[c.a3().al()])},c=this._ac.x9();c.i1();c.i2()){for(var d=c.i9().aw();d.i1();d.i2())this._n[d.i9().al()]=dg.j();c.i9().av(b)}},b2:function(a){for(var b=0;b<this._ad.length;b++)this._ad[b].af();if(a){this.m();for(var c=0,d=this._ab.length;d>c;c++)this._ab[c]=0;this._ac.x2(null,this._z)}var e=this._ac.xm();this._ah.i7(e,0);for(var f=this._ac.x9();f.i1();f.i2())0===f.i9().ak()&&f.i9()!==e&&this._ac.xo(e,f.i9());var g=new bf(this);g.a6(!0),g.a9(this._ac,e),this._ad[0].at(),this._ac.x4(e),this.d()},a1:function(){this._ac.x2(this._o,this._l);for(var a=0,b=1;b<this._ad.length;b++){var c=this.a2(this._ad[b-1],this._ad[b]);a+=c}var d=0;return a+=d},a2:function(a,b){var c=a.ah(),d=b.ah(),e=new of,f=new of;this._aa=Eg.d(this._ac.x0());for(var g=0;c.i1()&&d.i1();d.i2())g+=this.a8(c.i6(),e,f,!0),g+=this.a8(d.i6(),f,e,!1),c.i2();for(;c.i1();c.i2())g+=this.a8(c.i6(),e,f,!0);for(;d.i1();d.i2())g+=this.a8(d.i6(),f,e,!1);return g},a8:function(a,b,c,d){var e=0,f=0,g=0;if(null!=this._aa[a.al()])for(var h=this._aa[a.al()].a(),i=b._b;i!==h;i=i.a()){var j=i._c;j===a?(e++,g+=f,b.aw(i)):f++}var k=e*c.ay()+g;if(d)for(var l=a.ag();null!=l;l=l.a8()){var m=l.a3();this._ab[m.al()]>=this._ab[a.al()]&&(this._aa[m.al()]=c.ae(m))}else for(var n=a.ae();null!=n;n=n.a7()){var o=n.a2();this._ab[o.al()]>this._ab[a.al()]&&(this._aa[o.al()]=c.ae(o))}return k},g:function(){for(var a=this.r(),b=this.a1(),c=!0,d=0;3>d&&this.o()&&b>0;){var e=this.k();b>e?(this.a7(a),b=e):d++,c=!c}if(this.b3(a),this.b1(),b>0){for(var f=1,g=0;1===f&&b>0;g++){this.e(),this.i();var h=this.a1();b>h?(f=1,this.a7(a)):f=-1,b=h}this.b3(a),this.b1()}return b},e:function(){for(var a=this.l(),b=this.r(),c=Eg.d(this._ac.x0()),d=this._ad.length-1;d>=0;d--)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(1===f.ak()&&1===f.ao()){var g=a.i1(f.ag());if(null!=g&&null==c[g.al()])for(var h=this.a4(f,g),i=g.al(),j=c[i]=Eg.d(h+1),k=j.length-1;k>=0;k--)j[k]=new of}}for(var l=0;l<this._ad.length;l++)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(1===n.ak()&&1===n.ao()){var o=a.i1(n.ag());if(null!=o){var p=o.al(),q=this.a4(n,o)-1;c[p][q].ae(n.ae())}}else for(var r=n.ae();null!=r;r=r.a7()){var s=a.i1(r);if(null!=s){var t=s.al(),u=this.a4(n,s)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(null!=c[w.al()])for(var x=w.ag();null!=x;x=x.a8()){var y=a.i1(x);if(null!=y)for(var z=c[y.al()];z[0].ay()>0;){for(var A,B=0;;){A=z[B].am();var C=A.a3();if(1!==C.ak()||1!==C.ao())break;B++}var D=z[B].at().a3();B--,D=A.a2(),A=z[B].at();for(var E=A.a3();B>=0;)if(b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ae().a2(),--B>=0){var F=z[B].at();E=F.a3()}}}}this.b1(),this._ac.xj(a)},i:function(){for(var a=this.f(),b=this.r(),c=Eg.d(this._ac.x0()),d=0;d<this._ad.length;d++)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(1===f.ak()&&1===f.ao()){var g=a.i1(f.ae());if(null!=g&&null==c[g.al()])for(var h=this.a4(g,f),i=g.al(),j=c[i]=Eg.d(h+1),k=j.length-1;k>=0;k--)j[k]=new of}}for(var l=this._ad.length-1;l>=0;l--)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(1===n.ak()&&1===n.ao()){var o=a.i1(n.ae());if(null!=o){var p=o.al(),q=this.a4(o,n)-1;c[p][q].ae(n.ag())}}else for(var r=n.ag();null!=r;r=r.a8()){var s=a.i1(r);if(null!=s){var t=s.al(),u=this.a4(s,n)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(null!=c[w.al()])for(var x=w.ae();null!=x;x=x.a7()){var y=a.i1(x);if(null!=y)for(var z=c[y.al()];z[0].ay()>0;){for(var A,B=0;;){A=z[B].am();var C=A.a2();if(1!==C.ak()||1!==C.ao())break;B++}var D=z[B].at().a2();B--,D=A.a3(),A=z[B].at();for(var E=A.a2();B>=0;)if(b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ag().a3(),--B>=0){var F=z[B].at();E=F.a2()}}}}this.b1(),this._ac.xj(a)},a4:function(a,b){return this._ah.i2(a)-this._ah.i2(b)},l:function(){for(var a=Lf.a6(Eg.d(this._ac.xg())),b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ao()>1){for(var d=0,e=c.ag();null!=e;e=e.a8()){var f=e.a3();1===f.ak()&&1===f.ao()&&d++}if(d>1)for(var g=c.ag();null!=g;g=g.a8()){var h=g,i=h.a3();if(1===i.ak()&&1===i.ao()){for(;1===i.ak()&&1===i.ao();i=h.a3())a.i8(h,c),h=i.ag();a.i8(h,c)}}}}return a},f:function(){for(var a=Lf.a6(Eg.d(this._ac.xg())),b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ak()>1){for(var d=0,e=c.ae();null!=e;e=e.a7()){var f=e.a2();1===f.ak()&&1===f.ao()&&d++}if(d>1)for(var g=c.ae();null!=g;g=g.a7()){var h=g,i=h.a2();if(1===i.ak()&&1===i.ao()){for(;1===i.ak()&&1===i.ao();i=h.a2())a.i8(h,c),h=i.ae();a.i8(h,c)}}}}return a},k:function(){for(var a=1;a<this._ad.length;a++){for(var b=this._ad[a],c=b.ah();c.i1();c.i2()){var d=c.i6();this._n[d.al()]=this.a5(d,b.ay(),d.am(),this._ad[a-1].ay()),this._n[d.al()]+=this._ab[d.al()]/(3*this._ad[a-1].ay())}this.a3(b,this._p)}return this.a1()},a5:function(a,b,c,d){var e=0;if(0===c.i7())e=d*this._ab[a.al()]/b;else{for(;c.i1();c.i2()){var f=c.i8();e+=f.a2()===a?this._ab[f.a3().al()]:this._ab[f.a2().al()]}e/=c.i7()}return e},a7:function(a){Eg.f(this._ab,a,a.length)},b3:function(a){Eg.f(a,this._ab,a.length)},r:function(){var a=Eg.a(this._ab.length);return this.a7(a),a},d:function(){for(var a=0;a<this._ad.length;a++)for(var b=0,c=this._ad[a].ah();c.i1();)this._ab[c.i6().al()]=b,c.i2(),b++},b1:function(){for(var a=0;a<this._ad.length;a++){for(var b=this._ad[a],c=b._b;null!=c;c=c.a()){var d=c.d();this._f[this._ab[d.al()]]=d}for(var e=0,f=b._b;null!=f;)f.c(this._f[e]),f=f.a(),e++}},a3:function(a,b){for(var c=a.ah(),d=0;d<a.ay();c.i2())this._f[d]=c.i6(),d++;Eg.s(this._f,a.ay(),b);for(var e=0,f=a._b;null!=f;)f.c(this._f[e]),this._ab[this._f[e].al()]=e,f=f.a(),e++}}),yg.b=function(a,b){if(null==a)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4-d:a.f()?-1e4+d:a.c()?-2e4-c:c},yg.a=function(a,b){if(null==a)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4+d:a.f()?-1e4-d:a.d()?-2e4-c:c};var zg=function(){zg.superClass.constructor.call(this),this._i6=0,this._i3=2147483647,this._i0=60,this._iz=20,this._i2=20,this._i4=20,this.i5(!1),this._i7=new rg,this._i1=new yg,this._i8=new ug};Jc.ext(zg,Of,{j2:function(){return this._i2},i4:function(){return!0},i3:function(a){this._i6=(new Date).getTime(),lg.d(a,!1);var b=a.xk(),c=a.xk(),d=a.xl(),e=new pf,f=new xg(a,b,c,d);f.a6(this.j2()),this._i8.i3(this._iz),this._i8.i6(this._i0),this._i8.i4(this._i2),this._i8.i5(this._i4),this._i8.i2(c);for(var g=this._i7.i1(a,b,e),h=e.c1();h.i1();h.i2()){var i=h.i8();d.i7(i,!0);var j=a.gn(i);a.gt(i,a.gk(i)),a.gz(i,j)}this.a2(a,b,c),g=f.a9(g);var k=this.j1(a,b,g);k=f.a5(k),k=f.b3(k),this._i8.i1(a,k,b),k=f.g2(k),f.e2(k),this.b(a,c),this.w(a),this.a1(a,e),f.e1(),a.xj(d),a.xi(c),a.xi(b)},j1:function(a,b,c){if(this._i1 instanceof yg){var d=this._i1,e=(new Date).getTime()-this._i6;d.ib(this._i3-e)}var f=this._i1.ia(a,b,c);return f},a1:function(a,b){for(var c=b.c1();c.i1();c.i2()){var d=c.i8(),e=a.gs(d),f=a.gl(d);a.x3(d);var g=a.gp(d);a.s5(d,g.a()),a.gy(d,e),a.gx(d,f)}},b:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=b.i1(d);if(null!=e&&!a.xp(e)){for(var f=d.am().i8().a2();null!=b.i1(f);f=d.am().i8().a2())d=f;a.u1(e);for(var g=d.ae(),h=new of;null!=b.i1(g.a3());g=g.a3().ag()){var i=a.gs(g);h.aa(i),h.az(a.gf(g));var j=a.gl(g);j.equals(i)||h.aa(j)}var k=a.gs(g);h.aa(k),h.az(a.gf(g));var l=a.gl(g);l.equals(k)||h.aa(l),a.m1(e,h)}}for(var m=a.x9();m.i1();m.i2())null!=b.i1(m.i9())&&a.x4(m.i9())},w:function(a){for(var b=a.xf();b.i1();b.i2()){var c=b.i8(),d=a.g2(c);if(d.i1()>0){var e=new me,f=a.gc(c),g=f.c(),h=g.i6();g.i2();var i=h.x,j=h.y;if(g.i1()){var k=g.i6(),l=k.x,m=k.y;for(g.i2();g.i1();g.i2()){var n=g.i6(),o=n.x,p=n.y,q=(i-o)*(m-p)/(j-p)+o;Math.abs(q-l)>=1&&(e.add(k),i=l,j=m),k=n,l=o,m=p}}e.size()<d.i1()&&a.s5(c,new Ue(e))}}},a2:function(a,b,c){var d=a.g8().c1();for(d.i5();d.i1();d.i3()){var e=d.i8().a2(),f=d.i8().a3(),g=b.i2(f)-b.i2(e);if(g>1){for(var h=null,i=null,j=e;g>1;g--)h=a.xm(),a.s7(h,1,1),a.s4(h,dg._A),i=a.xo(j,h),j===e&&a.gt(i,a.gn(d.i8())),b.i7(h,b.i2(j)+1),c.z1(h,d.i8()),j=h;i=a.xo(h,f),a.gz(i,a.gk(d.i8())),a.h1(d.i8())}}}});var Ag=function(a,b,c,d){this._i=20,this._j=a,this._g=b,this._a=c,this._h=d};Jc.ext(Ag,Object,{a1:function(a){this._i=a},b2:function(a){return null==this._e?!1:this._e.i4(a)},a3:function(a){return null==this._f?null:this._f.i1(a)},d:function(){this._j.xi(this._f),this._j.xi(this._e)}});var Bg=function(){this._c=0,this._i=0,this._g=0,this._j=0,this._f=0,this._h=0,this._d=0,this._e=0,this._a=0,this._b=0};Jc.ext(Bg,Object,{a:function(){return this._c-this._g-this._f-this._a},b:function(){return this._i+this._j+this._h+this._b}});var Cg=function(){this._d=new pf,this._b=new pf,this._c=new pf,this._e=new pf};Jc.ext(Cg,Object,{});var Dg=function(a,b,c,d,e,f,g,h){this._d=a,this._a=b,this._b=c,this._h=d,this._f=e,this._c=f,this._e=g,this._g=h};Jc.ext(Dg,Object,{});var Eg={};Eg.a=function(a,b){for(var c=[],d=0;a>d;d++)c[d]=b||0;return c},Eg.b=function(a){for(var b=[],c=0;a>c;c++)b[c]=!1;return b},Eg.c=function(a,b){if(a instanceof Pe)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y<=b.y?0:1;if(a instanceof Qe)return b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;if(a instanceof Se)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y>b.y?1:b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;throw"Unkown Type: "+a},Eg.d=function(a){for(var b=[],c=0;a>c;c++)b[c]=null;return b},Eg.e=function(a,b){for(var c=[],d=0;a>d;d++)c[d]=Eg.a(b);return c},Eg.f=function(a,b,c){for(var d=0;c>d;d++)b[d]=a[d]},Eg.s=function(a,b,c){var d=[];Eg.f(a,d,b),d.sort(c),Eg.f(d,a,b)},Eg.n=function(a,b){return a-b}}(this);(function(e,t){function _(e,t){var n=0;if(e.shadowMatrix)for(var r=0,i=t.size();r<i;r++){var s=t.get(r);s.refreshShadowUniforms(e,n)&&n++}}function D(e,t){var n=0;if(e.pShadowMap)for(var r=0,i=t.size();r<i;r++){var s=t.get(r);s.refreshUniformsPointShadow(e,n)&&n++}}function P(e,t,n){t._modelViewMatrix||(t._modelViewMatrix=new l),n.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&n.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function H(e,t,n){var r;return e==="fragment"?r=n.createShader(n.FRAGMENT_SHADER):e==="vertex"&&(r=n.createShader(n.VERTEX_SHADER)),n.shaderSource(r,t),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(console.log(n.getShaderInfoLog(r)),console.error(t),null)}function B(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function F(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function I(e,t,n,r){e[t]=n.r*n.r*r,e[t+1]=n.g*n.g*r,e[t+2]=n.b*n.b*r}function R(e){var t=e;O.isNaN(t._renderInterval)&&(t._renderInterval=10),t.__timeOutFunc||(t.__timeOutFunc=function(){requestAnimationFrame(t.__timeOutFunc),t.render()}),setTimeout(t.__timeOutFunc,t._renderInterval)}function $(e,t,n){e!=null&&("number"==typeof e?this.fromNumber(e,t,n):t==null&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function J(){return new $(null)}function K(e,t,n,r,i,s){while(--s>=0){var o=t*this[e++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=o&67108863}return i}function Q(e,t,n,r,i,s){var o=t&32767,u=t>>15;while(--s>=0){var a=this[e]&32767,f=this[e++]>>15,l=u*a+f*o;a=o*a+((l&32767)<<15)+n[r]+(i&1073741823),i=(a>>>30)+(l>>>15)+u*f+(i>>>30),n[r++]=a&1073741823}return i}function G(e,t,n,r,i,s){var o=t&16383,u=t>>14;while(--s>=0){var a=this[e]&16383,f=this[e++]>>14,l=u*a+f*o;a=o*a+((l&16383)<<14)+n[r]+i,i=(a>>28)+(l>>14)+u*f,n[r++]=a&268435455}return i}function rt(e){return Z.charAt(e)}function it(e,t){var n=et[e.charCodeAt(t)];return n==null?-1:n}function st(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function ot(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+DV:this.t=0}function ut(e){var t=J();return t.fromInt(e),t}function at(e,t){var n;if(t==16)n=4;else if(t==8)n=3;else if(t==256)n=8;else if(t==2)n=1;else if(t==32)n=5;else{if(t!=4){this.fromRadix(e,t);return}n=2}this.t=0,this.s=0;var r=e.length,i=!1,s=0;while(--r>=0){var o=n==8?e[r]&255:it(e,r);if(o<0){e.charAt(r)=="-"&&(i=!0);continue}i=!1,s==0?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,s+=n,s>=this.DB&&(s-=this.DB)}n==8&&(e[0]&128)!=0&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&$.ZERO.subTo(this,this)}function ft(){var e=this.s&this.DM;while(this.t>0&&this[this.t-1]==e)--this.t}function lt(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else{if(e!=4)return this.toRadix(e);t=2}var n=(1<<t)-1,r,i=!1,s="",o=this.t,u=this.DB-o*this.DB%t;if(o-->0){u<this.DB&&(r=this[o]>>u)>0&&(i=!0,s=rt(r));while(o>=0)u<t?(r=(this[o]&(1<<u)-1)<<t-u,r|=this[--o]>>(u+=this.DB-t)):(r=this[o]>>(u-=t)&n,u<=0&&(u+=this.DB,--o)),r>0&&(i=!0),i&&(s+=rt(r))}return i?s:"0"}function ct(){var e=J();return $.ZERO.subTo(this,e),e}function ht(){return this.s<0?this.negate():this}function pt(e){var t=this.s-e.s;if(t!=0)return t;var n=this.t;t=n-e.t;if(t!=0)return t;while(--n>=0)if((t=this[n]-e[n])!=0)return t;return 0}function dt(e){var t=1,n;return(n=e>>>16)!=0&&(e=n,t+=16),(n=e>>8)!=0&&(e=n,t+=8),(n=e>>4)!=0&&(e=n,t+=4),(n=e>>2)!=0&&(e=n,t+=2),(n=e>>1)!=0&&(e=n,t+=1),t}function vt(){return this.t<=0?0:this.DB*(this.t-1)+dt(this[this.t-1]^this.s&this.DM)}function mt(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function gt(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function yt(e,t){var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM,u;for(u=this.t-1;u>=0;--u)t[u+s+1]=this[u]>>r|o,o=(this[u]&i)<<n;for(u=s-1;u>=0;--u)t[u]=0;t[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function bt(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&s)<<i,t[o-n]=this[o]>>r;r>0&&(t[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function wt(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r-=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function Et(e,t){var n=this.abs(),r=e.abs(),i=n.t;t.t=i+r.t;while(--i>=0)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&$.ZERO.subTo(t,t)}function St(e){var t=this.abs(),n=e.t=2*t.t;while(--n>=0)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function xt(e,t,n){var r=e.abs();if(r.t<=0)return;var i=this.abs();if(i.t<r.t){t!=null&&t.fromInt(0),n!=null&&this.copyTo(n);return}n==null&&(n=J());var s=J(),o=this.s,u=e.s,a=this.DB-dt(r[r.t-1]);a>0?(r.lShiftTo(a,s),i.lShiftTo(a,n)):(r.copyTo(s),i.copyTo(n));var f=s.t,l=s[f-1];if(l==0)return;var c=l*(1<<this.F1)+(f>1?s[f-2]>>this.F2:0),h=this.FV/c,p=(1<<this.F1)/c,d=1<<this.F2,v=n.t,m=v-f,g=t==null?J():t;s.dlShiftTo(m,g),n.compareTo(g)>=0&&(n[n.t++]=1,n.subTo(g,n)),$.ONE.dlShiftTo(f,g),g.subTo(s,s);while(s.t<f)s[s.t++]=0;while(--m>=0){var y=n[--v]==l?this.DM:Math.floor(n[v]*h+(n[v-1]+d)*p);if((n[v]+=s.am(0,y,n,m,0,f))<y){s.dlShiftTo(m,g),n.subTo(g,n);while(n[v]<--y)n.subTo(g,n)}}t!=null&&(n.drShiftTo(f,t),o!=u&&$.ZERO.subTo(t,t)),n.t=f,n.clamp(),a>0&&n.rShiftTo(a,n),o<0&&$.ZERO.subTo(n,n)}function Tt(e){var t=J();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo($.ZERO)>0&&e.subTo(t,t),t}function Nt(e){this.m=e}function Ct(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function kt(e){return e}function Lt(e){e.divRemTo(this.m,null,e)}function At(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function Ot(e,t){e.squareTo(t),this.reduce(t)}function Mt(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function _t(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function Dt(e){var t=J();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo($.ZERO)>0&&this.m.subTo(t,t),t}function Pt(e){var t=J();return e.copyTo(t),this.reduce(t),t}function Ht(e){while(e.t<=this.mt2)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=e[t]&32767,r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);while(e[n]>=e.DV)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function Bt(e,t){e.squareTo(t),this.reduce(t)}function jt(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function Ft(){return(this.t>0?this[0]&1:this.s)==0}function It(e,t){if(e>4294967295||e<1)return $.ONE;var n=J(),r=J(),i=t.convert(this),s=dt(e)-1;i.copyTo(n);while(--s>=0){t.sqrTo(n,r);if((e&1<<s)>0)t.mulTo(r,i,n);else{var o=n;n=r,r=o}}return t.revert(n)}function qt(e,t){var n;return e<256||t.isEven()?n=new Nt(t):n=new _t(t),this.exp(e,n)}function Rt(){var e=J();return this.copyTo(e),e}function Ut(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function zt(){return this.t==0?this.s:this[0]<<24>>24}function Wt(){return this.t==0?this.s:this[0]<<16>>16}function Xt(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function Vt(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function $t(e){e==null&&(e=10);if(this.signum()==0||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=ut(n),i=J(),s=J(),o="";this.divRemTo(r,i,s);while(i.signum()>0)o=(n+s.intValue()).toString(e).substr(1)+o,i.divRemTo(r,i,s);return s.intValue().toString(e)+o}function Jt(e,t){this.fromInt(0),t==null&&(t=10);var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,s=0,o=0;for(var u=0;u<e.length;++u){var a=it(e,u);if(a<0){e.charAt(u)=="-"&&this.signum()==0&&(i=!0);continue}o=t*o+a,++s>=n&&(this.dMultiply(r),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0)),i&&$.ZERO.subTo(this,this)}function Kt(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo($.ONE.shiftLeft(e-1),rn,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(t))this.dAddOffset(2,0),this.bitLength()>e&&this.subTo($.ONE.shiftLeft(e-1),this)}else{var r=new Array,i=e&7;r.length=(e>>3)+1,t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}}function Qt(){var e=this.t,t=new Array;t[0]=this.s;var n=this.DB-e*this.DB%8,r,i=0;if(e-->0){n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);while(e>=0){n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),(r&128)!=0&&(r|=-256),i==0&&(this.s&128)!=(r&128)&&++i;if(i>0||r!=this.s)t[i++]=r}}return t}function Gt(e){return this.compareTo(e)==0}function Yt(e){return this.compareTo(e)<0?this:e}function Zt(e){return this.compareTo(e)>0?this:e}function en(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;r<s;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){i=e.s&this.DM;for(r=s;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{i=this.s&this.DM;for(r=s;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function tn(e,t){return e&t}function nn(e){var t=J();return this.bitwiseTo(e,tn,t),t}function rn(e,t){return e|t}function sn(e){var t=J();return this.bitwiseTo(e,rn,t),t}function on(e,t){return e^t}function un(e){var t=J();return this.bitwiseTo(e,on,t),t}function an(e,t){return e&~t}function fn(e){var t=J();return this.bitwiseTo(e,an,t),t}function ln(){var e=J();for(var t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function cn(e){var t=J();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function hn(e){var t=J();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function pn(e){if(e==0)return-1;var t=0;return(e&65535)==0&&(e>>=16,t+=16),(e&255)==0&&(e>>=8,t+=8),(e&15)==0&&(e>>=4,t+=4),(e&3)==0&&(e>>=2,t+=2),(e&1)==0&&++t,t}function dn(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+pn(this[e]);return this.s<0?this.t*this.DB:-1}function vn(e){var t=0;while(e!=0)e&=e-1,++t;return t}function mn(){var e=0,t=this.s&this.DM;for(var n=0;n<this.t;++n)e+=vn(this[n]^t);return e}function gn(e){var t=Math.floor(e/this.DB);return t>=this.t?this.s!=0:(this[t]&1<<e%this.DB)!=0}function yn(e,t){var n=$.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function bn(e){return this.changeBit(e,rn)}function wn(e){return this.changeBit(e,an)}function En(e){return this.changeBit(e,on)}function Sn(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r+=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()}function xn(e){var t=J();return this.addTo(e,t),t}function Tn(e){var t=J();return this.subTo(e,t),t}function Nn(e){var t=J();return this.multiplyTo(e,t),t}function Cn(){var e=J();return this.squareTo(e),e}function kn(e){var t=J();return this.divRemTo(e,t,null),t}function Ln(e){var t=J();return this.divRemTo(e,null,t),t}function An(e){var t=J(),n=J();return this.divRemTo(e,t,n),new Array(t,n)}function On(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function Mn(e,t){if(e==0)return;while(this.t<=t)this[this.t++]=0;this[t]+=e;while(this[t]>=this.DV)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}function _n(){}function Dn(e){return e}function Pn(e,t,n){e.multiplyTo(t,n)}function Hn(e,t){e.squareTo(t)}function Bn(e){return this.exp(e,new _n)}function jn(e,t,n){var r=Math.min(this.t+e.t,t);n.s=0,n.t=r;while(r>0)n[--r]=0;var i;for(i=n.t-this.t;r<i;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);r<i;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}function Fn(e,t,n){--t;var r=n.t=this.t+e.t-t;n.s=0;while(--r>=0)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function In(e){this.r2=J(),this.q3=J(),$.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function qn(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=J();return e.copyTo(t),this.reduce(t),t}function Rn(e){return e}function Un(e){e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(e.compareTo(this.r2)<0)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);while(e.compareTo(this.m)>=0)e.subTo(this.m,e)}function zn(e,t){e.squareTo(t),this.reduce(t)}function Wn(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function Xn(e,t){var n=e.bitLength(),r,i=ut(1),s;if(n<=0)return i;n<18?r=1:n<48?r=3:n<144?r=4:n<768?r=5:r=6,n<8?s=new Nt(t):t.isEven()?s=new In(t):s=new _t(t);var o=new Array,u=3,a=r-1,f=(1<<r)-1;o[1]=s.convert(this);if(r>1){var l=J();s.sqrTo(o[1],l);while(u<=f)o[u]=J(),s.mulTo(l,o[u-2],o[u]),u+=2}var c=e.t-1,h,p=!0,d=J(),v;n=dt(e[c])-1;while(c>=0){n>=a?h=e[c]>>n-a&f:(h=(e[c]&(1<<n+1)-1)<<a-n,c>0&&(h|=e[c-1]>>this.DB+n-a)),u=r;while((h&1)==0)h>>=1,--u;(n-=u)<0&&(n+=this.DB,--c);if(p)o[h].copyTo(i),p=!1;else{while(u>1)s.sqrTo(i,d),s.sqrTo(d,i),u-=2;u>0?s.sqrTo(i,d):(v=i,i=d,d=v),s.mulTo(d,o[h],i)}while(c>=0&&(e[c]&1<<n)==0)s.sqrTo(i,d),v=i,i=d,d=v,--n<0&&(n=this.DB-1,--c)}return s.revert(i)}function Vn(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return t;i<s&&(s=i),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));while(t.signum()>0)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n}function $n(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(t==0)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function Jn(e){var t=e.isEven();if(this.isEven()&&t||e.signum()==0)return $.ZERO;var n=e.clone(),r=this.clone(),i=ut(1),s=ut(0),o=ut(0),u=ut(1);while(n.signum()!=0){while(n.isEven()){n.rShiftTo(1,n);if(t){if(!i.isEven()||!s.isEven())i.addTo(this,i),s.subTo(e,s);i.rShiftTo(1,i)}else s.isEven()||s.subTo(e,s);s.rShiftTo(1,s)}while(r.isEven()){r.rShiftTo(1,r);if(t){if(!o.isEven()||!u.isEven())o.addTo(this,o),u.subTo(e,u);o.rShiftTo(1,o)}else u.isEven()||u.subTo(e,u);u.rShiftTo(1,u)}n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(o,i),s.subTo(u,s)):(r.subTo(n,r),t&&o.subTo(i,o),u.subTo(s,u))}return r.compareTo($.ONE)!=0?$.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u}function Gn(e){var t,n=this.abs();if(n.t==1&&n[0]<=Kn[Kn.length-1]){for(t=0;t<Kn.length;++t)if(n[0]==Kn[t])return!0;return!1}if(n.isEven())return!1;t=1;while(t<Kn.length){var r=Kn[t],i=t+1;while(i<Kn.length&&r<Qn)r*=Kn[i++];r=n.modInt(r);while(t<i)if(r%Kn[t++]==0)return!1}return n.millerRabin(e)}function Yn(e){var t=this.subtract($.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n);e=e+1>>1,e>Kn.length&&(e=Kn.length);var i=J();for(var s=0;s<e;++s){i.fromInt(Kn[Math.floor(Math.random()*Kn.length)]);var o=i.modPow(r,this);if(o.compareTo($.ONE)!=0&&o.compareTo(t)!=0){var u=1;while(u++<n&&o.compareTo(t)!=0){o=o.modPowInt(2,this);if(o.compareTo($.ONE)==0)return!1}if(o.compareTo(t)!=0)return!1}}return!0}function Zn(){this.i=0,this.j=0,this.S=new Array}function er(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;n=0;for(t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0}function tr(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]}function nr(){return new Zn}function ur(e){sr[or++]^=e&255,sr[or++]^=e>>8&255,sr[or++]^=e>>16&255,sr[or++]^=e>>24&255,or>=rr&&(or-=rr)}function ar(){ur((new Date).getTime())}function cr(){if(ir==null){ar(),ir=nr(),ir.init(sr);for(or=0;or<sr.length;++or)sr[or]=0;or=0}return ir.next()}function hr(e){var t;for(t=0;t<e.length;++t)e[t]=cr()}function pr(){}function mr(e){var t,n,r="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+=dr.charAt(n>>6)+dr.charAt(n&63);t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+=dr.charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+=dr.charAt(n>>2)+dr.charAt((n&3)<<4));while((r.length&3)>0)r+=vr;return r}function gr(e){var t="",n,r=0,i;for(n=0;n<e.length;++n){if(e.charAt(n)==vr)break;v=dr.indexOf(e.charAt(n));if(v<0)continue;r==0?(t+=rt(v>>2),i=v&3,r=1):r==1?(t+=rt(i<<2|v>>4),i=v&15,r=2):r==2?(t+=rt(i),t+=rt(v>>2),i=v&3,r=3):(t+=rt(i<<2|v>>4),t+=rt(v&15),r=0)}return r==1&&(t+=rt(i<<2)),t}function yr(e){var t=gr(e),n,r=new Array;for(n=0;2*n<t.length;++n)r[n]=parseInt(t.substring(2*n,2*n+2),16);return r}function br(e,t){return new $(e,t)}function wr(e){return e<16?"0"+e.toString(16):e.toString(16)}function Er(e,t){if(t<e.length+11)return null;var n=new Array,r=e.length-1;while(r>=0&&t>0){var i=e.charCodeAt(r--);i<128?n[--t]=i:i>127&&i<2048?(n[--t]=i&63|128,n[--t]=i>>6|192):(n[--t]=i&63|128,n[--t]=i>>6&63|128,n[--t]=i>>12|224)}n[--t]=0;var s=new pr,o=new Array;while(t>2){o[0]=0;while(o[0]==0)s.nextBytes(o);n[--t]=o[0]}return n[--t]=2,n[--t]=0,new $(n)}function Sr(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function xr(e,t){this.n=br(e,16),this.e=parseInt(t,16)}function Tr(e){return e.modPowInt(this.e,this.n)}function Nr(e){var t=Er(e,this.n.bitLength()+7>>3);if(t==null)return null;var n=this.doPrivate(t);if(n==null)return null;var r=n.toString(16);return(r.length&1)==0?r:"0"+r}function Cr(e,t){var n=e.toByteArray(),r=0;while(r<n.length&&n[r]==0)++r;if(n.length-r!=t-1||n[r]!=2)return null;++r;while(n[r]!=0)if(++r>=n.length)return null;var i="";while(++r<n.length){var s=n[r]&255;s<128?i+=String.fromCharCode(s):s>191&&s<224?(i+=String.fromCharCode((s&31)<<6|n[r+1]&63),++r):(i+=String.fromCharCode((s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63),r+=2)}return i}function kr(e,t,n){this.n=br(e,16),this.e=parseInt(t,16),this.d=br(n,16)}function Lr(e,t,n,r,i,s,o,u){this.n=br(e,16),this.e=parseInt(t,16),this.d=br(n,16),this.p=br(r,16),this.q=br(i,16),this.dmp1=br(s,16),this.dmq1=br(o,16),this.coeff=br(u,16)}function Ar(e){if(this.p==null||this.q==null)return e.modPow(this.d,this.n);var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);while(t.compareTo(n)<0)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}function Or(e){var t=br(e,16),n=this.doPublic(t);return n==null?null:Cr(n,this.n.bitLength()+7>>3)}function Xr(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Vr(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function Jr(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.map.value=t.map}function ni(e,t){return e.distance-t.distance}function ri(e,t,r,i,s){(e instanceof n.Node||e instanceof n.Billboard)&&si(e,t,r,i,s)}function ii(e,n,r,i,s){if(e===t)return;var o=e.getDescendants();for(var u=0,a=o.length;u<a;u++)ri(o[u],n,r,i,s)}function si(e,r,i,u,a){if(!u&&a.isVisible(e)==0)return;if(e instanceof n.Billboard){var f=r.matrixPosition;f.setFromMatrixPosition(e.worldMatrix);var l=r.ray.distanceToPoint(f),c=e.material.alignment,h=new n.Plane(1,1);if(c.x||c.y)h.setPosition(c.x,c.y,0),h=n.Utils.transformElement(h,!0);h.setPosition(f);var p=(new o).getScaleFromMatrix(e.worldMatrix);h.setScale(p.x,p.y,1);var d=r.direction.clone(),v=h.getPosition().clone(),m=e.material;m&&m.vertical&&(d.y=0),v.sub(d),h.lookAt(v),h.updateWorldMatrix(!0);var g=[];return si(h,r,g,!0,a),g.length===0?i:(i.push({distance:g[0].distance,point:e._position,face:null,object:e,element:e}),i)}if(e instanceof n.Line){var y=1;y-=1;var b=Math.sqrt(r.linePrecision+y),w=b*b,E=e;E.boundingSphere==null&&E.computeBoundingSphere(),ti.copy(E.boundingSphere),ti.applyMatrix4(e.worldMatrix);if(r.ray.isIntersectionSphere(ti)===!1)return i;Yr.getInverse(e.worldMatrix),Gr.copy(r.ray).transform(Yr);var S=E.vertices,x=S.length,T=new o,N=new o,C=e.type===n.LineStrip?1:2;for(var k=0;k<x-1;k+=C){var L=Gr.distanceSqToSegment(S[k],S[k+1],N,T);if(L>w)continue;var l=Gr.origin.distanceTo(N);if(l<r.near||l>r.far)continue;i.push({distance:l,point:T.clone().applyMatrix4(e.worldMatrix),face:null,faceIndex:null,element:e,object:e})}return i}e.boundingSphere===null&&e.computeBoundingSphere(),ti.set(e.worldMatrix.getPosition(),e.boundingSphere.radius*e.worldMatrix.getMaxScaleOnAxis());if(!r.ray.isIntersectionSphere(ti))return i;var E=e,S=E.vertices,A=e.material instanceof n.ArrayMaterial,M=A===!0?e.material.materials:null,_=e.material.side,D,P,H,B,j,F,I,b=r.precision;e.rotationWorldMatrix.extractRotation(e.worldMatrix),Yr.getInverse(e.worldMatrix),Gr.copy(r.ray).transform(Yr);for(var q=0,R=E.faces.length;q<R;q++){var U=E.faces[q],z=A===!0?M[U.materialIndex]:e.material;if(z===t||z.visible===!1||E.visible===!1&&!u)continue;Zr.setFromNormalAndCoplanarPoint(U.normal,S[U.a]);var W=Gr.distanceToPlane(Zr);if(Math.abs(W)<b)continue;if(W<0)continue;_=z.side;var X=Gr.direction.dot(Zr.normal);if(_!==n.DoubleSide&&!(_===n.FrontSide?X<0:X>0))continue;if(W<r.near||W>r.far)continue;ei=Gr.at(W,ei);var V=new o,$=U.materialIndex,J=!1,K;a&&a._selectTransparencyThreshold>0&&(J=z.transparent==1||z.alphaTest>0);if(U instanceof n.Face3){D=S[U.a],P=S[U.b],H=S[U.c];if(!n.Triangle.containsPoint(ei,D,P,H))continue;V=n.Triangle.barycoordFromPoint(ei,D,P,H)}else{if(!(U instanceof n.Face4))throw Error("face type not supported");D=S[U.a],P=S[U.b],H=S[U.c],B=S[U.d];var Q=n.Triangle.containsPoint(ei,D,P,B),G=n.Triangle.containsPoint(ei,P,H,B);if(!Q&&!G)continue;Q?V=n.Triangle.barycoordFromPoint(ei,D,P,B):(V=n.Triangle.barycoordFromPoint(ei,P,H,B),K=!0)}var Y=E.uvs[q],Z=new s,et=V.z,tt=V.x,nt=V.y;U instanceof n.Face3?(Z.x=Y[0].x*tt+Y[1].x*nt+Y[2].x*et,Z.y=Y[0].y*tt+Y[1].y*nt+Y[2].y*et):K?(Z.x=Y[1].x*tt+Y[2].x*nt+Y[3].x*et,Z.y=Y[1].y*tt+Y[2].y*nt+Y[3].y*et):(Z.x=Y[0].x*tt+Y[1].x*nt+Y[3].x*et,Z.y=Y[0].y*tt+Y[1].y*nt+Y[3].y*et);var rt=1,it;Z=a.debugUV||Z;if(J){if(z.map==null)rt=z.opacity;else{it=z.map._image;var st=O.getPixelFromImage(it,Z.x,Z.y);rt=st[3]}rt<z.alphaTest?rt=0:z.transparent==0&&(rt=1)}if(rt<a._selectTransparencyThreshold)continue;i.push({distance:W,point:r.ray.at(W),face:U,uv:Z,faceIndex:q,element:e,object:e,side:X>0?1:-1})}}self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,Object.create=Object.create||function(e){var t=function(){};return t.prototype=e,new t};var n={version:"2.0.4",_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(e){e=e==null?"":e;var t=[];for(var n=0;n<32;n++)t[n]=this._id[Math.floor(Math.random()*16)];return t[12]="4",t[16]=this._id[t[16]&3|8],e+t.join("")},ip:function(e,t,r,i){var s=r+t;e[n.getter(t,i)]=function(){return this[s]},e[n.setter(t)]=function(e){if(this.setPropertyValue)this.setPropertyValue(s,e)&&(this.onPropertyChange(t,n,e),this.firePropertyChange(t,n,e));else{var n=this[s];if(n===e)return;this[s]=e,this.onPropertyChange(t,n,e),this.firePropertyChange(t,n,e)}}},getter:function(e,t){var n=e.charAt(0).toUpperCase()+e.slice(1),r=/ble$/.test(e)||/ed$/.test(e)?"is":"get";return t&&t.indexOf(e)!=-1&&(r="is"),r+n},setter:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);return"set"+t},getValue:function(e,t,n){var r=t.charAt(0).toUpperCase()+t.slice(1),i="get"+r,s="is"+r;return n?n==="boolean"?e[s]():(e[i]==null&&console.log("get Function "+i+" not exist"),e[i]()):e[i]?e[i]():e[s]?e[s]():e[t]},setValue:function(e,t,n){e["set"+t.charAt(0).toUpperCase()+t.slice(1)](n)},clone:function(e){if(!e)return null;var t={};for(var n in e)t[n]=e[n];return t},addMethod:function(e,t){var n=e.prototype;for(var r in t)n[r]=t[r]},classCache:{},getClass:function(t){var r=n.classCache[t];if(!r){var i=t.split("."),s=i.length;r=e;for(var o=0;o<s;o++)r=r[i[o]];n.classCache[t]=r}return r},newInstance:function(e){typeof e=="string"&&(e=n.getClass(e),e=e.prototype);var t=e.constructor;if(!t)return null;var r=arguments.length,i=arguments;if(r===1)return new t;if(r===2)return new t(i[1]);if(r===3)return new t(i[1],i[2]);if(r===4)return new t(i[1],i[2],i[3]);if(r===5)return new t(i[1],i[2],i[3],i[4]);if(r===6)return new t(i[1],i[2],i[3],i[4],i[5]);if(r===7)return new t(i[1],i[2],i[3],i[4],i[5],i[6]);if(r===8)return new t(i[1],i[2],i[3],i[4],i[5],i[6],i[7]);throw"don't support args more than 7"},xml:function(t){if(e.DOMParser)return(new DOMParser).parseFromString(t,"text/xml");var n=new ActiveXObject("Microsoft.XmlDOM");return n.async=!1,n.loadXml(t),n}};e.TGL=n,e.mono=n;var r={};n.extend=function(e,t,r){if(t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.superClass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}var s=e.prototype;if(r){s.getClassName=function(){return r.className};for(var o in r){if(o==="__accessor"){var u=r.__accessor,a=r.__bool;for(var f=0;f<u.length;f++){var l=u[f];n.ip(s,l,"",a)}}else if(o==="___accessor"){var u=r.___accessor;for(var f=0;f<u.length;f++){var l=u[f];n.ip(s,l,"_",a)}}s[o]=r[o]}r.constructor&&(s.newInstance=function(){return n.newInstance(this)})}},n.defaultEulerOrder="XYZ",String.prototype.startsWith=String.prototype.startsWith||function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=String.prototype.endsWith||function(e){var t=String(e),n=this.lastIndexOf(t);return(-1<n&&n)===this.length-t.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){var n=0,r=["ms","moz","webkit","o"];for(var i=0;i<r.length&&!e.requestAnimationFrame;++i)e.requestAnimationFrame=e[r[i]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[r[i]+"CancelAnimationFrame"]||e[r[i]+"CancelRequestAnimationFrame"];e.requestAnimationFrame===t&&(e.requestAnimationFrame=function(t,r){var i=Date.now(),s=Math.max(0,16-(i-n)),o=e.setTimeout(function(){t(i+s)},s);return n=i+s,o}),e.cancelAnimationFrame=e.cancelAnimationFrame||function(t){e.clearTimeout(t)}}(),n.CullFaceNone=0,n.CullFaceBack=1,n.CullFaceFront=2,n.CullFaceFrontBack=3,n.FrontFaceDirectionCW=0,n.FrontFaceDirectionCCW=1,n.BasicShadowMap=0,n.PCFShadowMap=1,n.PCFSoftShadowMap=2,n.FrontSide="front",n.BackSide="back",n.DoubleSide="both",n.BothSide="both",n.NoShading=0,n.FlatShading=1,n.SmoothShading=2,n.NormalTypeFlat="flat",n.NormalTypeSmooth="smooth",n.NoColors=0,n.FaceColors=1,n.VertexColors=2,n.NoBlending=0,n.NormalBlending=1,n.AdditiveBlending=2,n.SubtractiveBlending=3,n.MultiplyBlending=4,n.CustomBlending=5,n.AddEquation=100,n.SubtractEquation=101,n.ReverseSubtractEquation=102,n.ZeroFactor=200,n.OneFactor=201,n.SrcColorFactor=202,n.OneMinusSrcColorFactor=203,n.SrcAlphaFactor=204,n.OneMinusSrcAlphaFactor=205,n.DstAlphaFactor=206,n.OneMinusDstAlphaFactor=207,n.DstColorFactor=208,n.OneMinusDstColorFactor=209,n.SrcAlphaSaturateFactor=210,n.MultiplyOperation=0,n.MixOperation=1,n.AddOperation=2,n.UVMapping=function(){},n.CubeReflectionMapping=function(){},n.CubeRefractionMapping=function(){},n.SphericalReflectionMapping=function(){},n.SphericalRefractionMapping=function(){},n.RepeatWrapping="repeat",n.ClampToEdgeWrapping="clamp",n.MirroredRepeatWrapping="mirrored",n.NearestFilter=1003,n.NearestMipMapNearestFilter=1004,n.NearestMipMapLinearFilter=1005,n.LinearFilter=1006,n.LinearMipMapNearestFilter=1007,n.LinearMipMapLinearFilter=1008,n.UnsignedByteType=1009,n.ByteType=1010,n.ShortType=1011,n.UnsignedShortType=1012,n.IntType=1013,n.UnsignedIntType=1014,n.FloatType=1015,n.UnsignedShort4444Type=1016,n.UnsignedShort5551Type=1017,n.UnsignedShort565Type=1018,n.AlphaFormat=1019,n.RGBFormat=1020,n.RGBAFormat=1021,n.LuminanceFormat=1022,n.LuminanceAlphaFormat=1023,n.RGB_S3TC_DXT1_Format=2001,n.RGBA_S3TC_DXT1_Format=2002,n.RGBA_S3TC_DXT3_Format=2003,n.RGBA_S3TC_DXT5_Format=2004,n.Gradient_Linear_U=1,n.Gradient_Linear_V=2,n.Gradient_Linear_UV=3,n.Gradient_Linear_NUV=4,n.Gradient_Linear_Radial=5,n.Gradient_Linear_Sweep=6,n.Math={clamp:function(e,t,n){return e<t?t:e>n?n:e},isConcave:function(e,t,n){var r=n?1:-1;return(e.x*t.y-t.x*e.y)*r<0?!0:!1},area:function(e,n,r,i){var s=i?1:-1;if(!e||!n||!r)return t;var o=-e.x*n.y-n.x*r.y-r.x*e.y+r.x*n.y+n.x*e.y+e.x*r.y;return o*s},isClockwise:function(e,t,n){t=t||"x",n=n||"y";var r=0,i=e.length;for(var s=0;s<i;s++){var o=e[s],u=e[s+1===i?0:s+1];r+=(u[t]-o[t])*(u[n]+o[n])}return r<0},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(e){return e*n.Math.__d2r},radToDeg:function(e){return e*n.Math.__r2d},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(e*6-15)+10))},PI2:Math.PI*2,generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=new Array(36),n=0,r;return function(){for(var i=0;i<36;i++)i==8||i==13||i==18||i==23?t[i]="-":i==14?t[i]="4":(n<=2&&(n=33554432+Math.random()*16777216|0),r=n&15,n>>=4,t[i]=e[i==19?r&3|8:r]);return t.join("")}}()},n.Math.__d2r=Math.PI/180,n.Math.__r2d=180/Math.PI,n.Quat=function(e,n,r,i){this.x=e||0,this.y=n||0,this.z=r||0,this.w=i!==t?i:1},n.Quat.prototype={constructor:n.Quat,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,n){var r=Math.cos(e.x/2),i=Math.cos(e.y/2),s=Math.cos(e.z/2),o=Math.sin(e.x/2),u=Math.sin(e.y/2),a=Math.sin(e.z/2);return n===t||n==="XYZ"?(this.x=o*i*s+r*u*a,this.y=r*u*s-o*i*a,this.z=r*i*a+o*u*s,this.w=r*i*s-o*u*a):n==="YXZ"?(this.x=o*i*s+r*u*a,this.y=r*u*s-o*i*a,this.z=r*i*a-o*u*s,this.w=r*i*s+o*u*a):n==="ZXY"?(this.x=o*i*s-r*u*a,this.y=r*u*s+o*i*a,this.z=r*i*a+o*u*s,this.w=r*i*s-o*u*a):n==="ZYX"?(this.x=o*i*s-r*u*a,this.y=r*u*s+o*i*a,this.z=r*i*a-o*u*s,this.w=r*i*s+o*u*a):n==="YZX"?(this.x=o*i*s+r*u*a,this.y=r*u*s+o*i*a,this.z=r*i*a-o*u*s,this.w=r*i*s-o*u*a):n==="XZY"&&(this.x=o*i*s-r*u*a,this.y=r*u*s-o*i*a,this.z=r*i*a+o*u*s,this.w=r*i*s+o*u*a),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],o=t[5],u=t[9],a=t[2],f=t[6],l=t[10],c=n+o+l,h;return c>0?(h=.5/Math.sqrt(c+1),this.w=.25/h,this.x=(f-u)*h,this.y=(i-a)*h,this.z=(s-r)*h):n>o&&n>l?(h=2*Math.sqrt(1+n-o-l),this.w=(f-u)/h,this.x=.25*h,this.y=(r+s)/h,this.z=(i+a)/h):o>l?(h=2*Math.sqrt(1+o-n-l),this.w=(i-a)/h,this.x=(r+s)/h,this.y=.25*h,this.z=(u+f)/h):(h=2*Math.sqrt(1+l-n-o),this.w=(s-r)/h,this.x=(i+a)/h,this.y=(u+f)/h,this.z=.25*h),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.
x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return e===0?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,n){return n!==t?(console.warn("DEPRECATED: Quat's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,n)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e.x,r=e.y,i=e.z,s=e.w,o=t.x,u=t.y,a=t.z,f=t.w;return this.x=n*f+s*o+r*a-i*u,this.y=r*f+s*u+i*o-n*a,this.z=i*f+s*a+n*u-r*o,this.w=s*f-n*o-r*u-i*a,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quat's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( Quat ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var n=this.x,r=this.y,i=this.z,s=this.w,o=s*e.w+n*e.x+r*e.y+i*e.z;o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e);if(o>=1)return this.w=s,this.x=n,this.y=r,this.z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);if(Math.abs(a)<.001)return this.w=.5*(s+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this;var f=Math.sin((1-t)*u)/a,l=Math.sin(t*u)/a;return this.w=s*f+this.w*l,this.x=n*f+this.x*l,this.y=r*f+this.y*l,this.z=i*f+this.z*l,this},toEuler:function(){var e=this.w*this.w,t=this.x*this.x,n=this.y*this.y,r=this.z*this.z,i=180/Math.PI*Math.atan2(2*(this.y*this.z+this.x*this.w),-t-n+r+e),s=180/Math.PI*Math.asin(-2*(this.x*this.z-this.y*this.w)),o=180/Math.PI*Math.atan2(2*(this.x*this.y+this.z*this.w),t-n-r+e);return[i,s,o]},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new n.Quat(this.x,this.y,this.z,this.w)}},n.Quat.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)};var s=function(e,t){this.x=e||0,this.y=t||0};s.prototype={constructor:s,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,n){return n!==t?(console.warn("DEPRECATED: Vec2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,n)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,n){return n!==t?(console.warn("DEPRECATED: Vec2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,n)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},divideScalar:function(e){return e!==0?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e==null?!1:e.x===this.x&&e.y===this.y},clone:function(){return new s(this.x,this.y)}},n.Vec2=s;var o=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0};n.Vec3=o,o.prototype={set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},center:function(e,t){return this.x=(e.x+t.x)/2,this.y=(e.y+t.y)/2,this.z=(e.z+t.z)/2,this},copy:function(e){return(this==null||e==null)&&console.log("TGL.Vec3.copy this : "+this+" v : "+e),this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e){return(!this||!e)&&console.log("TGL.Vec3.add this : "+this+" v : "+e),this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return(!e||!t)&&console.log("TGL.Vec3.addVectors a : "+e+" b : "+t),this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},subVectors:function(e,t){return(e==null||t==null)&&console.log("null"),this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z,u=e.w,a=u*t+s*r-o*n,f=u*n+o*t-i*r,l=u*r+i*n-s*t,c=-i*t-s*n-o*r;return this.x=a*u+c*-i+f*-o-l*-s,this.y=f*u+c*-s+l*-i-a*-o,this.z=l*u+c*-o+a*-s-f*-i,this},applyEuler:function(e,t){var n=o.__q1.setFromEuler(e,t);return this.applyQuaternion(n),this},applyAxisAngle:function(e,t){var n=o.__q1.setFromAxisAngle(e,t);return this.applyQuaternion(n),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return e!==0?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e){var t=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-n*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(e){return Math.acos(this.dot(e)/this.length()/e.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,n){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.elements,s=i[0],o=i[4],u=i[8],a=i[1],f=i[5],l=i[9],c=i[2],h=i[6],p=i[10];return n===t||n==="XYZ"?(this.y=Math.asin(r(u)),Math.abs(u)<.99999?(this.x=Math.atan2(-l,p),this.z=Math.atan2(-o,s)):(this.x=Math.atan2(h,f),this.z=0)):n==="YXZ"?(this.x=Math.asin(-r(l)),Math.abs(l)<.99999?(this.y=Math.atan2(u,p),this.z=Math.atan2(a,f)):(this.y=Math.atan2(-c,s),this.z=0)):n==="ZXY"?(this.x=Math.asin(r(h)),Math.abs(h)<.99999?(this.y=Math.atan2(-c,p),this.z=Math.atan2(-o,f)):(this.y=0,this.z=Math.atan2(a,s))):n==="ZYX"?(this.y=Math.asin(-r(c)),Math.abs(c)<.99999?(this.x=Math.atan2(h,p),this.z=Math.atan2(a,s)):(this.x=0,this.z=Math.atan2(-o,f))):n==="YZX"?(this.z=Math.asin(r(a)),Math.abs(a)<.99999?(this.x=Math.atan2(-l,f),this.y=Math.atan2(-c,s)):(this.x=0,this.y=Math.atan2(u,p))):n==="XZY"&&(this.z=Math.asin(-r(o)),Math.abs(o)<.99999?(this.x=Math.atan2(h,f),this.y=Math.atan2(u,s)):(this.x=Math.atan2(-l,p),this.y=0)),this},setEulerFromQuaternion:function(e,n){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.x*e.x,s=e.y*e.y,o=e.z*e.z,u=e.w*e.w;return n===t||n==="XYZ"?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),u-i-s+o),this.y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),u+i-s-o)):n==="YXZ"?(this.x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),u-i-s+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),u-i+s-o)):n==="ZXY"?(this.x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),u-i-s+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),u-i+s-o)):n==="ZYX"?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),u-i-s+o),this.y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),u+i-s-o)):n==="YZX"?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),u-i+s-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),u+i-s-o),this.z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):n==="XZY"&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),u-i+s-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),u+i-s-o),this.z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this},toString:function(){return this.x+"_"+this.y+"_"+this.z},equals:function(e){return e==null?!1:e.x===this.x&&e.y===this.y&&e.z===this.z},clone:function(){return new o(this.x,this.y,this.z)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},rotateFromAxisAndCenter:function(e,t,r){var i=(new n.Mat4).makeRotationAxisAndCenter(e,t,r);return this.applyMatrix4(i),this},rotationTowards:function(e,t){var r=(new n.Mat4).rotationTowards(e,t);return this.setEulerFromRotationMatrix(r),this},constructor:n.Vec3},o.__q1=new n.Quat,n.Vec4=function(e,n,r,i){this.x=e||0,this.y=n||0,this.z=r||0,this.w=i!==t?i:1},n.Vec4.prototype={constructor:n.Vec4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==t?e.w:1,this},add:function(e,n){return n!==t?(console.warn("DEPRECATED: Vec4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,n)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,n){return n!==t?(console.warn("DEPRECATED: Vec4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,n)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i,this},divideScalar:function(e){return e!==0?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.x=0,this.y=0,this.z=0,this.w=1),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new n.Vec4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,s=.01,o=.1,u=e.elements,a=u[0],f=u[4],l=u[8],c=u[1],h=u[5],p=u[9],d=u[2],v=u[6],m=u[10];if(Math.abs(f-c)<s&&Math.abs(l-d)<s&&Math.abs(p-v)<s){if(Math.abs(f+c)<o&&Math.abs(l+d)<o&&Math.abs(p+v)<o&&Math.abs(a+h+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(a+1)/2,y=(h+1)/2,b=(m+1)/2,w=(f+c)/4,E=(l+d)/4,S=(p+v)/4;return g>y&&g>b?g<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(g),r=w/n,i=E/n):y>b?y<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(y),n=w/r,i=S/r):b<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(b),n=E/i,r=S/i),this.set(n,r,i,t),this}var x=Math.sqrt((v-p)*(v-p)+(l-d)*(l-d)+(c-f)*(c-f));return Math.abs(x)<.001&&(x=1),this.x=(v-p)/x,this.y=(l-d)/x,this.z=(c-f)/x,this.w=Math.acos((a+h+m-1)/2),this}};var f=function(e,n,r,i,s,o,u,a,f){this.elements=new Float32Array(9),this.set(e!==t?e:1,n||0,r||0,i||0,s!==t?s:1,o||0,u||0,a||0,f!==t?f:1)};f.prototype={constructor:f,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Mat3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new o;return function(t){for(var n=0,r=t.length;n<r;n+=3)e.x=t[n],e.y=t[n+1],e.z=t[n+2],e.applyMatrix3(this),t[n]=e.x,t[n+1]=e.y,t[n+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*s*f-t*o*a-n*i*f+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4];var i=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(i===0){var s="Mat3.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(s);return console.warn(s),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new f},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this}},n.Mat3=f;var l=function(e,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){this.elements=new Float32Array(16),this.set(e!==t?e:1,n||0,r||0,i||0,s||0,o!==t?o:1,u||0,a||0,f||0,l||0,c!==t?c:1,h||0,p||0,d||0,v||0,m!==t?m:1)};l.prototype={constructor:l,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},setRotationFromEuler:function(e,n){var r=this.elements,i=e.x,s=e.y,o=e.z,u=Math.cos(i),a=Math.sin(i),f=Math.cos(s),l=Math.sin(s),c=Math.cos(o),h=Math.sin(o);if(n===t||n==="XYZ"){var p=u*c,d=u*h,v=a*c,m=a*h;r[0]=f*c,r[4]=-f*h,r[8]=l,r[1]=d+v*l,r[5]=p-m*l,r[9]=-a*f,r[2]=m-p*l,r[6]=v+d*l,r[10]=u*f}else if(n==="YXZ"){var g=f*c,y=f*h,b=l*c,w=l*h;r[0]=g+w*a,r[4]=b*a-y,r[8]=u*l,r[1]=u*h,r[5]=u*c,r[9]=-a,r[2]=y*a-b,r[6]=w+g*a,r[10]=u*f}else if(n==="ZXY"){var g=f*c,y=f*h,b=l*c,w=l*h;r[0]=g-w*a,r[4]=-u*h,r[8]=b+y*a,r[1]=y+b*a,r[5]=u*c,r[9]=w-g*a,r[2]=-u*l,r[6]=a,r[10]=u*f}else if(n==="ZYX"){var p=u*c,d=u*h,v=a*c,m=a*h;r[0]=f*c,r[4]=v*l-d,r[8]=p*l+m,r[1]=f*h,r[5]=m*l+p,r[9]=d*l-v,r[2]=-l,r[6]=a*f,r[10]=u*f}else if(n==="YZX"){var E=u*f,S=u*l,x=a*f,T=a*l;r[0]=f*c,r[4]=T-E*h,r[8]=x*h+S,r[1]=h,r[5]=u*c,r[9]=-a*c,r[2]=-l*c,r[6]=S*h+x,r[10]=E-T*h}else if(n==="XZY"){var E=u*f,S=u*l,x=a*f,T=a*l;r[0]=f*c,r[4]=-h,r[8]=l*c,r[1]=E*h+T,r[5]=u*c,r[9]=S*h-x,r[2]=x*h-S,r[6]=a*c,r[10]=T*h+E}return this},setRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return t[0]=1-(h+d),t[4]=l-g,t[8]=c+m,t[1]=l+g,t[5]=1-(f+d),t[9]=p-v,t[2]=c-m,t[6]=p+v,t[10]=1-(f+h),this},lookAt:function(e,t,n){var r=this.elements,i=l.__v1,s=l.__v2,o=l.__v3;return o.subVectors(e,t).normalize(),o.length()===0&&(o.z=1),i.crossVectors(n,o).normalize(),i.length()===0&&(o.x+=1e-4,i.crossVectors(n,o).normalize()),s.crossVectors(o,i),r[0]=i.x,r[1]=i.y,r[2]=i.z,r[4]=s.x,r[5]=s.y,r[6]=s.z,r[8]=o.x,r[9]=o.y,r[10]=o.z,this},multiply:function(e,n){return n!==t?this.multiplyMatrices(e,n):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],w=n[15],E=r[0],S=r[4],x=r[8],T=r[12],N=r[1],C=r[5],k=r[9],L=r[13],A=r[2],O=r[6],M=r[10],_=r[14],D=r[3],P=r[7],H=r[11],B=r[15];return i[0]=s*E+o*N+u*A+a*D,i[4]=s*S+o*C+u*O+a*P,i[8]=s*x+o*k+u*M+a*H,i[12]=s*T+o*L+u*_+a*B,i[1]=f*E+l*N+c*A+h*D,i[5]=f*S+l*C+c*O+h*P,i[9]=f*x+l*k+c*M+h*H,i[13]=f*T+l*L+c*_+h*B,i[2]=p*E+d*N+v*A+m*D,i[6]=p*S+d*C+v*O+m*P,i[10]=p*x+d*k+v*M+m*H,i[14]=p*T+d*L+v*_+m*B,i[3]=g*E+y*N+b*A+w*D,i[7]=g*S+y*C+b*O+w*P,i[11]=g*x+y*k+b*M+w*H,i[15]=g*T+y*L+b*_+w*B,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return e.applyProjection(this)},multiplyVector4:function(e){return e.applyMatrix4(this)},multiplyVector3Array:function(e){var t=l.__v1;for(var n=0,r=e.length;n<r;n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],t.applyProjection(this),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e},rotateAxis:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return e.x=n*t[0]+r*t[4]+i*t[8],e.y=n*t[1]+r*t[5]+i*t[9],e.z=n*t[2]+r*t[6]+i*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,r=new n.Vector4;return r.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,r.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,r.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,r.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,r},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14],p=e[3],d=e[7],v=e[11],m=e[15];return p*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+d*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+v*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+m*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=this.elements;return(new o).set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return l.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return l.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return l.__v1.set(e[8],e[9],e[10])},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],b=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*b+f*d*b,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*b-s*d*b,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*b+s*l*b,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*b-a*d*b,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*b+i*d*b,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*b-i*l*b,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*b+a*p*b,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*b-i*p*b,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*b+i*f*b,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d;var w=r[0]*n[0]+r[1]*n[4]+r[2]*n[8]+r[3]*n[12];if(w==0){var E="Mat4.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(E);return console.warn(E),this.identity(),this}return this.multiplyScalar(1/w),this},compose:function(e,t,n){var r=this.elements,i=l.__m1,s=l.__m2;return i.identity(),i.setRotationFromQuaternion(t),s.makeScale(n.x,n.y,n.z),this.multiplyMatrices(i,s),r[12]=e.x,r[13]=e.y,r[14]=e.z,this},decompose:function(e,t,r){var i=this.elements,s=l.__v1,u=l.__v2,a=l.__v3;s.set(i[0],i[1],i[2]),u.set(i[4],i[5],i[6]),a.set(i[8],i[9],i[10]),e=e instanceof o?e:new o,t=t instanceof n.Quat?t:new n.Quat,r=r instanceof o?r:new o,r.x=s.length(),r.y=u.length(),r.z=a.length(),e.x=i[12],e.y=i[13],e.z=i[14];var f=l.__m1;return f.copy(this),f.elements[0]/=r.x,f.elements[1]/=r.x,f.elements[2]/=r.x,f.elements[4]/=r.y,f.elements[5]/=r.y,f.elements[6]/=r.y,f.elements[8]/=r.z,f.elements[9]/=r.z,f.elements[10]/=r.z,t.setFromRotationMatrix(f),[e,t,r]},extractPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractRotation:function(e){var t=this.elements,n=e.elements,r=l.__v1,i=1/r.set(n[0],n[1],n[2]).length(),s=1/r.set(n[4],n[5],n[6]).length(),o=1/r.set(n[8],n[9],n[10]).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,this},translate:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[12]=t[0]*n+t[4]*r+t[8]*i+t[12],t[13]=t[1]*n+t[5]*r+t[9]*i+t[13],t[14]=t[2]*n+t[6]*r+t[10]*i+t[14],t[15]=t[3]*n+t[7]*r+t[11]*i+t[15],this},rotateX:function(e){var t=this.elements,n=t[4],r=t[5],i=t[6],s=t[7],o=t[8],u=t[9],a=t[10],f=t[11],l=Math.cos(e),c=Math.sin(e);return t[4]=l*n+c*o,t[5]=l*r+c*u,t[6]=l*i+c*a,t[7]=l*s+c*f,t[8]=l*o-c*n,t[9]=l*u-c*r,t[10]=l*a-c*i,t[11]=l*f-c*s,this},rotateY:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[8],u=t[9],a=t[10],f=t[11],l=Math.cos(e),c=Math.sin(e);return t[0]=l*n-c*o,t[1]=l*r-c*u,t[2]=l*i-c*a,t[3]=l*s-c*f,t[8]=l*o+c*n,t[9]=l*u+c*r,t[10]=l*a+c*i,t[11]=l*f+c*s,this},rotateZ:function(e){var t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=Math.cos(e),c=Math.sin(e);return t[0]=l*n+c*o,t[1]=l*r+c*u,t[2]=l*i+c*a,t[3]=l*s+c*f,t[4]=l*o-c*n,t[5]=l*u-c*r,t[6]=l*a-c*i,t[7]=l*f-c*s,this},rotateByAxis:function(e,t){var n=this.elements;if(e.x===1&&e.y===0&&e.z===0)return this.rotateX(t);if(e.x===0&&e.y===1&&e.z===0)return this.rotateY(t);if(e.x===0&&e.y===0&&e.z===1)return this.rotateZ(t);var r=e.x,i=e.y,s=e.z,o=Math.sqrt(r*r+i*i+s*s);r/=o,i/=o,s/=o;var u=r*r,a=i*i,f=s*s,l=Math.cos(t),c=Math.sin(t),h=1-l,p=r*i*h,d=r*s*h,v=i*s*h,m=r*c,g=i*c,y=s*c,b=u+(1-u)*l,w=p+y,E=d-g,S=p-y,x=a+(1-a)*l,T=v+m,N=d+g,C=v-m,k=f+(1-f)*l,L=n[0],A=n[1],O=n[2],M=n[3],_=n[4],D=n[5],P=n[6],H=n[7],B=n[8],j=n[9],F=n[10],I=n[11],q=n[12],R=n[13],U=n[14],z=n[15];return n[0]=b*L+w*_+E*B,n[1]=b*A+w*D+E*j,n[2]=b*O+w*P+E*F,n[3]=b*M+w*H+E*I,n[4]=S*L+x*_+T*B,n[5]=S*A+x*D+T*j,n[6]=S*O+x*P+T*F,n[7]=S*M+x*H+T*I,n[8]=N*L+C*_+k*B,n[9]=N*A+C*D+k*j,n[10]=N*O+C*P+k*F,n[11]=N*M+C*H+k*I,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,r)))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeFrustum:function(e,t,n,r,i,s){var o=this.elements,u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return o[0]=u,o[4]=0,o[8]=f,o[12]=0,o[1]=0,o[5]=a,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,r,i){var s=r*Math.tan(n.Math.degToRad(e*.5)),o=-s,u=o*t,a=s*t;return this.makeFrustum(u,a,o,s,r,i)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i,l=(t+e)/u,c=(n+r)/a,h=(s+i)/f;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2/a,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var e=this.elements;return new l(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return t[0]=1-(h+d),t[4]=l-g,t[8]=c+m,t[1]=l+g,t[5]=1-(f+d),t[9]=p-v,t[2]=c-m,t[6]=p+v,t[10]=1-(f+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},getEulerAngles:function(){var e=(new l).extractRotation(this).elements,t=e[0],n=e[1],r=e[2],i=e[5],s=e[6],u=e[10],a=Math.atan2(s,u),f=Math.atan2(-r,Math.sqrt(t*t+n*n)),c=Math.sin(a),h=Math.cos(a),p=Math.atan2(c*e[8]-h*e[4],h*i-c*e[9]);return new o(a,f,p)},makeRotationAxisAndCenter:function(e,t,n){var r=Math.cos(t),i=Math.sin(t),s=1-r,o=e.x,u=e.y,a=e.z,f=s*o,l=s*u,c=n.x,h=n.y,p=n.z,d=this,v=new Float32Array(16);return v[0]=f*o+r,v[4]=f*u-i*a,v[8]=f*a+i*u,v[12]=c-c*(f*o+r)-h*(f*u-i*a)-p*(f*a+i*u),v[1]=f*u+i*a,v[5]=l*u+r,v[9]=l*a-i*o,v[13]=h-c*(f*u+i*a)-h*(l*u+r)-p*(l*a-i*o),v[2]=f*a-i*u,v[6]=l*a+i*o,v[10]=s*a*a+r,v[14]=p-c*(f*a-i*u)-h*(l*a+i*o)-p*(s*a*a+r),v[3]=0,v[7]=0,v[11]=0,v[15]=1,d.elements=v,d},rotationTowards:function(e,t){var r=Math.acos(t.dot(e)/t.length()/e.length()),i=(new n.Vec3).crossVectors(t,e).normalize();return this.makeRotationAxis(i,-r),this},equals:function(e){if(e instanceof l){for(var t=0;t<this.elements.length;t++)if(Math.abs(this.elements[t]-e.elements[t])>1e-4)return!1;return!0}}},l.__v1=new o,l.__v2=new o,l.__v3=new o,l.__m1=new l,l.__m2=new l,n.Mat4=l,n.Euler=function(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||n.Euler.DefaultOrder},n.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],n.Euler.DefaultOrder="XYZ",n.Euler.prototype={constructor:n.Euler,_x:0,_y:0,_z:0,_order:n.Euler.DefaultOrder,_quaternion:t,_updateQuaternion:function(){this._quaternion!==t&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,i=r[0],s=r[4],o=r[8],u=r[1],a=r[5],f=r[9],l=r[2],c=r[6],h=r[10];return t=t||this._order,t==="XYZ"?(this._y=Math.asin(n(o)),Math.abs(o)<.99999?(this._x=Math.atan2(-f,h),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(c,a),this._z=0)):t==="YXZ"?(this._x=Math.asin(-n(f)),Math.abs(f)<.99999?(this._y=Math.atan2(o,h),this._z=Math.atan2(u,a)):(this._y=Math.atan2(-l,i),this._z=0)):t==="ZXY"?(this._x=Math.asin(n(c)),Math.abs(c)<.99999?(this._y=Math.atan2(-l,h),this._z=Math.atan2(-s,a)):(this._y=0,this._z=Math.atan2(u,i))):t==="ZYX"?(this._y=Math.asin(-n(l)),Math.abs(l)<.99999?(this._x=Math.atan2(c,h),this._z=Math.atan2(u,i)):(this._x=0,this._z=Math.atan2(-s,a))):t==="YZX"?(this._z=Math.asin(n(u)),Math.abs(u)<.99999?(this._x=Math.atan2(-f,a),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(o,h))):t==="XZY"?(this._z=Math.asin(-n(s)),Math.abs(s)<.99999?(this._x=Math.atan2(c,a),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-f,h),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,n){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.x*e.x,s=e.y*e.y,o=e.z*e.z,u=e.w*e.w;return t=t||this._order,t==="XYZ"?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),u-i-s+o),this._y=Math.asin(r(2*(e.x*e.z+e.y*
e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u+i-s-o)):t==="YXZ"?(this._x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u-i-s+o),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u-i+s-o)):t==="ZXY"?(this._x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),u-i-s+o),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u-i+s-o)):t==="ZYX"?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),u-i-s+o),this._y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u+i-s-o)):t==="YZX"?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),u-i+s-o),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),u+i-s-o),this._z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):t==="XZY"?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),u-i+s-o),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u+i-s-o),this._z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,n!==!1&&this._updateQuaternion(),this},reorder:function(){var e=new n.Quat;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==t&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new n.Euler(this._x,this._y,this._z,this._order)}},n.math={},n.math.Plane=function(e,n){this.normal=e!==t?e:new o(1,0,0),this.constant=n!==t?n:0},n.math.Plane.prototype={constructor:n.math.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,r){var i=n.math.Plane.__v1.subVectors(r,t).cross(n.math.Plane.__v2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e),r=t||new o;return r.copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e,t){var n=this.distanceToPoint(e),r=this.distanceToPoint(t);return n<0&&r>0||r<0&&n>0},isIntersectionFace:function(e,t){var n=[];n.push(t[e.a]),n.push(t[e.b]),n.push(t[e.c]),e.d!=null&&n.push(t[e.d]);var r=[],i,s,o;for(i=0;i<n.length;i++)r.push(this.distanceToPoint(n[i]));for(i=0;i<r.length;i++)if(i==0)s=o=r[i];else{o=r[i];if(s<0&&o>0||o<0&&s>0)return"intersect";s=o}return o>0?"in":"out"},intersectLine:function(e,r,i){var s=i||new o,u=n.math.Plane.__v1.subVectors(r,e),a=this.normal.dot(u);if(a==0)return this.distanceToPoint(e)==0?s.copy(e):t;var f=-(e.dot(this.normal)+this.constant)/a;return f<0||f>1?t:s.copy(u).multiplyScalar(f).add(e)},coplanarPoint:function(e){var t=e||new o;return t.copy(this.normal).multiplyScalar(-this.constant)},transform:function(e,t){t=t||(new n.Mat3).getInverse(e).transpose();var r=n.math.Plane.__v1.copy(this.normal).applyMatrix3(t),i=this.coplanarPoint(n.math.Plane.__v2);return i.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(r,i),this},translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new n.math.Plane).copy(this)}},n.math.Plane.__vZero=new o(0,0,0),n.math.Plane.__v1=new o,n.math.Plane.__v2=new o,n.Frustum=function(e,r,i,s,o,u){this.planes=[e!==t?e:new n.math.Plane,r!==t?r:new n.math.Plane,i!==t?i:new n.math.Plane,s!==t?s:new n.math.Plane,o!==t?o:new n.math.Plane,u!==t?u:new n.math.Plane]},n.Frustum.prototype={set:function(e,t,n,r,i,s){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},setPoints:function(e){this.points=e},copy:function(e){var t=this.planes;for(var n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l=n[7],c=n[8],h=n[9],p=n[10],d=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,l-u,d-c,y-v).normalize(),t[1].setComponents(o+r,l+u,d+c,y+v).normalize(),t[2].setComponents(o+i,l+a,d+h,y+m).normalize(),t[3].setComponents(o-i,l-a,d-h,y-m).normalize(),t[4].setComponents(o-s,l-f,d-p,y-g).normalize(),t[5].setComponents(o+s,l+f,d+p,y+g).normalize(),this},intersectsObjectAccurate:function(e,t){if(t==0)return this.intersectsObject(e);var r=e.worldMatrix,i=this.planes,s=e.vertices,o=[],u,a,f=s.length;for(a=0;a<f;a++){u=s[a].clone(),u.applyMatrix4(r),o.push(u);if(this.containsPoint(u))return!0}if(t==2)if(e instanceof n.Line)for(a=0,f=o.length;a<f-1;a++){var l=o[a],c=o[a+1];if(this.containsLine(l,c))return!0}else{var h=e.faces,p,d,v,m,g,y;for(a=0,f=h.length;a<f;a++){p=h[a];if(this.containsLine(o[p.a],o[p.b]))return!0;if(this.containsLine(o[p.b],o[p.c]))return!0;if(p.d!=null){if(this.containsLine(o[p.c],o[p.d]))return!0;if(this.containsLine(o[p.d],o[p.a]))return!0}else if(this.containsLine(o[p.a],o[p.c]))return!0}}return!1},intersectsObject:function(e){var t=e.worldMatrix,n=this.planes,r=t.getPosition();if(!e.computeBoundingSphere)return!1;e.boundingSphere||e.computeBoundingSphere();var i=-e.boundingSphere.radius*t.getMaxScaleOnAxis();for(var s=0;s<6;s++){var o=n[s].distanceToPoint(r);if(o<i)return!1}return!0},intersectsSphere:function(e){var t=this.planes,n=e.center,r=-e.radius;for(var i=0;i<6;i++){var s=t[i].distanceToPoint(n);if(s<r)return!1}return!0},intersectsBox:function(e){var t=new o,n=new o,r=this.planes;for(var i=0;i<6;i++){var s=r[i];t.x=s.normal.x>0?e.min.x:e.max.x,n.x=s.normal.x>0?e.max.x:e.min.x,t.y=s.normal.y>0?e.min.y:e.max.y,n.y=s.normal.y>0?e.max.y:e.min.y,t.z=s.normal.z>0?e.min.z:e.max.z,n.z=s.normal.z>0?e.max.z:e.min.z;var u=s.distanceToPoint(t),a=s.distanceToPoint(n);if(u<0&&a<0)return!1}return!0},containsLine:function(e,t){var n=this.planes,r=new o;for(var i=0;i<6;i++){r=n[i].intersectLine(e,t,r);if(r&&this.containsPoint(r))return!0}return!1},containsPoint:function(e){var t=this.planes;for(var n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new n.Frustum).copy(this)}},n.Ray=function(e,n){this.origin=e!==t?e:new o,this.direction=n!==t?n:new o},n.Ray.prototype={constructor:n.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var n=t||new o;return n.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(e){return this.origin.copy(this.at(e,n.Ray.__v1)),this},closestPointToPoint:function(e,t){var n=t||new o;n.subVectors(e,this.origin);var r=n.dot(this.direction);return n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){var t=n.Ray.__v1.subVectors(e,this.origin).dot(this.direction);return n.Ray.__v1.copy(this.direction).multiplyScalar(t).add(this.origin),n.Ray.__v1.distanceTo(e)},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.normal.dot(this.direction);return t!=0?!0:e.distanceToPoint(this.origin)==0?!0:!1},distanceToPlane:function(e){var n=e.normal.dot(this.direction);if(n==0)return e.distanceToPoint(this.origin)==0?0:t;var r=-(this.origin.dot(e.normal)+e.constant)/n;return r},intersectPlane:function(e,n){var r=this.distanceToPlane(e);return r===t?t:this.at(r,n)},transform:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},distanceSqToSegment:function(e,t,n,r){var i=e.clone().add(t).multiplyScalar(.5),s=t.clone().sub(e).normalize(),o=e.distanceTo(t)*.5,u=this.origin.clone().sub(i),a=-this.direction.dot(s),f=u.dot(this.direction),l=-u.dot(s),c=u.lengthSq(),h=Math.abs(1-a*a),p,d,v,m;if(h>=0){p=a*l-f,d=a*f-l,m=o*h;if(p>=0)if(d>=-m)if(d<=m){var g=1/h;p*=g,d*=g,v=p*(p+a*d+2*f)+d*(a*p+d+2*l)+c}else d=o,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;else d=-o,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;else d<=-m?(p=Math.max(0,-(-a*o+f)),d=p>0?-o:Math.min(Math.max(-o,-l),o),v=-p*p+d*(d+2*l)+c):d<=m?(p=0,d=Math.min(Math.max(-o,-l),o),v=d*(d+2*l)+c):(p=Math.max(0,-(a*o+f)),d=p>0?o:Math.min(Math.max(-o,-l),o),v=-p*p+d*(d+2*l)+c)}else d=a>0?-o:o,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;return n&&n.copy(this.direction.clone().multiplyScalar(p).add(this.origin)),r&&r.copy(s.clone().multiplyScalar(d).add(i)),v},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new n.Ray).copy(this)}},n.Ray.__v1=new o,n.Ray.__v2=new o,n.Triangle=function(e,n,r){this.a=e!==t?e:new o,this.b=n!==t?n:new o,this.c=r!==t?r:new o},n.Triangle.normal=function(e,t,r,i){var s=i||new o;s.subVectors(r,t),n.Triangle.__v0.subVectors(e,t),s.cross(n.Triangle.__v0);var u=s.lengthSq();return u>0?s.multiplyScalar(1/Math.sqrt(u)):s.set(0,0,0)},n.Triangle.barycoordFromPoint=function(e,t,r,i,s){n.Triangle.__v0.subVectors(i,t),n.Triangle.__v1.subVectors(r,t),n.Triangle.__v2.subVectors(e,t);var u=n.Triangle.__v0.dot(n.Triangle.__v0),a=n.Triangle.__v0.dot(n.Triangle.__v1),f=n.Triangle.__v0.dot(n.Triangle.__v2),l=n.Triangle.__v1.dot(n.Triangle.__v1),c=n.Triangle.__v1.dot(n.Triangle.__v2),h=u*l-a*a,p=s||new o;if(h==0)return p.set(-2,-1,-1);var d=1/h,v=(l*f-a*c)*d,m=(u*c-a*f)*d;return p.set(1-v-m,m,v)},n.Triangle.containsPoint=function(e,t,r,i){var s=n.Triangle.barycoordFromPoint(e,t,r,i,n.Triangle.__v3);return s.x>=0&&s.y>=0&&s.x+s.y<=1},n.Triangle.prototype={constructor:n.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){return n.Triangle.__v0.subVectors(this.c,this.b),n.Triangle.__v1.subVectors(this.a,this.b),n.Triangle.__v0.cross(n.Triangle.__v1).length()*.5},midpoint:function(e){var t=e||new o;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return n.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new n.math.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return n.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return n.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new n.Triangle).copy(this)},intersectLine:function(e,t){var n=this.plane(),r=n.intersectLine(e,t);return r!=null&&this.containsPoint(r)}},n.Triangle.__v0=new o,n.Triangle.__v1=new o,n.Triangle.__v2=new o,n.Triangle.__v3=new o,$html={getLogicalPoint:function(e,t){var n,r=e.getBoundingClientRect();if(h.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var i=t.changedTouches[0],s=h.isAndroid?0:$touch.scrollLeft(),o=h.isAndroid?0:$touch.scrollTop();n={x:i.clientX+e.scrollLeft-r.left-s,y:i.clientY+e.scrollTop-r.top-o}}else{if(!$html.isValidEvent(e,t))return null;n={x:t.clientX-r.left+e.scrollLeft,y:t.clientY-r.top+e.scrollTop}}return n},isValidEvent:function(e,t){if(!t)return!1;if(t.target===e)if(h.isFirefox){if(e.clientHeight<e.scrollHeight&&t.layerX<25)return!1;if(e.clientWidth<e.scrollWidth&&t.layerY<25)return!1}else if(t.offsetX>e.clientWidth||t.offsetY>e.clientHeight)return!1;return!0},isImage:function(e){return e&&e.nodeName&&e.nodeName.toLowerCase()==="img"},isCanvas:function(e){return e&&e.nodeName&&e.nodeName.toLowerCase()==="canvas"},createView:function(e,t){var n=document.createElement("div");return n.style.position=A.VIEW_POSITION,n.style.fontSize=A.VIEW_FONT_SIZE,n.style.fontFamily=A.VIEW_FONT_FAMILY,n.style.cursor="default",n.style.outline="none",n.style.textAlign="left",n.style.msTouchAction="none",n.tabIndex=0,t||(n.onmousedown=$html.preventDefault),n.style.setProperty&&(n.style.setProperty("-khtml-user-select","none",null),n.style.setProperty("-webkit-user-select","none",null),n.style.setProperty("-moz-user-select","none",null),n.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),e&&(n.style.overflow=e),n},preventDefault:function(e){if(A.KEEP_DEFAULT_FUNCTION(e))return;e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1},createCanvas:function(e){var t=document.createElement("canvas"),n=e.getView();return t.width=n.width,t.height=n.height,t.style.msTouchAction="none",t.style.position="absolute",t},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},getScrollTop:function(e){if(!e)return 0;var t=e.scrollTop,n=e.parentElement;return t+this.getScrollTop(n)},getScrollLeft:function(e){if(!e)return 0;var t=e.scrollLeft,n=e.parentElement;return t+this.getScrollLeft(n)},debug:function(e,t){try{e.call(t)}catch(n){alert(n)}},setFocus:function(e){if(document.activeElement===e)return;var t,n,r=document.documentElement,i=document.body,s;r&&(h.isIE||h.isOpera||r.scrollLeft||r.scrollTop)&&(t=r.scrollLeft,n=r.scrollTop,s=r),e.focus(),s&&(s.scrollLeft=t,s.scrollTop=n)},isRightClick:function(t){var n;if(!t)var t=e.event;return t.which?n=t.which==3:t.button&&(n=t.button==2),n}},n.html=$html;var h=function(){var e={},t=navigator.userAgent.toLowerCase();return e.isOpera=/opera/.test(t),e.isIE=/msie/.test(t)||/trident/.test(t),e.isFirefox=/firefox/i.test(t),e.isChrome=/chrome/i.test(t),e.isSafari=!e.isChrome&&/safari/i.test(t),e.isIPhone=/iphone/.test(t),e.isIPod=/ipod/.test(t),e.isIPad=/ipad/.test(t),e.isAndroid=/android/i.test(t),e.isWebOS=/webos/i.test(t),e.isMSToucheable=navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>1,e.isTouchable="ontouchend"in document||e.isMSToucheable,e.isIOS=e.isIPhone||e.isIPod||e.isIPad,e}();n.ua=h,function(){function r(e){var n,r,i,s,o,u;i=e.length,r=0,n="";while(r<i){s=e.charCodeAt(r++)&255;if(r==i){n+=t.charAt(s>>2),n+=t.charAt((s&3)<<4),n+="==";break}o=e.charCodeAt(r++);if(r==i){n+=t.charAt(s>>2),n+=t.charAt((s&3)<<4|(o&240)>>4),n+=t.charAt((o&15)<<2),n+="=";break}u=e.charCodeAt(r++),n+=t.charAt(s>>2),n+=t.charAt((s&3)<<4|(o&240)>>4),n+=t.charAt((o&15)<<2|(u&192)>>6),n+=t.charAt(u&63)}return n}function i(e){var t,r,i,s,o,u,a;u=e.length,o=0,a="";while(o<u){do t=n[e.charCodeAt(o++)&255];while(o<u&&t==-1);if(t==-1)break;do r=n[e.charCodeAt(o++)&255];while(o<u&&r==-1);if(r==-1)break;a+=String.fromCharCode(t<<2|(r&48)>>4);do{i=e.charCodeAt(o++)&255;if(i==61)return a;i=n[i]}while(o<u&&i==-1);if(i==-1)break;a+=String.fromCharCode((r&15)<<4|(i&60)>>2);do{s=e.charCodeAt(o++)&255;if(s==61)return a;s=n[s]}while(o<u&&s==-1);if(s==-1)break;a+=String.fromCharCode((i&3)<<6|s)}return a}var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);e.btoa||(e.btoa=r),e.atob||(e.atob=i)}();var p=function(){var t=!1,n=document.createElement("canvas");n.getContext("2d")&&(t=!0);if(!t)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var r=!!n.getContext("2d").getImageData,i=!!n.toDataURL,s=!!e.btoa,o="image/octet-stream",u=function(e){var t=parseInt(e.width),n=parseInt(e.height);return e.getContext("2d").getImageData(0,0,t,n)},a=function(e){var t="";if(typeof e=="string")t=e;else{var n=e;for(var r=0;r<n.length;r++)t+=String.fromCharCode(n[r])}return btoa(t)},f=function(e){var t=[],n=e.width,r=e.height;t.push(66),t.push(77);var i=n*r*3+54;t.push(i%256),i=Math.floor(i/256),t.push(i%256),i=Math.floor(i/256),t.push(i%256),i=Math.floor(i/256),t.push(i%256),t.push(0),t.push(0),t.push(0),t.push(0),t.push(54),t.push(0),t.push(0),t.push(0);var s=[];s.push(40),s.push(0),s.push(0),s.push(0);var o=n;s.push(o%256),o=Math.floor(o/256),s.push(o%256),o=Math.floor(o/256),s.push(o%256),o=Math.floor(o/256),s.push(o%256);var u=r;s.push(u%256),u=Math.floor(u/256),s.push(u%256),u=Math.floor(u/256),s.push(u%256),u=Math.floor(u/256),s.push(u%256),s.push(1),s.push(0),s.push(24),s.push(0),s.push(0),s.push(0),s.push(0),s.push(0);var f=n*r*3;s.push(f%256),f=Math.floor(f/256),s.push(f%256),f=Math.floor(f/256),s.push(f%256),f=Math.floor(f/256),s.push(f%256);for(var l=0;l<16;l++)s.push(0);var c=(4-n*3%4)%4,h=e.data,p="",d=r;do{var v=n*(d-1)*4,m="";for(var g=0;g<n;g++){var y=4*g;m+=String.fromCharCode(h[v+y+2]),m+=String.fromCharCode(h[v+y+1]),m+=String.fromCharCode(h[v+y])}for(var b=0;b<c;b++)m+=String.fromCharCode(0);p+=m}while(--d);var w=a(t.concat(s))+a(p);return w},l=function(e,t){return"data:"+t+";base64,"+e},c=function(e){var t=document.createElement("img");return t.src=e,t},h=function(e,t,n,r,i){n=n||(t?t.w:e.width),r=r||(t?t.h:e.height);var s=document.createElement("canvas");s.width=n,s.height=r,s.style.width=n+"px",s.style.height=r+"px";var o=s.getContext("2d"),o=s.getContext("2d"),u=e.style.backgroundColor;return u||(i==="PNG"?u="rgba(255,255,255,0.0)":i==="BMP"?u="rgba(255,255,255,0.01)":u="#FFFFFF"),o.fillStyle=u,o.fillRect(0,0,n,r),t=t?t:{x:0,y:0,w:e.width,h:e.height},o.drawImage(e,t.x,t.y,t.w,t.h,0,0,n,r),s};return{saveAsPNG:function(e,t,n,r,s){if(!i)return!1;var o=h(e,t,r,s,"PNG"),u=o.toDataURL("image/png");return n?c(u):u},saveAsJPEG:function(e,t,n,r,s){if(!i)return!1;var o=h(e,t,r,s,"JPEG"),u="image/jpeg",a=o.toDataURL(u);return a.indexOf(u)!=5?!1:n?c(a):a},saveAsBMP:function(e,t,n,i,o){if(!r||!s)return!1;var a=h(e,t,i,o,"BMP"),p=u(a),d=f(p);return n?c(l(d,"image/bmp")):l(d,"image/bmp")}}}();_tgl={};var d={cache:{},g:document.createElement("canvas").getContext("2d"),getTextSize:function(e,t){d.g.font=e?e:A.FONT;var n=d.cache[d.g.font];return n||(n=d.g.measureText("e").width*2+4,d.cache[d.g.font]=n),{width:d.g.measureText(t).width+4,height:n}}};_tgl.g=d,n.g=d;var g={},y=setTimeout;g.bcld=function(e,t,n,r,i,u,a,f,l){var c=e/2,h,p,d=[],v=[],m={vertices:[],faces:[],uvs:[],uv2s:[]};for(p=0;p<=t;p++){var g=[],y=[],b=p/t,w=b*(n-r)+r;for(h=0;h<=i;h++){var E=h/i,S=new o;S.x=w*Math.sin(E*f+l),S.y=-b*e+c,S.z=w*Math.cos(E*f+l),m.vertices.push(S),g.push(m.vertices.length-1),y.push(new s(E,1-b))}d.push(g),v.push(y)}var x=(n-r)/e,T,N;for(h=0;h<i;h++){r!==0?(T=m.vertices[d[0][h]].clone(),N=m.vertices[d[0][h+1]].clone()):(T=m.vertices[d[1][h]].clone(),N=m.vertices[d[1][h+1]].clone()),T.setY(Math.sqrt(T.x*T.x+T.z*T.z)*x).normalize(),N.setY(Math.sqrt(N.x*N.x+N.z*N.z)*x).normalize();for(p=0;p<t;p++){var k=d[p][h],L=d[p+1][h],A=d[p+1][h+1],O=d[p][h+1],M=T.clone(),_=T.clone(),D=N.clone(),P=N.clone(),H=v[p][h].clone(),B=v[p+1][h].clone(),j=v[p+1][h+1].clone(),F=v[p][h+1].clone();m.faces.push(new C(k,L,O,[M,_,P],null,0)),m.uvs.push([H,B,F]),m.uv2s.push([H.clone(),B.clone(),F.clone()]),m.faces.push(new C(L,A,O,[_,D,P],null,0)),m.uvs.push([B,j,F]),m.uv2s.push([B.clone(),j.clone(),F.clone()])}}var I=!1;if(u===!1&&r>0){m.vertices.push(new o(0,c,0)),I=!0;for(h=0;h<i;h++){var k=d[0][h],L=d[0][h+1],A=m.vertices.length-1,M=new o(0,1,0),_=new o(0,1,0),D=new o(0,1,0),q=m.vertices[k],R=m.vertices[L],H=new s((q.x/r+1)/2,1-(q.z/r+1)/2),B=new s((R.x/r+1)/2,1-(R.z/r+1)/2),j=new s(.5,.5);m.faces.push(new C(k,L,A,[M,_,D],null,1)),m.uvs.push([H,B,j]),m.uv2s.push([H.clone(),B.clone(),j.clone()])}}var U=!1;if(a===!1&&n>0){m.vertices.push(new o(0,-c,0)),U=!0;for(h=0;h<i;h++){var k=d[p][h+1],L=d[p][h],A=m.vertices.length-1,M=new o(0,-1,0),_=new o(0,-1,0),D=new o(0,-1,0),q=m.vertices[k],R=m.vertices[L],H=new s((q.x/n+1)/2,(q.z/n+1)/2),B=new s((R.x/n+1)/2,(R.z/n+1)/2),j=new s(.5,.5);m.faces.push(new C(k,L,A,[M,_,D],null,2)),m.uvs.push([H,B,j]),m.uv2s.push([H.clone(),B.clone(),j.clone()])}}if(f!==Math.PI*2){!I&&m.vertices.push(new o(0,c,0)),!U&&m.vertices.push(new o(0,-c,0));var k=d[0][0],L=d[t][0],A=m.vertices.length-1,O=m.vertices.length-2,H=new s(0,0),B=new s(0,1),j=new s(1,1),F=new s(1,0);m.faces.push(new C(k,A,L)),m.uvs.push([H,j,B]),m.uv2s.push([H.clone(),j.clone(),B.clone()]),m.faces.push(new C(O,A,k)),m.uvs.push([F,j,H]),m.uv2s.push([F.clone(),j.clone(),H.clone()]),k=d[0][i],L=d[t][i];var H=new s(0,0),B=new s(0,1),j=new s(1,1),F=new s(1,0);m.faces.push(new C(k,L,O)),m.uvs.push([H,B,F]),m.uv2s.push([H.clone(),B.clone(),F.clone()]),m.faces.push(new C(L,A,O)),m.uvs.push([B,j,F]),m.uv2s.push([B.clone(),j.clone(),F.clone()])}return m},g.buildCubeData=function(e,t,n,r,i,u,a,f){function v(v){var m,g,y,b,w,E,S,x,T,N;l=c.length;var C,L=a=="six-each"||a=="front-other"||a=="back-other"||a=="left-other"||a=="right-other"||a=="top-other"||a=="bottom-other",A=new s(0,0),O=L?new s(1/3,.5):new s(1,1),M=a.split("-")[0];M=="six"?M=null:O=new s(.5,1),v=="right"?(m="z",g="y",y="x",b=-1,w=-1,E=e/2,S=n,x=t,T=u,N=i,C=0,A=new s(2/3,0)):v=="left"?(m="z",g="y",y="x",b=1,w=-1,E=-e/2,S=n,x=t,T=u,N=i,C=1):v=="top"?(m="x",g="z",y="y",b=1,w=1,E=t/2,S=e,x=n,T=r,N=u,C=2,A=new s(1/3,.5)):v=="bottom"?(m="x",g="z",y="y",b=1,w=-1,E=-t/2,S=e,x=n,T=r,N=u,C=3,A=new s(0,.5)):v=="front"?(m="x",g="y",y="z",b=1,w=-1,E=n/2,S=e,x=t,T=r,N=i,C=4,A=new s(1/3,0)):v=="back"&&(m="x",g="y",y="z",b=-1,w=-1,E=-n/2,S=e,x=t,T=r,N=i,C=5,A=new s(2/3,.5)),M&&(M==v?A=new s(0,0):A=new s(.5,0));var _,D,P=T+1,H=N+1;for(D=0;D<H;D++)for(_=0;_<P;_++){var B=new o;B[m]=(_/T*S-S/2)*b+f[m],B[g]=(D/N*x-x/2)*w+f[g],B[y]=E+f[y],c.push(B)}L&&(C=0);var j=new o;j[y]=E>0?1:-1;for(D=0;D<N;D++)for(_=0;_<T;_++){var F=_+P*D,I=_+P*(D+1),q=_+1+P*(D+1),R=_+1+P*D,U=[new s(_/T,1-D/N),new s(_/T,1-(D+1)/N),new s((_+1)/T,1-(D+1)/N),new s((_+1)/T,1-D/N)];if(L)for(var z=0;z<U.length;z++)U[z].multiply(O).add(A);var W=new k(F+l,I+l,q+l,R+l);W.normal.copy(j),W.vertexNormals.push(j.clone(),j.clone(),j.clone(),j.clone()),W.materialIndex=C,h.push(W),p.push([U[0],U[1],U[2],U[3]]),d.push([U[0].clone(),U[1].clone(),U[2].clone(),U[3].clone()])}}var l,c=[],h=[],p=[],d=[];v("right"),v("left"),v("top"),v("bottom"),v("front"),v("back");var m={vertices:c,faces:h,uvs:p,uv2s:d};return m},g.bsd=function(e,t,n,r,i,u,a){var f,l,c=[],h=[],p=[],d=[],v=[],m=[];for(l=0;l<=n;l++){var g=[],y=[];for(f=0;f<=t;f++){var b=f/t,w=l/n,E=new o;E.x=-e*Math.cos(r+b*i)*Math.sin(u+w*a),E.y=e*Math.cos(u+w*a),E.z=e*Math.sin(r+b*i)*Math.sin(u+w*a),c.push(E),g.push(c.length-1),y.push(new s(b,1-w))}v.push(g),m.push(y)}for(l=0;l<n;l++)for(f=0;f<t;f++){var S=v[l][f+1],x=v[l][f],T=v[l+1][f],N=v[l+1][f+1],k=c[S].clone().normalize(),L=c[x].clone().normalize(),A=c[T].clone().normalize(),O=c[N].clone().normalize(),M=m[l][f+1].clone(),_=m[l][f].clone(),D=m[l+1][f].clone(),P=m[l+1][f+1].clone();Math.abs(c[S].y)===e?(p.push(new C(S,T,N,[k,A,O])),h.push([M,D,P]),d.push([M.clone(),D.clone(),P.clone()])):Math.abs(c[T].y)===e?(p.push(new C(S,x,T,[k,L,A])),h.push([M,_,D]),d.push([M.clone(),_.clone(),D.clone()])):(p.push(new C(S,x,N,[k,L,O])),h.push([M,_,P]),d.push([M.clone(),_.clone(),P.clone()]),p.push(new C(x,T,N,[L.clone(),A,O.clone()])),h.push([_.clone(),D,P.clone()]),d.push([_.clone(),D.clone(),P.clone()]))}return{vertices:c,faces:p,uvs:h,uv2s:d}};var w=function(e){var r,i,s,o,u,a,f,l={},c=e.primitive;if(c.groups){e.groups=c.groups,e.groupList=c.groupList;return}c.groups={};var h=e.material,p=e.getMaterialMapping();for(r=0,i=c.faces.length;r<i;r++)s=c.faces[r],o=h instanceof n.ArrayMaterial?s.materialIndex:0,o=p[o],o==null,a=o!==t?o:-1,l[a]===t&&(l[a]={hash:a,counter:0}),f=l[a].hash+"_"+l[a].counter,c.groups[f]===t&&(c.groups[f]={faces3:[],faces4:[],materialIndex:o,vertices:0}),u=s instanceof C?3:4,c.groups[f].vertices+u>65535&&(l[a].counter+=1,f=l[a].hash+"_"+l[a].counter,c.groups[f]===t&&(c.groups[f]={faces3:[],faces4:[],materialIndex:o,vertices:0})),s instanceof C?c.groups[f].faces3.push(r):c.groups[f].faces4.push(r),c.groups[f].vertices+=u;c.groupsList=[];for(var d in e.groups)c.groupsList.push(e.groups[d]);e.groups=c.groups,e.groupList=c.groupsList},E=function(e,n,r,i){var s,o,u,a,f,l,c=e,h=c,p=h.vertices,d=p.length,v=h.colors,m=v.length,g=i.__vertexArray,y=i.__colorArray,b=i.__sortArray,w=h.verticesNeedUpdate,E=h.elementsNeedUpdate,S=h.colorsNeedUpdate,x=h.__webglCustomAttributesList,T,N,C,k,L,A,O;if(c.sortParticles){_projScreenMatrixPS.copy(_projScreenMatrix),_projScreenMatrixPS.multiply(c.matrixWorld);for(s=0;s<d;s++)u=p[s],_vector3.copy(u),_vector3.applyProjection(_projScreenMatrixPS),b[s]=[_vector3.z,s];b.sort(numericalSort);for(s=0;s<d;s++)u=p[b[s][1]],a=s*3,g[a]=u.x,g[a+1]=u.y,g[a+2]=u.z;for(o=0;o<m;o++)a=o*3,l=v[b[o][1]],y[a]=l.r,y[a+1]=l.g,y[a+2]=l.b;if(x)for(T=0,N=x.length;T<N;T++){O=x[T];if(O.boundTo!==t&&O.boundTo!=="vertices")continue;a=0,L=O.value.length;if(O.size===1)for(k=0;k<L;k++)f=b[k][1],O.array[k]=O.value[f];else if(O.size===2)for(k=0;k<L;k++)f=b[k][1],A=O.value[f],O.array[a]=A.x,O.array[a+1]=A.y,a+=2;else if(O.size===3)if(O.type==="c")for(k=0;k<L;k++)f=b[k][1],A=O.value[f],O.array[a]=A.r,O.array[a+1]=A.g,O.array[a+2]=A.b,a+=3;else for(k=0;k<L;k++)f=b[k][1],A=O.value[f],O.array[a]=A.x,O.array[a+1]=A.y,O.array[a+2]=A.z,a+=3;else if(O.size===4)for(k=0;k<L;k++)f=b[k][1],A=O.value[f],O.array[a]=A.x,O.array[a+1]=A.y,O.array[a+2]=A.z,O.array[a+3]=A.w,a+=4}}else{if(w)for(s=0;s<d;s++)u=p[s],a=s*3,g[a]=u.x,g[a+1]=u.y,g[a+2]=u.z;if(S)for(o=0;o<m;o++)l=v[o],a=o*3,y[a]=l.r,y[a+1]=l.g,y[a+2]=l.b;if(x)for(T=0,N=x.length;T<N;T++){O=x[T];if(O.needsUpdate&&(O.boundTo===t||O.boundTo==="vertices")){L=O.value.length,a=0;if(O.size===1)for(k=0;k<L;k++)O.array[k]=O.value[k];else if(O.size===2)for(k=0;k<L;k++)A=O.value[k],O.array[a]=A.x,O.array[a+1]=A.y,a+=2;else if(O.size===3)if(O.type==="c")for(k=0;k<L;k++)A=O.value[k],O.array[a]=A.r,O.array[a+1]=A.g,O.array[a+2]=A.b,a+=3;else for(k=0;k<L;k++)A=O.value[k],O.array[a]=A.x,O.array[a+1]=A.y,O.array[a+2]=A.z,a+=3;else if(O.size===4)for(k=0;k<L;k++)A=O.value[k],O.array[a]=A.x,O.array[a+1]=A.y,O.array[a+2]=A.z,O.array[a+3]=A.w,a+=4}}}if(w||c.sortParticles)r.bindBuffer(r.ARRAY_BUFFER,i.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,g,n);if(S||c.sortParticles)r.bindBuffer(r.ARRAY_BUFFER,i.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,y,n);if(x)for(T=0,N=x.length;T<N;T++){O=x[T];if(O.needsUpdate||c.sortParticles)r.bindBuffer(r.ARRAY_BUFFER,O.buffer),r.bufferData(r.ARRAY_BUFFER,O.array,n)}};g.buildGroupBufferData=function(e,r,i,s,o,u,a,f){var l=o._type=="basic"?!1:!0,c=o.isVertexColor(),h=o.needUV(),p=f.needSmoothNormal(r,o),d,v,m,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt=0,wt=0,Et=0,St=0,xt=0,Tt=0,Nt=0,Ct=0,kt=0,Lt=0,At=0,Ot=0,Mt=0,_t,Dt=a.__vertexArray,Pt=a.__uvArray,Ht=a.__uv2Array,Bt=a.__normalArray,jt=a.__colorArray,Ft=a.__webglCustomAttributesList,It,qt=a.__faceArray,Rt=a.__lineArray,Ut=r,zt=Ut.verticesNeedUpdate,Wt=Ut.elementsNeedUpdate,Xt=Ut.uvsNeedUpdate,Vt=Ut.normalsNeedUpdate,$t=Ut.tangentsNeedUpdate,Jt=Ut.colorsNeedUpdate,Kt=Ut.morphTargetsNeedUpdate,Qt=Ut.vertices,Gt=e.faces3,Yt=e.faces4,Zt=Ut.faces,en=Ut.uvs,tn=Ut.uv2s,nn=Ut.colors,rn=Ut.skinIndices,sn=Ut.skinWeights,on=Ut.morphTargets,un=Ut.morphNormals;if(zt){for(d=0,v=Gt.length;d<v;d++)y=Zt[Gt[d]],k=Qt[y.a],L=Qt[y.b],A=Qt[y.c],Dt[wt]=k.x,Dt[wt+1]=k.y,Dt[wt+2]=k.z,Dt[wt+3]=L.x,Dt[wt+4]=L.y,Dt[wt+5]=L.z,Dt[wt+6]=A.x,Dt[wt+7]=A.y,Dt[wt+8]=A.z,wt+=9;for(d=0,v=Yt.length;d<v;d++)y=Zt[Yt[d]],k=Qt[y.a],L=Qt[y.b],A=Qt[y.c],O=Qt[y.d],Dt[wt]=k.x,Dt[wt+1]=k.y,Dt[wt+2]=k.z,Dt[wt+3]=L.x,Dt[wt+4]=L.y,Dt[wt+5]=L.z,Dt[wt+6]=A.x,Dt[wt+7]=A.y,Dt[wt+8]=A.z,Dt[wt+9]=O.x,Dt[wt+10]=O.y,Dt[wt+11]=O.z,wt+=12;u.bindBuffer(u.ARRAY_BUFFER,a.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,Dt,i),a.__vertexArray=Dt}if(Jt&&c){for(d=0,v=Gt.length;d<v;d++)y=Zt[Gt[d]],S=y.vertexColors,x=y.color,S.length===3&&c===n.VertexColors?(I=S[0],q=S[1],R=S[2]):(I=x,q=x,R=x),jt[kt]=I.r,jt[kt+1]=I.g,jt[kt+2]=I.b,jt[kt+3]=q.r,jt[kt+4]=q.g,jt[kt+5]=q.b,jt[kt+6]=R.r,jt[kt+7]=R.g,jt[kt+8]=R.b,kt+=9;for(d=0,v=Yt.length;d<v;d++)y=Zt[Yt[d]],S=y.vertexColors,x=y.color,S.length===4&&c===n.VertexColors?(I=S[0],q=S[1],R=S[2],U=S[3]):(I=x,q=x,R=x,U=x),jt[kt]=I.r,jt[kt+1]=I.g,jt[kt+2]=I.b,jt[kt+3]=q.r,jt[kt+4]=q.g,jt[kt+5]=q.b,jt[kt+6]=R.r,jt[kt+7]=R.g,jt[kt+8]=R.b,jt[kt+9]=U.r,jt[kt+10]=U.g,jt[kt+11]=U.b,kt+=12;kt>0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,jt,i))}if(Vt&&l){for(d=0,v=Gt.length;d<v;d++){y=Zt[Gt[d]],b=y.vertexNormals,w=y.normal;if(b.length===3&&p)for(ut=0;ut<3;ut++)ft=b[ut],Bt[Tt]=ft.x,Bt[Tt+1]=ft.y,Bt[Tt+2]=ft.z,Tt+=3;else for(ut=0;ut<3;ut++)Bt[Tt]=w.x,Bt[Tt+1]=w.y,Bt[Tt+2]=w.z,Tt+=3}for(d=0,v=Yt.length;d<v;d++){y=Zt[Yt[d]],b=y.vertexNormals,w=y.normal;if(b.length===4&&p)for(ut=0;ut<4;ut++)ft=b[ut],Bt==null&&console.log("normal array is null"),Bt[Tt]=ft.x,Bt[Tt+1]=ft.y,Bt[Tt+2]=ft.z,Tt+=3;else for(ut=0;ut<4;ut++)Bt[Tt]=w.x,Bt[Tt+1]=w.y,Bt[Tt+2]=w.z,Tt+=3}u.bindBuffer(u.ARRAY_BUFFER,a.__webglNormalBuffer),u.bufferData(u.ARRAY_BUFFER,Bt,i),a.__normalArray=Bt}if(Xt&&en&&h){for(d=0,v=Gt.length;d<v;d++){m=Gt[d],N=en[m];if(N===t)continue;for(ut=0;ut<3;ut++)lt=N[ut],Pt[Et]=lt.x,Pt[Et+1]=lt.y,Et+=2}for(d=0,v=Yt.length;d<v;d++){m=Yt[d],N=en[m];if(N===t)continue;for(ut=0;ut<4;ut++)lt=N[ut],Pt[Et]=lt.x,Pt[Et+1]=lt.y,Et+=2}Et>0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglUVBuffer),u.bufferData(u.ARRAY_BUFFER,Pt,i),a.uvArray=Pt)}if(Xt&&tn&&h){for(d=0,v=Gt.length;d<v;d++){m=Gt[d],C=tn[m];if(C===t)continue;for(ut=0;ut<3;ut++)ct=C[ut],Ht[St]=ct.x,Ht[St+1]=ct.y,St+=2}for(d=0,v=Yt.length;d<v;d++){m=Yt[d],C=tn[m];if(C===t)continue;for(ut=0;ut<4;ut++)ct=C[ut],Ht[St]=ct.x,Ht[St+1]=ct.y,St+=2}St>0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglUV2Buffer),u.bufferData(u.ARRAY_BUFFER,Ht,i))}if(Wt){for(d=0,v=Gt.length;d<v;d++)qt[xt]=bt,qt[xt+1]=bt+1,qt[xt+2]=bt+2,xt+=3,Rt[Ct]=bt,Rt[Ct+1]=bt+1,Rt[Ct+2]=bt,Rt[Ct+3]=bt+2,Rt[Ct+4]=bt+1,Rt[Ct+5]=bt+2,Ct+=6,bt+=3;for(d=0,v=Yt.length;d<v;d++)qt[xt]=bt,qt[xt+1]=bt+1,qt[xt+2]=bt+3,qt[xt+3]=bt+1,qt[xt+4]=bt+2,qt[xt+5]=bt+3,xt+=6,Rt[Ct]=bt,Rt[Ct+1]=bt+1,Rt[Ct+2]=bt,Rt[Ct+3]=bt+3,Rt[Ct+4]=bt+1,Rt[Ct+5]=bt+2,Rt[Ct+6]=bt+2,Rt[Ct+7]=bt+3,Ct+=8,bt+=4;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,qt,i),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,Rt,i),a.__lineArray=Rt}if(Ft)for(ut=0,at=Ft.length;ut<at;ut++){It=Ft[ut];if(!It.__original.needsUpdate)continue;Ot=0,Mt=0;if(It.size===1){if(It.boundTo===t||It.boundTo==="vertices"){for(d=0,v=Gt.length;d<v;d++)y=Zt[Gt[d]],It.array[Ot]=It.value[y.a],It.array[Ot+1]=It.value[y.b],It.array[Ot+2]=It.value[y.c],Ot+=3;for(d=0,v=Yt.length;d<v;d++)y=Zt[Yt[d]],It.array[Ot]=It.value[y.a],It.array[Ot+1]=It.value[y.b],It.array[Ot+2]=It.value[y.c],It.array[Ot+3]=It.value[y.d],Ot+=4}else if(It.boundTo==="faces"){for(d=0,v=Gt.length;d<v;d++)_t=It.value[Gt[d]],It.array[Ot]=_t,It.array[Ot+1]=_t,It.array[Ot+2]=_t,Ot+=3;for(d=0,v=Yt.length;d<v;d++)_t=It.value[Yt[d]],It.array[Ot]=_t,It.array[Ot+1]=_t,It.array[Ot+2]=_t,It.array[Ot+3]=_t,Ot+=4}}else if(It.size===2){if(It.boundTo===t||It.boundTo==="vertices"){for(d=0,v=Gt.length;d<v;d++)y=Zt[Gt[d]],k=It.value[y.a],L=It.value[y.b],A=It.value[y.c],It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=L.x,It.array[Ot+3]=L.y,It.array[Ot+4]=A.x,It.array[Ot+5]=A.y,Ot+=6;for(d=0,v=Yt.length;d<v;d++)y=Zt[Yt[d]],k=It.value[y.a],L=It.value[y.b],A=It.value[y.c],O=It.value[y.d],It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=L.x,It.array[Ot+3]=L.y,It.array[Ot+4]=A.x,It.array[Ot+5]=A.y,It.array[Ot+6]=O.x,It.array[Ot+7]=O.y,Ot+=8}else if(It.boundTo==="faces"){for(d=0,v=Gt.length;d<v;d++)_t=It.value[Gt[d]],k=_t,L=_t,A=_t,It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=L.x,It.array[Ot+3]=L.y,It.array[Ot+4]=A.x,It.array[Ot+5]=A.y,Ot+=6;for(d=0,v=Yt.length;d<v;d++)_t=It.value[Yt[d]],k=_t,L=_t,A=_t,O=_t,It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=L.x,It.array[Ot+3]=L.y,It.array[Ot+4]=A.x,It.array[Ot+5]=A.y,It.array[Ot+6]=O.x,It.array[Ot+7]=O.y,Ot+=8}}else if(It.size===3){var an;It.type==="c"?an=["r","g","b"]:an=["x","y","z"];if(It.boundTo===t||It.boundTo==="vertices"){for(d=0,v=Gt.length;d<v;d++)y=Zt[Gt[d]],k=It.value[y.a],L=It.value[y.b],A=It.value[y.c],It.array[Ot]=k[an[0]],It.array[Ot+1]=k[an[1]],It.array[Ot+2]=k[an[2]],It.array
[Ot+3]=L[an[0]],It.array[Ot+4]=L[an[1]],It.array[Ot+5]=L[an[2]],It.array[Ot+6]=A[an[0]],It.array[Ot+7]=A[an[1]],It.array[Ot+8]=A[an[2]],Ot+=9;for(d=0,v=Yt.length;d<v;d++)y=Zt[Yt[d]],k=It.value[y.a],L=It.value[y.b],A=It.value[y.c],O=It.value[y.d],It.array[Ot]=k[an[0]],It.array[Ot+1]=k[an[1]],It.array[Ot+2]=k[an[2]],It.array[Ot+3]=L[an[0]],It.array[Ot+4]=L[an[1]],It.array[Ot+5]=L[an[2]],It.array[Ot+6]=A[an[0]],It.array[Ot+7]=A[an[1]],It.array[Ot+8]=A[an[2]],It.array[Ot+9]=O[an[0]],It.array[Ot+10]=O[an[1]],It.array[Ot+11]=O[an[2]],Ot+=12}else if(It.boundTo==="faces"){for(d=0,v=Gt.length;d<v;d++)_t=It.value[Gt[d]],k=_t,L=_t,A=_t,It.array[Ot]=k[an[0]],It.array[Ot+1]=k[an[1]],It.array[Ot+2]=k[an[2]],It.array[Ot+3]=L[an[0]],It.array[Ot+4]=L[an[1]],It.array[Ot+5]=L[an[2]],It.array[Ot+6]=A[an[0]],It.array[Ot+7]=A[an[1]],It.array[Ot+8]=A[an[2]],Ot+=9;for(d=0,v=Yt.length;d<v;d++)_t=It.value[Yt[d]],k=_t,L=_t,A=_t,O=_t,It.array[Ot]=k[an[0]],It.array[Ot+1]=k[an[1]],It.array[Ot+2]=k[an[2]],It.array[Ot+3]=L[an[0]],It.array[Ot+4]=L[an[1]],It.array[Ot+5]=L[an[2]],It.array[Ot+6]=A[an[0]],It.array[Ot+7]=A[an[1]],It.array[Ot+8]=A[an[2]],It.array[Ot+9]=O[an[0]],It.array[Ot+10]=O[an[1]],It.array[Ot+11]=O[an[2]],Ot+=12}else if(It.boundTo==="faceVertices"){for(d=0,v=Gt.length;d<v;d++)_t=It.value[Gt[d]],k=_t[0],L=_t[1],A=_t[2],It.array[Ot]=k[an[0]],It.array[Ot+1]=k[an[1]],It.array[Ot+2]=k[an[2]],It.array[Ot+3]=L[an[0]],It.array[Ot+4]=L[an[1]],It.array[Ot+5]=L[an[2]],It.array[Ot+6]=A[an[0]],It.array[Ot+7]=A[an[1]],It.array[Ot+8]=A[an[2]],Ot+=9;for(d=0,v=Yt.length;d<v;d++)_t=It.value[Yt[d]],k=_t[0],L=_t[1],A=_t[2],O=_t[3],It.array[Ot]=k[an[0]],It.array[Ot+1]=k[an[1]],It.array[Ot+2]=k[an[2]],It.array[Ot+3]=L[an[0]],It.array[Ot+4]=L[an[1]],It.array[Ot+5]=L[an[2]],It.array[Ot+6]=A[an[0]],It.array[Ot+7]=A[an[1]],It.array[Ot+8]=A[an[2]],It.array[Ot+9]=O[an[0]],It.array[Ot+10]=O[an[1]],It.array[Ot+11]=O[an[2]],Ot+=12}}else if(It.size===4)if(It.boundTo===t||It.boundTo==="vertices"){for(d=0,v=Gt.length;d<v;d++)y=Zt[Gt[d]],k=It.value[y.a],L=It.value[y.b],A=It.value[y.c],It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=k.z,It.array[Ot+3]=k.w,It.array[Ot+4]=L.x,It.array[Ot+5]=L.y,It.array[Ot+6]=L.z,It.array[Ot+7]=L.w,It.array[Ot+8]=A.x,It.array[Ot+9]=A.y,It.array[Ot+10]=A.z,It.array[Ot+11]=A.w,Ot+=12;for(d=0,v=Yt.length;d<v;d++)y=Zt[Yt[d]],k=It.value[y.a],L=It.value[y.b],A=It.value[y.c],O=It.value[y.d],It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=k.z,It.array[Ot+3]=k.w,It.array[Ot+4]=L.x,It.array[Ot+5]=L.y,It.array[Ot+6]=L.z,It.array[Ot+7]=L.w,It.array[Ot+8]=A.x,It.array[Ot+9]=A.y,It.array[Ot+10]=A.z,It.array[Ot+11]=A.w,It.array[Ot+12]=O.x,It.array[Ot+13]=O.y,It.array[Ot+14]=O.z,It.array[Ot+15]=O.w,Ot+=16}else if(It.boundTo==="faces"){for(d=0,v=Gt.length;d<v;d++)_t=It.value[Gt[d]],k=_t,L=_t,A=_t,It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=k.z,It.array[Ot+3]=k.w,It.array[Ot+4]=L.x,It.array[Ot+5]=L.y,It.array[Ot+6]=L.z,It.array[Ot+7]=L.w,It.array[Ot+8]=A.x,It.array[Ot+9]=A.y,It.array[Ot+10]=A.z,It.array[Ot+11]=A.w,Ot+=12;for(d=0,v=Yt.length;d<v;d++)_t=It.value[Yt[d]],k=_t,L=_t,A=_t,O=_t,It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=k.z,It.array[Ot+3]=k.w,It.array[Ot+4]=L.x,It.array[Ot+5]=L.y,It.array[Ot+6]=L.z,It.array[Ot+7]=L.w,It.array[Ot+8]=A.x,It.array[Ot+9]=A.y,It.array[Ot+10]=A.z,It.array[Ot+11]=A.w,It.array[Ot+12]=O.x,It.array[Ot+13]=O.y,It.array[Ot+14]=O.z,It.array[Ot+15]=O.w,Ot+=16}else if(It.boundTo==="faceVertices"){for(d=0,v=Gt.length;d<v;d++)_t=It.value[Gt[d]],k=_t[0],L=_t[1],A=_t[2],It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=k.z,It.array[Ot+3]=k.w,It.array[Ot+4]=L.x,It.array[Ot+5]=L.y,It.array[Ot+6]=L.z,It.array[Ot+7]=L.w,It.array[Ot+8]=A.x,It.array[Ot+9]=A.y,It.array[Ot+10]=A.z,It.array[Ot+11]=A.w,Ot+=12;for(d=0,v=Yt.length;d<v;d++)_t=It.value[Yt[d]],k=_t[0],L=_t[1],A=_t[2],O=_t[3],It.array[Ot]=k.x,It.array[Ot+1]=k.y,It.array[Ot+2]=k.z,It.array[Ot+3]=k.w,It.array[Ot+4]=L.x,It.array[Ot+5]=L.y,It.array[Ot+6]=L.z,It.array[Ot+7]=L.w,It.array[Ot+8]=A.x,It.array[Ot+9]=A.y,It.array[Ot+10]=A.z,It.array[Ot+11]=A.w,It.array[Ot+12]=O.x,It.array[Ot+13]=O.y,It.array[Ot+14]=O.z,It.array[Ot+15]=O.w,Ot+=16}u.bindBuffer(u.ARRAY_BUFFER,It.buffer),u.bufferData(u.ARRAY_BUFFER,It.array,i)}s&&g.deleteGroupBufferData(e)},g.buildLineBufferData=function(e,n,r,i){var s,o,u,a,f,l,c=e,h=c.vertices,p=c.colors,d=c.lineDistances,v=h.length,m=p.length,g=d.length,y=i.__vertexArray,b=i.__colorArray,w=i.__lineDistanceArray,E=c.verticesNeedUpdate,S=c.colorsNeedUpdate,x=c.lineDistancesNeedUpdate,T=c.__webglCustomAttributesList,N,C,k,L,A,O,M;if(E){for(s=0;s<v;s++)a=h[s],f=s*3,y[f]=a.x,y[f+1]=a.y,y[f+2]=a.z;r.bindBuffer(r.ARRAY_BUFFER,i.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,y,n)}if(S){for(o=0;o<m;o++)l=p[o],f=o*3,b[f]=l.r,b[f+1]=l.g,b[f+2]=l.b;r.bindBuffer(r.ARRAY_BUFFER,i.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,b,n)}if(x){for(u=0;u<g;u++)w[u]=d[u];r.bindBuffer(r.ARRAY_BUFFER,i.__webglLineDistanceBuffer),r.bufferData(r.ARRAY_BUFFER,w,n)}if(T)for(N=0,C=T.length;N<C;N++){M=T[N];if(M.needsUpdate&&(M.boundTo===t||M.boundTo==="vertices")){f=0,A=M.value.length;if(M.size===1)for(L=0;L<A;L++)M.array[L]=M.value[L];else if(M.size===2)for(L=0;L<A;L++)O=M.value[L],M.array[f]=O.x,M.array[f+1]=O.y,f+=2;else if(M.size===3)if(M.type==="c")for(L=0;L<A;L++)O=M.value[L],M.array[f]=O.r,M.array[f+1]=O.g,M.array[f+2]=O.b,f+=3;else for(L=0;L<A;L++)O=M.value[L],M.array[f]=O.x,M.array[f+1]=O.y,M.array[f+2]=O.z,f+=3;else if(M.size===4)for(L=0;L<A;L++)O=M.value[L],M.array[f]=O.x,M.array[f+1]=O.y,M.array[f+2]=O.z,M.array[f+3]=O.w,f+=4;r.bindBuffer(r.ARRAY_BUFFER,M.buffer),r.bufferData(r.ARRAY_BUFFER,M.array,n)}}},g.buildLineBufferData=function(e,n,r,i){var s,o,u,a,f,l,c=e,h=c.vertices,p=c.colors,d=c.lineDistances,v=h.length,m=p.length,g=d.length,y=i.__vertexArray,b=i.__colorArray,w=i.__lineDistanceArray,E=c.verticesNeedUpdate,S=c.colorsNeedUpdate,x=c.lineDistancesNeedUpdate,T=c.__webglCustomAttributesList,N,C,k,L,A,O,M;if(E){for(s=0;s<v;s++)a=h[s],f=s*3,y[f]=a.x,y[f+1]=a.y,y[f+2]=a.z;r.bindBuffer(r.ARRAY_BUFFER,i.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,y,n)}if(S){for(o=0;o<m;o++)l=p[o],f=o*3,b[f]=l.r,b[f+1]=l.g,b[f+2]=l.b;r.bindBuffer(r.ARRAY_BUFFER,i.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,b,n)}if(x){for(u=0;u<g;u++)w[u]=d[u];r.bindBuffer(r.ARRAY_BUFFER,i.__webglLineDistanceBuffer),r.bufferData(r.ARRAY_BUFFER,w,n)}if(T)for(N=0,C=T.length;N<C;N++){M=T[N];if(M.needsUpdate&&(M.boundTo===t||M.boundTo==="vertices")){f=0,A=M.value.length;if(M.size===1)for(L=0;L<A;L++)M.array[L]=M.value[L];else if(M.size===2)for(L=0;L<A;L++)O=M.value[L],M.array[f]=O.x,M.array[f+1]=O.y,f+=2;else if(M.size===3)if(M.type==="c")for(L=0;L<A;L++)O=M.value[L],M.array[f]=O.r,M.array[f+1]=O.g,M.array[f+2]=O.b,f+=3;else for(L=0;L<A;L++)O=M.value[L],M.array[f]=O.x,M.array[f+1]=O.y,M.array[f+2]=O.z,f+=3;else if(M.size===4)for(L=0;L<A;L++)O=M.value[L],M.array[f]=O.x,M.array[f+1]=O.y,M.array[f+2]=O.z,M.array[f+3]=O.w,f+=4;r.bindBuffer(r.ARRAY_BUFFER,M.buffer),r.bufferData(r.ARRAY_BUFFER,M.array,n)}}},g.deleteGroupBufferData=function(e){delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray},g.getMaterial=function(e,t){var r=e.material;return r instanceof n.ArrayMaterial?(t>r.materials.length-1&&(t=r.materials.length-1),r.materials[t]):r},n.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),n=this;n.faces[t]=n.faces[t]||{},n.faces[t][e.cssFontWeight]=n.faces[t][e.cssFontWeight]||{},n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;var r=n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t=[],r=[],i,s,o=this.getFace(),u=this.size/o.resolution,a=0,f=String(e).split(""),l=f.length,c=[];for(i=0;i<l;i++){var h=new n.Path,p=this.extractGlyphPoints(f[i],o,u,a,h);a+=p.offset,c.push(p.path)}var d=a/2,v,m,g;for(i=0;i<l;i++){var h=c[i];for(g=0;g<h.actions.length;g++){var v=h.actions[g].args;for(m=0;m<v.length;m++)m%3===0&&(v[m]-=d)}}return{paths:c,offset:d}},extractGlyphPoints:function(e,t,r,i,s,o){var u=[],a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k=t.glyphs[e]||t.glyphs["?"],L=0;if(!k)return;if(k.o){c=k._cachedOutline||(k._cachedOutline=k.o.split(" ")),p=c.length,d=r,v=r;for(a=0;a<p;){h=c[a++];switch(h){case"m":m=c[a++]*d+i,g=c[a++]*v-L,s.moveTo(m,g,0);break;case"l":m=c[a++]*d+i,g=c[a++]*v-L,s.lineTo(m,g,0);break;case"q":y=c[a++]*d+i,b=c[a++]*v-L,S=c[a++]*d+i,x=c[a++]*v-L,s.quadraticCurveTo(S,x,0,y,b,0),C=u[u.length-1];if(C){w=C.x,E=C.y;for(f=1,l=this.divisions;f<=l;f++)var A=f/l,O=n.Shape.Utils.b2(A,w,S,y),M=n.Shape.Utils.b2(A,E,x,b)}break;case"b":y=c[a++]*d+i,b=c[a++]*v-L,S=c[a++]*d+i,x=c[a++]*-v-L,T=c[a++]*d+i,N=c[a++]*-v-L,s.bezierCurveTo(y,b,0,S,x,0,T,N,0),C=u[u.length-1];if(C){w=C.x,E=C.y;for(f=1,l=this.divisions;f<=l;f++)var A=f/l,O=n.Shape.Utils.b3(A,w,S,T,y),M=n.Shape.Utils.b3(A,E,x,N,b)}}}}return{offset:k.ha*r,path:s}}},n.FontUtils.generateShapes=function(e,r){r=r||{};var i=r.size!==t?r.size:100,s=r.curveSegments!==t?r.curveSegments:4,o=r.font!==t?r.font:"helvetiker",u=r.weight!==t?r.weight:"normal",a=r.style!==t?r.style:"normal";n.FontUtils.size=i,n.FontUtils.divisions=s,n.FontUtils.face=o,n.FontUtils.weight=u,n.FontUtils.style=a;var f=n.FontUtils.drawText(e),l=f.paths,c=[];for(var h=0,p=l.length;h<p;h++)Array.prototype.push.apply(c,l[h].toShapes());return c},function(e){var t=1e-10,n=function(e,t){var n=e.length;if(n<3)return null;var s=[],o=[],u=[],a,f,l;if(r(e)>0)for(f=0;f<n;f++)o[f]=f;else for(f=0;f<n;f++)o[f]=n-1-f;var c=n,h=2*c;for(f=c-1;c>2;){if(h--<=0)return console.log("Warning, unable to triangulate polygon!"),t?u:s;a=f,c<=a&&(a=0),f=a+1,c<=f&&(f=0),l=f+1,c<=l&&(l=0);if(i(e,a,f,l,c,o)){var p,d,v,m,g;p=o[a],d=o[f],v=o[l],s.push([e[p],e[d],e[v]]),u.push([o[a],o[f],o[l]]);for(m=f,g=f+1;g<c;m++,g++)o[m]=o[g];c--,h=2*c}}return t?u:s},r=function(e){var t=e.length,n=0;for(var r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return n*.5},i=function(e,n,r,i,s,o){var u,a,f,l,c,h,p,d,v;a=e[o[n]].x,f=e[o[n]].y,l=e[o[r]].x,c=e[o[r]].y,h=e[o[i]].x,p=e[o[i]].y;if(t>(l-a)*(p-f)-(c-f)*(h-a))return!1;var m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;m=h-l,g=p-c,y=a-h,b=f-p,w=l-a,E=c-f;for(u=0;u<s;u++){if(u===n||u===r||u===i)continue;d=e[o[u]].x,v=e[o[u]].y,S=d-a,x=v-f,T=d-l,N=v-c,C=d-h,k=v-p,O=m*N-g*T,L=w*x-E*S,A=y*k-b*C;if(O>=-t&&A>=-t&&L>=-t)return!1}return!0};return e.Triangulate=n,e.Triangulate.area=r,e}(n.FontUtils),self._typeface_js={faces:n.FontUtils.faces,loadFace:n.FontUtils.loadFace},n.typeface_js=self._typeface_js;var S=function(){this._as=[];if(arguments.length===1){var e=arguments[0];e instanceof S&&(e=e._as);if(e instanceof Array){var t=e.length;for(var n=0;n<t;n++)this._as.push(e[n])}else e!=null&&this._as.push(e)}else if(arguments.length>1){t=arguments.length;for(n=0;n<t;n++)this._as.push(arguments[n])}};n.List=S,n.extend(n.List,Object,{size:function(){return this._as.length},isEmpty:function(){return this._as.length===0},add:function(e,n){return n===t?this._as.push(e):this._as.splice(n,0,e)},addAll:function(e){e instanceof S&&(e=e._as);if(e instanceof Array){var t=e.length;for(var n=0;n<t;n++)this._as.push(e[n])}else this._as.push(e)},get:function(e){return this._as[e]},remove:function(e){var t=this._as.indexOf(e);return t>=0&&t<this._as.length&&this.removeAt(t),t},removeAt:function(e){return this._as.splice(e,1)[0]},set:function(e,t){return this._as[e]=t},clear:function(){return this._as.splice(0,this._as.length)},contains:function(e){return this.indexOf(e)>=0},indexOf:function(e){return this._as.indexOf(e)},forEach:function(e,t){var n=this._as.length;for(var r=0;r<n;r++){var i=this._as[r];t?e.call(t,i):e(i)}},forEachReverse:function(e,t){var n=this._as.length;for(var r=n-1;r>=0;r--){var i=this._as[r];t?e.call(t,i):e(i)}},toArray:function(e,t){if(e){var n=[],r=this._as.length;for(var i=0;i<r;i++){var s=this._as[i];t?e.call(t,s)&&n.push(s):e(s)&&n.push(s)}return n}return this._as.concat()},toList:function(e,t){if(e){var n=new S,r=this._as.length;for(var i=0;i<r;i++){var s=this._as[i];t?e.call(t,s)&&n.add(s):e(s)&&n.add(s)}return n}return new S(this)},sort:function(e){return e?this._as.sort(e):this._as.sort(),this},toString:function(){return this._as.toString()}}),n.ImageCache=function(){};var x=n.ImageCache;x.AlarmBillboardImage=new Image,x.AlarmBillboardImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE0AAABrCAYAAAAy/A+bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAABoKSURBVHja3F17jFxXff7O4z7n6fXa3uw6TuI81KiYFhRIpKA2iVBBaUNRvQlxSloQpNSiKaUgolR1wBRKCrRNWilIkIQKFSIcLw0EQitEmgImJXJL3ZgQk7h1nX16Z3fnPfd9+8fec3PmzJ31PmY3gSNdzezOzH189/f4fo9zLonjGFljYmICWzhyAC4GcAkAC8A2ACYAB4ALoA1gHsAUgDMA/M0+of379/f9jGPrRw7ArwG4lhDyRsbYaxljuwghIIQAAOI47novXpMtiKLohSiKfhzH8b8D+FcAJ7fyArYKtBKAmwkhN2uadh1jTBegyMD0AalrI4RwSumVjLEroyi6LfnuZBiGXwdwBMD3ft5Bu4YQ8j5N025hjNmU0hQQSmkqTYQQRFGEKIq6fkwI6ZI68XcYhoiiCGEYin3tZoy9H8D7oyh6Po7jhwE8BGDx5wm06wkhh0zTvF6AE8cxGGMpaEEQdF14lrTJ4KnvCSHQdR2UUvi+jyAIEAQBOOe/RCn9dBzHh4IgeIAx9jcAzr2aQXsNIeTvDcO4jnOeXhylFHEcpxcXRVGXyp1v9ANRSCYhBJxz6LqOMAzhui4AFDjndwG4MwzDexljnwXQeTWBVgDwSV3XD+q6zgGk6hcEAVzXTSVKVUEB4GqHAEzcCPE/oeKEENi2jTAM0el0AMDmnH88iqJ3x3H8x4yxb74aQLuGMfaPhmFcyhhLL0BIlbA/MmDiYsMwhOd56XdkAMV3BfhCYiml0DQNmqZ1qaqwl7IdzOVyCMMQzWYTjLFLOOePB0HwBUrpBymlrVcCNALgz3Rd/5iu61zYLN/34XleFwiyOnqeB9/34fs+wjBEu92G4zjodDpwXTcFOgxDiJvAGIOmaTBNE5ZlIZfLwTAMUErBOYdhGOCcd0mhDF6xWITrunAcB5zzOwgh14dh+DuMsWe3EjSLEPJF0zTfwRhL77LjOPB9vwcsoaK+78N1XSwtLaFWq6FaraYqtZYRxzEsy0KhUMD27dtRKBRS6TNNMwVLgEcpha7r0DQN9XodYRhepmnaD+M4fifn/OtbAdp2Qsi3Lct6gzDAQrqCIOgBSwBZq9UwNzeHpaWlLvskHIaQkH5DtYVCcs6dOwfTNDE0NISRkRG4rgvDMGAYRuqxwzBMASyXy2g0Guh0Onld178WRdGHOOf3rXTsjYK2kzH2HcMwXitUw3XdVB0FhwrDEI7jwPM8LC4uYnp6Gq1Wq8f+yHYoCzj5uzJosucVdnFmZgazs7MYHh7G2NgYLMuCYRgwTbPH9uXzeTiOg1arRXVd/9s4ji1N0z61WuDWAtoOxthTpmleCQCMsVSKZGPvui5c10Wr1cKZM2dQq9Ugvi+DJNsfSmn6uaxWqtqqNEXcIHmbn59HpVLB6OgoRkdHEYYhTNMEYwyMsdQcmKYJSilqtRp0Xf/LKIqoruufFFxyEKDZhJDHDcO4EgA45+h0OinnEiTVcRy4rovJyUlMTU11gSVAEJsw7uJi5O/JxlzlairHE8cWDkRI/fT0NBYWFnDppZeiVCrBNE3oup4eGwB0XUe5XMbS0hJ0Xf8LAGd0Xf/y+YDjq/SSj5imebU4oAyYuMOdTgftdhunT59GrVbrAUtIFOc8BYxznv5fBanfkFVIlbg4jmEYRuqdfd/Hc889h4suuggjIyOIogimaaY2TtCXUqmExcVFYhjGw4SQGULIkxsF7S7Lst4mAHMcpwsw3/fhOA7q9TpOnToFz/NSwGTQdF1PWbsArh9QWWqZ9ZmQNrE/8Z5zDk3TUm89NTWFVquFvXv3IooiWJbVdRMMw0CxWES9XtcBHKGUvg7AS32l6Dz5tGt1XX+KL4+UNqiALS0t4YUXXkAURV1gCbXTNA26rkPX9S7bNoihZkWECotz9DwPnufBdV3k83ns3bsXtm3DsqwuDSCEoFarodVqwTTNH9i2fd2tt94aZkr7SqERY+zLjDEuB8WyDXFdF7VaDadOneoCTBh2TdNgWVZ6kpqm9TiDQW1ZN0vXdZimCdu2Ydt2aj4EmVaJd6lUAmMMruu+qdPp/HlfE7ECaPdqmnaRYNYi3BGe0nVdNBoNnDp1qsvgC8AMw4BlWbAsK81GqJ5zEEPen0poBQ8UpNe2bbiuizNnzsDzPDiO0+ORh4eHhYTe/aUvfemKVYM2MTFxlaZp7xN3TQ6LAMDzPHQ6HTz//POIoqgLMPkEZekaNFj9wOsneSLcsiwLnU4H09PTKSmX01OMMZTLZXieZ3Q6nc995StfIatyBISQT1NKGaW0Z6eCzJ4+fRpBEKSAiRPTdR22bXep4lYPOXUkczP55lWrVeTzeQwNDUGmGIL8tlot+L5/g+M4NwH4xoqOYGJi4npd15+UvaVKLaampnD27NkULBUwwYfOFxpt5pAzKmoEIRKWnufhiiuugGVZKQEW5+z7PqampmAYxolCofC622+/Pe6rnoSQjwsbJTylOAHf99Fut3sAE0ZXACar6ys1ZPuqkmpBSzjnmJ6eRhRFaWQjhqZpsG0bvu//SqfT2d/Xpk1MTLyBc/4mORcv7pYgi2fOnOmxF8JLCcBebUMGTgZU0zR0Oh00m82uJKnQvm3btiGKInie96GVHMFBWTzlnFgQBKhWq2g0Gl0H5Zz3ALYR6lAqlbBnzx5ceOGF2L17N3bs2NGToV3rJgOXxSFnZ2cBIM3SiONJ0nbN5z//+Tf2OIKJiYltjLFb5dBELoKEYYjp6en0wEIFTdOEYRjQdT2Tza9lvP71r8cNN9zQ8//Z2Vk8+OCDXdRlvRIn1xVkLarX6yiVSl0ZZkopisUims0mHMd5L4BnVEm7iRBiUUoRBEHXwUTKuNlspictuJhhGGnqeaOUQgCvjpGREdRqNfi+v2E6ooZ3wsYtLCyAEJKqqQDUNE1omoYgCMYfeughXQXt7XLSTq0vzs3NZTLuraIWjuN0Ger1gieDJoMnQsKsEC2fzyOKom2O41yXgjYxMWFRSt+qxnBCz4MgwNLSUpdqilhSzrxu5lhtuW+14Mk2TrwXuT+VsuRyOXHjbpRt2huTvH9PyjqKIlSr1bQqLrPrQdix9ajYIGmJuC5KKer1Oi644II0jpbpB6UUURT9egpaFEXXCjslOwDxWqvV0rsjFyk240KyRlK/HMix5DYHkU4SAIokhG3bXRGFKAfW6/V9DzzwQIkmP3iduhPhAKIoQrPZ7EkkipLZVkiZINODOJYa4MsOgnOOdrsNtYNJVL/iOGau6+4T6vnLWXYjiqK0QCLXIIXr34yMRb//iyzvII4npE2oplxGbLfbmclPTdOEIL2GT0xMaAAul7mZbAQdx+kymrLHlKtFmwVaHMeIJHs6qOMJ4i6He+J6ZUlMCW2iWVEUXUkBjArbltW5kzSTdEUBagluUKNer2cABkQD8por9YXI/SBqjVWk0ZPPL+EAdvcryIpUkMxx1DhukOrZaDRetqdRjBgxwihCpPSoDcpzCrVU9+15XpczEF5W13UEQbCbh2E4KnQ2K9/u+35XzkwlhpvBx5alaxmsKIoRhvGmSVlWaVEVHllF4zge5QCKAvGsL8uxmuBoqrQN8kIiLAMWRomURTGiONqUVLmQNpmzqbREjV3jOLY5AFvOImSxbtklZ2UQBogaoihCECagxUmrQ3IRm+GtVTWV+9yEd1VAK/A4jnP9xFG1IZvOyeIYYRQjSKQrSqRtcWFxyzihKtFZNVcex7HfL6ZTg1o1QzBwzJKTDKNw2REkUlZdWtwUG6p2VQqpW4kVxHEccACLsi5nGT/VLW+m5C3bsmUJEyBCCuG2oqKVlYSQ8mxVDmBGTm2rOxFMuB/NGOhFEJI4AQkwAHSFTqKNeOl+Q9hu9TtJsXyBEkLOytGA6oblvgfZMG6Gii4tLCzTDInyUEJAN0G6Vjp30ZraowVhCELIS1wGTS2KiOysfAAR+W+GpAVBAIKXpZkRAkYp2IBvVD+GIAhsFtEX0VEcx/9Hb7nlliaAKVnSZAoimHG/A8kh1kY3xhhAlqWLUwqNM+icgTM6sGOoM2XU+Nm27S7PKYPn+z4IIado8uNn5bqAfEc557Btu6tRRAVskIOCQGMMutg4AyUDPoYUoKvA5HK5noq7ACwhvc+KszkRBEEPAKJmUCqVBp5y7us9Qx8aY9D48sYpxdLS1vE0y7JSCiJfq+hnoZT+F0+k5piwKUKEhboyxlAsFjE3N5emwlcKNTY6Jo4cwa5du8AZBxDjxRdfxOTkJMrl8qbm7kQXpWEYmUyi0+kgiqL/PXTo0CxPgPkhpTT2fZ8YhtGz43w+D8MweoxjVnf2RofrODj1/PPp1CBCCIaGhmBZVtcEi0EVaWRpKpVK4Jx3CYcY7XYbQRAcWzYhAA4cOLBAKT3heV6PXQvDEJxzbN++fTkuTBr7sjzMIJrzbNvG5Zdfjje/+c24+uqrsXfv3vSmZTU8r7XSroIhA1gqlVIvqqb9XdcFpfRJuRoFAP/suu6vFgqFTCB27tyJSqWSdt2o9m8QEpDP57F///6eovFTTz2FkydPdnUjbTRrqzq0crks8mU9oCU115hS+i+ppCUq+oTwEqpXDIIAmqZh586d8DyvR7RVr7rebd++fZlV9muuuQaNRiNV1/VIWD/wRGF8+/btXekheSQNMicOHTo03QUa5/wYY2xWlMtU0iekTQCrTjnsV+VZyzY0NJR5caZpCpuyLsD61R7Eq5hnIGiFanZarRbCMDz6Mi1KxoEDByJK6dfk0rxM/nzfh67rGB0dTZuW1QNs1KOuRGdkW7rRcEkuHBFCsGvXrq76gHweSUckGGOP9oCWSNsjoiKT5R2jKMLw8DA0TeuaoykXIzbC4+QawSDT52onpDyHa2RkBJqmpWZHvTGNRgNBEPzHPffc87N+oB1jjJ2SVVQWcVFkufjii9MmP9V9q0Z0LaokOsXV8cwzz/SdLrRaT6m2vwNAoVDA0NBQpoQJr5mo5he7oxZp3HbbbTHn/B8ER1LzaAI40zQxNjbWI21ZgK1lzM3N4ciRI3j66adx+vRpnDx5Eo899hieeOKJlKdtRO3lsIkxhrGxMRBCuqRMlrRmswnP8zqMsUe6hEs9gK7rDzqO87FOp2Pk8/keiRFzCMrlMlzXRb1eT4mvHNOtJ+fGOcfS0hImJyfT6USCu6kN0Ku1jTJQYiOE4MILL0wnxsmeVN7/0tISfN8/cvjw4cW+kgYAt99+e4Vz/lXZvqiiLybEjo6Oolgspmoqt873Y93nm3Wi6zpKpRK2b9+OHTt2YMeOHdi2bRts2+5pOs6iFVlSpS5lsWfPHti2nU6+kCVM3Ph2uy3M0d/1JhWyk3D3iR/KO5JVVXiVsbGxdIK9fHKquq7WQYhSoZgoIToRV5NNUac3qk4qiiLs2bMHuVwubfWXz1mVsiAIvn/48OH/XBVo73rXu37MGPvOStJGCEGj0YDv+9izZw8KhUIKnDx5X7V3a11SYlXFZWX//baLL74YhUIhXWBABkwWDjHJNwzDT2enr/oMXdf/SsxB7ydtwHL/heu62L17N3bu3Nklaf1WTMhS4fVSiCyw5MmzwuhfdtllyOfz6HQ6qTmRuZ8sZYuLi/B9/yTn/FuZtneFPPl3Hcf5Qa1We5Npmn1L+XEcixUIMDw8jHw+j7Nnz2YmLbNWRlALGCux95UyFbIEy9PDi8Uidu/enXpDWSVlwIRQeJ4nQrZPHD58OF4TaLquwzCMj7bb7e86jpPO+RazcuUeL5k5Dw0N4YorrsDs7Gy6MoL4br95Bv0AXIk6ZPFCGSxKKXbv3i0mh6HdbnfNiRCACecixsLCAnzfPylHAKsGLTHGTzqO82S1Wr1hZGRkRWkTd6lSqaBQKGBsbAzDw8OYmppKvZR8V+OMVoOVwrCVkgQqOR0eHsYFF1yQMno5ppQlTJ4LJWxZImWHDh8+HK0ZNFHKMk3zrlar9Uyr1SK5XK5L2rIuRnSCdzodbNu2DZdffjlarRZmZ2dTbywvNqKmaFYLWtYiTzt27MDw8HDKv4SHlCeSyUZflfRKpQLf948xxh5bkU+u9CFjDKZpHncc56u1Wu1W0RouGprlBhKVUDqOg7m5OViWhXK5jMsuuwy+72NhYUGQxq5UjwpYv/U4VLUUoZBIIDqOg0aj0QWWLGFyw7V8nFarhWazGYdh+BG51rtm0IRtsyzrrnq9/rZqtWqXy+W+FEQFTsRurutC0zQUCgWMjIxgbGwsnchVr9fTpSlk0PpNtBDTuwuFAgqFQnoDm81mV8pKBUtufZd70cSYn5+H7/uPcM5/KMqW6wYtsW1nNU37bL1evyefz6dNw+JEVKcgv5fnVonlczRNQy6Xw9DQEIaHh1NplVe4EqCJY4m1hGSD32q1ulafkT8TPDGLZ6pEOTEn7SiK7hYh24ZAE9KWy+Xurdfrty8sLFyya9euTKcgN8mpwKmTVD3PS+cnyLNgxMw+UeARFy9LkqquMjeUDf1KgAkp830flUoFnud9Qtf1syIK2TBoibR1NE27s9PpfLPdbsO27R6nIDfDrURM5eBYrnyLwk5WIbqfbZPVL6uYLXvsfsbf87yfMsb+2jRN5HK5vhPb1gSaUJN8Pv+tIAgerVQqN4+NjXVxnCzbtloAs/bRrzaZRTlW4nb9EgOC7Nbr9TgMw4OGYXi5XK5rWnb/LoBVDhFEm6b5R3EcVwRxzZrRpq5MtdrQSF7zo98mx7T9wrB+M1LkcwvDEOfOnYPrul/gnP+bWMxuNTOj19QkQSmFbdvndF3/k2azmeaiZPc9yOa/9cSoq1XLc+fOwXGcaQAfMU0ThUIBhmFsDmi6riOfz3+ZUvr4wsJCl+FXJW6remT7AdZPyoRa+r7/Xl3Xa2INkdVmhtfcjpMQXti2/YdBECwtLi72MOysVaq2EkDVwcjaEASBUMuHOOfftiwL+Xw+pTObApoALpfLTRuG8b5Go5Guwpdl37YKuJVqrrLKzc3NwXGc/wHwQdM005aHtazysC7QhJrmcrlHKaUPz8/Pp/PeVfu2FRLXz46px65Wq2g2m6Hv++/Udb2Zy+XSNPqarn+9J8oYQyLaHwDws3Pnzp23DrCVdkz15K7rYn5+Ho7jfFTTtKdt20Y+n1/XCgwbajFkjMG27aZpmr/ruq6n2rfNlrbzSZhML6anp+F53pOMsXuFt1wNJxs4aJI3Pc4Yu6tarXYVYzbK3zYiYTIYCb2YDcPwnbquh/l8HrZtr7uOuuFmVuFNi8XifYSQR0XH5GbytyzG30+ql5aWUK/XQ8/z3qFp2kw+n4dIOqxbWAahJpxzscLxewA8Pzc315NOHqSqrlYt2+22sGN3c86/J1JKa/WWmwIakK7L0zBNc7/ruq1KpdIljYOiImqisp/h930fs7Oz8Dzvnxhjn7UsC8Vicd12bFNAE6t4FgqF5zjnv99sNuNqtdpXjdYDXJYdW8nwdzqdn0RR9G5d1+NisZguhrfhax2k+xc0pFQqTRBCPr64uJjpGNYD3PlUUjX87XZ7MQzDt+u6XisUCgMDbOCgycAVi8XDhJCJubm5NE+metTVzqpbC2CVSkUY/ps55y/KdmxQE0U2ZWWlJPcW27b9e3Ec//f09HRP65bczKJSkX7Sl2UXVca/uLgIx3Hu5Jw/ads2SqUSLMsa6GJ4mwKamLpdKBTalmX9ZhiGkzMzMz2dOVn2aCXwZA6m/q7VaglPeT9j7HOJmVhXmPSKgCYnLQuFwqRpmm9xXXd+bm4u06Oeb2GUfk5EfnjE7OwsXNf9BoAPiWWlB2nHtgQ02b4lHvWmZrPZXg1wWYvE9eNivu9jZmYGjuP8KIqiA4ZhhMViEblcblMA23TQpPgU5XL5R5qmHWg2m2E/DrcSQFkqGYYhpqam0Ol0XgzD8CZd19vFYhGFQmHDSyG+oqAJx5AY5W9QSu+s1WpYWFjoAk5dAlb9W62Mh2GIyclJtNvtSd/3b9A0bb5QKKBYLG6Y8b8qQBMRQy6XQ7FY/Bwh5N5qtYpqtdqlhur63/IyPbK3jaIIMzMzaLfbC77v36hp2kvJvgfC+M8rBFuZw0+oCOI4vrter+cWFxfvpJR2TUtU29nV/4unWjQajZrneW/VNO3ZXC6Hcrm8KZ7yFQdNtBckPbofaDab9vz8/HuA5YV4zxcVCBvWaDRanufdqGna8cRebhlgWwba+Pg4wfJjR1hiEigAcu211/7pjTfemJ+fn39HHMcYGhrKJLaiH2Rqagr1er1dr9dv+cxnPnMCgA0sL08ktqNHj0Y/t6CNj4/zZP9MASsF7dixY+Sll1768B133JGbm5v7Ld/30/4yWR07nY6wYU6lUvmD+++//8dYfv5enIAlXqPx8fEQQAggABAePXo0HPS1kUE/fnd8fJwB0AFoCVg8AalLyqRXPjw8nDt48OCnDMN4S0KIoet6Clij0YDnec7Zs2c//PDDDz+F5acnxlmgJYBFCWgBAO/o0aPeWq9jpcfvDhS08fFxCsBIANMUSWMKYHkAwwCKAHKGYVgHDx787XK5/BuUUiZLmuM4lRMnTjz0xBNP/AzLzzFuAahi+bmdvgRcKAEXJp/56wFuK59ZLIPSo47KZ6VkKwDIua5r3Hfffd+/6qqrfrJv377XmKa5PY5jv1KpnH388cd/6i5PHylKEhwlEieSdpFEoWLpbwqAjo+Pk6NHj8avRpumqkokgUWkzwCglgAQJ2pkAtCOHz/eOn78+HTyfUiSE+Dlp2U3k9/XpeOox40VBxFvuk1ba+pZjpxWadNkqbOx/ChxI/ktVUALAHh4+fHizlpsWrL1jPVeOxnElJs+4J3Xe2Zs6S7V68t4lQFTQQsl0KJBgTVQ0FYJYj9pywKt34gl4LIAizYDpC0B7Rd9/P8A12VCYmM3Gg8AAAAASUVORK5CYII=",x.Logo=new Image,x.Logo.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAIACAYAAAAczR65AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAF+CSURBVHja7N13nCT3ed/5pzpMT+40s5M6zGycXSxyIhY5ESQCqURR1FnW2Zb0kixLtuTzvex72eezzz6dJcq0jmfLd7Ysn2wSFCiSEgkQAEEiExkL7GLDbN6ZDhM6T0/q6VD3B0SQABbY2d3f02k+77+ADc+v6vlV9XZ9p6p+1tv7H7UFAGDErIMeAIApVRmlCQBgEF9VAQAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAEAAAAAAAAAACAAAAAAAAAABAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAABAA0AIAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACgVbloQfPyxo/J+KP/kEa0sdi9/0qy266iEWg5ll2Tu//074hrLaU2xul9vyPHr7qbZl/w3Nhy15/9XXEvx4zXfvkLfyIF/xBN3oBb/+J/k56FN1Rq19y98oO//d+l6uRrHKDlypf+m4Te/pJa/VP7/qVMXfUgjUbdcQcAAOCC2ZZDsuO3q44RjL1Noy+CNzuncvEvIjKQOE6DN8CztqJ28S8ikovcwcU/oMhZLcvw1J+rjjF25Jti2TbNBgEAAKA1pKJXqdbvTzwv7nKJRl+gwfiUWu2BmQM0eCN9mjutWj8duZImA4pGZw6Iay2pOkZn/m0ZmD9Fs0EAAABoDQtjO1TrW7WqBOfO0ugLvficflOttjf+rDirZZp8HoHElGr91NhOmgwoCk19ry7jhI89TbNBAAAAaA2lzh4pjtysezGbOEqjL0BHaVX6E8/rfWmorElwfoZGny8AiOnd/r/mm5Sl/iBNBpR0L+ckcPYbdRlr6PjD4i6v0XQQAAAAWkN6/HrdC6np12jyBRicPSWWXVMdY0D5p9utf/FQkK7sIbX6mfF9NBlQFD75kkidns13lAsyduZNmg4CAABAa1gI79a9mMoclO7lAo3e6MX5zDvqYwSm+bL6cYLKz/+nwpfRZECJZdsydvibdR0zdPS7NB4EAACA1pAPjkq5e1T3ojbJS5I2+sV14Mzz6uP0LrwmnatLNPyjAoC43mMrtsMl6eFxmgxo/Xszf0q68m/VdUxv4nHpL8zTfBAAAACan21Zktl6p+4XsvghGr2RL5GKy/99aE5mCWU+SmDmFbXahdCdUnF7aDKgpFEv5Qsff4HmgwAAANAaUpHLVev7p19kreQN0Fz+70MBQPwIDT+H3sWMdBT1HgFIR6+myYASd3lNho4/3JCxR49+XRy1KpMAAgAAQAsEACPbxLb0/jlxryTFm+P2yPNelNfx2fzAGX5adc45SJ7UPddY/g9QM3bmTXGUG/POmY6lEzKUZNUbEAAAAFrAuqdLFkN36F5YJY7T6I/78qi8/N+Hxluekf7cAo3/gIDispXrPREpBIZpMqCk0S/jC039gEkAAQAAoDWko9eo1g/GDtDkj1GP5f8+aCB5gsb/BMu2JTDzolr9zMStNBlQ0l+YF2/i8cZ+jp/8qnjWeMEqCAAAAC1AezlAb+xZcVbLNPqjLsbrsPzfh8cklHnfBURuXlyrc2r10+G9NBlQ0gwv4bNqZQmffo3JAAEAAKD5FfxDUurbpvePVbUkwfkZGn2uL411Wv7vg3yxZ8VZrTABf21gVvH5f8uS1Oh2mgxo/PtSq8ro0a83xbaMHfkrJgQEAACA1pDZqnuL8kBiiiafQz2X/3vfF4jKigQWCGV+JKC4XGVxeJ+se7poMqBgKHlUOpaa45Gm3oUXxJ+JMSkgAAAANL9U+DLdC6w6vuW+ldRz+b8PGkgcYwJExFGriS+mdwtxevw6mgwoCU19v6m2J3z8OSYFBAAAgBYIAEa2ie10q9XvXXhNPGvLNPqDF+ENDEaC028wASLiyyTEua63fFgqNEmTAQWetSUZPPlwU23TyNGv8XgVCAAAAM2v4u6QfPgu1TEGlddZbzX1Xv7vg3rnXxXP2sqmn4eg4nFZ6RyU3MAYBzugIHzqVbFqzfWCWddaUkZiB5kcEAAAAJpfavxa3Qut+FGa/BMasfzfBw3Mntr08xCI631Zz0ZvF9vi6xqgYezot5tyu0JHn2RyoMZFC5rX4ugOOfS3v9HS+9BVmJdt3/i7KrWP/tJXpOrubOn+1FycgmizAGBsl+zUDACmXxKRX6DRP7r4bsDyfx/ahthhSUxcvmnnwFktizeudxdGOnIFBzqgwJ+JSe/CC025bcGzfyHdy78hKz0+JgoEAJuJ7XBItcPT0vtQdeltf9Xd2fL9AdpN0RuUNd9u6czr/KS+o3ha+vMpWfQNbvpeN2r5vw99Ud3koUwgFRdHtaRWn+X/AB2RY8828UWALeGTL8mxK+9nomAc95QBAIxKb71Ftf5A8gRNlsYt//dBPwplNqug4koIy4PXympPPwc7YJizWpHhqT83Vm9uz69JZqvZIHTsyDdFxGayQAAAAGhuC8rLAQYV11tvJY1c/u+DNnMoE4gdUKudid7AgQ4oGJk5IK61pLF6iwNbpbBll9Ft7Mrtl8F53rECAgAAQJPLDI9LzdWtVt83/Yw4atVN3+dGLv/3QcFN+sZqd7kkfbM/VKufCu/mAwVQEJ4y+5K9oj8kiwPjxrcz1MyPKYAAAAAAEZGq0yW58XvU6jvLRQmk4pu6x41e/u+D/DPPbspQJjh3Vm0Vhpq7V7JbInygAIZ1L+ckcNbsS7YXfaOSD4SMb+vwsa+Iu1xi0kAAAABobqnIlboXXorPXbeCZlj+731fJspLEliIbbp5CMweV6udi9whVSfvagZMC598WcQ292z9es82WenxyXJvQCqeYcOfrQUZPbufSQMBAACguS2EdqnWD868tan72wzL/31omxJTm24egjN6j2GklUM0YHOyZeyw4Z/+j9z41/9lSXHoRuNbHD76XaYNBAAAgOa20uuTlYGr1er3zf5QOtbXNmVvm2X5vw9dDE9vrp9SedZWpGfhDbX6qbGdfJAAhg3OnZKuvNkAOT/043d1FAfNh9/e+GPSt7jA5IEAAADQ3NITn1C8CK5JcO70puxrsyz/90F98y+Lp7SyaeZhQPH4W/NNylJ/kA8RwLDw8WeM18wO//iiP79lu852n3iRyQMBAACguWkvBzgQO7op+2pq+b817y5J7fwZcxtm2zKQ3DxLVgUUH3nIjO/jAwQwzF0uydCxrxqtWXP1SPYn3v6f2bJNZdvHDn+9qd77AgIAAAA+JLslLNUOv94F2Myrm7Kvppb/W+8dlvVun9FtCyY2TygTiCne/q8cngGb0djZN8VRLhitmQ996n0v61zp8cua7yrj296xdEyGklNMIggAAADNq+ZwSnbiLrX6Xbkj0rOU21Q9Nbn8X6l3QMqdvWYDgLMvb4p56F4uSFf2kEpt2+GS9PA4HyCAYaEjjxmvOb/1lg/9Wjp6h8r2h6e+zySCAAAA0Ny0lwMcSJzcVP00ufxfqdsnZU+30e3zLJ6QvkK67edB8/0ThdCdUnF7+PAADOorLIg38bjZopYlyeiHX3Y7P36dzuf/yYfFU1pmMkEAAABoXgsh3TeZD8QPbap+mlz+r9Tjl1JXn/ltTJ5o/wAgrveoQzp6tQAwK3LiBeM1c+HPylpX/4f/3RvZKZXOMePjWdWShE6/xmSCAAAA0LzWunplaUhvNQD/9Ati2fam6KXp5f9W+gdkrdtrPgCIvdP2cxGYeUWtNsv/AaY/O2syeuQR43WTu+4556/XHC6Zm/ycyr6EDn+bCQUBAACguaUmblCr7VpbEF8muSn6aHr5vyXvoKz0mX9Jo2/6GXHUqm07D72LGeko6jwCsN4TkUJgmA8NwKDhxBHpWDJ7Z1LN2SWJ6DUf+fvxHbfpfP4sPCe+bJxJBQEAAKCJA4DwbtX6A4njm6KPppb/+5HlPr+sdveJ7XAaressFyWQat8vqANJvfdOZCZu5QMDMCw09QPjNdPbf0HKHZ0ffS4PRmXVf43K/oSPP8+kggAAANC8cgMhKXeNqNUPxg5sij6aWv5PRKTUv10qrg6xLYeU+neYn5PEsbadh4DiUofp8F4+MACDPGtLMnjyq8brJnbecZ4/YUly90+p7NPokYfFUaswuSAAAAA0J9uyJDtxu1p9b+I5cVXW27qHJpf/ExFZGph8779XAtvMBwAz+9tyHizblsDMi0rFLUmNbucDAzAofPo1sWplozXLXWGZGzv/nW3xbTrvv3GtJWR05iCTCwIAAEDzSkWu0Lsoq5YlOHe2rftncvk/EZHFoR9faBYHxo1vb//sD6WjtNp289CfmxfX6pxK7eLwPln3dPFhARg0duSvjNec3/WzUnO4zvvnlvoGpBC6X2W/QlNPMbkgAAAANK+FsR0ilqVWf6CNbzkXMbv8n4hIYTDy4zAgGDK/wbYtA3On228eZvWe/08rrR0ObFb+TEx6F8wv/xffsfF3dSR23aeyb8Ezj0jXSoFJBgEAAKA5rXu6ZHH0NrX6gZnX27Z3ppf/ExHJDfx4jeqiX+et8wOxI203F4H4IbXaqdAkHxSAQeHjzxmvueq7WjKD4xsPAMavFdvpMb9zti3hky8xySAAAAA0r5TiTzh7Uvulc7XYln0zvfzfmm9SSp09Pw4AvEGpuXvNXyxPv9xeX5hqNfHFXlCpXekcfF8oA+DSOKsVGTn6NeN1Zyc/IyIbv5tt3dMtqW2fV9nH0JFviYjNZIMAAADQpAGA8nKAg4rLszWS6eX/spEb3vf/tuWQfOgW49vdWTguvYuZtpkHXyYhznWdW25z0dvEtvhKBpgyMnNAXGtJ43Xj22+64L+T2Hmnyj52Zd+QgYUzTDYIAAAAzSkfGJb13qha/WD8SFv2zeTyfyIimXO8vTo/ohPOtFMoE1TcF82XZAKbUXjqSeM1F0c/KcX+LRf89+ZCl0mlU+cOn/CxZ5hsEAAAAJpXZkLvPQDBsy+2Xb9ML/8nIpIe2fqhX8uO6Cw/F4y90zZzEYjrLbuVGt3BhwNgSPdyTgJnv2G8bvIiX+hXc7hkbvJzKvs6NPVVcZVLTDoIAAAAzWkherlabfdyTPpzC23VL9PL/y1tueF9z///SG5gTGquTuPb759+Thy1WsvPg7NaFm/8eZXay4PXyGpPPx8OgCHhky+L2Gafjbcth8Qnrr/ovx/foRN+O8s5GZvez6SDAAAA0JzSw9vE3sD6yRd9wZw83lb9Mr38XyZ67hcxVp0uKYTuMP/ldD0n/nS85echkIqLo6rzU7ZM9EY+GABzl+oydtj8T/8zW39eSp0X/7LUzGBUVv3XqOxx6OgTTDsIAAAAzanc4ZF8+E61+sGZg23TK43l/1LhPR/5e+noVSr7MZA41vJzEVTchzTL/wHGDM6dkq78W8brJnfedamf6JLc/VMq++yLfUd6i2kmHwQAAIDmlI5eo1bbF3tWnNVKW/TJ9PJ/VXefZLeEPzocGNupc/HcBrenBmIHVOrWXN2SGYryoQAYEjr+rPGa1Y6gzIYv/UWd8W2fUNvvyPEXmXwQAAAAmlNK8SeejsqK+FOxtuiT6eX/cuN3S83h/MjfX/RtkfW+rcb3o2/2h+JeX2vZeXCXS9I3+0OV2rnoXVJ1uvhQAAydq8PHvmK87vzOz0vF1XHJdZb6BqQQul9l30ePfN3o+2JAAAAAgDGLvkFZ8+5Uq2/6wrlRTC//l97AUnOZ8VuM74dl12RgrnXXqg7OnVX7Yp2OXMkHAmDI2Nk3xVEuGK+b2HGruVoXuZLA+XiKR2VL8hgHAQgAAADNKb31VrXagZm3Wr4/Gsv/beQW/1T4MpX9GYgdadm5CMzqvVhS67ELYDMKHf2u8ZrrvbskNWxumc7E+LViOz0q+x8+9gMOAhAAAACaNABQutAUEembf1k8pZWW7o/p5f9WA5fLcq/v/PMyslVsy/xXg+D0Ky07F8GZN1XqrvkmZak/yIcBYOJzf3FBvHHzAcDs5M8Y/Uxc93RLatvndf7dOPGweErLHAwgAAAANJ/UyITKuvMiImLbMjB7uqX7Y3r5v/TETRv8ctolxVHzjwF05o9KTzHbcvPgWVuRnoU3VGpnxvfxQQAYEjn+gkrd+A7z52lyp85KOI7qqoydfp2DAQQAAIDmU3W6JR+5W61+MN66t5yrLP8X2rPxC9OIzioNg8mTLTcXA3N6QVI6vIcPAsDIZ2ZNRo88Yrzu8uDNkvePGa87G7pMKp2jKr0IHfkOBwQIAAAAzSmltO68iEighW85N738X83VKZnhjS81p7VKQzB2qOXmIpDQeaGk7XBJaniCDwHAgKHEUelYOmG8bnLyQZXtrTlcMrfr51Vq980/I75cgoMCBAAAgOazoLgcYGfhuPQuZlqyL6ZXMciH75Kq073hP58bGJNK5xbj++Wffr7llqkKxHRu/y+E7pCK28OHAGCAysvvLEviW29Q2+b4jlv0+qH0OAQIAAAAuCTLfX5ZCV6hVr8VbzkXUVj+7wLvtLAtS7LjtxnfL1cpLf506/xkqnu5IF1ZnbsW0tGr+QAADPCUlmXwxFeM182FPysrPX617c5smZBVn87nwMiRr4mjVuHgAAEAAKD5bPTldBcjGHun5frRqOX/PjQvEZ1gZiBxvGXmIqj4/H9qbBcnP2BA+NSrYtXKxusmd92jvOWWzO7+rEpl9+qMjLTgI1cgAAAAbAIpxeUA/TOtd8u56eX/1rw7pegduPB5Gd2uc1E981brBADxoyp1yz1hKQSGOfkBA8aOfNt4zZqzSxLRa9S3PbZdbyWQ0NT3ODhAAAAAaD6ZoahU3X0qtZ2lrARS8Zbqh+nl/zLjN1/U31vt7pflwWuN719/4nlxr5daYi4CMzovkkxP3MaJDxjgz8Sld+F543VTO74g5Y5O9e1f6huQwtinVGoHTz8iXauLHCQgAAAANJeawynZcb1bLYPJEy3TC43l/y5lqblM9AaFfaypLq1nSu9iRjqKOtuZCV3GiQ8YED7+nErdxI7b67YPiUmdAMCyaxI++RIHCQgAAADNJx29Ui8AaKFbzk0v/2c7XJIa2XrRfz8V3q0zJ0pL65k0oPUCScuS1Nh2TnrgEjmrFRk5+rDxuuWusMyP7a7bfiTHrxXb4VapPXb4WyJic7CAAAAA0FwWQjvVavcnXxB3uTVuOTe9/N+lLjWX3RKRmqvbfABw9pWmn4tAQuf5/+LwPil5ujnpgUs0EjsorrWk8brzu35Oag5X3faj5OmR9LYvqNTuzr4uwdRZDhYQAAAAmstqd78sbdFZb9mqVWVg7kxL9MH88n+X9hKrqtMluchdxvezK3dYepbyTTsPlm1LYOZFldrp8es44QEDQkefVKkb33Fr3fclsfMOtdrhY89ysIAAAADQfNITN6jVboVbzptl+b8Phwg6j2cMNPG7Gfpz8+JandM5zln+D7hk3ct5CZ79C+N1V31XS2YwWvf9mQ3vlUrnqErt4amviauyzkEDAgAAQHNJXcLL6s4bAJx9ten33/Tyf+u9USNLzaVHdR7PGGjiNaoHZnWe/690Dkp2MMTJDlyi8MmXRGzzz7bP7v6siFh135+awyVzu35epbZzPSWj029x0IAAAADQXLKDIal0DqrU7sq+I93Lhabef/PL/91ipE7RG5Q1r/kQwD/9vFh2c76cKhDXCSdy0dvEtvjaBVwaW8aOfFOlcnzbTQ3bq/iOW9Rqh44+wWEDAgAAQJN9pbMckpm4S62+2lvdDVBZ/i9yucEwYZ/xfXatpcSXSTbdXDhqNfHFXlCpnYpcwYkOXKLB+VPSldtvvO7i6Cel2D/YsP3KbJmQVd/VKrX9M38lvcU0Bw8IAAAAzcXkReuHAoD44abdb9PL/4llSWpkm7l5CeusWz+QON50c+HLJMS5rnO3SGp0Byc5cIlCSi+1S+76VIP3zPrrRxB0hE/8kIMHBAAAgOayMLZDxNJ5/tJ/9oWmveXc9PJ/i6O3yrqny1wAMLxVbIfT+H4HZ95uurkIKt0psjx4jaz29HOSA5fAXS7J8LGvGK9rO1wSn2j8Ch2x7fvUao8d+Yum/TcQBAAAgE2q1NkjxWGdL0Du1Vnx5uabcr/NL/93rdF65Q6PLI7dbny/vYlnxVUuNdVcBOIHVepmojdyggOXehF79k1xlM3foZOZ+DkpdfY2fP+W+gakMKZzJ4Jn8bBsmT3GQQQCAABAc0kpLgc4kGi+Lz8qy/+FJo1vZzpi/tlUq1aVgbmzTTMXzmpZvPHnVWqnFeYE2GxCR7+rUjex8+6m2cfEpN6jCKFjT3MQgQAAANBkAUBot1rtYOxg0+2v6eX/Kl3Dkg+OKsyLzgXsQOJo08xFIBUXR9X8HQk1V7dkhqKc3MAl6FtcEG/cfABQ7QjKXPjyptnP5Pi1YjvcKrW3HP+KdKyvcDCBAAAA0DzywREp94RVantjz4qzWm6q/TW//N/tYiu8R6EQGJZyt/lgIXj21aaZi6DSHSK56F1Sdbo4uYFLEDmuszrH/M7PS8XV0TT7WfL0SHrbF3Qu+qqrEjr9BgcTCAAAAM3DtixJT9ym9OWnJMH5mabZV8u2ZeD0c0ZrpiN71eYlO25+Xrqy70j3cqEp5iMQO6BSNx25khMbuKTPypqMHnlEpXZix61Nt7+JnXeo1Q4d+Q4HFAgAAADNRXc5wKmm2U9fZlbcK3GjNTWXmkuHdcKFAaU3718Id7kkfbM6y2SlxnZyUgOXYCg5JR1LJ4zXXe/dJanh5luecy60VyqeYZXafXM/EG9uloOKAAAAgOaxMLpdbEvnn6fAzJtNs5+DcbPPvy8NfULWuvTeZJ0a3a4TAMQONXwugnNnjb6L4UfWfJOy1B/kpAYuQXjq+yp1Zyd/Ru3fmktRdbpkbvLzavUjx5/joCIAAACgeZQ7OqUQulOldu/Ca+JZW26K/TS+/N+47jrWa129sjRkfjm7wPQLDV+fOjB7XKVuZnwfJzRwCTylZRk8+bBK7fiO5j0/E9tvUas9cvQRcdSqHFwEAAAANI/0+LVqtQeb4JbzjtKq9CfNvtQqrbiCwo/n5XrjNV2rc+LLNvaW1KDSnSHp8B5OZuAShE69KpbC6hzLg7dI3j/WvP8GDm2VNd9VKrXdK2dlOH6Ig4sAAACA5pEK7dK72Isfafj+bUmcEDH4U+9qh1+ygyH9L6VjSssBxo81bC48ayvSs2D+zdi2wyWp4QlOZuBSAgCll9YlJx9o8j23JDn5WbXqWo9VgAAAAICLUvAPSalf55nz4PTLDd8/08+9Z8fvlJrDqb7d2S1hqbr7zM+J0hv4NzQXc6d1juHQHVJxeziZgYvkz8Sld0HheXXLkvjWG5t+/+Pb9R5RCJ56WDpXixxkBAAAADSP9ITOM5AdxdPSn081bL8s25bgmWfN9ip8eV22veZwSm78LuN1vYnnxFVZb8h8BBI6K0Oko1dzEgOXIHxC52V1uchPyUqPr+n3v9g/KIuj9yn9O1ST8MmXOcgIAAAAaB4pzeUAkycatl/vLv+XNNurUP2WmkuHrzD/ZbRaluDc2cYEALE3dI7fsV2cxMBFclYrMnLkayq1kzvvbpk+JCY/pVY7dOQvOdAIAAAAaB7p4QmpOXVuoQ7G3mnYfple/m9l4CpZ6fHWbfu11rUfUPpJ/MfpXi5IV9b8y7DKPWEpBIY5iYGLNBI7KK61hPG6NWeXJMavaZ0AYOI6sR1unc+/zCsSTJ3lYCMAAACgOVTcHZKP6CwH6Jt5tmHLIJlf/q++z7Iu9/ll1W/+7fbB6dfqPhfBuTMqddMTt3ECA5cgdPR7KnVTO74gZXdny/Sh5OmR9LbPq9UPH3+Wg40AAACA5pGO6vykxlkuSiAVr/v+6Cz/V/+l5jIT5l9O1Z1+W7qWF+sbACitCJEJXcbJC1zsZ8FyXoJnv65SO7Hj9pbrR2LnXWq1h48+3LD3r4AAAACAD1nQXA4wUf+l50wv/1dzdUtmKFr3/dAKHQZnT9Z1P/wzr5ovalmSGtvOyQtcpPDJl4x+Tv5IuSss82N7Wq4fc6G9UvHoPFLkXE/J6MwBDjoCAAAAmsNSf1DldnMRkeDM/rrvj+nl/3KRu6TqdNU/ABgaF9tp/rnUYOxw3fahdzEjnuIp43WLw/uk5Onm5AUuii1jR76lcyE9+bm6LJdqWtXpkrlJvccAQkef4LAjAAAAoHmkt+osB9g3+5J0rK/VbT9Ulv+LXtmQOam4OyQfusN43cD0C2Ip/OTvXAZmT+kcr+PXcdICF3tezp+WrtybKrUT229p2b5obrt/+lvSs5Th4CMAAACgOaTCOncAWHZNgnOn67YfKsv/je1s2LxkIubXuXevJMWbm6/L9gcSOs//p1n+D7ho4WPPqNRd9V8jmcFoy/YlPbRV1nxXqdWPnPghBx8BAAAAzSEzNC41d69K7YHY0brth+nl/9Z8k7LUH2zYvKSU3s8wUId3M1i2LYHpF43XrXQOSnYwxEkLXAR3uSRDxx5WqT07+RkRsVq4O5YkJz+rVn30yDfqdvcVCAAAAPhYVadLstG7VWoHp1+p234YX/5v4uaGzkvBPyTrPRHzc1KHF1L15xfEtTpnvG4uepvYFl+tgIu6CD27X5zlnErt+LabWr4/8e371Gp3Ft6RwbnjHIQEAAAANAetZ90780elZymnvv3tsvzfB2UmbjVe0xd/RpyVsup2DyRPqNRNRa7gZAUuUvjod1XqLo7eJ8X+wZbvT7F/UBZH79Pr/9TTHIQEAAAANAfN5QAHEvpLz5le/s92uiU9PNHweUmH9xqvaVXLMjB/VnW7A3Gd1QZSozs4WYGL0Le4IN74Yyq1k7vua5s+JSY/pffv1ImviruOL8YFAQAAAB9ppccry4PX6gQA8UPq2296+b986A6puDsaHwCMbhOxzD9XG1R8D4Bl18QXe9543eXBa2S1p5+TFbgI4RMvqtS1HS6JT7TPyhyJievEdrhVajsqyxI68zoHIwEAAADNIT1+o0pd//Tzqi8/0ln+75qmmJOSp1uKw+afrQ1O630J9acT4lwvGK+bid7ISQpc1GdkTcYOf12ldmbic1Lq7G2bXpU8PZLe9nm1+qEjj3JAEgAAANAcUhGdZ95daynxZZJq262x/F+6gcv/fWhbxq83XrMn9aZ0rhZVtjeY1HnkIx2a5CQFLsJQcko6lnTu+knsvKvt+pXYcada7f7Zp6Q/P8dBSQAAAEDjZQcjUvUEVGoPJPTefmx6+b/1vq1S8A81TwCgtO79oNKFeiB+0HjNmqtbMkNRTlLgIoSnvq9St9oRlNk2fDHnXHivVDzDavUjx1/goCQAAACg8WoOh2TGdX6aE4zpLT1nevm/zPgtTTUv2cGQSjATjB0xXtNZLYs3Yf7LbS56l1SdLk5S4AJ5SssyePJhldrzOz8vVae77XpWdbplftfn1OqPHvmaOGpVDk4CAAAAGi+ltBygN/6suCrrxutqLP+XCl/WVHNiWw7Jjpu/JTV49gXj72YIpOLiqJh/y3U6ciUnJ3ARQqdeFataUqmd2HFr2/YtvuM2tdrulTMyrLRSCggAAAC4sIvfMZ1l1qxaRYJzZ43XNb78n+V49837TSYdvlzhS2hc+vMLZkMFpUc9Uk30TgagpQKAI99RqVvqm5TUcPsuy5nZslXWvHqPN4SOfZ+DkwAAAIDGW+vqleLwPpXaAwpLz5le/m9x7DZZ7+hsunnRCmZMv5shEDf/qMeab1KW+oOcnMAF8mfi0rvwnErt2cmfFttq38sc27Ikufun1OoPnPqadK4VOUjbFA+sAQBaSnrieumbe8l43cDM6yI3PmSsnsbyf5kmWf7vg1Z6vLISvFK6M2YvsAdmDsipvWZu43WXS9KXNL/WeGZ8HyclcBHCJ55Tqz3++u/J+Ou/R5Mv9t+vWkVCp16Vk5fdQzPaEHcAAABaykJYZznAntR+6Vox9xMPjeX/UmPNu9RcZvwTxmt648+Ks1o2Uis4Py2WXTO+jWml4xFoZ85qRUaOfI1GNLHQ4b+kCQQAAAA0Xj44KuWuEZXaA7Pmlp4zvfxfuXtU8sGRpp2XVGi3+S8plTUJzs8YqRVImn/Ew3a4JDU8wUkJXKCR2EFxrSVoRBPrSb8kgfQ0jSAAAACgsWzLkszWO1Rqm1x6zvTyf9nx28S2rKadl8xwVGou8+8nGIhPmZnbmf3Gt60QukMqbg8nJXCBQlNP0YQWED72HE0gAAAAoPE03jovIhKcNvOMuMryf5HLm3pOqk635MN3mJ+TmTcuuYantCI9C6+bPw6jV3MyAheoa6UgwTOP0IgWMDL1VWOPYYEAAACAi7YwtkPlDc/u5Zh4c/OXXMf08n8iIqnR7U0/L+mI+QvinoXXpXN16ZJqDMyeVtnf1NguTkbgAoVPvmT88xE6nKUFGZ1+m0YQAAAA0Fjrni5ZHLtNpfZA8sSl1zC8/F9xeJ+UOnuaPwAY26kzJ7OnLunvBxSWeCz3hKUQGOZkBC6ILaHD36QNLSQ09SRNIAAAAKAJLjbHr1OpG5y5tKXsdJb/u7Yl5mTRNyilfvN3KgzEL+3dDIGYwu3/E7dxEgIXei7Pn5au3Js0ooUEpr8lPUtZGkEAAABAYy2EdJbE88WeE2e1cvF/X2P5v/DulpmXzPg+819Az1z8+xS6lwvSlT1kfj9Dl3ESAhcofOwZmtBqbPvdxzZAAAAAQCMVAsOy3mt+CTZHZUUCqdhF/33Ty/9VPQHJDoZaZl7SYfMXxh3LM9KfW7iovxucO2N+Jy1LUmPbOQmBC+Aql2To2MM0ogWNHfmmWLy3gQAAAICGX2xuvVWl7qUsPWd++b87VV54qDYnI9tUtncwefziAoD4EePbUhzeJyVPNycgcCEXkWf3i7OcoxEtqDP/tgzOn6ARBAAAADSW1tJ4gYtcM15j+b90ky//90HrHZ0qL2i82Hcz+GdeNb4tWu+fANpZaOpxmtDK88fjGwQAAAA0PAAY2Sq2w2W8bt/8K+IprVzw39NY/m9hdGfLzUtGYTnAi3k3Q+9iRjzFU8a3Jc3yf8CFfaYupsQXe5RGtLChY18V9/oajSAAAACgcSpuj+TDd5ovbNsXtXa86eX/lgevkdWe/pabl5TCCxodlRUJLMxc2HzMmr/4r3QOttQ7GYBmED7xIk1o9YvGSlFCZ9+gEQQAAAA0VnpcZ4m8C312XGf5vxtbck7ywVGpdG4xXncgceyC/nwgYf75/1z0tpZ6JwPQaJZdk7HDj9CINhA68hhNIAAAAKCxtJYDDJ59+YL+/GZf/u8n2ZYl2Yk7zM/J9MZ/+mTZtgSmzf/UMRW5gpMOuABDySnpWDpGI9pAf/JJ6S/M0wgCAAAAGqfoHZA1n/kQwLN4QnoXMxv+86aX/6u5eyW7JdKy85IKm395Ye/8q+JZW97YF9X8grhW58zv1+gOTjrgAoSnfkAT2mk+j79AEwgAAABorPTEzSp1B5MnN/xnTS//l4veJVWnq3XnZHR7Q+dkIGl+yapWfScD0Cie0rIMnvwqjWgjo0ceEUetSiMIAAAAaJxUZK9K3WDsnQ39OZXl/8Ktfav5anefLG8xv1xecIN3WgTih42P3arvZAAaJXT6NbGqJRrRRjqWT8pQ4iiNIAAAAKBx0sPjUnN1Gq/rn35OLLt23j+nsvxfaGfLz0smer35AGD6pfP+GcuuiS/2vPnjTOl9E0DbBgCHv00T2lB46vs0oYW5aAEAoNVVnW7JRe+R4Cmz60w713MSSMUlc55n8U0v/7fq3yPLfYGWn5dUaLdEXjdbs6N4WvrzKVn0DX7kn/GnE+JcLxgdt+bqlsxQlJMN2CBfNi69C8+p1X/lc9+URe8wjT6HocRhufLxX1WrP3DqYfHc+itS6uyl2QQAAAA0RjpylfEAQEQkmDzxsQGAyvJ/E/vaYk6yWyJSc/eKo7xk9stn8sTHBgDBC3h3w0a1+jsZgHoLH39erfby4M2SGRynyR8hGb1K9nSPi3vlrEp9q1aW8KlX5ORl99DsFsQjAACAtrAQVloOcOatj/19jeX/0qE9bTEnVadLcpE7Febk4Mf+fiB+0PiY6ciVnGTARi8wahUZPfKw3gXu5AM0+WPUHE5J7vm86hihIzzeQQAAAEADLff6ZCVo/iKtP/G8uMsf/RIr48v/OT2SGp5om3lJR8y/zNAfe1ac1co5f89ZLYs3YX6ZqtTYTk4yYINGZw6Kay2hVj++lRdynk9sx22q9XtSL4o/E6PRBAAAADTwYnPiJuM1LbsmwbmzH/n7A9P7jY5XCN8hVZe7beZE48LZUV4Sf+rcXzwDqbg4KmtGx1vz7pKl/iAnGLBBoamn1Grnww/JSo+fJp/v3xL/iBSH71YdI3LsWRpNAAAAQAMvNiOXqdT1z50656+710vSZ3r5v+jVbTUnS/1BWfOZfzwjOHvu5/yDyRPGx8pM3MzJBWxQ10pBgmceUauf3HUvTd6g+G7dRyWGp/5cnNUyjSYAAACgMTJbIlLtMP+TIX/y3G/5H5g/s6FlAi9EO95qnhk3/1JDf+LIOX89EDtgfKx0aDcnF7BB4ZMvGV8W9Udsp0cS49fQ5I0GAFtvkJqzS62+ay0pozMHaDQBAAAAjVFzOCU7bv6lc32zPxRn5cM/5QgmpoyOU+rfLou+LW03LxoX0P3JFz70HgBXuSR9sy+aveBwOCU1spWTC9jYGSOhw9/U+yzZ+nlZ7+imzRu07umW1I4vqI4RmvoejSYAAACgcVJR8y8CtGpV8afjH/r1wPRrRsfR+El5UwQAI1vFdjjNfoGprIk3O/u+XwsuzIhVqxodpxC6UypuDycWsAED86elK/emWv3Ezjto8gWK7dJ9D0Dg7DekezlHowkAAABoUACgdAu99wMBQNdKUbozZpebS0X2tuWclN0eKYTM35nR/4EAwD932vgYmchVnFTABoWPPaNWu+IZlrnQZTT5Ai2M7pJS36TeALb97mMfIAAAAKARVrv7ZGnI/BJRfemZ9/1/YGHa7HcoyyHp4W1tOy8aF9L9qbPv+3/vvPkXAC6EJjmpgA1wlUsydOxhvQvZnT8nVaebRl/Evy3JPZ9THWPs8DdFxKbZBAAAADRGevwG8wFA6vj7/v+jVga4WIuhO6Tc0b63mqfGdpkPAOaPvffflm1Lf/JVo/XLPWFZ9A9xQgEbuQic3i/Ost6t4PEdt9LkixTbcYtq/a78WzJo+N9EEAAAALDxi82w+ZfOdWfeft9L57zJw0brpyNXt/WcFALDUu4eNVqzJ73/vVUYehcz4lw3e/GRmbhNbMvihAI2IHT0CbXapb7dkh7aTpMvUrF/UAoh3SUBw8efodEEAAAANEZ2MCyVTrNv07dqVekpZkVExFVZl975V4zWT7X5rea2ZUlm4nazc1ItS/dSXkREvJmE8W1O87wxsCG9xbT4Yt9Rqz+7+2cI4y5RbPf9qvWHjn1V3OUSjSYAAACgUReb5l8611189yfMvszsez95NqHcHZJCYLjt5yUdNv+Sw75C+t0LkNys2cKWJalRfuIIbETk+Auq9ePbbqLJlyg5fo3U3F69i8pyQcbOvkmjCQAAAGiMVPQKhQAg8+5FZzZptO5mudVc44K6Jz//bgCQjRutWxy+SUqdrDcOnI9l12T0yNfV6i8P3iIF/yiNvkRlt0fmd/2i6hihI4/RaAIAAAAadbG5Q8TwRXVX8d2fNvdlzF5spsOb41bzUmePFIfN/iSvp/BuANCTPm52Tsav5yQCNmAoOSWe4pRa/eTkAzTZkNjOO1XrexOPS19hgUYTAAAA0IiLzW5ZHDX71uiuxXcvNvtSJ80Vtax3w4pNIhO91mi9zsU5cdSq0pU/ajYAUFi1AGhHoWNPq9aPb72BJpv6XBvaJqs+3RfORk68QKMJAAAAaNCXHcMXmx0reRER6Um9ZaxmcXjfprrVPG34ZYddhbh0ri6J2ObWoK54BiQ7GOIEAs7DU1qWLSe+olY/F/msrPT4abQhtmVJcs9Pq44xeuQRo+/IAQEAAAAbthDeY7SeezUrnrVlcVRWzF0Qj1+3qeYkOxiWaoe5L/SdhWPStVwwe9ExfrvYFl+RgPMJnX5drKrem9+TO++hyYbN7LjZ+ONxP6lj6YQMJY7SaAIAAADqrxAYlnJP2FwAsDIv3UtmLzbbffm/D6o5nJKLmlsO0KqWxZuKGd3GdORyTh5gIwHAkW/rfVY4uyQ5fjVNNmylxy/ZqO5dAOFjP6DRBAAAANSfbVmS3nqHsXqutYX3VgIwodI5KLmBsU03L+mI2RUadj73e0brLYzu5OQBzsOXTUjv/LN6nxPbPifrHazEoSE++SnV+oMnviKe0jKNJgAAAKD+UobXnr/88X9irFZ2k95qnhpr3pcergxcLas9/Zw4wHmEjz+nWj+54w6arNXb6JVS9WxRq2/VyhI+9SqNJgAAAKABF5uj28V2OJty29LhKzblnCz3+mU1sLc552T8Rk4a4HwXELWKjBz9c7X6Fc+wzIX20mglVadbZie/oDrGmOLjISAAAADgI5U7PFII3dmU29bMPwnXlhm/qTkDgNBuThrgPEZm3hH3akyt/vyuz0nV6aLRiuI7b1et37vwvPgzcRpNAAAAQAMu6qLXNN02LW+5Xla7+zbvnDThhXbN1S2ZoSgnDHAe4amnVOsntt9Kk5VlBsdleUA3iNV+TAQEAAAAnNNCuPnetJ+OXr+p5yQ9PC62091U25SL3MVPHYHz6FopSPCM3u3/pb7dkh7aRqPrILH7s6r1R45+TZzVCo0mAAAAoL4WfVuk1N9ct9unwpv7VvOKq0Py4buaapvS0Ss5WYDzCJ98ScS21erP7v4ZsRXXqcePxbbfpPoiWtdaQkZiB2k0AQAAAA24uNvaPLeUVt19kt0SYU4iVzXX9rD8H3AetoSOfEt1hPi2m2hznax19Ulm2y+ojhE6+j0aTQAAAED9pcKXNc225MbvklqTrkxQ1wvusea54F7z7pKiN8iJAnyMgYUz0pV9Q63+8uAtUvCP0ug6ik/eq1o/ePbr0r2cp9EEAAAA1DkAGNkqNaenOS58N+nyfx9U8A/Jeu9EU2xLZuJmJgQ4j/CxZ1TrJycfoMl1Nhu6TMrd43oD2Pa7j42AAAAAgHqqutySjzTHM+epELeav3fhPd4cF94s/wd8PFe5JENTX1UdI771BhpdZzWHS2Z3/7zqGGNHviUiNs0mAAAAoM4X3uONXw5wNbBXlnv9TMaPLryb4NEM2+GU1MhWJgP4uIu46f3iLOfU6ucin5WVHj4bGyG2Q/cdOV25N2Vg/jSNJgAAAKDOAUBoV+MveCf2MRE/OSej20Ua/MbvQuhOqbg9TAbwMUJHn1Ctn9x5D01ukHxgTIpDd6qOof34CAgAAAD4kKW+gKwG9jY2AOBW8/dZ93TJ4khjHwPINNlqBECz6S2mxRf7jlr9mrNLkk1wh9ZmltjzkGr9oWMPi6tcotEEAAAA1PkCvIE/ga+5OiU9PM4kfPACPHptQ8dfCE0yCcDHiBx/QfdzedvPy3pHF41uoPjW68VWfFGus5yTsbP7aTQBAAAA9dXI5QDz4Tuk6nQzCR/88j/WuEczyj1hWfQPMQnAR7Dsmowe+brqGMmdd9DoBit5eiS1/RdVxwhNPU6jCQAAAKivzFBUau7exlzoRrnF9VyygyGpdA425niYuE3sBr+DAGhmQ8kp8RSn1OpXPMMyG7qMRjeB2OTdqvV9sUelbzFFowkAAACon6rTJdnxxrxsKj26gwk4B9tySC56W2PmhAsP4GOFjj2tWn9+8uel5nDR6CYwPzop6726d2SFT7xIowkAAACor1TkyrqPuebdKYu+QZr/URfikcvrP6hlvbsKAYBz8pSWZfDEw6pjJLbfQqObhG05JLnn51THGDv8iFh2jWYTAAAAUMcAILSz7mNmxln+72PnpAF3RxSHb5JSZzfNBz7qYu306+KorqrVL/VfJukt22h0E5nZeatq/Y6lYzKUnKLRBAAAANTPSo9XlrdcV9cx02FuNT/fnKwMXF3fORm/nsYDHyN05Duq9Wcnf4p3cDSZYv8WKYx9WnWM8NQPaDQBAAAA9ZUev7FuY9kOp6RHttL0887JDfUdr4GrDwDNzpdNSN/8M6pjxLdxZ1Qziu++X7X+4Mmviqe0TKMJAAAAqJ9UeE/dxiqE7pSy20PTz3dBHtpdt7EqngHJDoZoOvARwsefV62/tOVWKfhHaHQTSkxcKzVXn1p9q1qS0OnXaTQBAAAA9ZMdDNdt6blM5CoavpE+DY1LzdVZl7Fy47eLbfE1CDjnBUKtIiNH/1x1jOSuB2h0kyq7O2V+1/+gOkboyLdpNAEAAAD1U3M4JDt+e13GWghN0vANqDpdkg/fVZexGrLqANAiRmKHxL06ozeAZUli6w00uonFd92hWr93/lnxZRM0ugGst/c/atMGADBjllgVAIypyihNAACD+KoKAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAEAAAAAAAAAACAAAAAAAAAABAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAgACAFgAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAGOeSFE0AAFP6yiGaAACG9MoyTQAAg7gDAAAAAAAAAgAAAAAAAEAAAAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAABAC0AAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAAgAAAAAAAEAAAAAAAAAAWpWLFjSfPU/+T+JemlKrXwx9Vk7f+Ks0ukk4qhW57LG/JY5yTme+Rx+U0zf9Oo0G6uATj98vznKSRih5895nZK3LTyOAFrP38Z8VZ3muLffNdnRKzRWUmjsgVXe/VDyDUvX4pOwJSLkrKOtdQVnvDspa96DUnG4OBhAA4MNy0U/KlsN6AUBv8glxlX9JKu5Omt0EvAvH1C7+3z2ebqbJAAAACqzamjjXE+JcT8j5Lu/LPXtl1btXVv07ZcU7Lsu+qFRdfB8HAQABQOha2XJY84OqJN65I5IJX0Ozm4Av9qpa7Zo7IIWh3TQZAACgwdzLh8S9fEj6f3SjmOWQNd8tsjR4gyxuuUKWfONiO5w0CgQAm81ab1BWgzdLV+aHihedLxMANAFnpSR9icfU6hciD0rNyWkOAADQdOyadOael87c8zJwXKTmHpLF0YckP/oJWRzYKbZFGADzeAlgk8pF71Ct3zv3pLjWV2h0g/lmD4tVK6nVz0ZupMkAAACtcGFWnhff9H+W8Zd/RfY89bdk9NhfiWc1R2NAALAZ5EevELEUp8euiT/5Do1udAAQe0mtdrl3UpYCUZoMAADQYlxrp2Tw2O/L5FMPycT+P5aeQoymgACgnZU9PVIcuV91DK/ixSfOz11akt7ZJ9Xq58bvo8kAAAAtzZb++H+X7c/9gmx9/d9K92KcloAAoF3lIrpvb+9ZeFo61hZpdIP4EwdFxFarnw1dS5MBAADaRN/sN2THs5+X6MH/Ku4S3+FBANB2CsO7pObyKo5gi4/HABrGN/OcWu2VwTuk1BOgyQAAAO32HfLsf5LJp/+mDMReErFtGgICgHZRc3bIYvgB5YvQ52l0A3iWs6qrPOSit9FkAACAdr2IK6dk7K1/JNtf+T3pWCvQEBAAtIuc8lvcuzI/FM8KbxetN3/iLbXatsPz7kskAQAA0NZ6Uo/Jzmd/VbwLh2kGCADaQTG4VSpdum9y9yfeptF15pt+Wu+YCT0kFXcnTQYAANgEnOsJGX/l12Tk5OM0AwQArc62LMlHP606hjfGYwD11F2YFc/iAbX62chNNBkAAGCT2XLkX8n4W/+vWLUqzQABQCvLha5Trd+Ze126iikaXSf+xH612lXPqCxu2UGTAQAANiFv7P+TrW98SRzVMs0AAUCrWvEOS8l7teoYvuTbNLoebFt800+qlc+PPyC2xWkNAACwWfXOfUu2vvFvCQFAANDKcuP36AYA09+nyXXQl50W18pptfrZ8PU0GQAAYJPrmf+2TLz5ZbFsHgcAAUBrBgBjV6nW7ygelu7CLI1W5ou/oVa75L1aVryjNBkAAADSO/cNCR16mEaAAKAVrXd5ZXlI9y4AzWfTIWLVquKd+a5afe27RAAAANBaAmf+WAaneeE3CABaUj5yi2p978wPRGybRivpT50U5/qCUnVLcqGraTIAAADeZ+TgP5Oe/DSNAAFAq8mN7BXb4VGr714+Lr25GI1W4o+9plZ7aeQ+We/sp8kAAAB4H8uuSOTN/1Mc1XWaAXHRgtZRdXdKMfSg9M98Q20MX2K/LAUiNNswZ2Vd+uPfUaufU747BEBjHbr1m7LcN8K/g85ODgYA7zl161dktW+4fhfStao4qmVx2BVxlYriLi2Kq1SQjtW0eIpnpbMwJe6Vw03Zq47lgzI29Q2JXfYFDhwCALSSXOQm1QDAO/OkJPZ+VmzLotkm+zp/VKzqikrtmqtP8iN7aDLQzhe+rk6puLpoBAC877PRI1VXg4LB7oFz/rKzUpKe/LT0ZqekJ/WWdGeeEpHmeMQ2cOrfSzZ0iyx7wxw8mxiPALSYwuAOqXZsUavvWotJb+YMjTbMN/OyWu3F8Gek5uygyQAAAA1WdXlkcWCnJHd+Rk7c/M/lyH2Py+yV/4esBpvhZc22jL3zn5gkAgC0EtvhlEL0QdUx/PE3abRBrvUV6Z19XK1+LnIjTQYAAGhCZU+fLERvl+M3/ws5cccjUgj/sog07k7bruwPxD93gIkhAEAryYWuU63fH3tcrFqVRhvimz0klq3Tz3L3NlkMTtBkAACAJrfSPyZnr/41mbrnr6QQ+qWGbcfQsT9j5S8CALSSpUBEyr2TavWd6wvSnz5Fow3xK669mh//tAjvawAAAGgZpe6gnL3m1+XMzX8q5Z7L6z6+p/CKeFNHmAgCALSSXPSTqvV9sddpsgEdqwXpTj2rVj8bvo4mAwAAtKDF4E45dvu/a8jdAIOn/ooJIABASwUAoWtV6/fHvyuOaoVGXyJ/Qu8Zq9XgPlnrHaDJAAAALarq6pSz1/y6zO/5p3Udtyf1mHQup5gAAgC0irXeoKwGb9Y7MCoF8S4co9GXyDf9tFrtXPROGgwAANAG5rZ/WhJX/0FdxwzEX6LxBABoJbnoHboXr3EeA7gUXcWUdObfUKltO1ySG7uSJgMAALSJdHifJK/8vbqN54s9RtMJANBK8qNXiFh6U9iXeFSclRKNvkiayykujT4glY5umgwAANBGUtHbJLP979dlLPfKYeleTNB0AgC0irKnR4oj96vVt6pr4p2fotEXyTfzlFrtbORmGgwAANCGEpM/K6vBe+syVv/COzScAACtJKd8IeiLvUyTL0JPLibuJZ13KFQ7BqUwtIsmAwAAtCHb4ZTpq39LbGev+li9qf00nAAAraQwvEtqLq/eh8LsE+Iqr9HoC+SPv6E359GHxHY4aTIAAECbKnUHZWHX76iP0515Shy1Mg0nAECrqDk7ZDH8gFp9q1YRX5Jbgy6oZ3ZNvDPfU6ufDd9AkwEAANrcwsRdUvVEdL+31talqzhHswkA0EpykRtV63sTr9LkC9CXPi2utZhK7fW+vbLsD9FkAACANldzdkhqx99RH6e7ME2zCQDQSorBrVLpiqrV7519UtylJRq9Qf6Y3vKJufFP0mAAAIBNIh25RWrOftUxOhdnaDQBAFqJbVmSj35acwTxzR6i0Rs5oaoV6Y89qlY/G76GJgMAAGwSVVenFMd+RnUMzxJ3ABAAoOXkQtep1vfNvECTN8A7PyWOSkGl9vKWu2W9y0eTAQAANtP3/DHdVb88xeM0mQAArWbFOywl79Vq9btTz0nHaoFGn4cv9oreh3/0NhoMAACwyRSDO8V2dKrVd62dFMuu0WgCALSa3Pg9qvX9iQM0+eM+PMtr0pd8XKW27eyW/OhemgwAALDJ1BwuWQ3coTeAXRPXOu/7IgBA6wUAY1ep1vfGXqTJH8M3e0isWkml9mLoIam6PDQZAABgE1oeuFK1vmt9mSYTAKDVrHd5ZXlI7y6AruxL0rmcodEfFQDEXlKrnY3eRIMBAAA2qdW+sGp9Z2WVJhMAoBXlI7foXuTyGMA5udeK0jP3lErtSldUigNbaTIAAMAmtd4d1A0AygQABABoSbnRy8V26N0q7pt5miafgz95UERsldr56KfFtjhVAQAANm0A0BWgCSAAwIdVXR4phh5Sq+8pvC1dxQUa/QG+mefUamfD19NgAACATazc0ata31kt0WQCALSqXOQTqvX98f00+Sd0LmekK6Pz/P+a/wZZ7R+iyQAAAJtczeVTq83dpgQAaGGFwR1S9Qyr1ffO/IAm/wR//C212rnoXTQYAAAAYjv17gKoOdw0mAAALfvh4HBKIXK/Wv2OpaPSk0/Q6L/m0wpELIfkQlfRYAAAAIht6b3ny3Z20GACALSynPJz474EjwGIiHQXktKx+I5K7eLI/VL29NJkAAAAiFVdVqtdczhpMAEAWtmSPyzrvbv1AoCZp0Rse9P3WfN9CLnozRzIAAAAEBERZ3lOLwBwemgwAQBaXT56r1pt18pp6c3NbOr+WrYtvpnv6XwIuwNSGJrkIAYAAIA4ahXV+mVPP00mAECry4WvVa3vj7+5qfvbmz0rrpXTKrULkQel5uRlLAAAABDpWMur1bYtp1Q6emgyAQBa3VpPUFYHblGr7515Qiy7tmn764+9oVY7G7mRAxgAAADvBgArGbXalc7tLANIAIB2kYvcrlbbWUpKX/rMpuyrVauKd+Yxldrl3klZ8kc4eAEAACAiIp6VlFrtck+UBhMAoF3kx64QUUz0fPHXN2VfvakT4iinVWrnxu8TsSwOXgAAAIiISGfhrFrttb5tNJgAAO2i3NEjxdH79S6EY0+IVatuur76Yq+q1c6GruXABQAAwHt6Mnrv3lrzjtNgAgC0k1xYbzk5Rzkt3oXjm6qfzkpJ+uM6t/+vDN4upZ4ABy0AAABERMS1viyexdfU6q/2hWgyAQDaSWF4Umour1p9X+KNTdVP79xRsaorKrVz0ds5YAEAAPCe/vSUYnVLVvtGaDIBANpJzemWxfCDavX74o+Jo7q+afrpj72sUtd2eCQ/egUHLAAAAN7jS7ygVns1cJdUXR6aTACAdpOL3KB3EFWWxDu/OR4DcK2vSO/s4yq1i6EHpeLu5GAFAADAu989yyvSO/cttfrFoRtoMgEA2lExuFUqXRNq9bV+Kt5s/Ml3ROyaSu1sZB8HKgAAAN4TSLwmll3Ru0YYuIwmEwCgHdmWJfnofWr1e5NPiLNSavs++maeV6lb9YzK4pYdHKgAAAAQERGrVpWBUw+r1a+6h2XZG6HRBABoV7nwdYofUCXxzR5u6/55VvLSnXpOpXY++oDYFqcjAAAA3hVMvCbu5UNq9QuRnxPb4aTRBABoVyv9w1LyXaNW3xt/ra3750u+rVY7G7meAxQAAAAiIuKslmRo6v9RHSM7djONJgBAu8tF71ar3Tf7XXGtr7Rt7/zTz6jULXmvlhXvKAcnAAAARERk+Pij4lo9oVZ/ve86WfZx+z8BANo/ABi7Sq+4XWvbxwC6igviyb+pMyfj93BgAgAAQEREenNnZeDEl1THyEz8NI0mAMBmsN7lleWhe9Xq+2ZebMu++eP7lSpbkgtdzYEJAAAAcZVXJPLmvxYRW22MqntYMuGbaDYBADaLfETveZ+ehafFvVZsu575pr+nUndp5D5Z7+znoAQAANjkrFpVxt/8srhXjqiOk97xK1J1emg4AQA2i9zo5WI7tE56W/zJg23Vr97sjLiXj+vMReQWDkgAAABI5J0/k56Fb6uOUfVEJTV+J80mAMBmUnV5pBh6SK2+L9ZejwH442+o1K25+iQ/socDEgAAYJMLH/6a+Kb/s/o4c7t/U6quThpOAIDNJhf5hFrtrvQL4lnJtUWfLLsm3pknVGovhh+SmrODgxEAAGCTsmpViR74LxI49WX1sVYDd/LsPwgANqvC4A6peobV6vva5DGAvtQpcZaSKrU1QxgAAAA0N9f6smx77Yvim/4T9bFsyyXxK35DbIvLPwIAbEq2wymFyP16AcDMs23RJ3/8NZW65e5tshic4EAEAADYhHry07Lz+d9Rf+b/Rxb2/C+y0j9G4yEuWrB55cLXS+DEf1Gp3Zl7XTqX0rLWO9Cy/XFUy9If+65K7fz4p0Qsi4MQwIZc+cz9m26fj33iv0l6y+VMPoC24qiVZfjEd2Xw+BdF7Fpdxlze8hmZ33ovzce7xyAt2LyW/GFZ792tVt+feKul++OdPyaOSkGldjZ8PQcgAADAZmHbEki+KZPP/D0ZPPb7dbv4L3fvkelrfpNb/0EAgHflo3ppoG/m6ZbujT/2skrd1eC+lr4zAgAAABtj2VXxzR+UXS/8Ywm/8dviXj5Ut7FrrqCcufFfSrmjl4nAe3gEYJPLha+VLYd1ancsviPdhTlZ8Q633olRXpPe5GM6PY+y9ioAAEA761jNSSDxigTPPCKu1eN1H992dMjZG/9QVvtGmAwQAODH1nqCsjpwi3SlX1Sp70u8JSveT7dcX3zJd8SqVRQ+jF2SG7uSAw8AAKCNOKpl6S4mpC91WPpnX5DO/AsN2xbb0SHTN/57KQZ3MDEgAMCH5SK36wUAM09Jck8LBgCxl1TqLo0+IJWObg46AACAFuGslMSyq+KorIujVhbX+pJ0rGbFvZYVz/KcdOUOiafwslh2teHbaju7ZfqGP5LC4B4mDgQAOLf82BUy+pZD5WUk7uXj0puLyZI/3DL96FhblJ7576vUzkX2ccABAAAYsPOZn6MJP6HaMSpnb/wDWfKP0wx8JF4CCCl39EhxVG+JKV9if0v1w5c4KCK2wofyoOSHJjngAAAAYFSp/wY5eet/4OIfBADYmFz4ZrXa3pknxbLtlumFf+Y5lbqF6ENiO5wcbAAAADBmMfQ35MQtvydrPYM0A+fFIwB49+J0eFJqLq/Kuveu1RnpzZ6VYnCi6fvQuZyRzqzO8n/Z8PUcaAAAADCi5uyX2cv/qaQjN9MMbBh3AOCvP0Dcshh+UK2+L/5mS/TBH9d5XGG9b68st9B7EAAAANC8VgY/Lcfv/O9c/IMAABcvF7lBrbY39oRYCi8ZNM03rfTyv/FPcoABAADgklQ9EUlc84dy4qZ/KqXuIA3BBeMRALynGNwqla4Jca2eMV7bWZqT/tRJKWzZ2bT735NPSkfxsE4AELqGAwwAAAAXxXb2Smrnb8nCxD1SdXXSEFw07gDAjz9YLEvy0fvU6jf7YwBa27e85W4pdfs4wAAAAHBh388dHZKb+HU5es/XZXbHg1z845JxBwDeJxe+TgamdGr3xx4Vx5Wfk5qz+Q47y7bFN/OETk+jt3FgAQAAYMNq7kHJTvyyLEzcLWVPPw0BAQB0rPQPS8l3jXjy5l+G56gUpD91XPLDe5puv3szZ8S1Om28ru3slPzoXg4sAAAAnNd633WSmfgpyYRu4qf9IABAfeSid8twXudt+P7Ya00ZAPjjb6jUXQx9VqouDwcVAAAAzqnmCkoh/DnJhm+VJd84DQEBAOocAIxdJcMHdGr3Jb4rzqt/UaqujqbZX6tWFe/Md1VqZ6M3cUABAADg/Rf97iFZHHlAFoevl8LgpNScHTQFBABojPUurywP3Ss980+Zv9iuroh3/qhkx65smv31LhwXRzltvG6lKyLFga0cUAAAABARkaXhn5bUts9KMbBVbMtJQ1B3rAKAc8pHblar7Yu/1lT76o+9qtPD6P1iW5xiAAAAeFdH8ZR4lufFqlVpBhqCOwBwTrnRy2XU4RGrVjJeuzf5mLjKvyQVd+NfbOKslKQv8ahK7Wz4eg4kAEYcuvWbstw3sqn2ucrtsADaMQBYPiijbx+ULVPbZGHXr0g6vE9sB5dkIABAo794uTxSDD0k/TN/Yby2VauId/awZCLXNnw/fXNHxKquGa+75r9eVvuHOJAAGPpM7pSKq4tGAEC7XIStnZLRA/9EBk5dI4krflMWByZpCuqC+5PxkXKRT+hdeMdfbop99M28pNO76N0cQAAAAPhYHUv7ZeKlvyPRA38irvIqDQEBABqnMLhDqp5hldq9c98Td2m5ofvnLi1L79yT5gtbDsmFruIAAgAAwIb4pv+L7Hzut6U3f5ZmgAAAjWE7nFKI3K9UvCa+2UON/aBNHhSxa8brLo18WsqeXg4gAAAAbJh75YhsfeGXZSD2Es0AAQAaI6f4IjvfzAuNDQBiL6rUzUZv4cABAADABbPsioy99Y9k9Nhf0gyo4CWA+FhL/rCs9+6WjqWjxmt3p56VjrVfk/XO/rrvl2clJ92p54zXrbkDUhjiJS4AAADaTt36FVntu7THVS3bFmdlTVzrS+Jey0vn0qx0Lp6V7ux+cS+/07B9Gzz2B+KsrEnssl9gokEAgPrKR++VLYePqtT2JQ7IwrZb675P/sTbKnULkQel5nRz0AAAACirujxSdV36stIVd5eUuvwi3rDI0OXv/bpnJSP96aPiiz8t3ekn675/gVNfFltE4oQAMIhHAHBeubDecn2+WGMeA/BNP61SNxu5kQMGAACgDZS6g5KK3CIn9v2vcuyev5LM9t+WmrO+d64GT31Zhk8+wWSAAAD1s9YTlNUBnefauzIvSedypq770704L57CW8brlnsnZckf4YABAABot+/D3QMS3/N5mbrnEclu/U2xLWfdxh468r+Lf/YtJgEEAKifXOR2tdq+5MG67osvsV+nR9FPilgWBwsAAECbKnv6JLb3F+Xk7Q/Lmndf3cYN7//H0r0YZwJAAID6yI9dIWLpHC5at+Ofk22Lb/p7KqWz4es4UAAAADaBlf4xOX7r70lm+2/XZTyruiTR1/+1OMurNB8EANBX7uiR4uj9KrU9hbekq5iqy3705mbEvXzC/D8Cg7dLqSfAgQIAALBJ2A6XxPd8XuLXfklsR4f6eB3LByVy8E9pPAgAUB+58M1qtf1Kt+V/aJz4mzq9id7OAQIAALAJZcZukLOf+I91eUFgf+IrMjj9PE0HAQD0FYYnpebyqtT2zug/BmDZNfHOfNd4Xdvhkfzo5RwgAAAAm9TiwC45e9P/XZcQYOSdfy7dBd4HAAIAKKs53bIYflCldkfxsPTkE6rb3586Kc7SnPG6xdCDUnF3cYAAAABsYsXANpn+xB+pPw5g1dYluv/3xVEt03QQAEBXLnKDWm1f8m3VbffFXlOpm43s48AAAACALAZ3Suy6P1Ifp6P4powe+xYNBwEAdBWDW6XSNaFzgT79pIht6xzo1XXpjz9mvG7VMyqLg9s5MAAAACAiIrnhK2Ru779QHyd48o+kL3uKhoMAAHpsy5J89D6V2q6V09Kbi6nU9s4fE0elaLxuPvqA2A4nBwYAAADeM7/1HslHf0V9nPD+fyPOSomGgwAAenKK693742/o1J15WaVuNnI9BwQAAAA+JHb535A1362qY7hXDsvY0UdoNggAoGelf1hKvmtUavfHnhLLrhmt6SqvSu+s+bf/l7xXyYp3lAMCAAAAH1JzuOXs9f+zVDt0vy/6z/xH6c8cp+EgAICeXPRulbqutZj0pc8YrelLHhKrVjHfg/F7ORAAAADwkUpdAYlf/c/Uxxl7+0usCgACACgGAGNXqdX2Jd40W2/mRYWttCQXupoDAQAAAB8rP3SFZCd+Q3WMjuWDMnLiUZoNAgDoWO/yyvKQzk/AvTPfFatWNfNhuLYoPQs/ML6Ny8OflPXOfg4EAAAAnFdiz8/Let+1qmMET3xJuotJmg0CAOjIR27WOSjLaelPnTRSy584oLKN2eitHAAAAADYkJqzQ2JX/a6IWGpjWHZVQgf+g/H3aYEAABARkdzo5WI7PCq1/fHXjNTxTT9r/gPc1Sf5kT0cAAAAANiwJf+4pHf8juoYXdlnZHD6eZoNAgCYV3V5pBh6SKV2X/yJS36RSedSWjpzrxrftsXwQ1JzdnAAAAAA4ILM7vyM+qMAQ4f/jXSs5mk2CABgXi7yCZ0Ds1IQ7/yxS6rhj+9vqX0GAABAe6s53RK/8h/oXuBVFyV06E9pNggAYF5hcIdUPcMqtX2X+BiAb8b8y//K3dtkMTjBxAMAAOCiFANbJTf+a6pj9M3+hfjn3qbZIACAWbbDKYXI/TofXInHxFkpXdTf7cknpKN42Pg25cc/JWJZTDwAAAAuWnL356TqiaiOMXrwD8VZXqXZIACAWbnw9Sp1rVpJvHNHL+rv+uNvqGxTVmlfAQAAsHlU3N0yu1f3hYCutdMyOvUNmg0CAJi15A/Leu9uldq+2CsX/Hcs2xbvzJPGt2U1uE/WegeYcAAAAFyyzNgNsjJwn+oYgTN/LL25MzQbBAAwKx+9V6Vu79wT4lpfuaC/05c5La7VGePbkoveyUQDAADAmPjlvya25VQdI3Tgy2LVKjQbBAAweHEc1lnOxKpVxDd7Yc/y+2KvG98O2+GS3NiVTDQAAACMWe0bluz231Idw7P4qgydfopmgwAA5qz1BGV14BaV2r7YSxs/oKsV8caeML4NS6MPSKWjm4kGAACAUbM7PiOVrh2qY2yZ+qJ0LqdoNggAYE4ucrtK3Z7574u7tLShP9u/cFwc5bTCvu1jggEAAGBc1eWR5N6/rzqGVVuT0Dv/mWaDAADm5MeuELE0Dilb/MmDG/qT/vir5j+UOwYlPzTJBAMAAEBFbuRqWR76jOoYPQuPSlDhuzIIALBJlTt6pDh6v0ptb+yH5/0zzkpJ+uKPGh+7EHlQbIeTCQYAAICa+N6/JbblUh1j5NAXxb2+RLMJAAAzcuGbVep2p54Tz0ruY/+Mb/awWLWS8bGzkRuYWAAAAKha69ki6Z2/qzqGcz0pY0ceptkEAIAZheFJqbm8KrV9yXc+/vcv4GWBG7Xet1eW/WEmFgAAAOrmtn9ayt17VMfwzvxX6U8fo9kEAMClqzndshh+UOfDKvHyR/6ee31Zeue+Z3zM3Pi9TCoAAADq9F26Q5KX/5b6OKEDXxJHtUzDCQAAAxfNSrfMd6VfEPda8Zy/50seErFr5vcldC0TCgAAgLrJD10hxZGfVR3DvfyOjJx4lGYTAACXrhjcKpWuCZXa3vmj5w4ANvCSwAu1vOVuKXX7mFAAAADUVeKyXxbb0ak6RvDEl6S7mKTZBADApbEtS/LR+1Rq988d+NCvudeK0r3wtPGx8tFbmUwAAADUXak7KKld/1B1DMuuSujAH4ulcBctCACwyeTC16nU7Zn/oVi2/f5QIHXS+Di2s1Nyo5czkQAAAGiI+W33ynrPFapjdGWfloGZF2k2AQBwaVb6h6Xku8b8AVtOS9fi3Pt+rW/+oPFxFkOflarLw0QCAACgIWoOtySv+G31cYYP/4F0rBVoOAEAcGly0btV6vZmTr3335ZtS+/sc8bHyEY+wQQCAACgoQqDu2Vx9Bd0LwgrWQkd+jOaTQAAXGIAMHaVSt3u7I8DgO7CrDjXF4zWr3RFpDi4jQkEAABAwyUu+yWpOftVx+hLfk18CnfVggAAm8h6l1eWh+41Xrcre/jHAUA+Zrx+Pnq/2BanBgAAAJrhO7VPFnb/rvo4Ywf/rTgrazScAAC4hIvpyM3Ga3YUj4iz/O6HU3fG/AsAc+HrmTgAAAA0jYXxO2W97zrVMVyrJ2T02LdoNgEAcAkX06OXi+0w/zK97r9+EWB35h2jddf818tK/xATBwAAgKZhO1wSv+LvqY8TOPXvpSc/TcMJAICLU3V5pBh6yHjdzuK8OCsl6SgeMlpX68WFAAAAwKUoBndIIfw3lUexJXzgy2LVqjScAAC4yItqhTfqdywtiGc5a7ao5ZBc6ComDAAAAE0psecLUnMFVcfwFF6WoTPfp9kEAMDFKQzukKpn2OwHUzEhnUspozWXRj4tZU8vEwYAAICmVPb0y/zu31EfZ8vUF8WzkqbhBADAhbMdTilE7jcbACyeEs+y2QAgG72FyQIAAEBTS43fJmvefapjWNUVCb/zJzSbAAC4OKbfrN+xdFS2vPMlY/Vqbr8UhiaZKAAAADQ123JK4oq/qz5Oz/y3JZh4nYYTAAAXbskflvXe3U27fYXIQ1JzupkoAAAAtMB36wnJR39FfZyRQ18U1/oyDW8jLlqAeslH75Uth4825bZlIzcyQQCa1pXP3E8TzuGHn3mbJgDYtJK7Pyf9ye+IozyvNoazFJexo38u01f+bRreJrgDAHWTC1/blNtV7t0lS/4IEwQAAICWUe7olbnLfld9HN/0n0hf5gQNJwAALsxaT1BWB5rvRXu56H0ilsUEAQAAoKWkw/tkzX+7+jihA/9OHNUyDScAAC7wYjtye9NtUzZ8HRMDAACAlmNbDolf8esiovvDrI6lt2X41OM0nAAAuDD5sStErOY57FYHbpNST4CJAQAAQEta9kYku/U31McZOPZF6Vqao+EEAMDGlTt6pDjaPC+zyo7fwaQAAACgpc3u+mmpdoypjmHZVQkf+GMR26bhBADAxuXCNzfFdtgOj+RHL2dCAAAA0NIq7m6Z3fsP1cfpynxfBmM/pOEEAMDGFYYnpebyNnw7imMPSMXdxYQAAACg5WXGbpDV4L3q4wwf/qK4S4s0nAAA2Jia0y2L4Qcbvh3Z6M1MBgAAANqDZUn8il9Tf9+Wo5yS0KH/Rr8JAICNy0VuaOj4Vc+oLA5uZyIAAADQNlb6RiWz7e+pj9Of+Kr4Fg7RcAIAYGOKwa1S6Zpo2Pj56P1iO5xMBAAAANrK7I7PSKVzq/o4owe/JM5KiYYTAADnZ1uW5KP3NWz8bIPvQAAAAAA0VN1dMrv3H6iP416ZkpHjf0XDCQCAjcmFr2vIuCXvVbLiHWUCAAAA0Jayo9fKyuCn1ccJnvy/pKcQo+EEAMD5rfQPS8l3Td3HzY3fS/MBAADQ1uKX/6rYlvYjr7aEDnxZLLtKwwkAgA1cjEfvrvOIluRCV9N4AAAAtLXV3iHJ7PgH6uN05n8oW848S8MJAIANBABjV9V1vOXhT8p6Zz+NBwAAQNub2/GAlLt2qY8zdPT3xbOapeEEAMDHW+/yyvJQ/W7Jz0ZvpekAAADYFKpOj8xe/tvq41jVJQkd/BMaTgAAnF8+cnNdxqm5+qQwvIeGAwAAYNPIDV8lS0M/pT5O7/xfSiD5Jg0nAADO86E0ernYDo/6OIvhh6Tq6qDhAAAA2FQSe/9HsR3634NH3/lDcZVXaDgBAPDRqi6PFEMPqY+Ti3yCZgMAAGDTWesZlNTO31Ufx1maltGjX6fhTcx6+8lHbdoAAGYslUM0AQAM6ZVlmgAABnEHAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAABAAAAAAAAAAAgAAAAAAAEAAAAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAACAFoAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAGDc/z8AZKi2E5CoEaAAAAAASUVORK5CYII="
,n.ImageUtils={},n.ImageUtils.registerDefaultImage=function(e){e.src!=null?x.Logo.src=e.src:x.Logo.src=e},n.ImageUtils.registerAlarmImage=function(e){e.src!=null?x.AlarmBillboardImage.src=e.src:x.AlarmBillboardImage.src=e},x.ssaoNormalImage=new Image,x.ssaoNormalImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAhB0lEQVR42h2a53IjSZalXbuHhKDMUiNs9nnXbN9vpnu6qzKTJGQo1+570L/KLIsEIsLvPef7ANL/93/rxy2PO+5V6j+KPUr+lfJQl0XtVNIy26BTzUaThcVh0uRAlliahmyMmtvW7tsphNbnu2l2U3FHkSNpTCBX5bscl9ARkyQVLPBaryQNQs6Rval4v8nmkNbImRNKl5yYEXlKlfXS0BDPtb4o/ZnXLqtJ2ybteSFZXUp+E+UuMrsZ8paHzMUaiZLX250rW05Hqq7E6qpSrqYJPG9rVY1bbZZJWOM7M39c6Y5zv7IQKRuqO11oVjMr1dtbm/r/FtddyV9K8itZm9wFWrfFEpfL3ojjQn+ITLowfcbcNrf/DcVo3kbl65nwXRaS48aI87w9ZPtJnSAsZjdoWvOEB9auKdBrpiU51i3rB1PjTty3MvIY7qKqyG4600xVqSvlXRBTvvRiXMvAY66cRbYGelD4n/lJ8ESXy9T9h65/KcuKefH0RGvd4z1DKnUU9cZK8srFwnrbZ1mneBvkPtg848ok9TkPXOssNJlmujd03WJtk75LIeJ6k7J63gk+4TmUbgunRr7MPHPPiE6Z2UCMoLgKoSUrW2sOLjAz8/q+0dvKW87zhduh7EJKtIRWMsWHuZy7uqdVOrWSTHQ78PJFWJ8F0/zCaLOpeV/7leM2Vh2lk6I43/Nyb2W/cdV46wPnpYsvDAPZSBrSIqLLWol1wU+3dY27Q/pSXORKvUy3XKTu73TpdZNr4oF2wnO238TfRO1lDkmLvfBnsrVrs+qyj2zZkXaWtuT4ksz2OHpNyuzY+yVfWvrs6xaUSdU1tlbcuqK5SlrWjzAe6GlX9xNNLQ1rbCZaWrdG+pSt0yoGRXzVRkcdqNWe5pCzSYx3bomt8avsJM2WkThtxngaSeVDLdlY4vMzlyuRJXpCyVpUrLeGvaVyX9QfDRFr0ZKbaR/fVnajrIvpPNanQMk1hlFQJkiu4yy2LvEos8mMlXmoo+2iTWlI1MogC+sSNkxdo9tz7SjtoihkKbrTrmaRlGg3b3ckp4bcS6OEpcpgiSR+ve/YZhtO7yV38pmKz6fcOxIDl5nd29pVrq9l2dHKECiJztx1qXPKNxG3/DVW4b3HcPc3fiJEDs57sj/n1JZ8YOpUiuG44nWsbcisQaoQ19fnW72X2u2ZO9fR2Pmu8jNpZNGcFMqLnZkweALGhVlUlgRzMRmhU9zCnfZ0S6yrDpePEccq0MzCmtUgyhYmpbtrvQmkYp7n1HjBFXF70iCUTI20lEFol3JXw62aIfQzVmjU/mJXVg8i+ZNJpGhDPyhGWSAXsBnDv9bbRtlEYfeltTFVkk2zfs/q9xxOjB+Lniqe5pmKjgd+NNEpHn1si/aiSi6GOl3ZSJhmpm6FNOzqybEh2ZIl16GheAyJBaIUn9Ld1F9KOX/Xe11PQhIehNNpF7C9BnHpWVeEX3R8iuNWMgK6rKs1pV+Zpzo3RQhipW8XESwzMUrh3GzKaDGRPBc6h4A46qrZrHim80doj5ReGtx1UEE2VeRELnwZFgyAiSLQFFKoZ/pHX/5Jpcyeclasf9I4WDKxIJDIKmPoqcvBpNip/UbuzPB9Xgttuy1fZLSZ6iobv91lt98cCsGTZs0Rx90hQLA+S2zG8vOavu3pxSnmOK2UfsvYtXuRpsvywqlkiyJDqy4RA12lZvfsVaeZzamn0ti6oakoSf32Mu9uLenTmsqgCylNtul7oMNSt1bsmciZTraivAyGztD4PWE9mhYdgMxg+zHdL2FQlXETTpUqEn8hT5le0ShHok9q6wg3JVGWqH4NQuQSBafnH+z5EOc0DOHmexMpJR/MjyhInJ5YR3qq27do7reweyaE4Ce54DE6c9Rp4TVuRFTSLtG3XP2U5SXGWyGtdGgemfaa3CMJHS5AfPg4vFW1SnIt9C2RT8XekPvV8dxm2nH6/R/85Rc/1XGYzvnYqijMqcydTCE8Z4Jb2YIfkPvO5j2ZlBSyshoz/V2mSfR2u7dtXmtDUzmEuDWNirj6fGFH3Zykefk3ejvj8UeSCgtKGbJQJQPj1sg+rAMeawrHSq6aHnF7RTE6Vnaq6DWyZjaJ+tKq7btzbfztWP9cRPtGYsShiG5KVnPpsvovVS+0CX5tO3KnlHk/1t4rbfIJrX1TR8MTfvBI5aXK1otAKmuZ+PLR1NJgMmsr46TQN7TlsQYaQ6yjkjff6LRdMXFCBVGTrEMqjoEZJOhAh1k2MiXULgbaHZzauHWkU/lnEzoqxVITBjsFlwlrCyvdT+WRbORGZVbi2TmbqOdhx/h3V3rGeEGOHZpoBSsZUe59og3W4kjryS1tGiemOp4dE1qQr3MZR5Zzlniyia5K77c8c+a7olD6mW6XzPfGLRzXpi6EGUmec/8lAVRxJoVFwMZuqrOgQ2Xz4OhiMk3diwRijUt1W26PqO56zeIoq0XxktJeJPDFaEaaKf+j5z3nfVl/SPrGiKd4SY0pJ7q6WCWJR6XuhLRk+6zyxQxX6mQql9K+tkIw1rcedx8LpikrmpwvYWB5YeqzxpHQmF5b9rd7fR4BVlTu3VcVB2dW4xklfCiR6MMd8xMCYynl6GWfY1VoMoQ3S46w32hKZFgpjuge8WxjL+IXTy9F20zKR6+/MTGFa2THd2fvBBMCdMqhEuznSMO98rWkHXVzejfiH5f8uqdkpuzg77wI56mImpjKXeWV+51QpNabGwcZKcl3RnqBFTyYbZmHrg120QMgpHpqKGKe8Kgnd8Vv3dHoADR57OO9FQikLkVJWKZgtYKzJa0LzaNN5djltDWg3FDQ092h3LfYdThIxSYCtom3CEzWB14KrTern4AhpFhWdxjdLDmZ7qptCvCkJiqahO2ldOH8gMIQ86fnIzUHYlNNZ77v07QCjZI66Ja6ZePj3nnLWDCc1Nig9KV84tlnHOOpELpzt4n3HQlmCxcEqNdKSZZ1BQQQlEshhs/LxpDUlWpC1oBarJGZ3lx9ypTmqdDntF/YXz/D846EPdiRppnVpnYL+QK17CVaLzrUUWh1KzZA4ZwoxnrRCIfxIG4htje8ARGvOW6SN+ugm8+tNKWiisJNDTqcOypsamdxquUbKMnEbdNG1M0JoaARjp9M2OW21eCM/aLzIZeToV1gMbGh8bkMK6YreE2ajQx7Ot9c07UA4xR1czM3k/YHZj2AUnKV1xfWO+aF3Rn1ZWnralWZbxwjIpSM0WQflSphPtP9b7n/YRzq81DlwmdwpWCLTSN6tAHgh6lP/IO1r1s1yGap1XrZ6mDrXaS24c1MQ+PSyMQuDxu/N5v5Z0P7BNRH1GB8HrsR4hPJJyWOlTWFb0jqST+1dMPNEdooevP+6S7iW2UTtzgnRbqFkc1FVqdAZcE8qy8Sqi7Son+uEpyrmHINf2Ph6595HOtVwHgQoan7VemFWTzTVEDjhpXemeU/wmHiCV6kmIyMHBSxHNHNbBJje8ri1w+xdg+qef9L358TkCXbKm+ZiEIbKmj9snIYsIil7pJy0vaJwO82jEMdoxY43jXfPsPQNUwUP5VRl/Nr8y2lS4QrSqAkCtgwc3tnwpnSIl2qB49P8IgdnJbqrSJhFLLwWj1LZtb00frAJVHQMre8xpqZ3sWcRFkuybSUzxIxtkLfsGjPUALMBl4Ng8eBfwoB9UYbV26pNETrYcV1T4eqz6yTs0jQyZVxvWPkQ9lDLBedevWvt16x53XxfMfjpRK+ymKkJJg9EWc2TFmMxZ8c7oo/3dza9AQtM7NYCdl7ZLS6c5qJbSuTPnNNcqBPiVwl6WinRLLb2ulxZjcSecfQa3jtAiByGTVagthgPYnJsSBWko3UqydN5lq1K1uR7Z1vwjVDr+Dysa1ivS8Mctd5iINeZW2wJ7xMPR5IovceUUNa03BvJZzKtmNsgxERw60V3nLpekLL/hp/dPKdxemTqZZwaeeWdKR+nMTvfIMRBjjNnhOEvrdBtPTPnHZVWoREhkvqDBSsAxEpIFJZq8B4Xn5pALzFlDdI00furU6N3bZS3Ut2yqGPKqagubZdaVf6s1E7POzZXTv9VHN74Unm3G2cCyXq14W/4sF5oncpmArj4NQT0nEC/aZy5vI5MafEcBTXJRyTllitRPbjCkNb2mkgHbQmY5d4QE6z/5PZatDgxKod0LOk7178ZtgHzF42DjpZTR7YNkbxExQIwwNRU/rE3aa4qXmriglQAAfGU8YXUkaEDPWFJKOfnbr3Xu8pRSrODXpndeW98650pFszwplJsdEqmkpRGUe2D+HvW2xRlgTiUZ+asqaEx2uKXFcxN+5FdrfzmoeGAxBSYo0Y/ynPQ2k3w5t8g/7sxX8Wfq4h4mEpqAc6qEgXw4nHdyHXEGHwOpYNJ+Zva9M95fZngguXh/SJ3KMLiN5XnfIN3czjfq6XqvY7cHEk3O8Tv0EgmrgXZtuchoFwSTWAbdH8FL7E8Fzsuq8mpGZVN0gcQ3q09q2UhT9d80V43nUgeranPIGx5KS23lfbc3Oh0MXdrc4EoYaGIooWkG4FAqBxn7kA7HdBeFl8pozoRuM2wv9w+l4fLPAly4AKSHaW+Z5LbQxj1mCjwnERd2AcxMJp+8riVv64lh8Uqt4OpIibi+/Y9JiV0UItPyh/skxYfhkzr9RUsqT0eimBs6+jHyYIVSI83YGlnPUsPx49smjN4oWnTtYpaV8DfEMxLDwfS1gpaSkcmSu6LXgTWw1XiXxfyDgG1vDPWp9ZZR2BqqYbZZlwIWi3nKN+rWW5qnwoQJJ9YaeUDlMiRP2JgYxkSDnBuP8g+Tvtnsd0zuSwgax1sp59G/TsOX5Yu9ry1XPFcRHjuYnHlK2TzZHQlViRVJalq7LWsFT9yfNOWZoUafSYvSSwftPjNIDMPE9ZdmypHE8BMrY31Z8rM6ZLa70p2+CtA9qxM3kmIFS9k3K9BfVbS4FGqVg8g5FuKxaav6ThhDXJ1fKH4Gnkh9XCWKxmbVWen/LhZC8tMomUpAmmqPI5p0OTapvLxtRWHcpl5GUNdxrbla0Llc+F6A2BPfR08zFXyr8wKCLcMx+iISL7OivEFmiMLug0SsihFuuaBAnm39p4usMbgLGyiTiMUhhvfivutEI0NKH3JFWhI6k/awiGCu1dlDoxsUh6AB7NyJHc9gTzmU4ksyis5CLhv6HSIJJuuFvI/v6gYzZyReh2LZzLAY17Y/1rXm8CboxomRbfMzrdw04CLVBGIPPmhi34zddbvImmB9nxQGxk0QhMjmSNqp8/VHcMWciyEobdeRbG1c9z/QYk9ewm486LhZObrr2Um0/syjjj6omJXtDzLZhYdadWy/KQhqCs3pBqVDBfcw9chDpfLOJqIWa/91vAFnPWRGP45zntWhnOtN+xJSS0Gc/1nNPY8JU5ODhpCO7rjXf/xEY05GXNM4MnyiYz/Nguyc6U71N8f0PZNcLbOVM8n3apfw75aZNLs44blZgUBJPlBip0R9PQzCXvUohJ+EiY0oHHoST81O1UB0nu89D0KVqCJVMmLU6YA/xFNMQFdERIipOTNe2c+kFrwedv2V6IkpRXcoLzPOo2jlbFHrRs3pT+4GH8S6IZv1T9JaUPZFufjx7uBYDNo2nv1GE8OVWdigET4NXuA7+ay/3odkEsxRu926cH8+7SxMRIbAi0z6BGZz8c+b2tP0V9krkNBel76MTmhRjCZmtXxcC3i1VH4q2tTHmCTLyk9oncM6ZwKksTChcxDsR8EHdoKVziGHAcail89PlHpq8rnZ7Kzxz+zcqTJL8T9/evmjp+I+QXyZYSuglBiJhuv9VwHmqDl7O5MYVq6xJpDwnC6jAzYiaxqdFW/CPg+9ciTs/NYVodVoEKyfxW5cDoDb9MabiavXa4k6TUsVJHK3pKbnW9gHkUhawwQei4qdLeotqJuYZnpudzpapa2eG0eigOZ5LQ7538NScP9BsgkebThF90PUuxW+t3y15Qdz3aNI85+NCYewFaIqZhBxmqGISdWWOwkPzKmy6UPXq5o/vAyRVT4fJspVdxlGGFw+IIZmh0NSK5nXITRd4iMT3FtLEIIzSUrLCmoZYWvL1LKfYEmw3Ae/LU0tK85LqWbeODMqwJV527ewScLC0Ha+BOO5aWq5yE4zaxth44p5pZTK3pXaqOuvce5qVNk6mvZM2q5Vtfy0xXIOojOP2ydebgA1gzzkJs6NMywL5njHZuzmXpAeR0CcTIQBpZfZAC1CFcD54vcsq56ZgGwIC++4kZeU+5Z4fZ2UbUO1GmnoXSu2Bk+ZH401e+Gt0PWdCySPP4ZgH9nPII8aKBWjHzKG/ixTQfpQxY+I7ax0e2Od+Qy1TsJPAD7TZr8u7omZKG9fmp6Cgf29trsbZZrdFemBK8RuKfEoYUj5lONXHW7nDgoNAau/x6LydX+hY1XTcbW4uwsr1gxFCHhUcspNjsql1NBzYJ+baJB6L2tYc9ZZk2NqRwfykNcJpBDJSgQLhEIFYlWDwlFaiu6cQxAG0pn0/p9avZaJIXElAgXbYd9KZanRo8MliL4gHxNFr5ycSgozV6jvn4N1meOV6WPgEIS/CCTRQyac7JjSA7ZhvOVq6kB/7SMoBVAJllZpspv0f2SZgeLN243AlWmI9JZ/xYIZyFt4RyHiKdHH/qAhxkqqBTOUB2pRAycieBKbrB9pvTFIf/0dsLZUHUt6yC34rGkmlB3ezVgdSJu4Ht8ZuPD1TuKe1YnOPAi/q1g0pXUxgDbjZsiCsnA64RuhKbYcxiLj6lRMyB++/Z7cYyXQob607QuyM9ZGYhCVgEm5miGDMoMD/pEMjhziLDMdR2DOezQHP3vrS9+TjHF8jkS0ZbX6N7H+l8jqoFjOsUkWT1s/oxtXLwjy8fUNSSmNzMfdRrRr6ItFF+aOO58L5wn+8hDqJ6QHvcabO4S6ubaNdEd49v+2aL58nogIXAuJlBuNsXGRq8caWr8cU91kVVxliZiuglWQI/sHCqY1fPG33eRTze6Hw3VOSUY5TO9oAne3D0R0u7wHdt+GL6ENJCg8wVw7nVp7VfYeiXfTQbs5EcBKJAAr8qIzsi2N7l7whP1qS80A6VjK1u2mVdEEl8YPEUeDfWCp5tE+6WHGi/+rXKNZVeNFfE0IrYxoJusNGesBMprS0g0EHGHy1vL6Td4ZqVeYXHJSiiigUQAmAVJUaiiuJ84vSbpyH0P+qGqFhzJ01E+IGo+oUuba1Kkw1SWwfaIqk6zBvNO2q2AsnQTNmqyVokR0nBUjJbbv1xhzZg2P+RyRQ2mvOVqaGl4UddhoahvhugMmltxn2IimElogt3aEBlpUVCJvZZ+7GmXzO90TxQg8UmnKYgcAtQQEauz8Dj5koSfuo+iSfSPSaPUKKlJcA51jCezh1/kfQey+PohSg2uBKkPDbs8knoqxE3XpAONQqatkeXk7qYeHBw4SRFwi5Mce6AwbG+m/xRFDtmsz0+cAVk8Z66jBetIm8gT4X4L9XL2lsy0kqOJm5RXWr0ghf4qqAKLSaiysctf2dy96mAXazFe1Gj/6V4Q2EW74gGpF6QRdNfZg4g5T2B/UA8afdwx1dRPopUBwBQElzQaFmBzyAsnKivjHyy8OLIVkswy0ifmf28Atvy6SoHs7lG5IenEe0NxNoAUxINpSk92RI7SPrnjcL0kIglRGUEi9U+pTaL6GHPTD0XMNkH5L0l7CxmRY+34loSnICUrlvtaKOCRSyFlosTId9cmGncOD3CuZfLZdQqLqsQ3BdAdWEC6wIvTsqiKfcm+p8YCck/oCaYu+Rzxf1jDxdS4a9LoHlOus1Nya4IrbevOe1EbGgjS5lCdVt62fENzqAiUCDUJExqSTPb0GBcxxKv6LHSEKUv25WrDjKgQ0/UnSJZCHBiE74eSGOjPyP2pP0uGAK9Eh28jShCXyAyfUbQwy2bpyD2Q/3BgBkG/G0rett0JYd9wboPqoSLOeziVahXES8rLxqbDXyHDMS6r9nm/c74UAedLncxdijsMiPWDImI0Ao2kXxVlSasjMIpWDGxDG3gYpmZbg1xiC/Gc0hmFG0qf/f1D8FPaBUSnWiHHNhTPnv6ruuPi/5tDF+aPyt6nqXUvsVEgq/RELGygdWC5bLM97B1UqFEvCEL2b0Et8AyYngggDsE5SikhJinx/QzEjtSgwzWFrmjeSm5U9gO9KtM+v7Aa08e3zPJoXoY2WRsk9RS03OlNHL+r69WycJ5iDAcNGNHyjWRHiuFEdyRmpl14SDMdcqvjyuRsKN6q9gOedWhxQHjqvdi95MivEAptmdqzrlQdaRxovEo9JSZpDlSBgOoGdEQBH/8YxJM0aKaLQcd24y72zLdk/4rfPAyEp2lhfCsmRmVJwKpqrso3m7yS1FKkn08uuotqfCvJvIGqQUYBtnyWxMXL8c++1sMlPM9qxMGgOZzJQ0smDr16F7EGrgs+SLOl3rQUdyRUqUi5mtKe6FOFDKg1wrtHmwyxxg/jXihYYV6pw1DjSGc5kX1vwCwJBS3O8p0dVUaRA1SIR8DucB6AU4b4jA3nsKv51YaTEXDiheBpbo95htBt5J0KHxdUYbJrFKRuM5M8MhHqj/Ztg9izlPlu5WqvRdnHY91CXngQMoqRvO4oqb3m5HOinat9CtzpfjM8GQHg2Os5W7Ur7L9pJcBt4rh0mgd+p99/zNddNWxEQ29T3oQZT6w/h7IYB5wFLnfMrye4PUq3AvVmoJmqLOjYEs24rdAPyS2O0dp28irVpmNOv0cGF8F20r5GV2n2/nxARHrkTl5W018l92F3Q2sOrmDFDDHk9ia1WBGO9Bbz3QAqsN7sj5nn0vTlVny/s88dfW4wXPRfSSMhVwCB1tBTsGJc963/AvzuJSi6OzcvhLfOlzuE1k321sjWlAfdg+De22Q8njlbuVURBfFjroliIY7AolyZsS1ARRwUEp77lnL2bWOK55z1fXxBfas8j7CucX+RsRUZRvaqY37xGxbgdS3vnldCz0Vv+OPz9OvdSAsvAd+V0SkyGJ5rm1SaY0BpQ1hspQJXJ3AKDlYHaEteXwml+0Dgb3W6ZAGn9c3Rp2Jf8EP0fptL7DWqaiul9FaKh3qQT8xcW4Sz5Qw4Fv5gtWuHJG0DTUpg/0klJZnr2fIzgrgu3RRCO23lWJUrhlVGTBW+y9vn1hWRC+PT28Fq3Oi3f3xWUi2NPGKvcITY0+cXoowJcwiHIH+xYDwofXLFpQChEgXpqEe0Af36o+qvYcl3eWOPYgvOQBD5LTJTjHugX870m3+QmQrCKh2bMmMIJw8fWPZEr4B/h/fQgep9L1W4awVOuZWEuGpVsM2TWy3g4Q0cYq7Xn2fYkelGtI2STrgdJk/Sa34NpQdLemrhp1mf8X6DUAT2Vsdf5CyY+ulyjFqJgFssBM4kFnF4wOYX+J8qTtaG9oi4zi8WmQcbbOySdD9VKDaJCbXmzbErzv54xjPttmnfOm0uwQltex8PSv+muEp4wXV8vj7lX0R+SaglHa2da8FEjtN2bRsCls/8sdnKhZcuuIZEYczBgoKafMs6OEFJ5zNQLYJ8UPheWmvtC14Ayg/TXVSy8GKBy4XXFd0ofx7Zf+7k3rdKDWFzuOGpVR3vrVc+iEoUL2r3COx5KsCucGZ8mqkBh8PIq6JbZwfbZ64qd7pwlnF262CDggo2WuQ9OOzzX+I9/d6ARxpVb4kbSuRYCRdZW0tpE4/TH4gYQLopl7wGeiK7IaxUDaSWDTJniH8bGOP0SBwsDKvtNyPTb/lPzkbLtntuxF2eTfbsYo5GWl4pKmUDaeheUWxNeKIAvhvOfyRYGAUuHUWpaVPOl7co3nGTU6GkYx+YXFrBBPCw0ZDcisZX/0i++G+rJ1kvySMaxEJJz4Uub7UeV1faDv/iM0zxhypDI9EX4te0WmsFjxeeIv+B5Lf0TI1OYIYfXwIZ8uD/XAWgh3W+lFS8171JggMWj7+jC1Q1gc6i0epjzf6sbDxv5z1ff85TU9qfC5zoKg7kvIgKXnP4bYOvI8np1/JjDt4/AXbpa7wIkqbzU2qoY4za5td8B9NM9ibkvyvDotxW8X+d7KCZlpLJ8Q7hFbc5iQGIkuDNTk3cueCHUmJVL2UxT6WTHoGxsUAxi5Ogb8qtZ3srPNvhpyKcJlSxRZIXgFOw9ITf2vElg3gvmvogmR1KD+Bi+jjRejuH92wg5HJ8gdglvHXIILl5ZU1qw2PPyRjCmDEVkeRYfTQ5SmyZovzvo7Jyp1xuFyU3EksPaKAYDfqq9Y/ocZ4GQ2n23rWftHZeLw6zqip9QZHeUhSmrx6495BHNqqvPpUWaVEaYWqtEN8fIdviX8V4gsV9zh8BFUvfQIBTqJpC6Ko+yj51WobTjvyfEfMcf7BRBl9uBSlhITubbhfcIbpU1oGsbYJY5CY7OeUdVszsYpqV8qzfHyrZ/kdD/iEi64isn2gt8TaG9u+beLSZp17QqesO0BuxpUS2tCvJF9Ri1kqnIkjUxWqlapc858D+EkcQ/1S8SCbpeI5Bhjtoh8MOdKsifKs/CHLKcdeHzJyggwu5m9H0S3axoumfCqYlYj3W5rkGl63yM88dAVr0mv6T5ch0+hgJfyXl7tRurMlUUhRNqV2Ls40OMnGMeRH4IYCzcHPtjliSMDzXd19VKofhq0z7Cl8T+RXgZEpaxjNjjfeXS9yJ7yaSWCqgJXAbZrqjrkp1Z807wvC/5sWf3fljTKyldxHP2exqTKGzjZFAsWCvvdEUyqTVfsu7jw9M6/FPZEdNN92YyqLNuMWEXX+HeAkfRuHyZ6Vgh22Jqw/TP8S1iiLlmOOBQkrhZWgEpKOjysyCXnWeuqOhCG4w8Z3Y73HVXSwaqq5XsGCIRPfiA7qzxEvct/Rp1g+Re1ZBfWTuCSwPorGEOSgDtTXwu88NZtskMdM6igFXWZogdBPhX2VgF6F8QxhGR+PKh8IUtp8EZhnXiQfHp8hdYO7WNq82S2BeMD7LmTMQ8UYo3aQNx7qpx3QSdlti6LuMmdEPGUoHmEcGBsqFhkrQYTxcIF/OLrvAquMLiU8/t64tqfySR9/eBiGFCvnNUnTCL7Dy3TmjlfrIi/PPV0vRSPSjARvtREUZHvR3JEMc6yaw1b3W7xAwl/j8dRdVBxXCfLMXj3Tik7QhTx+NUAPEdzcjfW48HrIyFl1j0BK+aRorTuU4TkuMh0EM3sRzvHYGvVimxuUcDjv6jue9imzI28CO2tmaAUFja06T7WDDzbwFCEo//9wY9hCWlkh5gAAAABJRU5ErkJggg==",x.ssaoNormalImage.loaded=!0,n.EventDispatcher=function(){this.listeners={}},n.extend(n.EventDispatcher,null,{constructor:n.EventDispatcher,addEventListener:function(e,n){this.listeners[e]===t&&(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)},removeEventListener:function(e,t){var n=this.listeners[e].indexOf(t);n!==-1&&this.listeners[e].splice(n,1)},dispatchEvent:function(e){var n=this.listenters[e.type];if(n!=t){e.target=this;for(var r=0;r<n.length;r++){var i=n[r];i.call(this,e)}}},contains:function(e,t){if(this._ls)for(var n=0,r=this._ls.size(),i;n<r;n++){i=this._ls.get(n);if(e===i.l&&t===i.s)return!0}return!1},add:function(e,t,n){var r={l:e,s:t,a:n};this._ls||(this._ls=new S),this._f?(this._addPendings||(this._addPendings=new S),this._addPendings.add(r)):r.a?this._ls.add(r,0):this._ls.add(r)},remove:function(e,t){this._ls&&(this._f?(this._removePendings||(this._removePendings=new S),this._removePendings.add({l:e,s:t})):this._remove(e,t))},_remove:function(e,t){for(var n=0,r=this._ls.size(),i;n<r;n++){i=this._ls.get(n);if(i.l===e&&i.s===t){this._ls.removeAt(n);return}}},fire:function(e){if(this._ls){var t,n=this._ls.size(),r;this._f=!0;for(t=0;t<n;t++)r=this._ls.get(t),r.s?r.l.call(r.s,e):r.l(e);this._f=!1;if(this._removePendings){n=this._removePendings.size();for(t=0;t<n;t++)r=this._removePendings.get(t),this._remove(r.l,r.s);delete this._removePendings}if(this._addPendings){n=this._addPendings.size();for(t=0;t<n;t++)r=this._addPendings.get(t),r.a?this._ls.add(r,0):this._ls.add(r);delete this._addPendings}}}}),n.PropertyChangeDispatcher=function(){this._dispatcher=new n.EventDispatcher},n.extend(n.PropertyChangeDispatcher,Object,{addPropertyChangeListener:function(e,t,n){this._dispatcher.add(e,t,n)},removePropertyChangeListener:function(e,t){this._dispatcher.remove(e,t)},firePropertyChange:function(e,t,n){if(t==n)return!1;var r={property:e,oldValue:t,newValue:n,source:this};return this._dispatcher.fire(r),this.onPropertyChanged(r),!0},onPropertyChanged:function(e){}}),n.Texture=function(e,r,i,s,o,u,a,f,l){n.PropertyChangeDispatcher.call(this),this.id=n.TextureIdCount++,this.name="",e!=null&&this.setImage(e),this.mipmaps=[],this.mapping=r!==t?r:new n.UVMapping,this.wrapS=i!==t?i:n.RepeatWrapping,this.wrapT=s!==t?s:n.RepeatWrapping,this.magFilter=o!==t?o:n.LinearFilter,this.minFilter=u!==t?u:n.LinearMipMapLinearFilter,this.anisotropy=l!==t?l:1,this.format=a!==t?a:n.RGBAFormat,this.type=f!==t?f:n.UnsignedByteType,this.repeatX=1,this.repeatY=1,this.offsetX=0,this.offsetY=0,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},n.extend(n.Texture,n.PropertyChangeDispatcher,{getUniqueCode:function(){if($html.isImage(this._image)||typeof this._image=="string"||O.isArray(this._image))return this._imageSrc+" "+this.format+" "+this.type+" "+" "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy;if($html.isCanvas(this._image)){var e=this._image;return e.__uniqueCode||(e.__uniqueCode=n.id("texture")),e.__uniqueCode+" "+this.format+" "+this.type+" "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy}},resetValue:function(){this.name="",this._image=null,this.mipmaps=[],this.mapping=new n.UVMapping,this.wrapS=n.RepeatWrapping,this.wrapT=n.RepeatWrapping,this.magFilter=n.LinearFilter,this.minFilter=n.LinearMipMapLinearFilter,this.anisotropy=1,this.format=n.RGBAFormat,this.type=n.UnsignedByteType,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},clone:function(e,r){return e===t&&(e=new n.Texture),r==null||r?e.setImage(this._image):e._image=this._image,e._imageSrc=this._imageSrc,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.flipX=this.flipX,e.unpackAlignment=this.unpackAlignment,e},onloadTexture:function(){},setImageSrc:function(e){typeof e=="string"?this._imageSrc=e:this._imageSrc=e.src},loadAllImages:function(e,t){function s(s){s.onload=function(){s.loaded=!0,s.onload=null,r++,r==n&&(i.onloadTexture(),i.firePropertyChange("image",t,i._image),e.loaded=!0)}}var n=e.length,r=0,i=this;for(var o=0;o<n;o++)s(e[o])},setImage:function(e){var t=this._image;if(O.isArray(e)){var n="",r=[],i;for(var s=0;s<e.length;s++)typeof e[s]=="string"?(n+=e,i=new Image,e[s].startsWith("data:image")||(i.crossOrigin="use-credentials"),i.src=e[s],r.push(i)):(n+=e[s].src,r.push(e[s]));this.loadAllImages(r,t),this._image=r}else if(typeof e=="string"){if(this._image&&this._image.src===e)return;this._imageSrc=e;var o=new Image;e.startsWith("data:image")||(o.crossOrigin="use-credentials"),o.src=e;var u=this;u._image=o,o.onload=function(e){o.loaded=!0,o.onload=null,u.onloadTexture(),u.firePropertyChange("image",t,o)}}else{if(this._image===e)return;this._imageSrc=e.src;var t=this._image;$html.isCanvas(e)&&(e.loaded=!0);if(e&&!e.loaded){var u=this;u._image=e;var a=e.onload;e.onload=function(n){a&&a.call(null,n),e.loaded=!0,e.onload=null,u.onloadTexture(),u.firePropertyChange("image",t,e)}}else this._image=e,this.firePropertyChange("image",t,e)}},getImage:function(){return this._image},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),n.TextureIdCount=0,n.PixelsTexture=function(e,t,r,i,s,o,u,a,f,l,c){n.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={data:e,width:t,height:r}},n.PixelsTexture.prototype=Object.create(n.Texture.prototype),n.PixelsTexture.prototype.clone=function(){var e=new n.PixelsTexture;return n.Texture.prototype.clone.call(this,e),e},n.CompressedTexture=function(e,t,r,i,s,o,u,a,f,l,c){n.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={width:t,height:r},this.mipmaps=e,this.generateMipmaps=!1},n.CompressedTexture.prototype=Object.create(n.Texture.prototype),n.CompressedTexture.prototype.clone=function(){var e=new n.CompressedTexture;return n.Texture.prototype.clone.call(this,e),e},$TexturePool={pools:{},useTimes:{},size:0,setTexture:function(e,t){$TexturePool.size++,$TexturePool.pools[e]=t},getTexture:function(e){return $TexturePool.pools[e]},useTexture:function(e){if(e){var t=e.id,n=$TexturePool.useTimes[t]||0;n++,$TexturePool.useTimes[t]=n}},unUseTexture:function(e){if(e){var t=e.id,n=$TexturePool.useTimes[t]||0;n--,$TexturePool.useTimes[t]=n;if(n<=0){var r=e.getUniqueCode();delete $TexturePool.pools[r],$TexturePool.size--,e.dispose()}}}},n.TexturePool=$TexturePool,n.TexturePool.TestTexture=new n.Texture,n.SerializationSettings=function(){var e=n.SerializationSettings;this.isDataBoxSerializable=e.isDataBoxSerializable,this.isStyleSerializable=e.isStyleSerializable,this.isClientSerializable=e.isClientSerializable,this.encodeURI=e.encodeURI,this._pm=n.clone(e._pm),this._sm=n.clone(e._sm),this._cm=n.clone(e._cm)},function(){var e=n.SerializationSettings;e.isDataBoxSerializable=!0,e.isStyleSerializable=!0,e.isClientSerializable=!0,e.encodeURI=!0,e._pm={},e._sm={},e._cm={},e.setPropertyType=function(t,n){e._pm[t]=n},e.getPropertyType=function(t){return e._pm[t]},e.setStyleType=function(t,n){e._sm[t]=n},e.getStyleType=function(t){return e._sm[t]},e.setClientType=function(t,n){e._cm[t]=n},e.getClientType=function(t){return e._cm[t]}}(),n.extend(n.SerializationSettings,Object,{setPropertyType:function(e,t){this._pm[e]=t},getPropertyType:function(e){return this._pm[e]},setStyleType:function(e,t){this._sm[e]=t},getStyleType:function(e){return this._sm[e]},setClientType:function(e,t){this._cm[e]=t},getClientType:function(e){return this._cm[e]}}),n.Styles={_m:{},setStyle:function(e,t){return t==null?delete n.Styles._m[e]:n.Styles._m[e]=t,n.Styles},getStyle:function(e){return n.Styles._m[e]}},n.Styles.MaterailType="S:m.type",n.Styles.NormalType="S:m.normalType",n.Styles.PREFIX_STYLE="S:",function(){var e=function(e,t){n.SerializationSettings.setPropertyType(e,t)};e("combos","data.list"),e("name","cdata"),e("toolTip","cdata"),e("parent","data"),e("fromNode","data"),e("toNode","data"),e("alarmState","alarmstate"),e("vertices","list.vec3"),e("faces","serializeabe.list"),e("uvs","list.vec2"),e("position","vec3"),e("rotation","vec3"),e("scale","vec3"),e("location","point"),e("materialSize","number"),e("color","color"),e("ambient","color"),e("diffuse","color"),e("specular","color"),e("intensity","number"),e("distance","number"),e("type","number"),e("startClosed","boolean"),e("endClosed","boolean"),e("curveSegments","number"),e("amount","number"),e("vertical","boolean"),e("repeat","number"),e("centralized","boolean"),e("visible","boolean"),e=function(e,t,r){r==null&&(t!=null?t instanceof n.Vec2?r="vec2":t instanceof n.Vec3?r="vec3":r=typeof t:r="string"),n.Styles.setStyle(e,t),n.SerializationSettings.setStyleType(e,r)},e("select.style","border"),e("select.width",1),e("select.color",65280),e("select.offset",0),e("outer.width",1),e("outer.offset",0),e("outer.color",null,"color"),e("m.type","basic"),e("m.color",16777215,"color"),e("m.side","front"),e("m.alphaTest",0),e("m.polygonOffset",!1),e("m.polygonOffsetFactor",0),e("m.polygonOffsetUnits",0),e("m.wireframe",!1),e("m.wireframeLinewidth",1),e("m.gradient",{}),e("m.gradientType",1),e("m.transparent",!1),e("m.opacity",1),e("m.visible",!0),e("m.depthTest",!0),e("m.depthMask",!0),e("m.alignment",new n.Vec2(0,0)),e("m.linewidth",1),e("m.texture.image",null),e("m.texture.offset",new n.Vec2(0,0)),e("m.texture.repeat",new n.Vec2(1,1)),e("m.texture.wrapS",n.RepeatWrapping),e("m.texture.wrapT",n.RepeatWrapping),e("m.texture.flipX",!1),e("m.texture.flipY",!1),e("m.normalmap.image",null),e("m.envmap.image",null),e("m.specularmap.image",null),e("right.m.type","basic"),e("left.m.type","basic"),e("top.m.type","basic"),e("bottom.m.type","basic"),e("front.m.type","basic"),e("back.m.type","basic"),e("side.m.type","basic"),e("alarm.billboard.scale",null),e("alarm.billboard.position","top"),e("annotation.class","tgl_annotation")}(),n.extend(n.Styles,Object,{});var T=function(e,n){this.min=e!==t?e:new s(Infinity,Infinity),this.max=n!==t?n:new s(-Infinity,-Infinity)};n.Box2=T,T.prototype={constructor:n.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)t=e[n],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new s;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new s;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new s;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var n=t||new s;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var n=t||new s;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new s;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new T).copy(this)}},n.BoundingBox=function(e,n){this.min=e!==t?e:new o(Infinity,Infinity,Infinity),this.max=n!==t?n:new o(-Infinity,-Infinity,-Infinity)},n.BoundingBox.prototype={constructor:n.BoundingBox,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)t=e[n],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(e,t){var r=n.BoundingBox.__v1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new o;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new o;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e){return new o((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var n=t||new o;return(new o).copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=n.BoundingBox.__v1.copy(e).clamp(this.min,this.max);return t.sub(e).length()},getBoundingSphere:function(e){var t=e||new n.Sphere;return t.center=this.center(),t.radius=this.size(n.BoundingBox.__v0).length()*.5,t},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},transform:function(e){var t=[n.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),n.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),n.BoundingBox.__v1.set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),n.BoundingBox.__v2.set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),n.BoundingBox.__v3.set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),n.BoundingBox.__v4.set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),n.BoundingBox.__v5.set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),n.BoundingBox.__v6.set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),n.BoundingBox.__v7.set(this.max.x,this.max.y,this.max.z).applyMatrix4(e)];return this.makeEmpty(),this.setFromPoints(t),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new n.BoundingBox).copy(this)}},n.BoundingBox.__v0=new o,n.BoundingBox.__v1=new o,n.BoundingBox.__v2=new o,n.BoundingBox.__v3=new o,n.BoundingBox.__v4=new o,n.BoundingBox.__v5=new o,n.BoundingBox.__v6=new o,n.BoundingBox.__v7=new o,n.BoundingSphere=function(e,n){this.center=e!==t?e:new o,this.radius=n!==t?n:0},n.BoundingSphere.prototype={constructor:n.BoundingSphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){var n=0;for(var r=0,i=t.length;r<i;r++){var s=e.distanceToSquared(t[r]);n=Math.max(n,s)}return this.center=e,this.radius=Math.sqrt(n),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsBoundingSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),r=t||new o;return r.copy(e),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new n.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},transform:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new n.BoundingSphere).copy(this)}},n.Primitive=function(e,t){e=e||{},this.data=e,this.vertices=e.vertices,this.faces=e.faces,this.uvs=e.uvs,this.uv2s=e.uv2s,this.uniqueCode=t},n.extend(n.Primitive,Object,{clone:function(e){if(e){var t={},r;t.vertices=[];for(r=0;r<this.vertices.length;r++)t.vertices.push(this.vertices[r].clone());t.faces=[];for(r=0;r<this.faces.length;r++)t.faces.push(this.faces[r].clone());t.uvs=[];for(r=0;r<this.uvs.length;r++){var i=this.uvs[r],s=[];for(var o=0;o<i.length;o++)s.push(i[o].clone);t.uvs.push(s)}t.uv2s=[];for(r=0;r<this.uv2s.length;r++)t.uv2s.push(this.uv2s[r].clone());return new n.Primitive(t)}return new n.Primitvie(this.data)}}),n.PrimitiveCache={_cache:{},_useCount:{},getPrimitive:function(e){return e?n.PrimitiveCache._cache[e]:null},setPrimitive:function(e,t){e&&(n.PrimitiveCache._cache[e]=t)},usePrimitive:function(e){var t=n.PrimitiveCache._useCount[e]||0;t++,n.PrimitiveCache._useCount[e]=t},unUsePrimitive:function(e){var t=n.PrimitiveCache._useCount[e]||0;t--,t<=0&&delete e}},n.PrimitiveGroupCache={},n.Color=function(e){return e!==t&&this.set(e),this},n.extend(n.Color,Object,{r:1,g:1,b:1,getUniqueCode:function(){return""+this.r+this.g+this.b},set:function(e){switch(typeof e){case"number":this.setHex(e);break;case"string":this.setStyle(e)}},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSV:function(e,t,n){var r,i,s,o,u;return n===0?this.r=this.g=this.b=0:(r=Math.floor(e*6),i=e*6-r,s=n*(1-t),o=n*(1-t*i),u=n*(1-t*(1-i)),r===0?(this.r=n,this.g=u,this.b=s):r===1?(this.r=o,this.g=n,this.b=s):r===2?(this.r=s,this.g=n,this.b=u):r===3?(this.r=s,this.g=o,this.b=n):r===4?(this.r=u,this.g=s,this.b=n):r===5&&(this.r=n,this.g=s,this.b=o)),this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e)){var t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(n.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},getHSV:function(e){var n=
this.r,r=this.g,i=this.b,s=Math.max(Math.max(n,r),i),o=Math.min(Math.min(n,r),i),u,a,f=s;if(o===s)u=0,a=0;else{var l=s-o;a=l/s,n===s?u=(r-i)/l:r===s?u=2+(i-n)/l:u=4+(n-r)/l,u/=6,u<0&&(u+=1),u>1&&(u-=1)}return e===t&&(e={h:0,s:0,v:0}),e.h=u,e.s=a,e.v=f,e},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},clone:function(){return(new n.Color).setRGB(this.r,this.g,this.b)}}),n.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},n.Data=function(e){n.PropertyChangeDispatcher.call(this),this._childList=new S,this._childMap={},this._clientMap={},this._id=e},n.extend(n.Data,n.PropertyChangeDispatcher,{___accessor:["name"],constructor:n.Data,getId:function(){return this._id},onAlarmChange:function(){},onPropertyChange:function(e,t,n){},setGroupId:function(e){if(this._groupId===e)return;var t=this._groupId;this._groupId=e,this.firePropertyChange("groupId",t,e)},getGroupId:function(){return this._groupId},hasChildren:function(){return this._childList.size()>0},getChildren:function(){return this._childList},isDescendantOf:function(e){if(!e)return!1;if(!e.hasChildren())return!1;var t=this._parent;while(t){if(e===t)return!0;t=t.getParent()}return!1},getParent:function(){return this._parent},getRoot:function(){var e=this._parent;return e&&e._parent==null?e:e&&e._parent!=null?e.getRoot(e):arguments[0]},setParent:function(e){e===null&&e===t;if(this._isUpdatingParent||this._parent===e||this===e)return;if(e&&e.isDescendantOf(this))return;var n=this._parent;this._parent=e,this._isUpdatingParent=!0,n&&n.removeChild(this),e&&e.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",n,e),this.onParentChanged(n,e)},onParentChanged:function(e,t){},addChild:function(e,n){n===t&&(n=this._childList.size());if(!e||e===this)return!1;if(this._childMap[e.getId()])return!1;if(this.isDescendantOf(e))return!1;e.getParent()&&e.getParent().removeChild(e);if(n<0||n>this._childList.size())n=this._childList.size();return this._childList.add(e,n),this._childMap[e._id]=e,e.setParent(this),this.firePropertyChange("children",null,e),this.onChildAdded(e,n),!0},onChildAdded:function(e,t){},clearChildren:function(){if(this._childList!=null&&this._childList.size()>0){var e=this._childList.toList(),t=this;e.forEach(function(e){t.removeChild(e)})}},removeChild:function(e){if(!e)return!1;if(!this._childMap[e._id])return!1;var t=this._childList.remove(e);return delete this._childMap[e._id],this.firePropertyChange("children",e,null),e.setParent(null),this.onChildRemoved(e,t),!0},onChildRemoved:function(e,t){},setClient:function(e,t){if(e==null)return this;this._clientMap==null&&(this._clientMap=new Object);var n=this._clientMap[e];if(n===t)return;return t==null?delete this._clientMap[e]:this._clientMap[e]=t,this._clientMap[e]=t,this.firePropertyChange("C:"+e,n,t),this.onClientChanged(e,n,t),this},getClient:function(e){return this._clientMap[e]},onClientChanged:function(e,t,n){},setPropertyValue:function(e,t){if(this[e]===t)return!1;var r=this[e];return r instanceof n.Color&&t!=null?(r=r.clone(),t instanceof n.Color?this[e].copy(t):this[e].set(t)):this[e]=t,!0}}),n.Element=function(e){n.Data.call(this,e),this._id=e||n.id("E"),this.styleMap={},this._visible=!0,this._selected=!1,this._selectable=!0,this._editable=!0,this.editing=!1,this.up=new o(0,1,0),this._position=new o(0,0,0),this._rotation=new o(0,0,0),this._scale=new o(1,1,1),this.eulerOrder=n.defaultEulerOrder,this.rotationAutoUpdate=!0,this.matrix=new l,this.worldMatrix=new l,this.rotationWorldMatrix=new l,this.matrixAutoUpdate=!1,this.worldMatrixNeedsUpdate=!0,this.quaternion=new n.Quat,this.useQuaternion=!1,this._sizeFixed=!1,this._fixedSize=108,this.castShadow=!0,this.receiveShadow=!0,this.frustumCulled=!0,this._vector=new o,this.renderDepth=null,this._attachId="",this._groupId=null,this.editTransformToParent=!1,this._alarmState=new n.AlarmState(this),this.colors=[]},n.Element.__m1=new l,n.ElementIdCount=0,n.extend(n.Element,n.Data,{IStyle:!0,___accessor:["visible","selected","selectable","editable","sizeFixed"],constructor:n.Element,getAlarmState:function(){return this._alarmState},onAlarmChange:function(e,t){var r=this._alarmState.getHighestNativeAlarmSeverity();r?this.setStyle("m.alarmColor",new n.Color(r.color)):this.setStyle("m.alarmColor",null)},getDefaultInstance:function(){return this.constructor.defaultInstance===t&&(this.constructor.defaultInstance=new this.constructor),this.constructor.defaultInstance},onParentChanged:function(e,t){this.updateWorldMatrix(!0,!1)},onChildAdded:function(e,t){e.updateWorldMatrix(!0,!1)},onChildRemoved:function(e,t){e.updateWorldMatrix(!0,!1)},generatePrimitiveKey:function(){return null},serializeProperty:function(){},clear:function(e){},getSelectStyle:function(){return this.getStyle("select.style")},isSpaceChangedProperty:function(e){return e==="scale"||e==="position"||e==="rotation"},isStyleEquals:function(e,t,n){return t==null&&n==null?!0:t===n},setStyle:function(e,t){if(e==null)return this;this.styleMap==null&&(this.styleMap={});var r=this.styleMap[e];return this.isStyleEquals(e,r,t)?this:(t==null?delete this.styleMap[e]:this.styleMap[e]=t,this.onStyleChanged(e,r,t),this.firePropertyChange(n.Styles.PREFIX_STYLE+e,r,t),this)},s:function(e){if(e==null)return;this.styleMap==null&&(this.styleMap={});var t,r,i,s={};for(t in e){r=e[t],i=this.styleMap[t];if(this.isStyleEquals(t,i,r))continue;r==null?delete this.styleMap[t]:this.styleMap[t]=r,this.firePropertyChange(n.Styles.PREFIX_STYLE+t,i,r),this.isMaterialStyle(t)&&(s[t]=[r,i])}return this.onMaterialStylesChanged(s),this},getStyle:function(e,t,n){n==null&&(n=!0);var r;return this.styleMap!=null&&(r=this.styleMap[e]),t&&(r=this.getCloneObject(r)),r==null&&n&&(r=this.getDefaultStyle(e,t)),r},getCloneObject:function(e){if(e==null)return null;if(n.Utils.isArray(e)){var t=[];for(var r=0;r<e.length;r++)t.push(this.getCloneObject(e[r]));return t}return e.clone?e.clone():e},getSideIndexMapping:function(){},setMaterialStyle:function(e,t){},setMaterialStyles:function(e){for(var t in e){if(t.startsWith("m."))property=t.substr(t.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(styleProp)){var r=styleProp.substr(0,styleProp.indexOf(".")),s=this.getSideMaterialIndex(r);if(s!=i)continue;styleProp=styleProp.substr(styleProp.indexOf(".")+1),property=styleProp.substr(t.indexOf(".")+1)}var o=e[t];subValue=o[0],subValue==null?subValue=n.Styles.getStyle(t):O.isArray(subValue)&&(subValue=subValue[i]),this._A97(this.material,property,subValue)}},onMaterialStylesChanged:function(e){this.setMaterialStyles(e)},isMaterialStyle:function(e){return e.startsWith("m.")?!0:this.getSideIndexMapping()&&this.isSideStyle(e)?!0:!1},onStyleChanged:function(e,t,n){if(e.startsWith("m."))this.setMaterialStyle(e,n);else if(this.getSideIndexMapping()&&this.isSideStyle(e)){var r=e.substr(0,e.indexOf("."));e=e.substr(e.indexOf(".")+1);var i=this.getSideMaterialIndex(r);this.setMaterialStyle(e,n,i)}else e==="alarm.billboard.scale"&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},textureMapping:{texture:"map",texture1:"map1",texture2:"map2",textureb:"blendMap",texturebp:"bumpMap",lightMap:"lightMap",lightmap:"lightMap",normalmap:"normalMap",envmap:"envMap",specularmap:"specularMap"},_A97:function(e,t,r){if(t.startsWith("texture.")||t.startsWith("texture1.")||t.startsWith("texture2.")||t.startsWith("textureb.")||t.startsWith("texturen.")||t.startsWith("texturebp.")||t.startsWith("lightmap")||t.startsWith("envmap")||t.startsWith("normalmap")||t.startsWith("specularmap")){var i=t.substr(0,t.indexOf(".")),s=t.substr(t.indexOf(".")+1);if(s==="offset"||s==="repeat"){e.setPropertyValue(s,this.getCloneObject(r));return}var o=this.textureMapping[i],u=e[o],a=n.TexturePool.TestTexture;if(s==="image"){var f=r;if(u==null&&f!=null){a.resetValue(),a._image=f,a.setImageSrc(f);var l=a.getUniqueCode(),c=n.TexturePool.getTexture(l);c==null&&(c=new n.Texture(f),n.TexturePool.setTexture(l,c)),e.setMap(c,o)}else if(f==null)e.setMap(null,o);else{u.clone(a,!1),a._image=f,a.setImageSrc(f);var l=a.getUniqueCode(),c=n.TexturePool.getTexture(l);c!==u&&(c==null&&(c=new n.Texture,u.clone(c,!1),c.setImage(f),n.TexturePool.setTexture(l,c)),e.setMap(c,o))}}else if(u!=null){u.clone(a,!1),a[s]=this.getCloneObject(r);var l=a.getUniqueCode(),c=n.TexturePool.getTexture(l);c!=u&&(c==null&&(c=new n.Texture,u.clone(c),c[s]=r),e.setMap(c,o))}}else t==="type"&&e.setType?e.setType(r):e.setPropertyValue(t,this.getCloneObject(r))},getDefaultStyle:function(e,t){if(e==null)return null;if(e.startsWith("m.")){var r=[],i=e.substr(e.indexOf(".")+1);if(this.material.materials){var s=this.material.materials;s=s||[this.material];for(var o=0;o<s.length;o++){var u=s[o];if(i.startsWith("texture.")||i.startsWith("texture1.")||i.startsWith("texture2.")||i.startsWith("textureb.")||i.startsWith("texturen.")||i.startsWith("texturebp.")||i.startsWith("lightmap")||i.startsWith("envmap")||i.startsWith("normalmap")||i.startsWith("specularmap")){var a=i.substr(0,i.indexOf(".")),f=i.substr(i.indexOf(".")+1),l=i.substr(i.indexOf(".")+1),c=this.textureMapping[a],h=u[c];if(h)if(f==="image")if(O.isArray(h._image)){var p=[];r.push(p);for(var d=0;d<h._image.length;d++)p.push(h._image[d].src)}else r.push(h._image.src);else f==="offset"||f==="repeat"?r.push(u[f]):r.push(u.map[f]);else r.push(n.Styles.getStyle(e))}else r.push(u[i])}}t&&(r=this.getCloneObject(r));var v=!0;for(var o=0;o<r.length;o++)if(r.indexOf(r[o])!=0){v=!1;break}return v?r[0]:r}if(this.isSideStyle(e)){var m=e.substr(0,e.indexOf("."));e=e.substr(e.indexOf(".")+1);var i=e.substr(e.indexOf(".")+1),g=this.getSideMaterialIndex(m);if(g!=null){var y,u=this.material.materials[g];return i.startsWith("texture.")?u.map&&(i==="texture.image"?y=u.map._image.src:y=u.map[i]):y=u[i],t&&(y=this.getCloneObject(y)),y}}return n.Styles.getStyle(e)},isSideStyle:function(e){if(e.indexOf(".")===-1)return!1;var n=this.getSideIndexMapping();if(!n)return!1;var r=e.substr(0,e.indexOf("."));return n[r]!==t?!0:!1},setUp:function(e,t,n){var r;if(arguments.length===3){if(this.up.x===e&&this.up.y===t&&this.up.z===n)return;r=new o(e,t,n)}else{if(this.up.x===e.x&&this.up.y===e.y&&this.up.z===e.z)return;r=e}var i=this.up;this.up=r,this.onUpChanged(i,newValue),this.firePropertyChange("up",i,r)},getUp:function(){return this.up},onUpChanged:function(e,t){},checkNumber:function(e,t,n,r){O.isNaN(e)&&console.error(r+",x is not a number"),O.isNaN(t)&&console.error(r+",y is not a number"),O.isNaN(n)&&console.error(r+",z is not a number")},invalidateTexture:function(e){var t=this.material,r,i,s,o;if(e!=null){if(typeof e=="string"){var u=this.getSideIndexMapping();u!=null&&(e=u[e]);if(e==null)return}if(typeof e!="number")return;t instanceof n.ArrayMaterial?s=t.materials[e]:s=materail,this._dirtyMaterialTexture(s)}else if(t instanceof n.ArrayMaterial){i=t.materials;for(r=0;r<i.length;r++)s=i[r],this._dirtyMaterialTexture(s)}},_dirtyMaterialTexture:function(e){e!=null&&e.map&&e.map instanceof n.Texture&&this._dirtyTexture(e.map)},_dirtyTexture:function(e){var t=e._image;e.firePropertyChange("image",null,t)},p:function(e,t,n){if(arguments.length===0)return this.getPosition();arguments.length===3?this.setPosition(e,t,n):this.setPosition(e)},setPosition:function(e,t,n){var r;if(arguments.length===3){if(this._position.x===e&&this._position.y===t&&this._position.z===n)return;this.checkNumber(e,t,n,"setPosition"),r=new o(e,t,n)}else{if(this._position.x===e.x&&this._position.y===e.y&&this._position.z===e.z)return;if(!(e instanceof o))throw"Element.setPosition : position is not instanceof TGL.Vec3";r=e}var i=this._position;this._position=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("position",i,r)},getPosition:function(e){return e==t&&(e=!0),e?this._position.clone():this._position},setPositionX:function(e){if(this._position.x===e)return;this.checkNumber(e,0,0,"setPositionX");var t=this._position.x;this._position.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionX",t,e)},setX:function(e){this.setPositionX(e)},getPositionX:function(){return this._position.x},getX:function(){return this.getPositionX()},setPositionY:function(e){if(this._position.y===e)return;this.checkNumber(0,e,0,"setPositionY");var t=this._position.y;this._position.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionY",t,e)},setY:function(e){this.setPositionY(e)},getPositionY:function(){return this._position.y},getY:function(){return this.getPositionY()},setPositionZ:function(e){if(this._position.z===e)return;this.checkNumber(0,0,e,"setPositionZ");var t=this._position.z;this._position.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionZ",t,e)},setZ:function(e){this.setPositionZ(e)},getPositionZ:function(){return this._position.z},getZ:function(){return this.getPositionZ()},setScale:function(e,t,n){var r;if(arguments.length===3){if(this._scale.x===e&&this._scale.y===t&&this._scale.z===n)return;this.checkNumber(e,t,n,"setScale"),r=new o(e,t,n)}else{if(this._scale.x===e.x&&this._scale.y===e.y&&this._scale.z===e.z)return;if(!(e instanceof o))throw"Element.setScale : scale is not instanceof TGL.Vec3";r=e}var i=this._scale;r.x=r.x||1,r.y=r.y||1,r.z=r.z||1,this._scale=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scale",i,r)},getScale:function(e){return e==t&&(e=!0),e?this._scale.clone():this._scale},setScaleX:function(e){if(this._scale.x===e)return;this.checkNumber(e,0,0,"setScalX");var t=this._scale.x;this._scale.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleX",t,e)},getScaleX:function(){return this._scale.x},setScaleY:function(e){if(this._scale.y===e)return;this.checkNumber(0,e,0,"setScaleY");var t=this._scale.y;this._scale.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleY",t,e)},getScaleY:function(){return this._scale.y},setScaleZ:function(e){if(this._scale.z===e)return;this.checkNumber(0,0,e,"setScaleZ");var t=this._scale.z;this._scale.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleZ",t,e)},getScaleZ:function(){return this._scale.z},setRotation:function(e,t,n){var r;if(arguments.length===3){if(this._rotation.x===e&&this._rotation.y===t&&this._rotation.z===n)return;this.checkNumber(e,t,n,"setRotation"),r=new o(e,t,n)}else{if(this._rotation.x===e.x&&this._rotation.y===e.y&&this._rotation.z===e.z)return;if(!(e instanceof o))throw"Element.setRotation : rotation is not instanceof TGL.Vec3";r=e}var i=this._rotation;this._rotation=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotation",i,r)},getRotation:function(e){return e==t&&(e=!0),e?this._rotation.clone():this._rotation},setRotationX:function(e){if(this._rotation.x===e)return;this.checkNumber(e,0,0,"setRotationX");var t=this._rotation.x;this._rotation.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationX",t,e)},getRotationX:function(){return this._rotation.x},setRotationY:function(e){if(this._rotation.y===e)return;this.checkNumber(0,e,0,"setRotationY");var t=this._rotation.y;this._rotation.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationY",t,e)},getRotationY:function(){return this._rotation.y},setRotationZ:function(e){if(this._rotation.z===e)return;this.checkNumber(0,0,e,"setRotationZ");var t=this._rotation.z;this._rotation.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationZ",t,e)},getRotationZ:function(){return this._rotation.z},applyMatrix:function(e){var t=this.matrix.clone();this.matrix.multiplyMatrices(e,this.matrix),this._scale.getScaleFromMatrix(this.matrix);var n=(new l).extractRotation(this.matrix);this._rotation.setEulerFromRotationMatrix(n,this.eulerOrder),this._position.getPositionFromMatrix(this.matrix),this.updateWorldMatrix(!0,!1),this.firePropertyChange("matrix",t,this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.setPosition(this._position.clone().add(t.multiplyScalar(e)))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},rotateFromAxis:function(e,t,n){t=t.clone().applyMatrix4(this.matrix),e=e.clone().applyMatrix4((new l).extractRotation(this.matrix));var r=(new l).makeRotationAxisAndCenter(e,n,t);this.applyMatrix(r)},rotateFromWorldAxis:function(e,t){var n=new l;n.makeRotationAxis(e.normalize(),t),n.multiply(this.matrix),this.matrix=n;var r=(new l).extractRotation(this.matrix),i=new o;i.setEulerFromRotationMatrix(r,this.eulerOrder),this.setRotation(i)},getEulerAngles:function(){return this.matrix.getEulerAngles()},rotateFromWorldXAxis:function(e){this.rotateFromWorldAxis(new o(1,0,0),e)},rotateFromWorldYAxis:function(e){this.rotateFromWorldAxis(new o(0,1,0),e)},rotateFromWorldZAxis:function(e){this.rotateFromWorldAxis(new o(0,0,1),e)},getRelativeTransform:function(e){if(e instanceof n.Element){var t=(new l).getInverse(e.matrix.clone()),r=(new l).multiplyMatrices(t,this.matrix.clone()),i=(new o).getPositionFromMatrix(r),s=(new o).setEulerFromRotationMatrix(r),u=(new o).getScaleFromMatrix(r),a={position:i,rotation:s,scale:u,matrix:r};return a}return null},localToWorld:function(e){return this._parent==null?e:e.applyMatrix4(this._parent.worldMatrix)},localToWorld2:function(e){return e.applyMatrix4(this.worldMatrix)},getWorldPosition:function(){return this.worldMatrix.getPosition()},direction:function(e){var t=e.applyMatrix4((new l).extractRotation(this.worldMatrix));return t.normalize(),t},frontDirection:function(){var e=new o(0,0,1);return e=e.applyMatrix4((new l).extractRotation(this.worldMatrix)),e.normalize(),e},frontWorldPosition:function(e){e=e>0?e:1;var t=this.worldMatrix.getPosition();return t.add(this.frontDirection().multiplyScalar(e))},worldToLocal:function(e){return e.applyMatrix4(n.Element.__m1.getInverse(this.worldMatrix))},lookAt:function(e,t){this.matrix.lookAt(e,this._position,t?t:this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this._rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1])),this.worldMatrixNeedsUpdate=!0},iterator:function(e){e(this),this._childList&&this._childList.forEach(function(t){t.iterator(e)})},getChildByName:function(e,n){for(var r=0,i=this.children.length;r<i;r++){var s=this.children[r];if(s.name===e)return s;if(n===!0){s=s.getChildByName(e,n);if(s!==t)return s}}return t},getDescendants:function(e){e===t&&(e=[]);var n=this.getChildren().toArray();Array.prototype.push.apply(e,n);for(var r=0,i=n.length;r<i;r++)n[r].getDescendants(e);return e},fixSize:function(e){if(this._sizeFixed){this.updateWorldMatrix();var t=new o,n=new o;t.getPositionFromMatrix(this.worldMatrix),e.updateWorldMatrix(),n.getPositionFromMatrix(e.worldMatrix),scale=t.distanceTo(n)/this._fixedSize,scale===0&&(scale=1e-5),this.setScale(scale,scale,scale)}},updateMatrix:function(){this.matrix.setPosition(this._position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this._rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this._scale.x!==1||this._scale.y!==1||this._scale.z!==1)&&this.matrix.scale(this._scale),this.worldMatrixNeedsUpdate=!0},updateWorldMatrix:function(e,n){n=n==t?!0:n,this.matrixAutoUpdate===!0&&this.updateMatrix();if(this.worldMatrixNeedsUpdate===!0||e===!0){this.matrixAutoUpdate===!1&&this.updateMatrix();var r=this.worldMatrix.clone();this._parent==t?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0,r.equals(this.worldMatrix)||(n&&this.firePropertyChange("worldMatrix",r,this.worldMatrix),this.updateCameraMatrix&&this.updateCameraMatrix(!1))}this._childList.forEach(function(t){t.updateWorldMatrix(e)})},cloneCallback:function(e){},clone:function(e,r,i){typeof e=="boolean"&&(i=r,r=e,e=t),e==t&&(this.constructor?e=new this.constructor:e=new n.Element),i===t&&(i=!0),e.name=this.name,e.up==null&&(e.up=new o(0,1,0)),e.up.copy(this.up),e._position.copy(this._position),e._rotation.copy(this._rotation),e.eulerOrder=this.eulerOrder,e._scale.copy(this._scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.worldMatrix.copy(this.worldMatrix),e.rotationWorldMatrix.copy(this.rotationWorldMatrix),e.matrixAutoUpdate=this.matrixAutoUpdate,e.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e._visible=this._visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.styleMap=e.styleMap||{},i&&this._childList&&this._childList.forEach(function(t){e.addChild(t.clone(r,i))});if(this.constructor){var s=this.constructor.prototype.__accessor,u=this.constructor.prototype.__bool;if(s&&s.length>0)for(var a=0;a<s.length;a++){var f=s[a],l=n.getter(f,u),c=n.setter(f);e[c]&&e[c](this[l]())}}if(r&&this.vertices){var h=e,p=this.vertices;h.vertices=[],h.faces=[],h.uvs=[];for(var a=0,d=p.length;a<d;a++)h.vertices.push(p[a].clone());var v=this.faces;for(var a=0,d=v.length;a<d;a++)h.faces.push(v[a].clone());var m=this.uvs;for(var a=0,d=m.length;a<d;a++){var g=m[a],y=[];for(var b=0,w=g.length;b<w;b++)y.push(new n.Vec2(g[b].x,g[b].y));h.uvs.push(y)}}for(var E in this.styleMap)e.setStyle(E,this.getCloneObject(this.styleMap[E]));if(this._clientMap!=null)for(var S in this._clientMap)e.setClient(S,this._clientMap[S]);return this.material&&this.material.clone&&(e.material=this.material.clone()),e.cloneCallback(r),e}}),n.Annotation=function(e,t,r){n.Element.call(this,r),this._label=e,this._text=t,this._cameraPosition=null},n.extend(n.Annotation,n.Element,{___accessor:["label","text","cameraPosition"]}),n.Node=function(e){n.Element.call(this,e),this.name="",this.computed=!1,this.selectionData=null,this.stylesMap=new Object,this.renderGroup=[],this.primitive=null,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.colors=[],this.normals=[],this.faces=[],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.morphTargetsNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.computeNodeData(),this._alarmBillboard=null},n.extend(n.Node,n.Element,{__accessor:["vertices","faces","uvs","linkAgent"],__SizePropeties:[],setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.morphTargetsNeedUpdate=e,this.elementsNeedUpdate=e,this.uvsNeedUpdate=e,this.normalsNeedUpdate=e,this.tangentsNeedUpdate=e,this.colorsNeedUpdate=e},getLinks:function(){return this._links},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(e){this._allLinks||(this._allLinks=new S),this._fromLinks||(this._fromLinks=new S),this._allLinks.add(e),this._fromLinks.add(e),this._resetLinkSet()},_addToLink:function(e){this._allLinks||(this._allLinks=new S),this._toLinks||(this._toLinks=new S),this._allLinks.add(e),this._toLinks.add(e),this._resetLinkSet()},_removeFromLink:function(e){this._allLinks.remove(e),this._fromLinks.remove(e),this._allLinks.size()===0&&delete this._allLinks,this._fromLinks.size()===0&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(e){this._allLinks.remove(e),this._toLinks.remove(e),this._allLinks.size()===0&&delete this._allLinks,this._toLinks.size()===0&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){delete this._loopedLinks;if(!this._allLinks||this._allLinks.size()===0){delete this._links;return}var e;this._allLinks.forEach(function(t){t.isLooped()&&(e||(e={}),e[t._id]||(this._loopedLinks||(this._loopedLinks=new S),this._loopedLinks.add(t),e[t._id]=t))},this),e?(this._links=new S,this._allLinks.forEach(function(t){e[t._id]?e[t._id]!==!1&&(e[t._id]=!1,this._links.add(t)):this._links.add(t)},this)):this._links=this._allLinks},onAlarmChange:function(e,t){n.Element.prototype.onAlarmChange.call(this,e,t);var r=this._alarmState.getPropagateSeverity();r||(r=this._alarmState.getHighestNativeAlarmSeverity()),r&&this._parent==null?(this._alarmBillboard==null&&this.setAlarmBillboard(new n.Billboard),this._alarmBillboard.setStyle("m.texture.image",n.ImageCache.AlarmBillboardImage),this._alarmBillboard.setStyle("m.color",r.color),this._alarmBillboard.setStyle("m.alignment",n.BillboardAlignment.bottomCenter)):this.setAlarmBillboard(null)},_setAlarmBillboardPositionAndSize:function(e){var t=this.getStyle("alarm.billboard.position"),n=this.getBoundingBox(),r=n.min,i=n.max,s=n.center(),u=n.size();t==="topLeft"?e._position.set(r.x,i.y,s.z+1):t==="topRight"?e._position.set(i.x,i.y,s.z+1):t==="topBack"?e._position.set(s.x,i.y,r.z-1):t==="topFront"?e._position.set(s.x,i.y,i.z+1):e._position.set(s.x,i.y,s.z+1);var a=this.getStyle("alarm.billboard.scale");a instanceof o?e._scale.copy(a):e._scale.set(u.x/2,u.x/2,1)},getLinkOffset:function(e){return new mono.Vec3(0,0,0)},getLinkExtend:function(e){return new mono.Vec3(0,0,0)},clearLinkOrthogonal:function(e,t){return!1},clearLinkExtend:function(e,t){return!1},setAlarmBillboard:function(e){if(this._alarmBillboard===e)return;var t=this._alarmBillboard;e?(this._alarmBillboard=e,e.setParent(this),this._setAlarmBillboardPositionAndSize(e)):delete this._alarmBillboard,this.firePropertyChange("alarmBillboard",t,e)},needUpdate:function(){return this.verticesNeedUpdate||this.morphTargetsNeedUpdate||this.elementsNeedUpdate||this.uvsNeedUpdate||this.normalsNeedUpdate||this.tangentsNeedUpdate||this.colorsNeedUpdate},getVerticesWithChildren:function(e,t){function h(n){n.applyMatrix4(e),t.push(n)}t==null&&(t=[]),e==null&&(e=new l);var r,i;if(this instanceof n.Node){if(this.vertices!=null&&this.vertices.length!=0){var s=this.getBoundingBox(),u=s.min,a=s.max;h(u.clone()),h(a.clone()),h(new o(u.x,u.y,a.z)),h(new o(u.x,a.y,u.z)),h(new o(a.x,u.y,u.z)),h(new o(a.x,a.y,u.z)),h(new o(a.x,u.y,a.z)),h(new o(u.x,a.y,a.z))}for(var r=0;r<(this._childList?this._childList.size():0);r++){var f=this._childList.get(r),c=new l;c.multiplyMatrices(e,f.matrix.clone()),f.getVerticesWithChildren&&f.getVerticesWithChildren(c,t)}}return t},getBoundingBoxWithChildren:function(e){var t=this.getVerticesWithChildren();if(e)for(var r=0;r<e.length;r++){var i=e[r];if(i.getParent()===this.getParent()&&i!==this){var s=(new l).getInverse(this.matrix.clone()),o=(new l).multiplyMatrices(s,i.matrix.clone());t=t.concat(i.getVerticesWithChildren(o))}}var u=new n.BoundingBox;return u.setFromPoints(t),u},getWorldBoundingBox:function(){var e=[];for(var t=0;t<this.vertices.length;t++){var r=this.vertices[t].clone();r.applyMatrix4(this.worldMatrix),e.push(r)}var i=new n.BoundingBox;return i.setFromPoints(e),i},getBoundingBox:function(){return this.boundingBox==null&&this.computeBoundingBox(),this.boundingBox},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new n.BoundingBox),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new n.BoundingSphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},createPropagateAlarmCube:function(e){this.boundingBox==null&&this.computeBoundingBox(),e._attachId=this._id;if(this.propagateAlarmData==null){var t=this.getStyle("outer.offset"),n=this.boundingBox.min,r=this.boundingBox.max;e.width=r.x-n.x+t,e.height=r.y-n.y+t,e.depth=r.z-n.z+t,e.computed=!1,e.computeNodeData(),this.propagateAlarmData=e.data,w(e,!0),this.propagateAlarmData.primitive=e.primitive,this.propagateAlarmData.groups=e.groups;var i=(new o).center(n,r);for(var s=0;s<e.vertices.length;s++){var u=e.vertices[s];u.add(i)}this.propagateAlarmData.vertices=e.vertices}else{var a=this.propagateAlarmData;e.primitive=a.primitive,e.data=a,e.vertices=a.vertices,e.uvs=a.uvs,e.faces=a.faces,e.groups=a.groups}this.updateMatrix(!0),e._position.copy(this._position),e._scale.copy(this._scale),e._rotation.copy(this._rotation),e.useQuaternion=this.useQuaternion,e.quaternion=this.quaternion,e.worldMatrix=this.worldMatrix,e._parent=this.getParent(),e.updateMatrix(!0);var f=e.material;f.wireframeLinewidth=this.getStyle("outer.width");var l=this.getAlarmState().getPropagateSeverity();return f.color.set(l.color),e},createCanvasSelectionCube:function(){return this._csc==null&&(this._csc=new L,this._csc.material=new n.EntityMaterial,this._csc.material.wireframe=!0),this.createSelectionCube(this._csc),this._csc},createSelectionCube:function(e){this.boundingBox==null&&this.computeBoundingBox(),e._attachId=this._id+"_selection";if(this.selectionData==null){var t=this.getStyle("select.offset"),n=this.boundingBox.min,r=this.boundingBox.max,i=(new o).center(n,r);e.width=r.x-n.x+t,e.height=r.y-n.y+t,e.depth=r.z-n.z+t,e.offset=i,e.computed=!1;var s=e.computeNodeData();this.selectionData=e.data,w(e,!0),this.selectionData.primitive=e.primitive,this.selectionData.groups=e.groups,this.selectionData.vertices=e.vertices}else{var u=this.selectionData;e.primitive=u.primitive,e.data=u,e.vertices=u.vertices,e.uvs=u.uvs,e.faces=u.faces,e.groups=u.groups}this.updateMatrix(!0),e._position.copy(this._position),e._scale.copy(this._scale),e._rotation.copy(this._rotation),e.useQuaternion=this.useQuaternion,e.quaternion=this.quaternion,e.worldMatrix=this.worldMatrix,e._parent=this.getParent(),e.updateMatrix(!0);var a=e.material;return a.wireframeLinewidth=this.getStyle("select.width"),a.color.set(this.getStyle("select.color")),e},mergeVertices:function(){var e={},n=[],r=[],i,s,o=4,u=Math.pow(10,o),a,f,l,c,h,p,d,
v;this.__tmpVertices=t,this.vertices==null&&console.log("vertices is null");for(a=0,f=this.vertices.length;a<f;a++)i=this.vertices[a],s=[Math.round(i.x*u),Math.round(i.y*u),Math.round(i.z*u)].join("_"),e[s]===t?(e[s]=a,n.push(this.vertices[a]),r[a]=n.length-1):r[a]=r[e[s]];var m=[];for(a=0,f=this.faces.length;a<f;a++){l=this.faces[a];if(l instanceof C){l.a=r[l.a],l.b=r[l.b],l.c=r[l.c],c=[l.a,l.b,l.c];var g=-1;for(var y=0;y<3;y++)if(c[y]==c[(y+1)%3]){g=y,m.push(a);break}}else if(l instanceof k){l.a=r[l.a],l.b=r[l.b],l.c=r[l.c],l.d=r[l.d],c=[l.a,l.b,l.c,l.d];var g=-1;for(var y=0;y<4;y++)c[y]==c[(y+1)%4]&&(g>=0&&m.push(a),g=y);if(g>=0){c.splice(g,1);var b=new C(c[0],c[1],c[2],l.normal,l.color,l.materialIndex);v=this.uvs[a],v&&v.splice(g,1),l.vertexNormals&&l.vertexNormals.length>0&&(b.vertexNormals=l.vertexNormals,b.vertexNormals.splice(g,1)),l.vertexColors&&l.vertexColors.length>0&&(b.vertexColors=l.vertexColors,b.vertexColors.splice(g,1)),this.faces[a]=b}}}for(a=m.length-1;a>=0;a--);var w=this.vertices.length-n.length;return this.vertices=n,w},computeVertexNormals:function(e){var r,i,s,o,u,a;if(this.__tmpVertices===t){this.__tmpVertices=new Array(this.vertices.length),a=this.__tmpVertices;for(r=0,i=this.vertices.length;r<i;r++)a[r]=new n.Vec3;for(s=0,o=this.faces.length;s<o;s++)u=this.faces[s],u.vertexNormals=[new n.Vec3,new n.Vec3,new n.Vec3]}else{a=this.__tmpVertices;for(r=0,i=this.vertices.length;r<i;r++)a[r].set(0,0,0)}if(e){var f={},l={},c,h,p,d,v=new n.Vec3,m=new n.Vec3,g=new n.Vec3,y=new n.Vec3,b=new n.Vec3,w;for(s=0,o=this.faces.length;s<o;s++)u=this.faces[s],c=this.vertices[u.a],h=this.vertices[u.b],p=this.vertices[u.c],v.subVectors(p,h),m.subVectors(c,h),v.cross(m),a[u.a].add(v),a[u.b].add(v),a[u.c].add(v),u.d!=t&&a[u.d].add(v)}else for(s=0,o=this.faces.length;s<o;s++)u=this.faces[s],a[u.a].add(u.normal),a[u.b].add(u.normal),a[u.c].add(u.normal);for(r=0,i=this.vertices.length;r<i;r++)a[r].normalize();for(s=0,o=this.faces.length;s<o;s++)u=this.faces[s],u.vertexNormals[0].copy(a[u.a]),u.vertexNormals[1].copy(a[u.b]),u.vertexNormals[2].copy(a[u.c]),u.d!=t&&(u.vertexNormals[3]=a[u.d].clone())},computeCentroids:function(){var e,t,n;for(e=0,t=this.faces.length;e<t;e++)n=this.faces[e],n.centroid=n.centroid||new o,n.centroid==null&&console.log("fdasfdsa"),n.centroid.set||(n.centroid=new o),n.centroid.set(0,0,0),n instanceof C?(n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.divideScalar(3)):n instanceof k&&(n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.add(this.vertices[n.d]),n.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,n,r,i,s,u,a,f,l,c,h=new o,p=new o;for(s=0,u=this.faces.length;s<u;s++)a=this.faces[s],f=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],h.subVectors(c,l),p.subVectors(f,l),h.cross(p),h.normalize(),a.normal.copy||(a.normal=new o),a.normal.copy(h)},computeVertex:function(){},computePrimitive:function(){},generalteGroup:function(){},setMaterial:function(e){this.material=e},getMatetial:function(){return this.material},computeNodeMaterial:function(e){},cacheNodeMaterial:function(e){},needComputeVertexNormal:function(){return!0},computeNodeData:function(e){if(this.computed===!1){var t=this.generatePrimitiveKey();this._attachId&&(t+="_"+this._attachId);var r=n.PrimitiveCache.getPrimitive(t),i=!1;if(!r){var s=this.computeData();this.needComputeVertexNormal()&&(n.Node.prototype.mergeVertices.call(s),n.Node.prototype.computeFaceNormals.call(s),n.Node.prototype.computeVertexNormals.call(s,!0));if(s.uv2s==null||s.uv2s.length==0){s.uv2s=[];if(s.uvs!=null&&s.uvs.length>0)for(var o=0;o<s.uvs.length;o++){var u=[],a=s.uvs[o];for(var f=0;f<a.length;f++)u.push(a[f].clone());s.uv2s.push(u)}}r=new n.Primitive(s,t),n.PrimitiveCache.setPrimitive(t,r),this.cacheNodeMaterial(r),i=!0}else this.primitive&&n.PrimitiveCache.unUsePrimitive(r),this.computeNodeMaterial(r);return n.PrimitiveCache.usePrimitive(r),this.primitive=r,this.data=r.data,this.vertices=r.vertices,this.faces=r.faces,this.uvs=r.uvs,this.uv2s=r.uv2s,this.computed=!0,i}},computeData:function(){var e={vertices:[],faces:[],uv2s:[],uvs:[]};return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e,e},setMaterial:function(e,t,n){var r=t.getUniqueCode?t.getUniqueCode():null,i=$MaterialPool.getMaterial(r);i?(this.material.materials[e]=i,$MaterialPool.useMaterial(i)):(this.material.materials[e]=t,$MaterialPool.setMaterial(r,t),$MaterialPool.useMaterial(t)),$MaterialPool.unUseMaterial(n)},onMaterialMapping:function(){this.groups=t},getMaterialSize:function(){return this.materialSize||1},startBatch:function(){this.batch=!0},endBatch:function(){this.materialMappingChanges!==t&&(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",this.materialMappingChanges[0],this.materialMappingChanges[1]),this.materialMappingChanges=t),this.batch=!1},compareAndSetMaterial:function(e,t,n){this.setMaterial(n,t,e)},cloneStyle:function(e){if(this.getClassName()!=e.getClassName()){console.warn("ApplyStyle fail, the source with not the same class");return}var t=this.getMaterialMapping();for(var r=0;r<this.getMaterialSize();r++){var i=this.material.materials[r],s=e.material.materials[r];this.compareAndSetMaterial(i,s,r)}var o=this.getMaterialMapping();n.Utils.isSame(t,o)||(this.batch?this.materialMappingChanges=[t,o]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",t,o)))},_considerArray:function(e,t){if(!e.startsWith("envmap.image"))return O.isArray(t);var n=!1;if(O.isArray(t))for(var r=0;r<t.length;r++)if(O.isArray(t[r])){n=!0;break}return n},setMaterialStyles:function(e){var t=this.getMaterialMapping(),r,i,s,o,u,a,f,l,c,t=this.getMaterialMapping();for(var h in e)var p=e[h];for(var d=0;d<this.getMaterialSize();d++){o=this.material.materials[d],u=o.clone();var v=!1;for(var h in e){var m=!1;if(h.startsWith("m."))f=h.substr(h.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(h)){var g=h.substr(0,h.indexOf(".")),l=this.getSideMaterialIndex(g);if(l!=d)continue;m=!0,c=h.substr(h.indexOf(".")+1),f=c.substr(c.indexOf(".")+1)}var p=e[h];s=p[0],s==null?s=n.Styles.getStyle(h):this._considerArray(f,s)&&(s=s[d]),this._A97(u,f,s),v=!0}v&&this.compareAndSetMaterial(o,u,d)}var y=this.getMaterialMapping();n.Utils.isSame(t,y)||(this.batch?this.materialMappingChanges=[t,y]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",t,y)))},setMaterialStyle:function(e,t,r){var t,i,s,o,u,a,f=e;e.startsWith("m.")&&(f=e.substr(e.indexOf(".")+1));if(r==null&&!n.Utils.isArray(t)){var l=[];for(h=0;h<this.getMaterialSize();h++)l.push(t);this.styleMap[e]=l,t=l}var c=!1;if(f.startsWith("envmap.image")&&O.isArray(t))for(var h=0;h<t.length;h++){if(!!O.isArray(t[h])){c=!1;break}c=!0}var p=this.getMaterialMapping();if(r==null&&(!n.Utils.isArray(t)||c)){var d=[];for(var h=0;h<this.getMaterialSize();h++){if(d[h]===!0)continue;s=t,o=this.material.materials[h],u=o.clone(),s==null&&(s=n.Styles.getStyle(e)),this._A97(u,f,s),this.compareAndSetMaterial(o,u,h)}}else if(n.Utils.isArray(t)){i=t;for(var h=0;h<this.getMaterialSize();h++)s=i[h],o=this.material.materials[h],u=o.clone(),s==null&&(s=n.Styles.getStyle(e)),this._A97(u,f,s),this.compareAndSetMaterial(o,u,h)}else if(r!=null){var p=this.getMaterialMapping();o=this.material.materials[r],u=o.clone(),this._A97(u,f,t),this.compareAndSetMaterial(o,u,r),this.synchronizeIndexStyle(e,r,t)}this.changeMapping(p)},changeMapping:function(e){var t=this.getMaterialMapping();n.Utils.isSame(e,t)||(this.batch?this.materialMappingChanges=[e,t]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,t)))},synchronizeSideStyle:function(e,t,n){var r=this.getMaterialIndexSide(t);r&&this.styleMap[r+"."+e]!=null&&(this.styleMap[r+"."+e]=n)},synchronizeIndexStyle:function(e,t,r){var s=this.styleMap[e];s==null&&(s=this.getStyle(e),this.styleMap[e]=s);if(n.Utils.isArray(s))s[t]=r;else{var o=[];for(i=0;i<this.getMaterialSize();i++)o.push(s);o[t]=r,this.styleMap[e]=o}},getDefaultMaterial:function(e,t){return e?e instanceof n.ArrayMaterial?e.materials.length===0?$MaterialPool.DefaultMaterial:(t>=e.materials.length&&(t=e.materials.length-1),e.materials[t]):e:$MaterialPool.DefaultMaterial},createMaterial:function(e){var t=new n.ArrayMaterial;this.material=t;var r=this.getMaterialSize();for(var i=0;i<r;i++)this.setMaterial(i,this.getDefaultMaterial(e,i))},onPropertyChange:function(e,t,n){this.changeProperty=e,this.oldGroups=this.groups;var r=this.isSizeChangedProperty(e);r&&this.onSizeChanged(),r&&this.onMaterialMapping(),r&&this.firePropertyChange("materialMapping",0,1)},onSizeChanged:function(){this.computed=!1,this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null,this.changeProperty=null},isSizeChangedProperty:function(e){return this.__SizePropeties.indexOf(e)!==-1||e=="vertices"||e=="faces"||e=="uvs"},isGroupChangedProperty:function(e){},getMaterialMapping:function(){var e={},t=this.material.materials;for(var n in t)e[n]=t.indexOf(t[n]);return e},getSideMaterialIndex:function(e){var t=this.getSideIndexMapping();if(t)return t[e]},getMaterialIndexSide:function(e){var t=this.getIndexSideMapping();if(t)return t[e]},getIndexSideMapping:function(){var e=this.getSideIndexMapping();if(e&&!this.IndexSideMapping){this.IndexSideMapping={};var t,n;for(t in e)n=e[t],this.IndexSideMapping[n]=t}return this.IndexSideMapping},getSideIndexMapping:function(){},disposeMaterial:function(){},getMaterial:function(){return this.material}});var N=function(e,t,r){this.normal=e instanceof n.Vec3?e:new n.Vec3,this.vertexNormals=e instanceof Array?e:[],this.color=t instanceof n.Color?t:new n.Color,this.vertexColors=t instanceof Array?t:[],this.materialIndex=r?r:0,this.centroid=new n.Vec3};n.Face=N,N.prototype={constructor:n.Face,subClone:function(){},clone:function(){var e=this.subClone();e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;for(t=0,n=this.vertexNormals.length;t<n;t++)e.vertexNormals.push(this.vertexNormals[t]);for(t=0,n=this.vertexColors.length;t<n;t++)e.vertexColors.push(this.vertexColors[t]);return e}};var C=function(e,t,r,i,s,o){n.Face.call(this,i,s,o),this.a=e,this.b=t,this.c=r};n.Face3=C,C.prototype=Object.create(n.Face.prototype),C.prototype.constructor=n.Face3,C.prototype.subClone=function(){var e=new C(this.a,this.b,this.c);return e},C.prototype.vertexCount=3,C.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c}};var k=function(e,t,r,i,s,o,u){n.Face.call(this,s,o,u),this.a=e,this.b=t,this.c=r,this.d=i};n.Face4=k,k.prototype=Object.create(n.Face.prototype),k.prototype.constructor=n.Face4,k.prototype.subClone=function(){var e=new k(this.a,this.b,this.c,this.d);return e},k.prototype.splitToFace3s=function(){var e=new C(this.a,this.b,this.d,this.normal,this.color,this.materialIndex),t=new C(this.d,this.b,this.c,this.normal,this.color,this.materialIndex);return[e,t]},k.prototype.vertexCount=4,k.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c,d:this.d}},n.Entity=function(e,r){e instanceof n.ArrayMaterial?(this.material=e,this.materialSize=this.material.materials.length||1):e instanceof n.Material?(this.material=e,this.materialSize=1):e&&(this.materialSize=e),this.materialSize=this.materialSize||1,this.createMaterial(this.material),r!=t&&this._id==null&&(this._id=r),n.Node.call(this,this._id),this.groups=null},n.extend(n.Entity,n.Node,{constructor:n.Entity,className:"TGL.Entity",setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.morphTargetsNeedUpdate=e,this.elementsNeedUpdate=e,this.uvsNeedUpdate=e,this.normalsNeedUpdate=e,this.colorsNeedUpdate=e,this.tangentsNeedUpdate=e,this.buffersNeedUpdate=e},cloneCallback:function(e){e&&this.className==="TGL.Entity"&&(this.computed=!1,this.computeNodeData())},computeData:function(){var e={vertices:this.vertices,faces:this.faces,uvs:this.uvs,uv2s:this.uv2s};return e},getMaterialSize:function(){return this.materialSize},setMaterialSize:function(e){typeof e=="number"&&(this.materialSize=e,this.createMaterial(this.material))}});var L=function(){var e,t,r,i,s,u,a,f,l,c;arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(a=arguments[0],e=a.width,t=a.height,r=a.depth,i=a.segmentsW,s=a.segmentsH,u=a.segmentsD,c=a.wrapMode,this._id=a.id):arguments[0]instanceof n.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],s=arguments[5],u=arguments[6],c=arguments[7]):(e=arguments[0],t=arguments[1],r=arguments[2],i=arguments[3],s=arguments[4],u=arguments[5],c=arguments[6]),this.width=e||1,this.height=t||1,this.depth=r||1,this.segmentsW=i||1,this.segmentsH=s||1,this.segmentsD=u||1,this.wrapMode=(c||"").toLowerCase(),this.materialSize=this.wrapMode==null||this.wrapMode==""?6:1,this.offset=new o(0,0,0),n.Entity.call(this)};n.Cube=L,n.extend(n.Cube,n.Entity,{__accessor:["width","height","depth","wrapMode"],__SizePropeties:["width","height","depth","wrapMode"],className:"TGL.Cube",getUVs:function(){return this.uvs},setPropertyValue:function(e,t){var n=this[e];if(n===t)return!1;this[e]=t;if(e==="wrapMode"){var r=this.wrapMode,i=r=="six-each"||r=="front-other"||r=="back-other"||r=="left-other"||r=="right-other"||r=="top-other"||r=="bottom-other";this.materialSize=this.wrapMode==null||this.wrapMode==""?6:1,i||(this[e]="")}return!0},getLinkOffset:function(e){var t=e.length();e.normalize();var n=e.x/this.getWidth(),r=e.y/this.getHeight(),i=e.z/this.getDepth(),s=Math.max(Math.abs(n),Math.abs(r),Math.abs(i));return s==Math.abs(n)?new o(this.getWidth()/2*(n<0?-1:1),0,0):s==Math.abs(r)?new o(0,this.getHeight()/2*(r<0?-1:1),0):new o(0,0,this.getDepth()/2*(i<0?-1:1))},getLinkExtend:function(e){var t=this.worldMatrix.clone();return t=(new mono.Mat4).extractRotation(t),this.getLinkOffset(e.applyMatrix4((new l).getInverse(t)))},computeData:function(){var e=g.buildCubeData(this.width,this.height,this.depth,this.segmentsW,this.segmentsH,this.segmentsD,this.wrapMode,this.offset||new o(0,0,0));return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e,e},getSideIndexMapping:function(){return this.wrapMap?null:n.Cube.SideIndexMapping},generatePrimitiveKey:function(){return"cube_"+this.width+"_"+this.height+"_"+this.depth+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.segmentsD+"_"+(this.material instanceof n.ArrayMaterial?1:0)+"_"+this.wrapMode+"_"+this.offset.x+"_"+this.offset.y+"_ "+this.offset.z+"_"+n.Utils.toString(this.getMaterialMapping())},serialize:function(e){var t=e;this.width!==1&&t.serializeSimple("p","width",this.width,"number"),this.height!==1&&t.serializeSimple("p","height",this.height,"number"),this.depth!==1&&t.serializeSimple("p","depth",this.depth,"number"),this.widthSegemtns!==1&&t.serializeSimple("p","widthSegemtns",this.widthSegemtns,"number"),this.heightSegments!==1&&t.serializeSimple("p","heightSegments",this.heightSegments,"number"),this.depthSegments!==1&&t.serializeSimple("p","depthSegments",this.depthSegments,"number"),n.Element.serialize.call(this,t)}}),L.SideIndexMapping={right:0,left:1,top:2,bottom:3,front:4,back:5},n.Sphere=function(){var e,r,i,s,o,u,a;arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],e=options.radius,r=options.segmentsW,i=options.segmentsH,s=options.longitudeStart,o=options.longitudeLength,u=options.latitudeStart,this._id=options.id):arguments[0]instanceof n.Material?(this.material=arguments[0],e=arguments[1],r=arguments[2],i=arguments[3],s=arguments[4],o=arguments[5],u=arguments[6],a=arguments[7]):(e=arguments[0],r=arguments[1],i=arguments[2],s=arguments[3],o=arguments[4],u=arguments[5],a=arguments[6]),this.radius=e||50,this.segmentsW=Math.max(3,Math.floor(r)||22),this.segmentsH=Math.max(2,Math.floor(i)||15),this.longitudeStart=s!==t?s:0,this.longitudeLength=o!==t?o:Math.PI*2,this.latitudeStart=u!==t?u:0,this.latitudeLength=a!==t?a:Math.PI,this.materialSize=1,n.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},n.extend(n.Sphere,n.Entity,{constructor:n.Sphere,__accessor:["radius","segmentsW","segmentsH"],__SizePropeties:["radius","segmentsW","segmentsH"],className:"TGL.Sphere",computeData:function(){var e=g.bsd(this.radius,this.segmentsW,this.segmentsH,this.longitudeStart,this.longitudeLength,this.latitudeStart,this.latitudeLength);return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e,e},setWidthSegments:function(e){console.log("TGL.Sphere.setWidthSegments has deprecated,please use setSegmentsW"),this.setSegmentsW(e)},setHeightSegments:function(e){console.log("TGL.Sphere.setHeightSegments has deprecated,please use setSegmentsW"),this.setSegmentsH(e)},generatePrimitiveKey:function(){return"sphere_"+this.radius+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.longitudeStart+"_"+this.longitudeLength+"_"+this.latitudeStart+"_"+this.latitudeLength},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new n.BoundingSphere(new n.Vec3,this.radius))},getLinkOffset:function(e){var t=e.length();return e.normalize(),e.multiplyScalar(this.radius)},serialize:function(e){var t=e;this.radius!==50&&t.serializeSimple(Br,"radius",this.radius,"number"),this.widthSegments!==24&&t.serializeSimple(Br,"widthSegments",this.widthSegments,"number"),this.heightSegments!==18&&t.serializeSimple(Br,"heightSegments",this.heightSegments,"number"),this.phiStart!==0&&t.serializeSimple(Br,"phiStart",this.phiStart,"number"),this.phiLength!==Math.PI*2&&t.serializeSimple(Br,"phiLength",this.phiLength,"number"),this.thetaStart!==0&&t.serializeSimple(Br,"thetaStart",this.thetaStart,"number"),this.thetaLength!==Math.PI&&t.serializeSimple(Br,"thetaLength",this.thetaLength,"number")}}),n.Plane=function(){var e,t,r,i,s;arguments[0]instanceof n.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4]):(e=arguments[0],t=arguments[1],r=arguments[2],i=arguments[3]),this.width=e||5,this.height=t||5,this.segmentsW=r||1,this.segmentsH=i||1,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.materialSize=1,this.computeData=function(){var e,t,r=this.width/2,i=this.height/2,s=this.segmentsW,o=this.segmentsH,u=s+1,a=o+1,f=this.width/s,l=this.height/o,c=new n.Vec3(0,0,1),h={vertices:[],faces:[],uvs:[]};for(t=0;t<a;t++)for(e=0;e<u;e++){var p=e*f-r,d=t*l-i;h.vertices.push(new n.Vec3(p,-d,0))}for(t=0;t<o;t++)for(e=0;e<s;e++){var v=e+u*t,m=e+u*(t+1),g=e+1+u*(t+1),y=e+1+u*t,b=new n.Vec2(e/s,1-t/o),w=new n.Vec2(e/s,1-(t+1)/o),E=new n.Vec2((e+1)/s,1-(t+1)/o),S=new n.Vec2((e+1)/s,1-t/o),x=new n.Face4(v,m,g,y);x.normal.copy(c),x.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),h.faces.push(x),h.uvs.push([b,w,E,S])}return h},n.Entity.call(this),this.computeCentroids()},n.extend(n.Plane,n.Entity,{constructor:n.Plane,className:"TGL.Plane",__accessor:["width","height","segmentsW","segmentsH"],__SizePropeties:["width","height","segmentsW","segmentsH"],clone:function(){var e=new n.Plane(this.material,this.width,this.height,this.segmentsW,this.segmentsH);return this.superClass.clone.call(this,e),e},getSelectStyle:function(){var e=this.getStyle("select.style");if(e=="outline.normal"||e=="outline")e="outline.wireframe";return e}}),n.Cylinder=function(){var e,r,i,s,o,u,a,f,l;arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],e=options.radiusTop,r=options.radiusBottom,i=options.height,s=options.segmentsR,o=options.segmentsH,u=options.openTop,a=options.openBottom,f=options.arcLength,l=options.arcStart,this._id=options.id):arguments[0]instanceof n.Material?(this.material=arguments[0],e=arguments[1],r=arguments[2],i=arguments[3],s=arguments[4],o=arguments[5],u=arguments[6],a=arguments[7],f=arguments[8],l=arguments[9]):(e=arguments[0],r=arguments[1],i=arguments[2],s=arguments[3],o=arguments[4],u=arguments[5],a=arguments[6],f=arguments[7],l=arguments[8]),this.radiusTop=e=e!==t?e:20,this.radiusBottom=r=r!==t?r:20,this.height=i=i!==t?i:100,this.segmentsR=s=s||20,this.segmentsH=o=o||1,this.openTop=u!==t?u:!1,this.openBottom=a!=t?a:!1,this.arcLength=f!==t?f:Math.PI*2,this.arcStart=l!==t?l:0,this.materialSize=3,n.Entity.call(this),this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals()},n.extend(n.Cylinder,n.Entity,{constructor:n.Cylinder,__accessor:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],__bool:["openTop","openBottom"],__SizePropeties:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],className:"TGL.Cylinder",computeData:function(){return g.bcld(this.height,this.segmentsH,this.radiusBottom,this.radiusTop,this.segmentsR,this.openTop,this.openBottom,this.arcLength,this.arcStart)},getLinkOffset:function(e){var t=e.length();e.normalize();var n=e.x,r=e.y,i=e.z,s=Math.sqrt(n*n+i*i),u=r>0?this.radiusTop:this.radiusBottom;if(Math.abs(r/s)>this.height/2/u&&t>0){var a=new o(0,this.height/2*(r>0?1:-1),0);return a}return(new o(n,0,i)).normalize().multiplyScalar((this.radiusTop+this.radiusBottom)/2)},getLinkExtend:function(e){var t=this.worldMatrix.clone();return t=(new mono.Mat4).extractRotation(t),this.getLinkOffset(e.applyMatrix4((new l).getInverse(t)))},clearLinkOrthogonal:function(e,t,n,r){r=r||0;var i=this.getHeight()/2+r,s=(this.radiusTop+this.radiusBottom)/2+r;return n=="orthogonal.x"||n=="orthogonal.x.n"?!(Math.abs(e.y-t.y)>i||Math.abs(e.z-t.z)>s):n=="orthogonal.y"||n=="orthogonal.y.n"?!(Math.abs(e.x-t.x)>s||Math.abs(e.z-t.z)>s):n=="orthogonal.z"||n=="orthogonal.z.n"?!(Math.abs(e.y-t.y)>i||Math.abs(e.z-t.z)>s):!1},clearLinkExtend:function(e,t){return t!=="extend.x"&&t==="extend.y"&&e>this.getHeight()/2?!0:!1},getSideIndexMapping:function(){return n.Cylinder.SideIndexMapping},generatePrimitiveKey:function(){return"cylinder_"+this.height+"_"+this.segmentsH+"_"+this.radiusTop+"_"+this.radiusBottom+"_"+this.segmentsR+"_"+this.openTop+"_"+this.openBottom+"_"+this.arcLength+"_"+this.arcStart+n.Utils.toString(this.getMaterialMapping())},needComputeVertexNormal:function(){return!1}}),n.Cylinder.SideIndexMapping={side:0,top:1,bottom:2},n.Circle=function(){var e,r,i,s;arguments.length===4?(e=arguments[0],r=arguments[1],i=arguments[2],s=arguments[3]):(this.material=arguments[0],e=arguments[1],r=arguments[2],i=arguments[3],s=arguments[4]),this.radius=e=e||50,this.segments=r=r!==t?Math.max(3,r):8,this.thetaStart=i=i!==t?i:0,this.thetaLength=s=s!==t?s:Math.PI*2,this.materialSize=1,n.Entity.call(this),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.BoundingSphere(new n.Vec3,e)},n.extend(n.Circle,n.Entity,{clone:function(){var e=new n.Circle(this.material,this.radius,this.segments,this.thetaStart,this.thetaLength);return this.constructor.superClass.clone.call(this,e),e},computeData:function(){var e=this.segments,t,r=[],i=new n.Vec3,s=new n.Vec2(.5,.5),o={vertices:[],faces:[],uvs:[],uv2s:[]};o.vertices.push(i),r.push(s);for(t=0;t<=e;t++){var u=new n.Vec3,a=this.thetaStart+t/e*this.thetaLength;u.x=this.radius*Math.cos(a),u.y=this.radius*Math.sin(a),o.vertices.push(u),r.push(new n.Vec2((u.x/this.radius+1)/2,(u.y/this.radius+1)/2))}var f=new n.Vec3(0,0,1);for(t=1;t<=e;t++){var l=t,c=t+1,h=0;o.faces.push(new n.Face3(l,c,h,[f,f,f])),o.uvs.push([r[t],r[t+1],s])}return o}}),n.Torus=function(){var e,t,r,i,s;arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],e=options.radius,t=options.tube,r=options.segmentsR,i=options.segmentsT,s=options.arc,this._id=options.id):arguments[0]instanceof n.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],s=arguments[5]):(e=arguments[0],t=arguments[1],r=arguments[2],i=arguments[3],s=arguments[4]),this.materialSize=1,this.radius=e||100,this.tube=t||40,this.segmentsR=r||8,this.segmentsT=i||6,this.arc=s||Math.PI*2,n.Entity.call(this),this.computeNodeData(),this.computeCentroids()},n.extend(n.Torus,n.Entity,{__accessor:["radius","tube","segmentsR","segmentsT","arc"],__SizePropeties:["radius","tube","segmentsR","segmentsT","arc"],className:"TGL.Torus",generatePrimitiveKey:function(){return"torus_"+this.radius+"_"+this.tube+"_"+this.segmentsR+"_"+this.segmentsT+"_"+this.arc},computeData:function(){var e=new n.Vec3,t=[],r=[],i={vertices:[],faces:[],uvs:[],uv2s:[]};for(var s=0;s<=this.segmentsR;s++)for(var o=0;o<=this.segmentsT;o++){var u=o/this.segmentsT*this.arc,a=s/this.segmentsR*Math.PI*2;e.x=this.radius*Math.cos(u),e.y=this.radius*Math.sin(u);var f=new n.Vec3;f.x=(this.radius+this.tube*Math.cos(a))*Math.cos(u),f.y=(this.radius+this.tube*Math.cos(a))*Math.sin(u),f.z=this.tube*Math.sin(a),i.vertices.push(f),t.push(new n.Vec2(o/this.segmentsT,s/this.segmentsR)),r.push(f.clone().sub(e).normalize())}for(var s=1;s<=this.segmentsR;s++)for(var o=1;o<=this.segmentsT;o++){var l=(this.segmentsT+1)*s+o-1,c=(this.segmentsT+1)*(s-1)+o-1,h=(this.segmentsT+1)*(s-1)+o,p=(this.segmentsT+1)*s+o,d=new n.Face3(l,c,p,[r[l],r[c],r[p]]);d.normal.add(r[l]),d.normal.add(r[c]),d.normal.add(r[p]),d.normal.normalize(),i.faces.push(d),i.uvs.push([t[l].clone(),t[c].clone(),t[p].clone()]),d=new n.Face3(c,h,p,[r[c],r[h],r[p]]),d.normal.add(r[c]),d.normal.add(r[h]),d.normal.add(r[p]),d.normal.normalize(),i.faces.push(d),i.uvs.push([t[c].clone(),t[h].clone(),t[p].clone()])}return i}}),n.Arrow=function(){var e,t,r,i,s;arguments[0]instanceof n.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],s=arguments[5]):(e=arguments[0],t=arguments[1],r=arguments[2],i=arguments[3],s=arguments[4]),this.materialSize=1,this.tailHeight=e||100,this.tailRadius=t||20,this.headHeight=r||20,this.headRadius=i||30,this.radiusSegments=s||30,this.computeData=function(){var o=2;this.headRadius<this.tailRadius&&(this.headRadius=this.tailRadius);var u=e+r,a=u/2,f,l,c=[],h=[],p=[],d=[];for(l=0;l<=o;l++){var v=[],m=[],g=l/o,y=g*i;for(f=0;f<=s;f++){var b=f/s,w=new n.Vec3;w.x=y*Math.sin(b*Math.PI*2),w.y=-g*r+a,w.z=y*Math.cos(b*Math.PI*2),this.vertices.push(w),v.push(this.vertices.length-1),m.push(new n.Vec2(b,1-g))}c.push(v),p.push(m)}this.vertices.push(new n.Vec3(0,a-r,0));for(l=0;l<=o;l++){var v=[],m=[],g=l/o,y=t;for(f=0;f<=s;f++){var b=f/s,w=new n.Vec3;w.x=y*Math.sin(b*Math.PI*2),w.y=-g*e+a-r,w.z=y*Math.cos(b*Math.PI*2),this.vertices.push(w),v.push(this.vertices.length-1),m.push(new n.Vec2(b,1-g))}h.push(v),d.push(m)}this.vertices.push(new n.Vec3(0,-a,0));var E=this.headRadius/u,S,x;for(f=0;f<s;f++){S=this.vertices[c[0][f]].clone(),x=this.vertices[c[0][f+1]].clone(),S.setY(Math.sqrt(S.x*S.x+S.z*S.z)*E).normalize(),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*E).normalize();for(l=0;l<o;l++){var T=c[l][f],N=c[l+1][f],C=c[l+1][f+1],k=c[l][f+1],L=S.clone(),A=S.clone(),O=x.clone(),M=x.clone(),_=p[l][f].clone(),D=p[l+1][f].clone(),P=p[l+1][f+1].clone(),H=p[l][f+1].clone();this.faces.push(new n.Face3(T,N,k,[L,A,M])),this.uvs.push([_,D,H]),this.faces.push(new n.Face3(N,C,k,[A,O,M])),this.uvs.push([D,P,H])}}for(f=0;f<s;f++){var T=c[l][f+1],N=c[l][f],C=c.length-1,L=new n.Vec3(0,-1,0),A=new n.Vec3(0,-1,0),O=new n.Vec3(0,-1,0),_=p[l][f+1].clone(),D=p[l][f].clone(),P=new n.Vec2(D.u,1);this.faces.push(new n.Face3(T,N,C,[L,A,O])),this.uvs.push([_,D,P])}var E=0,S,x;for(f=0;f<s;f++){S=this.vertices[h[1][f]].clone(),x=this.vertices[h[1][f+1]].clone(),S.setY(Math.sqrt(S.x*S.x+S.z*S.z)*E).normalize(),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*E).normalize();for(l=0;l<o;l++){var T=h[l][f],N=h[l+1][f],C=h[l+1][f+1],k=h[l][f+1],L=S.clone(),A=S.clone(),O=x.clone(),M=x.clone(),_=p[l][f].clone(),D=p[l+1][f].clone(),P=p[l+1][f+1].clone(),H=p[l][f+1].clone();this.faces.push(new n.Face3(T,N,k,[L,A,M])),this.uvs.push([_,D,H]),this.faces.push(new n.Face3(N,C,k,[A,O,M])),this.uvs.push([D,P,H])}}for(f=0;f<s;f++){var T=h[l][f+1],N=h[l][f],C=h.length-1,L=new n.Vec3(0,-1,0),A=new n.Vec3(0,-1,0),O=new n.Vec3(0,-1,0),_=d[l][f+1].clone(),D=d[l][f].clone(),P=new n.Vec2(D.u,1);this.faces.push(new n.Face3(T,N,C,[L,A,O])),this.uvs.push([_,D,P])}return this},n.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},n.extend(n.Arrow,n.Entity,{}),n.BufferNode=function(){this.uuid=n.Math.generateUUID(),this.name="",this.attributes={},this.dynamic=!0,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[],this.materialSize=1,this.createMaterial(),n.Node.call(this)},n.extend(n.BufferNode,n.Node,{constructor:n.BufferNode,compuateBufferData:function(){if(!this.computed){var e=this.attributes.position;e&&e.array&&(e.itemSize=3,e.numItems=e.array.length,this.verticesNeedUpdate=!0);var t=this.attributes.uv;t&&t.array&&(t.itemSize=2,t.numItems=t.array.length,this.uvsNeedUpdate=!0);var n=this.attributes.index;n&&n.array&&(this.offsets=[{index:0,start:0,count:n.array.length}]),this.computed=!0}},applyMatrix:function(e){var r,i;this.attributes.position&&(r=this.attributes.position.array),this.attributes.normal&&(i=this.attributes.normal.array),r!==t&&(e.multiplyVec3Array(r),this.verticesNeedUpdate=!0);if(i!==t){var s=(new n.Matrix3).getNormalMatrix(e);s.multiplyVec3Array(i),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new n.BoundingBox);var e=this.attributes.position.array;if(e){var r=this.boundingBox,i,s,o;e.length>=3&&(r.min.x=r.max.x=e[0],r.min.y=r.max.y=e[1],r.min.z=r.max.z=e[2]);for(var u=3,a=e.length;u<a;u+=3)i=e[u],s=e[u+1],o=e[u+2],i<r.min.x?r.min.x=i:i>r.max.x&&(r.max.x=i),s<r.min.y?r.min.y=s:s>r.max.y&&(r.max.y=s),o<r.min.z?r.min.z=o:o>r.max.z&&(r.max.z=o)}if(e===t||e.length===0)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var e=new n.BoundingBox,t=new n.Vec3;return function(){this.boundingSphere===null&&(this.boundingSphere=new n.BoundingSphere);var r=this.attributes.position.array;if(r){var i=this.boundingSphere.center,s=[];for(var o=0,u=r.length;o<u;o+=3)t.set(r[o],r[o+1],r[o+2]),s.push(t);e.setFromPoints(s),e.center(i);var a=0;for(var o=0,u=r.length;o<u;o+=3)t.set(r[o],r[o+1],r[o+2]),a=Math.max(a,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a)}}}(),computeVertexNormals:function(){if(this.attributes.position){var e,r,i,s,o=this.attributes.position.array.length;if(this.attributes.normal===t)this.attributes.normal={itemSize:3,array:new Float32Array(o)};else for(e=0,r=this.attributes.normal.array.length;e<r;e++)this.attributes.normal.array[e]=0;var u=this.attributes.position.array,a=this.attributes.normal.array,f,l,c,h,p,d,v=new n.Vec3,m=new n.Vec3,g=new n.Vec3,y=new n.Vec3,b=new n.Vec3;if(this.attributes.index){var w=this.attributes.index.array,E=this.offsets;for(i=0,s=E.length;i<s;++i){var S=E[i].start,x=E[i].count,T=E[i].index;for(e=S,r=S+x;e<r;e+=3)f=T+w[e],l=T+w[e+1],c=T+w[e+2],h=u[f*3],p=u[f*3+1],d=u[f*3+2],v.set(h,p,d),h=u[l*3],p=u[l*3+1],d=u[l*3+2],m.set(h,p,d),h=u[c*3],p=u[c*3+1],d=u[c*3+2],g.set(h,p,d),y.subVectors(g,m),b.subVectors(v,m),y.cross(b),a[f*3]+=y.x,a[f*3+1]+=y.y,a[f*3+2]+=y.z,a[l*3]+=y.x,a[l*3+1]+=y.y,a[l*3+2]+=y.z,a[c*3]+=y.x,a[c*3+1]+=y.y,a[c*3+2]+=y.z}}else for(e=0,r=u.length;e<r;e+=9)h=u[e],p=u[e+1],d=u[e+2],v.set(h,p,d),h=u[e+3],p=u[e+4],d=u[e+5],m.set(h,p,d),h=u[e+6],p=u[e+7],d=u[e+8],g.set(h,p,d),y.subVectors(g,m),b.subVectors(v,m),y.cross(b),a[e]=y.x,a[e+1]=y.y,a[e+2]=y.z,a[e+3]=y.x,a[e+4]=y.y,a[e+5]=y.z,a[e+6]=y.x,a[e+7]=y.y,a[e+8]=y.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){var e=this.attributes.normal.array,t,n,r,i;for(var s=0,o=e.length;s<o;s+=3)t=e[s],n=e[s+1],r=e[s+2],i=1/Math.sqrt(t*t+n*n+r*r),e[s]*=i,e[s+1]*=i,e[s+2]*=i},computeTangents:function(){function q(e,t,n){h=r[e*3],p=r[e*3+1],d=r[e*3+2],v=r[t*3],m=r[t*3+1],g=r[t*3+2],y=r[n*3],b=r[n*3+1],w=r[n*3+2],E=s[e*2],S=s[e*2+1],x=s[t*2],T=s[t*2+1],N=s[n*2],C=s[n*2+1],k=v-h,L=y-h,A=m-p,O=b-p,M=g-d,_=w-d,D=x-E,P=N-E,H=T-S,B=C-S,j=1/(D*B-P*H),F.set((B*k-H*L)*j,(B*A-H*O)*j,(B*M-H*_)*j),I.set((D*L-P*k)*j,(D*O-P*A)*j,(D*_-P*M)*j),f[e].add(F),f[t].add(F),f[n].add(F),l[e].add(I),l[t].add(I),l[n].add(I)}function st(e){et.x=i[e*3],et.y=i[e*3+1],et.z=i[e*3+2],tt.copy(et),rt=f[e],Y.copy(rt),Y.sub(et.multiplyScalar(et.dot(rt))).normalize(),Z.crossVectors(tt,rt),it=Z.dot(l[e]),nt=it<0?-1:1,a[e*4]=Y.x,a[e*4+1]=Y.y,a[e*4+2]=Y.z,a[e*4+3]=nt}if(this.attributes.index===t||this.attributes.position===t||this.attributes.normal===t||this.attributes.uv===t){console.warn("Missing required attributes (index, position, normal or uv) in BufferNode.computeTangents()"
);return}var e=this.attributes.index.array,r=this.attributes.position.array,i=this.attributes.normal.array,s=this.attributes.uv.array,o=r.length/3;if(this.attributes.tangent===t){var u=4*o;this.attributes.tangent={itemSize:4,array:new Float32Array(u)}}var a=this.attributes.tangent.array,f=[],l=[];for(var c=0;c<o;c++)f[c]=new n.Vec3,l[c]=new n.Vec3;var h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F=new n.Vec3,I=new n.Vec3,R,U,z,W,X,V,$,J=this.offsets;for(z=0,W=J.length;z<W;++z){var K=J[z].start,Q=J[z].count,G=J[z].index;for(R=K,U=K+Q;R<U;R+=3)X=G+e[R],V=G+e[R+1],$=G+e[R+2],q(X,V,$)}var Y=new n.Vec3,Z=new n.Vec3,et=new n.Vec3,tt=new n.Vec3,nt,rt,it;for(z=0,W=J.length;z<W;++z){var K=J[z].start,Q=J[z].count,G=J[z].index;for(R=K,U=K+Q;R<U;R+=3)X=G+e[R],V=G+e[R+1],$=G+e[R+2],st(X),st(V),st($)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},clone:function(){var e=new n.BufferNode,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var r in this.attributes){var i=this.attributes[r],s=i.array,o={itemSize:i.itemSize,numItems:i.numItems,array:null};for(var u=0,a=t.length;u<a;u++){var f=t[u];if(s instanceof f){o.array=new f(s);break}}e.attributes[r]=o}for(var u=0,a=this.offsets.length;u<a;u++){var l=this.offsets[u];e.offsets.push({start:l.start,index:l.index,count:l.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}}),n.Particle=function(e,t){var r;arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])&&(r=arguments[0],this._id=r.id),n.Node.call(this,this._id),this.material=new n.ParticleMaterial({color:Math.random()*16777215}),this.sortParticles=!1,this.frustumCulled=!1,this.vertices=(r?r.vertices:e)||[],this.colors=(r?r.colors:t)||[]},n.extend(n.Particle,n.Node,{clone:function(e){return e===t&&(e=new n.Particle(this.material)),e.sortParticles=this.sortParticles,e.frustumCulled=this.frustumCulled,n.Element.prototype.clone.call(this,e),e},needUpdate:function(){return!1},setUpdateFlags:function(e){this.verticesNeedUpdate=e},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)}}),n.Line=function(){var e,r,i;if(arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var s=arguments[0];e=s.vertices,r=s.colors,i=s.type,this._id=s.id||this._id}else e=arguments[0],r=arguments[1],i=arguments[2];n.Node.call(this,this._id),this.material=new n.LineMaterial({color:16777215}),this.type=i!==t?i:n.LineStrip,this.vertices=e||[],this.colors=r||[]},n.LineStrip=0,n.LinePieces=1,n.extend(n.Line,n.Node,{className:"TGL.Line",__accessor:["vertices","type"],__SizePropeties:["vertices","type"],clone:function(e){return e===t&&(e=new n.Line(this.material,this.type)),n.Element.prototype.clone.call(this,e,!0),e},onPropertyChange:function(){},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)},setMaterialStyles:function(e){n.Element.prototype.setMaterialStyles.call(this,e)}}),n.Line.createEllipse=function(e,t,r,i,s,o,u){typeof e=="number"?(u=o,o=s,s=i,i=r,r=t,t=e,e=new n.Line):e==null&&(e=new n.Line);var a=new n.EllipseCurve(0,0,t,r,s,o,u),f=[],l=i||50;for(var c=0;c<=l;c++){var h=a.getPoint(c/l);f.push(h)}return e.setVertices(f),e},n.Line.createHelix=function(e,t,r,i,s,u){typeof e=="number"?(u=s,s=i,i=r,r=t,t=e,e=new n.Line):e==null&&(e=new n.Line);var a=[],f=u||50;s=s||1;var l,c,h,p;for(var d=0;d<=f;d++)l=(r*d+t*(f-d))/f,h=s*Math.PI*2*d/f,c=i*(.5-d/f),p=new o(l*Math.sin(h),c,l*Math.cos(h)),a.push(p);return e.setVertices(a),e},n.Line.createRectangle=function(e,t,r,i){typeof e=="number"?(i=r,r=t,t=e,e=new n.Line):e==null&&(e=new n.Line);var s=i||50,u=(t+r)*2/s,a=[];if(u>Math.min(t,r))a.push(new o(-t/2,-r/2,0)),a.push(new o(-t/2,r/2,0)),a.push(new o(t/2,r/2,0)),a.push(new o(t/2,-r/2,0)),a.push(new o(-t/2,-r/2,0));else{var f=-t/2,l=-r/2,c;for(var h=0;h<=s;h++)f==-t/2&&l<r/2?l+u<=r/2?l+=u:(a.push(new o(-t/2,r/2,0)),a.push(new o(-t/2,r/2,0)),f+=l+u-r/2,l=r/2):l==r/2&&f<=t/2?f+u<=t/2?f+=u:(a.push(new o(t/2,r/2,0)),a.push(new o(t/2,r/2,0)),l-=f+u-t/2,f=t/2):f==t/2&&l>-r/2?l-u>=-r/2?l-=u:(a.push(new o(t/2,-r/2,0)),a.push(new o(t/2,-r/2,0)),f-=-r/2-l+u,l=-r/2):l==-r/2&&f>=-t/2&&(f-u>=-t/2?f-=u:(l+=-t/2-f+u,f=-t/2)),c=new o(f,l,0),a.push(c)}return e.setVertices(a),e},n.Polyhedron=function(){function w(e){var t=e.normalize().clone();t.index=s.vertices.push(t)-1;var r=x(e)/2/Math.PI+.5,i=T(e)/Math.PI+.5;return t.uv=new n.Vec3(r,1-i),t}function E(e,t,r){var i=new n.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);i.centroid.add(e).add(t).add(r).divideScalar(3),s.faces.push(i);var o=x(i.centroid);s.uvs.push([N(e.uv,e,o),N(t.uv,t,o),N(r.uv,r,o)])}function S(e,t){var n=Math.pow(2,t),r=Math.pow(4,t),i=w(s.vertices[e.a]),o=w(s.vertices[e.b]),u=w(s.vertices[e.c]),a=[];for(var f=0;f<=n;f++){a[f]=[];var l=w(i.clone().lerp(u,f/n)),c=w(o.clone().lerp(u,f/n)),h=n-f;for(var p=0;p<=h;p++)p==0&&f==n?a[f][p]=l:a[f][p]=w(l.clone().lerp(c,p/h))}for(var f=0;f<n;f++)for(var p=0;p<2*(n-f)-1;p++){var d=Math.floor(p/2);p%2==0?E(a[f][d+1],a[f+1][d],a[f][d]):E(a[f][d+1],a[f+1][d+1],a[f+1][d])}}function x(e){return Math.atan2(e.z,-e.x)}function T(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function N(e,t,r){return r<0&&e.x===1&&(e=new n.Vec3(e.x-1,e.y)),t.x===0&&t.z===0&&(e=new n.Vec3(r/2/Math.PI+.5,e.y)),e.clone()}var e,t,r,i;arguments[0]instanceof n.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4]):(e=arguments[0],t=arguments[1],r=arguments[2],i=arguments[3]),this.materialSize=1,n.Entity.call(this),r=r||1,i=i||0;var s=this;for(var o=0,u=e.length;o<u;o++)w(new n.Vec3(e[o][0],e[o][1],e[o][2]));var a=[],f=this.vertices,l=[];for(var o=0,u=t.length;o<u;o++){var c=f[t[o][0]],h=f[t[o][1]],p=f[t[o][2]];l[o]=new n.Face3(c.index,h.index,p.index,[c.clone(),h.clone(),p.clone()])}for(var o=0,u=l.length;o<u;o++)S(l[o],i);for(var o=0,u=this.uvs.length;o<u;o++){var d=this.uvs[o],v=d[0].x,m=d[1].x,g=d[2].x,y=Math.max(v,Math.max(m,g)),b=Math.min(v,Math.min(m,g));y>.9&&b<.1&&(v<.2&&(d[0].x+=1),m<.2&&(d[1].x+=1),g<.2&&(d[2].x+=1))}for(var o=0,u=this.vertices.length;o<u;o++)this.vertices[o].multiplyScalar(r);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new n.BoundingSphere(new n.Vec3,r)},n.extend(n.Polyhedron,n.Entity,{}),n.Octahedron=function(e,t,r){var i=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],s=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];n.Polyhedron.call(this,e,i,s,t,r)},n.extend(n.Octahedron,n.Polyhedron,{clone:function(){return new n.Octahedron(this.material,this.radius,this.detail)}}),n.Axis=function(e){e=e||1;var t=[],r=[];t.push(new n.Vec3,new n.Vec3(e,0,0),new n.Vec3,new n.Vec3(0,e,0),new n.Vec3,new n.Vec3(0,0,e)),r.push(new n.Color(16711680),new n.Color(16711680),new n.Color(65280),new n.Color(65280),new n.Color(255),new n.Color(255));var i=new n.LineMaterial({vertexColors:n.VertexColors,depthTest:!1,depthMask:!1});n.Line.call(this,t,r,n.LinePieces),this.material=i,this.xAxisText=this.makeAxisText("X",16711680),this.yAxisText=this.makeAxisText("Y",65280),this.zAxisText=this.makeAxisText("Z",255),this.xAxisText.setParent(this),this.yAxisText.setParent(this),this.zAxisText.setParent(this),this.setSize(e),this._sizeFixed=!0},n.extend(n.Axis,n.Line,{showAxisText:function(e){this.xAxisText._visible=e,this.yAxisText._visible=e,this.zAxisText._visible=e},setSize:function(e){this.vertices[1].x=e,this.vertices[3].y=e,this.vertices[5].z=e,this.xAxisText.setPosition(e,0,0),this.yAxisText.setPosition(0,e,0),this.zAxisText.setPosition(0,0,e)},fixSize:function(e){n.Element.prototype.fixSize.call(this,e);var t=this._scale.x,r=this._scale.y,i=this._scale.z;this.xAxisText.setScale(3,3,1),this.yAxisText.setScale(3,3,1),this.zAxisText.setScale(3,3,1)},makeAxisText:function(e,t){var r="Arial",i=36,s=n.BillboardAlignment.topLeft,o=document.createElement("canvas"),u=o.getContext("2d");u.font="Bold "+i+"px "+r,t instanceof n.Color||(t=new n.Color(t));var a=u.measureText(e),f=a.width;o.width=f,o.height=u.measureText("e").width*2+4,u.fillStyle="rgba("+t.r*255+", "+t.g*255+", "+t.b*255+", 1.0)",u.fillText(e,0,10);var l=new n.Texture(o),c=new n.BillboardMaterial({map:l,useScreenCoordinates:!1,alignment:s,depthTest:!1,depthMask:!1}),h=new n.Billboard;return h.material=c,h}}),n.Curve=function(){},n.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},n.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},n.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},n.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},n.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},n.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t},n.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},n.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;t?s=t:s=e*n[i-1];var o=0,u=i-1,a;while(o<=u){r=Math.floor(o+(u-o)/2),a=n[r]-s;if(a<0){o=r+1;continue}if(a>0){u=r-1;continue}u=r;break}r=u;if(n[r]==s){var f=r/(i-1);return f}var l=n[r],c=n[r+1],h=c-l,p=(s-l)/h,f=(r+p)/(i-1);return f},n.Curve.prototype.getTangent=function(e){var t=1e-4,n=e-t,r=e+t;n<0&&(n=0),r>1&&(r=1);var i=this.getPoint(n),s=this.getPoint(r),o=s.clone().sub(i);return o.normalize()},n.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},n.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e,t,n,r,i){var s=6*e*e-6*e,o=3*e*e-4*e+1,u=-6*e*e+6*e,a=3*e*e-2*e;return s+o+u+a},interpolate:function(e,t,n,r,i){var s=(n-e)*.5,o=(r-t)*.5,u=i*i,a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t}},n.Curve.create=function(e,t){return e.prototype=Object.create(n.Curve.prototype),e.prototype.getPoint=t,e},n.LineCurve=function(e,t){this.v1=e,this.v2=t},n.LineCurve.prototype=Object.create(n.Curve.prototype),n.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},n.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},n.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},n.LineCurve3=function(e,t){this.v1=e,this.v2=t,this.getPoint=function(e){var t=new n.Vec3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}},n.extend(n.LineCurve3,n.Curve,{}),n.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},n.CurvePath.prototype=Object.create(n.Curve.prototype),n.CurvePath.prototype.add=function(e){this.curves.push(e)},n.CurvePath.prototype.checkConnection=function(){},n.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new n.LineCurve3(t,e))},n.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength(),n=this.getCurveLengths(),r=0,i,s;while(r<n.length){if(n[r]>=t){i=n[r]-t,s=this.curves[r];var o=1-i/s.getLength();return s.getPointAt(o)}r++}return null},n.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},n.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},n.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,r,i,s,o,u;t=r=Number.NEGATIVE_INFINITY,s=o=Number.POSITIVE_INFINITY;var a,f,l,c,h=e[0]instanceof n.Vec3;c=h?new n.Vec3:new n.Vec2;for(f=0,l=e.length;f<l;f++)a=e[f],a.x>t?t=a.x:a.x<s&&(s=a.x),a.y>r?r=a.y:a.y<o&&(o=a.y),h&&(a.z>i?i=a.z:a.z<u&&(u=a.z)),c.add(a);var p={minX:s,minY:o,maxX:t,maxY:r,centroid:c.divideScalar(l)};return h&&(p.maxZ=i,p.minZ=u),p},n.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},n.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},n.CurvePath.prototype.createGeometry=function(e){var t=new n.Geometry;for(var r=0;r<e.length;r++)t.vertices.push(new n.Vec3(e[r].x,e[r].y,e[r].z||0));return t},n.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},n.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends);for(r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},n.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends);for(r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},n.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;for(r=0,i=e.length;r<i;r++){s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o);var f=t.getPoint(a),l=t.getTangent(a);l.set(-l.y,l.x).multiplyScalar(u),s.x=f.x+l.x,s.y=f.y+l.y}return e},n.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i||0,this.aEndAngle=s||Math.PI*2,this.aClockwise=o},n.EllipseCurve.prototype=Object.create(n.Curve.prototype),n.EllipseCurve.prototype.getPoint=function(e){var t,r=this.aEndAngle-this.aStartAngle;r<0&&(r+=Math.PI*2),r>Math.PI*2&&(r-=Math.PI*2),this.aClockwise===!0?t=this.aEndAngle+(1-e)*(Math.PI*2-r):t=this.aStartAngle+e*r;var i=this.aX+this.xRadius*Math.cos(t),s=this.aY+this.yRadius*Math.sin(t);return new n.Vec3(i,s,0)},n.ArcCurve=function(e,t,r,i,s,o){n.EllipseCurve.call(this,e,t,r,r,i,s,o)},n.ArcCurve.prototype=Object.create(n.EllipseCurve.prototype),n.Path=function(e){n.CurvePath.call(this),this.actions=[],this.points=[],e&&this.fromPoints(e)},n.extend(n.Path,n.CurvePath,{constructor:n.Path,className:"TGL.Path",serializeJsonValue:function(){return{actions:this.actions,"class":"TGL.Path"}},deserializeJsonValue:function(e){var t,n,r,i;for(i=0;i<e.actions.length;i++)n=e.actions[i],t=n.action,r=n.args,this[t].apply(this,r)}}),n.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"curveTo",BEZIER_CURVE_TO:"bCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},n.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y,e[0].z);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y,e[t].z)},n.Path.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.lineTo(e.x,e.y,e.z)},n.Path.prototype.reverse=function(){var e=new n.Path,t,r=this.actions.length,i,s,o,u,a;for(t=r-1;t>=0;t--){s=this.actions[t].args,o=s.length,t===r-1&&e.moveTo(s[o-3],s[o-2],s[o-1]);if(u!=null)switch(a){case n.PathActions.MOVE_TO:e.moveTo(s[o-3],s[o-2],s[o-1]);break;case n.PathActions.LINE_TO:e.lineTo(s[o-3],s[o-2],s[o-1]);break;case n.PathActions.QUADRATIC_CURVE_TO:e.quadraticCurveTo(u[0],u[1],u[2],s[o-3],s[o-2],s[o-1]);break;case n.PathActions.BEZIER_CURVE_TO:e.bezierCurveTo(u[3],u[4],u[5],u[0],u[1],u[2],s[o-3],s[o-2],s[o-1])}u=s,a=this.actions[t].action}return e},n.Path.prototype.moveTo=function(e,t,r){e=e||0,t=t||0,r=r||0;var i=Array.prototype.slice.call(arguments);this.actions.push({action:n.PathActions.MOVE_TO,args:i}),this.points.push(new o(e,t,r))},n.Path.prototype.lineTo=function(e,t,r){e=e||0,t=t||0,r=r||0;if(this.actions&&this.actions.length===1){var i=this.actions[0].args;i[0]===e&&i[1]===t&&i[2]===r&&(console.log("TGL.Path:lineTo the same point of moveTo"),e=.01)}var i=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,u=s[s.length-3],a=s[s.length-2],f=s[s.length-1],l=new n.LineCurve3(new n.Vec3(u,a,f),new n.Vec3(e,t,r));this.curves.push(l),this.actions.push({action:n.PathActions.LINE_TO,args:i}),this.points.push(new o(e,t,r))},n.Path.prototype.quadraticCurveTo=function(e,t,r,i,s,u){e=e||0,t=t||0,r=r||0,i=i||0,s=s||0,u=u||0;if(this.actions&&this.actions.length===1){var a=this.actions[0].args;a[0]===i&&a[1]===s&&a[2]===u&&(console.log("TGL.Path:quadraticCurveTo the same point of moveTo"),i=.01)}var a=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args,l=f[f.length-3],c=f[f.length-2],h=f[f.length-1],p=new n.QuadraticBezierCurve3(new n.Vec3(l,c,h),new n.Vec3(e,t,r),new n.Vec3(i,s,u));this.curves.push(p),this.actions.push({action:n.PathActions.QUADRATIC_CURVE_TO,args:a}),this.points.push(new o(i,s,u))},n.Path.prototype.curveTo=n.Path.prototype.quadraticCurveTo,n.Path.prototype.bezierCurveTo=function(e,t,r,i,s,u,a,f,l){var c=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,p=h[h.length-3],d=h[h.length-2],v=h[h.length-1],m=new n.CubicBezierCurve3(new n.Vec3(p,d,v),new n.Vec3(e,t,r),new n.Vec3(i,s,u),new n.Vec3(a,f,l));this.curves.push(m),this.actions.push({action:n.PathActions.BEZIER_CURVE_TO,args:c}),this.points.push(new o(a,f,l))},n.Path.prototype.isClockwise=function(){if(this.points.length<2)return t;if(this.points.length<3){var e=this.points[0],r=this.points[1];return r.x>e.x}return n.Math.isClockwise(this.points)},n.Path.prototype.bCurveTo=n.Path.prototype.bezierCurveTo,n.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],s=r[r.length-1],o=[new n.Vec2(i,s)];Array.prototype.push.apply(o,e);var u=new n.SplineCurve(o);this.curves.push(u),this.actions.push({action:n.PathActions.CSPLINE_THRU,args:t})},n.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args,u=o[o.length-2],a=o[o.length-1];this.absarc(e+u,t+a,n,r,i,s)},n.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)},n.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args,a=u[u.length-2],f=u[u.length-1];this.absellipse(e+a,t+f,n,r,i,s,o)},n.Path.prototype.absellipse=function(e,t,r,i,s,o,u){var a=Array.prototype.slice.call(arguments),f=new n.EllipseCurve(e,t,r,i,s,o,u);this.curves.push(f);var l=f.getPoint(1);a.push(l.x),a.push(l.y),this.actions.push({action:n.PathActions.ELLIPSE,args:a})},n.Path.prototype.toArray=function(){var e,t=this.actions.length,n=[];for(e=0;e<t;e++){var r=this.actions[e];r.action==="moveTo"?(n.push("m"),n.push(r.args[0]),n.push(r.args[1]),n.push(r.args[2])):r.action==="lineTo"?(n.push("l"),n.push(r.args[0]),n.push(r.args[1]),n.push(r.args[2])):r.action==="curveTo"&&(n.push("c"),n.push(r.args[0]),n.push(r.args[1]),n.push(r.args[2]),n.push(r.args[3]),n.push(r.args[4]),n.push(r.args[5]))}return n},n.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);var n=[];for(var r=0;r<e;r++)n.push(this.getPoint(r/e));return n},n.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var r=[],i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;for(i=0,s=this.actions.length;i<s;i++){o=this.actions[i],u=o.action,a=o.args;switch(u){case n.PathActions.MOVE_TO:r.push(new n.Vec3(a[0],a[1],a[2]));break;case n.PathActions.LINE_TO:r.push(new n.Vec3(a[0],a[1],a[2]));break;case n.PathActions.QUADRATIC_CURVE_TO:f=a[3],l=a[4],c=a[5],v=a[0],m=a[1],g=a[2],r.length>0?(E=r[r.length-1],y=E.x,b=E.y,w=E.z):(E=this.actions[i-1].args,y=E[E.length-3],b=E[E.length-2],w=E[E.length-1]);for(S=1;S<=e;S++)x=S/e,T=n.Shape.Utils.b2(x,y,v,f),N=n.Shape.Utils.b2(x,b,m,l),tz=n.Shape.Utils.b2(x,w,g,c),r.push(new n.Vec3(T,N,tz));break;case n.PathActions.BEZIER_CURVE_TO:f=a[6],l=a[7],c=a[8],v=a[0],m=a[1],g=a[2],h=a[3],p=a[4],d=a[5],r.length>0?(E=r[r.length-1],y=E.x,b=E.y,w=E.z):(E=this.actions[i-1].args,y=E[E.length-3],b=E[E.length-2],w=E[E.length-1]);for(S=1;S<=e;S++)x=S/e,T=n.Shape.Utils.b3(x,y,v,h,f),N=n.Shape.Utils.b3(x,b,m,p,l),tz=n.Shape.Utils.b3(x,w,g,d,c),r.push(new n.Vec3(T,N,tz));break;case n.PathActions.CSPLINE_THRU:E=this.actions[i-1].args;var C=new n.Vec2(E[E.length-2],E[E.length-1]),k=[C],L=e*a[0].length;k=k.concat(a[0]);var A=new n.SplineCurve(k);for(S=1;S<=L;S++)r.push(A.getPointAt(S/L));break;case n.PathActions.ARC:var O=a[0],M=a[1],_=a[2],D=a[3],P=a[4],H=!!a[5],B=P-D,j,F=e*2;for(S=1;S<=F;S++)x=S/F,H||(x=1-x),j=D+x*B,T=O+_*Math.cos(j),N=M+_*Math.sin(j),r.push(new n.Vec3(T,N));break;case n.PathActions.ELLIPSE:var O=a[0],M=a[1],I=a[2],q=a[3],D=a[4],P=a[5],H=!!a[6],B=P-D,j,F=e*2;for(S=1;S<=F;S++)x=S/F,H||(x=1-x),j=D+x*B,T=O+I*Math.cos(j),N=M+q*Math.sin(j),r.push(new n.Vec3(T,N))}}var R=r[r.length-1],U=1e-10;return Math.abs(R.x-r[0].x)<U&&Math.abs(R.y-r[0].y)<U&&r.splice(r.length-1,1),t&&r.push(r[0]),r},n.Path.prototype.toShapes=function(e){var r,i,s,o,u,a=[],f=new n.Path;for(r=0,i=this.actions.length;r<i;r++)s=this.actions[r],u=s.args,o=s.action,o==n.PathActions.MOVE_TO&&f.actions.length!=0&&(a.push(f),f=new n.Path),f[o].apply(f,u);f.actions.length!=0&&a.push(f);if(a.length==0)return[];var l,c,h,p=[];if(a.length==1)return c=a[0],h=new n.Shape,h.actions=c.actions,h.curves=c.curves,p.push(h),p;var d=!n.Shape.Utils.isClockWise(a[0].getPoints());d=e?!d:d;if(d){h=new n.Shape;for(r=0,i=a.length;r<i;r++)c=a[r],l=n.Shape.Utils.isClockWise(c.getPoints()),l=e?!l:l,l?(h.actions=c.actions,h.curves=c.curves,p.push(h),h=new n.Shape):h.holes.push(c)}else{h=t;for(r=0,i=a.length;r<i;r++)c=a[r],l=n.Shape.Utils.isClockWise(c.getPoints()),l=e?!l:l,l?(h&&p.push(h),h=new n.Shape,h.actions=c.actions,h.curves=c.curves):h.holes.push(c);p.push(h)}return p},n.Shape=function(){n.Path.apply(this,arguments),this.holes=[]},n.Shape.prototype=Object.create(n.Path.prototype),n.Shape.prototype.extrude=function(e){var t=new n.ShapeNode(this,e);return t},n.Shape.prototype.makeGeometry=function(e){var t=new n.ShapeGeometry(this,e);return t},n.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},n.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},n.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},n.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},n.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},n.Shape.Utils={removeHoles:function(e,t){var r=e.concat(),i=r.concat(),s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=[];for(p=0;p<t.length;p++){v=t[p],Array.prototype.push.apply(i,v),m=Number.POSITIVE_INFINITY;for(d=0;d<v.length;d++){b=v[d];var C=[];for(y=0;y<r.length;y++)w=r[y],g=b.distanceToSquared(w),C.push(g),g<m&&(m=g,f=d,l=y)}s=l-1>=0?l-1:r.length-1,u=f-1>=0?f-1:v.length-1;var k=[v[f],r[l],r[s]],L=n.FontUtils.Triangulate.area(k),A=[v[f],v[u],r[l]],O=n.FontUtils.Triangulate.area(A),M=1,_=-1,D=l,P=f;l+=M,f+=_,l<0&&(l+=r.length),l%=r.length,f<0&&(f+=v.length),f%=v.length,s=l-1>=0?l-1:r.length-1,u=f-1>=0?f-1:v.length-1,k=[v[f],r[l],r[s]];var H=n.FontUtils.Triangulate.area(k);A=[v[f],v[u],r[l]];var B=n.FontUtils.Triangulate.area(A);L+O>H+B&&(l=D,f=P,l<0&&(l+=r.length),l%=r.length,f<0&&(f+=v.length),f%=v.length,s=l-1>=0?l-1:r.length-1,u=f-1>=0?f-1:v.length-1),E=r.slice(0,l),S=r.slice(l),x=v.slice(f),T=v.slice(0,f);var j=[v[f],r[l],r[s]],F=[v[f],v[u],r[l]];N.push(j),N.push(F),r=E.concat(x).concat(T).concat(S)}return{shape:r,isolatedPts:N,allpoints:i}},triangulateShape:function(e,r){var i=n.Shape.Utils.removeHoles(e,r),s=i.shape,o=i.allpoints,u=i.isolatedPts,a=n.FontUtils.Triangulate(s,!1),f,l,c,h,p,d,v={},m={};for(f=0,l=o.length;f<l;f++)p=o[f].x+":"+o[f].y,v[p]!==t&&console.log("Duplicate point",p),v[p]=f;for(f=0,l=a.length;f<l;f++){h=a[f];for(c=0;c<3;c++)p=h[c].x+":"+h[c].y,d=v[p],d!==t&&(h[c]=d)}for(f=0,l=u.length;f<l;f++){h=u[f];for(c=0;c<3;c++)p=h[c].x+":"+h[c].y,d=v[p],d!==t&&(h[c]=d)}return a.concat(u)},isClockWise:function(e){return n.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){var n=1-e;return 3*n*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},n.CubicBezierCurve3=n.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t,r,i;return t=n.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=n.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),i=n.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new n.Vector3(t,r,i)}),n.QuadraticBezierCurve3=n.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,r,i;return t=n.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=n.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),i=n.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new n.Vec3(t,r,i)}),n.PathNode=function(e,r,i,s,o,u,a,f,l,c){this.materialSize=1,this.closed=!1;var h;arguments.length===1&&arguments[0]instanceof Object&&!(arguments[0]instanceof n.Path)?(h=arguments[0],this.path=h.path,this.segments=h.segments||20,this.radius=h.radius||1,this.segmentsR=h.segmentsR||8,this.shape=h.shape,this.startCap=h.startCap||"plain",this.endCap=h.endCap||"plain",this.arc=h.arc!=t?h.arc:Math.PI*2,this.arcStart=h.arcStart!=t?h.arcStart:0,this.cutSurface=h.cutSurface||"none",this.startCapR=h.startCapR,this.endCapR=h.endCapR,this.startCapSize=h.startCapSize,this.endCapSize=h.endCapSize,this.startCapExtend=h.startCapExtend===t?1:h.startCapExtend,this.endCapExtend=h.endCapExtend===t?1:h.endCapExtend,this._id=h.id):(this.path=e,this.segments=r||20,this.radius=i||1,this.segmentsR=s||8,this.shape=a,this.startCap=o||"plain",this.endCap=u||"plain",this.arc=f!=t?f:Math.PI*2,this.arcStart=l!=t?l:0,this.cutSurface=c||"none"),this.startCapSize=this.startCapSize||1,this.endCapSize=this.endCapSize||1,this.segmentsCap=20,this.arc===Math.PI*2&&(this.cutSurface="none"),n.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},n.extend(n.PathNode,n.Entity,{constructor:n.PathNode,className:"TGL.PathNode",__accessor:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend"],__SizePropeties:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend"],getCrossSectionPoint:function(){},adjustPath:function(e,t,r){t=t||this.radius,r=r||1;var i=new n.Path,s,u,a,f,l,c,h,p,d,v=new o,m=new o,g,y=new o,b=new o,w,E,S=e.actions.length;for(E=0;E<S;E++)a=e.actions[E],l=E+1===S?null:e.actions[E+1],f=a.args,a.action==="moveTo"?i.moveTo(f[0],f[1],f[2]):a.action==="lineTo"?l&&l.action==="lineTo"?(s=e.actions[E-1],u=s.args,c=l.args,h=new o(u[0],u[1],u[2]),p=new o(f[0],f[1],f[2]),d=new o(c[0],c[1],c[2]),v.subVectors(p,h),m.subVectors(p,d),g=v.angleTo(m),w=Math.min(v.length()/2,m.length()/2),w=Math.min(t*r,w),y.addVectors(p,v.normalize().multiplyScalar(-w)),b.addVectors(p,m.normalize().multiplyScalar(-w)),i.lineTo(y.x,y.y,y.z),i.curveTo(p.x,p.y,p.z,b.x,b.y,b.z)):i.lineTo(f[0],f[1],f[2]):a.action==="quadraticCurveTo"&&i.curveTo(f[0],f[1],f[2],f[3],f[4],f[5]);return i},_resetPath:function(){return this.path},getPointAt:function(e){return this._realPath?this._realPath.getPoint(e):null},getTargentAt:function(e){if(this._realPath){var t=this._realPath.getPoint(e),n=this._realPath.getPoint(e-.001);return t.sub(n).normalize()}return null},computeData:function(){function Y(e,t,r,i){return i.vertices.push(new n.Vec3(e,t,r))-1}this.grid=[],this.startGrid=[],this.endGrid=[];var e=this.segmentsCap,t=this,r,i,o,u,a,f,l,c,h,p,d,v,m,g,y=new n.Vec3,b,w,E,S,x,T,N,C,k,L,A,O,M={};M.faces=[],M.uvs=[],M.vertices=[];if(this.path==null)return M;var _=this._resetPath(),D=this.startCap,P=this.endCap,H=this.cutSurface;this._realPath=_,this._autoAjust==1&&(_=this.adjustPath(_));var B=_.curves.length,j=_.curves,F=[],I,q=_.getLength(),N,R,U=0,z=this.segments,w;for(b=0;b<B;b++){N=j[b],R=N.getLength();if(N instanceof n.LineCurve3){var W=(R*.001+U)/q,X=(R*.999+U)/q;F.push(W),F.push(X)}else{var V=R*.998;for(w=0;w<=z;w++){var $=(R*.001+V*w/z+U)/q;F.push($)}}U+=R}var J=this.frenetFrames(_,F,this.closed),K=J.tangents,Q=J.normals,G=J.binormals;this.tangents=K,this.normals=Q,this.binormals=G;var Z=0,et,tt=F.length-1,nt=tt+1,rt=0,it=0;for(b=0;b<nt;b++){this.grid[b]=[],p=F[b],g=_.getPointAt(p),r=K[b],i=Q[b],o=G[b];if(D!=="none"&&b===0)if(D==="round"||D==="arrow"){var st,ot;rt+=this.radius*this.startCapSize;var ut=g.clone().add(r.clone().multiplyScalar(-this.radius*this.startCapSize));for(var at=0;at<=e;at++){this.startGrid[at]=[];var ft=at/e*Math.PI/2;D==="round"?st=ut.clone().add(r.clone().multiplyScalar(this.radius*this.startCapSize*(1-Math.cos(ft)))):st=ut.clone().add(r.clone().multiplyScalar(this.radius*this.startCapSize*at/e));for(var w=0;w<this.segmentsR;w++)d=w/this.segmentsR*this.arc+this.arcStart,D==="round"?(v=-this.radius*Math.cos(d)*Math.sin(ft),m=this.radius*Math.sin(d)*Math.sin(ft)):(v=-this.radius*Math.cos(d)*at/e,m=this.radius*Math.sin(d)*at/e,v*=this.startCapR||1.3,m*=this.startCapR||1.3),ot=st.clone(),ot.x+=v*i.x+m*o.x,ot.y+=v*i.y+m*o.y,ot.z+=v*i.z+m*o.z,this.startGrid[at][w]=M.vertices.push(ot)-1;H==="center"&&(this.startGrid[at][this.segmentsR]=M.vertices.push(st.clone())-1)}}else Z=M.vertices.push(g);for(w=0;w<this.segmentsR;w++){et=w/(this.segmentsR-1);if(this.shape instanceof Array)v=-this.shape[w].x,m=this.shape[w].y;else if(this.shape instanceof n.Path){var lt=this.shape.getPointAt(et);v=-lt.x,m=-lt.y}else d=w/this.segmentsR*this.arc+this.arcStart,v=-this.radius*Math.cos(d),m=this.radius*Math.sin(d);y.copy(g),y.x+=v*i.x+m*o.x,y.y+=v*i.y+m*o.y,y.z+=v*i.z+m*o.z,this.grid[b][w]=Y(y.x,y.y,y.z,M)}H==="center"&&(this.grid[b][this.segmentsR]=M.vertices.push(g.clone())-1);if(P!=="none"&&b===nt-1)if(P==="round"||P==="arrow"){it+=this.radius*this.endCapSize;var st,ot,ut=g.clone().add(r.clone().multiplyScalar(this.radius*this.endCapSize));for(var at=0;at<=e;at++){this.endGrid[at]=[];var ft=(1-at/e)*Math.PI/2;P==="round"?st=ut.clone().add(r.clone().multiplyScalar(-this.radius*this.endCapSize*(1-Math.cos(ft)))):st=ut.clone().add(r.clone().multiplyScalar(-this.radius*this.endCapSize*(1-at/e)));for(var w=0;w<this.segmentsR;w++)d=w/this.segmentsR*this.arc+this.arcStart,P==="round"?(v=-this.radius*Math.cos(d)*Math.sin(ft),m=this.radius*Math.sin(d)*Math.sin(ft)):(v=-this.radius*Math.cos(d)*(1-at/e),m=this.radius*Math.sin(d)*(1-at/e),v*=this.endCapR||1.3,m*=this.endCapR||1.3),ot=st.clone(),ot.x+=v*i.x+m*o.x,ot.y+=v*i.y+m*o.y,ot.z+=v*i.z+m*o.z,this.endGrid[at][w]=M.vertices.push(ot)-1;H==="center"&&(this.endGrid[at][this.segmentsR]=M.vertices.push(st)-1)}}else M.vertices.push(g)}var ct=this.segmentsR,ht=this.segmentsR;this.arc!==Math.PI*2&&(H==="center"?(ct++,ht++):H==="none"&&ct--);var pt=this.arc/Math.PI/2,dt=_.getLength(),vt=dt+rt+it,mt=0,gt=rt/vt,yt=gt,bt=dt/vt,wt=gt+bt,Et=it/vt,St=0;if(D!=="none")if(D==="plain"){x=0;for(w=0;w<this.segmentsR;w++){S=(w+1)%this.segmentsR,T=this.grid[0][w],N=this.grid[0][S],M.faces.push(new n.Face3(x,T,N)),d=w/this.segmentsR*2*Math.PI,v=-this.radius*Math.cos(d),m=this.radius*Math.sin(d);var k=new s(.5,.5);d=w/this.segmentsR*2*Math.PI,v=-this.radius*Math.cos(d),m=this.radius*Math.sin(d);var L=new s((v/this.radius+1)/2,(m/this.radius+1)/2);d=S/this.segmentsR*2*Math.PI,v=-this.radius*Math.cos(d),m=this.radius*Math.sin(d);var A=new s((v/this.radius+1)/2,(m/this.radius+1)/2);M.uvs.push([k,L,A])}}else for(b=0;b<=e;b++)for(w=0;w<ct;w++){E=b+1,S=(w+1)%ht,x=this.startGrid[b][w],E===e+1?(T=this.grid[0][w],N=this.grid[0][S]):(T=this.startGrid[E][w],N=this.startGrid[E][S]),C=this.startGrid[b][S];if(w>=this.segmentsR-1){var at=this.segmentsR-1,p=at/this.segmentsR*pt;ct===this.segmentsR?(k=new n.Vec2(b/e*gt+mt,p),L=new n.Vec2((b+1)/e*gt+mt,p),A=new n.Vec2((b+1)/e*gt+mt,1),
O=new n.Vec2(b/e*gt+mt,1)):w>this.segmentsR-1?(k=new n.Vec2(b/e*gt+mt,(1+p)/2),L=new n.Vec2((b+1)/e*gt+mt,(1+p)/2),A=new n.Vec2((b+1)/e*gt+mt,1),O=new n.Vec2(b/e*gt+mt,1)):(k=new n.Vec2(b/e*gt+mt,p),L=new n.Vec2((b+1)/e*gt+mt,p),A=new n.Vec2((b+1)/e*gt+mt,(1+p)/2),O=new n.Vec2(b/e*gt+mt,(1+p)/2))}else k=new n.Vec2(b/e*gt+mt,w/this.segmentsR*pt),L=new n.Vec2((b+1)/e*gt+mt,w/this.segmentsR*pt),A=new n.Vec2((b+1)/e*gt+mt,(w+1)/this.segmentsR*pt),O=new n.Vec2(b/e*gt+mt,(w+1)/this.segmentsR*pt);b!==0&&(M.faces.push(new n.Face3(x,T,C,Z-1)),M.uvs.push([k,L,O])),M.faces.push(new n.Face3(T,N,C,Z-1)),M.uvs.push([L.clone(),A,O.clone()])}for(b=0;b<tt;b++)for(w=0;w<ct;w++){E=this.closed?(b+1)%tt:b+1,S=(w+1)%ht,x=this.grid[b][w],T=this.grid[E][w],N=this.grid[E][S],C=this.grid[b][S];if(w>=this.segmentsR-1){var at=this.segmentsR-1,p=at/this.segmentsR*pt;ct===this.segmentsR?(k=new n.Vec2(F[b]*bt+yt,p),L=new n.Vec2(F[b+1]*bt+yt,p),A=new n.Vec2(F[b+1]*bt+yt,1),O=new n.Vec2(F[b]*bt+yt,1)):w>this.segmentsR-1?(k=new n.Vec2(F[b]*bt+yt,(p+1)/2),L=new n.Vec2(F[b+1]*bt+yt,(p+1)/2),A=new n.Vec2(F[b+1]*bt+yt,1),O=new n.Vec2(F[b]*bt+yt,1)):(k=new n.Vec2(F[b]*bt+yt,p),L=new n.Vec2(F[b+1]*bt+yt,p),A=new n.Vec2(F[b+1]*bt+yt,(p+1)/2),O=new n.Vec2(F[b]*bt+yt,(p+1)/2))}else k=new n.Vec2(F[b]*bt+yt,w/this.segmentsR*pt),L=new n.Vec2(F[b+1]*bt+yt,w/this.segmentsR*pt),A=new n.Vec2(F[b+1]*bt+yt,(w+1)/this.segmentsR*pt),O=new n.Vec2(F[b]*bt+yt,(w+1)/this.segmentsR*pt);M.faces.push(new n.Face3(x,T,C)),M.uvs.push([k,L,O]),M.faces.push(new n.Face3(T,N,C)),M.uvs.push([L.clone(),A,O.clone()])}if(P!=="none"){x=M.vertices.length-1;var B=this.grid.length;if(P==="plain")for(w=0;w<this.segmentsR;w++){S=(w+1)%this.segmentsR,T=this.grid[B-1][w],N=this.grid[B-1][S],M.faces.push(new n.Face3(x,N,T)),d=w/this.segmentsR*2*Math.PI,v=-this.radius*Math.cos(d),m=this.radius*Math.sin(d);var k=new s(.5,.5);d=w/this.segmentsR*2*Math.PI,v=-this.radius*Math.cos(d),m=this.radius*Math.sin(d);var L=new s((v/this.radius+1)/2,(m/this.radius+1)/2);d=S/this.segmentsR*2*Math.PI,v=-this.radius*Math.cos(d),m=this.radius*Math.sin(d);var A=new s((v/this.radius+1)/2,(m/this.radius+1)/2);M.uvs.push([k,A,L])}else for(b=-1;b<e;b++)for(w=0;w<ct;w++){E=b+1,S=(w+1)%ht,b===-1?(x=this.grid[B-1][w],C=this.grid[B-1][S]):(x=this.endGrid[b][w],C=this.endGrid[b][S]),T=this.endGrid[E][w],N=this.endGrid[E][S];if(w>=this.segmentsR-1){var at=this.segmentsR-1,p=at/this.segmentsR*pt;ct===this.segmentsR?(k=new n.Vec2(b/e*Et+wt,p),L=new n.Vec2((b+1)/e*Et+wt,p),A=new n.Vec2((b+1)/e*Et+wt,1),O=new n.Vec2(b/e*Et+wt,1)):w>this.segmentsR-1?(k=new n.Vec2(b/e*Et+wt,(1+p)/2),L=new n.Vec2((b+1)/e*Et+wt,(1+p)/2),A=new n.Vec2((b+1)/e*Et+wt,1),O=new n.Vec2(b/e*Et+wt,1)):(k=new n.Vec2(b/e*Et+wt,p),L=new n.Vec2((b+1)/e*Et+wt,p),A=new n.Vec2((b+1)/e*Et+wt,(1+p)/2),O=new n.Vec2(b/e*Et+wt,(1+p)/2))}else k=new n.Vec2(b/e*Et+wt,w/this.segmentsR*pt),L=new n.Vec2((b+1)/e*Et+wt,w/this.segmentsR*pt),A=new n.Vec2((b+1)/e*Et+wt,(w+1)/this.segmentsR*pt),O=new n.Vec2(b/e*Et+wt,(w+1)/this.segmentsR*pt);M.faces.push(new n.Face3(x,T,C)),M.uvs.push([k,L,O]),M.faces.push(new n.Face3(T,N,C)),M.uvs.push([L.clone(),A,O.clone()])}}return M},frenetFrames:function(e,r,i){function N(e){f[0]=new n.Vec3,l[0]=new n.Vec3,e===t&&(e=new n.Vec3(0,0,1)),f[0].crossVectors(e,a[0]).normalize(),l[0].crossVectors(a[0],f[0]).normalize()}function C(){var t=e.getTangentAt(m);f[0]=(new n.Vec3).subVectors(t,a[0]).normalize(),l[0]=(new n.Vec3).crossVectors(a[0],f[0]),f[0].crossVectors(l[0],a[0]).normalize(),l[0].crossVectors(a[0],f[0]).normalize()}function k(){f[0]=new n.Vec3,l[0]=new n.Vec3,g=Number.MAX_VALUE,y=Math.abs(a[0].x),b=Math.abs(a[0].y),w=Math.abs(a[0].z),y<=g&&(g=y,o.set(1,0,0)),b<=g&&(g=b,o.set(0,1,0)),w<=g&&o.set(0,0,1),c.crossVectors(a[0],o).normalize(),f[0].crossVectors(a[0],c),l[0].crossVectors(a[0],f[0])}var s=new n.Vec3,o=new n.Vec3,u=new n.Vec3,a=[],f=[],l=[],c=new n.Vec3,h=new n.Mat4,p=r.length-1,d=p+1,v,m=1e-4,g,y,b,w,E,S,x,T=[];T.tangents=a,T.normals=f,T.binormals=l;for(E=0;E<d;E++){S=r[E];var x=e.getTangentAt(S);a[E]=new n.Vec3(x.x,x.y,x.z?x.z:0),a[E].normalize()}k();for(E=1;E<d;E++)f[E]=f[E-1].clone(),l[E]=l[E-1].clone(),c.crossVectors(a[E-1],a[E]),c.length()>m&&(c.normalize(),v=Math.acos(n.Math.clamp(a[E-1].dot(a[E]),-1,1)),f[E].applyMatrix4(h.makeRotationAxis(c,v))),l[E].crossVectors(a[E],f[E]);if(i){v=Math.acos(n.Math.clamp(f[0].dot(f[d-1]),-1,1)),v/=d-1,a[0].dot(c.crossVectors(f[0],f[d-1]))>0&&(v=-v);for(E=1;E<d;E++)f[E].applyMatrix4(h.makeRotationAxis(a[E],v*E)),l[E].crossVectors(a[E],f[E])}return T}}),n.PathCube=function(e,t,r,i,s){var o;arguments.length===1&&arguments[0]instanceof Object&&!(arguments[0]instanceof n.Path)?(o=arguments[0],this.path=o.path,this.width=o.width||50,this.height=o.height||100,this.curveSegements=o.curveSegements||32,this.repeat=o.repeat||20,this._id=o.id):(this.path=e,this.width=t||50,this.height=r||100,this.curveSegements=i||32,this.repeat=s||20),this.materialSize=6,n.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},n.PathCube.SideIndexMapping={bottom:0,outside:1,inside:2,top:3,aside:4,zside:5},n.extend(n.PathCube,n.Entity,{__accessor:["path","width","height","curveSegements","repeat"],__SizePropeties:["path","width","height","curveSegements","repeat"],constructor:n.PathCube,className:"TGL.PathCube",getSideIndexMapping:function(){return n.PathCube.SideIndexMapping},computeData:function(){var e={};e.vertices=[],e.faces=[],e.uvs=[],e.uv2s=[];if(this.path==null)return e;var t=this.computePoints(this.path,this.width,this.curveSegements),n=t[0],r=t[1],i=n.length,s,o=t[2],u=this.height,a=this.repeat,f=[],l=[],c=[],h=[],p=this.path.isClockwise();this.innerPoints=this.clonePoints(n),this.outerPoints=this.clonePoints(r);for(s=0;s<i;s++)this.exchangeYZ(n[s]),this.exchangeYZ(r[s]),f[s]=e.vertices.push(n[s])-1,l[s]=e.vertices.push(r[s])-1,c[s]=e.vertices.push(n[s].clone().setY(u))-1,h[s]=e.vertices.push(r[s].clone().setY(u))-1;var d=o?i:i-1;for(s=0;s<d;s++)this.generateTop(e,s,i,c,h,!0,a),this.generateBottom(e,s,i,f,l,a),this.generateSideWall(e,s,i,h,l,!0,a,p),this.generateSideWall(e,s,i,c,f,!1,a,p);return o||(this.generateEnd(e,c,f,l,h,a,!0),this.generateEnd(e,c,f,l,h,a,!1)),this.clockwise=p,e},clonePoints:function(e){var t=[];for(var n=0;n<e.length;n++)t.push(e[n].clone());return t},getInsidePoints:function(){var e=[];return this.clockwise?e=this.innerPoints:e=this.outerPoints,e},generateEnd:function(e,t,r,i,o,u,a){var f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,E,T,N,C,k,L=a?0:r.length-1;f=t[L],l=r[L],c=i[L],h=o[L],T=e.vertices[f],N=e.vertices[l],C=e.vertices[c],k=e.vertices[h],p=T.x,d=T.y,v=T.z,m=N.x,g=N.y,y=N.z,b=C.x,w=C.y,E=C.z,S=k.x,x=k.y,dz=k.z;var A=Math.abs(v-E),O=Math.abs(p-b);a?(e.faces.push(new n.Face3(f,l,h,null,null,4)),A<O?e.uvs.push([new n.Vec2(p/u,d/u),new n.Vec2(m/u,g/u),new n.Vec2(S/u,x/u)]):e.uvs.push([new n.Vec2(v/u,d/u),new n.Vec2(y/u,g/u),new n.Vec2(dz/u,x/u)]),e.uv2s.push([new s(0,1),new s(0,0),new s(1,1)]),e.faces.push(new n.Face3(l,c,h,null,null,4)),A<O?e.uvs.push([new n.Vec2(m/u,g/u),new n.Vec2(b/u,w/u),new n.Vec2(S/u,x/u)]):e.uvs.push([new n.Vec2(y/u,g/u),new n.Vec2(E/u,w/u),new n.Vec2(dz/u,x/u)]),e.uv2s.push([new s(0,0),new s(1,0),new s(1,1)])):(e.faces.push(new n.Face3(l,f,h,null,null,5)),A<O?e.uvs.push([new n.Vec2(m/u,g/u),new n.Vec2(p/u,d/u),new n.Vec2(S/u,x/u)]):e.uvs.push([new n.Vec2(y/u,g/u),new n.Vec2(v/u,d/u),new n.Vec2(dz/u,x/u)]),e.uv2s.push([new s(0,0),new s(0,1),new s(1,1)]),e.faces.push(new n.Face3(c,l,h,null,null,5)),A<O?e.uvs.push([new n.Vec2(b/u,w/u),new n.Vec2(m/u,g/u),new n.Vec2(S/u,x/u)]):e.uvs.push([new n.Vec2(E/u,w/u),new n.Vec2(y/u,g/u),new n.Vec2(dz/u,x/u)]),e.uv2s.push([new s(1,0),new s(0,0),new s(1,1)]))},generateSideWall:function(e,t,r,i,o,u,a,f){var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,S,N,C,k,L,A;N=(t+1)%r,l=i[t],c=o[t],h=o[N],p=i[N],C=e.vertices[l],k=e.vertices[c],L=e.vertices[h],A=e.vertices[p],d=C.x,v=C.y,m=C.z,g=k.x,y=k.y,b=k.z,w=L.x,E=L.y,S=L.z,x=A.x,T=A.y,dz=A.z;var O=Math.abs(m-S),M=Math.abs(d-w),_;u?(_=f?1:2,e.faces.push(new n.Face3(l,c,p,null,null,_)),O<M?e.uvs.push([new n.Vec2(d/a,v/a),new n.Vec2(g/a,y/a),new n.Vec2(x/a,T/a)]):e.uvs.push([new n.Vec2(m/a,v/a),new n.Vec2(b/a,y/a),new n.Vec2(dz/a,T/a)]),e.uv2s.push([new s(0,1),new s(0,0),new s(1,1)]),e.faces.push(new n.Face3(c,h,p,null,null,_)),O<M?e.uvs.push([new n.Vec2(g/a,y/a),new n.Vec2(w/a,E/a),new n.Vec2(x/a,T/a)]):e.uvs.push([new n.Vec2(b/a,y/a),new n.Vec2(S/a,E/a),new n.Vec2(dz/a,T/a)]),e.uv2s.push([new s(0,0),new s(1,0),new s(1,1)])):(_=f?2:1,e.faces.push(new n.Face3(c,l,p,null,null,_)),O<M?e.uvs.push([new n.Vec2(g/a,y/a),new n.Vec2(d/a,v/a),new n.Vec2(x/a,T/a)]):e.uvs.push([new n.Vec2(b/a,y/a),new n.Vec2(m/a,v/a),new n.Vec2(dz/a,T/a)]),e.uv2s.push([new s(0,0),new s(0,1),new s(1,1)]),e.faces.push(new n.Face3(h,c,p,null,null,_)),O<M?e.uvs.push([new n.Vec2(w/a,E/a),new n.Vec2(g/a,y/a),new n.Vec2(x/a,T/a)]):e.uvs.push([new n.Vec2(S/a,E/a),new n.Vec2(b/a,y/a),new n.Vec2(dz/a,T/a)]),e.uv2s.push([new s(1,0),new s(0,0),new s(1,1)]))},generateBottom:function(e,t,n,r,i,s){this.generateTop(e,t,n,r,i,!1,s)},generateTop:function(e,t,r,i,o,u,a){var f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,E,T,N,C,k,L;T=(t+1)%r,f=i[t],l=o[t],c=o[T],h=i[T],N=e.vertices[f],C=e.vertices[l],k=e.vertices[c],L=e.vertices[h],p=N.x,d=N.y,v=N.z,m=C.x,g=C.y,y=C.z,b=k.x,w=k.y,E=k.z,S=L.x,x=L.y,dz=L.z,u?(e.faces.push(new n.Face3(f,l,h,null,null,3)),e.uvs.push([new n.Vec2(p/a,v/a),new n.Vec2(m/a,y/a),new n.Vec2(S/a,dz/a)]),e.uv2s.push([new s(0,1),new s(0,0),new s(1,1)]),e.faces.push(new n.Face3(l,c,h,null,null,3)),e.uvs.push([new n.Vec2(m/a,y/a),new n.Vec2(b/a,E/a),new n.Vec2(S/a,dz/a)]),e.uv2s.push([new s(0,0),new s(1,0),new s(1,1)])):(e.faces.push(new n.Face3(l,f,h,null,null,0)),e.uvs.push([new n.Vec2(m/a,y/a),new n.Vec2(p/a,v/a),new n.Vec2(S/a,dz/a)]),e.uv2s.push([new s(0,0),new s(0,1),new s(1,1)]),e.faces.push(new n.Face3(c,l,h,null,null,0)),e.uvs.push([new n.Vec2(b/a,E/a),new n.Vec2(m/a,y/a),new n.Vec2(S/a,dz/a)]),e.uv2s.push([new s(1,0),new s(0,0),new s(1,1)]))},exchangeYZ:function(e){var t=e.y;e.y=e.z,e.z=-t},addPoints:function(e,t,r,i,s){t.multiplyScalar(.5),r.push((new n.Vec3).subVectors(e,t)),i.push((new n.Vec3).addVectors(e,t))},computeCurvePoint:function(e,t,r,i,s,a,f,l,c){var h=i?0:1,p,d,v=new n.Vec3,m,g,y,b=l;if(e){m=e.getTangentAt(1),g=t.getTangentAt(0),concave=n.Math.isConcave(m,g,!1),g.multiplyScalar(-1),angle=m.angleTo(g),y=Math.sin(angle/2),d=t.getPoint(0),y=y==0?.1:y;var w=concave?r/y:-r/y;y==1?v.crossVectors(g,new o(0,0,1)).normalize().multiplyScalar(w):v.addVectors(m,g).normalize().multiplyScalar(w),this.addPoints(d,v,a,f,c)}else g=t.getTangentAt(h),d=t.getPoint(h),v.crossVectors(g,new n.Vec3(0,0,1)).normalize().multiplyScalar(r),this.addPoints(d,v,a,f,c);if(!(t instanceof n.LineCurve3)&&s){var E=b+1;for(j=0;j<E-2;j++)u=j/(E-1),g=t.getTangentAt(u),d=t.getPointAt(u),v.crossVectors(g,new n.Vec3(0,0,1)).normalize().multiplyScalar(r),j*t.getLength()/b>r/Math.abs(y)&&this.addPoints(d,v,a,f,c)}},computePoints:function(e,t,r){var i,s,o,u,a=new n.Vec3,f,l,c=e.isClockwise(),h,p,d=e.curves[0].getPoint(0),v=e.curves[e.curves.length-1].getPoint(1);p=d.equals(v),l=e.curves.length;var m=[],g=[],y=new n.Path,b=0,w,E=e.getLength();for(i=0;i<l;i++){var S=i-1;p&&S===-1&&(S=l-1);var x=e.curves[S],T=e.curves[i];this.computeCurvePoint(x,T,t,!0,!0,m,g,r,c),i===l-1&&!p&&this.computeCurvePoint(null,T,t,!1,!1,m,g,r,c)}return[m,g,p]}}),n.ShapeNode=function(e,t,r,i,s){if(e==null){e=[],this.materialSize=3,n.Entity.call(this);return}var o;if(!(arguments.length===1&&arguments[0]instanceof Object)||arguments[0]instanceof n.Shape||arguments[0]instanceof n.Path&&!Array.isArray(arguments[0]))this.options={curveSegments:t,amount:r,vertical:i,zMinusHalfAmount:this.zMinusHalfAmount,repeat:s||20};else{o=arguments[0],e=o.path;if(e==null){e=[],this.materialSize=3,n.Entity.call(this);return}t=o.curveSegments,r=o.amount,i=o.vertical,s=o.repeat,this.options={curveSegments:o.curveSegments,amount:o.amount,vertical:o.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:o.repeat||20},this._id=o.id}var u=[];e instanceof n.Path?(u=e.toShapes(),this.path=e):u=e,this.curveSegments=t,this.amount=r,this.vertical=i,this.repeat=s,u=u instanceof Array?u:[u],this.shapes=u,this.shapebb=u[u.length-1].getBoundingBox(),this.materialSize=3,n.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},n.extend(n.ShapeNode,n.Entity,{constructor:n.ShapeNode,className:"TGL.ShapeNode",__accessor:["path","curveSegments","amount","vertical","repeat"],__bool:["vertical"],__SizePropeties:["path","curveSegments","amount","vertical","repeat"],computeData:function(){return this.options={curveSegments:this.curveSegments,amount:this.amount,vertical:this.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:this.repeat||20},this.addShapes(this.path,this.options)},addShapes:function(e,t){var r=[];e instanceof n.Path?r=e.toShapes():r=e;var i={};i.vertices=[],i.uvs=[],i.faces=[];if(!r)return i;var s=r.length;for(var o=0;o<s;o++){var u=r[o];this.addShape(u,t,i)}var a=new n.BoundingBox;a.setFromPoints(i.vertices);var f=(a.max.y-a.min.y)/2;if(t.zMinusHalfAmount)for(var l=0;l<i.vertices.length;l++)i.vertices[l].y-=f;if(t.vertical)for(var l=0;l<i.vertices.length;l++){var c=i.vertices[l].y;i.vertices[l].y=i.vertices[l].z,i.vertices[l].z=-c}return i}}),n.ShapeNode.prototype.addShape=function(e,r,i){function H(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).add(e)}function $(e,t,n){return K(e,t,n)}function J(e,t,r){var i=Math.atan2(t.y-e.y,t.x-e.x),s=Math.atan2(r.y-e.y,r.x-e.x);i>s&&(s+=Math.PI*2);var o=(i+s)/2,u=-Math.cos(o),a=-Math.sin(o),f=new n.Vec2(u,a);return f}function K(e,t,r){var i=n.ShapeNode.__v1,s=n.ShapeNode.__v2,o=n.ShapeNode.__v3,u=n.ShapeNode.__v4,a=n.ShapeNode.__v5,f=n.ShapeNode.__v6,l,c,h,p,d,v;return i.set(e.x-t.x,e.y-t.y),s.set(e.x-r.x,e.y-r.y),l=i.normalize(),c=s.normalize(),o.set(-l.y,l.x),u.set(c.y,-c.x),a.copy(e).add(o),f.copy(e).add(u),a.equals(f)?u.clone():(a.copy(t).add(o),f.copy(r).add(u),h=l.dot(u),p=f.sub(a).dot(u),h===0&&(console.log("Either infinite or no solutions!"),p===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),d=p/h,d<0?J(e,t,r):(v=l.multiplyScalar(d).add(a),v.sub(e).clone()))}function at(){if(l){var e=0,t=R*e;for(G=0;G<z;G++)U=D[G],ht(U[2]+t,U[1]+t,U[0]+t,!0);e=h+f*2,t=R*e;for(G=0;G<z;G++)U=D[G],ht(U[0]+t,U[1]+t,U[2]+t,!1)}else{for(G=0;G<z;G++)U=D[G],ht(U[2],U[1],U[0],!0);for(G=0;G<z;G++)U=D[G],ht(U[0]+R*h,U[1]+R*h,U[2]+R*h,!1)}}function ft(){var e=0;lt(P,e),e+=P.length;for(N=0,C=M.length;N<C;N++)T=M[N],lt(T,e),e+=T.length}function lt(e,t){var n,r;G=e.length;while(--G>=0){n=G,r=G-1,r<0&&(r=e.length-1);var i=0,s=h+f*2;for(i=0;i<s;i++){var o=R*i,u=R*(i+1),a=t+n+o,l=t+r+o,c=t+r+u,p=t+n+u;pt(a,l,c,p,e,i,s,n,r)}}}function ct(e,t,r){i.vertices.push(new n.Vec3(e,t,r-(o?s/2:0)))}function ht(t,s,o,u){t+=L,s+=L,o+=L;if(n.Math.isClockwise([i.vertices[t],i.vertices[s],i.vertices[o]]),"x","z"){i.faces.push(new n.Face3(t,s,o,null,null,m));var a=u?y.generateBottomUV(i,e,r,t,s,o):y.generateTopUV(i,e,r,t,s,o);i.uvs.push(a)}else{i.faces.push(new n.Face3(t,o,s,null,null,m));var a=u?y.generateBottomUV(i,e,r,t,o,s):y.generateTopUV(i,e,r,t,o,s);i.uvs.push(a)}}function pt(t,s,o,u,a,f,l,c,h){t+=L,s+=L,o+=L,u+=L;if(n.Math.isClockwise([i.vertices[t],i.vertices[s],i.vertices[u]]),"x","z"){i.faces.push(new n.Face3(t,s,u,null,null,g)),i.faces.push(new n.Face3(s,o,u,null,null,g));var p=y.generateSideWallUV(i,e,a,r,t,s,o,u,f,l,c,h);i.uvs.push([p[0],p[1],p[3]]),i.uvs.push([p[1],p[2],p[3]])}else{i.faces.push(new n.Face3(t,u,s,null,null,g)),i.faces.push(new n.Face3(s,u,o,null,null,g));var p=y.generateSideWallUV(i,e,a,r,t,s,o,u,f,l,c,h);i.uvs.push([p[0],p[3],p[1]]),i.uvs.push([p[1],p[3],p[2]])}}var s=r.amount!==t?r.amount:100,o=r.zMinusHalfAmount!==t?r.zMinusHalfAmount:!1,u=r.bevelThickness!==t?r.bevelThickness:6,a=r.bevelSize!==t?r.bevelSize:u-2,f=r.bevelSegments!==t?r.bevelSegments:3,l=r.bevelEnabled!==t?r.bevelEnabled:!1,c=r.curveSegments!==t?r.curveSegments:12,h=r.steps!==t?r.steps:1,p=r.extrudePath,d,v=!1,m=r.material||0,g=r.extrudeMaterial||1,y=r.UVGenerator!==t?r.UVGenerator:n.ShapeNode.WorldUVGenerator;y.repeat=r.repeat;var b=this.shapebb,w,E,S,x;p&&(d=p.getSpacedPoints(h),v=!0,l=!1,w=r.frames!==t?r.frames:n.PathNode.prototype.frenetFrames(p,h,!1),E=new n.Vec3,S=new n.Vec3,x=new n.Vec3),l||(f=0,u=0,a=0);var T,N,C,k=[],L=i.vertices.length,A=e.extractPoints(c),O=A.shape,M=A.holes,_=!n.Shape.Utils.isClockWise(O);if(_){O=O.reverse();for(N=0,C=M.length;N<C;N++)T=M[N],n.Shape.Utils.isClockWise(T)&&(M[N]=T.reverse());_=!1}var D=n.Shape.Utils.triangulateShape(O,M),P=O;for(N=0,C=M.length;N<C;N++)T=M[N],O=O.concat(T);var B,j,F,I,q,R=O.length,U,z=D.length,W,X=P.length,V=180/Math.PI,Q=[];for(var G=0,Y=P.length,Z=Y-1,et=G+1;G<Y;G++,Z++,et++){Z===Y&&(Z=0),et===Y&&(et=0);var tt=P[G],nt=P[Z],rt=P[et];Q[G]=$(P[G],P[Z],P[et])}var it=[],st,ot=Q.concat();for(N=0,C=M.length;N<C;N++){T=M[N],st=[];for(G=0,Y=T.length,Z=Y-1,et=G+1;G<Y;G++,Z++,et++)Z===Y&&(Z=0),et===Y&&(et=0),st[G]=$(T[G],T[Z],T[et]);it.push(st),ot=ot.concat(st)}for(B=0;B<f;B++){F=B/f,I=u*(1-F),j=a*Math.sin(F*Math.PI/2);for(G=0,Y=P.length;G<Y;G++)q=H(P[G],Q[G],j),ct(q.x,q.y,-I);for(N=0,C=M.length;N<C;N++){T=M[N],st=it[N];for(G=0,Y=T.length;G<Y;G++)q=H(T[G],st[G],j),ct(q.x,q.y,-I)}}j=a;for(G=0;G<R;G++)q=l?H(O[G],ot[G],j):O[G],v?(S.copy(w.normals[0]).multiplyScalar(q.x),E.copy(w.binormals[0]).multiplyScalar(q.y),x.copy(d[0]).add(S).add(E),ct(x.x,x.y,x.z)):ct(q.x,q.y,0);var ut;for(ut=1;ut<=h;ut++)for(G=0;G<R;G++)q=l?H(O[G],ot[G],j):O[G],v?(S.copy(w.normals[ut]).multiplyScalar(q.x),E.copy(w.binormals[ut]).multiplyScalar(q.y),x.copy(d[ut]).add(S).add(E),ct(x.x,x.y,x.z)):ct(q.x,q.y,s/h*ut);for(B=f-1;B>=0;B--){F=B/f,I=u*(1-F),j=a*Math.sin(F*Math.PI/2);for(G=0,Y=P.length;G<Y;G++)q=H(P[G],Q[G],j),ct(q.x,q.y,s+I);for(N=0,C=M.length;N<C;N++){T=M[N],st=it[N];for(G=0,Y=T.length;G<Y;G++)q=H(T[G],st[G],j),v?ct(q.x,q.y+d[h-1].y,d[h-1].x+I):ct(q.x,q.y,s+I)}}at(),ft()},n.ShapeNode.WorldUVGenerator={generateTopUV:function(e,t,r,i,s,o){var u=e.vertices[i].x,a=e.vertices[i].y,f=e.vertices[s].x,l=e.vertices[s].y,c=e.vertices[o].x,h=e.vertices[o].y;return[new n.Vec2(u/this.repeat,a/this.repeat),new n.Vec2(f/this.repeat,l/this.repeat),new n.Vec2(c/this.repeat,h/this.repeat)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},uv:function(e,t,n){return new s(Math.sqrt(e*e+t*t)/this.repeat,(1-n)/this.repeat)},generateSideWallUV:function(e,t,r,i,s,o,u,a,f,l,c,h){var p=e.vertices[s].x,d=e.vertices[s].y,v=e.vertices[s].z,m=e.vertices[o].x,g=e.vertices[o].y,y=e.vertices[o].z,b=e.vertices[u].x,w=e.vertices[u].y,E=e.vertices[u].z,S=e.vertices[a].x,x=e.vertices[a].y,T=e.vertices[a].z,N=Math.abs(d-g),C=Math.abs(p-m);return N<C?[new n.Vec2(p/this.repeat,(1-v)/this.repeat),new n.Vec2(m/this.repeat,(1-y)/this.repeat),new n.Vec2(b/this.repeat,(1-E)/this.repeat),new n.Vec2(S/this.repeat,(1-T)/this.repeat)]:[new n.Vec2(d/this.repeat,(1-v)/this.repeat),new n.Vec2(g/this.repeat,(1-y)/this.repeat),new n.Vec2(w/this.repeat,(1-E)/this.repeat),new n.Vec2(x/this.repeat,(1-T)/this.repeat)]}},n.ShapeNode.__v1=new n.Vec2,n.ShapeNode.__v2=new n.Vec2,n.ShapeNode.__v3=new n.Vec2,n.ShapeNode.__v4=new n.Vec2,n.ShapeNode.__v5=new n.Vec2,n.ShapeNode.__v6=new n.Vec2,n.TextNode=function(e,r,i,s,o,u,a){var f;arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(f=arguments[0],e=f.text,this.font=f.font||"helvetiker",this.size=f.size||150,this.weight=f.weight||"normal",this.fontStyle=f.fontStyle||"normal",this.height=f.height||50,this._id=f.id,this.curveSegments=f.curveSegments):(this.font=s||"helvetiker",this.size=r||150,this.weight=o||"normal",this.fontStyle=u||"normal",this.height=i||50,this.curveSegments=a);var l={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0};this.text=e;var c=n.FontUtils.generateShapes(e,l);l.amount=l.height!==t?l.height:50,l.bevelThickness===t&&(l.bevelThickness=10),l.bevelSize===t&&(l.bevelSize=8),l.bevelEnabled===t&&(l.bevelEnabled=!1),n.ShapeNode.call(this,c,l.curveSegments,this.height,!1,50,!0)},n.extend(n.TextNode,n.ShapeNode,{constructor:n.TextNode,className:"TGL.TextNode",__accessor:["text","size","height","font","weight","fontStyle"],__SizePropeties:["text","size","height","font","weight","fontStyle"],computeData:function(){var e={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0},t={curveSegments:this.curveSegments,amount:this.height,vertical:!1,zMinusHalfAmount:!0,repeat:20},r=n.FontUtils.generateShapes(this.text,e);return n.ShapeNode.prototype.addShapes.call(this,r,t)}}),n.LatheNode=function(e,r,i,s,o,u){this.materialSize=3;var a;arguments.length===1&&arguments[0]instanceof Object&&!(arguments[0]instanceof n.Path)?(a=arguments[0],this.path=a.path,this.segmentsH=a.segmentsH||64,this.segmentsR=a.segmentsR||20,this.arc=a.arc!=t?a.arc:Math.PI*2,this.startClosed=a.startClosed,this.endClosed=a.endClosed,this._id=a.id):(this.path=e,this.segmentsH=r||64,this.segmentsR=i||20,this.arc=s!=t?s:Math.PI*2,this.startClosed=o,this.endClosed=u),n.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},n.extend(n.LatheNode,n.Entity,{constructor:n.LatheNode,className:"TGL.LatheNode",__accessor:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],__SizePropeties:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],computeData:function(){function v(e){var t=e.x,r=e.z,i=((r===0?t/Math.abs(t):t/Math.abs(r))+1)/2;i=n.Math.clamp(i,0,1);var s=((t===0?r/Math.abs(r):r/Math.abs(t))+1)/2;return s=n.Math.clamp(s,0,1),new n.Vec2(i,s)}var e={},e={};e.faces=[],e.uvs=[],e.vertices=[];if(this.path==null)return e;var t=[],r=this.path,i=this.segmentsH,s=this.segmentsR,o,u,f,l,h,p,d;n.Shape.Utils.isClockWise(r.getPoints())||(r=r.reverse());for(u=0;u<=i;u++){o=r.getPoint(u/i),t[u]=[],l=Math.abs(o.x),h=o.y,this.startClosed&&u===0&&e.vertices.push(new n.Vec3(0,h,0));for(f=0;f<s;f++)d=f/s*this.arc,p=new n.Vec3(l*Math.cos(d),h,l*Math.sin(d)),t[u][f]=e.vertices.push(p)-1;this.endClosed&&u===i&&e.vertices.push(new n.Vec3(0,h,0))}var m=this.arc==Math.PI*2;if(this.startClosed){a=0;for(f=0;f<(m?s:s-1);f++)jp=(f+1)%s,b=t[0][f],c=t[0][jp],uva=new n.Vec2(.5,.5),uvb=v(e.vertices[b]),uvc=v(e.vertices[c]),e.faces.push(new n.Face3(a,b,c)),e.uvs.push([uva,uvb,uvc])}for(u=0;u<i;u++)for(f=0;f<(m?s:s-1);f++)ip=u+1,jp=(f+1)%s,a=t[u][f],b=t[ip][f],c=t[ip][jp],Hr=t[u][jp],uva=new n.Vec2(u/i,f/s),uvb=new n.Vec2((u+1)/i,f/s),uvc=new n.Vec2((u+1)/i,(f+1)/s),uvd=new n.Vec2(u/i,(f+1)/s),e.faces.push(new n.Face3(a,b,Hr)),e.uvs.push([uva,uvb,uvd]),e.faces.push(new n.Face3(b,c,Hr)),e.uvs.push([uvb.clone(),uvc,uvd.clone()]);if(this.endClosed){a=e.vertices.length-1;for(f=0;f<(m?s:s-1);f++)jp=(f+1)%s,b=t[t.length-1][f],c=t[t.length-1][jp],uva=new n.Vec2(0,0),uvb=new n.Vec2(1,f/s),uvc=new n.Vec2(1,(f+1)/s),e.faces.push(new n.Face3(a,b,c)),e.uvs.push([uva,uvb,uvc])}return e}}),n.CurvePlane=function(e,t,r,i){this.pathH=e,this.pathV=t,this.segmentsH=r||20,this.segmentsV=i||20,n.Entity.call(this)},n.extend(n.CurvePlane,n.Entity,{constructor:n.CurvePlane,className:"TGL.CurvePlane",computeData:function(){var e={};e.faces=[],e.uvs=[],e.vertices=[];if(this.pathV==null||this.pathH==null)return e;var t=this.pathV,n=this.pathH,r=this.segmentsV,i=this.segmentsH,u,a,f=r+1,l=i+1,c,h,p,d,v,m,g,y;this.grid=[];for(u=0;u<l;u++){this.grid[u]=[];var b=n.getPointAt(u/l);for(a=0;a<f;a++){var w=t.getPointAt(a/f);this.grid[u][a]=e.vertices.push(new o(b.x,w.y,b.z+w.z))-1}}for(u=0;u<i;u++)for(a=0;a<r;a++)c=this.grid[u][a],h=this.grid[u][a+1],p=this.grid[u+1][a+1],d=this.grid[u+1][a],v=new s(u/l,a/f),m=new s(u/l,(a+1)/f),uvc=new s((u+1)/l,(a+1)/f),y=new s((u+1)/l,a/f),e.faces.push(new C(c,p,h)),e.uvs.push([v,uvc,m]),e.faces.push(new C(c,d,p)),e.uvs.push([v.clone(),y.clone(),uvc]);return e}}),n.ComboNode=function(e,t,r,i){if(arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var s=e;this.combos=s.combos||[],this.operators=s.operators,this.centralized=r,this._id=s.id}else this.combos=e||[],this.operators=t,this.centralized=r,this._id=i;this.csgs=[],n.Entity.call(this)},n.extend(n.ComboNode,n.Entity,{constructor:n.ComboNode,className:"TGL.ComboNode",__accessor:["combos","operators","centralized"],__SizePropeties:["combos","operators","centralized"],getOffsetPosition:function(){return this._offsetPosition},computeData:function(){this.csgs=[];var e={vertices:[],faces:[],uvs:[],uv2s:[]};if(!this.combos)return e;if(this.operators==null||this.operators.length==0){var r=O.mergeElements(this.combos);this.materialSize=r.material.materials.length,this.material=r.material,this.orgMaterial=r.material,e={vertices:r.vertices,faces:r.faces,uvs:r.uvs,uv2s:r.uv2s||[]};if(this.centralized&&e.vertices){var i=new n.BoundingBox;i.setFromPoints(e.vertices);var s=i.center();for(u=0;u<e.vertices.length;u++){var o=e.vertices[u];o.sub(s)}this._offsetPosition=s}return e}this.operators=this.operators||[];var u,a,f=this.combos.length,l,c;for(u=0;u<f;u++)this.csgs.push(new n.CSG(this.combos[u]));for(u=0;u<f;u++)a==null?a=this.csgs[u]:(l=this.operators[u-1],l==="+"||l==t?a=a.union(this.csgs[u]):l==="-"?a=a.substract(this.csgs[u]):l==="^"&&(a=a.intersect(this.csgs[u])));if(!a)return e;c=a.toMesh();if(this.changeProperty!="centralized"||this.material==null)this.materialSize=c.material.materials.length,this.material=c.material,this.orgMaterial=c.material;e={vertices:c.vertices,faces:c.faces,uvs:c.uvs,uv2s:c.uv2s};if(this.centralized&&e.vertices){var i=new n.BoundingBox;i.setFromPoints(e.vertices);var s=i.center();for(u=0;u<e.vertices.length;u++){var o=e.vertices[u];o.sub(s)}this._offsetPosition=s}return c=t,e},computeNodeMaterial:function(e){this.material=e.material,this.materialSize=e.materialSize},cacheNodeMaterial:function(e){e.material=this.material,e.materialSize=this.materialSize},needComputeVertexNormal:function(){return!0},generatePrimitiveKey:function(){return null},changeMapping:function(e){var t=this.getMaterialMapping();n.Utils.isSame(e,t)||(this.batch?this.materialMappingChanges=[e,t]:(this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,t)))},isStyleEquals:function(e,t,n){return!1},getSelectStyle:function(){var e=this.getStyle("select.style");if(e=="outline.normal"||e=="outline")e="outline.wireframe";return e},onMaterialMapping:function(){this.groups=t,this.primitive.groups=t}}),n.Terrain=function(e){e=e||{},this._id=e.id,this.width=e.width,this.depth=e.depth,this.segmentsW=e.segmentsW||30,this.segmentsD=e.segmentsD||30,this.heightMap=e.heightMap,this.heightUnit=e.heightUnit||1,this.maxHeight=e.maxHeight||255,this.minHeight=e.minHeight||0,this.baseLayerHeight=e.baseLayerHeight||0,typeof this.heightMap=="string"?(this.image=new Image,this.image.src=this.heightMap):$html.isCanvas(this.heightMap)?this.canvas=this.heightMap:$html.isImage(this.heightMap)&&(this.image=this.heightMap);if(this.image){var t=this;this.image.onload=function(e){var n=document.createElement("canvas");n.width=t.image.width,n.height=t.image.height;var r=n.getContext("2d");r.drawImage(t.image,0,0),t.canvas=n,t.computed=!1,t.computeNodeData(),t.firePropertyChange("width",0,1)}}this.materialSize=2,n.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},n.extend(n.Terrain,n.Entity,{constructor:n.Terrain,className:"TGL.Terrain",__accessor:["width","heightUnit","depth"," segmentsW","segmentsD"," heightMap","heightUnit","maxHeight"," minHeight","baseLayerHeight","smooth"],__SizePropeties:["width","heightUnit","depth"," segmentsW","segmentsD"," heightMap","heightUnit","maxHeight"," minHeight","baseLayerHeight","smooth"],__bool:["smooth"],computeLayerData:function(e,t,r){var i,s,o=this.width/2,u=this.depth/2,a=r?this.segmentsW:1,f=r?this.segmentsD:1,l=a+1,c=f+1,h=this.width/a,p=this.depth/f,d=new n.Vec3(0,0,1),v=e.vertices.length;for(s=0;s<c;s++)for(i=0;i<l;i++){var m=i*h-o,g=s*p-u,y=0;r?y=r.call(this,i/l,s/c):y=this.baseLayerHeight*this.heightUnit,e.vertices.push(new n.Vec3(m,y,g))}for(s=0;s<f;s++)for(i=0;i<a;i++){var b=i+l*s+v,w=i+l*(s+1)+v,E=i+1+l*(s+1)+v,S=i+1+l*s+v,x=new n.Vec2(i/a,1-s/f),T=new n.Vec2(i/a,1-(s+1)/f),N=new n.Vec2((i+1)/a,1-(s+1)/f),C=new n.Vec2((i+1)/a,1-s/f);if(r){var k=new n.Face3(b,w,S);k.materialIndex=t,e.faces.push(k),e.uvs.push([x,T,C]),k=new n.Face3(w,E,S),k.materialIndex=t,e.faces.push(k),e.uvs.push([T.clone(),N,C.clone()])}else{var k=new n.Face4(b,w,E,S);k.normal.copy(d),k.vertexNormals.push(d.clone(),d.clone(),d.clone(),d.clone()),k.materialIndex=t,e.faces.push(k),e.uvs.push([x,T,N,C])}}},computeData:function(){var e={};return e.vertices=[],e.faces=[],e.uvs=[],this.computeLayerData(e,0),this.computeLayerData(e,1,this.getHeight),e},getFaceNormal:function(e,t){this.computeFaceNormals();var n=this.segmentsW*e,r=this.segmentsD*t,i=Math.floor(n),s=Math.floor(r),o=s*this.segmentsW+i;o=o*2+1,i!=Math.round(n)&&s!=Math.round(r)&&o++;var u=this.faces[o],a=this.vertices[u.a],f=this.vertices[u.b],l=this.vertices[u.c];return u.normal.clone()},getHeight:function(e,t){if(this.canvas==null)return 0;var r=this.canvas;if(this.heightData==null){var i=r.width*r.height,s=new Float32Array(i);for(var o=0;o<i;o++)s[o]=0;var u=r.getContext("2d"),a=u.getImageData(0,0,r.width,r.height),f=a.data,l=0;for(var o=0,c=f.length;o<c;o+=4){var h=f[o]+f[o+1]+f[o+2];s[l++]=h/3}this.heightData=s}var p=e*r.width,d=t*r.height,v=Math.floor(p),m=Math.floor(d),g=[],y=[];g.push(v),p!=v&&g.push(v+1),y.push(m),d!=m&&y.push(m+1);var b=g.length*y.length,o,l,w=0,E;for(o=0;o<g.length;o++)for(l=0;l<y.length;l++)E=y[l]*r.width+g[o],w+=this.heightData[E];return w/=b,w=n.Math.clamp(w,this.minHeight,this.maxHeight),w*=this.heightUnit,w},getSideIndexMapping:function(){return n.Terrain.SideIndexMapping},refreshUniforms:function(e){e.heightUnit&&(e.heightUnit.value=this.heightUnit)}}),n.Terrain.SideIndexMapping={layer0:0,layer1:1},n.Link=function(e,t,r){if(arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var i=arguments[0];e=i.fromNode,t=i.toNode,this._id=i.id}else this._id=r;n.Line.call(this),this.setFromNode(e),this.setToNode(t),this._editable=!1},n.extend(n.Link,n.Line,{className:"TGL.Link",___accessor:["linkType","extend","controls"],__SizePropeties:["fromNode","toNode","linkType","extend","controls"],setFromNode:function(e){if(this._fromNode!=e){var t=this._fromNode;this._fromNode=e,this.onPropertyChange(),this.firePropertyChange("fromNode",t,e),t,this._fromNode=e,t&&(t._removeFromLink(this),t.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(e){if(this._toNode!=e){var t=this._toNode;this._toNode=e,this.onPropertyChange(),this.firePropertyChange("toNode",t,e),t&&(t.removePropertyChangeListener(this.handleNodePropertyChange),t._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&this._fromNode!=null&&this._toNode!=null},handleNodePropertyChange:function(e){if(e.property.startsWith("position")||e.property=="worldMatrix"){var t=this.vertices;this.onPropertyChange(),this.firePropertyChange("vertices",t,this.vertices)}},computeNodeData:function(){this.computeData()},updateMatrix:function(){},updateWorldMatrix:function(){},computeData:function(){if(this._fromNode==null||this._toNode==null)return;this._extend==null&&(this._extend=0);var e=this._fromNode.worldMatrix.getPosition(),t=this._toNode.worldMatrix.getPosition(),n=[];n.push(e.clone());if(this._linkType=="orthogonal.x"){var r=Math.max(e.x,t.x),i=new o(r+this._extend,e.y,e.z);n.push(i),i=new o(r+this._extend,t.y,t.z),n.push(i)}else if(this._linkType=="orthogonal.x.n"){var s=Math.min(e.x,t.x),i=new o(s-this._extend,e.y,e.z);n.push(i),i=new o(s-this._extend,t.y,t.z),n.push(i)}else if(this._linkType=="orthogonal.y"){var u=Math.max(e.y,t.y),i=new o(e.x,u+this._extend,e.z);n.push(i),i=new o(t.x,u+this._extend,t.z),n.push(i)}else if(this._linkType=="orthogonal.y.n"){var a=Math.min(e.y,t.y),i=new o(e.x,a-this._extend,e.z);n.push(i),i=new o(t.x,a-this._extend,t.z),n.push(i)}else if(this._linkType=="orthogonal.z"){var f=Math.max(e.z,t.z),i=new o(e.x,e.y,f+this._extend);n.push(i),i=new o(t.x,t.y,f+this._extend),n.push(i)}else if(this._linkType=="orthogonal.z.n"){var l=Math.min(e.z,t.z),i=new o(e.x
,e.y,l-this._extend);n.push(i),i=new o(t.x,t.y,l-this._extend),n.push(i)}else if(this._linkType=="control"){var c=this._controls;if(c&&c.length>0)for(var h=0;h<c.length;h++)c[h]instanceof o&&n.push(c[h].clone())}n.push(t.clone()),this.vertices=n},onPropertyChange:function(){this.vertices=this.vertices||[],this.computeData(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null}}),n.PathLink=function(e,t,r){if(arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var i=arguments[0];e=i.fromNode,t=i.toNode,this._id=i.id}else this._id=r;n.PathNode.call(this),this._autoAjust=!0,this.setFromNode(e),this.setToNode(t)},n.extend(n.PathLink,n.PathNode,{className:"TGL.PathLink",___accessor:["linkType","extend","controls"],__SizePropeties:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","fromNode","toNode","linkType","extend","controls"],setFromNode:function(e){if(this._fromNode!=e){var t=this._fromNode;this._fromNode=e,this._dirtyPath=!0,this.onPropertyChange("fromNode",t,e),this.firePropertyChange("fromNode",t,e),t,this._fromNode=e,t&&(t._removeFromLink(this),t.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(e){if(this._toNode!=e){var t=this._toNode;this._toNode=e,this.onPropertyChange("toNode",t,e),this.firePropertyChange("toNode",t,e),t&&(t.removePropertyChangeListener(this.handleNodePropertyChange),t._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&this._fromNode!=null&&this._toNode!=null},handleNodePropertyChange:function(e){var t=e.source,n=e.property;if(n.startsWith("position")||n.startsWith("rotation")||n.startsWith("scale")||n=="worldMatrix"||n==="linkAgent"||t.isSizeChangedProperty(n)||n==="parent"){var r=this.vertices;this._dirtyPath=!0;var i=this;A.PATH_LINK_COMPUTE_DELAY?setTimeout(function(){i._computePath()},20):i._computePath()}},_resetPath:function(){if(!this.path)return;var e=!1;if(this.endCap!=="arrow")return this.path;if(this.endCapExtend*this.endCapR>1)return this.path;e=!0;var t=this.path,r=new n.Path,i,s,u=t.actions.length,a=null;for(s=0;s<u-1;s++)i=t.actions[s],args=i.args,a=new n.Vec3(args[0],args[1],args[2]),i.action==="moveTo"?r.moveTo(args[0],args[1],args[2]):i.action==="lineTo"?r.lineTo(args[0],args[1],args[2]):i.action==="quadraticCurveTo"&&(r.curveTo(args[0],args[1],args[2],args[3],args[4],args[5]),a=new n.Vec3(args[3],args[4],args[5]));s=u-1,i=t.actions[s],args=i.args;if(i.action==="lineTo"){var f=new n.Vec3(args[0],args[1],args[2]),l=(new o).subVectors(f,a).normalize(),u=this.radius*this.endCapSize,c=null;(new o).subVectors(f,a).length()<u?c=a.add(l.multiplyScalar(.1)):c=f.clone().sub(l.multiplyScalar(u)),r.lineTo(c.x,c.y,c.z)}return r},_getNodeOffset:function(e,t,n){t=e.worldToLocal(t.clone()),n=e.worldToLocal(n.clone());var r=(new o).subVectors(n,t),i=r.length(),s=e.getLinkOffset(r);return s&&s.length()>i&&s.normalize().multiplyScalar(i-.1),s||new o(0,0,0)},updateMatrix:function(){},updateWorldMatrix:function(e,t){},onPropertyChange:function(e,t,r){if(e==="fromNode"||e==="toNode"||e==="linkType"||e==="extend"||e==="controls")this._dirtyPath=!0;n.Node.prototype.onPropertyChange.call(this,e,t,r)},computeData:function(){return this._computePath(),n.PathNode.prototype.computeData.call(this)},_clearFromNodeExtend:function(e,t,n){},_orthogonal:function(){},_flex:function(e,t,n,r,i){e=e.substr(e.indexOf(".")+1);var s=["x","y","z"],u,a=new o,f=new o;for(var l=0;l<3;l++)u=s[l],a[u]=u===e?r[u]:t[u],f[u]=u===e?r[u]:n[u];i.push(a,f)},_flex2:function(e,t,n,r){e=e.substr(e.indexOf(".")+1);var i=["x","y","z"],s=e[0],o=e[1];if(t[s]!=n[s]){var u=new mono.Vec3;for(var a=0;a<i.length;a++)u[i[a]]=i[a]==s?n[i[a]]:t[i[a]];r.push(u)}if(t[o]!=n[o]){var f=new mono.Vec3;for(var a=0;a<i.length;a++)f[i[a]]=i[a]==s||i[a]==o?n[i[a]]:t[i[a]];r.push(f)}},_orthogonal:function(e,t,n,r){e=e.substr(e.indexOf(".")+1);var i=!1,s=["x","y","z"],u,a=new o,f=0;e.endsWith(".n")&&(i=!0,e=e[0]);var l=i?t[e]:n[e];for(var c=0;c<s.length;c++)u=s[c],u!==e&&t[u]==n[u]&&f++;if(f===2)return;for(var c=0;c<s.length;c++)u=s[c],u!==e?a[u]=l:a[u]=i?n[u]:t[u];r.push(a)},_removeSamePoint:function(e){},_computePath:function(){if(!this._dirtyPath)return;this._dirtyPath=!1;if(this._fromNode==null||this._toNode==null)return;this._extend==null&&(this._extend=0);var e=this._fromNode.getLinkAgent()||this._fromNode,t=this._toNode.getLinkAgent()||this._toNode,r=e.localToWorld2(new o(0,0,0)),i=t.localToWorld2(new o(0,0,0));if(e==t){var s=new mono.Path;return s.moveTo(r.x,r.y,r.z),s.lineTo(r.x,r.y+200,r.z),s.lineTo(r.x+200,r.y+200,r.z),s.lineTo(r.x+200,r.y,r.z),s.lineTo(r.x,r.y,r.z),this.setPath(s),s}if(r.equals(i))return;var s,u=[],a=this.radius*this.endCapSize,f;if(this._linkType&&this._linkType.startsWith("extend")){var r,i,l,c=[],h,p,d,v;if(this._linkType==="extend.x"){l=new o(1,0,0);var r=e.localToWorld2(e.getLinkExtend(l.clone())),i=t.localToWorld2(t.getLinkExtend(l));v=Math.max(r.x,i.x),d=v+this._extend+a+.1,h=new o(d,r.y,r.z),p=new o(d,i.y,i.z)}else if(this._linkType==="extend.y"){l=new o(0,1,0);var r=e.localToWorld2(e.getLinkExtend(l.clone())),i=t.localToWorld2(t.getLinkExtend(l));v=Math.max(r.y,i.y),d=v+this._extend+a+.1,h=new o(r.x,d,r.z),p=new o(i.x,d,i.z)}else if(this._linkType==="extend.z"){l=new o(0,0,1);var r=e.localToWorld2(e.getLinkExtend(l.clone())),i=t.localToWorld2(t.getLinkExtend(l));v=Math.max(r.z,i.z),d=v+this._extend+a+.1,h=new o(r.x,r.y,d),p=new o(i.x,i.y,d)}else if(this._linkType==="extend.x.n"){l=new o(-1,0,0);var r=e.localToWorld2(e.getLinkExtend(l.clone())),i=t.localToWorld2(t.getLinkExtend(l));v=Math.min(r.x,i.x),d=v-this._extend-a-.1,h=new o(d,r.y,r.z),p=new o(d,i.y,i.z)}else if(this._linkType==="extend.y.n"){l=new o(0,-1,0);var r=e.localToWorld2(e.getLinkExtend(l.clone())),i=t.localToWorld2(t.getLinkExtend(l));v=Math.min(r.y,i.y),d=v-this._extend-a-.1,h=new o(r.x,d,r.z),p=new o(i.x,d,i.z)}else if(this._linkType==="extend.z.n"){l=new o(0,0,-1);var r=e.localToWorld2(e.getLinkExtend(l.clone())),i=t.localToWorld2(t.getLinkExtend(l));v=Math.min(r.z,i.z),d=v-this._extend-a-.1,h=new o(r.x,r.y,d),p=new o(i.x,i.y,d)}h?u.push(r,h,p,i):u.push(r,i)}else{u.push(r);if(this._linkType==="orthogonal.x"){if(r.y!=i.y||r.z!=i.z){var m=i.x,g=new o(m,r.y,r.z);u.push(g)}}else if(this._linkType==="orthogonal.x.n"){var m=r.x,g=new o(m,i.y,i.z);u.push(g)}else if(this._linkType==="orthogonal.y"){var y=i.y,g=new o(r.x,y,r.z);u.push(g)}else if(this._linkType==="orthogonal.y.n"){var y=r.y,g=new o(i.x,y,i.z);u.push(g)}else if(this._linkType==="orthogonal.z"){var g=new o(r.x,r.y,i.z);u.push(g)}else if(this._linkType==="orthogonal.z.n"){var g=new o(i.x,i.y,r.z);u.push(g)}var b=(new o(r.x+i.x,r.y+i.y,r.z+i.z)).multiplyScalar(.5);(this._linkType==="flex.x"||this._linkType==="flex.y"||this._linkType==="flex.z")&&this._flex(this._linkType,r,i,b,u),(this._linkType==="flex.yz"||this._linkType==="flex.zy"||this._linkType==="flex.xy"||this._linkType==="flex.yx"||this._linkType==="flex.xz"||this._linkType==="flex.zx")&&this._flex2(this._linkType,r,i,u);if(this._linkType==="control"){var w=this.getControls();O.isArray(w)&&(u=u.concat(w))}u.push(i),f=u.length;var E=this._getNodeOffset(e,u[0].clone(),u[1].clone()),S=this._getNodeOffset(t,u[f-1].clone(),u[f-2].clone());r=e.localToWorld2(E),i=t.localToWorld2(S),u[0]=r,u[f-1]=i}var f=u.length,s=new n.Path,x;for(var T=0;T<f;T++)x=u[T],T===0?s.moveTo(x.x,x.y,x.z):s.lineTo(x.x,x.y,x.z);return this.setPath(s),s}}),n.DataBox=function(e){n.DataBox.superClass.constructor.apply(this,arguments),arguments.length===1&&(this._name=e),this._dataList=new S,this._dataMap={},this._rootList=new S,this._rootMap={},this._clientMap={},this._lightList=new S,this._billboardList=new S,this._nodeList=new S,this._annotationList=new S,this._particleList=new S,this.nodes=[],this.particles=[],this.billboards=[],this._dataBoxChangeDispatcher=new n.EventDispatcher,this._dataPropertyChangeDispatcher=new n.EventDispatcher,this._groupLists={},this.selection=new S,this instanceof n.AlarmBox||(this._selectionModel=new n.SelectionModel(this),this._alarmBox=new n.AlarmBox(this),this._alarmStatePropagator=new n.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0)),this.batch=!1,this._clientMap={}},n.extend(n.DataBox,n.PropertyChangeDispatcher,{constructor:n.DataBox,className:"TGL.DataBox",___accessor:["name"],add:function(e,t){if(!e)return;arguments.length===1&&(t=-1);var r=e.getId();if(this._dataMap.hasOwnProperty(r))throw"Data with ID '"+r+"' already exists";this._dataMap[r]=e,this._dataList.add(e),e.getParent()||(this._rootMap[r]=e,t>=0?this._rootList.add(e,t):this._rootList.add(e)),e instanceof n.Billboard?this._billboardList.add(e):e instanceof n.Node?this._nodeList.add(e):e instanceof n.Particle?this._particleList.add(e):e instanceof n.Annotation?this._annotationList.add(e):e instanceof n.Light&&this._lightList.add(e),this._dataBoxChangeDispatcher.fire({kind:"add",data:e,source:this}),e.getGroupId()&&this.groupElements(e,null,e.getGroupId()),e.addPropertyChangeListener(this.handleDataPropertyChange,this)},addByDescendant:function(e){this.add(e),e.getChildren().size()>0&&e.getChildren().forEach(function(e){this.addByDescendant(e)},this)},getAlarmBox:function(){return this._alarmBox},removeById:function(e,t){var n=this.getDataById(e);this.remove(n,t)},remove:function(e,t){if(!e)return;e instanceof n.Link&&(e.setFromNode(null),e.setToNode(null)),e instanceof n.Node&&e.getLinks()&&e.getLinks().toList().forEach(function(e){this.remove(e)},this),t&&(e.getChildren().forEach(function(t){e.removeChild(t)},this),e.getParent()&&e.getParent().removeChild(e)),this._dataList.remove(e);var r=e._id;delete this._dataMap[r],this._rootMap[r]&&(delete this._rootMap[r],this._rootList.remove(e)),e instanceof n.Billboard?this._billboardList.remove(e):e instanceof n.Node?this._nodeList.remove(e):e instanceof n.Particle?this._particleList.remove(e):e instanceof n.Annotation?this._annotationList.remove(e):e instanceof n.Light&&this._lightList.remove(e),e.getGroupId()&&this.groupElements(e,e.getGroupId(),null),e.removePropertyChangeListener(this.handleDataPropertyChange,this),this._dataBoxChangeDispatcher.fire({kind:"remove",data:e,source:this})},removeByDescendant:function(e,t){if(!e)return;var n=this;e.hasChildren()&&e.getChildren().forEachReverse(function(e){n.removeByDescendant(e,t)}),this.remove(e,t)},containsById:function(e){return this._dataMap.hasOwnProperty(e)},contains:function(e){return e?this._dataMap[e._id]===e:!1},size:function(){return this._dataList.size()},lightsSize:function(){return this._lightList.size()},getLights:function(){return this._lightList},getLightsArray:function(){return this._lightList.toArray()},getAnnotations:function(){return this._annotationList},clear:function(e){if(this._dataList.size()>0){var t=this._dataList.toList(function(t){return!this._lightList.contains(t)||e},this);t.forEach(function(e){e.removePropertyChangeListener(this.handleDataPropertyChange,this)},this),this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._nodeList.clear(),this._billboardList.clear();if(e)this._lightList.clear();else{var n=this;this._lightList.forEach(function(e){n._dataList.add(e);var t=e.getId();n._dataMap[t]=e,e.getParent()==null&&(n._rootList.add(e),n._rootMap[t]=e)})}this._dataBoxChangeDispatcher.fire({kind:"clear",datas:t})}},startBatch:function(){this.batch=!0},endBatch:function(){this.batch=!1,this._dataBoxChangeDispatcher.fire({kind:"batchEnd"})},removeSelection:function(){var e=this._selectionModel.toSelection();e.forEach(function(e){this.remove(e)},this)},clearSelection:function(){this._nodeList.forEach(function(e){e.selected=!1}),this._billboardList.forEach(function(e){e.selected=!1}),this._selectionModel.clearSelection()},clearEditing:function(){this._nodeList.forEach(function(e){e.editing=!1}),this._billboardList.forEach(function(e){e.editing=!1})},getDataById:function(e){return this._dataMap[e]},groupElements:function(e,t,n){var r;t&&(r=this._groupLists[t],r&&(r.remove(e),r.isEmpty()&&delete this._groupLists[t])),n&&(r=this._groupLists[n],r==null&&(r=new S,this._groupLists[n]=r),r.contains(e)||r.add(e))},synchronizeGroup:function(e,t,r,i){if(this.isAdjustingGroup)return;this.isAdjustingGroup=!0;var s=e.getGroupId(),o=new n.Vec3;if(s){var u=this._groupLists[s];u&&u.size()>1&&u.forEach(function(s){s!==e&&!s.isDescendantOf(e)&&!e.isDescendantOf(s)&&(o.subVectors(r,t),s[n.setter(i)](s[n.getter(i)]().clone().add(o)))})}this.isAdjustingGroup=!1},handleDataPropertyChange:function(e){var t=e.source;if(e.property==="parent"){var n=t.getId();t.getParent()?this._rootMap[n]&&(delete this._rootMap[n],this._rootList.remove(t)):this._rootMap[n]||(this._rootMap[n]=t,this._rootList.add(t))}else if(e.property==="groupId"){var r=e.oldValue,i=e.newValue;this.groupElements(t,r,i)}else e.property==="position"||e.property==="scale"||e.property==="rotation"?this.synchronizeGroup(t,e.oldValue,e.newValue,e.property):e.property==="selected"&&(t.isSelected?this._selectionModel.appendSelection(t):this._selectionModel.removeSelection(t));this.onDataPropertyChanged(t,e),this._dataPropertyChangeDispatcher.fire(e)},onDataPropertyChanged:function(e,t){},addDataBoxChangeListener:function(e,t,n){this._dataBoxChangeDispatcher.add(e,t,n)},removeDataBoxChangeListener:function(e,t){this._dataBoxChangeDispatcher.remove(e,t)},addDataPropertyChangeListener:function(e,t,n){this._dataPropertyChangeDispatcher.add(e,t,n)},removeDataPropertyChangeListener:function(e,t){this._dataPropertyChangeDispatcher.remove(e,t)},allocateLights:function(){var e,t,r,i,s,o,u,r;i=s=o=u=0;var a=this._lightList;for(e=0,t=a.size();e<t;e++){r=a.get(e);if(r.onlyShadow)continue;r instanceof n.DirectionalLight&&i++,r instanceof n.PointLight&&s++,r instanceof n.SpotLight&&o++}return{directional:i,point:s,spot:o,hemi:u}},allocateShadows:function(){var e,t,r,i=0,s=this._lightList;for(e=0,t=s.size();e<t;e++){r=s.get(e);if(!r.castShadow)continue;r instanceof n.SpotLight&&i++,r instanceof n.DirectionalLight&&!r.shadowCascade&&i++}return i},allocatePointShadows:function(){var e,t,r,i=0,s=this._lightList;for(e=0,t=s.size();e<t;e++){r=s.get(e);if(!r.castShadow)continue;r instanceof n.PointLight&&i++}return i},getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(e){var t=this._limit;this._limit=e,this.firePropertyChange("limit",t,e),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(e){arguments.length===0&&(e=1);while(e>0&&this._dataList.size()>0){var t=this._dataList.get(0);this.remove(t),e--}},getSiblings:function(e){if(!this.contains(e))throw e+" dosen't belong to this dataBox";var t=e.getParent();return t?t.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(e){return e.getParent()?e.getParent().getChildren().indexOf(e):this._rootList.indexOf(e)},getNodes:function(){return this._nodeList},getBillboards:function(){return this._billboardList},getDatas:function(){return this._dataList},getDataAt:function(e){return this._dataList.get(e)},toDatas:function(e,t){return this._dataList.toList(e,t)},forEach:function(e,t){this._dataList.forEach(e,t)},forEachReverse:function(e,t){this._dataList.forEachReverse(e,t)},forEachByDepthFirst:function(e,t,n){if(t)this._depthFirst(e,t,n);else{var r=this._rootList.size();for(var i=0;i<r;i++){var s=this._rootList.get(i);if(this._depthFirst(e,s,n)===!1)return}}},_depthFirst:function(e,t,n){var r=t.getChildrenSize();for(var i=0;i<r;i++){var s=t.getChildAt(i);if(this._depthFirst(e,s,n)===!1)return!1}if(n){if(e.call(n,t)===!1)return!1}else if(e(t)===!1)return!1},forEachByBreadthFirst:function(e,t,n){var r=new S;t?r.add(t):this._rootList.forEach(r.add,r);while(r.size()>0){t=r.removeAt(0),t.getChildren().forEach(r.add,r);if(n){if(e.call(n,t)===!1)return}else if(e(t)===!1)return}},setClient:function(e,t){if(e==null)return this;this._clientMap==null&&(this._clientMap=new Object);var n=this._clientMap[e];if(n===t)return;return t==null?delete this._clientMap[e]:this._clientMap[e]=t,this._clientMap[e]=t,this.firePropertyChange("C:"+e,n,t),this},getClient:function(e){return this._clientMap[e]}}),n.QuickFinder=function(e,t,r,i,s){this._map={};if(!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=r||"accessor",this._propertyType==="accessor"&&(this._getter=n.getter(t)),this._valueFunction=i||this.getValue,this._filterFunction=s||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},n.extend(n.QuickFinder,Object,{_NULL_:"mono-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(e){e.kind==="add"?this._addData(e.data):e.kind==="remove"?this._removeData(e.data):e.kind==="clear"&&(this._map={})},handleDataPropertyChange:function(e){if(!this._filterFunction.call(this,e.source))return;if(this._propertyType!=="accessor"||this._propertyName!==e.property)if(this._propertyType!=="style"||!e.source.IStyle||"S:"+this._propertyName!==e.property)if(this._propertyType!=="client"||"C:"+this._propertyName!==e.property)return;var t=this._getMap(e.oldValue);t&&t.remove(e.source),this._addData(e.source)},_getMap:function(e){return e=e==null?this._NULL_:e,this._map[e]},find:function(e){var t=this._getMap(e);return t?t.toList():new S},findFirst:function(e){var t=this._getMap(e);return!t||t.isEmpty()?null:t.get(0)},_addData:function(e){if(!this._filterFunction.call(this,e))return;var t=this._valueFunction.call(this,e),n=this._getMap(t);n||(n=new S,t=t==null?this._NULL_:t,this._map[t]=n),n.add(e)},_removeData:function(e){if(!this._filterFunction.call(this,e))return;var t=this._valueFunction.call(this,e),n=this._getMap(t);n&&(n.remove(e),n.isEmpty()&&(t=t==null?this._NULL_:t,delete this._map[t]))},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(e){return this._propertyType==="style"&&!e.IStyle?!1:this._propertyType==="accessor"&&this._valueFunction===this.getValue&&!e[this._getter]?!1:!0},getValue:function(e){return this._propertyType==="accessor"?e[this._getter]():this._propertyType==="style"&&e.getStyle?e.getStyle(this._propertyName):this._propertyType==="client"&&e.getClient?e.getClient(this._propertyName):null}}),n.SelectionModel=function(e){n.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new S,this._selectionChangeDispatcher=new n.EventDispatcher,this._selectionMap={},this._setDataBox(e)},n.extend(n.SelectionModel,n.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(e){if(this._selectionMode===e)return;if(e!=="noneSelection"&&e!=="singleSelection"&&e!=="multipleSelection")return;this.clearSelection();var t=this._selectionMode;this._selectionMode=e,this.firePropertyChange("selectionMode",t,this._selectionMode)},getDataBox:function(){return this._dataBox},_setDataBox:function(e){if(!e)throw"dataBox can not be null";if(this._dataBox===e)return;this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var t=this._dataBox;this._dataBox=e,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",t,this._dataBox)},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(e){if(e.kind==="remove"){var t=e.data;this.contains(t)&&(this._selectionList.remove(t),delete this._selectionMap[t.getId()],this.fireSelectionChange("remove",new S(t))),t._selected=!1}else e.kind==="clear"&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(e){if(this._filterFunction===e)return;this.clearSelection();var t=this._filterFunction;this._filterFunction=e,this.firePropertyChange("filterFunction",t,this._filterFunction)},fireSelectionChange:function(e,t,n){n&&(this._selectionList.forEach(function(e){n.contains(e)?n.remove(e):n.add(e)}),t=n.toList()),this._selectionChangeDispatcher.fire({kind:e,datas:new S(t)})},addSelectionChangeListener:function(e,t,n){this._selectionChangeDispatcher.add(e,t,n)},removeSelectionChangeListener:function(e,t){this._selectionChangeDispatcher.remove(e,t)},_filterList:function(e,t){var n=new S(e);for(var r=0;r<n.size();r++){var i=n.get(r);if(this._filterFunction&&!this._filterFunction(i)||t&&this.contains(i)||!t&&!this.contains(i)||!this._dataBox.contains(i))n.removeAt(r),r--}return n},appendSelection:function(e){if(this._selectionMode==="noneSelection")return;var t=this._filterList(e,!0);if(t.isEmpty())return;var n=null;this._selectionMode==="singleSelection"&&(n=new S(this._selectionList),this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={},t=new S(t.get(t.size()-1)));for(var r=0;r<t.size();r++){var i=t.get(r);i._selected=!0,this._selectionList.add(i),this._selectionMap[i._id]=i}this.fireSelectionChange("append",t,n)},removeSelection:function(e){var t=this._filterList(e);if(t.size()===0)return;for(var n=0;n<t.size();n++){var r=t.get(n);r._selected=!1,this._selectionList.remove(r),delete this._selectionMap[r.getId()]}this.fireSelectionChange("remove",t)},toSelection:function(e,t){return this._selectionList.toList(e,t)},getSelection:function(){return this._selectionList},setSelection:function(e){if(this._selectionMode==="noneSelection")return;if(this._selectionList.size()===0&&e==null)return;var t=new S(this._selectionList);this._selectionList.clear(),this._selectionMap={};var n=this._filterList(e,!0);this._selectionMode==="singleSelection"&&n.size()>1&&(n=new S(n.get(n.size()-1)));for(var r=0;r<n.size();r++){var i=n.get(r);i._selected=!0,this._selectionList.add(i),this._selectionMap[i.getId()]=i}this.fireSelectionChange("set",null,t)},clearSelection:function(){if(this._selectionList.size()>0){var e=this._selectionList.toList();this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",e)}},selectAll:function(){if(this._selectionMode==="noneSelection")return;var e=this._dataBox.toDatas(),t=0,n=null;if(this._filterFunction)for(t=0;t<e.size();t++)n=e.get(t),this._filterFunction(n)||(e.removeAt(t),t--);var r=new S(this._selectionList);this._selectionList.clear(),this._selectionMap={},this._selectionMode==="singleSelection"&&e.size()>1&&(e=new S(e.get(e.size()-1)));for(t=0;t<e.size();t++)n=e.get(t),this._selectionList.add(n),this._selectionMap[n.getId()]=n;this.fireSelectionChange("all",null,r)},size:function(){return this._selectionList.size()},contains:function(e){return e?this._selectionMap[e._id]!=null:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(e){return e?this._selectionMode==="noneSelection"?!1:this._filterFunction&&!this._filterFunction(e)?!1:!0:!1}}),n.AlarmSeverity=function(e,t,n,r,i){this.value=e,this.name=t,this.nickName=n,this.color=r,this.displayName=i},n.extend(n.AlarmSeverity,Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var e=n.AlarmSeverity;e.severities=new S,e._vm={},e._nm={},e._cp=function(e,t){if(e&&t){var n=e.value-t.value;return n>0?1:n<0?-1:0}return e&&!t?1:!e&&t?-1:0},e.forEach=function(t,n){e.severities.forEach(t,n)},e.getSortFunction=function(){return e._cp},e.setSortFunction=function(t){e._cp=t,e.severities.sort(t)},e.add=function(t,n,r,i,s){var o=new e(t,n,r,i,s);return e._vm[t]=o,e._nm[n]=o,e.severities.add(o),e.severities.sort(e._cp),o},e.remove=function(t){var n=e._nm[t];return n&&(delete e._nm[t],delete e._vm[n.value],e.severities.remove(n)),n},e.CRITICAL=e.add(500,"Critical","C","#FF0000"),e.MAJOR=e.add(400,"Major","M","#FFA000"),e.MINOR=e.add(300,"Minor","m","#FFFF00"),e.WARNING=e.add(200,"Warning","W","#00FFFF"),e.INDETERMINATE=e.add(100,"Indeterminate","N","#C800FF"),e.CLEARED=e.add(0,"Cleared","R","#00FF00"),e.isClearedAlarmSeverity=function(e){return e?e.value===0:!1},e.getByName=function(t){return e._nm[t]},e.getByValue=function(t){return e._vm[t]},e.clear=function(){e.severities.clear(),e._vm={},e._nm={}},e.compare=function(t,n){return e._cp(t,n)}}(),n.AlarmState=function(e){this._e=e,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},n.extend(n.AlarmState,Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var e=null;for(var t in this._am){t=n.AlarmSeverity.getByName(t);if(n.AlarmSeverity.isClearedAlarmSeverity(t))continue;if(this.getAcknowledgedAlarmCount(t)===0)continue;e?e=n.AlarmSeverity.compare(e,t)>0?e:t:e=t}this._haa=e},_c2:function(){var e=null;for(var t in this._nm){t=n.AlarmSeverity.getByName(t);if(n.AlarmSeverity.isClearedAlarmSeverity(t))continue;if(this.getNewAlarmCount(t)===0)continue;e?e=n.AlarmSeverity.compare(e,t)>0?e:t:e=t}this._hna=e},_c3:function(){if(!this._hna){this._hls=!1;return}for(var e in this._nm){e=n.AlarmSeverity.getByName(e);if(n.AlarmSeverity.isClearedAlarmSeverity(e))continue;if(this.getNewAlarmCount(e)===0)continue;if(n.AlarmSeverity.compare(this._hna,e)>0){this._hls=!0;return}}this._hls=!1},_c4:function(){var e=this._haa,t=this._hna,r=this._ps;this._hoa=e,n.AlarmSeverity.compare(t,this._hoa)>0&&(this._hoa=t),n.AlarmSeverity.compare(r,this._hoa)>0&&(this._hoa=r)},_c5:function(){var e=this._haa,t=this._hna;this._hta=e,n.AlarmSeverity.compare(t,this._hta)>0&&(this._hta=t)},increaseAcknowledgedAlarm:function(e,t){t==null&&(t=1);if(t===0)return;var n=this._am[e.name];n==null&&(n=0),n+=t,this._am[e.name]=n,this._f(),this._e.onAlarmChange()},increaseNewAlarm:function(e,t){t==null&&(t=1);if(t===0)return;var n=this._nm[e.name];n==null&&(n=0),n+=t,this._nm[e.name]=n,this._f(),this._e.onAlarmChange()},decreaseAcknowledgedAlarm:function(e,t){t==null&&(t=1);if(t===0)return;var n=this._am[e.name];n==null&&(n=0),n-=t;if(n<0)throw"Alarm count can not be negative";this._am[e.name]=n,this._f(),this._e.onAlarmChange()},decreaseNewAlarm:function(e,t){t==null&&(t=1);if(t===0)return;var n=this._nm[e.name];n==null&&(n=0),n-=t;if(n<0)throw"Alarm count can not be negative";this._nm[e.name]=n,this._f(),this._e.onAlarmChange()},acknowledgeAlarm:function(e){this.decreaseNewAlarm(e,1),this.increaseAcknowledgedAlarm(e,1)},acknowledgeAllAlarms:function(e){if(e){var t=this.getNewAlarmCount(e);this.decreaseNewAlarm(e,t),this.increaseAcknowledgedAlarm(e,t)}else for(var r in this._nm)this.acknowledgeAllAlarms(n.AlarmSeverity.getByName(r))},_c6:function(){this._aac=0;for(var e in this._am)e=n.AlarmSeverity.getByName(e),this._aac+=this.getAcknowledgedAlarmCount(e)},getAcknowledgedAlarmCount:function(e){if(e){var t=this._am[e.name];return t==null?0:t}return this._aac},getAlarmCount:function(e){return this.getAcknowledgedAlarmCount(e)+this.getNewAlarmCount(e)},_c7:function(){this._nac=0;for(var e in this._nm)e=n.AlarmSeverity.getByName(e),this._nac+=this.getNewAlarmCount(e)},getNewAlarmCount:function(e){if(e){var t=this._nm[e.name];return t==null?0:t}return this._nac},setNewAlarmCount:function(e,t){this._nm[e.name]=t,this._f()},removeAllNewAlarms:function(e){e?delete this._nm[e]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(e,t){this._am[e.name]=t,this._f()},removeAllAcknowledgedAlarms:function(e){e?delete this._am[e.name]:this._am={},this._f()},isEmpty:function(){return this._hoa==null},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(e){this._ep||(e=null);if(this._ps===e)return;var t=this._ps;this._ps=e,this._f(),this._e.onAlarmChange(),this._e.firePropertyChange("propagateSeverity",t,e)},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(e){var t=this._ep;this._ep=e,this._e.firePropertyChange("enablePropagation",t,e)&&(e||this.setPropagateSeverity(null))}}),n.Alarm=function(e,t,r,i,s){n.Data.call(this,e),this._id=e!=null?e:n.id("A"),this._elementId=t,this._alarmSeverity=r,this._acked=i||!1,this._cleared=s||!1},n.extend(n.Alarm,n.Data,{IAlarm:!0,getElementId:function(){return this._elementId},___accessor:["acked","cleared","alarmSeverity"]}),n.AlarmBox=function(e){if(!e)throw"elementBox can not be null.";n.AlarmBox.superClass.constructor.call(this),this._elementBox=e,this._alarmElementMapping=new n.AlarmElementMapping(this,e),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},n.extend(n.AlarmBox,n.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(e){var t=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=e,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",t,e);if(e)for(var n in this.datas){var r=this.datas[n];r.isCleard()&&this.remove(r)}},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(e){if(!e)throw"alarmElementMapping can not be null";if(this._alarmElementMapping===e)return;var t=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=e,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",t,e)},handleElementBoxChange:function(e){e.kind==="add"?this.handleElementAdded(e.data):e.kind==="remove"?(this.handleElementRemoved(e.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(e.data)):e.kind==="clear"&&(e.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(e){e.kind==="add"?this._increaseAlarmState(e.data):e.kind==="remove"?this._decreaseAlarmState(e.data):e.kind==="clear"&&e.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(e){var t=e.source;t.isCleared()||(e.property==="alarmSeverity"?this.handleAlarmSeverityChange(t,e):e.property==="acked"&&this.handleAckedChange(t,e)),e.property==="cleared"&&(t.isCleared()?(this._decreaseAlarmState(t,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(t)):this._increaseAlarmState(t,!0))},handleAckedChange:function(e,t){if(!e.getAlarmSeverity())return;var n=this.getCorrespondingElements(e);if(n)for(var r=0;r<n.size();r++){var i=n.get(r);t.oldValue?i.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):i.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()),t.newValue?i.getAlarmState().increaseAcknowledgedAlarm(e.getAlarmSeverity()):i.getAlarmState().increaseNewAlarm(e.getAlarmSeverity())}},handleAlarmSeverityChange:function(e,t){var n=t.oldValue,r=t.newValue,i=this.getCorrespondingElements(e);if(i)for(var s=0
;s<i.size();s++){var o=i.get(s);n&&(e.isAcked()?o.getAlarmState().decreaseAcknowledgedAlarm(n):o.getAlarmState().decreaseNewAlarm(n)),r&&(e.isAcked()?o.getAlarmState().increaseAcknowledgedAlarm(r):o.getAlarmState().increaseNewAlarm(r))}},getCorrespondingAlarms:function(e){return this._alarmElementMapping.getCorrespondingAlarms(e)},getCorrespondingElements:function(e){return this._alarmElementMapping.getCorrespondingElements(e)},handleElementAdded:function(e){var t=this.getCorrespondingAlarms(e);if(t)for(var n=0;n<t.size();n++){var r=t.get(n);if(r.isCleared())continue;var i=r.getAlarmSeverity();i&&(r.isAcked()?e.getAlarmState().increaseAcknowledgedAlarm(i):e.getAlarmState().increaseNewAlarm(i))}},_increaseAlarmState:function(e,t){if(e.isCleared()&&!t)return;var n=e.getAlarmSeverity();if(n){var r=this.getCorrespondingElements(e);if(r)for(var i=0;i<r.size();i++){var s=r.get(i);e.isAcked()?s.getAlarmState().increaseAcknowledgedAlarm(n):s.getAlarmState().increaseNewAlarm(n)}}},_decreaseAlarmState:function(e,t){e.isCleared||console.log();if(e.isCleared()&&!t)return;var n=e.getAlarmSeverity();if(!n)return;var r=this.getCorrespondingElements(e);if(r)for(var i=0;i<r.size();i++){var s=r.get(i);e.isAcked()?s.getAlarmState().decreaseAcknowledgedAlarm(n):s.getAlarmState().decreaseNewAlarm(n)}},handleElementRemoved:function(e){var t=this.getCorrespondingAlarms(e);t&&t.forEach(function(t){!t.isCleared()&&t.getAlarmSeverity()&&(t.isAcked()?e.getAlarmState().decreaseAcknowledgedAlarm(t.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(t.getAlarmSeverity()))})},removeAlarmsByElement:function(e){var t=this.getCorrespondingAlarms(e);t&&t.forEach(this.remove,this)},add:function(e,t){if(!e.IAlarm)throw"Only IAlarm can be added into AlarmBox";if(this._removeAlarmWhenAlarmIsCleared&&e.isCleared())return;n.AlarmBox.superClass.add.apply(this,arguments)}}),n.AlarmElementMapping=function(e,t){if(!t)throw"ElementBox can not be null";if(!e)throw"AlarmBox can not be null";this._elementBox=t,this._alarmBox=e,this._alarmsFinder=new n.QuickFinder(e,"elementId")},n.extend(n.AlarmElementMapping,Object,{getCorrespondingAlarms:function(e){return this._alarmsFinder.find(e.getId())},getCorrespondingElements:function(e){var t=this._elementBox.getDataById(e.getElementId());return new S(t)},dispose:function(){delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),n.PropertyPropagator=function(e,t,r){if(!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=r||"accessor",this._propertyType==="accessor"&&(this._getter=n.getter(t),this._setter=n.setter(t)),this._enable=!1,this._isPropagating=!1},n.extend(n.PropertyPropagator,Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(e){if(this._enable===e)return;this._enable=e;if(this._enable){this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this);for(var t in this._dataBox.datas)this.propagate(this._dataBox.datas[t])}else this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)},handleDataBoxChange:function(e){e.data&&this.propagate(e.data)},handleDataPropertyChange:function(e){if(this.isInterestedProperty(e))this.propagate(e.source);else if(e.property==="parent"){var t=e.oldValue;t&&this.propagate(t),this.propagate(e.source)}},isInterestedProperty:function(e){return this._propertyType==="accessor"&&this._propertyName===e.property?!0:this._propertyType==="style"&&e.IElement&&"S:"+this._propertyName===e.property?!0:this._propertyType==="client"&&"C:"+this._propertyName===e.property?!0:!1},propagate:function(e){if(!e||this._isPropagating)return;this._isPropagating=!0,this.propagateToTop(e),this._isPropagating=!1},propagateToTop:function(e){this.propagateToParent(null,e);while(e&&e.getParent())this.propagateToParent(e,e.getParent()),e=e.getParent()},propagateToParent:function(e,t){}}),n.AlarmStatePropagator=function(e){n.AlarmStatePropagator.superClass.constructor.call(this,e,"alarmState")},n.extend(n.AlarmStatePropagator,n.PropertyPropagator,{handleDataPropertyChange:function(e){e.property==="enablePropagation"?this.propagate(e.source):n.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,e)},propagateToParent:function(e,t){var r=null;t.getChildren().forEach(function(e){var t=e.getAlarmState().getHighestOverallAlarmSeverity();n.AlarmSeverity.compare(t,r)>0&&(r=t)}),t.getAlarmState&&t.getAlarmState().setPropagateSeverity(r)}});var A={KEEP_DEFAULT_FUNCTION:function(e){return e.target.keepDefault||e.target.getAttribute("keepDefault")?!0:e.target.parentNode&&(e.target.parentNode.keepDefault||e.target.parentNode.getAttribute("keepDefault"))?!0:e.shiftKey?!0:!1}};A.paintSortFunction=function(e,t){return e.z!==t.z?e.z-t.z:0},A.doubleClickToLookAtFunction=function(e){return!0},A.needSmoothNormalFunction=function(e){var t=e instanceof L||e instanceof n.TextNode||e instanceof n.PathCube||e instanceof n.ShapeNode||e instanceof n.ComboNode||e.getClassName()=="TGL.Entity";return!t},A.PATH_LINK_COMPUTE_DELAY=!1,n.Defaults=A,n.BasicShader={vertex_shader:"",fragment_shader:""},n.ShaderUtil={},n.ShaderUtil.getShader=function(e){},n.ShaderChunk={gradient_parts_fragment:["#ifdef MAX_GRADIENT","uniform vec3 gradientColor[MAX_GRADIENT];","uniform float gradientStop[MAX_GRADIENT];","uniform int gradientType;","#endif"].join("\n"),gradient_basic_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = vUv.x;","} else if(gradientType == 2){","gradientUV = vUv.y;","} else if(gradientType == 3){","gradientUV = (vUv.x + vUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (vUv.x + 1.0 - vUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((vUv.x - 0.5) * (vUv.x - 0.5) + (vUv.y - 0.5) * (vUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(vUv.y - 0.5,vUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] <= gradientUV){","if((gradientStop[i] >= gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 =gradientStop[i]; ","gl_FragColor = vec4( (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1),opacity);","break;","}","}","}","#endif"].join("\n"),gradient_phong_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = vUv.x;","} else if(gradientType == 2){","gradientUV = vUv.y;","} else if(gradientType == 3){","gradientUV = (vUv.x + vUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (vUv.x + 1.0 - vUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((vUv.x - 0.5) * (vUv.x - 0.5) + (vUv.y - 0.5) * (vUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(vUv.y - 0.5,vUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] < gradientUV){","if((gradientStop[i] > gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 = gradientStop[i]; ","tempDiffuse = (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1);","break;","}","}","}","#endif"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#else","vec4 cubeColor = textureCube( envMap, vec3(reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","#ifdef PHONG","#else","float specularStrength = 1.0;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP ) ","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","uniform vec4 offsetRepeat;","uniform bool flipX; ","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform bool mapLoaded;","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","if(flipX){","vUv.x = uv.x * offsetRepeat.z * (-1.0) + offsetRepeat.x + offsetRepeat.z;","vUv.y = uv.y * offsetRepeat.w  + offsetRepeat.y;","}else{","vUv = uv * offsetRepeat.zw  + offsetRepeat.xy;","}","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","if(mapLoaded){","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = texelColor * gl_FragColor;","}","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = uspecularStrength;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0 ","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += tempDiffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ]) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += tempDiffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += tempDiffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += tempDiffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","float ssao = 1.0;","#ifdef USE_SSAO","ssao = clamp(1.0 - texture2D(mapSSAO, (finalPosition.xy / finalPosition.w / 2.0 + vec2(0.5,0.5))).x,0.0,1.0);","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient * ssao) + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient) * ssao ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];"
,"mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","uniform samplerCube pShadowMap[MAX_POINT_SHADOWS];","uniform float pShadowDarkness[MAX_POINT_SHADOWS];","uniform vec3 pPosition[MAX_POINT_SHADOWS];","varying vec4 pWorldPosition;","#endif","#if defined(USE_SHADOWMAP) || defined(USE_POINT_SHADOWMAP)","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","float unpack (vec4 colour){","const vec4 bitShifts = vec4(1.0,1.0 / 255.0,1.0 / (255.0 * 255.0),1.0 / (255.0 * 255.0 * 255.0));","return dot(colour, bitShifts) * 100000.0;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3(inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2(inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif","#ifdef USE_POINT_SHADOWMAP","for( int i = 0; i < MAX_POINT_SHADOWS; i ++ ) {","vec3 lightVec = normalize(pWorldPosition.xyz - pPosition[i]);","float depth = length(pWorldPosition.xyz - pPosition[i]);","float shadowDepth = unpack (textureCube(pShadowMap[i], lightVec));","depth = depth * 0.95;","if ( depth > shadowDepth){","gl_FragColor.xyz *= 0.8;","}","}","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","varying vec4 pWorldPosition;","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","#ifdef USE_POINT_SHADOWMAP","pWorldPosition = modelMatrix * vec4(position,1.0);","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},n.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(n in r)i[n]=r[n]}return i},clone:function(e){var t,r,i,s,o={};for(t in e){o[t]={};for(r in e[t])s=e[t][r],s instanceof n.Color||s instanceof n.Vec2||s instanceof n.Vec3||s instanceof n.Vec4||s instanceof n.Mat4||s instanceof n.Texture?o[t][r]=s.clone():s instanceof Array?o[t][r]=s.slice():o[t][r]=s}return o}},n.UniformsLib={outline:{diffuse:{type:"c",value:new n.Color(15658734)},outline_offset:{type:"f",value:0}},glow:{map:{type:"t",value:null}},blur:{orientation:{type:"i",value:0},texelSize:{type:"v2",value:new n.Vec2(512,512)},blurAmount:{type:"i",value:10},blurScale:{type:"f",value:1},blurStrength:{type:"f",value:.2},map:{type:"t",value:null},useBlur:{type:"i",value:1},blurGlobalAlpha:{type:"f",value:1}},deferred:{linearDepth:{type:"f",value:9e3},isNormal:{type:"i",value:1}},ssao:{map0:{type:"t",value:null},map1:{type:"t",value:null},map2:{type:"t",value:null},occluderBias:{type:"f",value:.05},samplingRadius:{type:"f",value:20},attenuation:{type:"v2",value:new s(1,0)},texelSize:{type:"v2",value:new s(1/512,1/512)}},common:{diffuse:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},mapLoaded:{type:"i",value:0},offsetRepeat:{type:"v4",value:new n.Vec4(0,0,1,1)},flipX:{type:"i",value:0},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},gradient:{gradientColor:{type:"v3v",value:[]},gradientStop:{type:"fv1",value:[]},gradientType:{type:"i",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new n.Vec2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new n.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new n.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},pShadowMap:{type:"tv",value:[]},pShadowMapSize:{type:"v2v",value:[]},pShadowDarkness:{type:"fv1",value:[]},pPosition:{type:"v3v",value:[]}}},n.ShaderLib={outline:{uniforms:n.UniformsUtils.merge([n.UniformsLib.outline]),vertexShader:["uniform float outline_offset;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position + normal  * outline_offset, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","void main() {","gl_FragColor = vec4(diffuse, 1.0 );","}"].join("\n")},blur:{uniforms:n.UniformsUtils.merge([n.UniformsLib.blur]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform vec2 texelSize;","uniform sampler2D map;","uniform int orientation;","uniform int blurAmount;","uniform float blurScale;","uniform float blurStrength;","uniform int useBlur;","uniform float blurGlobalAlpha;","uniform sampler2D depthMap;","varying vec2 vUv;","float Gaussian (float x, float deviation){","return (1.0 / sqrt(2.0 * 3.141592 * deviation)) * exp(-((x * x) / (2.0 * deviation)));","}","void main (){","float halfBlur = float(blurAmount) * 0.5;","vec4 colour = vec4(0.0);","if(useBlur == 0){","colour = texture2D(map,vUv);","}else {","vec4 texColour = vec4(0.0);","float deviation = halfBlur * 0.35;","deviation *= deviation;","float strength = 1.0 - blurStrength;","if ( orientation == 0 ){","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount ){","break;","}","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(offset / texelSize.x * blurScale, 0.0)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}else{","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount )","break;","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(0.0, offset / texelSize.y * blurScale)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}","}","gl_FragColor = clamp(colour, 0.0, 1.0);","if(useBlur == 0){","gl_FragColor.w *=  gl_FragColor.w * gl_FragColor.w * gl_FragColor.w * blurGlobalAlpha;","}","}"].join("\n")},deferred:{uniforms:n.UniformsUtils.merge([n.UniformsLib.deferred]),vertexShader:["varying vec4 vPosition;","varying vec3 vNormal;","void main (){","vNormal = mat3(modelViewMatrix) * normal;","vPosition = modelViewMatrix * vec4(position, 1.0);","gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fragmentShader:["uniform float linearDepth;","uniform int isNormal;","varying vec4 vPosition;","varying vec3 vNormal;","void main (){","float linear_depth = length(vPosition) / linearDepth;","if(isNormal == 1){","vec3 normal = normalize(vNormal);","gl_FragColor = vec4(normal.x, normal.y, normal.z, 1.0);","}else{","gl_FragColor = vec4(vPosition.x, vPosition.y, vPosition.z, linear_depth);","}","}"].join("\n")},ssao:{uniforms:n.UniformsUtils.merge([n.UniformsLib.ssao]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D map0;","uniform sampler2D map1;","uniform sampler2D map2;","uniform vec2 texelSize;","uniform float occluderBias;","uniform float samplingRadius;","uniform vec2 attenuation;","varying vec2 vUv;","float samplePixels (vec3 srcPosition, vec3 srcNormal, vec2 uv){","vec3 dstPosition = texture2D(map0, uv).xyz;","vec3 positionVec = dstPosition - srcPosition;","float intensity = max(dot(normalize(positionVec), srcNormal) - occluderBias, 0.0);","float dist = length(positionVec);","float attenuationValue = 1.0 / (attenuation.x + (attenuation.y * dist));","return intensity * attenuationValue;","}","void main (){","vec3 srcPosition = texture2D(map0, vUv).xyz;","vec3 srcNormal = texture2D(map1, vUv).xyz;","vec2 randVec = normalize(texture2D(map2, vUv).xy * 2.0 - 1.0);","float srcDepth = texture2D(map0, vUv).w;","float kernelRadius = samplingRadius * (1.0 - srcDepth);","vec2 kernel[4];","kernel[0] = vec2(0.0, 1.0);","kernel[1] = vec2(1.0, 0.0);","kernel[2] = vec2(0.0, -1.0);","kernel[3] = vec2(-1.0, 0.0);","const float sin45 = 0.707107;","float occlusion = 0.0;","for (int i = 0; i < 4; ++i){","vec2 k1 = reflect(kernel[i], randVec);","vec2 k2 = vec2(k1.x * sin45 - k1.y * sin45,k1.x * sin45 + k1.y * sin45);","k1 *= texelSize;","k2 *= texelSize;","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.75);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius * 0.5);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.25);","}","occlusion /= 16.0;","occlusion = clamp(occlusion, 0.0, 1.0);","gl_FragColor =  vec4(occlusion,0.0,0.0,1.0);","}"].join("\n")},basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.gradient,n.UniformsLib.fog]),vertexShader:[n.ShaderChunk.map_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.envmap_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,"#endif",n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,n.ShaderChunk.worldpos_vertex,n.ShaderChunk.envmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.gradient_parts_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",n.ShaderChunk.gradient_basic_fragment,n.ShaderChunk.map_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{ambient:{type:"c",value:new n.Color(16777215)},emissive:{type:"c",value:new n.Color(0)},wrapRGB:{type:"v3",value:new n.Vec3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",n.ShaderChunk.map_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.envmap_pars_vertex,n.ShaderChunk.lights_lambert_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,n.ShaderChunk.worldpos_vertex,n.ShaderChunk.envmap_vertex,n.ShaderChunk.lights_lambert_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",n.ShaderChunk.map_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.gradient,n.UniformsLib.bump,n.UniformsLib.normalmap,n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{ambient:{type:"c",value:new n.Color(16777215)},emissive:{type:"c",value:new n.Color(0)},specular:{type:"c",value:new n.Color(1118481)},uspecularStrength:{type:"f",value:1},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new n.Vec3(1,1,1)},mapSSAO:{type:"t",value:null}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;","varying vec4 finalPosition;",n.ShaderChunk.map_pars_vertex,n.ShaderChunk.lightmap_pars_vertex,n.ShaderChunk.envmap_pars_vertex,n.ShaderChunk.lights_phong_pars_vertex,n.ShaderChunk.color_pars_vertex,n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.map_vertex,n.ShaderChunk.lightmap_vertex,n.ShaderChunk.color_vertex,n.ShaderChunk.morphnormal_vertex,n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,n.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",n.ShaderChunk.worldpos_vertex,n.ShaderChunk.envmap_vertex,n.ShaderChunk.lights_phong_vertex,n.ShaderChunk.shadowmap_vertex,"finalPosition = gl_Position;","}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float uspecularStrength;","uniform float shininess;","varying vec4 finalPosition;",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.gradient_parts_fragment,n.ShaderChunk.map_pars_fragment,n.ShaderChunk.lightmap_pars_fragment,n.ShaderChunk.envmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.lights_phong_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.bumpmap_pars_fragment,n.ShaderChunk.normalmap_pars_fragment,n.ShaderChunk.specularmap_pars_fragment,"#ifdef USE_SSAO","uniform sampler2D mapSSAO;","#endif","void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","vec3 tempDiffuse = diffuse;",n.ShaderChunk.gradient_phong_fragment,n.ShaderChunk.map_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.specularmap_fragment,n.ShaderChunk.lights_phong_fragment,n.ShaderChunk.lightmap_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.envmap_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:n.UniformsUtils.merge([n.UniformsLib.particle,n.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",n.ShaderChunk.color_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",n.ShaderChunk.worldpos_vertex,n.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.map_particle_pars_fragment,n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",n.ShaderChunk.map_particle_fragment,n.ShaderChunk.alphatest_fragment,n.ShaderChunk.color_fragment,n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},billboard:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")},dashed:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",n.ShaderChunk.color_pars_vertex,"void main() {",n.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",n.ShaderChunk.color_pars_fragment,n.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",n.ShaderChunk.color_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:n.UniformsUtils.merge([n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new n.Vec2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new n.Color(16777215)},uSpecularColor:{type:"c",value:new n.Color(1118481)},uSpecualarStrength:{type:"f",value:1},uAmbientColor:{type:"c",value:new n.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new n.Vec2(0,0)},uRepeat:{type:"v2",value:new n.Vec2(1,1)},wrapRGB:{type:"v3",value:new n.Vec3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform vec3 uSpecularStrength;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];"
,"#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",n.ShaderChunk.skinning_pars_vertex,n.ShaderChunk.shadowmap_pars_vertex,"void main() {",n.ShaderChunk.skinbase_vertex,n.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{isCube:{type:"i",value:0}},vertexShader:[n.ShaderChunk.morphtarget_pars_vertex,n.ShaderChunk.skinning_pars_vertex,"varying vec4 vPosition1;","void main() {",n.ShaderChunk.skinbase_vertex,n.ShaderChunk.morphtarget_vertex,n.ShaderChunk.skinning_vertex,n.ShaderChunk.default_vertex,"vPosition1 = modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int isCube;","varying vec4 vPosition1;","varying vec3 vPosition2;","vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","vec4 pack (float depth){","const vec4 bias = vec4(1.0 / 255.0,1.0 / 255.0,1.0 / 255.0, 0.0);","float r = depth;","float g = fract(r * 255.0);","float b = fract(g * 255.0);","float a = fract(b * 255.0);","vec4 colour = vec4(r, g, b, a);","return colour - (colour.yzww * bias);","}","void main() {","if(isCube == 1){","gl_FragData[ 0 ] = pack(length(vPosition1) / 100000.0);","}else{","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}","}"].join("\n")}},n.ShaderTerrain={terrain:{uniforms:n.UniformsUtils.merge([n.UniformsLib.fog,n.UniformsLib.lights,n.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableDiffuse3:{type:"i",value:0},enableDisplacement:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDiffuse3:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},heightUnit:{type:"f",value:1},blendRange:{type:"fv1",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new n.Color(15658734)},uSpecularColor:{type:"c",value:new n.Color(1118481)},uAmbientColor:{type:"c",value:new n.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new n.Vec2(1,1)},uRepeatOverlay:{type:"v2",value:new n.Vec2(1,1)},uOffset:{type:"v2",value:new n.Vec2(0,0)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableDiffuse3;","uniform bool enableSpecular;","uniform bool enableDisplacement;","uniform float blendRange[2];","uniform float heightUnit;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDiffuse3;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",n.ShaderChunk.shadowmap_pars_fragment,n.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( (enableDiffuse1 && enableDiffuse2)  || (enableDiffuse1 && enableDiffuse3) || (enableDiffuse2 && enableDiffuse3) ){","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","vec4 colDiffuse3 = texture2D( tDiffuse3, uvOverlay );","vec4 allDefiuuses[3];","allDefiuuses[0] = colDiffuse1;","allDefiuuses[1] = colDiffuse2;","allDefiuuses[2] = colDiffuse3;","#ifdef GAMMA_INPUT","colDiffuse1.xyz *= colDiffuse1.xyz;","colDiffuse2.xyz *= colDiffuse2.xyz;","colDiffuse3.xyz *= colDiffuse3.xyz;","#endif","vec4 mixColor;","if(enableDisplacement){","vec4 dis = texture2D( tDisplacement, uvBase );","if(enableDiffuse1 && enableDiffuse2 && enableDiffuse3){","float total = dis.r + dis.g + dis.b;","if(total == 0.0){","mixColor = colDiffuse1 * 1.0/3.0 + colDiffuse2 * 1.0/3.0 + colDiffuse3 * 1.0/3.0;","}else{","mixColor = colDiffuse1 * dis.r/total + colDiffuse2 * dis.g/total + colDiffuse3 * dis.b/total;","}","}","}else {","mixColor = colDiffuse2;","float y = vPosition.y;","float blend2Bottom = blendRange[1] * heightUnit * 255.0;","float percent = 0.0;","if(y < blendRange[0] * heightUnit * 255.0){","mixColor = colDiffuse1;","percent = y / (blendRange[0] * heightUnit * 255.0);","if(percent >=0.8){","mixColor = mix(colDiffuse1,colDiffuse2,(percent - 0.8) / 0.2);","}","} else if(y > blend2Bottom){","mixColor = colDiffuse3;","percent = (y - blend2Bottom) / (heightUnit * 255.0 - blend2Bottom);","if(percent <= 0.2){","mixColor = mix(colDiffuse2,colDiffuse3,percent/0.2);","}","}","}","gl_FragColor = gl_FragColor * mixColor;"," } else if( enableDiffuse1 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDistance = lDistance;","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","hemiDiffuse += uDiffuseColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","hemiSpecular += uSpecularColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif",n.ShaderChunk.shadowmap_fragment,n.ShaderChunk.linear_to_gamma_fragment,n.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","varying vec3 vViewPosition;",n.ShaderChunk.shadowmap_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vPosition = vec4(position,1.0);","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",n.ShaderChunk.shadowmap_vertex,"}"].join("\n")}},n.ShaderLib.terrain=n.ShaderTerrain.terrain,n.Fog=function(e,r,i){this.name="",this.color=new n.Color(e),this.near=r!==t?r:1,this.far=i!==t?i:1e3},n.Fog.prototype={constructor:n.Fog,clone:function(){return new n.Flog(this.color.getHex(),this.near,this.far)},refreshUniforms:function(e){e.fogNear.value=this.near,e.fogFar.value=this.far,e.fogColor.value=this.color}},n.FogExp2=function(e,r){this.name="",this.color=new n.Color(e),this.density=r!==t?r:1},n.FogExp2.prototype={DensityFactor:25e-5,constructor:n.FogExp2,clone:function(){return new n.FogExp2(this.color.getHex(),this.density)},refreshUniforms:function(e){e.fogDensity.value=this.density*this.DensityFactor,e.fogColor.value=this.color}};var O={};O.isPowerOfTwo=function(e){return(e&e-1)===0},O.clone=function(e,n){n==t&&(n=new e.prototype.constructor);for(var r in e){if(r==="id")continue;var i=e[r];if(i.copy&&typeof i.copy=="function")n[r].copy(i);else if(i instanceof Array){var s=i,o=n[r];o==null&&(o=[]);for(var u=0;u<s.length;u++){var a=s[u];o.push(a.clone())}}else cloneObjet[r]=i}},O.paramToGL=function(e,t){if(!t){console.error("No webgl context");return}switch(e){case n.RepeatWrapping:return t.REPEAT;case n.ClampToEdgeWrapping:return t.CLAMP_TO_EDGE;case n.MirroredRepeatWrapping:return t.MIRRORED_REPEAT;case n.NearestFilter:return t.NEAREST;case n.NearestMipMapNearestFilter:return t.NEAREST_MIPMAP_NEAREST;case n.NearestMipMapLinearFilter:return t.NEAREST_MIPMAP_LINEAR;case n.LinearFilter:return t.LINEAR;case n.LinearMipMapNearestFilter:return t.LINEAR_MIPMAP_NEAREST;case n.LinearMipMapLinearFilter:return t.LINEAR_MIPMAP_LINEAR;case n.ByteType:return t.BYTE;case n.UnsignedByteType:return t.UNSIGNED_BYTE;case n.ShortType:return t.SHORT;case n.UnsignedShortType:return t.UNSIGNED_SHORT;case n.IntType:return t.INT;case n.UnsignedIntType:return t.UNSIGNED_INT;case n.FloatType:return t.FLOAT;case n.AlphaFormat:return t.ALPHA;case n.RGBFormat:return t.RGB;case n.RGBAFormat:return t.RGBA;case n.LuminanceFormat:return t.LUMINANCE;case n.LuminanceAlphaFormat:return t.LUMINANCE_ALPHA;case n.AddEquation:return t.FUNC_ADD;case n.SubtractEquation:return t.FUNC_SUBTRACT;case n.ReverseSubtractEquation:return t.FUNC_REVERSE_SUBTRACT;case n.ZeroFactor:return t.ZERO;case n.OneFactor:return t.ONE;case n.SrcColorFactor:return t.SRC_COLOR;case n.OneMinusSrcColorFactor:return t.ONE_MINUS_SRC_COLOR;case n.SrcAlphaFactor:return t.SRC_ALPHA;case n.OneMinusSrcAlphaFactor:return t.ONE_MINUS_SRC_ALPHA;case n.DstAlphaFactor:return t.DST_ALPHA;case n.OneMinusDstAlphaFactor:return t.ONE_MINUS_DST_ALPHA;case n.DstColorFactor:return t.DST_COLOR;case n.OneMinusDstColorFactor:return t.ONE_MINUS_DST_COLOR;case n.SrcAlphaSaturateFactor:return t.SRC_ALPHA_SATURATE}return 0},O.createElement=function(e,r,i,o){var u,a,l,c,h=e.vertices.length,p=e.uvs.length,d=e.vertices,v=r.vertices,m=e.faces,g=r.faces,y=e.uvs,b=r.uvs,w=[],E=[],S=[];o===t&&(o=0),e instanceof n.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),u=e.matrix,a=(new f).getNormalMatrix(u)),r instanceof n.Element&&(r.matrixAutoUpdate&&r.updateMatrix(),l=r.matrix,c=(new f).getNormalMatrix(l));for(var x=0,T=d.length;x<T;x++){var N=d[x],L=N.clone();u&&L.applyMatrix4(u),E.push(L)}for(var x=0,T=v.length;x<T;x++){var N=v[x],L=N.clone();l&&L.applyMatrix4(l),E.push(L)}for(x=0,T=m.length;x<T;x++){var A=m[x],O,M,_,D=A.vertexNormals,P=A.vertexColors;A instanceof C?O=new C(A.a,A.b,A.c):O=new k(A.a,A.b,A.c,A.d),O.normal.copy(A.normal),a&&O.normal.applyMatrix3(a).normalize();for(var H=0,B=D.length;H<B;H++)M=D[H].clone(),a&&M.applyMatrix3(a).normalize(),O.vertexNormals.push(M);O.color.copy(A.color);for(var H=0,B=P.length;H<B;H++)_=P[H],O.vertexColors.push(_.clone());O.materialIndex=A.materialIndex,O.centroid.copy(A.centroid),u&&O.centroid.applyMatrix4(u),w.push(O)}for(x=0,T=g.length;x<T;x++){var A=g[x],O,M,_,D=A.vertexNormals,P=A.vertexColors;A instanceof C?O=new C(A.a+h,A.b+h,A.c+h):O=new k(A.a+h,A.b+h,A.c+h,A.d+h),O.normal.copy(A.normal),c&&O.normal.applyMatrix3(c).normalize();for(var H=0,B=D.length;H<B;H++)M=D[H].clone(),c&&M.applyMatrix3(c).normalize(),O.vertexNormals.push(M);O.color.copy(A.color);for(var H=0,B=P.length;H<B;H++)_=P[H],O.vertexColors.push(_.clone());O.materialIndex=A.materialIndex+o,O.centroid.copy(A.centroid),l&&O.centroid.applyMatrix4(l),w.push(O)}for(x=0,T=y.length;x<T;x++){var j=y[x],F=[];for(var H=0,B=j.length;H<B;H++)F.push(new s(j[H].x,j[H].y));S.push(F)}for(x=0,T=b.length;x<T;x++){var j=b[x],F=[];for(var H=0,B=j.length;H<B;H++)F.push(new s(j[H].x,j[H].y));S.push(F)}var I=new n.Entity;return I.vertices=E,I.faces=w,I.uvs=S,I.material=i===t?e.material:i,I},O.transformElement=function(e,t){var r,i,o=e.vertices,u=e.faces,a=e.uvs,l=[],c=[],h=[];e instanceof n.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,i=(new f).getNormalMatrix(r));for(var p=0,d=o.length;p<d;p++){var v=o[p],m=v.clone();r&&m.applyMatrix4(r),c.push(m)}for(p=0,d=u.length;p<d;p++){var g=u[p],y,b,w,E=g.vertexNormals,S=g.vertexColors;g instanceof C?y=new C(g.a,g.b,g.c):y=new k(g.a,g.b,g.c,g.d),y.normal.copy(g.normal),i&&y.normal.applyMatrix3(i).normalize();for(var x=0,T=E.length;x<T;x++)b=E[x].clone(),i&&b.applyMatrix3(i).normalize(),y.vertexNormals.push(b);y.color.copy(g.color);for(var x=0,T=S.length;x<T;x++)w=S[x],y.vertexColors.push(w.clone());y.materialIndex=g.materialIndex,y.centroid.copy(g.centroid),r&&y.centroid.applyMatrix4(r),l.push(y)}for(p=0,d=a.length;p<d;p++){var N=a[p],L=[];for(var x=0,T=N.length;x<T;x++)L.push(new s(N[x].x,N[x].y));h.push(L)}if(t){var A=new n.Entity(e.material);A.vertices=c,A.faces=l,A.uvs=h,A.setPosition(0,0,0),A.setRotation(0,0,0),A.setScale(1,1,1);var O={};return O.vertices=c,O.faces=l,O.uvs=h,A.primitive=new n.Primitive(O),A}e.vertices=c,e.faces=l,e.uvs=h,e.setPosition(0,0,0),e.setRotation(0,0,0),e.setScale(1,1,1);var O={};O.vertices=c,O.faces=l,O.uvs=h,e.primitive=new n.Primitive(O);for(var p in r.elements)e._attachId+=r.elements[p];return e},O.mergeElements=function(e){var t,r,i,u=0,a=0,l=0,c,h,p;for(t=0;t<e.length;t++)i=e[t],u+=i.materialSize;var d=new n.Entity(u),v={},m={},g=new o(0,0,0),y=[],b=[],w=[],E=[],S=new n.ArrayMaterial;for(t=0;t<e.length;t++){i=e[t],i.matrixAutoUpdate&&i.updateWorldMatrix(),c=i.worldMatrix.clone(),h=(new f).getNormalMatrix(c);for(r=0;r<i.vertices.length;r++)p=i.vertices[r],y.push(p.clone().applyMatrix4(c));for(r=0;r<i.faces.length;r++){var x=i.faces[r],T,N,L,A=x.vertexNormals,M=x.vertexColors;x instanceof C?T=new C(x.a+a,x.b+a,x.c+a):T=new k(x.a+a,x.b+a,x.c+a,x.d+a),T.normal.copy(x.normal),h&&T.normal.applyMatrix3(h).normalize(),T.materialIndex=x.materialIndex+l,T.centroid.copy(x.centroid),c&&T.centroid.applyMatrix4(c),b.push(T)}for(r=0,len=i.uvs.length;r<len;r++){var _=i.uvs[r],D=[];for(var P=0,H=_.length;P<H;P++)D.push(new s(_[P].x,_[P].y));w.push(D)}if(i.uv2s&&i.uv2s.length>0)for(r=0,len=i.uv2s.length;r<len;r++){var B=i.uv2s[r],j=[];for(var P=0,H=B.length;P<H;P++)j.push(new s(B[P].x,B[P].y));E.push(j)}S.materials=S.materials.concat(i.material.materials),a+=i.vertices.length,l+=i.materialSize;for(var F in i.styleMap){var I=v[F];I==null&&(I=[]);var q=i.styleMap[F],R=!0;if(O.isArray(q))for(var P=0;P<q.length;P++)I.push(q[t]),P>0&&q[P]!=q[P-1]&&(R=!1);else for(var P=0;P<i.materialSize;P++)I.push(q);if(m[F]==1||m[F]==null)m[F]=R;v[F]=I}}for(var F in m)m[F]==1&&(v[F]=v[F][0]);return d.styleMap=v,d.material=S,d.vertices=y,d.faces=b,d.setUvs(w),d.uv2s=E,d.setUpdateFlags(!0),d},O.mergeElement=function(e,r,i){var o,u,a,l,c=e.vertices.length,h=e.uvs.length,p=e.vertices,d=r.vertices,v=e.faces,m=r.faces,g=e.uvs,y=r.uvs,b=[],w=[],E=[];i===t&&(i=0),e instanceof n.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),o=e.matrix,u=(new f).getNormalMatrix(o)),r instanceof n.Element&&(r.matrixAutoUpdate&&r.updateMatrix(),a=r.matrix,l=(new f).getNormalMatrix(a));for(var S=0,x=p.length;S<x;S++){var T=p[S],N=T.clone();o&&N.applyMatrix4(o),w.push(N)}for(var S=0,x=d.length;S<x;S++){var T=d[S],N=T.clone();a&&N.applyMatrix4(a),w.push(N)}for(S=0,x=v.length;S<x;S++){var L=v[S],A,O,M,_=L.vertexNormals,D=L.vertexColors;L instanceof C?A=new C(L.a,L.b,L.c):A=new k(L.a,L.b,L.c,L.d),A.normal.copy(L.normal),u&&A.normal.applyMatrix3(u).normalize();for(var P=0,H=_.length;P<H;P++)O=_[P].clone(),u&&O.applyMatrix3(u).normalize(),A.vertexNormals.push(O);A.color.copy(L.color);for(var P=0,H=D.length;P<H;P++)M=D[P],A.vertexColors.push(M.clone());A.materialIndex=L.materialIndex,A.centroid.copy(L.centroid),o&&A.centroid.applyMatrix4(o),b.push(A)}for(S=0,x=m.length;S<x;S++){var L=m[S],A,O,M,_=L.vertexNormals,D=L.vertexColors;L instanceof C?A=new C(L.a+c,L.b+c,L.c+c):A=new k(L.a+c,L.b+c,L.c+c,L.d+c),A.normal.copy(L.normal),l&&A.normal.applyMatrix3(l).normalize();for(var P=0,H=_.length;P<H;P++)O=_[P].clone(),l&&O.applyMatrix3(l).normalize(),A.vertexNormals.push(O);A.color.copy(L.color);for(var P=0,H=D.length;P<H;P++)M=D[P],A.vertexColors.push(M.clone());A.materialIndex=L.materialIndex+i,A.centroid.copy(L.centroid),a&&A.centroid.applyMatrix4(a),b.push(A)}for(S=0,x=g.length;S<x;S++){var B=g[S],j=[];for(var P=0,H=B.length;P<H;P++)j.push(new s(B[P].x,B[P].y));E.push(j)}for(S=0,x=y.length;S<x;S++){var B=y[S],j=[];for(var P=0,H=B.length;P<H;P++)j.push(new s(B[P].x,B[P].y));E.push(j)}return e.vertices=w,e.faces=b,e.uvs=E,e._position.set(0,0,0),e._rotation.set(0,0,0),e._scale.set(1,1,1),e},O.autoAdjustNetworkBounds=function(t,n,r,i,s,o){s=s||0,o=o||0,t.adjustBounds(n[r]-s,n[i]-o),e.addEventListener?e.addEventListener("resize",function(){t.adjustBounds(n[r]-s,n[i]-o,o,s)},!0):e.attachEvent?e.attachEvent("onresize",function(
){t.adjustBounds(n[r]-s,n[i]-o,o,s)}):e.onresize=function(){t.adjustBounds(n[r]-s,n[i]-o,o,s)}},O.isEmptyObject=function(e){for(var t in e)return!1;return!0},O.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},O.isSame=function(e,t){if(e==t)return!0;if(e==null&&t!=null)return!1;if(e!=null&&t==null)return!1;for(var n in e)if(e[n]!=t[n])return!1;return!0},O.toString=function(e){if(e){var t="";for(var n in e)t+=n+":"+e[n];return t}},O.validateLicense=function(e){z=e,Mr()},O.getLicense=function(){return z},O.getObjectCount=function(e){if(!e)return 0;var t=0;for(var n in e)t++;return t},O.isNaN=function(e){return e===""||e===null||isNaN(e)},O.getTransformVertices=function(e,t,r){r==null&&(r=[]);var i,s;if(e instanceof n.Node||e instanceof n.Billboard){for(i=0;i<e.vertices.length;i++)s=e.vertices[i].clone(),e instanceof n.Billboard?(s.x*=e.rotation3d.x,s.y*=e.rotation3d.y,s.add(e.getPosition())):s.applyMatrix4(e.worldMatrix),r.push(s);for(var i=0;i<(e._childList?e._childList.size():0);i++){var o=e._childList.get(i);O.getTransformVertices(o,t,r)}}return r},O.getBoundingBox=function(e,t){var r,i,s,o,u;if(e==null)return null;e instanceof S?r=e._as:O.isArray(e)?r=e:r=[e];var a=[];for(i=0;i<r.length;i++)o=r[i],O.getTransformVertices(o,t,a);var f=new n.BoundingBox;return f.setFromPoints(a),f},O.mergeWrapMap=function(e){if(!(e instanceof L))return;if(e.getWrapMap())return;var t=[],n=e.getMaterialMapping(),r=e.material.materials,i;for(var s=0;s<r.length;s++)i=r[s],i.map&&t.indexOf(i.map._image)==-1&&t.push(i.map._image);e.setWrapMap(!0)},O.setWrapMap=function(e,t,n,r){O.loadImages(t,function(i){var s=mono.Utils.createWrapMapFromImages(i,n,r);s.__uniqueCode="";for(var o=0;o<t.length;o++)s.__uniqueCode+=t[o].src;for(var o in n)s.__uniqueCode+=o+":"+n[o];if(O.isArray(e))for(var o=0;o<e.length;o++)e[o].setStyle("m.texture.image",s),e[o].setClient("_originalImage",t),e[o].setClient("_wrapMapping",n);else e.setStyle("m.texture.image",s),e.setClient("_wrapMapping",n)})},O.loadImages=function(e,t){function i(e){e.onload=function(){e.loaded=!0,s(),e.onload=null}}function s(){for(var n=0;n<e.length;n++)if(!e[n].loaded)return;t(e)}if(e==null||e.length==0||t==null)return;for(var n=0;n<e.length;n++){var r=e[n];typeof r=="string"&&(e[n]=new Image,e[n].crossOrigin="",e[n].src=r),r=e[n],i(r)}},O.createWrapMapFromImages=function(e,t,n,r,i){if(e==null||e.length==0)return null;n=(n||"six-each").toLowerCase();var s=n=="six-each"||n=="front-other"||n=="back-other"||n=="left-other"||n=="right-other"||n=="top-other"||n=="bottom-other";if(!s)return;t==null&&(t={0:"bottom",1:"top",2:"back",3:"left",4:"front",5:"right"});var o=document.createElement("canvas"),u=o.getContext("2d"),a=0,f=0;if(n=="six-each"){var l={bottom:[0,0],top:[1/3,0],back:[2/3,0],left:[0,.5],front:[1/3,.5],right:[2/3,.5]};if(r==null||i==null)for(var c=0;c<e.length;c++)a=Math.max(e[c].width,a),f=Math.max(e[c].height,f);a*=3,f*=2,a>1024&&(a=1024),f>1024&&(f=1024);var h=["front","back","right","left","top","bottom"],p=[],d;for(var c in t){var v=t[c];v!=="other"?(p.push(v),h.splice(h.indexOf(v),1)):d=c}d!=null&&(t[d]=h),r=r||a,i=i||f,o.setAttribute("width",r),o.setAttribute("height",i);var m=Math.min(e.length,6);for(var c=0;c<6;c++){var g=t[c];if(g){var y=g;O.isArray(g)?y=g:g.indexOf(",")!=-1?y=g.split(","):y=[g];for(var b=0;b<y.length;b++){var v=y[b],w=l[v][0],E=l[v][1];u.drawImage(e[c],w*r,E*i,r/3,i/2)}}}}else{var S=n.split("-")[0];if(r==null||i==null)for(var c=0;c<e.length;c++)a+=e[c].width,f=Math.max(e[c].height,f);r=r||a,i=i||f,o.setAttribute("width",r),o.setAttribute("height",i);var x=t[S],m=Math.min(e.length,2);for(var c=0;c<2;c++){var g=t[c];g&&(g==S?u.drawImage(e[c],0,0,r/2,i):u.drawImage(e[c],r/2,0,r/2,i))}}return o},O.getPixelFromImage=function(e,t,n){var r;$html.isCanvas(e)?r=e:(r=document.createElement("canvas"),r.width=e.width,r.height=e.height,r.getContext("2d").drawImage(e,0,0,e.width,e.height)),t-=Math.floor(t),n-=Math.floor(n),n=1-n;var i=r.getContext("2d").getImageData(e.width*t,e.height*n,1,1).data;return i},O.createTextBillboard=function(e,t,n,r){},O.createTextImage=function(e){},n.Utils=O,n.GLParameters=function(e,t,r){this.material=e,this.network=t,this.precision=t._precision,this.map=!!e.map,this.mapLoaded=!0,this.envMap=!!e.envMap,this.lightMap=!!e.lightMap,this.bumpMap=!!e.bumpMap,this.normalMap=!!e.normalMap,this.specularMap=!!e.specularMap,this.vertexColors=e.vertexColors,this.fog=t._fog,this.useFog=e.fog,this.fogExp=this.fog instanceof n.FogExp2,this.sizeAttenuation=e.sizeAttenuation,this.skinning=e.skinning,this.maxBones=t.maxBones,this.useVertexTexture=t._supportsBoneTextures&&r&&r.useVertexTexture,this.boneTextureWidth=r&&r.boneTextureWidth,this.boneTextureHeight=r&&r.boneTextureHeight,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.maxMorphTargets=t.maxMorphTargets,this.maxMorphNormals=t.maxMorphNormals,this.maxDirLights=t.maxLightCount.directional,this.maxPointLights=t.maxLightCount.point,this.maxSpotLights=t.maxLightCount.spot,this.maxHemiLights=t.maxLightCount.hemi,this.maxShadows=t.maxShadows,this.maxPointShadows=t.maxPointShadows,this.shadowMapEnable=t._shadowMapEnable&&r.receiveShadow&&this.maxShadows>0,this.pointShadowMapEnable=t._shadowMapEnable&&r.receiveShadow&&this.maxPointShadows>0,this.shadowMapType=t.shadowMapType,this.shadowMapDebug=t.shadowMapDebug,this.shadowMapCascade=t.shadowMapCascade,this.alphaTest=e.alphaTest,this.metal=e.metal,this.perPixel=e.perPixel,this.wrapAround=e.wrapAround,this.doubleSided=e.side===n.DoubleSide&&!h.isIE,this.flipSided=e.side===n.BackSide,this.useSSAO=t.isSSAOEnable()&&t.pm.isLightMaterial(e),this.gammaInput=t.gammaInput,this.gammaOutput=t.gammaOutput,this.physicallyBasedShading=t.physicallyBasedShading,this.supportsVertexTextures=!1,this.shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC",this.shadowMapType===n.PCFShadowMap?this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF":this.shadowMapType===n.PCFSoftShadowMap&&(this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"),this.maxGrandient=O.getObjectCount(e.gradient)},n.GLParameters.prototype.getShaders=function(e){e=e===t?"":e;var n=this,r=["precision "+n.precision+" float;",e,this.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.gammaInput?"#define GAMMA_INPUT":"",n.gammaOutput?"#define GAMMA_OUTPUT":"",n.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_POINT_SHADOWS "+n.maxPointShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.maxGrandient>0?"#define MAX_GRADIENT "+n.maxGrandient:"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.boneTextureWidth?"#define N_BONE_PIXEL_X "+n.boneTextureWidth.toFixed(1):"",n.boneTextureHeight?"#define N_BONE_PIXEL_Y "+n.boneTextureHeight.toFixed(1):"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnable?"#define USE_SHADOWMAP":"",n.shadowMapEnable?"#define "+n.shadowMapTypeDefine:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),i=["precision "+this.precision+" float;",n.bumpMap||n.normalMap?"#extension GL_OES_standard_derivatives : enable":"",e,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_POINT_SHADOWS "+n.maxPointShadows,n.useSSAO?"#define USE_SSAO":"",n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",this.gammaInput?"#define GAMMA_INPUT":"",this.gammaOutput?"#define GAMMA_OUTPUT":"",this.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.maxGrandient>0?"#define MAX_GRADIENT "+n.maxGrandient:"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.perPixel?"#define PHONG_PER_PIXEL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnable?"#define USE_SHADOWMAP":"",n.shadowMapEnable?"#define "+n.shadowMapTypeDefine:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");return[r,i]};var M={};M.setDepthTest=function(e,t){var n=t._gl;t._oldDepthTest!==e&&(e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),t._oldDepthTest=e)},M.setSmapleAlphaToCoverage=function(e,t){var n=t._gl;t._oldSmapleAlphaToCoverage!==e&&(e?n.enable(n.SAMPLE_ALPHA_TO_COVERAGE):n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),t._oldSmapleAlphaToCoverage=e)},M.setDepthWrite=function(e,t){var n=t._gl;t._oldDepthWrite!==e&&(n.depthMask(e),t._oldDepthWrite=e)},M.clear=function(e,n,r,i){var s=i._gl,o=0;if(e===t||e)o|=s.COLOR_BUFFER_BIT;if(n===t||n)o|=s.DEPTH_BUFFER_BIT;if(r===t||r)o|=s.STENCIL_BUFFER_BIT;i._gl.clear(o)},M.setPolygonOffset=function(e,t,n,r){var i=r._gl;r._oldPolygonOffset!==e&&(e?i.enable(i.POLYGON_OFFSET_FILL):i.disable(i.POLYGON_OFFSET_FILL),r._oldPolygonOffset=e),e&&(r._oldPolygonOffsetFactor!==t||r._oldPolygonOffsetUnits!==n)&&(i.polygonOffset(t,n),r._oldPolygonOffsetFactor=t,r._oldPolygonOffsetUnits=n)},M.setBlending=function(e,t,r,i,s){var o=s._gl;e!==s._oldBlending&&(e===n.NoBlending?o.disable(o.BLEND):e===n.AdditiveBlending?(o.enable(o.BLEND),o.blendEquation(o.FUNC_ADD),o.blendFunc(o.SRC_ALPHA,o.ONE)):e===n.SubtractiveBlending?(o.enable(o.BLEND),o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ZERO,o.ONE_MINUS_SRC_COLOR)):e===n.MultiplyBlending?(o.enable(o.BLEND),o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ZERO,o.SRC_COLOR)):e===n.CustomBlending?o.enable(o.BLEND):(o.enable(o.BLEND),o.blendEquationSeparate(o.FUNC_ADD,o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)),s._oldBlending=e);if(e===n.CustomBlending){t!==this._oldBlendEquation&&(o.blendEquation(paramThreeToGL(t)),s._oldBlendEquation=t);if(r!==_oldBlendSrc||i!==_oldBlendDst)o.blendFunc(paramToGL(r),paramToGL(i)),s._oldBlendSrc=r,s._oldBlendDst=i}else s._oldBlendEquation=null,s._oldBlendSrc=null,s._oldBlendDst=null},M.enableStencil=function(e){e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.stencilMask(1),e.clearStencil(0),e.clear(e.STENCIL_BUFFER_BIT)},M.stencilTest=function(e){e.enable(e.STENCIL_TEST),e.stencilFunc(e.EQUAL,0,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilMask(0)},M.disableStencil=function(e){e.disable(e.STENCIL_TEST)},M.r=function(e,t,n,r,i,s,o){e._AK47(t,n,r,i,s,o)},M.g=function(e,t,n,r,i,s){e.renderGroup(t,n,r,i,s)},n.GLUtils=M,n.GPU=function(e){var t=e._gl;this._glExtensionTextureFloat=t.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=t.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("Float textures not supported."),this._glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this._maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this._maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxAnisotropy=this._glExtensionTextureFilterAnisotropic?t.getParameter(this._glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._supportsVertexTextures=this._maxVertexTextures>0,this._supportsBoneTextures=this._supportsVertexTextures&&this._glExtensionTextureFloat,this._compressedTextureFormats=this._glExtensionCompressedTextureS3TC?t.getParameter(t.COMPRESSED_TEXTURE_FORMATS):[],this._vertexShaderPrecisionHighpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),this._vertexShaderPrecisionMediumpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT),this._vertexShaderPrecisionLowpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_FLOAT),this._fragmentShaderPrecisionHighpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),this._fragmentShaderPrecisionMediumpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT),this._fragmentShaderPrecisionLowpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_FLOAT),this._vertexShaderPrecisionHighpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_INT),this._vertexShaderPrecisionMediumpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_INT),this._vertexShaderPrecisionLowpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_INT),this._fragmentShaderPrecisionHighpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_INT),this._fragmentShaderPrecisionMediumpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_INT),this._fragmentShaderPrecisionLowpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_INT);var n=this._vertexShaderPrecisionHighpFloat.precision>0&&this._fragmentShaderPrecisionHighpFloat.precision>0,r=this._vertexShaderPrecisionMediumpFloat.precision>0&&this._fragmentShaderPrecisionMediumpFloat.precision>0,i=e._precision;i==="highp"&&!n&&(r?(i="mediump",console.log("highp not supported, using mediump")):(i="lowp",console.log("highp and mediump not supported, using lowp"))),i==="mediump"&&!r&&(i="lowp",console.log("mediump not supported, using lowp")),e._precision=i},n.Program=function(e,t,n,r){this.entity=e,this.group=t,this.material=n,this.network=r},n.Program.prototype.setEntity=function(){this.entity},n.Program.prototype.buildGLProgram=function(){},n.Uniform=function(e,n,r){this.id=e,this.type=n,this.value=r,this.location=t},n.Uniform.prototype={constructor:n.Uniform,setValue:function(e){this.value=e},getUniformLocation:function(e,t){return e.getUniformLocation(this.id)}},n.Uniform.loadUniform=function(e,n,r){type=n.type,value=n.value;if(type==="i")r.uniform1i(e,value);else if(type==="f")r.uniform1f(e,value);else if(type==="v2")r.uniform2f(e,value.x,value.y);else if(type==="v3")r.uniform3f(e,value.x,value.y,value.z);else if(type==="v4")r.uniform4f(e,value.x,value.y,value.z,value.w);else if(type==="c")r.uniform3f(e,value.r,value.g,value.b);else if(type==="iv1")r.uniform1iv(e,value);else if(type==="iv")r.uniform3iv(e,value);else if(type==="fv1")r.uniform1fv(e,value);else if(type==="fv")r.uniform3fv(e,value);else if(type==="v2v"){n._array===t&&(n._array=new Float32Array(2*value.length));for(i=0,il=value.length;i<il;i++)offset=i*2,n._array[offset]=value[i].x,n._array[offset+1]=value[i].y;r.uniform2fv(e,n._array)}else if(type==="v3v"){n._array===t&&(n._array=new Float32Array(3*value.length));for(i=0,il=value.length;i<il;i++)offset=i*3,n._array[offset]=value[i].x,n._array[offset+1]=value[i].y,n._array[offset+2]=value[i].z;r.uniform3fv(e,n._array)}else if(type==="v4v"){n._array===t&&(n._array=new Float32Array(4*value.length));for(i=0,il=value.length;i<il;i++)offset=i*4,n._array[offset]=value[i].x,n._array[offset+1]=value[i].y,n._array[offset+2]=value[i].z,n._array[offset+3]=value[i].w;r.uniform4fv(e,n._array)}else if(type==="m4")n._array===t&&(n._array=new Float32Array(16)),value.flattenToArray(n._array),r.uniformMatrix4fv(e,!1,n._array);else if(type==="m4v"){n._array===t&&(n._array=new Float32Array(16*value.length));for(i=0,il=value.length;i<il;i++)value[i].flattenToArrayOffset(n._array,i*16);r.uniformMatrix4fv(e,!1,n._array)}else if(type==="t")texture=value,textureUnit=getTextureUnit(),r.uniform1i(e,textureUnit),!texture||(texture.image instanceof Array&&texture.image.length===6?setCubeTexture(texture,textureUnit):texture instanceof $CubeRenderTargetCube?setCubeTextureDynamic(texture,textureUnit):_this.setTexture(texture,textureUnit));else if(type==="tv"){n._array===t&&(n._array=[]);for(i=0,il=n.value.length;i<il;i++)n._array[i]=getTextureUnit();r.uniform1iv(e,n._array);for(i=0,il=n.value.length;i<il;i++){texture=n.value[i],textureUnit=n._array[i];if(!texture)continue;_this.setTexture(texture,textureUnit)}}},n.Uniform.loadGeneralUniforms=function(e,t,r){var i,s,o,u,a,f,l,c,h,p,d;for(h=0,p=t.length;h<p;h++){u=e.uniforms[t[h][1]];if(!u)continue;i=t[h][0],n.Uniform.loadUniform(i,r)}},n.ProgramManager=function(e){this.id=n.ProgramManagerId++,n.ProgramManagerCache.count++,this.network=e,this.gl=this.network._gl,this.gpu=this.network.gpu,this.programs=[],this.currentProgram=null,this.currentEntity=null,this.currentGroup=null,this.currentMaterial=null,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.textures=[],this.textureCount=0,this._lightNeedsUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},this.gammaInput=!1,this.textureCount=0,this.programMap={},this.textureMap={},this.textureUpdateFlags={},this.glTextureMap={},this.textureMaterialMap={},this.unLoadedImage={},this.materialMap={},this.materialUpdateFlags={},this.handleTextureChange=function(e){if(e.property==="image"||e.property==="loaded"){var t=e.source;this.changeTextureUpdateFlags(t,!0),delete this.unLoadedImage[t._image]}else if(e.property==="disposed"){var t=e.source;this.deallocateTexture(t),t.removePropertyChangeListener(this.handleTextureChange),delete this.textureUpdateFlags[t.id],delete this.textureMap[t.id]}O.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()},this.handleMaterialChange=function(e){if(e.property==="map"||e.property==="needsUpdate"){var t=e.source;this.materialUpdateFlags[t.id]=!0}else if(e.property==="disposed"){var t=e.source;this.deallocateMaterial(t),t.removePropertyChangeListener(this.handleMaterialChange),delete this.materialUpdateFlags[t.id],delete this.materialMap[t.id]}O.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()}},n.ProgramManager.prototype.addMaterial=function(e){this.materialMap[e.id]==null&&(this.materialMap[e.id]=e,e.addPropertyChangeListener(this.handleMaterialChange,this))},n.ProgramManager.prototype.needsUpdateMaterial=function(e){return this.materialUpdateFlags[e.id]===t||this.materialUpdateFlags[e.id]===!0?!0:e.map instanceof q||e.map instanceof $CubeRendererTarget?!0:!1},n.ProgramManager.prototype.changeMaterialUpdateFlags=function(e,t){this.materialUpdateFlags[e.id]=t},n.ProgramManager.prototype.isLightMaterial=function(e){return e instanceof n.LambertMaterial||e instanceof n.PhongMaterial||e.lights||e._type==="lambert"||e._type==="phong"||e._type==="terrain"},n.ProgramManager.prototype.changeAllMaterialUpdateFlags=function(e,t,n){for(var r in this.materialMap){var i=this.materialMap[r];if(t==null||t.call(n,i))this.materialUpdateFlags[i.id]=e}},n.ProgramManager.prototype.changeAllLightMaterialUpdateFlags=function(e){this.changeAllMaterialUpdateFlags(e,this.isLightMaterial,this)},n.ProgramManager.prototype.addTexture=function(e){e.id!=null&&this.textureMap[e.id]===t&&(this.textureMap[e.id]=e,e.addPropertyChangeListener(this.handleTextureChange,this),e._image.loaded||(this.unLoadedImage[e._image]=1))},n.ProgramManager.prototype.needsUpdateTexture=function(e){return this.textureUpdateFlags[e.id]===t||this.textureUpdateFlags[e.id]===!0?!0:!1},n.ProgramManager.prototype.changeTextureUpdateFlags=function(e,t){this.textureUpdateFlags[e.id]=t;for(var n in this.materialMap){var r=this.materialMap[n];(r.map===e||r.envMap===e||r.normalMap===e||r.specularMap===e)&&this.changeMaterialUpdateFlags(r,!0)}},n.ProgramManager.prototype.buildProgram=function(e,t,r){this.currentEntity=e,this.currentGroup=t,this.currentMaterial=r,r.shaderID||r.setupMaterialShader();var i=new n.GLParameters(this.currentMaterial,this.network,e),s,o,u,a,f=[];r.shaderID?f.push(r.shaderID):(f.push(r.vertexShader),f.push(r.fragmentShader));for(Br in i)Br!=="material"&&Br!=="network"&&Br!=="node"&&(f.push(Br),f.push(i[Br]));a=f.join();for(s=0,o=this.programs.length;s<o;s++)if(this.programs[s].code===a){r.program=this.programs[s].program,r.uniformsList=[];for(d in r.uniforms)r.uniformsList.push([r.uniforms[d],d]);return this.programs[s].usedTimes++,this.programs[s].program}u=this.gl.createProgram();var l=i.getShaders(),c=l[1],h=l[0];this.gl.attachShader(u,H("fragment",c+r.fragmentShader,this.gl)),this.gl.attachShader(u,H("vertex",h+r.vertexShader,this.gl)),this.gl.linkProgram(u),this.gl.getProgramParameter(u,this.gl.LINK_STATUS)||console.log("Could not initialise shader\nVALIDATE_STATUS: "+this.gl.getProgramParameter(u,this.gl.VALIDATE_STATUS)+", gl error ["+this.gl.getError()+"]"),u.uniforms={},u.attributes={};var p,d,v,s;p=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(d in r.uniforms)p.push(d);this.attachGLLocations(u,p,"uniform"),p=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(s=0;s<i.maxMorphTargets;s++)p.push("morphTarget"+s);for(s=0;s<i.maxMorphNormals;s++)p.push("morphNormal"+s);for(v in r.attributes)p.push(v);this.attachGLLocations(u,p,"attribute"),u.id=this.programs.length,this.programs.push({program:u,code:a,usedTimes:1}),this.info.memory.programCount=this.programs.length,r.program=u,r.uniformsList=[];for(d in r.uniforms)r.uniformsList.push([r.uniforms[d],d]);return u},n.ProgramManager.prototype.enableAttribute=function(e,n){var r=n.program.attributes;r.position>=0&&_gl.enableVertexAttribArray(r.position),r.color>=0&&_gl.enableVertexAttribArray(r.color),r.normal>=0&&_gl.enableVertexAttribArray(r.normal);if(n.attributes)for(a in n.attributes)r[a]!==t&&r[a]>=0&&_gl.enableVertexAttribArray(r[a])},n.ProgramManager.prototype.attachGLLocations=function(e,t,n){var r,i,s,o=this.gl;if(n==="uniform")for(r=0,i=t.length;r<i;r++)s=t[r],e.uniforms[s]=o.getUniformLocation(e,s);else if(n==="attribute")for(r=0,i=t.length;r<i;r++)s=t[r],e.attributes[s]=o.getAttribLocation(e,s)},n.ProgramManager.prototype.getGLShaders=function(e,t){var n;return e==="fragment"?n=this.gl.createShader(this.gl.FRAGMENT_SHADER):tpye==="vertex"&&(n=this.gl.createShader(this.gl.VERTEX_SHADER)),this.gl.shaderSource(n,string),this.gl.compileShader(n),gl.getShaderParameter(n,gl.COMPILE_STATUS)?n:(console.log(gl.getShaderInfoLog(n)),console.log(string),null)},n.ProgramManager.prototype.setProgram=function(e,t,r,i,s,o){this.textureCount=0,this.addMaterial(i);if(this.needsUpdateMaterial(i)){i.setupMaterialShader(),this.programMap[i.id]&&this.deallocateMaterial(i);var u=this.buildProgram(o,s,i);this.programMap[i.id]=u,this.changeMaterialUpdateFlags(i,!1)}var a=!1,f=this.programMap[i.id],l=f.uniforms,c=i.uniforms;f!=this.currentProgram&&(this.gl.useProgram(f),this.currentProgram=f,a=!0),i.id!==this.currentMaterialId&&(this.currentMaterialId=i.id,a=!0);if(a||e!==this.network._currentCamera)this.gl.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),e!==this.network._currentCamera&&(this.network._currentCamera=e);r&&i.fog&&r.refreshUniforms(c);if(i instanceof n.PhongMaterial||i instanceof n.LambertMaterial||i.lights||i._type==="phong"||i._type==="lambert"||i._type==="terrain")this._lightNeedsUpdate&&(this.setupLights(f,t),this._lightNeedsUpdate=!1),B(c,this._lights);return a&&i.refreshUniforms(!1,{camera:this.network._camera}),o.receiveShadow&&!i._shadowPass&&this.network.isShadowable()&&(_(c,t),D(c,t)),a&&this.loadUniformsGeneric(f,i.uniformsList,i),i.loadCameraPosition(l,e,this.gl),(i instanceof n.PhongMaterial||i instanceof n.LambertMaterial||i.skinning||i._type==="phong"||i._type==="lambert"||i._type==="terrain"||i instanceof n.ShaderMaterial)&&l.viewMatrix!==null&&this.gl.uniformMatrix4fv(l.viewMatrix,!1,e.worldMatrixInverse.elements),P(l,o,this.gl),l.modelMatrix!=null&&this.gl.uniformMatrix4fv(l.modelMatrix,!1,o.worldMatrix.elements),this.network._baseRender&&this.loadSSAOUniforms(l,i,a),f},n.ProgramManager.prototype.loadSSAOUniforms=function(e,t,n){if(e.mapSSAO!=null&&this.network._sSAOEnable){var r=e.mapSSAO,i=n?this.getTextureUnit():t._ssaoSlot;this.gl.uniform1i(r,i),this.setTexture(this.network.finalSSAOTarget,i),t._ssaoSlot=i}},n.ProgramManager.prototype.onTextureDispose=function(e){var t=e.target;t.removeEventListener("dispose",onTextureDispose),deallocateTexture(t),this.info.memory.textures--},n.ProgramManager.prototype.deallocateTexture=function(e){var t=this.gl;if(e._image&&e._image.__webglTextureCube)t.deleteTexture(e._image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,t.deleteTexture(e.__webglTexture)}},n.ProgramManager.prototype.setTextureParameters=function(e,t,r,i){var s=this.gl,o=this.gpu,u=n.Utils.paramToGL;r&&!i?(s.texParameteri(e,s.TEXTURE_WRAP_S,u(t.wrapS,s)),s.texParameteri(e,s.TEXTURE_WRAP_T,u(t.wrapT,s)),s.texParameteri(e,s.TEXTURE_MAG_FILTER,u(t.magFilter,s)),s.texParameteri(e,s.TEXTURE_MIN_FILTER,u(t.minFilter,s))):(s.texParameteri(e,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(e,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(e,s.TEXTURE_MAG_FILTER,this.filterFallback(t.magFilter)),s.texParameteri(e,s.TEXTURE_MIN_FILTER,this.filterFallback(t.minFilter))),o._glExtensionTextureFilterAnisotropic&&t.type!==n.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(s.texParameterf(e,o._glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,o._maxAnisotropy)),t.__oldAnisotropy=t.anisotropy)},n.ProgramManager.prototype.setCubeTexture=function(e,t){var r=this.gl;this.addTexture(e);if(e._image.length===6){if(!e._image.loaded)return;var i=n.Utils.isPowerOfTwo,s=n.Utils.paramToGL;if(this.needsUpdateTexture(e)){e._image.__webglTextureCube||(e._image.__webglTextureCube=r.createTexture(),this.info.memory.textures++),this.changeTextureUpdateFlags(e,!1),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_CUBE_MAP,e._image.__webglTextureCube),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY);var o=e instanceof n.CompressedTexture,u=[];for(var a=0;a<6;a++)this.autoScaleCubemaps&&!o?u[a]=clampToMaxSize(e._image[a],_maxCubemapSize):u[a]=e._image[a];var f=u[0],l=i(f.width)&&i(f.height),c=s(e.format,r),h=s(e.type,r);this.setTextureParameters(r.TEXTURE_CUBE_MAP,e,l);for(var a=0;a<6;a++)if(o){var p,d=u[a].mipmaps;for(var v=0,m=d.length;v<m;v++)p=d[v],r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+a,v,c,p.width,p.height,0,p.data)}else r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,c,c,h,u[a]);e.generateMipmaps&&l&&r.generateMipmap(r.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_CUBE_MAP,e._image.__webglTextureCube)}},n.ProgramManager.prototype.setCubeTextureDynamic=function(e,t){var n=this.gl;n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_CUBE_MAP,e.__webglTexture)},n.ProgramManager.prototype.loadUniformsGeneric=function(e,r,i){var s=this.gl,o,u,a,f,l,c,h,p,d,v,m;for(d=0,v=r.length;d<v;d++){f=e.uniforms[r[d][1]];if(!f)continue;o=r[d][0],a=o.type,u=o.value;if(a==="i")s.uniform1i(f,u);else if(a==="f")s.uniform1f(f,u);else if(a==="v2")s.uniform2f(f,u.x,u.y);else if(a==="v3")s.uniform3f(f,u.x,u.y,u.z);else if(a==="v4")s.uniform4f(f,u.x,u.y,u.z,u.w);else if(a==="c")s.uniform3f(f,u.r,u.g,u.b);else if(a==="iv1")s.uniform1iv(f,u);else if(a==="iv")s.uniform3iv(f,u);else if(a==="fv1")s.uniform1fv(f,u);else if(a==="fv")s.uniform3fv(f,u);else if(a==="v2v"){o._array===t&&(o._array=new Float32Array(2*u.length));for(h=0,p=u.length;h<p;h++)m=h*2,o._array[m]=u[h].x,o._array[m+1]=u[h].y;s.uniform2fv(f,o._array)}else if(a==="v3v"){o._array===t&&(o._array=new Float32Array(3*u.length));for(h=0,p=u.length;h<p;h++)m=h*3,u[h]instanceof n.Color?(o._array[m]=u[h].r,o._array[m+1]=u[h].g,o._array[m+2]=u[h].b):(o._array[m]=u[h].x,o._array[m+1]=u[h].y,o._array[m+2]=u[h].z);s.uniform3fv(f,o._array)}else if(a==="v4v"){o._array===t&&(o._array=new Float32Array(4*u.length));for(h=0,p=u.length;h<p;h++)m=h*4,o._array[m]=u[h].x,o._array[m+1]=u[h].y,o._array[m+2]=u[h].z,o._array[m+3]=u[h].w;s.uniform4fv(f,o._array)}else if(a==="m4")o._array===t&&(o._array=new Float32Array(16)),u.flattenToArray(o._array),s.uniformMatrix4fv(f,!1,o._array);else if(a==="m4v"){o._array===t&&(o._array=new Float32Array(16*u.length));for(h=0,p=u.length;h<p;h++)u[h].flattenToArrayOffset(o._array,h*16);s.uniformMatrix4fv(f,!1,o._array)}else if(a==="t"){l=u,c=this.getTextureUnit(),s.uniform1i(f,c);if(!l)continue;if(l._image instanceof Array&&l._image.length===6)this.setCubeTexture(l,c);else{var g=l._image;this.setTexture(l,c,g?!g.loaded:!0)}}else if(a==="tv"){o._array===t&&(o._array=[]);for(h=0,p=o.value.length;h<p;h++)o._array[h]=this.getTextureUnit();s.uniform1iv(f,o._array);for(h=0,p=o.value.length;h<p;h++){l=o.value[h],c=o._array[h];if(!l)continue;var g=l._image;l instanceof $CubeRendererTarget?this.setCubeTextureDynamic(l,c):this.setTexture(l,c,g?!g.loaded:!0)}}}},n.ProgramManager.prototype.setTexture=function(e,r,i){var s=this.gl,o=n.Utils.isPowerOfTwo,u=e.id;this.addTexture(e);if(!this.needsUpdateTexture(e)||e instanceof q)s.activeTexture(s.TEXTURE0+r),e instanceof q?s.bindTexture(s.TEXTURE_2D,e.__webglTexture):s.bindTexture(s.TEXTURE_2D,this.glTextureMap[u]);else{if(!e._image)return;delete this.glTextureMap[u],this.glTextureMap[u]===t&&(this.glTextureMap[u]=s.createTexture(),this.info.memory.textures++),this.changeTextureUpdateFlags(e,!1),s.activeTexture(s.TEXTURE0+r),s.bindTexture(s.TEXTURE_2D,this.glTextureMap[u]),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!e.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,e.unpackAlignment);var a=n.Utils.paramToGL,f=i?n.ImageCache.Logo:e._image,l=o(f.width)&&o(f.height),c=a(e.format,s),h=a(e.type,s);this.setTextureParameters(s.TEXTURE_2D,e,l,i);var p,d=e.mipmaps;if(e instanceof n.PixelsTexture)if(d.length>0&&l){for(var v=0,m=d.length;v<m;v++)p=d[v],s.texImage2D(s.TEXTURE_2D,v,c,p.width,p.height,0,c,h,p.data);e.generateMipmaps=!1}else s.texImage2D(s.TEXTURE_2D,0,c,f.width,f.height,0,c,h,f.data);else if(e instanceof n.CompressedTexture)for(var v=0,m=d.length;v<m;v++)p=d[v],s.compressedTexImage2D(s.TEXTURE_2D,v,c,p.width,p.height,0,p.data);else if(d.length>0&&l){for(var v=0,m=d.length;v<m;v++)p=d[v],s.texImage2D(s.TEXTURE_2D,v,c,c,h,p);e.generateMipmaps=!1}else try{s.texImage2D(s.TEXTURE_2D,0,c,c,h
,f)}catch(g){console.log(g)}e.generateMipmaps&&l&&s.generateMipmap(s.TEXTURE_2D),e.onUpdate&&e.onUpdate()}},n.ProgramManager.prototype.getTextureUnit=function(){var e=this.textureCount;return e>=this.gpu._maxTextures&&console.warn("Network3D: trying to use "+e+" texture units while this GPU supports only "+this.gpu._maxTextures),this.textureCount++,e},n.ProgramManager.prototype.deallocateMaterial=function(e){var n=e.program;if(n===t)return;e.program=t;var r,i,s,o=!1;for(r=0,i=this.programs.length;r<i;r++){s=this.programs[r];if(s.program===n){s.usedTimes--,s.usedTimes===0&&(o=!0);break}}if(o===!0){var u=[];for(r=0,i=this.programs.length;r<i;r++)s=this.programs[r],s.program!==n&&u.push(s);this.programs=u,this.gl.deleteProgram(n),this.info.memory.programs--}},n.ProgramManager.prototype.filterFallback=function(e){return e===n.NearestFilter||e===n.NearestMipMapNearestFilter||e===n.NearestMipMapLinearFilter?this.gl.NEAREST:this.gl.LINEAR},n.ProgramManager.prototype.setupLights=function(e,t){var r,i,s,o,u=0,a=0,f=0,l,c,h,p,d,v,m,g=this._lights,y=g.directional.colors,b=g.directional.positions,w=g.point.colors,E=g.point.positions,S=g.point.distances,x=g.spot.colors,T=g.spot.positions,N=g.spot.distances,C=g.spot.directions,k=g.spot.anglesCos,L=g.spot.exponents,A=g.hemi.skyColors,O=g.hemi.groundColors,M=g.hemi.positions,_=0,D=0,P=0,H=0,B=0,j=0,q=0,R=0,U=0,z=0,W=0,X=0,V=new n.Vec3;for(r=0,i=t.size();r<i;r++){s=t.get(r);if(s.onlyShadow)continue;l=s.color,p=s.intensity,m=s.distance,s.updateWorldMatrix(!0);if(s instanceof n.AmbientLight){if(!s._visible)continue;this.gammaInput?(u+=l.r*l.r,a+=l.g*l.g,f+=l.b*l.b):(u+=l.r,a+=l.g,f+=l.b)}else if(s instanceof n.DirectionalLight){B+=1;if(!s._visible)continue;s.direction?V.copy(s.direction):(V.copy(s.worldMatrix.getPosition()),V.sub(s.target.worldMatrix.getPosition())),V.normalize();if(V.x===0&&V.y===0&&V.z===0)continue;U=_*3,b[U]=V.x,b[U+1]=V.y,b[U+2]=V.z,this.gammaInput?I(y,U,l,p*p):F(y,U,l,p),_+=1}else if(s instanceof n.PointLight){j+=1;if(!s._visible)continue;z=D*3,this.gammaInput?I(w,z,l,p*p):F(w,z,l,p),v=s.worldMatrix.getPosition(),E[z]=v.x,E[z+1]=v.y,E[z+2]=v.z,S[D]=m,D+=1}else if(s instanceof n.SpotLight){q+=1;if(!s._visible)continue;W=P*3,this.gammaInput?I(x,W,l,p*p):F(x,W,l,p),v=s.worldMatrix.getPosition(),T[W]=v.x,T[W+1]=v.y,T[W+2]=v.z,N[P]=m,V.copy(v),V.sub(s.target.worldMatrix.getPosition()),V.normalize(),C[W]=V.x,C[W+1]=V.y,C[W+2]=V.z,k[P]=Math.cos(s.angle),L[P]=s.exponent,P+=1}else if(s instanceof n.HemisphereLight){R+=1;if(!s._visible)continue;V.copy(s.worldMatrix.getPosition()),V.normalize();if(V.x===0&&V.y===0&&V.z===0)continue;X=H*3,M[X]=V.x,M[X+1]=V.y,M[X+2]=V.z,c=s.color,h=s.groundColor,this.gammaInput?(d=p*p,I(A,X,c,d),I(O,X,h,d)):(F(A,X,c,p),F(O,X,h,p)),H+=1}}for(r=_*3,i=Math.max(y.length,B*3);r<i;r++)y[r]=0;for(r=D*3,i=Math.max(w.length,j*3);r<i;r++)w[r]=0;for(r=P*3,i=Math.max(x.length,q*3);r<i;r++)x[r]=0;for(r=H*3,i=Math.max(A.length,R*3);r<i;r++)A[r]=0;for(r=H*3,i=Math.max(O.length,R*3);r<i;r++)O[r]=0;g.directional.length=_,g.point.length=D,g.spot.length=P,g.hemi.length=H,g.ambient[0]=u,g.ambient[1]=a,g.ambient[2]=f},n.ProgramManagerId=0,n.ProgramManagerCache={count:0};var q=function(e,r,i){this.width=e,this.height=r,i=i||{},this.wrapS=i.wrapS!==t?i.wrapS:n.ClampToEdgeWrapping,this.wrapT=i.wrapT!==t?i.wrapT:n.ClampToEdgeWrapping,this.magFilter=i.magFilter!==t?i.magFilter:n.LinearFilter,this.minFilter=i.minFilter!==t?i.minFilter:n.LinearMipMapLinearFilter,this.anisotropy=i.anisotropy!==t?i.anisotropy:1,this.offset=new n.Vec2(0,0),this.repeat=new n.Vec2(1,1),this.format=i.format!==t?i.format:n.RGBAFormat,this.type=i.type!==t?i.type:n.UnsignedByteType,this.depthBuffer=i.depthBuffer!==t?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==t?i.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null};q.prototype={constructor:q,clone:function(){var e=new q(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}},$CubeRendererTarget=function(e,t,n){q.call(this,e,t,n),this.activeCubeFace=0},n.extend($CubeRendererTarget,q,{}),n.Network3D=function(r,i,s,u){n.Element.call(this),this.id=n.Network3DId++,this._interactionDispatcher=new n.EventDispatcher,u=u||{},this.helperBox=new n.DataBox,this.helperBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._rootView=$html.createView("hidden"),this._canvas=this.initCanvas(s),this._topCanvas=$html.createCanvas(this),this._bottomCanvas=$html.createCanvas(this);var a=this._canvas.parentNode;a&&(a.removeChild(this._canvas),a.appendChild(this._rootView),this.adjustRootViewBounds(0,0,this._canvas.width,this._canvas.height)),this._rootView.appendChild(this._bottomCanvas),this._rootView.appendChild(this._canvas),this._rootView.appendChild(this._topCanvas),this.setCanvasPropety(),this._camera=i||new n.PerspectiveCamera,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this._clearColor=u.clearColor!==t?u.clearColor:new n.Color(16777215),this._clearAlpha=u.clearAlpha!=t?u.clearAlpha:1,this._precision=u.precision!==t?u.precision:"mediump",this.__fog=new n.FogExp2,this.devicePixelRatio=u.devicePixelRatio!==t?u.devicePixelRatio:e.devicePixelRatio!==t?e.devicePixelRatio:1,this._premultipliedAlpha=u.premultipliedAlpha==null?!0:u.premultipliedAlpha,h.isIOS||h.isAndroid?(this._antialias=!1,this._preserveDrawingBuffer=!1):(this._preserveDrawingBuffer=u.preserveDrawingBuffer==null?!0:u.preserveDrawingBuffer,this._antialias=u.antialias==t?!0:u.antialias),this._gl=this.initGL(),this._programs=[],this._currentProgram=null,this.overrideMaterial=null,this._maxLights=u.maxLights!==t?u.maxLights:4,this._projScreenMatrix=new l,this._projScreenMatrixPS=new l,this._frustum=new n.Frustum,this._vector3=new o,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldBlending=null,this._oldBlendEquation=null,this._oldBlendSrc=null,this._oldBlendDst=null,this._currentCamera=null,this._enabledAttributes={},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.gpu=new n.GPU(this),this.pm=new n.ProgramManager(this),this.setDefaultGLState(),this.paintSortFunction=n.Defaults.paintSortFunction,this.sortNodes=!0,this.sortOpaqueOrderByMaterial=!0,this.glNodeList=[],this.helperGLNodeList=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.projector=new n.Projector,this.up=new n.Vec3(0,1,0),this.position=new n.Vec3(0,0,0),this.seletionMaterial=new n.BasicMaterial,this.seletionMaterial.wireframe=!0,this.seletionMaterial.wireframeLinewidth=1,this.seletionMaterial.color=new n.Color(65280),this.selectionCube=new L,this.selectionCube.material=this.seletionMaterial,this.outlineMaterialMap={},this.selectionCube._modelViewMatrix=new l,this.selectionCube._normalMatrix=new f,this.selectionCube.name="select",this.alarmMaterial=new n.BasicMaterial,this.alarmMaterial.wireframe=!0,this.alarmMaterial.wireframeLinewidth=1,this.alarmMaterial.color=new n.Color(16711680),this.alarmCube=new L,this.alarmCube.material=this.alarmMaterial,this.alarmCube._modelViewMatrix=new l,this.alarmCube._normalMatrix=new f,this.alarmCube.name="alarm";var c=512;this._glowSurface=new n.Plane(2,2),this._glowSurface2=new n.Plane(c,c),this._glowSurface.target=new q(c,c,{type:n.UnsignedByteType}),this._glowSurface.target1=new q(c,c,{type:n.UnsignedByteType}),this._glowSurface.target2=new q(c,c,{type:n.UnsignedByteType}),this._glowSurfaceMaterial=new n.BlurMaterial,this._blurMaterialH=new n.BlurMaterial,this._blurMaterialH.orientation=1,this._blurMaterialV=new n.BlurMaterial,this.deferredPostionMaterial=new n.DeferredMaterial,this.deferredNormalMaterial=new n.DeferredMaterial({isNormal:1}),this.ssaoMaterial=new n.SSAOMaterial,this.ssaoMaterial.map2=new n.Texture(x.ssaoNormalImage);var p=1024;this.deferredPostionTarget=new q(p,p,{type:n.FloatType,magFilter:n.NearestFilter,minFilter:n.NearestFilter}),this.deferredNormalTarget=new q(p,p,{type:n.FloatType,magFilter:n.NearestFilter,minFilter:n.NearestFilter,format:n.RGBFormat}),this.ssaoTarget=new q(p,p,{type:n.FloatType,magFilter:n.NearestFilter,minFilter:n.NearestFilter}),this.ssaoTarget1=new q(c,c,{type:n.UnsignedByteType}),this.ssaoTarget2=new q(c,c,{type:n.UnsignedByteType}),this.finalSSAOTarget=null,this._interactions=null,this.billboardRenderer=null,this._groupCounter=0,this.groupMap={},this.groupCountMap={},this.bufferNodeMap={},this.lineMap={},this.particleMap={},this.glInited={},this.glNodeMap={},this.normalNodeMap={},this.showAxis=!1,this.axisSize=20,this.axisPosition=new n.Vec3(0,0,0),this.axis=new n.Axis(this.axisSize),this.alarmBillboards=[],this.areaPickingRect={},this.setDataBox(r===t?new n.DataBox:r),this.renderCallback=null,this.beforeRenderFunction=null,this.dirtyNetwork(),this.prepareData(),this.autoUpdateCameraAspect=!0,this.shadowMapRenderer=null,this.shadowMapType=n.PCFSoftShadowMap,this.shadowMapCullFace=n.CullFaceFront,this.adjustBounds(this._canvas.width,this._canvas.height,0,0);var d=new n.DefaultInteraction(this);d.panSpeed=3,d.zoomSpeed=10;var v=this;this.getRootView().addEventListener("mousedown",function(e){v.handleMouseDown(e)}),this.getRootView().addEventListener("mouseup",function(e){v.handleClick(e)});var m=[d,new n.SelectionInteraction(this)];this.setInteractions(m),this.doubleClickToLookAtFunction=A.doubleClickToLookAtFunction,R(this),this.initSurfaceGroup(),this.materialRenderListMap={},this._selectTransparencyThreshold=0,this._dynamicBatchDraw=!1,this._dynamicBatchDrawCountLimit=1024,this.needSmoothNormalFunction=A.needSmoothNormalFunction,this._annotationMap={},this._activeAnnotation=null},n.extend(n.Network3D,n.Data,{___accessor:["shadowMapEnable","editableFunction","keyboardRemoveEnabled","selectTransparencyThreshold","dynamicBatchDraw","showFps"],setUseFog:function(e){this._useFog=e,this._useFog?this._fog=this.__fog:this._fog=null},setOverloadMaterial:function(e){this._overloadMaterial=e},setFogColor:function(e){this.__fog.color=e},setFogDensity:function(e){this.__fog.density=e},setDataBox:function(e){if(!e)throw"DataBox can not be null";if(this.dataBox===e)return;var t=this.dataBox;t&&(this._clearDataBox(t),t.removeDataBoxChangeListener(this.handleDataBoxChange,this),t.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),t.getAlarmBox().removeDataBoxChangeListener(this.dirtyNetwork,this),t.getSelectionModel().removeSelectionChangeListener(this.dirtyNetwork,this)),this.dataBox=e,this.dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this.dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.dataBox.getAlarmBox().addDataBoxChangeListener(this.dirtyNetwork,this),this.dataBox.getSelectionModel().addSelectionChangeListener(this.dirtyNetwork,this),this.firePropertyChange("dataBox",t,this._box),this.glNodeList=[],this.dirtyNetwork(),this._clearNodeCache()},setRenderCallback:function(e){this.renderCallback=e},setBeforeRenderFunction:function(e){this.beforeRenderFunction=e},getDataBox:function(){return this.dataBox},getClearColor:function(){return this._clearColor},setClearColor:function(e){arguments.length==3?(this._clearColor=new n.Color,this._clearColor.setRGB(arguments[0],arguments[1],arguments[2])):(this._clearColor=e,this._clearColor instanceof n.Color||(this._clearColor=new n.Color(e))),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},setClearAlpha:function(e){this._clearAlpha=e,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},getClearAlpha:function(){return this._clearAlpha},getPrecision:function(){return this._precision},setPrecision:function(e){this._precesion=e},setSSAOBlur:function(e){this._ssaoBlur=e},setSSAOEnable:function(e){return e&&!this.isFloatTextureSupport()?!1:(this._sSAOEnable=e,this._dirty=!0,!0)},isSSAOEnable:function(){return this._sSAOEnable&&this._baseRender},setSSAOOccluderBias:function(e){this._occluderBias=e,this._dirty=!0},setSSAOSamplingRadius:function(e){this._samplingRadius=e,this._dirty=!0},setSSAOAttenuation:function(e){this._attenuation=e,this._dirty=!0},isFloatTextureSupport:function(){return this._glExtensionTextureFloat!=null},getCamera:function(){return this._camera},isVisible:function(e){if(e){if(e instanceof n.Link||e instanceof n.PathLink){if(!e._visible)return!1;if(!this.isVisible(e._fromNode))return!1;if(!this.isVisible(e._toNode))return!1}if(!e._visible)return!1;if(e._parent)return this.isVisible(e._parent);if(this.visibleFunction)return this.visibleFunction(e)}return!0},setCanvasPropety:function(){this._canvas&&(this._canvas.setAttribute("tabindex",this.id),this._canvas.style.outline="none",this._canvas.style.position="absolute")},initCanvas:function(e){return e===t?document.createElement("canvas"):(typeof e=="string"&&(e=document.getElementById(e)),e)},initGL:function(){var e;try{e=this._canvas.getContext("webgl",{preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0})||this._canvas.getContext("experimental-webgl",{preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0})}catch(t){console.log(t)}e||console.error("Can not init webgl context"),this._glExtensionTextureFloat=e.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=e.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("TGL.Network3D: Float textures not supported."),this._glExtensionStandardDerivatives||console.log("TGL.Network3D: Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("TGL.Network3D: Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("TGL.Network3D: S3TC compressed textures not supported.");if(!!e)return e;console.log("Error: Your browser does not support WebGL.")},resetRenderInfo:function(){this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this.info.currentMaterialId=-1},_clearDataBox:function(e){var t=null;e===this.helperBox?t=this.helperGLNodeList:t=this.glNodeList;for(var n=t.length-1;n>=0;n--){var r=t[n];t.splice(n,1),delete r}t=[],this.prepareData(),this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this._clearNodeCache(),this.deleteCloneNode()},handleDataBoxChange:function(e){var t=e.kind,r=e.data,i=e.source,s=null;i===this.helperBox?s=this.helperGLNodeList:s=this.glNodeList,t==="add"?r instanceof n.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):r instanceof n.Annotation?this._createAnnotationDiv(r):(this.addNodeMaterials(r),s.length===0?this.initWebGLNodes(i,s):this.addNode(r,s),r._alarmBillboard&&this.alarmBillboards.push(r._alarmBillboard)):t==="remove"?r instanceof n.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):r instanceof n.Annotation?this._removeAnnotationDiv(r):(this.removeNode(r,s),this.deleteCloneNode(r)):t==="clear"&&this._clearDataBox(),this.boundingBox=null,this.dirtyNetwork()},removeNode:function(e,t){for(var n=t.length-1;n>=0;n--){var r=t[n];r.node===e&&(t.splice(n,1),delete r)}this._clearNodeCache(e)},_clearNodeCache:function(e){if(e){if(e.oldGroups!=null)for(var t in e.oldGroups){var r=e.oldGroups[t],i=this.groupCountMap[r.id];i!=null&&(i--,i<=0?(delete this.groupCountMap[r.id],delete this.groupMap[r.id]):this.groupCountMap[r.id]=i)}if(e._alarmBillboard){var s=this.alarmBillboards.indexOf(e._alarmBillboard);s!==-1&&this.alarmBillboards.splice(s,1)}else e instanceof n.Annotation&&this._removeAnnotationDiv(e)}else{for(var o in this.groupMap){var u=this.groupMap[o],a=u._nodeId;this.helperBox.containsById(a)||delete this.groupMap[o]}this.glInited=new Object,this.alarmBillboards.splice(0),this.glNodeList=[]}for(var o in this._annotationMap)this._removeAnnotationDiv(o)},addNode:function(e,t){var n=this.addWebGLNode(t,e);for(var r=0;r<n.length;r++){var i=n[r];this.updateWebGLNode(i)}},addNodeMaterials:function(e){var t=e.material,r;if(t instanceof n.Material)this.addMaterial(t);else if(t instanceof n.ArrayMaterial){var i=t.materials,s=i.length;for(r=0;r<s;r++)this.addMaterial(i[r])}},addMaterial:function(e){this.pm.addMaterial(e),e.map&&this.pm.addTexture(e.map)},handleDataPropertyChange:function(e){var t=e.source;if(t instanceof n.Node){var r=e.property;if(t.isSizeChangedProperty(r)||r===n.Styles.MaterailType||r===n.Styles.NormalType){if(t instanceof n.Line){t.verticesNeedUpdate=!0;var i=this.lineMap[t._id];this.initLineBuffers(t),g.buildLineBufferData(t,this._gl.DYNAMIC_DRAW,this._gl,i)}else if(t.groups){t.verticesNeedUpdate=!0;if(r===n.Styles.MaterailType||r===n.Styles.NormalType)t.normalsNeedUpdate=!0;for(var s in t.groups){var o=t.groups[s],i=this.groupMap[o.id],u=g.getMaterial(t,o.materialIndex);t.normalsNeedUpdate&&this.initGroupBuffer(t,o,i,!0),g.buildGroupBufferData(o,t,this._gl.DYNAMIC_DRAW,!t.dynamic,u,this._gl,i,this)}}}else if(r==="materialMapping")this._currentGroupHash=null,this.glInited[t.getId()]=!1,this.removeNode(t,this.glNodeList),this.addNode(t,this.glNodeList);else if(r==="alarmBillboard"){var a=e.oldValue,f=e.newValue;this._addNodeAlarmBillboard(t,a,f)}this.addNodeMaterials(t)}else t instanceof n.Light&&(this.pm._lightNeedsUpdate=!0);if(t.isSizeChangedProperty&&t.isSizeChangedProperty(r)||r=="parent"||t.isSpaceChangedProperty(r))this.deleteCloneNode(t),this.boundingBox=null;this.dirtyNetwork()},deleteCloneNode:function(e){if(e){var t=e.getId?e.getId():e,n=this.normalNodeMap[t];if(n!=null){n.setParent(null);for(var r in n.groups){var i=n.groups[r];delete this.groupMap[i.id]}}delete this.normalNodeMap[t]}else for(var t in this.normalNodeMap)this.deleteCloneNode(t)},setBlurAmount:function(e){this._blurAmount=e},setBlurScale:function(e){this._blurScale=e},setBlurStrength:function(e){this._blurStrength=e},setBlurGlobalAlpha:function(e){this._blurGlobalAlpha=e},dirtyNetwork:function(e){this.dataBox.batch||(this._dirty=!0)},_addNodeAlarmBillboard:function(e,n,r){r===t&&(r=e._alarmBillboard);if(n!=null&&this.alarmBillboards.indexOf(n)!==-1){var i=this.alarmBillboards.indexOf(n);this.alarmBillboards.splice(i,1),n.removePropertyChangeListener(this.dirtyNetwork,this)}r&&this.alarmBillboards.indexOf(r)===-1&&(this.alarmBillboards.push(r),r.addPropertyChangeListener(this.dirtyNetwork,this))},initWebGLNodes:function(e,t){var n=e.getNodes(),r,i;for(r=0,i=n.size();r<i;r++){var s=n.get(r);s.renderSelected=!1,this.addWebGLNode(t,s),this.glNodeMap[s.id]=s}for(r=0,i=t.length;r<i;r++)this.updateWebGLNode(t[r])},updateWebGLNode:function(e){var t=e.node,r=t,i,s,o;if(t instanceof n.Entity){for(var u in t.groups){i=t.groups[u],o=g.getMaterial(t,i.materialIndex);if(t.buffersNeedUpdate){var a=this.groupMap[i.id];this.initGroupBuffer(t,i,a),g.buildGroupBufferData(i,t,this._gl.DYNAMIC_DRAW,!t.dynamic,o,this._gl,a,this)}}t.setUpdateFlags(!1),t.buffersNeedUpdate=!1}else if(t instanceof n.BufferNode)this.setBufferNodeData(t,this._gl.DYNAMIC_DRAW,!t.dynamic);else if(t instanceof n.Line){var a=this.lineMap[t._id];g.buildLineBufferData(t,this._gl.DYNAMIC_DRAW,this._gl,a)}else if(t instanceof n.Particle){var a=this.particleMap[t._id];E(t,this._gl.DYNAMIC_DRAW,this._gl,a)}},addWebGLNode:function(e,r){var i,s,o,u=[],a;this.glInited[r.getId()]||this._addNodeAlarmBillboard(r);if(!this.glInited[r.getId()]){this.glInited[r.id]=!0,r._modelViewMatrix=new l,r._normalMatrix=new f;if(r instanceof n.Entity){r.groups==t&&w(r);for(i in r.groups){s=r.groups[i],s.id=s.id===t?n.Network3D.GroupCache._groupCounter++:s.id;var c=this.groupCountMap[s.id]||0;c++,this.groupCountMap[s.id]=c,this.groupMap[s.id]===t&&(this.groupMap[s.id]={});var h=this.groupMap[s.id];h._nodeId=r.getId(),h.__webglVertexBuffer||(this.createGroupBuffer(s,h),this.initGroupBuffer(r,s,h),r.setUpdateFlags(!0))}}else if(r instanceof n.Line){this.lineMap[r._id]==null&&(this.lineMap[r._id]={});var h=this.lineMap[r._id];h._nodeId=r.getId(),h.__webglVertexBuffer||(this.createLineBuffers(r),this.initLineBuffers(r),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0,r.lineDistancesNeedUpdate=!0)}else if(r instanceof n.Particle){this.lineMap[r._id]==null&&(this.lineMap[r._id]={});var h=this.lineMap[r._id];h._nodeId=r.getId(),h.__webglVertexBuffer||(this.createParticleBuffers(r),this.initParticleBuffers(r),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0)}else r instanceof n.BufferNode?this.initBufferNode(r):r instanceof n.Annotation&&this._createAnnotationDiv(r)}if(r instanceof n.Entity){for(i in r.groups)s=r.groups[i],o=g.getMaterial(r,s.materialIndex),a={group:s,node:r,opaque:o.transparent?null:o,transparent:o.transparent?o:null},e.push(a),u.push(a);r.groups===null}else r instanceof n.Line?(o=r.material,a={group:r,node:r,opaque:o.transparent?null:o,transparent:o.transparent?o:null},e.push(a),u.push(a)):r instanceof n.Particle?(o=r.material,a={group:r,node:r,opaque:o.transparent?null:o,transparent:o.transparent?o:null},e.push(a),u.push(a)):r instanceof n.BufferNode&&(o=r.material instanceof n.ArrayMaterial?r.material.materials[0]:r.material,a={group:r,node:r,opaque:o.transparent?null:o,transparent:o.transparent?o:null},e.push(a),u.push(a));return r.glActive=!0,u},onElementDispose:function(e){var t=e.target;t.removeEventListener("dispose",this.onElementDispose),deallocateElement(t),this.info.memory.geometries--},deallocateElement:function(e){},getNetworkBoundingBox:function(e){},_AK47:function(e,r,i,s,o,u){var a=this._fog;e.parent===t&&e.updateWorldMatrix(!0,!1),e.worldMatrixInverse.getInverse(e.worldMatrix),this._projScreenMatrix.multiply(e.projectionMatrix,e.worldMatrixInverse),this._frustum.setFromMatrix(this._projScreenMatrix),i.length===0&&(this.initWebGLNodes(r,i),this.prepareData()),this.resetRenderInfo();var f,l,c,h;if(!u)for(f=0,l=i.length;f<l;f++){c=i[f],h=c.node,h.renderSelected=!1,c.render=!1;if(this.isVisible(h)){this.unrollBufferMaterial(c),this.setupMatrices(h,e);if(!(h instanceof n.Entity||h instanceof n.Particle)||!h.frustumCulled||this._frustum.intersectsObject(h))c.render=!0,this.sortNodes&&(h.renderDepth!=null?c.z=h.renderDepth:(this._vector3.copy(h.worldMatrix.getPosition()),this._vector3.applyProjection(this._projScreenMatrix),c.z=this._vector3.z))}}var p=new S;p.addAll(s),!o&&!u&&p.addAll(this.alarmBillboards);var d=this;!u&&p.forEach(function(e){e.renderDepth?e.z=e.renderDepth:(d._vector3.copy(e.worldMatrix.getPosition()),d._vector3.applyProjection(d._projScreenMatrix),e.z=d._vector3.z)}),p.size()>0&&!u&&this.billboardRenderer==null&&(this.billboardRenderer=new n.BillboardRenderer,this.billboardRenderer.init(this));var v=i.concat(p._as),m=this.sortNodesFunc(v);this.setBlending(n.NoBlending),this.renderNodes(m,!1,"opaque",e,r.getLights(),!1,null,u,this.sortOpaqueOrderByMaterial),this.renderNodes(m,!0,"transparent",e,r.getLights(),!0,null,u),this.setDepthTest(!0),this.setDepthWrite(!0)},unrollBufferMaterial:function(e){var t=e.node,r=e.group,i,s,o;o=t.material,o instanceof n.ArrayMaterial?(s=r.materialIndex||0,i=o.materials[s],i.transparent?(e.transparent=i,e.opaque=null):(e.opaque=i,e.transparent=null)):(i=o,i&&(i.transparent?(e.transparent=i,e.opaque=null):(e.opaque=i,e.transparent=null)))},renderLicense:function(){},isShadowable:function(){return this.isShadowMapEnable()&&(this.maxShadows>0||this.maxPointShadows>0)},render:function(){if(!this._dirty)return;this._dirty=!1,this.beforeRenderFunction!=null&&this.beforeRenderFunction.call(this);if(this.isShadowable()){this.shadowMapRender(),this.setRenderTarget(t);if(this.debugPointLight)return}_r.twm(this),this.paintBottom(this._bottomCanvas),this.getShowFps()&&(this.__time=(new Date).getTime()),this.innerRender(this._camera,!0),this.renderAnnotations(this._camera),this.extendRender(this._camera),this.paintTopCanvas();if(this.getShowFps()){this._tpf=(new Date).getTime()-this.__time;var e=this._topCanvas.getContext("2d"),n=(1e3/this._tpf).toFixed(0);n>500&&(n="> 500");var r="FPS:"+n+",TPF:"+this._tpf+" ms";e.font="20px Arial sans-serif",e.fontWeight="bold",e.lineWith=2,e.fillStyle="rgba(0, 0, 0, 1)",e.fillText(r,10,25)}if(this._xyz!=t){var i=this._xyz,s=i.markText,o=i.type,u=i.expired,r=i.innerHTML,a=0,f=0,l,c=this._topCanvas.getBoundingClientRect(),e=this._topCanvas.getContext("2d");s!=t&&s!=null&&s!=""||o=="2"?(e.font="24px Arial sans-serif",l=d.getTextSize(e.font,r),e.fillStyle="red",a=this._canvas.width-l.width-20,f=this._canvas.height-l.height-10):(e.font="15px Arial sans-serif",e.fillStyle="rgba(240, 120, 25, 0.6)",l=d.getTextSize(e.font,r),a=this._canvas.width-l.width-20,f=this._canvas.height-l.height-10),e.fillText(r,a,f)}this.renderCallback!=null&&this.renderCallback.call(this)},getTextSize:function(e,t){return d.getTextSize(e,t)},shadowMapRender:function(){this.shadowMapRenderer==null&&(this.shadowMapRenderer=new Qr,this.shadowMapRenderer.init(this)),this.glNodeList.length===0&&(this.initWebGLNodes(this.dataBox,this.glNodeList),this.prepareData()),this.shadowMapRenderer.render(this.dataBox,this._camera)},handleMouseDown:function(e){var t=e.target;this.lastX=e.clientX,this.lastY=e.clientY,t.getAttribute("class")=="tgl_annotation"&&t.style.opacity=="1"&&(e.stop=!0,e.stopPropagation())},handleClick:function(e){var t=e.clientX-this.lastX,n=e.clientY-this.lastY;if(Math.abs(t)<.1&&Math.abs(n)<.1){var r=e.target;if(r.getAttribute("clazz")!="tgl_annotation")this._activeAnnotation&&(this._activeAnnotation=null,this.dirtyNetwork());else if(r.style.opacity=="1"){var i=r.getAttribute("id"),s=this.getDataBox().getDataById(i),o=this._annotationMap[i];this.handleDefaultAnnotationClick(s,o),this.handleAnnotationClick(s,o),this.dirtyNetwork()}}},handleDefaultAnnotationClick:function(e,t){this._activeAnnotation!=e&&(this._activeAnnotation=e)},handleAnnotationClick:function(e,t){},renderAnnotations:function(e){var t=this.dataBox.getAnnotations(),n=this;t&&(t.forEach(function(t){n.renderAnnotation(e,t)}),this._createAnnotationStyle());if(this._activeAnnotation){this._createAnnotationToolTipDiv();var r=this._annotationToolTipDiv;r.innerHTML=this._activeAnnotation.getText();var i=this._annotationMap[this._activeAnnotation.getId()];r.parentNode!=i&&i.appendChild(r),r.style.opacity=i.style.opacity}},renderAnnotation:function(e,t){var n=this._annotationMap[t.getId()];n==null&&(n=this._createAnnotationDiv(t)),n.innerHTML=t._label,t.updateWorldMatrix();var r=t.worldMatrix.getPosition(),i=this.getViewPosition(r),s=this._annotationToolTipDiv;n.style.left=i.x+"px",n.style.top=i.y+"px",n.style.opacity="1";var o=r.distanceTo(e.getPosition()),u=this.getElementByScreenPoint(i,!1);if(u&&u.length>0){var a=u[0];a.distance<o&&(n.style.opacity="0.03")}},_addCSSRule:function(e,t,n,r){r=r||(e.cssRules||e.rules).length,e.insertRule?e.insertRule(t+"{"+n+"}",r):e.addRule&&e.addRule(t,n,r)},_createAnnotationStyle:function(){if(!this._annotationStyle){var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e);var t=e.sheet;this._addCSSRule(t,".tgl_annotation","position:absolute;width:16px;height:16px;border-radius:10px;text-align:center;border : 2px solid gray;"),this._addCSSRule(t,".tgl_annotation:hover","border : 2px solid black;"),this._annotationStyle=e}},_removeAnnotationDiv:function(e){var t=e.getId?e.getId():e,n=this._annotationMap[t];n!=null&&this.getRootView().removeChild(n)},_createAnnotationDiv:function(e){var t=document.createElement("div"),n=this,r=e.getStyle("annotation.class");return t.setAttribute("id",e.getId()),t.setAttribute("class",r),t.setAttribute("clazz","tgl_annotation"),this._annotationMap[e.getId()]=t,this.getRootView().appendChild(t),t},_createAnnotationToolTipDiv:function(){if(this._annotationToolTipDiv==null){var e=document.createElement("div");e.setAttribute("class","tgl_annotation_tooltip");var t=document.createElement("style");t.appendChild(document.createTextNode("")),document.head.appendChild(t);var n=t.sheet,r="position: absolute;border: 3px solid #333; background-color: #ccd; padding: 3px;text-align: left;width: 220px;height: 'auto';border-radius: 10px;bottom:35px;left:-13px;";this._addCSSRule(n,".tgl_annotation_tooltip",r),r="content: ' ';position: absolute;top: 100%; border: 1px solid;",this._addCSSRule(n,".tgl_annotation_tooltip:after, .tgl_annotation_tooltip:before",r),r="border-color: #333 transparent transparent transparent;border-width: 16px 17px 0 7px;left: 10px;",this._addCSSRule(n,".tgl_annotation_tooltip:before",r),r="border-color: #ccd transparent transparent transparent;border-width: 12px 11px 0 4px;left: 14px;",this._addCSSRule(n,".tgl_annotation_tooltip:after",r),this._annotationToolTipDiv=e}},extendRender:function(e){},innerRender:function(e,n){e===t&&(e=this._camera);if(e===null){console.log(" no camera");return}this.debug&&console.log("inner Render");if(this.autoClear){var r=this._clearColor;this._gl.clearColor(r.r,r.g,r.b,this._clearAlpha),M.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil,this)}if(n)for(var i=0;i<this._interactions.length;i++){var o=this._interactions[i];o.update&&o.update()}this.billboardRenderer&&this.billboardRenderer.disable(),this._gl.viewport(0,0,this._canvas.width,this._canvas.height);if(this._sSAOEnable){this.linearDepth=e.far-e.near,this.ssaoing=!0,this._renderDeferredTarget(e,this.deferredPostionMaterial,this.deferredPostionTarget),this._renderDeferredTarget(e,this.deferredNormalMaterial,this.deferredNormalTarget),this._setSSAOMaterial(),this._overloadMaterial=null,this._renderSurface(e,this.ssaoTarget,this.ssaoMaterial);var u=this._canvas.width/this._canvas.height;this._ssaoBlur?(this._renderBlurTarget(e,this._blurMaterialH,this.ssaoTarget,this.ssaoTarget1,u),this._renderBlurTarget(e,this._blurMaterialV,this.ssaoTarget1,this.ssaoTarget2,u),this.finalSSAOTarget=this.ssaoTarget2):this.finalSSAOTarget=this.ssaoTarget,this.setRenderTarget(t),this.ssaoing=!1}this.renderOutline=!1,this.renderOutlineGlow=!1,M.enableStencil(this._gl),this._baseRender=!0,M.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards()),this._baseRender=!1,M.stencilTest(this._gl),this.renderOutline&&M.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"stencil");if(this.renderOutlineGlow){var a=this._glowSurface.target,c=this._glowSurface.target1,h=this._glowSurface.target2;M.disableStencil(this._gl),this.setRenderTarget(a),a._id=a._id||(new Date).getTime()+"0",c._id=c._id||(new Date).getTime()+"1",h._id=h._id||(new Date).getTime()+"2",this._gl.viewport(0,0,a.width,a.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.colorMask(!1,!1,!1,!1),M.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"glow.unselect"),this._gl.colorMask(!0,!0,!0,!0),M.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"glow.select");var p,d;this.setRenderTarget(c),this._gl.viewport(0,0,c.width,c.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(a);var u=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new s(a.width,a.height/u),this._blurMaterialH.blurAmount=this._blurAmount||5,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=1;for(p in this._glowSurface.groups)d=this._glowSurface.groups[p],this.renderGroup(e,[],this._blurMaterialH,d,this._glowSurface2);this.setRenderTarget(h),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(c),this._blurMaterialV.texelSize=new s(c.width,c.height/u),this._blurMaterialV.blurAmount=this._blurAmount||5,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=0
;for(p in this._glowSurface.groups)d=this._glowSurface.groups[p],this.renderGroup(e,[],this._blurMaterialV,d,this._glowSurface2);this.setRenderTarget(t),this._glowSurface._modelViewMatrix=new l,this._glowSurface._normalMatrix=new f,this.setupMatrices(this._glowSurface,e),this._glowSurfaceMaterial.setMap(h),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,M.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(p in this._glowSurface.groups)d=this._glowSurface.groups[p],this.renderGroup(e,[],this._glowSurfaceMaterial,d,this._glowSurface);this.setRenderTarget(c),this._gl.viewport(0,0,c.width,c.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(a);var u=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new s(a.width,a.height/u),this._blurMaterialH.blurAmount=this._blurAmount||10,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=0;for(p in this._glowSurface.groups)d=this._glowSurface.groups[p],this.renderGroup(e,[],this._blurMaterialH,d,this._glowSurface2);this.setRenderTarget(h),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(c),this._blurMaterialV.texelSize=new s(c.width,c.height/u),this._blurMaterialV.blurAmount=this._blurAmount||10,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=1;for(p in this._glowSurface.groups)d=this._glowSurface.groups[p],this.renderGroup(e,[],this._blurMaterialV,d,this._glowSurface2);this.setRenderTarget(t),this._glowSurface._modelViewMatrix=new l,this._glowSurface._normalMatrix=new f,this.setupMatrices(this._glowSurface,e),this._glowSurfaceMaterial.setMap(h),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,M.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(p in this._glowSurface.groups)d=this._glowSurface.groups[p],this.renderGroup(e,[],this._glowSurfaceMaterial,d,this._glowSurface);this._gl.clearColor(0,0,0,0)}M.disableStencil(this._gl),this.renderHelper(e)},_renderDeferredTarget:function(e,t,r,i){i=i||new n.Vec4(0,0,0,0,0),t.linearDepth=this.linearDepth,this.setRenderTarget(r),this._overloadMaterial=t,this._gl.clearColor(i.x,i.y,i.z,i.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),M.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards())},_renderBlurTarget:function(e,t,r,i,o){clearColor=clearColor||new n.Vec4(0,0,0,0,0),this.setRenderTarget(i),this._gl.viewport(0,0,i.width,i.height),this._gl.clearColor(clearColor.x,clearColor.y,clearColor.z,clearColor.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),t.setMap(r),t.texelSize=new s(r.width,r.height/o),t.blurAmount=this._blurAmount||5,t.blurScale=this._blurScale||1,t.blurStrength=this._blurStrength||1;var u,a;for(u in this._glowSurface.groups)a=this._glowSurface.groups[u],this.renderGroup(e,[],t,a,this._glowSurface2)},_setSSAOMaterial:function(){this.ssaoMaterial.map=this.deferredPostionTarget,this.ssaoMaterial.map1=this.deferredNormalTarget,this.ssaoMaterial.attenuation=this._attenuation||new s(1,.02),this.ssaoMaterial.occluderBias=this._occluderBias||.5,this.ssaoMaterial.samplingRadius=this._samplingRadius||20,this.ssaoMaterial.texelSize=new s(1/this.deferredPostionTarget.width,1/this.deferredPostionTarget.height)},_renderSurface:function(e,t,r,i){i=i||new n.Vec4(1,1,1,1),this.setRenderTarget(t),this._gl.clearColor(i.x,i.y,i.z,i.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._glowSurface._modelViewMatrix=new l,this._glowSurface._normalMatrix=new f,this.setupMatrices(this._glowSurface,e);var s,o;for(o in this._glowSurface.groups)s=this._glowSurface.groups[o],this.renderGroup(e,[],r,s,this._glowSurface)},renderHelper:function(e){M.r(this,e,this.helperBox,this.helperGLNodeList,this.helperBox.getBillboards(),"stencil")},initSurfaceGroup:function(){this._glowSurface.setUpdateFlags(!0),w(this._glowSurface);for(var e in this._glowSurface.groups){var r=this._glowSurface.groups[e];r.id=r.id===t?n.Network3D.GroupCache._groupCounter++:r.id,this.groupMap[r.id]===t&&(this.groupMap[r.id]={});var i=this.groupMap[r.id];this.createGroupBuffer(r,i),this.initGroupBuffer(this._glowSurface,r,i),g.buildGroupBufferData(r,this._glowSurface,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,i,this)}this._glowSurface2.setUpdateFlags(!0),w(this._glowSurface2);for(var e in this._glowSurface2.groups){var r=this._glowSurface2.groups[e];r.id=r.id===t?n.Network3D.GroupCache._groupCounter++:r.id,this.groupMap[r.id]===t&&(this.groupMap[r.id]={});var i=this.groupMap[r.id];this.createGroupBuffer(r,i),this.initGroupBuffer(this._glowSurface2,r,i),g.buildGroupBufferData(r,this._glowSurface2,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,i,this)}},getOutlineMaterial:function(e,t){var r=(t.getStyle("select.width")||1)+1+" "+(new n.Color(t.getStyle("select.color"))).getUniqueCode()+e,i=this.outlineMaterialMap[r];return i==null&&(i=new n.EntityMaterial,e=="outline.normal"?(i._type="outline",i.outline=t.getStyle("select.width")||1):e=="outline.glow"?i._type="basic":(i.wireframe=!0,i.wireframeLinewidth=(t.getStyle("select.width")||1)+1),i.color=new n.Color(t.getStyle("select.color")),this.outlineMaterialMap[r]=i),i},renderNodes:function(e,t,r,i,s,o,u,a,f){var l,c,h,p,d,v,m;t?(d=e.length-1,v=-1,m=-1):(d=0,v=e.length,m=1);var g=null;for(var y=d;y!==v;y+=m){l=e[y];if(l instanceof n.Billboard){var b=l.material.transparent?"transparent":"opaque";r==b&&this.billboardRenderer.render(this,[l],i,this._canvas.width*2,this._canvas.height*2)}else if(l.render){this.billboardRenderer&&this.billboardRenderer.disable(),c=l.node,h=l.group,p=l[r];if(!p)continue;o?(M.setBlending(p.blendMode,p.blendEquation,p.blendSrc,p.blendDst,this),M.setDepthWrite(!1,this)):M.setDepthWrite(p.depthMask,this),M.setDepthTest(p.depthTest,this),M.setPolygonOffset(p.polygonOffset,p.polygonOffsetFactor,p.polygonOffsetUnits,this),this.setGLFaces(p);if(c instanceof n.Particle){if(c.verticesNeedUpdate||c.colorsNeedUpdate||c.sortParticles){var w=this.particleMap[c._id];E(c,this._gl.DYNAMIC_DRAW,this._gl,w)}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1}var S=a==="stencil",x=c.getSelectStyle();x=="outline"&&(x="outline.normal"),a?a==="glow.unselect"&&(c.isSelected()||(c instanceof n.BufferNode?this.renderBufferNode(i,s,p,h,c):M.g(this,i,s,p,h,c))):(!c.isSelected()||x!=="outline.normal"&&x!=="outline.wireframe"&&x!=="outline.glow"?this._gl.disable(this._gl.STENCIL_TEST):(this._gl.enable(this._gl.STENCIL_TEST),x==="outline.glow"?this.renderOutlineGlow=!0:this.renderOutline=!0),c instanceof n.BufferNode?this.renderBufferNode(i,s,p,h,c):M.g(this,i,s,p,h,c));if(c.isSelected()&&this.renderSelect(c))if(x==="outline.normal"||x==="outline.wireframe"||x==="outline.glow"){if(a!=null&&a!="glow.unselect")if(x==="outline.normal"){if(c.renderSelected===!1){var T=this.getOutlineMaterial(x,c),N=this.normalNodeMap[c.getId()];if(N==null){var N=this.cloneNode(c,T);this.normalNodeMap[c.getId()]=N}this.setupMatrices(N,i);for(var C in N.groups)M.g(this,i,s,T,N.groups[C],N);c.renderSelected=!0}}else if(x!=="outline.normal"){var T=this.getOutlineMaterial(x,c);M.g(this,i,s,T,h,c)}}else c.renderSelected===!1&&(this.renderNodeSelection(i,s,c),c.renderSelected=!0);c.getAlarmState().getPropagateSeverity()&&this.renderAlarmBorder(c)&&this.renderNodeAlarm(i,s,c)}c&&c.setUpdateFlags(!1)}},cloneNode:function(e,t){var r=new n.Entity,i={vertices:[],uvs:[],faces:[]},s,o,u,a,c;for(s=0,o=e.vertices.length;s<o;s++)i.vertices.push(e.vertices[s].clone());for(s=0,o=e.faces.length;s<o;s++)i.faces.push(e.faces[s].clone());for(s=0,o=e.uvs.lenght;s<o;s++){var h=uvs[s],p=[];for(var d=0;d<h;d++)p.push(h[d].clone());i.uvs.push(p)}return n.Node.prototype.mergeVertices.call(i),n.Node.prototype.computeFaceNormals.call(i),n.Node.prototype.computeVertexNormals.call(i,!0),r.setPosition(e.getPosition()),r.setScale(e.getScale()),r.setRotation(e.getRotation()),r.setParent(e.getParent()),r._modelViewMatrix=new l,r._normalMatrix=new f,r.data=i,r.vertices=i.vertices,r.uvs=i.uvs,r.faces=i.faces,r.material=t,r.primitive=new n.Primitive(i),r.setUpdateFlags(!0),w(r),this.buildNodeBufferData(r),r},buildNodeBufferData:function(e){for(var r in e.groups){var i=e.groups[r];i.id=i.id===t?n.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===t&&(this.groupMap[i.id]={});var s=this.groupMap[i.id];this.createGroupBuffer(i,s),this.initGroupBuffer(e,i,s),g.buildGroupBufferData(i,e,this._gl.DYNAMIC_DRAW,!1,e.material,this._gl,s,this)}},needSmoothNormal:function(e,r){var i=r.normalType;return i!=t?i===n.NormalTypeSmooth:this.needSmoothNormalFunction?this.needSmoothNormalFunction(e):!1},renderNodeSelection:function(e,r,i){i.createSelectionCube(this.selectionCube),this.setupMatrices(this.selectionCube,e);var s=this.selectionCube.groups;this.selectionCube.material.needsUpdate=!0;for(var o in s){var u=s[o];u.id=u.id===t?n.Network3D.GroupCache._groupCounter++:u.id,this.groupMap[u.id]===t&&(this.groupMap[u.id]={});var a=this.groupMap[u.id];a.__webglVertexBuffer||(this.createGroupBuffer(u,a),this.initGroupBuffer(i,u,a)),this.selectionCube.setUpdateFlags(!0),g.buildGroupBufferData(u,this.selectionCube,this._gl.DYNAMIC_DRAW,!1,this.selectionCube.material,this._gl,a,this),this.renderGroup(e,[],this.selectionCube.material,u,this.selectionCube)}},renderNodeAlarm:function(e,r,i){i.createPropagateAlarmCube(this.alarmCube),this.setupMatrices(this.alarmCube,e);var s=this.alarmCube.groups;this.alarmCube.material.needsUpdate=!0;for(var o in s){var u=s[o];u.id=u.id===t?n.Network3D.GroupCache._groupCounter++:u.id,this.groupMap[u.id]===t&&(this.groupMap[u.id]={});var a=this.groupMap[u.id];a.__webglVertexBuffer||(this.createGroupBuffer(u,a),this.initGroupBuffer(i,u,a)),this.alarmCube.setUpdateFlags(!0),g.buildGroupBufferData(u,this.alarmCube,this._gl.DYNAMIC_DRAW,!1,this.alarmCube.material,this._gl,a,this),this.renderGroup(e,[],this.alarmCube.material,u,this.alarmCube)}},renderBufferNode:function(e,t,n,r,i,s){if(n.visible===!1)return;var o,u,a,f,l,c;o=this.pm.setProgram(e,t,this._fog,n,r,i),u=o.attributes;var h=i,p=!1,d=n.wireframe?1:0,v=r._id*16777215+o.id*2+d;if(v!==this._currentGroupHash||s)this._currentGroupHash=v,p=!0;p&&this.disableAttributes();var m=this._gl,g=h.attributes.index,y=this.bufferNodeMap[i._id];if(g){var b=h.offsets;b.length>1&&(p=!0);for(var w=0,E=b.length;w<E;w++){var S=b[w].index;if(p){var x=h.attributes.position,T=x.itemSize;m.bindBuffer(m.ARRAY_BUFFER,y.position),this.enableAttribute(u.position),m.vertexAttribPointer(u.position,T,m.FLOAT,!1,0,S*T*4);var N=h.attributes.normal;if(u.normal>=0&&N){var C=N.itemSize;m.bindBuffer(m.ARRAY_BUFFER,y.normal),this.enableAttribute(u.normal),m.vertexAttribPointer(u.normal,C,m.FLOAT,!1,0,S*C*4)}var k=h.attributes.uv;if(u.uv>=0&&k){var L=k.itemSize;m.bindBuffer(m.ARRAY_BUFFER,y.uv),this.enableAttribute(u.uv),m.vertexAttribPointer(u.uv,L,m.FLOAT,!1,0,S*L*4)}var A=h.attributes.color;if(u.color>=0&&A){var O=A.itemSize;m.bindBuffer(m.ARRAY_BUFFER,y.color),this.enableAttribute(u.color),m.vertexAttribPointer(u.color,O,m.FLOAT,!1,0,S*O*4)}m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,y.index)}m.drawElements(m.TRIANGLES,b[w].count,m.UNSIGNED_SHORT,b[w].start*2),this.info.render.calls++,this.info.render.vertices+=b[w].count,this.info.render.faces+=b[w].count/3}}else{if(p){var x=h.attributes.position,T=x.itemSize;m.bindBuffer(m.ARRAY_BUFFER,x.buffer),this.enableAttribute(u.position),m.vertexAttribPointer(u.position,T,m.FLOAT,!1,0,0);var N=h.attributes.normal;if(u.normal>=0&&N){var C=N.itemSize;m.bindBuffer(m.ARRAY_BUFFER,N.buffer),this.enableAttribute(u.normal),m.vertexAttribPointer(u.normal,C,m.FLOAT,!1,0,0)}var k=h.attributes.uv;if(u.uv>=0&&k){var L=k.itemSize;m.bindBuffer(m.ARRAY_BUFFER,k.buffer),this.enableAttribute(u.uv),m.vertexAttribPointer(u.uv,L,m.FLOAT,!1,0,0)}var A=h.attributes.color;if(u.color>=0&&A){var O=A.itemSize;m.bindBuffer(m.ARRAY_BUFFER,A.buffer),this.enableAttribute(u.color),m.vertexAttribPointer(u.color,O,m.FLOAT,!1,0,0)}}var x=h.attributes.position;m.drawArrays(m.TRIANGLES,0,x.numItems/3),this.info.render.calls++,this.info.render.vertices+=x.numItems/3,this.info.render.faces+=x.numItems/3/3}},renderGroup:function(e,t,r,i,s){r==null&&console.log("material is null");if(r.visible===!1)return;this._overloadMaterial&&(r=this._overloadMaterial);var o=this._gl,u;s instanceof n.Entity?u=this.groupMap[i.id]:s instanceof n.Line?u=this.lineMap[i._id]:s instanceof n.Particle&&(u=this.particleMap[i._id]);var a,f,l,c,h,p,d,v;a=this.pm.setProgram(e,t,this._fog,r,i,s),f=a.attributes;var m=!1,g=r.wireframe?1:0,y;i.id!=null?y=i.id*16777215+a.id*2+g:y=i._id+""+(a.id*2+g),y!==this._currentGroupHash&&(this._currentGroupHash=y,m=!0),m&&this.disableAttributes(),f.position>=0&&m&&(o.bindBuffer(o.ARRAY_BUFFER,u.__webglVertexBuffer),this.enableAttribute(f.position),o.vertexAttribPointer(f.position,3,o.FLOAT,!1,0,0));if(m){if(i.__webglCustomAttributesList)for(d=0,v=i.__webglCustomAttributesList.length;d<v;d++)p=i.__webglCustomAttributesList[d],f[p.buffer.belongsToAttribute]>=0&&(o.bindBuffer(o.ARRAY_BUFFER,p.buffer),this.enableAttribute(f[p.buffer.belongsToAttribute]),o.vertexAttribPointer(f[p.buffer.belongsToAttribute],p.size,o.FLOAT,!1,0,0));f.color>=0&&(o.bindBuffer(o.ARRAY_BUFFER,u.__webglColorBuffer),this.enableAttribute(f.color),o.vertexAttribPointer(f.color,3,o.FLOAT,!1,0,0)),f.normal>=0&&(o.bindBuffer(o.ARRAY_BUFFER,u.__webglNormalBuffer),this.enableAttribute(f.normal),o.vertexAttribPointer(f.normal,3,o.FLOAT,!1,0,0)),f.uv>=0&&(o.bindBuffer(o.ARRAY_BUFFER,u.__webglUVBuffer),this.enableAttribute(f.uv),o.vertexAttribPointer(f.uv,2,o.FLOAT,!1,0,0)),f.uv2>=0&&(o.bindBuffer(o.ARRAY_BUFFER,u.__webglUV2Buffer),this.enableAttribute(f.uv2),o.vertexAttribPointer(f.uv2,2,o.FLOAT,!1,0,0)),f.lineDistance>=0&&(o.bindBuffer(o.ARRAY_BUFFER,u.__webglLineDistanceBuffer),this.enableAttribute(f.lineDistance),o.vertexAttribPointer(f.lineDistance,1,o.FLOAT,!1,0,0))}s instanceof n.Entity?(r.wireframe?(this.setLineWidth(r.wireframeLinewidth),this._gl.lineJoin="round",m&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,u.__webglLineBuffer),o.drawElements(o.LINES,u.__webglLineCount,o.UNSIGNED_SHORT,0)):(m&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,u.__webglFaceBuffer),o.drawElements(o.TRIANGLES,u.__webglFaceCount,o.UNSIGNED_SHORT,0)),this.info.render.calls++,this.info.render.vertices+=i.__webglFaceCount,this.info.render.faces+=i.__webglFaceCount/3):s instanceof n.Line?(c=s.type===n.LineStrip?o.LINE_STRIP:o.LINES,this.setLineWidth(r.linewidth),o.drawArrays(c,0,u.__webglLineCount),this.info.render.calls++):s instanceof n.Particle?(o.drawArrays(o.POINTS,0,u.__webglParticleCount),this.info.render.calls++,this.info.render.points+=u.__webglParticleCount):s instanceof n.Ribbon&&(o.drawArrays(o.TRIANGLE_STRIP,0,i.__webglVertexCount),this.info.render.calls++)},prepareData:function(){this.maxLightCount=this.dataBox.allocateLights(this._maxLights),this.maxShadows=this.dataBox.allocateShadows(),this.maxPointShadows=this.dataBox.allocatePointShadows()},wrapBillboardMaterial:function(e){e instanceof n.Billboard&&e.material&&(e.opaque=e.material.transparent?null:e.material,e.transparent=e.material.transparent?e.material:null)},sortNodesFunc:function(e){if(this.sortNodes&&(this.paintSortFunction!==null||this.sortOpaqueOrderByMaterial)){var t=this;this.sortOpaqueOrderByMaterial?this.__st==null&&(this.__st=function(e,n){t.wrapBillboardMaterial(e),t.wrapBillboardMaterial(e);var r="opaque";if(e[r]&&n[r])return e[r].id-n[r].id;if(!e[r]&&n[r])return-1;if(e[r]&&!n[r])return 1;var i=e.node?e.node:e,s=n.node?n.node:n;i.z=e.z,s.z=n.z;if(t.paintSortFunction)return t.paintSortFunction(i,s)}):this.__st==null&&(this.__st=function(e,n){var r=e.node?e.node:e,i=n.node?n.node:n;r.z=e.z,i.z=n.z;if(t.paintSortFunction)return t.paintSortFunction(r,i)}),e.sort(this.__st)}return e},renderNode:function(e,t){this.setupMatrices(e),e instanceof n.Entity&&renderEntity(e)},paintTopCanvas:function(){var e=this._topCanvas.getContext("2d");e.clearRect(0,0,this._topCanvas.width,this._topCanvas.height);var t=this.areaPickingRect;t&&(e.beginPath(),e.lineStyle="#FFffff",e.rect(t.x,t.y,t.w,t.h),e.stroke()),this.renderLicense()},setBackgroundImage:function(e){if(typeof e=="string"){var t=new Image;e.startsWith("data:image")||(t.crossOrigin="use-credentials"),t.src=e,this._backgroundImage=t;var n=this;t.onload=function(){n.dirtyNetwork()}}else this._backgroundImage=e,this.dirtyNetwork()},paintBottom:function(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var n=this._backgroundImage;n instanceof Image&&t.drawImage(n,0,0,e.width,e.height)},initBufferNode:function(e){if(!this.bufferNodeMap[e._id]){var t={};this.bufferNodeMap[e._id]=t;var n,r,i,s=this._gl;for(n in e.attributes)n==="index"?i=s.ELEMENT_ARRAY_BUFFER:i=s.ARRAY_BUFFER,r=e.attributes[n],t[n]=s.createBuffer(),s.bindBuffer(i,t[n]),s.bufferData(i,r.array,s.STATIC_DRAW)}},setBufferNodeData:function(e,n,r){var i=this.bufferNodeMap[e._id],s=e.attributes,o=s.index,u=s.position,a=s.normal,f=s.uv,l=s.color,c=s.tangent,h=this._gl;e.elementsNeedUpdate&&o!==t&&(h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i.index),h.bufferData(h.ELEMENT_ARRAY_BUFFER,o.array,n)),e.verticesNeedUpdate&&u!==t&&(h.bindBuffer(h.ARRAY_BUFFER,i.position),h.bufferData(h.ARRAY_BUFFER,u.array,n)),e.normalsNeedUpdate&&a!==t&&(h.bindBuffer(h.ARRAY_BUFFER,i.normal),h.bufferData(h.ARRAY_BUFFER,a.array,n)),e.uvsNeedUpdate&&f!==t&&(h.bindBuffer(h.ARRAY_BUFFER,i.uv),h.bufferData(h.ARRAY_BUFFER,f.array,n)),e.colorsNeedUpdate&&l!==t&&(h.bindBuffer(h.ARRAY_BUFFER,i.color),h.bufferData(h.ARRAY_BUFFER,l.array,n)),e.tangentsNeedUpdate&&c!==t&&(h.bindBuffer(h.ARRAY_BUFFER,i.tangent),h.bufferData(h.ARRAY_BUFFER,c.array,n));if(r)for(var p in e.attributes);},initGroupBuffer:function(e,n,r,i){var s=n.faces3,o=n.faces4,u=s.length*3+o.length*4,a=s.length*1+o.length*2,f=s.length*3+o.length*4,l=g.getMaterial(e,n.materialIndex?n.materialIndex:0),c=l.needUV(),h=l.getNormalType(),p=l.isVertexColor();r.__vertexArray=new Float32Array(u*3),h&&(r.__normalArray=new Float32Array(u*3));if(i)return;p&&(r.__colorArray=new Float32Array(u*3)),c&&(r.__uvArray=new Float32Array(u*2),e.uv2s&&(r.__uv2Array=new Float32Array(u*2))),r.__faceArray=new Uint16Array(a*3),r.__lineArray=new Uint16Array(f*2);var d,v;if(n.numMorphTargets){r.__morphTargetsArrays=[];for(d=0,v=n.numMorphTargets;d<v;d++)r.__morphTargetsArrays.push(new Float32Array(u*3))}if(n.numMorphNormals){r.__morphNormalsArrays=[];for(d=0,v=n.numMorphNormals;d<v;d++)r.__morphNormalsArrays.push(new Float32Array(u*3))}r.__webglFaceCount=a*3,r.__webglLineCount=f*2;if(l.attributes){r.__webglCustomAttributesList===t&&(r.__webglCustomAttributesList=[]);for(var m in l.attributes){var y=l.attributes[m],b={};for(var w in y)b[w]=y[w];if(!b.__webglInitialized||b.createUniqueBuffers){b.__webglInitialized=!0;var E=1;b.type==="v2"?E=2:b.type==="v3"?E=3:b.type==="v4"?E=4:b.type==="c"&&(E=3),b.size=E,b.array=new Float32Array(u*E),b.buffer=_gl.createBuffer(),b.buffer.belongsToAttribute=m,y.needsUpdate=!0,b.__original=y}r.__webglCustomAttributesList.push(b)}}r.__inittedArrays=!0},createLineBuffers:function(e){this.lineMap[e._id]==null&&(this.lineMap[e._id]={});var t=this.lineMap[e._id],n=this._gl;t.__webglVertexBuffer=n.createBuffer(),t.__webglColorBuffer=n.createBuffer(),t.__webglLineDistanceBuffer=n.createBuffer(),this.info.memory.geometries++},initLineBuffers:function(e){this.lineMap[e._id]==null&&(this.lineMap[e._id]={});var t=this.lineMap[e._id],n=e.vertices.length;t.__vertexArray=new Float32Array(n*3),t.__colorArray=new Float32Array(n*3),t.__lineDistanceArray=new Float32Array(n*1),t.__webglLineCount=n},createParticleBuffers:function(e){this.particleMap[e._id]==null&&(this.particleMap[e._id]={});var t=this.particleMap[e._id],n=this._gl;t.__webglVertexBuffer=n.createBuffer(),t.__webglColorBuffer=n.createBuffer(),this.info.memory.geometries++},initParticleBuffers:function(e){this.particleMap[e._id]==null&&(this.particleMap[e._id]={});var t=this.particleMap[e._id],n=e.vertices.length;t.__vertexArray=new Float32Array(n*3),t.__colorArray=new Float32Array(n*3),t.__sortArray=[],t.__webglParticleCount=n},createGroupBuffer:function(e,t){var n=this._gl;t.__webglVertexBuffer=n.createBuffer(),t.__webglNormalBuffer=n.createBuffer(),t.__webglTangentBuffer=n.createBuffer(),t.__webglColorBuffer=n.createBuffer(),t.__webglUVBuffer=n.createBuffer(),t.__webglUV2Buffer=n.createBuffer(),t.__webglSkinIndicesBuffer=n.createBuffer(),t.__webglSkinWeightsBuffer=n.createBuffer(),t.__webglFaceBuffer=n.createBuffer(),t.__webglLineBuffer=n.createBuffer(),this.info.memory.geometries++},setRenderTarget:function(e){var r=e instanceof $CubeRendererTarget,i=this._gl;if(e&&!e.__webglFramebuffer){e.depthBuffer===t&&(e.depthBuffer=!0),e.stencilBuffer===t&&(e.stencilBuffer=!0),e.__webglTexture=i.createTexture(),this.info.memory.textures++;var s=O.isPowerOfTwo,o=s(e.width)&&s(e.height),u=O.paramToGL(e.format,i),a=O.paramToGL(e.type,i);e.type==n.FloatType;var f=u;if(r){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],i.bindTexture(i.TEXTURE_CUBE_MAP,e.__webglTexture),this.pm.setTextureParameters(i.TEXTURE_CUBE_MAP,e,o);for(var l=0;l<6;l++)e.__webglFramebuffer[l]=i.createFramebuffer(),e.__webglRenderbuffer[l]=i.createRenderbuffer(),i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,f,e.width,e.height,0,u,a,null),this.setupFrameBuffer(e.__webglFramebuffer[l],e,i.TEXTURE_CUBE_MAP_POSITIVE_X+l),this.setupRenderBuffer(e.__webglRenderbuffer[l],e);o&&i.generateMipmap(i.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=i.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=i.createRenderbuffer(),i.bindTexture(i.TEXTURE_2D,e.__webglTexture),this.pm.setTextureParameters(i.TEXTURE_2D,e,o),i.texImage2D(i.TEXTURE_2D,0,f,e.width,e.height,0,u,a,null),this.setupFrameBuffer(e.__webglFramebuffer,e,i.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e.__webglRenderbuffer):this.setupRenderBuffer(e.__webglRenderbuffer,e),o&&i.generateMipmap(i.TEXTURE_2D);r?i.bindTexture(i.TEXTURE_CUBE_MAP,null):i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null)}var c,h,p,d,v;e?(r?c=e.__webglFramebuffer[e.activeCubeFace]:c=e.__webglFramebuffer,h=e.width,p=e.height,d=0,v=0):(c=null,h=this._viewportWidth,p=this._viewportHeight,d=this._viewportX,v=this._viewportY),c!==this._currentFramebuffer&&(i.bindFramebuffer(i.FRAMEBUFFER,c),i.viewport(d,v,h,p),this._currentFramebuffer=c),this._currentWidth=h,this._currentHeight=p},setupFrameBuffer:function(e,t,n){var r=this._gl;r.bindFramebuffer(r.FRAMEBUFFER,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,n,t.__webglTexture,0)},setupRenderBuffer:function(e,t){var n=this._gl;n.bindRenderbuffer(n.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e)):n.renderbufferStorage(n.RENDERBUFFER,n.RGBA4,t.width,t.height)},setLineWidth:function(e){e!==this._oldLineWidth&&(this._gl.lineWidth&&this._gl.lineWidth(e),this._oldLineWidth=e)},setupMatrices:function(e,t){e.fixSize(t),e.updateWorldMatrix(),e._modelViewMatrix.multiplyMatrices(t.worldMatrixInverse,e.worldMatrix),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)},setDefaultGLState:function(){var e=this._gl,t=new n.Color(this._clearColor);e.clearColor(t.r,t.g,t.b,this._clearAlpha),e.clearDepth(1),h.isIE||e.clearStencil(0),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),e.enable(e.CULL_FACE),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},clear:function(e,n,r){var i=this._gl,s=0;if(e===t||e)s|=i.COLOR_BUFFER_BIT;if(n===t||n)s|=i.DEPTH_BUFFER_BIT;if(r===t||r)s|=i.STENCIL_BUFFER_BIT;i.clear(s)},setGLFaces:function(e){var t=this._gl,r=e.side===n.DoubleSide,i=e.side===n.BackSide;this._oldDoubleSided!==r&&(r?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),this._oldDoubleSided=r),this._oldFlipSided!==i&&(i?t.frontFace(t.CW):t.frontFace(t.CCW),this._oldFlipSided=i)},getView:function(){return this._canvas},getRootView:function(){return this._rootView},setBlending:function(e,t,n,r){M.setBlending(e,t,n,r,this)},setDepthTest:function(e){M.setDepthTest(e,this)},setDepthWrite:function(e){M.setDepthWrite(e,this)},setTexture:function(e,t){this.pm.setTexture(e,t)},disableAttributes:function(){for(var e in this._enabledAttributes)this._enabledAttributes[e]&&(this._gl.disableVertexAttribArray(e),this._enabledAttributes[e]=!1)},enableAttribute:function(e){this._enabledAttributes[e]||(this._gl.enableVertexAttribArray(e),this._enabledAttributes[e]=!0)},adjustRootViewBounds:function(e,t){var n=this._rootView;n.style.width=e+"px",n.style.height=t+"px"},adjustCanvasBounds:function(e,t,n,r,i){e.width=t*this.devicePixelRatio,e.height=n*this.devicePixelRatio,e.style.margin="0px",e.style.padding="0px",e.style.width=t+"px",e.style.height=n+"px"},adjustBounds:function(e,t,n,r){var i=this.getView();this.adjustRootViewBounds(e,t,n,r),this.adjustCanvasBounds(i,e,t,n,r),this.adjustCanvasBounds(this._topCanvas,e,t,n,r),this.adjustCanvasBounds(this._bottomCanvas,e,t,n,r),this.adjustCallback(e,t,n,r),this.setViewport(0,0,i.width,i.height);if(this.autoUpdateCameraAspect&&t!==0){var s=this._camera;s.aspect=e/t,s.updateProjectionMatrix(),this._currentCamera=null}this.dirtyNetwork()},adjustCallback:function(){},setViewport:function(e,n,r,i){this._viewportX=e!==t?e:0,this._viewportY=n!==t?n:0,this._viewportWidth=r!==t?r:_canvas.width,this._viewportHeight=i!==t?i:_canvas.height,this._gl.viewport(this._viewportX,this._viewportY,this._viewportWidth,this._viewportHeight)},setShowAxis:function(e){if(this.showAxis===e)return;this.showAxis=e,this.showAxis&&(this.helperBox.contains(this.axis)||this.helperBox.addByDescendant(this.axis)),this.axis._visible=e,this.dirtyNetwork()},setShowAxisText:function(e){this.axis.showAxisText(e),this.dirtyNetwork()},setAxisSize:function(e){this.axis.setSize(e)},onSelect:function(e){this.onSelectFunction!=null&&this.onSelectFunction(e)},setOnSelectFunction:function(e){this.onSelectFunction=e},isSelectable:function(e){return e.isSelectable()?this.selectableFunction?this.selectableFunction(e):!0:!1},setSelectableFunction:function(e){this.selectableFunction=e},setRenderSelectFunction:function(e){this.renderSelectFunction=e},renderSelect:function(e){return this.renderSelectFunction?this.renderSelectFunction(e):!0},renderAlarmBorder:function(e){return this.renderAlarmBorderFunction?this.renderAlarmBorderFunction(e):!0},selectable:function(e){return e.element.isVisible()&&this.isSelectable(e.element)&&this.getDataBox().getSelectionModel().isSelectable(e.element)},editable:function(e){var t=this.selectable(e);return t&&this.editableFunction!=null?this.editableFunction(e.element):t},getFirstSelectElement:function(e){if(e==null)return null;var t=0,n;while(t<e.length){var r=e[t];if(this.selectable(r)){n=r.element;break}t++}return n},getFirstEditElement:function(e){if(e==null)return null;var t=0,n;while(t<e.length){var r=e[t];if(this.editable(r)){n=r.element;break}t++}return n},toImageData:function(e,t,n,r){this.dirtyNetwork(),this.render(),e=e||"PNG",e.toUpperCase();if(e==="PNG")return p.saveAsPNG(this.getView(),t,!1,n,r);if(e==="JPEG")return p.saveAsJPEG(this.getView(),t,!1,n,r);if(e==="BMP")return p.saveAsBMP(this.getView(),t,!1,n,r);console.log("Not surport type "+e)},getElementsByMouseEvent:function(e,t){var r={},i=this.getView(),s=this._camera,o=i.getBoundingClientRect(),u=e.clientX,a=e.clientY;e.touches&&e.touches.length&&(u=e.touches[0].pageX,a=e.touches[0].pageY);var f=(u-o.left)/o.width,l=(a-o.top)/o.height;r.x=f*2-1,r.y=-l*2+1;var c=new n.Vec3(r.x,r.y,.5);this.projector.unprojectVector(c,s);var h=new n.Picking(s._position,c.sub(s._position).normalize(),s.up,null,null,this),p=new S;p.addAll(this.dataBox.getNodes()),p.addAll(this.dataBox.getBillboards());var d=h.intersectObjects(p.toArray(),!1,t);return d},getElementByScreenPoint:function(e,t,r){var i={},s=this.getView(),o=this._camera,u=s.getBoundingClientRect();e.x&&(r=t,t=e.y,e=e.x),e/=u.width,t/=u.height,i.x=e*2-1,i.y=-t*2+1;var a=new n.Vec3(i.x,i.y,.5);this.projector.unprojectVector(a,o);var f=new n.Picking(o._position,a.sub(o._position).normalize(),o.up,null,null,this),l=new S;l.addAll(this.dataBox.getNodes()),l.addAll(this.dataBox.getBillboards());var c=f.intersectObjects(l.toArray(),!1,r);return c},getFirstElementByMouseEvent:function(e,t,n){var r=this.getElementsByMouseEvent(e,t);if(r.length)for(var i=0;i<r.length;i++){var s=r[i],o=s.element;if(n==null||n.call(null,o))return s}return null},getUnProjectVector:function(e){var t={},r=this.getView().getBoundingClientRect(),i=e.x/r.width,s=e.y/r.height;t.x=i*2-1,t.y=-s*2+1;var o=new n.Vec3(t.x,t.y,.5);return this.projector.unprojectVector(o,this._camera),o},getFrustumByBounding:function(e){var t=e,r=this.getUnProjectVector(new s(t.x,t.y)),i=this.getUnProjectVector(new s(t.x+t.w,t.y)),o=this.getUnProjectVector(new s(t.x,t.y+t.h)),u=this.getUnProjectVector(new s(t.x+t.w,t.y+t.h)),a=this.getNearFarPoints(r),f=this.getNearFarPoints(i),l=this.getNearFarPoints(o),c=this.getNearFarPoints(u),h=new n.math.Plane,p=new n.math.Plane,d=new n.math.Plane,v=new n.math.Plane,m=new n.math.Plane,g=new n.math.Plane;h.setFromCoplanarPoints(a[0],f[0],l[0]),p.setFromCoplanarPoints(a[0],a[1],f[0]),d.setFromCoplanarPoints(a[0],l[0],a[1]),v.setFromCoplanarPoints(f[0],f[1],c[0]),m.setFromCoplanarPoints(l[0],c[0],l[1]),g.setFromCoplanarPoints(a[1],l[1],f[1]);var y=new n.Frustum(h,p,d,v,m,g);return y.setPoints([a[0],f[0],l[0],c[0],a[1],f[1],l[1],c[1]]),y},getNearFarPoints:function(e){var t=this._camera,n=e.sub(t._position).normalize(),r=t.target.clone().sub(t._position),i=n.angleTo(r),s=t.getNear()/Math.acos(i),o=t.getFar()/Math.acos(i),u=t._position.clone().add(n.clone().multiplyScalar(s)),a=t._position.clone().add(n.clone().multiplyScalar(o));return[u,a]},getSpacePointOnPlane:function(e,t){var r={},i=this.getView(),s=this._camera,o=i.getBoundingClientRect(),u=e.clientX,a=e.clientY;e.touches&&e.touches.length&&(u=e.touches[0].pageX,a=e.touches[0].pageY);var f=(u-o.left)/o.width,l=(a-o.top)/o.height;r.x=f*2-1,r.y=-l*2+1;var c=new n.Vec3(r.x,r.y,.5);this.projector.unprojectVector(c,s);var h=s._position,p=c.sub(s._position).normalize(),d=new n.Ray(h,p),v=d.distanceToPlane(t);if(v<0||Math.abs(v)<n.Picking.prototype.precision)return null;var m=d.at(v);return m},getElementsByBounding:function(e,t,r){var i=new S;i.addAll(this.dataBox.getNodes()),i.addAll(this.dataBox.getBillboards());var s=this.getFrustumByBounding(e),u=[],a=new o,f,l=this._camera;return i.forEach(function(e){if(e instanceof n.Billboard){a.setFromMatrixPosition(e.worldMatrix);var t=e.material,i=t.alignment;f=new n.Plane(1,1);if(i.x||i.y)f.setPosition(i.x,i.y,0),f=n.Utils.transformElement(f,!0);f.setPosition(a);var c=(new o).getScaleFromMatrix(e.worldMatrix);f.setScale(c.x,c.y,1);var h=l.getTarget().clone(),p=l.getPosition();h.sub(p);var d=f.getPosition().clone();t&&t.vertical&&(h.y=0),d.sub(h),f.lookAt(d),f.updateWorldMatrix(!0),s.intersectsObjectAccurate(f,r)&&u.push({element:e})}else e instanceof n.Line?s.intersectsObjectAccurate(e,r)&&u.push({element:e}):s.intersectsObjectAccurate(e,r)&&u.push({element:e})}),u},getViewPosition:function(e){var t=new o;t=this.projector.projectVector(e,this._camera,t),t.x=t.x/2+.5,t.y=-t.y/2+.5;var n={x:this._canvas.width*t.x,y:this._canvas.height*t.y,h:this._canvas.height};return n},setInteractions:function(e){var t=this._interactions,n,r;if(t)for(n=0;n<t.length;n++)r=t[n],r.tearDown();this._interactions=e;if(e)for(n=0;n<e.length;n++)r=e[n],r.setUp()},getInteractions:function(){return this._interactions},fireInteractionEvent
:function(e){this._interactionDispatcher.fire(e)},addInteractionListener:function(e,t,n){this._interactionDispatcher.add(e,t,n)},removeInteractionListener:function(e,t){this._interactionDispatcher.remove(e,t)},dispose:function(){},setRenderInterval:function(e){if(O.isNaN(e)||e<=5)e=5;this._renderInterval=e},_computeNetworkBoundingBox:function(){function c(e,t){e.applyMatrix4(t),a.push(e)}var e=this.getDataBox().size(),t=this.getDataBox().getDatas(),r,i,s,u,a=[];for(r=0;r<e;r++){i=t.get(r);if(i instanceof n.Node){s=i.getBoundingBox(),u=i.worldMatrix;var f=s.min,l=s.max;c(f.clone(),u),c(l.clone(),u),c(new o(f.x,f.y,l.z),u),c(new o(f.x,l.y,f.z),u),c(new o(l.x,f.y,f.z),u),c(new o(l.x,l.y,f.z),u),c(new o(l.x,f.y,l.z),u),c(new o(f.x,l.y,l.z),u)}}var h=new n.BoundingBox;return h.setFromPoints(a),h},getNetworkBoundingBox:function(){return this.boundingBox==null&&(this.boundingBox=this._computeNetworkBoundingBox()),this.boundingBox},zoomEstimateOverview:function(){var e=this.getNetworkBoundingBox(),t=e.center(),n=new o(0,e.max.y-e.min.y,e.max.z-e.min.z),r=new o(e.max.x-e.min.x,0,0,0),i=n.clone();i.length()<r.length()&&(i=r.clone());var s=(new o).addVectors(t,n.multiplyScalar(.5)),u=this._camera.fov,a=this._camera.aspect,f=i.length()/2/Math.tan(u*Math.PI/180);s.add(n.normalize().multiplyScalar(f)),this._camera.setPosition(s),this._camera.lookAt(t)}}),n.Network3DId=0,n.Network3D.GroupCache={_groupCounter:0};var U=function(){function W(){if(r===s){var e=new $RenderObject;return i.push(e),s++,r++,e}return i[r++]}function X(){if(u===f){var e=new $RenderVertex;return a.push(e),f++,u++,e}return a[u++]}function V(){if(c===p){var e=new n.RenderFace3;return h.push(e),p++,c++,e}return h[c++]}function $(){if(d===m){var e=new n.RenderFace4;return v.push(e),m++,d++,e}return v[d++]}function J(){if(y===w){var e=new n.RenderLine;return b.push(e),w++,y++,e}return b[y++]}function K(){if(S===T){var e=new n.RenderableParticle;return x.push(e),T++,S++,e}return x[S++]}function Q(e,t){return t.z-e.z}function G(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return i>=0&&s>=0&&o>=0&&u>=0?!0:i<0&&s<0||o<0&&u<0?!1:(i<0?n=Math.max(n,i/(i-s)):s<0&&(r=Math.min(r,i/(i-s))),o<0?n=Math.max(n,o/(o-u)):u<0&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerp(t,n),t.lerp(e,1-r),!0))}var e,r,i=[],s=0,o,u,a=[],f=0,l,c,h=[],p=0,d,v=[],m=0,g,y,b=[],w=0,E,S,x=[],T=0,N={objects:[],sprites:[],lights:[],elements:[]},C=new n.Vec3,k=new n.Vec4,L=new n.BoundingBox(new n.Vec3(-1,-1,-1),new n.Vec3(1,1,1)),A=new n.BoundingBox,O=new Array(3),M=new Array(4),_=new n.Mat4,D=new n.Mat4,P,H=new n.Mat4,B=new n.Mat3,j=new n.Mat3,F=new n.Vec3,I=new n.Frustum,q=new n.Vec4,R=new n.Vec4,U;this.projectVector=function(e,n,r){return n.worldMatrixInverse.getInverse(n.worldMatrix),D.multiplyMatrices(n.projectionMatrix,n.worldMatrixInverse),r===t?e.applyProjection(D):(r.copy(e),r.applyProjection(D))},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),D.multiplyMatrices(t.worldMatrix,t.projectionMatrixInverse),e.applyProjection(D)},this.pickingRay=function(e,t){e.z=-1;var r=new n.Vec3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(r,t),r.sub(e).normalize(),new n.Picking(e,r)};var z=function(t,i){r=0,N.objects.length=0,N.sprites.length=0,N.lights.length=0;var s=function(t){var r;t instanceof n.DataBox?r=t.getRoots():r=t.getChildren(),r=r.toList();for(var i=0,o=r.size();i<o;i++){var u=r.get(i);u.isSelected()&&u instanceof n.Node&&(r.add(u.createCanvasSelectionCube(),i),i++)}for(var i=0,o=r.size();i<o;i++){var u=r.get(i);if(u._visible===!1)continue;if(u instanceof n.Light)N.lights.push(u);else if(u instanceof n.Entity||u instanceof n.Line){if(u.frustumCulled===!1||I.intersectsObject(u)===!0)e=W(),e.object=u,u.renderDepth!==null?e.z=u.renderDepth:(C.copy(u.worldMatrix.getPosition()),C.applyProjection(D),e.z=C.z),N.objects.push(e)}else u instanceof n.Billboard||u instanceof n.Particle?(e=W(),e.object=u,u.renderDepth!==null?e.z=u.renderDepth:(C.copy(u.worldMatrix.getPosition()),C.applyProjection(D),e.z=C.z),N.sprites.push(e)):(e=W(),e.object=u,u.renderDepth!==null?e.z=u.renderDepth:(C.copy(u.worldMatrix.getPosition()),C.applyProjection(D),e.z=C.z),N.objects.push(e));s(u)}};return s(t),i===!0&&N.objects.sort(Q),N};this.projectDataBox=function(e,r,i,s){var f=!1,h,p,v,m,b,w,x,T,C,U,W,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt;c=0,d=0,y=0,S=0,N.elements.length=0;for(var vt=0;vt<e.getRoots().size();vt++){var mt=e.getRoots().get(vt);mt.updateWorldMatrix()}r.parent===t&&r.updateWorldMatrix(!0,!1),_.copy(r.worldMatrixInverse.getInverse(r.worldMatrix)),D.multiplyMatrices(r.projectionMatrix,_),j.getInverse(_),j.transpose(),I.setFromMatrix(D),N=z(e,i);for(h=0,p=N.objects.length;h<p;h++){Z=N.objects[h].object,P=Z.worldMatrix,u=0;if(Z instanceof n.Entity){et=Z,tt=et.vertices,it=et.faces,at=et.uvs,B.getInverse(P),B.transpose(),pt=Z.material instanceof n.ArrayMaterial,dt=pt===!0?Z.material:null;for(v=0,m=tt.length;v<m;v++)o=X(),o.positionWorld.copy(tt[v]).applyMatrix4(P),o.positionScreen.copy(o.positionWorld).applyMatrix4(D),o.positionScreen.x/=o.positionScreen.w,o.positionScreen.y/=o.positionScreen.w,o.positionScreen.z/=o.positionScreen.w,o.visible=!(o.positionScreen.x<-1||o.positionScreen.x>1||o.positionScreen.y<-1||o.positionScreen.y>1||o.positionScreen.z<-1||o.positionScreen.z>1);for(b=0,w=it.length;b<w;b++){st=it[b];var gt=pt===!0?dt.materials[st.materialIndex]:Z.material;if(gt===t)continue;var yt=gt.side;if(st instanceof n.Face3){ft=a[st.a],lt=a[st.b],ct=a[st.c],O[0]=ft.positionScreen,O[1]=lt.positionScreen,O[2]=ct.positionScreen;if(ft.visible!==!0&&lt.visible!==!0&&ct.visible!==!0&&!L.isIntersectionBox(A.setFromPoints(O)))continue;f=(ct.positionScreen.x-ft.positionScreen.x)*(lt.positionScreen.y-ft.positionScreen.y)-(ct.positionScreen.y-ft.positionScreen.y)*(lt.positionScreen.x-ft.positionScreen.x)<0;if(yt!==n.DoubleSide&&f!==(yt===n.FrontSide))continue;l=V(),l.v1.copy(ft),l.v2.copy(lt),l.v3.copy(ct)}else if(st instanceof n.Face4){ft=a[st.a],lt=a[st.b],ct=a[st.c],ht=a[st.d],M[0]=ft.positionScreen,M[1]=lt.positionScreen,M[2]=ct.positionScreen,M[3]=ht.positionScreen;if(ft.visible!==!0&&lt.visible!==!0&&ct.visible!==!0&&ht.visible!==!0&&!L.isIntersectionBox(A.setFromPoints(M)))continue;f=(ht.positionScreen.x-ft.positionScreen.x)*(lt.positionScreen.y-ft.positionScreen.y)-(ht.positionScreen.y-ft.positionScreen.y)*(lt.positionScreen.x-ft.positionScreen.x)<0||(lt.positionScreen.x-ct.positionScreen.x)*(ht.positionScreen.y-ct.positionScreen.y)-(lt.positionScreen.y-ct.positionScreen.y)*(ht.positionScreen.x-ct.positionScreen.x)<0;if(yt!==n.DoubleSide&&f!==(yt===n.FrontSide))continue;l=$(),l.v1.copy(ft),l.v2.copy(lt),l.v3.copy(ct),l.v4.copy(ht)}l.normalModel.copy(st.normal),f===!1&&(yt===n.BackSide||yt===n.DoubleSide)&&l.normalModel.negate(),l.normalModel.applyMatrix3(B).normalize(),l.normalModelView.copy(l.normalModel).applyMatrix3(j),l.centroidModel.copy(st.centroid).applyMatrix4(P),ot=st.vertexNormals;for(x=0,T=ot.length;x<T;x++){var bt=l.vertexNormalsModel[x];bt.copy(ot[x]),f===!1&&(yt===n.BackSide||yt===n.DoubleSide)&&bt.negate(),bt.applyMatrix3(B).normalize();var wt=l.vertexNormalsModelView[x];wt.copy(bt).applyMatrix3(j)}l.vertexNormalsLength=ot.length;var Et=at[b];for(W=0,Y=Et.length;W<Y;W++)l.uvs[0][W]=Et[W];l.color=st.color,l.material=gt,F.copy(l.centroidModel).applyProjection(D),l.z=F.z,N.elements.push(l)}}else if(Z instanceof n.Line){H.multiplyMatrices(D,P),tt=Z.vertices,ft=X(),ft.positionScreen.copy(tt[0]).applyMatrix4(H);var St=Z.type===n.LinePieces?2:1;for(v=1,m=tt.length;v<m;v++){ft=X(),ft.positionScreen.copy(tt[v]).applyMatrix4(H);if((v+1)%St>0)continue;lt=a[u-2],q.copy(ft.positionScreen),R.copy(lt.positionScreen),G(q,R)===!0&&(q.multiplyScalar(1/q.w),R.multiplyScalar(1/R.w),g=J(),g.v1.positionScreen.copy(q),g.v2.positionScreen.copy(R),g.z=Math.max(q.z,R.z),g.material=Z.material,N.elements.push(g))}}}for(h=0,p=N.sprites.length;h<p;h++)Z=N.sprites[h].object,P=Z.worldMatrix,Z instanceof n.Particle&&(k.set(P.elements[12],P.elements[13],P.elements[14],1),k.applyMatrix4(D),k.z/=k.w,k.z>0&&k.z<1&&(E=K(),E.object=Z,E.x=k.x/k.w,E.y=k.y/k.w,E.z=k.z,E.rotation=Z.rotation.z,E.scale.x=Z.scale.x*Math.abs(E.x-(k.x+r.projectionMatrix.elements[0])/(k.w+r.projectionMatrix.elements[12])),E.scale.y=Z.scale.y*Math.abs(E.y-(k.y+r.projectionMatrix.elements[5])/(k.w+r.projectionMatrix.elements[13])),E.material=Z.material,N.elements.push(E)));return s===!0&&N.elements.sort(Q),N}};n.Projector=U,n.Billboard=function(e){e!=null&&e.id!=null?this._id=e.id:this._id=e,n.Element.call(this,this._id),this.material=new n.BillboardMaterial,this.rotation3d=this._rotation,this.rotation=0,this.vertices=[new o(-0.5,-0.5,0),new o(.5,-0.5,0),new o(.5,.5,0),new o(-0.5,.5,0)]},n.extend(n.Billboard,n.Element,{constructor:n.Billboard,className:"TGL.Billboard",updateMatrix:function(){this.matrix.setPosition(this._position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this._scale.x!==1||this._scale.y!==1)&&this.matrix.scale(this._scale),this.matrixWorldNeedsUpdate=!0},clone:function(e){return e===t&&(e=new n.Billboard(this.material)),n.Element.prototype.clone.call(this,e),e},setMaterialStyle:function(e,t){var n=this.material.clone();e=e.substr(e.indexOf(".")+1),this._A97(n,e,t);var r=n.getUniqueCode(),i=$MaterialPool.getMaterial(r);i!=null?($MaterialPool.unUseMaterial(this.material),this.material=i,$MaterialPool.useMaterial(i)):($MaterialPool.unUseMaterial(this.material),$MaterialPool.setMaterial(r,n),this.material=n)}}),n.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","uniform bool vertical;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = (position + alignment) * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","vec4 upPosition;","vec4 rightPosition = vec4(scale.x,0.0,0.0,1.0);","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","if(vertical){","upPosition =  modelViewMatrix * vec4( 0.0, 1.0, 0.0, 1.0 ) - finalPosition;","normalize(upPosition);","}","if(vertical){","finalPosition.xyz += (rotatedPosition.x * rightPosition.xyz / scale.x) + (rotatedPosition.y * upPosition.xyz / scale.y);","}else{","finalPosition.xy += rotatedPosition;","}","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform int useMap;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","if(useMap > 0){","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","} else {","gl_FragColor = vec4( color, 1.0);","}","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},n.BillboardRenderer=function(){function a(t,n){var r=e.createProgram(),i=e.createShader(e.FRAGMENT_SHADER),s=e.createShader(e.VERTEX_SHADER),o="precision "+n+" float;\n";return e.shaderSource(i,o+t.fragmentShader),e.shaderSource(s,o+t.vertexShader),e.compileShader(i),e.compileShader(s),e.attachShader(r,i),e.attachShader(r,s),e.linkProgram(r),r}function f(e,t){return e.z!==t.z?t.z-e.z:1}var e,t,r,i={},s=new n.Billboard,u=new n.BillboardMaterial({color:255});this.init=function(s){e=s._gl,t=s,r=s.getPrecision(),i.vertices=new Float32Array(16),i.faces=new Uint16Array(6),i.lines=new Uint16Array(8);var o=0;i.vertices[o++]=-0.5,i.vertices[o++]=-0.5,i.vertices[o++]=0,i.vertices[o++]=0,i.vertices[o++]=.5,i.vertices[o++]=-0.5,i.vertices[o++]=1,i.vertices[o++]=0,i.vertices[o++]=.5,i.vertices[o++]=.5,i.vertices[o++]=1,i.vertices[o++]=1,i.vertices[o++]=-0.5,i.vertices[o++]=.5,i.vertices[o++]=0,i.vertices[o++]=1,o=0,i.faces[o++]=0,i.faces[o++]=1,i.faces[o++]=2,i.faces[o++]=0,i.faces[o++]=2,i.faces[o++]=3,o=0,i.lines[o++]=0,i.lines[o++]=1,i.lines[o++]=0,i.lines[o++]=3,i.lines[o++]=1,i.lines[o++]=2,i.lines[o++]=2,i.lines[o++]=3,i.vertexBuffer=e.createBuffer(),i.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,i.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i.faces,e.STATIC_DRAW),i.program=a(n.ShaderSprite.sprite,r),i.attributes={},i.uniforms={},i.attributes.position=e.getAttribLocation(i.program,"position"),i.attributes.uv=e.getAttribLocation(i.program,"uv"),i.uniforms.uvOffset=e.getUniformLocation(i.program,"uvOffset"),i.uniforms.uvScale=e.getUniformLocation(i.program,"uvScale"),i.uniforms.rotation=e.getUniformLocation(i.program,"rotation"),i.uniforms.scale=e.getUniformLocation(i.program,"scale"),i.uniforms.alignment=e.getUniformLocation(i.program,"alignment"),i.uniforms.color=e.getUniformLocation(i.program,"color"),i.uniforms.useMap=e.getUniformLocation(i.program,"useMap"),i.uniforms.map=e.getUniformLocation(i.program,"map"),i.uniforms.opacity=e.getUniformLocation(i.program,"opacity"),i.uniforms.vertical=e.getUniformLocation(i.program,"vertical"),i.uniforms.useScreenCoordinates=e.getUniformLocation(i.program,"useScreenCoordinates"),i.uniforms.sizeAttenuation=e.getUniformLocation(i.program,"sizeAttenuation"),i.uniforms.screenPosition=e.getUniformLocation(i.program,"screenPosition"),i.uniforms.modelViewMatrix=e.getUniformLocation(i.program,"modelViewMatrix"),i.uniforms.projectionMatrix=e.getUniformLocation(i.program,"projectionMatrix"),i.uniforms.fogType=e.getUniformLocation(i.program,"fogType"),i.uniforms.fogDensity=e.getUniformLocation(i.program,"fogDensity"),i.uniforms.fogNear=e.getUniformLocation(i.program,"fogNear"),i.uniforms.fogFar=e.getUniformLocation(i.program,"fogFar"),i.uniforms.fogColor=e.getUniformLocation(i.program,"fogColor"),i.uniforms.alphaTest=e.getUniformLocation(i.program,"alphaTest")},this.render=function(r,s,o,a,f){var l=new S(s),c=l.size();if(!c)return;var h=i.attributes,p=i.uniforms,d=a*.5,v=f*.5,m=!1;r.pm.currentProgram!=i.program&&(e.useProgram(i.program),r.pm.currentProgram=i.program,r._currentGroupHash=null,e.enableVertexAttribArray(h.position),e.enableVertexAttribArray(h.uv),e.disable(e.CULL_FACE),e.bindBuffer(e.ARRAY_BUFFER,i.vertexBuffer),e.vertexAttribPointer(h.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(h.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),this.enable=!0,m=!0),e.uniformMatrix4fv(p.projectionMatrix,!1,o.projectionMatrix.elements),m&&e.activeTexture(e.TEXTURE0),m&&e.uniform1i(p.map,0);var g=0,y=0,b=r.fog;b?(e.uniform3f(p.fogColor,b.color.r,b.color.g,b.color.b),b instanceof n.Fog?(e.uniform1f(p.fogNear,b.near),e.uniform1f(p.fogFar,b.far),e.uniform1i(p.fogType,1),g=1,y=1):b instanceof n.FogExp2&&(e.uniform1f(p.fogDensity,b.density),e.uniform1i(p.fogType,2),g=2,y=2)):(g=0,y=0);var w,E,x,T,N,C,k=[];for(w=0;w<c;w++){E=l.get(w),x=E.material;if(!t.isVisible(E)||x.opacity===0)continue;E.updateWorldMatrix(!0,!1),x.useScreenCoordinates?E.z=-E.position.z:(E._modelViewMatrix=new n.Mat4,E._modelViewMatrix.multiplyMatrices(o.worldMatrixInverse,E.worldMatrix),E.z=-E._modelViewMatrix.elements[14])}for(w=0;w<c;w++)E=l.get(w),this.renderBillboard(E,p,r,g,y),E._selected&&(E._scale.x=E._scale.x*1.01,E._scale.y=E._scale.y*1.01,E.material.clone(u),u.map=null,u.color.set(65280),this.renderBillboard(E,p,r,g,y,u),E._scale.x=E._scale.x/1.01,E._scale.y=E._scale.y/1.01)},this.disable=function(){if(this.enable){var r=i.attributes,s=i.uniforms;e.disableVertexAttribArray(r.position),e.disableVertexAttribArray(r.uv),t._oldDoubleSided||e.enable(e.CULL_FACE),t._oldBlending===n.NoBlending&&e.disable(e.BLEND),M.setDepthWrite(!0,t),this.enable=!1,this.lastMaterialId=null,t.pm.currentProgram=null}},this.renderBillboard=function(n,r,s,u,a,f){var l,c,h,p,d=[],v=new o;l=f?f:n.material;if(!t.isVisible(n)||l.opacity===0)return;var m=l.id,g=m!=this.lastMaterialId;g&&e.uniform1f(r.alphaTest,l.alphaTest),g&&(l.useScreenCoordinates===!0?(e.uniform1i(r.useScreenCoordinates,1),e.uniform3f(r.screenPosition,(n.position.x*t.devicePixelRatio-halfViewportWidth)/halfViewportWidth,(halfViewportHeight-n.position.y*t.devicePixelRatio)/halfViewportHeight,Math.max(0,Math.min(1,n.position.z)))):(e.uniform1i(r.useScreenCoordinates,0),e.uniform1i(r.sizeAttenuation,l.sizeAttenuation?1:0))),l.useScreenCoordinates===!0?(d[0]=t.devicePixelRatio,d[1]=t.devicePixelRatio):(e.uniformMatrix4fv(r.modelViewMatrix,!1,n._modelViewMatrix.elements),d[0]=1,d[1]=1),s.fog&&l.fog?p=a:p=0,u!==p&&(e.uniform1i(r.fogType,p),u=p),h=1/(l.scaleByViewport?viewportHeight:1),v.getScaleFromMatrix(n.worldMatrix),d[0]*=h*v.x,d[1]*=h*v.y,g&&(e.uniform2f(r.uvScale,l.uvScale.x,l.uvScale.y),e.uniform2f(r.uvOffset,l.uvOffset.x,l.uvOffset.y),e.uniform2f(r.alignment,l.alignment.x,l.alignment.y),e.uniform1f(r.opacity,l.opacity),e.uniform1i(r.vertical,l.vertical),e.uniform3f(r.color,l.color.r,l.color.g,l.color.b),e.uniform1f(r.rotation,n.rotation)),e.uniform2fv(r.scale,d),g&&(t.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst),t.setDepthTest(l.depthTest),t.setDepthWrite(l.depthMask)),l.map&&l.map._image&&t.pm.addTexture(l.map),g=l.map&&t.pm.needsUpdateTexture(l.map),l.map&&l.map._image&&l.map._image.width?(g&&t.setTexture(l.map,0),g&&e.uniform1i(r.useMap,1),l.map&&t.pm.changeTextureUpdateFlags(l.map)):g&&e.uniform1i(r.useMap,0),f?(g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),g&&e.bufferData(e.ELEMENT_ARRAY_BUFFER,i.lines,e.STATIC_DRAW),g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),e.drawElements(e.LINES,8,e.UNSIGNED_SHORT,0)):(g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),g&&e.bufferData(e.ELEMENT_ARRAY_BUFFER,i.faces,e.STATIC_DRAW),g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.elementBuffer),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)),this.lastMaterialId=l.id}};var q=function(e,r,i){this.width=e,this.height=r,i=i||{},this.wrapS=i.wrapS!==t?i.wrapS:n.ClampToEdgeWrapping,this.wrapT=i.wrapT!==t?i.wrapT:n.ClampToEdgeWrapping,this.magFilter=i.magFilter!==t?i.magFilter:n.LinearFilter,this.minFilter=i.minFilter!==t?i.minFilter:n.LinearMipMapLinearFilter,this.anisotropy=i.anisotropy!==t?i.anisotropy:1,this.offset=new n.Vec2(0,0),this.repeat=new n.Vec2(1,1),this.format=i.format!==t?i.format:n.RGBAFormat,this.type=i.type!==t?i.type:n.UnsignedByteType,this.depthBuffer=i.depthBuffer!==t?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==t?i.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null};q.prototype={constructor:q,clone:function(){var e=new q(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}},$CubeRendererTarget=function(e,t,n){q.call(this,e,t,n),this.activeCubeFace=0},n.extend($CubeRendererTarget,q,{});var z="l=1.0\ntype=1\ngis=0\n3d=1\nstart=2015-03-27\nend=2015-06-30\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=52d6ff61ec50368d6cda1ac26938255048ed26af51abc61bcb14028cf97b1245090fb53bb1e84ab9e5ef9a8d5ab6dab9ce3304f31c33a785d9c19f4265c0277d51dd358ed48d12a6e7cf64534ac8626ddc8d147dcb9ed7921fce4a61547ec6ae8b61660384c7c335b7ae0cafa46a7d58b3b57932f940c6130cb78f53d53b19ed5496acfc8802d4b66172b5495fa5524c5cf7f4e3ae19c848cb68f225882114e7ff409d92e32ce9356f843cf18e36b8d17f6a49e632e5a5831ff091113a6c1e319e371fb1d05425053a04e00179d4ccdf644f70c1b51b0a1e115a22f8b6972207805c8cb55229964772718f69282ec2ced7bfd2c19d4fa5f12b8a09ff3025af0338f6ac823a57e954b6099ec1c26aaca032116843c07136cdcd40c4f2d6ab5af6742123dc8f0bbe22df2e139432f9c509ea857febcff317e2a2eadb4ecb14901d75e5fc749180e16c8168f181fc06f8d2f405b2a37e2b449f574d505a4d589144dbd24a826e8190bce02d3087e14c38325318296bdbb53bc5114481af968add81607da7a23947dbbd9bdff51dc36196f9626a1446565675aa11424ec1153181fcbd227f4b271b6b7fea26ec40741b8781669ce06564cbce17c2c9d050ecd85833c9e85cb31ddf24755b43312088d0f1f5d2c750e22c3933e38100dd686b2ad52e109265cfbb248981c25e2f2ccc2525cb41d8078d0c191dd2bd4e62d5996ab972548188cd12c885c8929ce32edea2740f3eed33c8a553b6db04255e76adb3a14b2a611b98c0c798c02875c39b9b65e4e16132845614205fb22a2675ac5047105241114b7efa0126e9926e1e05ff65e25191a4bd5c6c04b1fa40fbfe21e9930ae00786ef38d240dceb4479742cd6008722d2f0358870f5fe9d1fd7530a1de73606",W,X=0xdeadbeefcafe,V=(X&16777215)==15715070;V&&navigator.appName=="Microsoft Internet Explorer"?($.prototype.am=Q,W=30):V&&navigator.appName!="Netscape"?($.prototype.am=K,W=26):($.prototype.am=G,W=28),$.prototype.DB=W,$.prototype.DM=(1<<W)-1,$.prototype.DV=1<<W;var Y=52;$.prototype.FV=Math.pow(2,Y),$.prototype.F1=Y-W,$.prototype.F2=2*W-Y;var Z="0123456789abcdefghijklmnopqrstuvwxyz",et=new Array,tt,nt;tt="0".charCodeAt(0);for(nt=0;nt<=9;++nt)et[tt++]=nt;tt="a".charCodeAt(0);for(nt=10;nt<36;++nt)et[tt++]=nt;tt="A".charCodeAt(0);for(nt=10;nt<36;++nt)et[tt++]=nt;Nt.prototype.convert=Ct,Nt.prototype.revert=kt,Nt.prototype.reduce=Lt,Nt.prototype.mulTo=At,Nt.prototype.sqrTo=Ot,_t.prototype.convert=Dt,_t.prototype.revert=Pt,_t.prototype.reduce=Ht,_t.prototype.mulTo=jt,_t.prototype.sqrTo=Bt,$.prototype.copyTo=st,$.prototype.fromInt=ot,$.prototype.fromString=at,$.prototype.clamp=ft,$.prototype.dlShiftTo=mt,$.prototype.drShiftTo=gt,$.prototype.lShiftTo=yt,$.prototype.rShiftTo=bt,$.prototype.subTo=wt,$.prototype.multiplyTo=Et,$.prototype.squareTo=St,$.prototype.divRemTo=xt,$.prototype.invDigit=Mt,$.prototype.isEven=Ft,$.prototype.exp=It,$.prototype.toString=lt,$.prototype.negate=ct,$.prototype.abs=ht,$.prototype.compareTo=pt,$.prototype.bitLength=vt,$.prototype.mod=Tt,$.prototype.modPowInt=qt,$.ZERO=ut(0),$.ONE=ut(1),_n.prototype.convert=Dn,_n.prototype.revert=Dn,_n.prototype.mulTo=Pn,_n.prototype.sqrTo=Hn,In.prototype.convert=qn,In.prototype.revert=Rn,In.prototype.reduce=Un,In.prototype.mulTo=Wn,In.prototype.sqrTo=zn;var Kn=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Qn=(1<<26)/Kn[Kn.length-1];$.prototype.chunkSize=Xt,$.prototype.toRadix=$t,$.prototype.fromRadix=Jt,$.prototype.fromNumber=Kt,$.prototype.bitwiseTo=en,$.prototype.changeBit=yn,$.prototype.addTo=Sn,$.prototype.dMultiply=On,$.prototype.dAddOffset=Mn,$.prototype.multiplyLowerTo=jn,$.prototype.multiplyUpperTo=Fn,$.prototype.modInt=$n,$.prototype.millerRabin=Yn,$.prototype.clone=Rt,$.prototype.intValue=Ut,$.prototype.byteValue=zt,$.prototype.shortValue=Wt,$.prototype.signum=Vt,$.prototype.toByteArray=Qt,$.prototype.equals=Gt,$.prototype.min=Yt,$.prototype.max=Zt,$.prototype.and=nn,$.prototype.or=sn,$.prototype.xor=un,$.prototype.andNot=fn,$.prototype.not=ln,$.prototype.shiftLeft=cn,$.prototype.shiftRight=hn,$.prototype.getLowestSetBit=dn,$.prototype.bitCount=mn,$.prototype.testBit=gn,$.prototype.setBit=bn,$.prototype.clearBit=wn,$.prototype.flipBit=En,$.prototype.add=xn,$.prototype.subtract=Tn,$.prototype.multiply=Nn,$.prototype.divide=kn,$.prototype.remainder=Ln,$.prototype.divideAndRemainder=An,$.prototype.modPow=Xn,$.prototype.modInverse=Jn,$.prototype.pow=Bn,$.prototype.gcd=Vn,$.prototype.isProbablePrime=Gn,$.prototype.square=Cn,Zn.prototype.init=er,Zn.prototype.next=tr;var rr=256,ir,sr,or;if(sr==null){sr=new Array,or=0;var fr;if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&e.crypto){var lr=e.crypto.random(32);for(fr=0;fr<lr.length;++fr)sr[or++]=lr.charCodeAt(fr)&255}while(or<rr)fr=Math.floor(65536*Math.random()),sr[or++]=fr>>>8,sr[or++]=fr&255;or=0,ar()}pr.prototype.nextBytes=hr;var dr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vr="=";Sr.prototype.doPublic=Tr,Sr.prototype.setPublic=xr,Sr.prototype.encrypt=Nr,Sr.prototype.doPrivate=Ar,Sr.prototype.setPrivate=kr,Sr.prototype.setPrivateEx=Lr,Sr.prototype.decrypt=Or;var Mr=function(){_r.v(z)},_r={},Dr="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",Pr="10001",Hr="61a921483dfa8f24e26204ace4d990b965d11e5bef5d8a5e768ebc5853a6bdd94b02369a3165207460fb91001d3fd83fbe69c6e51b8e40c8ae8a4e30a7c539dca98b44858bdc0b76f25af6803d4d13dacd9fa1a28f66cf561fa36309d4239a2cf50fe20ef0e99e01fc8701090f0685a524f411e00ca91f877d3b49d2d0052f9",Br="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047",jr="9360ab3d6b678727748ea004e85120f1823ec94e6116dc5fcd7b1c9ea231d38e5d7d2d23c00607912e1645835756b71290c6c3cc2bc656e93d9a4f6b0d55619f",Fr="3e61c2259d15b26693c8bac2eac4e0a44e1c6aa0adae2af2578aea54e796293a5fee9759293c98aab65b5d27063e43fe514e9f6b68fd581f54ab52f868bc6ad5",Ir="4dac2913d9c35a6be4f63647dfd8c23006a0e89fb273c5f987e656931490861b0612aef3a48489006ef5b5f51ed6c8edb3f7cdc191609af59a4df5854a25b1a9",qr="acd9837a1472711ff2b63ba0de667fa4a4a56a8b0f4cbb0a555f73d1bc529e9ecf865b709fd8235c3db05bcf1539de1e594d3a8275fe0784a9f5241d8895b328";_r.cross=function(e){if(e){var t="";for(var n=0;n<e.length;)n+1<e.length?(t+=e[n+1],t+=e[n]):t+=e[n],n+=2;return t}return null},_r.reverse=function(e){if(e){var t="";for(var n=e.length;n>0;n--)t+=e[n-1];return t}return null},_r.v=function(e){if(e){var t=_r;t.start=null,t.beginDate=null,t.end=null,t.endDate=null,t.gis=null,t["3D"]=null,t["3d"]=null,t.l=null,t.__li__=null;if(e.indexOf("signature=")>0){var n=e.split("signature="),r=n[0],i=n[1],s=new Sr;s.setPublic(Dr,Pr);var o=i,u=o.length,a=256,f=0,l="",c="";while(f<u)l=o.substr(f,a),c+=s.decrypt(l),f+=a;if(c===r)return t.i(e),!0}}return!1},_r.i=function(e){var n=_r;n.__li__=e;var r=e.split("\n"),i,s,o,u,a;for(i=0;i<r.length;i++)s=r[i],a=s.split("="),o=a[0],u=a[1],n[o]=u;n.start!=t&&(n.beginDate=new Date(Date.parse(n.start.replace(/-/g,"/")))),n.end!=t&&(n.endDate=new Date(Date.parse(n.end.replace(/-/g,"/"))));var f=n.gis;f!=t&&(f=parseInt(f)),f&&(n._isPermissionGIS=!0);var l=n["3D"]||n["3d"];l!=t&&(l=parseInt(l)),l&&(n._isPermission3D=!0),n.l!=t&&(n.version=n.l)};var Rr=function(e){return e.__li__!==t&&e._isPermission3D},Ur=function(e){if(!Rr(e))return!0;var t=new Date;return e.beginDate!=null&&e.beginDate.getTime()-t.getTime()>=0||e.endDate!=null&&e.endDate.getTime()-t.getTime()<=0},zr=function(e){return e.type===2?!0:!1},Wr=function(e){return Ur(e)?!1:e._isPermissionGIS};_r.$z=function(e){var t=new Sr;t.setPublic(Dr,Pr);var n=e,r=n.length,i=256,s=0,o="",u="";while(s<r)o=n.substr(s,i),u+=t.decrypt(o),s+=i;return u},_r.twm=function(e){var n=_r,r=n.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),i=this.type,s=this.markText,o=n.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");e[o]=n.__li__;var u=e;u._xyz=null;if(i==="3"&&!Ur(_r)&&s===t)return;e.DEBUG&&(console.log("license: "+_r.__li__),console.log("license Type : "+i),console.log("beginDate: "+_r.beginDate),console.log("endDate: "+_r.endDate),console.log("mark: "+s)),e.__liLabel==t&&(e.__liLabel=document.createElement("div")),n.startDate===t&&(n.startDate=new Date);var a=(new Date).getTime()-n.startDate.getTime(),f=i==="2"?7200:300;if(a<1e3*f)return;var l=Ur(n)&&a>1e3*f,c=s;l?c=n.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):i!="2"||c!==t&&c!=""?i=="1"&&!s&&(c=r):c=n.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc");if(c===t)return;var h=u.__liLabel;h.innerHTML=c,h.type=i,h.mark=s,h.expired=l,u._xyz=h,l&&(u.getView().style.opacity=.1)},O.validateLicense(z),n.Material=function(e){n.PropertyChangeDispatcher.call(this),this.id=n.MaterialIdCount++,this.type="basic",this.shaderID="",this.uniforms=t,this.vertexShader="",this.fragmentShader="",this.alarmColor=null,this.name="",this.side=n.FrontSide,this.fog=!0,this.normalType=t,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.blendMode=n.NormalBlending,this.blendSrc=n.SrcAlphaFactor,this.blendDst=n.OneMinusSrcAlphaFactor,this.blendEquation=n.AddEquation,this.depthTest=!0,this.depthMask=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.transparent=!1,this.opacity=1,this.visible=!0,this.needsUpdate=!0,this.setValues(e),this.useCount=0,this.styleMap={},this.offset=new s(0,0),this.repeat=new s(1,1),this.gradient={},this.gradientType=1,this.gradientCenter=new s(.5,.5),this.outline=0},n.extend(n.Material,n.PropertyChangeDispatcher,{generateKey:function(){},setMap:function(e,t){t==null&&(t="map");if(this[t]===e)return;var n=this[t];this[t]=e,this.firePropertyChange(t,n,e),this.onMapChanged(n,e)},handleTextureChange:function(e){if(e.property==="image"){var t=this;this.firePropertyChange("needsUpdate",!1,!0)}else e.property==="disposed"},onPropertyChange:function(e,t,n){},onMapChanged:function(e,t){},setColor:function(e){if(this.color===e)return;var t=this.color.clone();e instanceof n.Color?this.color.copy(e):this.color.set(e),this.firePropertyChange("color",t,e)},setPropertyValue:function(e,t){if(this[e]===t)return;var r=this[e];if(r instanceof n.Color)t!=null&&(r=r.clone(),t instanceof n.Color?this[e].copy(t):this[e].set(t));else if(e=="gradient"){var i={};for(var s in t)t[s]instanceof n.Color?i[s]=t[s]:i[s]=new n.Color(t[s]);this[e]=i}else this[e]=t;this._uniqueCode=null,this.firePropertyChange(e,r,t)},isTextureStyle:function(e){return this._type==="terrain"?e.startsWith("texture1.")||e.startsWith("texture2.")||e.startsWith("textureb.")||e.startsWith("texturen.")||e.startsWith("texturebp."):e.startsWith("texture.")||e.startsWith("lightmap")||e.startsWith("envmap")||e.startsWith("normalmap")||e.startsWith("specularmap")},setNeedsUpdate:function(e){},getShaderID:function(){return this instanceof n.BasicMaterial&&(this.shaderID="basic"),this.shaderID},setupMaterialShader:function(){var e=this.getShaderID(),t=n.ShaderLib[e];this.uniforms=n.UniformsUtils.clone(t.uniforms),this.vertexShader=
t.vertexShader,this.fragmentShader=t.fragmentShader},refreshUniforms:function(e,t){this.refreshUniformsCommon(e,t),this.refreshUniformsSpecific(e,t)},loadCameraPosition:function(e,t,r){if(this instanceof n.ShaderMaterial||this instanceof n.PhongMaterial||this.envMap||this._type==="phong")if(e.cameraPosition!=null){var i=t.worldMatrix.getPosition();r.uniform3f(e.cameraPosition,i.x,i.y,i.z)}},loadViewMatrix:function(e,t,n){(this.type==="lambert"||this.type==="phong"||material.skinning)&&e.viewMatrix!==null&&n.uniformMatrix4fv(p_uniforms.viewMatrix,!1,t.worldMatrixInverse.elements)},refreshUniformsSpecific:function(e){},refreshUniformsCommon:function(e){var r=this.uniforms,i=this;r.opacity.value=i.opacity;var s=O.getObjectCount(this.gradient)>0;e?r.diffuse.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.color):r.diffuse.value=this.alarmColor?this.alarmColor:this.color;if(s){var o=[],u=[];for(var a in this.gradient)o.push(a);o.sort();for(var f=0;f<o.length;f++)u.push(this.gradient[o[f]]);r.gradientColor.value=u,r.gradientStop.value=o,r.gradientType.value=this.gradientType}r.map.value=i.map,r.lightMap.value=i.lightMap,r.specularMap.value=i.specularMap,i.bumpMap&&(r.bumpMap.value=i.bumpMap,r.bumpScale.value=i.bumpScale),i.normalMap&&(r.normalMap.value=i.normalMap,r.normalScale.value.copy(i.normalScale));var l;i.map?l=i.map:i.specularMap?l=i.specularMap:i.normalMap?l=i.normalMap:i.bumpMap&&(l=i.bumpMap);if(l!=t){var c=this.offset,h=this.repeat;r.offsetRepeat.value.set(c.x,c.y,h.x,h.y),r.flipX.value=l.flipX?1:0,r.mapLoaded.value=1,l._image&&!l._image.loaded&&r.offsetRepeat.value.set(0,0,1,1)}r.envMap.value=i.envMap,r.flipEnvMap.value=1,e?r.reflectivity.value=i.reflectRatio*i.reflectRatio:r.reflectivity.value=i.reflectRatio,r.refractionRatio.value=i.refractionRatio,r.combine.value=i.combine,r.useRefract.value=i.envMap&&i.envMap.mapping instanceof n.CubeRefractionMapping},loadGeneralUniforms:function(){},getNormalType:function(){var e=this&&this.normalType!==t&&this.normalType===n.NormalTypeSmooth;return e?n.SmoothShading:n.FlatShading},isVertexColor:function(){return this.vertexColors?this.vertexColors:!1},needUV:function(){return this.map||this.lightMap||this.bumpMap||this.normalMap||this.specularMap?!0:!0},setValues:function(e){if(e===t)return;for(var r in e){var i=e[r];if(i===t){console.warn("TGL.Material: '"+r+"' parameter is undefined.");continue}if(r in this){var s=this[r];s instanceof n.Color&&i instanceof n.Color?s.copy(i):s instanceof n.Color?s.set(i):s instanceof n.Vec3&&i instanceof n.Vec3?s.copy(i):this[r]=i}}},isCustomAttributesNeedUpdate:function(){if(!this.attributes)return!1;for(var e in this.attributes)if(this.attributes[e].needsUpdate)return!0;return!1},clearCustomAttributes:function(){if(this.attributes)for(var e in this.attributes)this.attributes[e].needsUpdate=!1},clone:function(e){return e===t&&(e=new n.Material),e.name=this.name,e.side=this.side,e.blendMode=this.blendMode,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthMask=this.depthMask,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.transparent=this.transparent,e.opacity=this.opacity,e.visible=this.visible,e.normalType=this.normalType,e.wireframe=this.wireframe,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.wireframeLinewidth=this.wireframeLinewidth,e.gradient=this.gradient,e.gradientType=this.gradientType,e.outline=this.outline,e},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),n.MaterialIdCount=0,n.EntityMaterial=function(e){n.Material.call(this),this._type="basic",this.color=new n.Color(16777215),this.map=null,this.ambient=new n.Color(16777215),this.emissive=new n.Color(0),this.specular=new n.Color(1118481),this.specularStrength=1,this.shininess=30,this.wrapAround=!1,this.wrapRGB=new n.Vec3(1,1,1),this.lightMap=null,this.specularMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vec2(1,1),this.envMap=null,this.combine=n.MultiplyOperation,this.reflectRatio=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.metal=!1,this.perPixel=!0,this.map1=null,this.map2=null,this.blendMap=null,this.detailMap=null,this.specularMap=null,this.blendRange=new s(0,1),this.setValues(e)},n.extend(n.EntityMaterial,n.Material,{getShaderID:function(){return this.getType()},getUniqueCode:function(){if(this._uniqueCode!=null)return this._uniqueCode;var e=this._type+" "+this.color.r+this.color.g+this.color.b+" "+this.ambient.getUniqueCode()+" "+this.emissive.getUniqueCode()+this.specular.getUniqueCode()+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+""+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth+" "+this.polygonOffset+" "+this.polygonOffsetFactor+" "+this.polygonOffsetUnits+" "+this.overdraw+" "+this.shininess+" "+this.metal+" "+this.specularStrength;this.alphaTest&&(e+=this.alphaTest),this.normalType&&(e+=this.normalType+" "),e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,e+=" "+this.blendRange.x+" "+this.blendRange.y,e+=" "+this.normalScale.x+" "+this.normalScale.y,e+=" "+this.reflectRatio,this.map&&(e+=this.map.getUniqueCode()),this.map1&&(e+=this.map1.getUniqueCode()),this.map2&&(e+=this.map2.getUniqueCode()),this.blendMap&&(e+=this.blendMap.getUniqueCode()),this.normalMap&&(e+=this.normalMap.getUniqueCode()),this.lightMap&&(e+=this.lightMap.getUniqueCode()),this.envMap&&(e+=this.envMap.getUniqueCode()),this.specularMap&&(e+=this.specularMap.getUniqueCode()),this.alarmColor&&(e+=" "+this.alarmColor.getUniqueCode());if(this.gradient)for(var t in this.gradient)e+=" "+t+":"+this.gradient[t].getUniqueCode();return e+=" "+this.gradientType,e+=" "+this.outline,this._uniqueCode=e,e},loadViewMatrix:function(e,t,n){(this._type==="lambert"||this._type==="phong"||material.skinning)&&e.viewMatrix!==null&&n.uniformMatrix4fv(p_uniforms.viewMatrix,!1,t.worldMatrixInverse.elements)},onMapChanged:function(e,t){n.TexturePool.useTexture(t),n.TexturePool.unUseTexture(e);if(t){var r=t.getUniqueCode();n.TexturePool.getTexture(r)==null&&n.TexturePool.setTexture(r,t)}},setType:function(e){if(this._type===e)return;var t=this._type;this._type=e,this.firePropertyChange("type",t,e),this.onTypeChanged(t,e)},onTypeChanged:function(){},getType:function(){return this._type},setStyle:function(e,t){if(e==null)return;this.styleMap==null&&(this.styleMap={});var r=this.styleMap[e];return t==null?delete this.styleMap[e]:this.styleMap[e]=t,this.firePropertyChange(n.Styles.PREFIX_STYLE+e,r,t),this.onStyleChanged(e,r,t),this},getStyle:function(e,t){t==null&&(t=!0);var r;return this.styleMap!=null&&(r=this.styleMap[e]),r==null&&t&&(r=n.Styles.getStyle(e)),r},clone:function(e){return e=e||new n.EntityMaterial,n.Material.prototype.clone.call(this,e),e._type=this._type,e.color.copy(this.color),e.setMap(this.map,"map"),e.setMap(this.map1,"map1"),e.setMap(this.map2,"map2"),e.setMap(this.blendMap,"blendMap"),e.setMap(this.normalMap,"normalMap"),e.setMap(this.specularMap,"specularMap"),e.setMap(this.envMap,"envMap"),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.setMap(this.lightMap,"lightMap"),e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalScale.copy(this.normalScale),e.combine=this.combine,e.reflectRatio=this.reflectRatio,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e.specularStrength=this.specularStrength,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.blendRange.copy(this.blendRange),e},refreshUniformsSpecific:function(e){var t=this.uniforms;this._type==="lambert"?(e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive),this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)):this._type==="phong"&&(t.shininess.value=this.shininess,e?(t.ambient.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.ambient),t.emissive.value.copyGammaToLinear(this.emissive),t.specular.value.copyGammaToLinear(this.specular)):(t.ambient.value=this.alarmColor?this.alarmColor:this.ambient,t.emissive.value=this.emissive,t.specular.value=this.specular),t.uspecularStrength.value=this.specularStrength,this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB))},refreshUniformsCommon:function(e){if(this._type==="terrain"){var t=this.uniforms;t.enableDiffuse1.value=this.map?1:0,t.tDiffuse1.value=this.map,t.enableDiffuse2.value=this.map1?1:0,t.tDiffuse2.value=this.map1,t.enableDiffuse3.value=this.map2?1:0,t.tDiffuse3.value=this.map2,t.enableDisplacement.value=this.blendMap?1:0,t.tDisplacement.value=this.blendMap,t.uRepeatOverlay.value=this.repeat,this.blendRangeArray==null&&(this.blendRangeArray=[0,1]),this.blendRangeArray[0]=this.blendRange.x,this.blendRangeArray[1]=this.blendRange.y,t.blendRange.value=this.blendRangeArray}else if(this._type==="outline"){var t=this.uniforms;t.diffuse.value=this.color,t.outline_offset.value=this.outline}else n.Material.prototype.refreshUniformsCommon.call(this,e)}}),n.BlurMaterial=function(){n.Material.call(this),this.orientation=0,this.blurAmount=5,this.blurScale=1,this.blurStrength=1,this.useBlur=1,this.texelSize=new s(512,512),this.blurGlobalAlpha=1},n.extend(n.BlurMaterial,n.Material,{refreshUniformsCommon:function(e){var t=this.uniforms;t.map.value=this.map,t.orientation.value=this.orientation,t.blurAmount.value=this.blurAmount,t.blurScale.value=this.blurScale,t.blurStrength.value=this.blurStrength,t.useBlur.value=this.useBlur,t.texelSize.value=this.texelSize,t.blurGlobalAlpha.value=this.blurGlobalAlpha},getShaderID:function(){return"blur"}}),n.DeferredMaterial=function(e){e=e||{},n.Material.call(this,e),this.linearDepth=30,this.isNormal=e.isNormal!==t?e.isNormal:0},n.extend(n.DeferredMaterial,n.Material,{getShaderID:function(){return"deferred"},refreshUniformsCommon:function(e){var t=this.uniforms;t.linearDepth.value=this.linearDepth,t.isNormal.value=this.isNormal}}),n.SSAOMaterial=function(e){n.Material.call(this),this.map1=null,this.map2=null,this.occluderBias=.05,this.samplingRadius=20,this.attenuation=new s(1,.02),this.texelSize=new s(1/512,1/512)},n.extend(n.SSAOMaterial,n.Material,{getShaderID:function(){return"ssao"},refreshUniformsCommon:function(e){var t=this.uniforms;t.map0.value=this.map,t.map1.value=this.map1,t.map2.value=this.map2,t.occluderBias.value=this.occluderBias,t.samplingRadius.value=this.samplingRadius,t.attenuation.value=this.attenuation,t.texelSize.value=this.texelSize}}),n.BasicMaterial=function(e){n.Material.call(this),this._type="basic",this.color=new n.Color(16777215),this.map=null,this.setValues(e),this.offset=new s(0,0),this.repeat=new s(1,1)},n.extend(n.BasicMaterial,n.Material,{getShaderID:function(){return"basic"},clone:function(){var e=new n.BasicMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e},getUniqueCode:function(){var e=this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+""+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(e+=this.map.getUniqueCode()),e}}),n.LambertMaterial=function(e){n.Material.call(this),this._type="basic",this.color=new n.Color(16777215),this.ambient=new n.Color(16777215),this.emissive=new n.Color(0),this.wrapAround=!1,this.wrapRGB=new n.Vec3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},n.extend(n.LambertMaterial,n.Material,{clone:function(){var e=new n.LambertMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},getShaderID:function(){return"lambert"},refreshUniformsSpecific:function(e){var t=this.uniforms;e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive),this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)}}),n.PhongMaterial=function(e){n.Material.call(this),this._type="basic",this.color=new n.Color(16777215),this.ambient=new n.Color(16777215),this.emissive=new n.Color(0),this.specular=new n.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new n.Vec3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new n.Vec2(1,1),this.specularMap=null,this.envMap=null,this.combine=n.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=n.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e),this.offset=new s(0,0),this.repeat=new s(1,1)},n.extend(n.PhongMaterial,n.Material,{getUniqueCode:function(){var e="phong "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+""+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(e+=this.map.getUniqueCode()),e},clone:function(){var e=new n.PhongMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},getShaderID:function(){return"phong"},refreshUniformsSpecific:function(e){var t=this.uniforms;t.shininess.value=this.shininess,e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive),t.specular.value.copyGammaToLinear(this.specular)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive,t.specular.value=this.specular),this.wrapAround&&t.wrapRGB.value.copy(material.wrapRGB)}}),n.LineMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.dashed=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},n.extend(n.LineMaterial,n.Material,{clone:function(){var e=new n.LineMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.dashed=this.dashed,e.scale=this.scale,e.dashSize=this.dashSize,matetial.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},getShaderID:function(){return this.dashed?"dashed":"basic"},refreshUniforms:function(e){Xr(this.uniforms,this),this.dashed&&Vr(this.uniforms,this)}}),n.ArrayMaterial=function(e){this.materials=e||[]},n.extend(n.ArrayMaterial,Object,{clone:function(){var e=new n.ArrayMaterial;for(var t=0;t<this.materials.length;t++){var r=this.materials[t],i=this.materials.indexOf(r);e.materials[i]!=null?e.materials.push(e.materials[i]):e.materials.push(r.clone())}return e}}),n.BillboardMaterial=function(e){n.Material.call(this),this.alignment=n.BillboardAlignment.center.clone(),this.fog=!1,this.color=new n.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.uvOffset=new n.Vec2(0,0),this.uvScale=new n.Vec2(1,1),this.transparent=!0,this.setValues(e),this.depthMask=!0,this.vertical=!1,this.alphaTest=.5},n.extend(n.BillboardMaterial,n.Material,{clone:function(e){return e=e?e:new n.BillboardMaterial,n.Material.prototype.clone.call(this,e),e.alignment.copy(this.alignment),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e.vertical=this.vertical,e.transparent=this.transparent,e.alphaTest=this.alphaTest,e},getUniqueCode:function(){var e="Billboard "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+""+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.vertical+" "+this.alphaTest+" "+this.alignment.x+" "+this.alignment.y,this.map&&(e+=this.map.getUniqueCode()),e}}),n.BillboardAlignment={},n.BillboardAlignment.topLeft=new n.Vec2(.5,-0.5),n.BillboardAlignment.topCenter=new n.Vec2(0,-0.5),n.BillboardAlignment.topRight=new n.Vec2(-0.5,-0.5),n.BillboardAlignment.centerLeft=new n.Vec2(.5,0),n.BillboardAlignment.center=new n.Vec2(0,0),n.BillboardAlignment.centerRight=new n.Vec2(-0.5,0),n.BillboardAlignment.bottomLeft=new n.Vec2(.5,.5),n.BillboardAlignment.bottomCenter=new n.Vec2(0,.5),n.BillboardAlignment.bottomRight=new n.Vec2(-0.5,.5);var $r=function(e){n.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shaderID=e.shaderID||"depth",this._type="shader",this.shading=n.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=n.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)};n.ShaderMaterial=$r,n.extend(n.ShaderMaterial,n.Material,{clone:function(){var e=new n.ShaderMaterial;return n.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=n.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},needUV:function(){return!0},getShaderID:function(){return null},refreshUniformsCommon:function(e,t){}}),n.TransformGizmoMaterial=function(e){n.BasicMaterial.call(this),this.depthTest=!1,this.depthMask=!1,this.side=n.DoubleSide,this.transparent=!0,this.setValues(e)},n.extend(n.TransformGizmoMaterial,n.BasicMaterial,{getUniqueCode:function(){var e=this.id+"TransformGizmo "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+""+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return this.map&&(e+=this.map.getUniqueCode()),e}}),$MaterialPool={pools:{},useTimes:{},size:0,getMaterial:function(e){return $MaterialPool.pools[e]},setMaterial:function(e,t){$MaterialPool.size++,$MaterialPool.pools[e]=t},useMaterial:function(e){if(e){var t=e.id,n=$MaterialPool.useTimes[t]||0;n++,$MaterialPool.useTimes[t]=n}},unUseMaterial:function(e){if(e){var t=e.id,n=$MaterialPool.useTimes[t]||0;n--,$MaterialPool.useTimes[t]=n;if(n<=0){var r=e.getUniqueCode();delete $MaterialPool.pools[r],$MaterialPool.size--,e.dispose()}}}},n.MaterialPool=$MaterialPool,$MaterialPool.DefaultMaterial=new n.EntityMaterial,$MaterialPool.TestMaterial=new n.EntityMaterial,$MaterialPool.DefaultBillBoardMaterial=new n.BillboardMaterial,$MaterialPool.DefaultLineMaterial=new n.LineMaterial,$StylePool={pools:{},useTimes:{},size:0,getMaterial:function(e){return $MaterialPool.pools[e]},setMaterial:function(e,t){$StylePool.size++,$StylePool.pools[e]=t},useMaterial:function(e){if(e){var t=e.id,n=$StylePool.useTimes[t]||0;n++,$StylePool.useTimes[t]=n}},unUseMaterial:function(e){if(e){var t=e.id,n=$StylePool.useTimes[t]||0;n--,$StylePool.useTimes[t]=n;if(n<=0){var r=e.getUniqueCode();delete $StylePool.pools[r],$StylePool.size--,e.dispose()}}}},n.ParticleMaterial=function(e){n.Material.call(this),this.color=new n.Color(16777215),this.map=null,this.size=2,this.sizeAttenuation=!1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},n.extend(n.ParticleMaterial,n.Material,{clone:function(){var e=new n.ParticleMaterial;return n.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},getShaderID:function(){return this.shaderID="particle_basic",this.shaderID},refreshUniforms:function(e){Jr(this.uniforms,this)}}),n.Light=function(e,t){n.Element.call(this,t),this.color=new n.Color(e),this.ambient=new n.Color,this.diffuse=new n.Color,this.specular=new n.Color,this.castShadow=!1,this.onlyShadow=!1},n.extend(n.Light,n.Element,{__accessor:["color","ambient","diffuse","specular"],constructor:n.Light,className:"TGL.Light",setCastShadow:function(e){this.castShadow=e},setOnlyShadow:function(e){this.onlyShadow=e},refreshShadowUniforms:function(e,t){var r=this;if(e.shadowMatrix&&r.castShadow)if(r instanceof n.SpotLight||r instanceof n.DirectionalLight&&!r.shadowCascade)return e.shadowMap.value[t]=r.shadowMap,e.shadowMapSize.value[t]=r.shadowMapSize,e.shadowMatrix.value[t]=r.shadowMatrix,e.shadowDarkness.value[t]=r.shadowDarkness,e.shadowBias.value[t]=r.shadowBias,!0},refreshUniformsPointShadow:function(e,t){var r=this;if(e.pShadowMap&&r.castShadow&&r instanceof n.PointLight)return e.pShadowMap.value[t]=r.shadowMap,e.pShadowMapSize.value[t]=r.shadowMapSize,e.pShadowDarkness.value[t]=r.shadowDarkness||.5,e.pPosition.value[t]=r.getPosition(),!0}}),n.PositionLight=function(){},n.PointLight=function(e,r,i,s){if(arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var o=arguments[0];e=o.hex,r=o.intensity,i=o.intensity,s=o.id}n.Light.call(this,e,s),this.position=new n.Vec3(0,0,0),this.intensity=r!==t?r:1,this.distance=i!==t?i:0,this.shadowCameraNear=10,this.shadowCameraFar=1e4,this.shadowMapWidth=512,this.shadowMapHeight=512},n.extend(n.PointLight,n.Light,{constructor:n.PointLight,className:"TGL.PointLight",__accessor:["intensity","distance"]}),n.SpotLight=function(e,r,i,s,o){n.Light.call(this,e),this._position=new n.Vec3(0,1,0),this.target=new n.Element,this.intensity=r!==t?r:1,this.distance=i!==t?i:0,this.angle=s!==t?s:Math.PI/2,this.exponent=o!==t?o:10,this.shadowCameraNear=100,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},n.extend(n.SpotLight,n.Light,{__accessor:["color","ambient","diffuse","specular","intensity","distance","angle","exponent"],constructor:n.SpotLight,className:"TGL.SpotLight"}),n.DirectionalLight=function(e,r,i){if(arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var s=arguments[0];e=s.hex,r=s.intensity,i=s.id}n.Light.call(this,e,i),this.direction=new n.Vec3(0,1,0),this.position=new n.Vec3(0,1,0),this.target=new n.Element,this.intensity=r!==t?r:1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new n.Vec3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},n.extend(n.DirectionalLight,n.Light,{className:"TGL.DirectionalLight"}),n.AmbientLight=function(e,t){if(arguments.length===1&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];e=r.hex,t=r.id}n.Light.call(this,e,t)},n.extend(n.AmbientLight,n.Light,{constructor:n.AmbientLight,className:"TGL.AmbientLight",clone:function(){var e=new n.AmbientLight;return n.Light.prototype.clone.call(this,e),e}}),n.Camera=function(){n.Element.call(this),this.projectionMatrix=new n.Mat4,this.projectionMatrixInverse=new n.Mat4,this.worldMatrixInverse=new n.Mat4,this.target=new n.Vec3,this.setPosition(0,0,500)},n.extend(n.Camera,n.Element,{constructor:n.Camera,updateCameraMatrix:function(e){var t=this.matrix.clone();this.matrix.lookAt(this._position,this.target,this.up),this.rotationAutoUpdate&&this._rotation.setEulerFromRotationMatrix(this.matrix),!t.equals(this.matrix)&&e&&this.firePropertyChange("matrix",t,this.matrix)},lookAt:function(e,n){n===t&&(n=!0),this.target=e,this.updateCameraMatrix(n)},look:function(e){this.lookAt(e,!0)},onUpChanged:function(e,t){this.updateCameraMatrix()},getTarget:function(){return this.target},getDistance:function(){return(new o).subVectors(this._position,this.target).length()},lookAtElement:function(e,t){e instanceof n.Element&&(t=t?t:this.getDistance(),this.setPosition(e.frontWorldPosition(t)),this.look(e.getWorldPosition()))}}),n.OrthoCamera=function(e,r,i,s,o,u){n.Camera.call(this),this.left=e,this.right=r,this.top=i,this.bottom=s,this.near=o!==t?o:.1,this.far=u!==t?u:2e3,this.updateProjectionMatrix()},n.extend(n.OrthoCamera,n.Camera,{constructor:n.OrthoCamera,className:"TGL.OrthoCamera",__accessor:["left","right","top","bottom","near","far"],updateProjectionMatrix:function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()}}),n.PerspectiveCamera=function(e,r,i,s){n.Camera.call(this),this.fov=e!==t?e:50,this.aspect=r!==t?r:1,this.near=i!==t?i:.1,this.far=s!==t?s:1e4,this.updateProjectionMatrix()},n.extend(n.PerspectiveCamera,n.Camera,{constructor:n.PerspectiveCamera,className:"TGL.PerspectiveCamera",__accessor:["fov","aspect","near","far"],updateProjectionMatrix:function(){this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()}}),n.CameraHelper=function(e){function c(e,t,n){h(e,n),h(t,n)}function h(e,i){r.vertices.push(new n.Vec3),r.colors.push(new n.Color(i)),s[e]===t&&(s[e]=[]),s[e].push(r.vertices.length-1)}var r=new n.Entity,i=new n.LineMaterial({color:16777215,vertexColors:n.FaceColors}),s={},o=16755200,u=16711680,a=43775,f=16777215,l=3355443;c("n1","n2",o),c("n2","n4",o),c("n4","n3",o),c("n3","n1",o),c("f1","f2",o),c("f2","f4",o),c("f4","f3",o),c("f3","f1",o),c("n1","f1",o),c("n2","f2",o),c("n3","f3",o),c("n4","f4",o),c("p","n1",u),c("p","n2",u),c("p","n3",u),c("p","n4",u),c("u1","u2",a),c("u2","u3",a),c("u3","u1",a),c("c","t",f),c("p","c",l),c("cn1","cn2",l),c("cn3","cn4",l),c("cf1","cf2",l),c("cf3","cf4",l),n.Line.call(this,r.vertices,r.colors,i,n.LinePieces),this.camera=e,this.worldMatrix=e.worldMatrix,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()},n.CameraHelper.prototype=Object.create(n.Line.prototype),n.CameraHelper.prototype.update=function(){var e=new n.Vec3,r=new n.Camera,i=new n.Projector;return function(){function u(s,o,u,a){e.set(o,u,a),i.unprojectVector(e,r);var f=n.pointMap[s];if(f!==t)for(var l=0,c=f.length;l<c;l++)n.vertices[f[l]].copy(e)}var n=this,s=1,o=1;r.projectionMatrix.copy(this.camera.projectionMatrix),u("c",0,0,-1),u("t",0,0,1),u("n1",-s,-o,-1),u("n2",s,-o,-1),u("n3",-s,o,-1),u("n4",s,o,-1),u("f1",-s,-o,1),u("f2",s,-o,1),u("f3",-s,o,1),u("f4",s,o,1),u("u1",s*.7,o*1.1,-1),u("u2",-s*.7,o*1.1,-1),u("u3",0,o*2,-1),u("cf1",-s,0,1),u("cf2",s,0,1),u("cf3",0,-o,1),u("cf4",0,o,1),u("cn1",-s,0,-1),u("cn2",s,0,-1),u("cn3",0,-o,-1),u("cn4",0,o,-1),this.verticesNeedUpdate=!0}}();var Kr=function(){n.Element.call(this)};Kr.prototype=Object.create(n.Element.prototype),Kr.prototype.updateworldMatrix=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.worldMatrixNeedsUpdate||e)this._parent?(this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrix.decompose(this.translationWorld,this.QuatWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.QuatObject,this.scaleObject),this.worldMatrix.compose(this.translationWorld,this.QuatObject,this.scaleWorld)):this.worldMatrix.copy(this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0;for(var t=0,n=this.getChildren().size();t<n;t++)this.getChildren().get(t).updateworldMatrix(e)},Kr.prototype.translationWorld=new n.Vec3,Kr.prototype.translationObject=new n.Vec3,Kr.prototype.QuatWorld=new n.Quat,Kr.prototype.QuatObject=new n.Quat,Kr.prototype.scaleWorld=new n.Vec3,Kr.prototype.scaleObject=new n.Vec3;var Qr=function(){function v(e,t){var r=new n.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];var i=r.pointsWorld,s=r.pointsFrustum;for(var o=0;o<8;o++)i[o]=new n.Vec3,s[o]=new n.Vec3;var u=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t];return s[0].set(-1,-1,u),s[1].set(1,-1,u),s[2].set(-1,1,u),s[3].set(1,1,u),s[4].set(-1,-1,a),s[5].set(1,-1,a),s[6].set(-1,1,a),s[7].set(1,1,a),r}function m(e,t){var n=e.shadowCascadeArray[t];n.position.copy(e.position),n.target.position.copy(e.target.position),n.lookAt(n.target),n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],i=e.shadowCascadeFarZ[t],s=n.pointsFrustum;s[0].z=r,s[1].z=r,s[2].z=r,s[3].z=r,s[4].z=i,s[5].z=i,s[6].z=i,s[7].z=i}function g(e,t){var n=t.shadowCamera,r=t.pointsFrustum,i=t.pointsWorld;h.set(Infinity,Infinity,Infinity),p.set(-Infinity,-Infinity,-Infinity);for(var s=0;s<8;s++){var o=i[s];o.copy(r[s]),Qr.__projector.unprojectVector(o,e),o.applyMatrix4(n.worldMatrixInverse),o.x<h.x&&(h.x=o.x),o.x>p.x&&(p.x=o.x),o.y<h.y&&(h.y=o.y),o.y>p.y&&(p.y=o.y),o.z<h.z&&(h.z=o.z),o.z>p.z&&(p.z=o.z)}n.left=h.x,n.right=p.x,n.top=p.y,n.bottom=h.y,n.updateProjectionMatrix()}function y(e){return e.material instanceof n.ArrayMaterial?e.material.materials[0]:e.material}var e,r,i,u,a,f,l=new n.Frustum,c=new n.Mat4,h=new n.Vec3,p=new n.Vec3,d=new n.Vec3;this.init=function(t){e=t._gl,r=t;var s=n.ShaderLib.depthRGBA,o=n.UniformsUtils.clone(s.uniforms);i=new $r({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:o}),_depthCubeMaterial=new $r({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:o,refreshUniformsCommon:function(e){this.uniforms.isCube.value=1}}),u=new $r({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:o,morphTargets:!0}),a=new $r({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms
:o,skinning:!0}),f=new $r({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:o,morphTargets:!0,skinning:!0}),i._shadowPass=!0,u._shadowPass=!0,a._shadowPass=!0,f._shadowPass=!0},this.render=function(e,t){if(!r._shadowMapEnable)return;this.update(e,t)},this.update=function(h,p){var b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P=[],H=0,B=null;e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),r.shadowMapCullFace===n.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),r.setDepthTest(!0);var j=h.getLights();for(b=0,w=j.size();b<w;b++){_=j.get(b);if(!_.castShadow)continue;if(_ instanceof n.DirectionalLight&&_.shadowCascade)for(x=0;x<_.shadowCascadeCount;x++){var F;if(!_.shadowCascadeArray[x]){F=v(_,x),F.originalCamera=p;var I=new Kr;I.position=_.shadowCascadeOffset,I.add(F),I.add(F.target),p.add(I),_.shadowCascadeArray[x]=F}else F=_.shadowCascadeArray[x];m(_,x),P[H]=F,H++}else P[H]=_,H++}for(b=0,w=P.length;b<w;b++){_=P[b];if(!_.shadowMap){var R=n.LinearFilter;r.shadowMapType===n.PCFSoftShadowMap&&(R=n.NearestFilter);var U={minFilter:R,magFilter:R,format:n.RGBAFormat};_ instanceof n.PointLight?(_.shadowMap=new $CubeRendererTarget(_.shadowMapWidth,_.shadowMapHeight,U),_.shadowMapSize=new s(_.shadowMapWidth,_.shadowMapHeight),_.shadowMatrix=new n.Mat4):(_.shadowMap=new q(_.shadowMapWidth,_.shadowMapHeight,U),_.shadowMapSize=new s(_.shadowMapWidth,_.shadowMapHeight),_.shadowMatrix=new n.Mat4)}if(!_.shadowCamera){if(_ instanceof n.SpotLight)_.shadowCamera=new n.PerspectiveCamera(_.shadowCameraFov,_.shadowMapWidth/_.shadowMapHeight,_.shadowCameraNear,_.shadowCameraFar);else if(_ instanceof n.DirectionalLight)_.shadowCamera=new n.OrthoCamera(_.shadowCameraLeft,_.shadowCameraRight,_.shadowCameraTop,_.shadowCameraBottom,_.shadowCameraNear,_.shadowCameraFar);else{if(!(_ instanceof n.PointLight)){console.error("Unsupported light type for shadow");continue}_.shadowCamera=new n.PerspectiveCamera(90,1,_.shadowCameraNear,_.shadowCameraFar)}_.shadowCamera.updateWorldMatrix();var z=h.getRoots(),W=z.size(),X;for(var V=0;V<W;V++)X=z.get(V),X.updateWorldMatrix()}_.shadowCameraVisible&&!_.cameraHelper&&(_.cameraHelper=new n.CameraHelper(_.shadowCamera),_.shadowCamera.addChild(_.cameraHelper),_.shadowCamera.updateWorldMatrix(!0),r.helperBox.add(_.shadowCamera),r.helperBox.add(_.cameraHelper)),_.isVirtual&&F.originalCamera==p&&g(p,_);var $=_ instanceof n.PointLight?6:1,J=[new o(1,0,0),new o(-1,0,0),new o(0,1,0),new o(0,-1,0),new o(0,0,1),new o(0,0,-1)];for(var H=0;H<$;H++){if(_.debugFace!=null&&H!=_.debugFace)continue;T=_.shadowMap,N=_.shadowMatrix,C=_.shadowCamera,C._position.setFromMatrixPosition(_.worldMatrix),_.target?d.setFromMatrixPosition(_.target.worldMatrix):d=C._position.clone().add(J[H]),C.lookAt(d),C.updateWorldMatrix(!0),C.worldMatrixInverse.getInverse(C.worldMatrix),_.cameraHelper&&(_.cameraHelper.visible=_.shadowCameraVisible),_.shadowCameraVisible&&_.cameraHelper.update(),N.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),N.multiply(C.projectionMatrix),N.multiply(C.worldMatrixInverse),c.multiplyMatrices(C.projectionMatrix,C.worldMatrixInverse),l.setFromMatrix(c),T.activeCubeFace=H,r.debugPointLight==t&&r.setRenderTarget(T),r.clear(),D=r.glNodeList;for(E=0,S=D.length;E<S;E++)O=D[E],M=O.node,O.render=!1,M._visible&&M.castShadow&&(!(M instanceof n.Node||M instanceof n.Particle)||!M.frustumCulled||l.intersectsObject(M))&&(M._modelViewMatrix.multiplyMatrices(C.worldMatrixInverse,M.worldMatrix),O.render=!0);var K,Q,G;for(E=0,S=D.length;E<S;E++)O=D[E],O.render&&(M=O.node,L=O.group,K=y(M),Q=!1,G=!1,M.customDepthMaterial?A=M.customDepthMaterial:G?A=Q?f:a:Q?A=u:$==1?A=i:A=_depthCubeMaterial,M instanceof n.BufferNode||r.renderGroup(C,h.getLights(),A,L,M))}}var Y=r.getClearColor(),Z=r.getClearAlpha();e.clearColor(Y.r,Y.g,Y.b,Z),e.enable(e.BLEND),r.shadowMapCullFace===n.CullFaceFront&&e.cullFace(e.BACK)}};Qr.__projector=new n.Projector,n.Picking=function(e,t,r,i,s,o){this.network=o,this.origin=e,this.cameraUp=r,this.direction=t,this.near=i||0,this.far=s||Infinity,this.ray=new n.Ray(e,t),this.ray.direction.length>0&&this.ray.direction.normalize()},n.Picking.testPlane=new n.Plane(1,1),n.Picking.prototype={constructor:n.Picking,precision:1e-4,linePrecision:2,matrixPosition:new n.Vec3,set:function(e,t){this.origin=e,this.direction=t,this.ray.set(e,t),this.ray.direction.length>0&&this.ray.direction.normalize()},intersectObject:function(e,t,n){var r=[];return t===!0&&ii(e,this,r,n),ri(e,this,r,n),r.sort(ni),r},intersectObjects:function(e,t,n){e._as&&(e=e._as);var r=[];for(var i=0,s=e.length;i<s;i++)ri(e[i],this,r,n,this.network),t===!0&&ii(e[i],this,r,n,this.network);return r.sort(ni),r}};var Gr=new n.Ray,Yr=new n.Mat4,Zr=new n.math.Plane,ei=new n.Vec3,ti=new n.BoundingSphere,oi=function(e){arguments.length>0&&this.init(e)};oi.prototype.init=function(e){this.status=e,this.points=new Array},oi.prototype.appendPoint=function(e){this.points.push(e)},oi.prototype.appendPoints=function(e){this.points=this.points.concat(e)},oi.intersectShapes=function(e,t){var n=e.getIntersectionParams(),r=t.getIntersectionParams(),i;if(n!=null&&r!=null)if(n.name=="Path")i=oi.intersectPathShape(e,t);else if(r.name=="Path")i=oi.intersectPathShape(t,e);else{var s,o;n.name<r.name?(s="intersect"+n.name+r.name,o=n.params.concat(r.params)):(s="intersect"+r.name+n.name,o=r.params.concat(n.params));if(!(s in oi))throw new Error("Intersection not available: "+s);i=oi[s].apply(null,o)}else i=new oi("No Intersection");return i},oi.intersectPathShape=function(e,t){return e.intersectShape(t)},oi.intersectBezier2Bezier2=function(e,t,n,r,i,o){var u,a,f,l,c,h,p,d,v=new oi("No Intersection"),m;u=t.multiply(-2),f=e.add(u.add(n)),u=e.multiply(-2),a=t.multiply(2),l=u.add(a),c=new s(e.x,e.y),u=i.multiply(-2),h=r.add(u.add(o)),u=r.multiply(-2),a=i.multiply(2),p=u.add(a),d=new s(r.x,r.y);if(f.y==0){var g=f.x*(c.y-d.y),y=g-l.x*l.y,b=g+y,w=l.y*l.y;m=new Polynomial(f.x*h.y*h.y,2*f.x*p.y*h.y,f.x*p.y*p.y-h.x*w-h.y*g-h.y*y,-p.x*w-p.y*g-p.y*y,(c.x-d.x)*w+(c.y-d.y)*y)}else{var g=f.x*h.y-f.y*h.x,y=f.x*p.y-p.x*f.y,b=l.x*f.y-l.y*f.x,w=c.y-d.y,E=f.y*(c.x-d.x)-f.x*w,S=-l.y*b+f.y*E,x=b*b;m=new Polynomial(g*g,2*g*y,(-h.y*x+f.y*y*y+f.y*g*E+g*S)/f.y,(-p.y*x+f.y*y*E+y*S)/f.y,(w*x+E*S)/f.y)}var T=m.getRoots();for(var N=0;N<T.length;N++){var C=T[N];if(0<=C&&C<=1){var k=(new Polynomial(f.x,l.x,c.x-d.x-C*p.x-C*C*h.x)).getRoots(),L=(new Polynomial(f.y,l.y,c.y-d.y-C*p.y-C*C*h.y)).getRoots();if(k.length>0&&L.length>0){var A=1e-4;e:for(var O=0;O<k.length;O++){var M=k[O];if(0<=M&&M<=1)for(var _=0;_<L.length;_++)if(Math.abs(M-L[_])<A){v.points.push(h.multiply(C*C).add(p.multiply(C).add(d)));break e}}}}}return v.points.length>0&&(v.status="$Intersection"),v},oi.intersectBezier2Bezier3=function(e,t,n,r,i,o,u){var a,f,l,c,h,p,d,v,m,g,y,b=new oi("No Intersection");a=t.multiply(-2),h=e.add(a.add(n)),a=e.multiply(-2),f=t.multiply(2),p=a.add(f),d=new s(e.x,e.y),a=r.multiply(-1),f=i.multiply(3),l=o.multiply(-3),c=a.add(f.add(l.add(u))),v=new Vector2D(c.x,c.y),a=r.multiply(3),f=i.multiply(-6),l=o.multiply(3),c=a.add(f.add(l)),m=new Vector2D(c.x,c.y),a=r.multiply(-3),f=i.multiply(3),l=a.add(f),g=new Vector2D(l.x,l.y),y=new Vector2D(r.x,r.y);var w=d.x*d.x,E=d.y*d.y,S=p.x*p.x,x=p.y*p.y,T=h.x*h.x,N=h.y*h.y,C=y.x*y.x,k=y.y*y.y,L=g.x*g.x,A=g.y*g.y,O=m.x*m.x,M=m.y*m.y,_=v.x*v.x,D=v.y*v.y,P=new Polynomial(-2*h.x*h.y*v.x*v.y+T*D+N*_,-2*h.x*h.y*m.x*v.y-2*h.x*h.y*m.y*v.x+2*N*m.x*v.x+2*T*m.y*v.y,-2*h.x*g.x*h.y*v.y-2*h.x*h.y*g.y*v.x-2*h.x*h.y*m.x*m.y+2*g.x*N*v.x+N*O+T*(2*g.y*v.y+M),2*d.x*h.x*h.y*v.y+2*d.y*h.x*h.y*v.x+p.x*p.y*h.x*v.y+p.x*p.y*h.y*v.x-2*y.x*h.x*h.y*v.y-2*h.x*y.y*h.y*v.x-2*h.x*g.x*h.y*m.y-2*h.x*h.y*g.y*m.x-2*d.x*N*v.x-2*d.y*T*v.y+2*y.x*N*v.x+2*g.x*N*m.x-x*h.x*v.x-S*h.y*v.y+T*(2*y.y*v.y+2*g.y*m.y),2*d.x*h.x*h.y*m.y+2*d.y*h.x*h.y*m.x+p.x*p.y*h.x*m.y+p.x*p.y*h.y*m.x-2*y.x*h.x*h.y*m.y-2*h.x*y.y*h.y*m.x-2*h.x*g.x*h.y*g.y-2*d.x*N*m.x-2*d.y*T*m.y+2*y.x*N*m.x-x*h.x*m.x-S*h.y*m.y+L*N+T*(2*y.y*m.y+A),2*d.x*h.x*h.y*g.y+2*d.y*h.x*g.x*h.y+p.x*p.y*h.x*g.y+p.x*p.y*g.x*h.y-2*y.x*h.x*h.y*g.y-2*h.x*y.y*g.x*h.y-2*d.x*g.x*N-2*d.y*T*g.y+2*y.x*g.x*N-x*h.x*g.x-S*h.y*g.y+2*T*y.y*g.y,-2*d.x*d.y*h.x*h.y-d.x*p.x*p.y*h.y-d.y*p.x*p.y*h.x+2*d.x*h.x*y.y*h.y+2*d.y*y.x*h.x*h.y+p.x*y.x*p.y*h.y+p.x*p.y*h.x*y.y-2*y.x*h.x*y.y*h.y-2*d.x*y.x*N+d.x*x*h.x+d.y*S*h.y-2*d.y*T*y.y-y.x*x*h.x-S*y.y*h.y+w*N+E*T+C*N+T*k),H=P.getRootsInInterval(0,1);for(var B=0;B<H.length;B++){var j=H[B],F=(new Polynomial(h.x,p.x,d.x-y.x-j*g.x-j*j*m.x-j*j*j*v.x)).getRoots(),I=(new Polynomial(h.y,p.y,d.y-y.y-j*g.y-j*j*m.y-j*j*j*v.y)).getRoots();if(F.length>0&&I.length>0){var q=1e-4;e:for(var R=0;R<F.length;R++){var U=F[R];if(0<=U&&U<=1)for(var z=0;z<I.length;z++)if(Math.abs(U-I[z])<q){b.points.push(v.multiply(j*j*j).add(m.multiply(j*j).add(g.multiply(j).add(y))));break e}}}}return b.points.length>0&&(b.status="Intersection"),b},oi.intersectBezier2Circle=function(e,t,n,r,i){return oi.intersectBezier2Ellipse(e,t,n,r,i,i)},oi.intersectBezier2Ellipse=function(e,t,n,r,i,o){var u,a,f,l,c,h=new oi("No Intersection");u=t.multiply(-2),f=e.add(u.add(n)),u=e.multiply(-2),a=t.multiply(2),l=u.add(a),c=new s(e.x,e.y);var p=i*i,d=o*o,v=(new Polynomial(d*f.x*f.x+p*f.y*f.y,2*(d*f.x*l.x+p*f.y*l.y),d*(2*f.x*c.x+l.x*l.x)+p*(2*f.y*c.y+l.y*l.y)-2*(d*r.x*f.x+p*r.y*f.y),2*(d*l.x*(c.x-r.x)+p*l.y*(c.y-r.y)),d*(c.x*c.x+r.x*r.x)+p*(c.y*c.y+r.y*r.y)-2*(d*r.x*c.x+p*r.y*c.y)-p*d)).getRoots();for(var m=0;m<v.length;m++){var g=v[m];0<=g&&g<=1&&h.points.push(f.multiply(g*g).add(l.multiply(g).add(c)))}return h.points.length>0&&(h.status="Intersection"),h},oi.intersectBezier2Line=function(e,t,n,r,i){var o,u,a,f,l,c,h,p=r.min(i),d=r.max(i),v=new oi("No Intersection");o=t.multiply(-2),a=e.add(o.add(n)),o=e.multiply(-2),u=t.multiply(2),f=o.add(u),l=new s(e.x,e.y),h=new Vector2D(r.y-i.y,i.x-r.x),c=r.x*i.y-i.x*r.y,roots=(new Polynomial(h.dot(a),h.dot(f),h.dot(l)+c)).getRoots();for(var m=0;m<roots.length;m++){var g=roots[m];if(0<=g&&g<=1){var y=e.lerp(t,g),b=t.lerp(n,g),w=y.lerp(b,g);r.x==i.x?p.y<=w.y&&w.y<=d.y&&(v.status="Intersection",v.appendPoint(w)):r.y==i.y?p.x<=w.x&&w.x<=d.x&&(v.status="Intersection",v.appendPoint(w)):w.gte(p)&&w.lte(d)&&(v.status="Intersection",v.appendPoint(w))}}return v},oi.intersectBezier2Polygon=function(e,t,n,r){var i=new oi("No Intersection"),s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=oi.intersectBezier2Line(e,t,n,u,a);i.appendPoints(f.points)}return i.points.length>0&&(i.status="Intersection"),i},oi.intersectBezier2Rectangle=function(e,t,n,r,i){var o=r.min(i),u=r.max(i),a=new s(u.x,o.y),f=new s(o.x,u.y),l=oi.intersectBezier2Line(e,t,n,o,a),c=oi.intersectBezier2Line(e,t,n,a,u),h=oi.intersectBezier2Line(e,t,n,u,f),p=oi.intersectBezier2Line(e,t,n,f,o),d=new oi("No Intersection");return d.appendPoints(l.points),d.appendPoints(c.points),d.appendPoints(h.points),d.appendPoints(p.points),d.points.length>0&&(d.status="Intersection"),d},oi.intersectBezier3Bezier3=function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y,b,w=new oi("No Intersection");a=e.multiply(-1),f=t.multiply(3),l=n.multiply(-3),c=a.add(f.add(l.add(r))),h=new Vector2D(c.x,c.y),a=e.multiply(3),f=t.multiply(-6),l=n.multiply(3),c=a.add(f.add(l)),p=new Vector2D(c.x,c.y),a=e.multiply(-3),f=t.multiply(3),l=a.add(f),d=new Vector2D(l.x,l.y),v=new Vector2D(e.x,e.y),a=i.multiply(-1),f=s.multiply(3),l=o.multiply(-3),c=a.add(f.add(l.add(u))),m=new Vector2D(c.x,c.y),a=i.multiply(3),f=s.multiply(-6),l=o.multiply(3),c=a.add(f.add(l)),g=new Vector2D(c.x,c.y),a=i.multiply(-3),f=s.multiply(3),l=a.add(f),y=new Vector2D(l.x,l.y),b=new Vector2D(i.x,i.y);var E=v.x*v.x,S=v.x*v.x*v.x,x=v.y*v.y,T=v.y*v.y*v.y,N=d.x*d.x,C=d.x*d.x*d.x,k=d.y*d.y,L=d.y*d.y*d.y,A=p.x*p.x,O=p.x*p.x*p.x,M=p.y*p.y,_=p.y*p.y*p.y,D=h.x*h.x,P=h.x*h.x*h.x,H=h.y*h.y,B=h.y*h.y*h.y,j=b.x*b.x,F=b.x*b.x*b.x,I=b.y*b.y,q=b.y*b.y*b.y,R=y.x*y.x,U=y.x*y.x*y.x,z=y.y*y.y,W=g.x*g.x,X=g.x*g.x*g.x,V=g.y*g.y,$=m.x*m.x,J=m.x*m.x*m.x,K=m.y*m.y,Q=m.y*m.y*m.y,G=new Polynomial(-P*Q+B*J-3*h.x*H*$*m.y+3*D*h.y*m.x*K,-6*h.x*g.x*H*m.x*m.y+6*D*h.y*g.y*m.x*m.y+3*g.x*B*$-3*P*g.y*K-3*h.x*H*g.y*$+3*D*g.x*h.y*K,-6*y.x*h.x*H*m.x*m.y-6*h.x*g.x*H*g.y*m.x+6*D*g.x*h.y*g.y*m.y+3*y.x*B*$+3*W*B*m.x+3*y.x*D*h.y*K-3*h.x*y.y*H*$-3*h.x*W*H*m.y+D*h.y*m.x*(6*y.y*m.y+3*V)+P*(-y.y*K-2*V*m.y-m.y*(2*y.y*m.y+V)),d.x*p.y*h.x*h.y*m.x*m.y-d.y*p.x*h.x*h.y*m.x*m.y+6*y.x*g.x*B*m.x+3*d.x*p.x*h.x*h.y*K+6*v.x*h.x*H*m.x*m.y-3*d.x*p.x*H*m.x*m.y-3*d.y*p.y*h.x*h.y*$-6*v.y*D*h.y*m.x*m.y-6*b.x*h.x*H*m.x*m.y+3*d.y*p.y*D*m.x*m.y-2*p.x*M*h.x*m.x*m.y-6*y.x*h.x*g.x*H*m.y-6*y.x*h.x*H*g.y*m.x-6*h.x*y.y*g.x*H*m.x+6*y.x*D*h.y*g.y*m.y+2*A*p.y*h.y*m.x*m.y+X*B-3*v.x*B*$+3*v.y*P*K+3*b.x*B*$+_*h.x*$-O*h.y*K-3*v.x*D*h.y*K+3*v.y*h.x*H*$-2*d.x*p.y*D*K+d.x*p.y*H*$-d.y*p.x*D*K+2*d.y*p.x*H*$+3*b.x*D*h.y*K-p.x*M*h.y*$-3*b.y*h.x*H*$+A*p.y*h.x*K-3*h.x*W*H*g.y+D*h.y*m.x*(6*b.y*m.y+6*y.y*g.y)+D*g.x*h.y*(6*y.y*m.y+3*V)+P*(-2*y.y*g.y*m.y-b.y*K-g.y*(2*y.y*m.y+V)-m.y*(2*b.y*m.y+2*y.y*g.y)),6*d.x*p.x*h.x*h.y*g.y*m.y+d.x*p.y*h.x*g.x*h.y*m.y+d.x*p.y*h.x*h.y*g.y*m.x-d.y*p.x*h.x*g.x*h.y*m.y-d.y*p.x*h.x*h.y*g.y*m.x-6*d.y*p.y*h.x*g.x*h.y*m.x-6*v.x*g.x*B*m.x+6*b.x*g.x*B*m.x+6*v.y*P*g.y*m.y+2*_*h.x*g.x*m.x-2*O*h.y*g.y*m.y+6*v.x*h.x*g.x*H*m.y+6*v.x*h.x*H*g.y*m.x+6*v.y*h.x*g.x*H*m.x-3*d.x*p.x*g.x*H*m.y-3*d.x*p.x*H*g.y*m.x+2*d.x*p.y*g.x*H*m.x+4*d.y*p.x*g.x*H*m.x-6*v.x*D*h.y*g.y*m.y-6*v.y*D*g.x*h.y*m.y-6*v.y*D*h.y*g.y*m.x-4*d.x*p.y*D*g.y*m.y-6*b.x*h.x*g.x*H*m.y-6*b.x*h.x*H*g.y*m.x-2*d.y*p.x*D*g.y*m.y+3*d.y*p.y*D*g.x*m.y+3*d.y*p.y*D*g.y*m.x-2*p.x*M*h.x*g.x*m.y-2*p.x*M*h.x*g.y*m.x-2*p.x*M*g.x*h.y*m.x-6*b.y*h.x*g.x*H*m.x-6*y.x*h.x*y.y*H*m.x-6*y.x*h.x*g.x*H*g.y+6*b.x*D*h.y*g.y*m.y+2*A*p.y*h.x*g.y*m.y+2*A*p.y*g.x*h.y*m.y+2*A*p.y*h.y*g.y*m.x+3*y.x*W*B+3*R*B*m.x-3*h.x*y.y*W*H-3*R*h.x*H*m.y+D*g.x*h.y*(6*b.y*m.y+6*y.y*g.y)+D*h.y*m.x*(6*b.y*g.y+3*z)+y.x*D*h.y*(6*y.y*m.y+3*V)+P*(-2*b.y*g.y*m.y-m.y*(2*b.y*g.y+z)-y.y*(2*y.y*m.y+V)-g.y*(2*b.y*m.y+2*y.y*g.y)),d.x*y.x*p.y*h.x*h.y*m.y+d.x*p.y*h.x*y.y*h.y*m.x+d.x*p.y*h.x*g.x*h.y*g.y-d.y*p.x*y.x*h.x*h.y*m.y-d.y*p.x*h.x*y.y*h.y*m.x-d.y*p.x*h.x*g.x*h.y*g.y-6*d.y*y.x*p.y*h.x*h.y*m.x-6*v.x*y.x*B*m.x+6*b.x*y.x*B*m.x+2*y.x*_*h.x*m.x+6*v.x*y.x*h.x*H*m.y+6*v.x*h.x*y.y*H*m.x+6*v.x*h.x*g.x*H*g.y+6*v.y*y.x*h.x*H*m.x-3*d.x*p.x*y.x*H*m.y-3*d.x*p.x*y.y*H*m.x-3*d.x*p.x*g.x*H*g.y+2*d.x*y.x*p.y*H*m.x+4*d.y*p.x*y.x*H*m.x-6*v.y*y.x*D*h.y*m.y-6*v.y*D*y.y*h.y*m.x-6*v.y*D*g.x*h.y*g.y-6*b.x*y.x*h.x*H*m.y-6*b.x*h.x*y.y*H*m.x-6*b.x*h.x*g.x*H*g.y+3*d.y*y.x*p.y*D*m.y-3*d.y*p.y*h.x*W*h.y+3*d.y*p.y*D*y.y*m.x+3*d.y*p.y*D*g.x*g.y-2*p.x*y.x*M*h.x*m.y-2*p.x*y.x*M*h.y*m.x-2*p.x*M*h.x*y.y*m.x-2*p.x*M*h.x*g.x*g.y-6*b.y*y.x*h.x*H*m.x-6*y.x*h.x*y.y*g.x*H+6*b.y*D*y.y*h.y*m.x+2*A*y.x*p.y*h.y*m.y+2*A*p.y*y.y*h.y*m.x+2*A*p.y*g.x*h.y*g.y-3*v.x*W*B+3*b.x*W*B+3*R*g.x*B+_*h.x*W+3*v.y*h.x*W*H+d.x*p.y*W*H+2*d.y*p.x*W*H-p.x*M*W*h.y-3*b.y*h.x*W*H-3*R*h.x*H*g.y+A*p.y*h.x*(2*y.y*m.y+V)+d.x*p.x*h.x*h.y*(6*y.y*m.y+3*V)+y.x*D*h.y*(6*b.y*m.y+6*y.y*g.y)+O*h.y*(-2*y.y*m.y-V)+v.y*P*(6*y.y*m.y+3*V)+d.y*p.x*D*(-2*y.y*m.y-V)+d.x*p.y*D*(-4*y.y*m.y-2*V)+v.x*D*h.y*(-6*y.y*m.y-3*V)+D*g.x*h.y*(6*b.y*g.y+3*z)+b.x*D*h.y*(6*y.y*m.y+3*V)+P*(-2*b.y*y.y*m.y-g.y*(2*b.y*g.y+z)-b.y*(2*y.y*m.y+V)-y.y*(2*b.y*m.y+2*y.y*g.y)),-v.x*d.x*p.y*h.x*h.y*m.y+v.x*d.y*p.x*h.x*h.y*m.y+6*v.x*d.y*p.y*h.x*h.y*m.x-6*v.y*d.x*p.x*h.x*h.y*m.y-v.y*d.x*p.y*h.x*h.y*m.x+v.y*d.y*p.x*h.x*h.y*m.x+d.x*d.y*p.x*p.y*h.x*m.y-d.x*d.y*p.x*p.y*h.y*m.x+d.x*b.x*p.y*h.x*h.y*m.y+d.x*b.y*p.y*h.x*h.y*m.x+d.x*y.x*p.y*h.x*h.y*g.y+d.x*p.y*h.x*y.y*g.x*h.y-b.x*d.y*p.x*h.x*h.y*m.y-6*b.x*d.y*p.y*h.x*h.y*m.x-d.y*p.x*b.y*h.x*h.y*m.x-d.y*p.x*y.x*h.x*h.y*g.y-d.y*p.x*h.x*y.y*g.x*h.y-6*d.y*y.x*p.y*h.x*g.x*h.y-6*v.x*b.x*B*m.x-6*v.x*y.x*g.x*B-2*v.x*_*h.x*m.x+6*b.x*y.x*g.x*B+2*b.x*_*h.x*m.x+2*y.x*_*h.x*g.x+2*v.y*O*h.y*m.y-6*v.x*v.y*h.x*H*m.x+3*v.x*d.x*p.x*H*m.y-2*v.x*d.x*p.y*H*m.x-4*v.x*d.y*p.x*H*m.x+3*v.y*d.x*p.x*H*m.x+6*v.x*v.y*D*h.y*m.y+6*v.x*b.x*h.x*H*m.y-3*v.x*d.y*p.y*D*m.y+2*v.x*p.x*M*h.x*m.y+2*v.x*p.x*M*h.y*m.x+6*v.x*b.y*h.x*H*m.x+6*v.x*y.x*h.x*H*g.y+6*v.x*h.x*y.y*g.x*H+4*v.y*d.x*p.y*D*m.y+6*v.y*b.x*h.x*H*m.x+2*v.y*d.y*p.x*D*m.y-3*v.y*d.y*p.y*D*m.x+2*v.y*p.x*M*h.x*m.x+6*v.y*y.x*h.x*g.x*H-3*d.x*b.x*p.x*H*m.y+2*d.x*b.x*p.y*H*m.x+d.x*d.y*M*h.x*m.x-3*d.x*p.x*b.y*H*m.x-3*d.x*p.x*y.x*H*g.y-3*d.x*p.x*y.y*g.x*H+2*d.x*y.x*p.y*g.x*H+4*b.x*d.y*p.x*H*m.x+4*d.y*p.x*y.x*g.x*H-2*v.x*A*p.y*h.y*m.y-6*v.y*b.x*D*h.y*m.y-6*v.y*b.y*D*h.y*m.x-6*v.y*y.x*D*h.y*g.y-2*v.y*A*p.y*h.x*m.y-2*v.y*A*p.y*h.y*m.x-6*v.y*D*y.y*g.x*h.y-d.x*d.y*A*h.y*m.y-2*d.x*k*h.x*h.y*m.x+3*b.x*d.y*p.y*D*m.y-2*b.x*p.x*M*h.x*m.y-2*b.x*p.x*M*h.y*m.x-6*b.x*b.y*h.x*H*m.x-6*b.x*y.x*h.x*H*g.y-6*b.x*h.x*y.y*g.x*H+3*d.y*b.y*p.y*D*m.x+3*d.y*y.x*p.y*D*g.y+3*d.y*p.y*D*y.y*g.x-2*p.x*b.y*M*h.x*m.x-2*p.x*y.x*M*h.x*g.y-2*p.x*y.x*M*g.x*h.y-2*p.x*M*h.x*y.y*g.x-6*b.y*y.x*h.x*g.x*H-k*p.x*p.y*h.x*m.x+2*b.x*A*p.y*h.y*m.y+6*b.y*D*y.y*g.x*h.y+2*N*d.y*h.x*h.y*m.y+N*p.x*p.y*h.y*m.y+2*A*b.y*p.y*h.y*m.x+2*A*y.x*p.y*h.y*g.y+2*A*p.y*y.y*g.x*h.y+U*B+3*E*B*m.x-3*x*P*m.y+3*j*B*m.x+L*D*m.x-C*H*m.y-d.x*k*D*m.y+N*d.y*H*m.x-3*E*h.x*H*m.y+3*x*D*h.y*m.x-N*M*h.x*m.y+k*A*h.y*m.x-3*R*h.x*y.y*H-3*j*h.x*H*m.y+3*I*D*h.y*m.x+d.x*p.x*h.x*h.y*(6*b.y*m.y+6*y.y*g.y)+O*h.y*(-2*b.y*m.y-2*y.y*g.y)+v.y*P*(6*b.y*m.y+6*y.y*g.y)+d.y*p.x*D*(-2*b.y*m.y-2*y.y*g.y)+A*p.y*h.x*(2*b.y*m.y+2*y.y*g.y)+d.x*p.y*D*(-4*b.y*m.y-4*y.y*g.y)+v.x*D*h.y*(-6*b.y*m.y-6*y.y*g.y)+b.x*D*h.y*(6*b.y*m.y+6*y.y*g.y)+y.x*D*h.y*(6*b.y*g.y+3*z)+P*(-2*b.y*y.y*g.y-I*m.y-y.y*(2*b.y*g.y+z)-b.y*(2*b.y*m.y+2*y.y*g.y)),-v.x*d.x*p.y*h.x*h.y*g.y+v.x*d.y*p.x*h.x*h.y*g.y+6*v.x*d.y*p.y*h.x*g.x*h.y-6*v.y*d.x*p.x*h.x*h.y*g.y-v.y*d.x*p.y*h.x*g.x*h.y+v.y*d.y*p.x*h.x*g.x*h.y+d.x*d.y*p.x*p.y*h.x*g.y-d.x*d.y*p.x*p.y*g.x*h.y+d.x*b.x*p.y*h.x*h.y*g.y+d.x*b.y*p.y*h.x*g.x*h.y+d.x*y.x*p.y*h.x*y.y*h.y-b.x*d.y*p.x*h.x*h.y*g.y-6*b.x*d.y*p.y*h.x*g.x*h.y-d.y*p.x*b.y*h.x*g.x*h.y-d.y*p.x*y.x*h.x*y.y*h.y-6*v.x*b.x*g.x*B-2*v.x*_*h.x*g.x+2*b.x*_*h.x*g.x+2*v.y*O*h.y*g.y-6*v.x*v.y*h.x*g.x*H+3*v.x*d.x*p.x*H*g.y-2*v.x*d.x*p.y*g.x*H-4*v.x*d.y*p.x*g.x*H+3*v.y*d.x*p.x*g.x*H+6*v.x*v.y*D*h.y*g.y+6*v.x*b.x*h.x*H*g.y-3*v.x*d.y*p.y*D*g.y+2*v.x*p.x*M*h.x*g.y+2*v.x*p.x*M*g.x*h.y+6*v.x*b.y*h.x*g.x*H+6*v.x*y.x*h.x*y.y*H+4*v.y*d.x*p.y*D*g.y+6*v.y*b.x*h.x*g.x*H+2*v.y*d.y*p.x*D*g.y-3*v.y*d.y*p.y*D*g.x+2*v.y*p.x*M*h.x*g.x-3*d.x*b.x*p.x*H*g.y+2*d.x*b.x*p.y*g.x*H+d.x*d.y*M*h.x*g.x-3*d.x*p.x*b.y*g.x*H-3*d.x*p.x*y.x*y.y*H+4*b.x*d.y*p.x*g.x*H-2*v.x*A*p.y*h.y*g.y-6*v.y*b.x*D*h.y*g.y-6*v.y*b.y*D*g.x*h.y-6*v.y*y.x*D*y.y*h.y-2*v.y*A*p.y*h.x*g.y-2*v.y*A*p.y*g.x*h.y-d.x*d.y*A*h.y*g.y-2*d.x*k*h.x*g.x*h.y+3*b.x*d.y*p.y*D*g.y-2*b.x*p.x*M*h.x*g.y-2*b.x*p.x*M*g.x*h.y-6*b.x*b.y*h.x*g.x*H-6*b.x*y.x*h.x*y.y*H+3*d.y*b.y*p.y*D*g.x+3*d.y*y.x*p.y*D*y.y-2*p.x*b.y*M*h.x*g.x-2*p.x*y.x*M*h.x*y.y-k*p.x*p.y*h.x*g.x+2*b.x*A*p.y*h.y*g.y-3*d.y*R*p.y*h.x*h.y+6*b.y*y.x*D*y.y*h.y+2*N*d.y*h.x*h.y*g.y+N*p.x*p.y*h.y*g.y+2*A*b.y*p.y*g.x*h.y+2*A*y.x*p.y*y.y*h.y-3*v.x*R*B+3*b.x*R*B+3*E*g.x*B-3*x*P*g.y+3*j*g.x*B+R*_*h.x+L*D*g.x-C*H*g.y+3*v.y*R*h.x*H-d.x*k*D*g.y+d.x*R*p.y*H+2*d.y*p.x*R*H+N*d.y*g.x*H-p.x*R*M*h.y-3*b.y*R*h.x*H-3*E*h.x*H*g.y+3*x*D*g.x*h.y-N*M*h.x*g.y+k*A*g.x*h.y-3*j*h.x*H*g.y+3*I*D*g.x*h.y+A*p.y*h.x*(2*b.y*g.y+z)+d.x*p.x*h.x*h.y*(6*b.y*g.y+3*z)+O*h.y*(-2*b.y*g.y-z)+v.y*P*(6*b.y*g.y+3*z)+d.y*p.x*D*(-2*b.y*g.y-z)+d.x*p.y*D*(-4*b.y*g.y-2*z)+v.x*D*h.y*(-6*b.y*g.y-3*z)+b.x*D*h.y*(6*b.y*g.y+3*z)+P*(-2*b.y*z-I*g.y-b.y*(2*b.y*g.y+z)),-v.x*d.x*p.y*h.x*y.y*h.y+v.x*d.y*p.x*h.x*y.y*h.y+6*v.x*d.y*y.x*p.y*h.x*h.y-6*v.y*d.x*p.x*h.x*y.y*h.y-v.y*d.x*y.x*p.y*h.x*h.y+v.y*d.y*p.x*y.x*h.x*h.y-d.x*d.y*p.x*y.x*p.y*h.y+d.x*d.y*p.x*p.y*h.x*y.y+d.x*b.x*p.y*h.x*y.y*h.y+6*d.x*p.x*b.y*h.x*y.y*h.y+d.x*b.y*y.x*p.y*h.x*h.y-b.x*d.y*p.x*h.x*y.y*h.y-6*b.x*d.y*y.x*p.y*h.x*h.y-d.y*p.x*b.y*y.x*h.x*h.y-6*v.x*b.x*y.x*B-2*v.x*y.x*_*h.x+6*v.y*b.y*P*y.y+2*b.x*y.x*_*h.x+2*v.y*O*y.y*h.y-2*O*b.y*y.y*h.y-6*v.x*v.y*y.x*h.x*H+3*v.x*d.x*p.x*y.y*H-2*v.x*d.x*y.x*p.y*H-4*v.x*d.y*p.x*y.x*H+3*v.y*d.x*p.x*y.x*H+6*v.x*v.y*D*y.y*h.y+6*v.x*b.x*h.x*y.y*H-3*v.x*d.y*p.y*D*y.y+2*v.x*p.x*y.x*M*h.y+2*v.x*p.x*M*h.x*y.y+6*v.x*b.y*y.x*h.x*H+4*v.y*d.x*p.y*D*y.y+6*v.y*b.x*y.x*h.x*H+2*v.y*d.y*p.x*D*y.y-3*v.y*d.y*y.x*p.y*D+2*v.y*p.x*y.x*M*h.x-3*d.x*b.x*p.x*y.y*H+2*d.x*b.x*y.x*p.y*H+d.x*d.y*y.x*M*h.x-3*d.x*p.x*b.y*y.x*H+4*b.x*d.y*p.x*y.x*H-6*v.x*b.y*D*y.y*h.y-2*v.x*A*p.y*y.y*h.y-6*v.y*b.x*D*y.y*h.y-6*v.y*b.y*y.x*D*h.y-2*v.y*A*y.x*p.y*h.y-2*v.y*A*p.y*h.x*y.y-d.x*d.y*A*y.y*h.y-4*d.x*b.y*p.y*D*y.y-2*d.x*k*y.x*h.x*h.y+3*b.x*d.y*p.y*D*y.y-2*b.x*p.x*y.x*M*h.y-2*b.x*p.x*M*h.x*y.y-6*b.x*b.y*y.x*h.x*H-2*d.y*p.x*b.y*D*y.y+3*d.y*b.y*y.x*p.y*D-2*p.x*b.y*y.x*M*h.x-k*p.x*y.x*p.y*h.x+6*b.x*b.y*D*y.y*h.y+2*b.x*A*p.y*y.y*h.y+2*N*d.y*h.x*y.y*h.y+N*p.x*p.y*y.y*h.y+2*A*b.y*y.x*p.y*h.y+2*A*b.y*p.y*h.x*y.y+3*E*y.x*B-3*x*P*y.y+3*j*y.x*B+L*y.x*D-C*y.y*H-3*I*P*y.y-d.x*k*D*y.y+N*d.y*y.x*H-3*E*h.x*y.y*H+3*x*y.x*D*h.y-N*M*h.x*y.y+k*A*y.x*h.y-3*j*h.x*y.y*H+3*I*y.x*D*h.y,v.x*v.y*d.x*p.y*h.x*h.y-v.x*v.y*d.y*p.x*h.x*h.y+v.x*d.x*d.y*p.x*p.y*h.y-v.y*d.x*d.y*p.x*p.y*h.x-v.x*d.x*b.y*p.y*h.x*h.y+6*v.x*b.x*d.y*p.y*h.x*h.y+v.x*d.y*p.x*b.y*h.x*h.y-v.y*d.x*b.x*p.y*h.x*h.y-6*v.y*d.x*p.x*b.y*h.x*h.y+v.y*b.x*d.y*p.x*h.x*h.y-d.x*b.x*d.y*p.x*p.y*h.y+d.x*d.y*p.x*b.y*p.y*h.x+d.x*b.x*b.y*p.y*h.x*h.y-b.x*d.y*p.x*b.y*h.x*h.y-2*v.x*b.x*_*h.x+2*v.y*O*b.y*h.y-3*v.x*v.y*d.x*p.x*H-6*v.x*v.y*b.x*h.x*H+3*v.x*v.y*d.y*p.y*D-2*v.x*v.y*p.x*M*h.x-2*v.x*d.x*b.x*p.y*H-v.x*d.x*d.y*M*h.x+3*v.x*d.x*p.x*b.y*H-4*v.x*b.x*d.y*p.x*H+3*v.y*d.x*b.x*p.x*H+6*v.x*v.y*b.y*D*h.y+2*v.x*v.y*A*p.y*h.y+2*v.x*d.x*k*h.x*h.y+2*v.x*b.x*p.x*M*h.y+6*v.x*b.x*b.y*h.x*H-3*v.x*d.y*b.y*p.y*D+2*v.x*p.x*b.y*M*h.x+v.x*k*p.x*p.y*h.x+v.y*d.x*d.y*A*h.y+4*v.y*d.x*b.y*p.y*D-3*v.y*b.x*d.y*p.y*D+2*v.y*b.x*p.x*M*h.x+2*v.y*d.y*p.x*b.y*D+d.x*b.x*d.y*M*h.x-3*d.x*b.x*p.x*b.y*H-2*v.x*A*b.y*p.y*h.y-6*v.y*b.x*b.y*D*h.y-2*v.y*b.x*A*p.y*h.y-2*v.y*N*d.y*h.x*h.y-v.y*N*p.x*p.y*h.y-2*v.y*A*b.y*p.y*h.x-2*d.x*b.x*k*h.x*h.y-d.x*d.y*A*b.y*h.y+3*b.x*d.y*b.y*p.y*D-2*b.x*p.x*b.y*M*h.x-b.x*k*p.x*p.y*h.x+3*x*d.x*p.x*h.x*h.y+3*d.x*p.x*I*h.x*h.y+2*b.x*A*b.y*p.y*h.y-3*E*d.y*p.y*h.x*h.y+2*N*d.y*b.y*h.x*h.y+N*p.x*b.y*p.y*h.y-3*j*d.y*p.y*h.x*h.y-S*B+T*P+F*B-q*P-3*v.x*j*B-v.x*L*D+3*E*b.x*B+v.y*C*H+3*v.y*I*P+b.x*L*D+E*_*h.x-3*x*b.y*P-x*O*h.y+j*_*h.x-C*b.y*H-O*I*h.y-v.x*N*d.y*H+v.y*d.x*k*D-3*v.x*x*D*h.y-v.x*k*A*h.y+v.y*N*M*h.x-d.x*k*b.y*D+3*E*v.y*h.x*H+E*d.x*p.y*H+2*E*d.y*p.x*H-2*x*d.x*p.y*D-x*d.y*p.x*D+N*b.x*d.y*H-3*v.x*I*D*h.y+3*v.y*j*h.x*H+d.x*j*p.y*H-2*d.x*I*p.y*D+b.x*k*A*h.y-d.y*p.x*I*D-E*p.x*M*h.y-3*E*b.y*h.x*H+3*x*b.x*D*h.y+x*A*p.y*h.x-N*b.y*M*h.x+2*j*d.y*p.x*H+3*b.x*I*D*h.y-j*p.x*M*h.y-3*j*b.y*h.x*H+A*I*p.y*h.x),Y=G.getRootsInInterval(0,1);for(var Z=0;Z<Y.length;Z++){var et=Y[Z],tt=(new Polynomial(h.x,p.x,d.x,v.x-b.x-et*y.x-et*et*g.x-et*et*et*m.x)).getRoots(),nt=(new Polynomial(h.y,p.y,d.y,v.y-b.y-et*y.y-et*et*g.y-et*et*et*m.y)).getRoots();if(tt.length>0&&nt.length>0){var rt=1e-4;e:for(var it=0;it<tt.length;it++){var st=tt[it];if(0<=st&&st<=1)for(var ot=0;ot<nt.length;ot++)if(Math.abs(st-nt[ot])<rt){w.points.push(m.multiply(et*et*et).add(g.multiply(et*et).add(y.multiply(et).add(b))));break e}}}}return w.points.length>0&&(w.status="Intersection"),w},oi.intersectBezier3Circle=function(e,t,n,r,i,s){return oi.intersectBezier3Ellipse(e,t,n,r,i,s,s)},oi.intersectBezier3Ellipse=function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v=new oi("No Intersection");u=e.multiply(-1),a=t.multiply(3),f=n.multiply(-3),l=u.add(a.add(f.add(r))),c=new Vector2D(l.x,l.y),u=e.multiply(3),a=t.multiply(-6),f=n.multiply(3),l=u.add(a.add(f)),h=new Vector2D(l.x,l.y),u=e.multiply(-3),a=t.multiply(3),f=u.add(a),p=new Vector2D(f.x,f.y),d=new Vector2D(e.x,e.y);var m=s*s,g=o*o,y=new Polynomial(c.x*c.x*g+c.y*c.y*m,2*(c.x*h.x*g+c.y*h.y*m),2*(c.x*p.x*g+c.y*p.y*m)+h.x*h.x*g+h.y*h.y*m,2*c.x*g*(d.x-i.x)+2*c.y*m*(d.y-i.y)+2*(h.x*p.x*g+h.y*p.y*m),2*h.x*g*(d.x-i.x)+2*h.y*m*(d.y-i.y)+p.x*p.x*g+p.y*p.y*m,2*p.x*g*(d.x-i.x)+2*p.y*m*(d.y-i.y),d.x*d.x*g-2*d.y*i.y*m-2*d.x*i.x*g+d.y*d.y*m+i.x*i.x*g+i.y*i.y*m-m*g),b=y.getRootsInInterval(0,1);for(var w=0;w<b.length;w++){var E=b[w];v.points.push(c.multiply(E*E*E).add(h.multiply(E*E).add(p.multiply(E).add(d))))}return v.points.length>0&&(v.status="Intersection"),v},oi.intersectBezier3Line=function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m=i.min(s),g=i.max(s),y=new oi("No Intersection");o=e.multiply(-1),u=t.multiply(3),a=n.multiply(-3),f=o.add(u.add(a.add(r))),l=new Vector2D(f.x,f.y),o=e.multiply(3),u=t.multiply(-6),a=n.multiply(3),f=o.add(u.add(a)),c=new Vector2D(f.x,f.y),o=e.multiply(-3),u=t.multiply(3),a=o.add(u),h=new Vector2D(a.x,a.y),p=new Vector2D(e.x,e.y),v=new Vector2D(i.y-s.y,s.x-i.x),d=i.x*s.y-s.x*i.y,roots=(new Polynomial(v.dot(l),v.dot(c),v.dot(h),v.dot(p)+d)).getRoots();for(var b=0;b<roots.length;b++){var w=roots[b];if(0<=w&&w<=1){var E=e.lerp(t,w),S=t.lerp(n,w),x=n.lerp(r,w),T=E.lerp(S,w),N=S.lerp(x,w),C=T.lerp(N,w);i.x==s.x?m.y<=C.y&&C.y<=g.y&&(y.status="Intersection",y.appendPoint(C)):i.y==s.y?m.x<=C.x&&C.x<=g.x&&(y.status="Intersection",y.appendPoint(C)):C.gte(m)&&C.lte(g)&&(y.status="Intersection",y.appendPoint(C))}}return y},oi.intersectBezier3Polygon=function(e,t,n,r,i){var s=new oi("No Intersection"),o=i.length;for(var u=0;u<o;u++){var a=i[u],f=i[(u+1)%o],l=oi.intersectBezier3Line(e,t,n,r,a,f);s.appendPoints(l.points)}return s.points.length>0&&(s.status="Intersection"),s},oi.intersectBezier3Rectangle=function(e,t,n,r,i,o){var u=i.min(o),a=i.max(o),f=new s(a.x,u.y),l=new s(u.x,a.y),c=oi.intersectBezier3Line(e,t,n,r,u,f),h=oi.intersectBezier3Line(e,t,n,r,f,a),p=oi.intersectBezier3Line(e,t,n,r,a,l),d=oi.intersectBezier3Line(e,t,n,r,l,u),v=new oi("No Intersection");return v.appendPoints(c.points),v.appendPoints(h.points),v.appendPoints(p.points),v.appendPoints(d.points),v.points.length>0&&(v.status="Intersection"),v},oi.intersectCircleCircle=function(e,t,n,r){var i,o=t+r,u=Math.abs(t-r),a=e.distanceFrom(n);if(a>o)i=new oi("Outside");else if(a<u)i=new oi("Inside");else{i=new oi("Intersection");var f=(t*t-r*r+a*a)/(2*a),l=Math.sqrt(t*t-f*f),c=e.lerp(n,f/a),h=l/a;i.points.push(new s(c.x-h*(n.y-e.y),c.y+h*(n.x-e.x))),i.points.push(new s(c.x+h*(n.y-e.y),c.y-h*(n.x-e.x)))}return i},oi.intersectCircleEllipse=function(e,t,n,r,i){return oi.intersectEllipseEllipse(e,t,t,n,r,i)},oi.intersectCircleLine=function(e,t,n,r){var i,s=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),o=2*((r.x-n.x)*(n.x-e.x)+(r.y-n.y)*(n.y-e.y)),u=e.x*e.x+e.y*e.y+n.x*n.x+n.y*n.y-2*(e.x*n.x+e.y*n.y)-t*t,a=o*o-4*s*u;if(a<0)i=new oi("Outside");else if(a==0)i=new oi("Tangent");else{var f=Math.sqrt(a),l=(-o+f)/(2*s),c=(-o-f)/(2*s);(l<0||l>1)&&(c<0||c>1)?l<0&&c<0||l>1&&c>1?i=new oi("Outside"):i=new oi("Inside"):(i=new oi("Intersection"),0<=l&&l<=1&&i.points.push(n.lerp(r,l)),0<=c&&c<=1&&i.points.push(n.lerp(r,c)))}return i},oi.intersectCirclePolygon=function(e,t,n){var r=new oi("No Intersection"),i=n.length,s;for(var o=0;o<i;o++){var u=n[o],a=n[(o+1)%i];s=oi.intersectCircleLine(e,t,u,a),r.appendPoints(s.points)}return r.points.length>0?r.status="Intersection":r.status=s.status,r},oi.intersectCircleRectangle=function(e,t,n,r){var i=n.min(r),o=n.max(r),u=new s(o.x,i.y),a=new s(i.x,o.y),f=oi.intersectCircleLine(e,t,i,u),l=oi.intersectCircleLine(e,t,u,o),c=oi.intersectCircleLine(e,t,o,a),h=oi.intersectCircleLine(e,t,a,i),p=new oi("No Intersection");return p.appendPoints(f.points),p.appendPoints(l.points),p.appendPoints(c.points),p.appendPoints(h.points),p.points.length>0?p.status="Intersection":p.status=f.status,p},oi.intersectEllipseEllipse=function(e,t,n,r,i,o){var u=[n*n,0,t*t,-2*n*n*e.x,-2*t*t*e.y,n*n*e.x*e.x+t*t*e.y*e.y-t*t*n*n],a=[o*o,0,i*i,-2*o*o*r.x,-2*i*i*r.y,o*o*r.x*r.x+i*i*r.y*r.y-i*i*o*o],f=oi.bezout(u,a),l=f.getRoots(),c=.001,h=(u[0]*u[0]+2*u[1]*u[1]+u[2]*u[2])*c,p=(a[0]*a[0]+2*a[1]*a[1]+a[2]*a[2])*c,d=new oi("No Intersection");for(var v=0;v<l.length;v++){var m=new Polynomial(u[0],u[3]+l[v]*u[1],u[5]+l[v]*(u[4]+l[v]*u[2])),g=m.getRoots();for(var y=0;y<g.length;y++){var b=(u[0]*g[y]+u[1]*l[v]+u[3])*g[y]+(u[2]*l[v]+u[4])*l[v]+u[5];Math.abs(b)<h&&(b=(a[0]*g[y]+a[1]*l[v]+a[3])*g[y]+(a[2]*l[v]+a[4])*l[v]+a[5],Math.abs(b)<p&&d.appendPoint(new s(g[y],l[v])))}}return d.points.length>0&&(d.status="Intersection"),d},oi.intersectEllipseLine=function(e,t,n,r,i){var s,o=new Vector2D(r.x,r.y),u=Vector2D.fromPoints(r,i),a=new Vector2D(e.x,e.y),f=o.subtract(a),l=new Vector2D(u.x/(t*t),u.y/(n*n)),c=new Vector2D(f.x/(t*t),f.y/(n*n)),h=u.dot(l),p=u.dot(c),e=f.dot(c)-1,d=p*p-h*e;if(d<0)s=new oi("Outside");else if(d>0){var v=Math.sqrt(d),m=(-p-v)/h,g=(-p+v)/h;(m<0||1<m)&&(g<0||1<g)?m<0&&g<0||m>1&&g>1?s=new oi("Outside"):s=new oi("Inside"):(s=new oi("Intersection"),0<=m&&m<=1&&s.appendPoint(r.lerp(i,m)),0<=g&&g<=1&&s.appendPoint(r.lerp(i,g)))}else{var y=-p/h;0<=y&&y<=1?(s=new oi("Intersection"),s.appendPoint(r.lerp(i,y))):s=new oi("Outside")}return s},oi.intersectEllipsePolygon=function(e,t,n,r){var i=new oi("No Intersection"),s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=oi.intersectEllipseLine(e,t,n,u,a);i.appendPoints(f.points)}return i.points.length>0&&(i.status="Intersection"),i},oi.intersectEllipseRectangle=function(e,t,n,r,i){var o=r.min(i),u=r.max(i),a=new s(u.x,o.y),f=new s(o.x,u.y),l=oi.intersectEllipseLine(e,t,n,o,a),c=oi.intersectEllipseLine(e,t,n,a,u),h=oi.intersectEllipseLine(e,t,n,u,f),p=oi.intersectEllipseLine(e,t,n,f,o),d=new oi("No Intersection");return d.appendPoints(l.points),d.appendPoints(c.points),d.appendPoints(h.points),d.appendPoints(p.points),d.points.length>0&&(d.status="Intersection"),d},oi.intersectLineLine=function(e,t,n,r){var i,o=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),u=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),a=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(a!=0){var f=o/a,l=u/a;0<=f&&f<=1&&0<=l&&l<=1?(i=new oi("Intersection"),i.points.push(new s(e.x+f*(t.x-e.x),e.y+f*(t.y-e.y)))):i=new oi("No Intersection")}else o==0||u==0?i=new oi("Coincident"):i=new oi("Parallel");return i},oi.intersectLinePolygon=function(e,t,n){var r=new oi("No Intersection"),i=n.length;for(var s=0;s<i;s++){var o=n[s],u=n[(s+1)%i],a=oi.intersectLineLine(e,t,o,u);r.appendPoints(a.points)}return r.points.length>0&&(r.status="Intersection"),r},oi.intersectLineRectangle=function(e,t,n,r){var i=n.min(r),o=n.max(r),u=new s(o.x,i.y),a=new s(i.x,o.y),f=oi.intersectLineLine(i,u,e,t),l=oi.intersectLineLine(u,o,e,t),c=oi.intersectLineLine(o,a,e,t),h=oi.intersectLineLine(a,i,e,t),p=new oi("No Intersection");return p.appendPoints(f.points),p.appendPoints(l.points),p.appendPoints(c.points),p.appendPoints(h.points),p.points.length>0&&(p.status="Intersection"),p},oi.intersectPolygonPolygon=function(e,t){var n=new oi("No Intersection"),r=e.length;for(var i=0;i<r;i++){var s=e[i],o=e[(i+1)%r],u=oi.intersectLinePolygon(s,o,t);n.appendPoints(u.points)}return n.points.length>0&&(n.status="Intersection"),n},oi.intersectPolygonRectangle=function(e,t,n){var r=t.min(n),i=t.max(n),o=new s(i.x,r.y),u=new s(r.x,i.y),a=oi.intersectLinePolygon(r,o,e),f=oi.intersectLinePolygon(o,i,e),l=oi.intersectLinePolygon(i,u,e),c=oi.intersectLinePolygon(u,r,e),h=new oi("No Intersection");return h.appendPoints(a.points),h.appendPoints(f.points),h.appendPoints(l.points),h.appendPoints(c.points),h.points.length>0&&(h.status="Intersection"),h},oi.intersectRayRay=function(e,t,n,r){var i,o=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),u=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),a=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(a!=0){var f=o/a;i=new oi("Intersection"),i.points.push(new s(e.x+f*(t.x-e.x),e.y+f*(t.y-e.y)))}else o==0||u==0?i=new oi("Coincident"):i=new oi("Parallel");return i},oi.intersectRectangleRectangle=function(e,t,n,r){var i=e.min(t),o=e.max(t),u=new s(o.x,i.y),a=new s(i.x,o.y),f=oi.intersectLineRectangle(i,u,n,r),l=oi.intersectLineRectangle(u,o,n,r),c=oi.intersectLineRectangle(o,a,n,r),h=oi.intersectLineRectangle(a,i,n,r),p=new oi("No Intersection");return p.appendPoints(f.points),p.appendPoints(l.points),p.appendPoints(c.points),p.appendPoints(h.points),p.points.length>0&&(p.status="Intersection"),p},oi.bezout=function(e,t){var n=e[0]*t[1]-t[0]*e[1],r=e[0]*t[2]-t[0]*e[2],i=e[0]*t[3]-t[0]*e[3],s=e[0]*t[4]-t[0]*e[4],o=e[0]*t[5]-t[0]*e[5],u=e[1]*t[2]-t[1]*e[2],a=e[1]*t[4]-t[1]*e[4],f=e[1]*t[5]-t[1]*e[5],l=e[2]*t[3]-t[2]*e[3],c=e[3]*t[4]-t[3]*e[4],h=e[3]*t[5]-t[3]*e[5],p=f+c,d=a-l;return new Polynomial(n*u-r*r,n*d+i*u-2*r*s,n*p+i*d-s*s-2*r*o,n*h+i*p-2*s*o,i*h-o*o)},n.Intersection=oi,n.AreaPicking=function(e,t){this.network=e,this.bounding=t,this.cache={}},n.extend(n.AreaPicking,Object,{intersectObjects:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];this.intersectObject(r,t)}return t},getViewPoint:function(e,t){var n=t.vertices[e].clone(),r=this.cache[t.getId()][n.x+" "+n.y+" "+n.z];return r?r:(n.applyMatrix4(t.worldMatrix),r=this.network.getViewPosition(n),r.y=r.h-r.y,r)},intersectObject:function(e,t){if(e instanceof n.Entity){this.cache[e.getId()]={};for(var r=0;r<e.vertices.length;r++){var i=e.vertices[r].clone();i.applyMatrix4(e.worldMatrix);var s=this.network.getViewPosition
(i);s.y=s.h-s.y,this.cache[e.getId()][i.x+" "+i.y+" "+i.z]=s;if(s.x>this.bounding.x&&s.y>this.bounding.y&&s.x<this.bounding.x+this.bounding.w&&s.y<this.bounding.y+this.bounding.h){var o={element:e};t.push(o);return}}}}}),n.BaseInteraction=function(e){this.network=e,this.view=e.getView()||document},n.addEventListener=function(e,t,n,r){var i="_"+e+"_";if(r[i])return;var s=function(e){arguments.callee.instance[arguments.callee.method](e)};s.method=t,s.instance=r,r[i]=s,n.addEventListener(e,s,!1)},n.removeEventListener=function(e,t,n){var r="_"+e+"_",i=n[r];i&&(t.removeEventListener(e,i,!1),delete n[r])},n.extend(n.BaseInteraction,Object,{onPropertyChange:function(){},firePropertyChange:function(){},setUp:function(){},tearDown:function(){},update:function(){},addListener:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];n.addEventListener(t,"handle_"+t,this.network.getRootView(),this)}},removeListener:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];n.removeEventListener(arguments[e],this.network.getRootView(),this)}},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},isFinished:function(){return!0}}),n.DefaultInteraction=function(t){n.BaseInteraction.call(this,t),this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=this.screen.width/4,this.domElement=this.network.getRootView(),this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.easing=!0,this.dynamicDampingFactor=.05,this.timeInterval=2e3,this.minDistance=0,this.maxDistance=Infinity,this.keys=[65,83,68],this.lastPosition=new n.Vec3;var r=this.STATE.NONE,i=this.STATE.NONE,s=new n.Vec3,u=new n.Vec3,a=new n.Vec3,f=new n.Vec2,l=new n.Vec2,c=0,h=0,p=new n.Vec2,d=new n.Vec2,v=0,m,g;this.object=this.network._camera,this.object.target||(this.object.target=new n.Vec3),this.movementSpeed=1,this.lookSpeed=.005,this.keyboardEnable=!0,this.lookVertical=!0,this.autoForward=!1,this.fpsMode=!1,this.dragMode=!0,this.activeLook=!1,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.lastX=0,this.lastY=0,this.network.getRootView().addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.yRistrict=!0,this.yLowerLimitAngle=-Math.PI/2,this.yUpLimitAngle=Math.PI/2,this.updateIntervalTime=0;var y=null;this.handleResize=function(){this.screen.width=e.innerWidth,this.screen.height=e.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleResize(),this.handle_mousedown=function(e){if($html.isCtrlDown(e))return;e.preventDefault();if(this.fpsMode){this.domElement!==document&&this.domElement.focus();if(this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.lastX=e.pageX,this.lastY=e.pageY,this.mouseDragOn=!0}else r===this.STATE.NONE&&(r=e.button),r===this.STATE.ROTATE&&!this.noRotate?(u=a=this.getMouseProjectionOnBall(e.clientX,e.clientY),m=g=this.getRotateY(e.clientX,e.clientY)):this.state===this.STATE.ZOOM&&!this.noZoom?f=l=this.getMouseOnScreen(e.clientX,e.clientY):r===this.STATE.PAN&&!this.noPan&&(p=d=this.getMouseOnScreen(e.clientX,e.clientY));this.beforeUpdate(),this.addListener("mousemove","mouseup")},this.handle_mousemove=function(e){if(e.stop)return;e.preventDefault(),this.fpsMode?this.dragMode?this.mouseDragOn?(this.mouseX=(e.pageX-this.lastX)*300,this.mouseY=(e.pageY-this.lastY)*300,this.lastX=e.pageX,this.lastY=e.pageY):(this.mouseX=0,this.mouseY=0):this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY):r===this.STATE.ROTATE&&!this.noRotate?(a=this.getMouseProjectionOnBall(e.clientX,e.clientY),g=this.getRotateY(e.clientX,e.clientY)):r===this.STATE.ZOOM&&!this.noZoom?l=this.getMouseOnScreen(e.clientX,e.clientY):r===this.STATE.PAN&&!this.noPan&&(d=this.getMouseOnScreen(e.clientX,e.clientY));var t=(new Date).getTime();if(this._lt==null)this.update();else{if(t-this._lt<this.updateIntervalTime)return;this.update()}this._lt=t},this.handle_mouseup=function(e){e.preventDefault();if(this.fpsMode){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.lastX=0,this.lastY=0,this.dragMode&&(this.mouseX=0,this.mouseY=0),this.mouseDragOn=!1}else r=this.STATE.NONE;this.removeListener("mousemove","mouseup"),this.update()},this.handle_touchstart=function(e){if(this.enabled===!1)return;switch(e.touches.length){case 1:r=this.STATE.TOUCH_ROTATE,u=this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY),m=g=this.getRotateY(e.touches[0].pageX,e.touches[0].pageY),a.copy(u);break;case 2:r=this.STATE.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;h=c=Math.sqrt(t*t+n*n);break;case 3:r=this.STATE.TOUCH_PAN,p.copy(this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)),d.copy(p);break;default:r=this.STATE.NONE}this.update()},this.handle_touchmove=function(e){if(this.enabled===!1)return;e.preventDefault();switch(e.touches.length){case 1:a=this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,a),g=this.getRotateY(e.touches[0].pageX,e.touches[0].pageY);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;h=Math.sqrt(t*t+n*n);break;case 3:d=this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,d);break;default:r=this.STATE.NONE}this.update()},this.handle_touchend=function(e){if(this.enabled===!1)return;switch(e.touches.length){case 0:u.copy(this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,a));break;case 1:c=h=0;break;case 2:d.copy(this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)),p.copy(d)}r=this.STATE.NONE,this.update()},this.handle_DOMMouseScroll=function(e){this.handle_mousewheel(e)},this.handle_mousewheel=function(e){e.preventDefault();var t=0;e.wheelDelta?e.wheelDelta%120===0?t=e.wheelDelta/40:t=e.wheelDelta:e.detail&&(t=-e.detail/3),f.y+=1/t*.01,this.mouseMoving=!0,this.update()},this.handle_dblclick=function(e){if(!this.isCtrlDown(e))return;var t=this.network.getElementsByMouseEvent(e);t.length>0&&(y=t[0]),this.update()},this.getMouseOnScreen=function(e,t){return new n.Vec2((e-this.screen.offsetLeft)/this.radius*.5,(t-this.screen.offsetTop)/this.radius*.5)},this.getRotateY=function(e,t){if(this.yRistrict){var n=(this.screen.height*.5+this.screen.offsetTop-t)/this.screen.height*2;return n}},this.handle_keydown=function(e){if(!this.keyboardEnable)return;switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}this.update()},this.handle_keyup=function(e){if(!this.keyboardEnable)return;switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}this.update()},this.getMouseProjectionOnBall=function(e,t){if(this.yRistrict){var r=new n.Vec3((e-this.screen.width*.5-this.screen.offsetLeft)/(this.screen.width*.5),0,0),i=r.length();return i>1?r.normalize():r.z=Math.sqrt(1-i*i),r.normalize()}var r=new n.Vec3((e-this.screen.width*.5-this.screen.offsetLeft)/this.radius,(this.screen.height*.5+this.screen.offsetTop-t)/this.radius,0),i=r.length();i>1?r.normalize():r.z=Math.sqrt(1-i*i),s.copy(this.object._position).sub(this.object.target);var o=this.object.up.clone().setLength(r.y);return o.add(this.object.up.clone().cross(s).setLength(r.x)),o.add(s.setLength(r.z)),o},this.rotateCamera=function(){var e=u.dot(a)/u.length()/a.length(),t=Math.acos(e),r=!this.easing||Math.abs(t)<1e-4,i=!1;if(t){var o=(new n.Vec3).crossVectors(u,a).normalize(),f=new n.Quat;f.setFromAxisAngle(o,-t*this.dynamicDampingFactor*this.rotateSpeed),r?(f.setFromAxisAngle(o,-t*this.rotateSpeed),s.applyQuaternion(f),this.object.up.applyQuaternion(f),u.copy(a)):(f.setFromAxisAngle(o,-t*this.dynamicDampingFactor*this.rotateSpeed),s.applyQuaternion(f),this.object.up.applyQuaternion(f),f.setFromAxisAngle(o,t*this.dynamicDampingFactor),u.applyQuaternion(f),i=!0)}var r=!this.easing||Math.abs(g-m)<1e-4,l=(g-m)*s.length();if(!O.isNaN(l))if(r)l&&this.yRistrict&&this.limitY(l),m=g;else{var l=l*this.dynamicDampingFactor;l&&this.yRistrict&&this.limitY(l),m+=(g-m)*this.dynamicDampingFactor,i=!0}i&&this.network.dirtyNetwork()},this.limitY=function(e){var t=s.length();Math.abs(s.x)<=.1*t&&Math.abs(s.z)<=.1*t&&(s.x=.1*t);var n=s.x,r=s.z,i=Math.sqrt(n*n+r*r),o=Math.tan(this.yLowerLimitAngle)*i,u=Math.tan(this.yUpLimitAngle)*i;s.y-=e,s.y>u?s.y=u:s.y<o&&(s.y=o)},this.getValueByTime=function(e,t){var n=(new Date).getTime(),r=n-this._timeStart;return r>this.timeInterval?t:e+(t-e)*r/this.timeInterval},this.zoomCamera=function(){if(r===this.STATE.TOUCH_ZOOM){var e=c/h;c=h,s.multiplyScalar(e)}else{var t=this.zoomSpeed;this.easing||(t*=5);var e;e=1+(l.y-f.y)*t,e!==1&&e>0&&(s.multiplyScalar(e),!this.easing||Math.abs(l.y-f.y)<.001?f.copy(l):(f.y+=(l.y-f.y)*this.dynamicDampingFactor,this.network.dirtyNetwork()))}},this.panCamera=function(){var e=d.clone().sub(p);if(e.lengthSq()){e.multiplyScalar(s.length()*this.panSpeed);var t=s.clone().cross(this.object.up).setLength(e.x);t.add(this.object.up.clone().setLength(e.y)),this.object._position.add(t),this.object.target.add(t),p=d,this.network.dirtyNetwork()}},this.checkDistances=function(){if(!this.noZoom||!this.noPan)this.object._position.lengthSq()>this.maxDistance*this.maxDistance&&this.object._position.setLength(this.maxDistance),s.lengthSq()<this.minDistance*this.minDistance&&this.object._position.addVectors(this.object.target,s.setLength(this.minDistance))},this.updateFPS=function(){var e=2;if(this.freeze)return;if(this.heightSpeed){var t=n.Math.clamp(this.object._position.y,this.heightMin,this.heightMax),r=t-this.heightMin;this.autoSpeedFactor=e*r*this.heightCoef}else this.autoSpeedFactor=0;var i=e*this.movementSpeed;if(this.moveForward||this.autoForward&&!this.moveBackward){var u=this.object._position.clone();this.object.translateZ(-(i+this.autoSpeedFactor));var a=this.object.target,f=this.object._position,l=new o,c=new o;l.subVectors(f,a),c.subVectors(u,a),l.z*c.z<=0&&this.object.target.subVectors(this.object._position,s)}this.moveBackward&&this.object.translateZ(i),this.moveLeft&&(this.object.translateX(-i),this.object.target.subVectors(this.object._position,s)),this.moveRight&&(this.object.translateX(i),this.object.target.subVectors(this.object._position,s)),this.moveUp&&(this.object.translateY(i),this.object.target.subVectors(this.object._position,s)),this.moveDown&&(this.object.translateY(-i),this.object.target.subVectors(this.object._position,s));var h=e*this.lookSpeed;!this.activeLook&&!this.dragMode&&(h=0);var p=.1;this.constrainVertical&&(p=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*h,this.dragMode&&(this.mouseX=0),this.lookVertical&&(this.lat-=this.mouseY*h*p),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=n.Math.degToRad(90-this.lat),this.theta=n.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=n.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));if(this.fpsMode){var d=this.object.target,f=this.object._position;d.x=f.x+100*Math.sin(this.phi)*Math.sin(this.theta),d.y=f.y+100*Math.cos(this.phi),d.z=f.z-100*Math.sin(this.phi)*Math.cos(this.theta),this.object.look(d)}},this.update=function(){s.subVectors(this.object._position,this.object.target),!this.noRotate&&!this.fpsMode&&this.rotateCamera(),!this.noZoom&&!this.fpsMode&&this.zoomCamera(),!this.noPan&&!this.fpsMode&&this.panCamera();if(y&&y.element&&this.network.doubleClickToLookAtFunction(y.element)){this.object.target=y.point;var e=this.object._position.distanceTo(this.object.target),t=y.face.normal.clone();t=t.applyMatrix4((new n.Mat4).extractRotation(y.element.worldMatrix)),t.normalize(),s=t.multiplyScalar(e),y=null}this.object.setPosition(this.object._position.clone().addVectors(this.object.target,s)),this.updateFPS(),this.fpsMode||(this.checkDistances(),this.object.look(this.object.target)),this.lastPosition.distanceToSquared(this.object._position)>0&&this.lastPosition.copy(this.object._position)}},n.extend(n.DefaultInteraction,n.BaseInteraction,{STATE:{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},__accessor:["rotateSpeed","zoomSpeed","panSpeed","yLowerLimitAngle","yUpLimitAngle","minDistance","maxDistance","easing"],setUp:function(){this.addListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup")},tearDown:function(){this.removeListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup")},beforeUpdate:function(){},setUpdateIntervalTime:function(e){this.updateIntervalTime=e}}),n.SelectionInteraction=function(e){n.BaseInteraction.call(this,e),this.selectUnVisible=!0,this.ctrlDown=!1,this.deleteTimeoutId=null,this._areaPickingLevel=1},n.extend(n.SelectionInteraction,n.BaseInteraction,{constructor:n.SelectionInteraction,setAreaPickingLevel:function(e){this._areaPickingLevel=e},getAreaPickingLevel:function(){return this._areaPickingLevel},setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},setFocus:function(e){if(document.activeElement===e)return;var t,n,r=document.documentElement,i=document.body,s;r&&(h.isIE||h.isOpera||r.scrollLeft||r.scrollTop)&&(t=r.scrollLeft,n=r.scrollTop,s=r),e.focus(),s&&(s.scrollLeft=t,s.scrollTop=n)},handle_mousedown:function(e){if(e.stop==1)return;if($html.isRightClick(e))return;this.setFocus(this.network.getView()),this.isCtrlDown(e)?(this.addListener("mousemove","mouseup"),this.ctrlDownEvent=e):this.network.getDataBox().clearSelection();var t=this.network.getElementsByMouseEvent(e,!0),n=this.network.getFirstSelectElement(t,this);this.network.getDataBox().getSelectionModel().appendSelection(n),this.network.onSelect(n)},handle_mousemove:function(e){var t=this.getBoundingByMouseEvent(e,this.ctrlDownEvent,this.network.devicePixelRatio);this.mousemoved=!0,this.network.areaPickingRect=t,this.network.paintTopCanvas()},handle_mouseup:function(e){this.network.areaPickingRect=null,this.network.paintTopCanvas();var t=this.getBoundingByMouseEvent(e,this.ctrlDownEvent);this.removeListener("mousemove","mouseup"),this.ctrlDownEvent=null;if(t&&this.mousemoved){var n=this.network.getElementsByBounding(t,!0,this._areaPickingLevel),r=new S;if(n.length>0)for(var i=0;i<n.length;i++){var s=n[i].element;this.network.selectable(n[i])&&r.add(s)}r.size()>0&&this.network.getDataBox().getSelectionModel().appendSelection(r)}},getBoundingByMouseEvent:function(e,t,n){if(!e||!t)return;var r=this.network.getView().getBoundingClientRect(),i=e.clientX-r.left,s=e.clientY-r.top,o=t.clientX-r.left,u=t.clientY-r.top,a=n||1,f=Math.min(i,o)*a,l=Math.min(s,u)*a,c=Math.abs(i-o)*a,h=Math.abs(s-u)*a;return c===0&&h===0?null:{x:f,y:l,w:c,h:h}}}),n.TransformGizmo=function(){var e=new n.TransformGizmoMaterial({color:16711680}),r=new n.TransformGizmoMaterial({color:65280}),i=new n.TransformGizmoMaterial({color:255});this.handleGizmos={X:[new n.Cylinder(e,.005,.005,1,4,1,!1,!1),new o(.5,0,0),new o(0,0,-Math.PI/2)],Y:[new n.Cylinder(r,.005,.005,1,4,1,!1,!1),new o(0,.5,0)],Z:[new n.Cylinder(i,.005,.005,1,4,1,!1,!1),new o(0,0,.5),new o(Math.PI/2,0,0)]};var s=!1,u=!1;this.showHelpers=!0,this.showable=!0,this.init=function(){n.Element.call(this),this.handles=new n.Element,this.pickers=new n.Element,this.planes=new n.Element,this.addChild(this.handles),this.addChild(this.pickers),this.addChild(this.planes);var e=new n.BasicMaterial({wireframe:!1,color:65535,side:n.DoubleSide}),t=new n.Plane(e,5e4,5e4,2,2),r={XY:new n.Plane(e,5e4,5e4,2,2),YZ:new n.Plane(e,5e4,5e4,2,2),XZ:new n.Plane(e,5e4,5e4,2,2),XYZE:new n.Plane(e,5e4,5e4,2,2)};r.YZ._rotation.set(0,Math.PI/2,0),r.XZ._rotation.set(-Math.PI/2,0,0);for(var i in r)r[i].name=i,this.planes.addChild(r[i]),this.planes[i]=r[i],r[i]._visible=!0;for(var i in this.handleGizmos){var s=this.handleGizmos[i][0];s.name=i,this.handleGizmos[i][1]&&s._position.set(this.handleGizmos[i][1].x,this.handleGizmos[i][1].y,this.handleGizmos[i][1].z),this.handleGizmos[i][2]&&s._rotation.set(this.handleGizmos[i][2].x,this.handleGizmos[i][2].y,this.handleGizmos[i][2].z),s.mode=this.mode,this.handles.addChild(s);if(this.pickerGizmos&&this.pickerGizmos[i]){var o=this.pickerGizmos[i][0];this.pickerGizmos[i][1]&&o._position.set(this.pickerGizmos[i][1].x,this.pickerGizmos[i][1].y,this.pickerGizmos[i][1].z),this.pickerGizmos[i][2]&&o._rotation.set(this.pickerGizmos[i][2].x,this.pickerGizmos[i][2].y,this.pickerGizmos[i][2].z)}else var o=s.clone();o.mode=this.mode,o.name=i,this.pickers.addChild(o)}this.iterator(function(e){e instanceof n.Entity&&n.Utils.transformElement(e)})},this.hide=function(){this.handles.getChildren().forEach(function(e){e._visible=!1}),this.pickers.getChildren().forEach(function(e){e._visible=!1}),this.planes.getChildren().forEach(function(e){e._visible=!1})},this.show=function(){var e=this;this.handles.getChildren().forEach(function(t){t._visible=e.showHelpers&&e.showable}),this.pickers.getChildren().forEach(function(e){e._visible=s}),this.activePlane&&(this.activePlane._visible=u)},this.highlight=function(e){var r;for(var i in this.handleGizmos)r=this.handleGizmos[i][0],r.oldColor&&(r.material instanceof n.ArrayMaterial?(r.material.materials[0].color.copy(r.oldColor),r.material.materials[0].opacity=r.oldOpacity):(r.material.color.copy(r.oldColor),r.material.opacity=r.oldOpacity),r.oldColor=null);this.handleGizmos[e]&&(r=this.handleGizmos[e][0],r.material instanceof n.ArrayMaterial?(r.oldColor=r.oldColor||r.material.materials[0].color.clone(),r.oldOpacity=r.oldOpacit!==t?r.oldOpacity:r.material.materials[0].opacity,r.material.materials[0].opacity=1):(r.oldColor=r.oldColor||r.material.color.clone(),r.oldOpacity=r.material.opacity,r.setStyle("material.opacity",1)))},this.init()},n.TransformGizmo.prototype=Object.create(n.Element.prototype),n.TransformGizmo.prototype.update=function(e,t){var n=new o(0,0,0),r=new o(0,1,0),i=new l;for(var s=0;s<this.getChildren().size();s++)for(var u=0;u<this.getChildren().get(s).getChildren().size();u++){var a=this.getChildren().get(s).getChildren().get(u);a.name.search("E")!=-1?(a.quaternion.setFromRotationMatrix(i.lookAt(t,n,r)),a._rotation.setEulerFromQuaternion(a.quaternion)):(a.quaternion.setFromEuler(e),a._rotation.setEulerFromQuaternion(a.quaternion))}},n.TransformGizmoTranslate=function(){n.TransformGizmo.call(this);var e=new n.TransformGizmoMaterial({color:16711680,opacity:.2}),t=new n.TransformGizmoMaterial({color:65280,opacity:.2}),r=new n.TransformGizmoMaterial({color:255,opacity:.2}),i=new n.Arrow(e,1,.03,.2,.05,30),s=new n.Arrow(t,1,.03,.2,.05,30),u=new n.Arrow(r,1,.03,.2,.05,30),a=new n.TransformGizmoMaterial({color:255,opacity:.5}),f=new n.TransformGizmoMaterial({color:16711680,opacity:.5}),c=new n.TransformGizmoMaterial({color:65280,opacity:.5}),h=new n.TransformGizmoMaterial({color:16777215,opacity:.5}),p=new n.Circle(a,.5,10,0,Math.PI/2),d=new n.Circle(f,.5,10,0,Math.PI/2),v=new n.Circle(c,.5,10,0,Math.PI/2),m=new n.Octahedron(h,1e-4,0);this.handleGizmos={X:[i,new o(1.6,0,0),new o(0,0,-Math.PI/2)],Y:[s,new o(0,1.6,0)],Z:[u,new o(0,0,1.6),new o(Math.PI/2,0,0)],XYZ:[m],XY:[p,new o(0,0,0)],YZ:[d,new o(0,0,0),new o(Math.PI/2,Math.PI/2,0)],XZ:[v,new o(0,0,0),new o(Math.PI/2,0,0)]};var h=new n.TransformGizmoMaterial({color:16711680,opacity:.25}),g=new n.TransformGizmoMaterial({color:65280,opacity:.25}),y=new n.TransformGizmoMaterial({color:255,opacity:.25}),b=new n.Cylinder(h,.075,0,1.2,4,1,!1),w=new n.Cylinder(g,.075,0,1.2,4,1,!1),E=new n.Cylinder(y,.075,0,1.2,4,1,!1),m=new n.Octahedron(h,1e-4,0);this.pickerGizmos={X:[b,new o(1.6,0,0),new o(0,0,-Math.PI/2)],Y:[w,new o(0,1.6,0)],Z:[E,new o(0,0,1.6),new o(Math.PI/2,0,0)],XYZ:[m]},this.setActivePlane=function(e,t){var n=new l;t.applyProjection(n.getInverse(n.extractRotation(this.planes.XY.worldMatrix))),e=="X"&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),e=="Y"&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),e=="Z"&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),e=="XYZ"&&(this.activePlane=this.planes.XYZE),e=="XY"&&(this.activePlane=this.planes.XY),e=="YZ"&&(this.activePlane=this.planes.YZ),e=="XZ"&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},n.TransformGizmoTranslate.prototype=Object.create(n.TransformGizmo.prototype),n.TransformGizmoTranslate.prototype.mode="translate",n.TransformGizmoRotate=function(){n.TransformGizmo.call(this);var e=new n.TransformGizmoMaterial({color:16711680,opacity:.2}),t=new n.TransformGizmoMaterial({color:65280,opacity:.2}),r=new n.TransformGizmoMaterial({color:255,opacity:.2}),i=new n.TransformGizmoMaterial({color:16776960}),s=new n.TransformGizmoMaterial({color:7895160,opacity:.25}),s=new n.TransformGizmoMaterial({color:16711680}),u=new n.Torus(e,1,.02,4,32,Math.PI),a=new n.Torus(t,1,.02,4,32,Math.PI),f=new n.Torus(r,1,.02,4,32,Math.PI),c=new n.Torus(i,1.25,.01,4,64),h=new n.Torus(s,1,.01,4,64);this.handleGizmos={X:[u,new o(0,0,0),new o(0,-Math.PI/2,-Math.PI/2)],Y:[a,new o(0,0,0),new o(Math.PI/2,0,0)],Z:[f,new o(0,0,0),new o(0,0,-Math.PI/2)]};var p=new n.TransformGizmoMaterial({color:16711680,opacity:.25}),d=new n.TransformGizmoMaterial({color:65280,opacity:.25}),v=new n.TransformGizmoMaterial({color:255,opacity:.25}),m=new n.TransformGizmoMaterial({color:983040,opacity:.25}),g=new n.Torus(p,1,.05,4,12,Math.PI),y=new n.Torus(d,1,.05,4,12,Math.PI),b=new n.Torus(v,1,.05,4,12,Math.PI),w=new n.Torus(m,1,.05,2,24);this.pickerGizmos={X:[g,new o(0,0,0),new o(0,-Math.PI/2,-Math.PI/2)],Y:[y,new o(0,0,0),new o(Math.PI/2,0,0)],Z:[b,new o(0,0,0),new o(0,0,-Math.PI/2)]},this.setActivePlane=function(e){e=="E"&&(this.activePlane=this.planes.XYZE),e=="X"&&(this.activePlane=this.planes.YZ),e=="Y"&&(this.activePlane=this.planes.XZ),e=="Z"&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){n.TransformGizmo.prototype.update.apply(this,arguments);var r={handles:this.handles,pickers:this.pickers},i=new l,s=new n.Euler(0,0,1),u=new n.Quat,a=new o(1,0,0),f=new o(0,1,0),c=new o(0,0,1),h=new n.Quat,p=new n.Quat,d=new n.Quat,v=t.clone();s.copy(this.planes.XY._rotation),u.setFromEuler(s),i.makeRotationFromQuaternion(u).getInverse(i),v.applyProjection(i);for(var m in r)for(var g=0;g<r[m].getChildren().size;g++){var y=r[m].getChildren().get(g);u.setFromEuler(s),y.name=="X"&&(h.setFromAxisAngle(a,Math.atan2(-v.y,v.z)),u.multiplyQuaternions(u,h),y.quaternion.copy(u)),y.name=="Y"&&(p.setFromAxisAngle(f,Math.atan2(v.x,v.z)),u.multiplyQuaternions(u,p),y.quaternion.copy(u)),y.name=="Z"&&(d.setFromAxisAngle(c,Math.atan2(v.y,v.x)),u.multiplyQuaternions(u,d),y.quaternion.copy(u))}},this.init()},n.TransformGizmoRotate.prototype=Object.create(n.TransformGizmo.prototype),n.TransformGizmoRotate.prototype.mode="rotate",n.TransformGizmoScale=function(){n.TransformGizmo.call(this);var e=new n.TransformGizmoMaterial({color:11184810,opacity:1}),t=new n.TransformGizmoMaterial({color:16711680,opacity:.2}),r=new n.TransformGizmoMaterial({color:65280,opacity:.2}),i=new n.TransformGizmoMaterial({color:255,opacity:.2}),s=new n.Cube(e,.25,.25,.25),u=new n.Cylinder(null,.1,.1,1,4,1,!1),a=new n.Cube(e,.225,.225,.225),f=new n.Cylinder(null,.1,0,1,20,1,!0);f._position.y=.05;var f=n.Utils.createElement(u,f,t),c=n.Utils.createElement(u,f,r),h=n.Utils.createElement(u,f,i);delete u;var p=new n.Cylinder(t,.08,0,1,4,1,!1),d=new n.Cylinder(r,.08,0,1,4,1,!1),v=new n.Cylinder(i,.08,0,1,4,1,!1),m=new n.Element;m.material=new n.BasicMaterial;var g=new n.Element;g.material=new n.BasicMaterial;var y=new n.Element;y.material=new n.BasicMaterial,this.handleGizmos={X:[p,new o(.5,0,0),new o(0,0,-Math.PI/2)],Y:[d,new o(0,.5,0)],Z:[v,new o(0,0,.5),new o(Math.PI/2,0,0)],XY:[m],YZ:[g],XZ:[y],XYZ:[s]};var b=new n.TransformGizmoMaterial({color:16711680,opacity:.25}),w=new n.TransformGizmoMaterial({color:65280,opacity:.25}),E=new n.TransformGizmoMaterial({color:255,opacity:.25}),S=new n.Cylinder(b,.125,0,1,4,1,!1),x=new n.Cylinder(w,.125,0,1,4,1,!1),T=new n.Cylinder(E,.125,0,1,4,1,!1);this.pickerGizmos={X:[S,new o(.6,0,0),new o(Math.PI/4,0,-Math.PI/2)],Y:[x,new o(0,.6,0),new o(0,Math.PI/4,0)],Z:[T,new o(0,0,.6),new o(Math.PI/2,Math.PI/4,0)],XYZ:[a]},this.setActivePlane=function(e,t){var n=new l;t.applyProjection(n.getInverse(n.extractRotation(this.planes.XY.worldMatrix))),e=="X"?(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)):e=="Y"?(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)):e=="Z"?(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)):e=="XYZ"?this.activePlane=this.planes.XYZE:this.activePlane=this.planes[e],this.hide(),this.show()},this.init()},n.TransformGizmoScale.prototype=Object.create(n.TransformGizmo.prototype),n.TransformGizmoScale.prototype.mode="scale",n.EditInteraction=function(r){function $(t){if(f.network._keyboardRemoveEnabled&&t.keyCode==46&&r.getDataBox().getSelectionModel().size()>0){var n="Delete?";e.confirm(n)&&r.getDataBox().removeSelection()}}function J(t){t.touches.length===1&&(f.deleteTimeoutId=setTimeout(function(){var n=f.network.getElementsByMouseEvent(t,f.selectUnVisible);if(n.length>0){var r=n[0],i="Delete?";e.confirm(i)&&f.network.getDataBox().remove(r.element)}},300))}function K(e){clearTimeout(f.deleteTimeoutId)}function Q(e){clearTimeout(f.deleteTimeoutId)}function G(e){f.update()}function Y(e){if(!f.object||c)return;e.preventDefault(),e.stopPropagation();var t=e.touches?e.touches[0]:e,n=at(t,f.filterIntersectPicker(f.pickers));if(n)f.axis=n.object.name,f.setMode(n.object.mode);else{var r=rt(e);r===f.object||r!=null&&r.editTransformToParent&&r.isDescendantOf(f.object)?(f.axis=f.getAxis(),f.setMode(f.getMode())):f.axis=!1}f.update(!0)}function tt(e){if(e.stop)return;et.set(e.clientX,e.clientY);if(!f.showHelpers||!f.axis)ut(e),Y(e);if(!f.object||c){f.network.dirtyNetwork();return}e.preventDefault(),e.stopPropagation();var n=e.touches?e.touches[0]:e;if(n.button===0||n.button==t){var i=f.filterIntersectPicker(f.pickers),s=at(n,i),o=rt(e);s||(o===f.object||o!=null&&o.editTransformToParent&&o.isDescendantOf(f.object))&&f.getDefaultPickers()&&(s={object:f.getDefaultPickers()});if(s){f.axis=s.object.name,N.copy(X).sub(U).normalize(),f.gizmo[h].setActivePlane(f.axis,N);var u=at(n,[f.gizmo[h].activePlane]);!u&&o&&(u=at(n,[o]));if(u){j.copy(f.object._position),F.copy(f.object._scale),I.extractRotation(f.object.matrix),W.extractRotation(f.object.worldMatrix);var a=f.object.getParent();a==t&&(a=r),q.extractRotation(a.worldMatrix),R.getScaleFromMatrix(C.getInverse(a.worldMatrix)),w.copy(u.point)}}}f.update(!0),c=!0}function nt(e){if(!f.object||!f.axis||!c)return;e.preventDefault(),e.stopPropagation(),e.stop=!0;var t=e.touches?e.touches[0]:e,n=at(t,[f.gizmo[h].activePlane]);n||(n=at(t,[f.object]));if(n){f.moving?r.fireInteractionEvent({kind:"liveMoveBetween",event:Pr}):(r.fireInteractionEvent({kind:"liveMoveStart",event:Pr}),f.moving=!0),b.copy(n.point);if(h=="translate"&&f.translateable){b.sub(w),b.multiply(R),f.space=="local"&&(b.applyMatrix4(C.getInverse(W)),f.axis.search("X")==-1&&(b.x=0),f.axis.search("Y")==-1&&(b.y=0),f.axis.search("Z")==-1&&(b.z=0),b.applyMatrix4(I),f.object.setPosition(j.clone().add(b)));if(f.space=="world"||f.axis.search("XYZ")!=-1){f.axis.search("X")==-1&&(b.x=0),f.axis.search("Y")==-1&&(b.y=0),f.axis.search("Z")==-1&&(b.z=0),b.applyMatrix4(C.getInverse(q)),f.object._position.copy(j);var i=f.object._position.clone().add(b);f.snap&&(f.axis.search("X")!=-1&&(i.x=Math.round(f.object._position.x/f.snap)*f.snap),f.axis.search("Y")!=-1&&(i.y=Math.round(f.object._position.y/f.snap)*f.snap),f.axis.search("Z")!=-1&&(i.z=Math.round(f.object._position.z/f.snap)*f.snap)),f.object.setPosition(i)}}else if(h=="scale"&&f.scaleable){b.sub(w),b.multiply(R);var s=f.object._scale.clone(),o=(f.scaleRate||1)/10;if(f.axis=="XYZ")l=1+b.y*o,s.x=F.x*l,s.y=F.y*l,s.z=F.z*l;else if(f.axis==="XY"){var u=1+b.x*o,a=1+b.y*o;if(f.forceSameScale){var l=Math.max(u,a);s.x=F.x*l,s.y=F.y*l}else s.x=F.x*u,s.y=F.y*a}else if(f.axis==="YZ"){var p=1+b.z*o,a=1+b.y*o;if(f.forceSameScale){var l=Math.max(p,a);s.z=F.z*l,s.y=F.y*l}else s.z=F.z*p,s.y=F.y*a}else if(f.axis==="XZ"){var u=1+b.x*o,p=1+b.z*o;if(f.forceSameScale){var l=Math.max(u,a);s.x=F.x*l,s.z=F.z*l}else s.x=F.x*u,s.z=F.z*p}else b.applyMatrix4(C.getInverse(W)),f.axis=="X"&&(s.x=F.x*(1+b.x*o)),f.axis=="Y"&&(s.y=F.y*(1+b.y*o)),f.axis=="Z"&&(s.z=F.z*(1+b.z*o));f.object.setScale(s)}else if(h=="rotate"&&f.rotateable){b.sub(U),b.multiply(R),k.copy(w).sub(U),k.multiply(R);if(f.axis=="E")b.applyMatrix4(C.getInverse(T)),k.applyMatrix4(C.getInverse(T)),E.set(Math.atan2(b.z,b.y),Math.atan2(b.x,b.z),Math.atan2(b.y,b.x)),S.set(Math.atan2(k.z,k.y),Math.atan2(k.x,k.z),Math.atan2(k.y,k.x)),L.setFromRotationMatrix(C.getInverse(q)),B.setFromAxisAngle(N,E.z-S.z),_.setFromRotationMatrix(W),L.multiplyQuaternions(L,B),L.multiplyQuaternions(L,_),f.object.quaternion.copy(L);else if(f.axis=="XYZE")B.setFromEuler(b.clone().cross(k).normalize()),L.setFromRotationMatrix(C.getInverse(q)),D.setFromAxisAngle(B,-b.clone().angleTo(k)),_.setFromRotationMatrix(W),L.multiplyQuaternions(L,D),L.multiplyQuaternions(L,_),f.object.quaternion.copy(L);else if(f.space=="local"){b.applyMatrix4(C.getInverse(W)),k.applyMatrix4(C.getInverse(W)),E.set(Math.atan2(b.z,b.y),Math.atan2(b.x,b.z),Math.atan2(b.y,b.x)),S.set(Math.atan2(k.z,k.y),Math.atan2(k.x,k.z),Math.atan2(k.y,k.x)),_.setFromRotationMatrix(I),D.setFromAxisAngle(A,E.x-S.x),P.setFromAxisAngle(O,E.y-S.y),H.setFromAxisAngle(M,E.z-S.z),f.axis=="X"&&_.multiplyQuaternions(_,D),f.axis=="Y"&&_.multiplyQuaternions(_,P),f.axis=="Z"&&_.multiplyQuaternions(_,H),f.object.quaternion.copy(_);var d=f.object._rotation.clone();d.setEulerFromQuaternion(_),f.object.setRotation(d)}else if(f.space=="world"){E.set(Math.atan2(b.z,b.y),Math.atan2(b.x,b.z),Math.atan2(b.y,b.x)),S.set(Math.atan2(k.z,k.y),Math.atan2(k.x,k.z),Math.atan2(k.y,k.x)),L.setFromRotationMatrix(C.getInverse(q)),D.setFromAxisAngle(A,E.x-S.x),P.setFromAxisAngle(O,E.y-S.y),H.setFromAxisAngle(M,E.z-S.z),_.setFromRotationMatrix(W),f.axis=="X"&&L.multiplyQuaternions(L,D),f.axis=="Y"&&L.multiplyQuaternions(L,P),f.axis=="Z"&&L.multiplyQuaternions(L,H),L.multiplyQuaternions(L,_),f.object.quaternion.copy(L);var d=f.object._rotation.clone();d.setEulerFromQuaternion(L),f.object.setRotation(d)}}f.changed=!0}f.update(!0),f.updateTextNote(e,f.object)}function rt(e){var t=f.network.getElementsByMouseEvent(e);return r.getFirstEditElement(t)}function it(e){if(e instanceof n.ArrayMaterial){var t=m.materials;for(var r in t)it(t[r])}else e.orignalDepthTest=e.depthTest,e.orignalDepthMask=e.depthMask,e.depthTest=!1,e.depthMask=!1}function st(e){if(e instanceof n.ArrayMaterial){var t=m.materials;for(var r in t)st(t[r])}else e.depthTest=e.orignalDepthTest,e.depthMask=e.orignalDepthMask}function ot(e){return e&&e.editTransformToParent&&e.getParent()?ot(e.getParent()):e}function ut(e){Z===null&&(Z=new s),Z.set(e.clientX,e.clientY),r.getDataBox().clearEditing();if(Z.distanceTo(et)===0){var t=f.network.getElementsByMouseEvent(e),n=r.getFirstEditElement(t);n&&(n!==f.object,f.object=n,f.translateable&&f.gizmo.translate.show(),f.rotateable&&f.gizmo.rotate.show(),f.scaleable&&f.gizmo.scale.show()),n||(f.gizmo[h].hide(),f.gizmo.translate.hide(),f.gizmo.rotate.hide(),f.gizmo.scale.hide(),f.object=null)}else f.changed&&f.onElementPropertyChanged&&(f.changed=!1,f.moving=!1,f.onElementPropertyChanged(e,f.object),r.fireInteractionEvent({kind:"liveMoveEnd",event:Pr}));f.axis=!1,c=!1,f.update(!0),f.hideTextNote()}function at(e,t){if(!t)return null;var n=f.network.getView().getBoundingClientRect(),r=(e.clientX-n.left)/n.width,i=(e.clientY-n.top)/n.height;y.set(r*2-1,-i*2+1,.5),g.unprojectVector(y,u),v.set(X,y.sub(X).normalize()),v.network=f.network;var s=v
.intersectObjects(t,!0,!0);return s[0]?s[0]:!1}n.BaseInteraction.call(this,r);var i=new n.Element,u=r.getCamera(),a=r.getRootView();a=a!==t?a:document,this.domElement=a,this.gizmo={},this.gizmo.translate=new n.TransformGizmoTranslate,this.gizmo.rotate=new n.TransformGizmoRotate,this.gizmo.scale=new n.TransformGizmoScale,i.addChild(this.gizmo.translate),i.addChild(this.gizmo.rotate),i.addChild(this.gizmo.scale),this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.object=!1,this.snap=!1,this.space="local",this.size=1,this.axis=!1;var f=this;this.scaleable=!0,this.rotateable=!0,this.translateable=!0,this.setShowHelpers(!0);var c=!1,h="translate",p="XY",d={type:"change"},v=new n.Picking,g=new n.Projector,y=new o,b=new o,w=new o,E=new o,S=new o,x=1,T=new l,N=new o,C=new l,k=new o,L=new n.Quat,A=new o(1,0,0),O=new o(0,1,0),M=new o(0,0,1),_=new n.Quat,D=new n.Quat,P=new n.Quat,H=new n.Quat,B=new n.Quat,j=new o,F=new o,I=new l,q=new l,R=new o,U=new o,z=new n.Euler,W=new l,X=new o,V=new n.Euler;this.showNote=!0,this.handleDataBoxChange=function(e){e.kind=="remove"?e.data==f.object&&(f.gizmo.translate.hide(),f.gizmo.rotate.hide(),f.gizmo.scale.hide()):e.kind=="clear"&&(f.gizmo.translate.hide(),f.gizmo.rotate.hide(),f.gizmo.scale.hide())},this.network.getDataBox().addDataBoxChangeListener(this.handleDataBoxChange,this),this.network.addPropertyChangeListener(function(e){if(e.property=="dataBox"){var t=e.oldValue,n=e.value;t.removeDataBoxChangeListener(this.handleDataBoxChange),n.addDataBoxChangeListener(this.handleDataBoxChange,this)}}),this.defaultMode="TranslateXY",this.pickers=[],this.gizmo.translate.pickers.getChildren().forEach(function(e){f.pickers.push(e)}),this.gizmo.rotate.pickers.getChildren().forEach(function(e){f.pickers.push(e)}),this.gizmo.scale.pickers.getChildren().forEach(function(e){f.pickers.push(e)}),this.attach=function(e){f.object=e,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.gizmo[h].show(),f.update()},this.detach=function(e){f.object=!1,this.axis=!1,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide()},this.setMode=function(e){h=e?e:h,this.update()},this.setUp=function(){a.addEventListener("mousedown",tt,!1),a.addEventListener("touchstart",tt,!1),a.addEventListener("mousemove",Y,!1),a.addEventListener("touchmove",Y,!1),a.addEventListener("mousemove",nt,!1),a.addEventListener("touchmove",nt,!1),a.addEventListener("mouseup",ut,!1),a.addEventListener("mouseout",ut,!1),a.addEventListener("touchend",ut,!1),a.addEventListener("touchcancel",ut,!1),a.addEventListener("touchleave",ut,!1),a.addEventListener("keydown",$,!1),a.addEventListener("touchstart",J,!1),a.addEventListener("touchmove",K,!1),a.addEventListener("touchend",Q,!1),a.addEventListener("mousewheel",G,!1),f.network.helperBox.addByDescendant(i)},this.tearDown=function(){a.removeEventListener("mousedown",tt,!1),a.removeEventListener("touchstart",tt,!1),a.removeEventListener("mousemove",Y,!1),a.removeEventListener("touchmove",Y,!1),a.removeEventListener("mousemove",nt,!1),a.removeEventListener("touchmove",nt,!1),a.removeEventListener("mouseup",ut,!1),a.removeEventListener("mouseout",ut,!1),a.removeEventListener("touchend",ut,!1),a.removeEventListener("touchcancel",ut,!1),a.removeEventListener("touchleave",ut,!1),a.removeEventListener("keydown",$,!1),a.removeEventListener("touchstart",J,!1),a.removeEventListener("touchmove",K,!1),a.removeEventListener("touchend",Q,!1),a.removeEventListener("mousewheel",G,!1),f.gizmo.translate.hide(),f.gizmo.rotate.hide(),f.gizmo.scale.hide(),f.network.helperBox.removeByDescendant(i)},this.setSnap=function(e){f.snap=e},this.setSize=function(e){f.size=e,f.dispatchEvent(d),this.update()},this.setSpace=function(e){f.space=e,this.update()},this.update=function(e){if(!f.object)return;f.object.updateWorldMatrix(),U.getPositionFromMatrix(f.object.worldMatrix),z.setFromRotationMatrix(C.extractRotation(f.object.worldMatrix)),u.updateWorldMatrix(),X.getPositionFromMatrix(u.worldMatrix),V.setFromRotationMatrix(C.extractRotation(u.worldMatrix)),x=U.distanceTo(X)/12*f.size,i.setPosition(U),i.setScale(x,x,x),N.copy(X).sub(U).normalize(),this.gizmo.scale.update(z,N),f.space=="local"?(this.gizmo.translate.update(z,N),this.gizmo.rotate.update(z,N)):(this.gizmo.translate.update(new n.Euler,N),this.gizmo.rotate.update(new n.Euler,N)),this.gizmo.translate.highlight(null),this.gizmo.rotate.highlight(null),this.gizmo.scale.highlight(null),this.gizmo[h].highlight(f.axis),i.updateWorldMatrix(!0),e&&f.network.dirtyNetwork()},this.getDefaultPickers=function(){return this.defaultMode==="TranslateX"?f.gizmo.translate.pickers.getChildren().get(0):this.defaultMode==="TranslateY"?f.gizmo.translate.pickers.getChildren().get(1):this.defaultMode==="TranslateZ"?f.gizmo.translate.pickers.getChildren().get(2):this.defaultMode==="TranslateXY"?f.gizmo.translate.pickers.getChildren().get(4):this.defaultMode==="TranslateYZ"?f.gizmo.translate.pickers.getChildren().get(5):this.defaultMode==="TranslateXZ"?f.gizmo.translate.pickers.getChildren().get(6):this.defaultMode==="TranslateXYZ"?f.gizmo.translate.pickers.getChildren().get(3):this.defaultMode==="RotateX"?f.gizmo.rotate.pickers.getChildren().get(0):this.defaultMode==="RotateY"?f.gizmo.rotate.pickers.getChildren().get(1):this.defaultMode==="RotateZ"?f.gizmo.rotate.pickers.getChildren().get(2):this.defaultMode==="ScaleX"?f.gizmo.scale.pickers.getChildren().get(0):this.defaultMode==="ScaleY"?f.gizmo.scale.pickers.getChildren().get(1):this.defaultMode==="ScaleZ"?f.gizmo.scale.pickers.getChildren().get(2):this.defaultMode==="ScaleXYZ"?f.gizmo.scale.pickers.getChildren().get(6):this.defaultMode==="ScaleXY"?f.gizmo.scale.pickers.getChildren().get(3):this.defaultMode==="ScaleYZ"?f.gizmo.scale.pickers.getChildren().get(4):this.defaultMode==="ScaleXZ"?f.gizmo.scale.pickers.getChildren().get(5):null},this.getMode=function(){var e=this.defaultMode;return e.startsWith("Translate")?"translate":e.startsWith("Rotate")?"rotate":e.startsWith("Scale")?"scale":"translate"},this.getAxis=function(){var e=this.defaultMode;return e.endsWith("XYZ")?"XYZ":e.endsWith("XY")?"XY":e.endsWith("YZ")?"YZ":e.endsWith("XZ")?"XZ":e.endsWith("Y")?"X":e.endsWith("Y")?"Y":e.endsWith("Z")?"Z":""};var Z=null,et=new s;this.filterIntersectPicker=function(e){var t=[];if(!this.showHelpers)return t;for(var n=0;n<e.length;n++){var r=e[n];r.getParent()===this.gizmo.translate.pickers&&this.translateable&&t.push(r),r.getParent()===this.gizmo.rotate.pickers&&this.rotateable&&t.push(r),r.getParent()===this.gizmo.scale.pickers&&this.scaleable&&t.push(r)}return t}},n.extend(n.EditInteraction,n.BaseInteraction,{setShowHelpers:function(e){this.showHelpers=e,this.gizmo.translate.showHelpers=e,this.gizmo.rotate.showHelpers=e,this.gizmo.scale.showHelpers=e,this.resetHelpers()},onElementPropertyChanged:function(e,t){},resetHelpers:function(){this.showHelpers&&this.translateable&&this.object?this.gizmo.translate.show():this.gizmo.translate.hide(),this.showHelpers&&this.rotateable&&this.object?this.gizmo.rotate.show():this.gizmo.rotate.hide(),this.showHelpers&&this.scaleable&&this.object?this.gizmo.scale.show():this.gizmo.scale.hide(),this.update(!0)},setShowNote:function(e){this.showNote=e},setScaleable:function(e){this.scaleable=e,this.gizmo.scale.showable=e,this.resetHelpers()},setRotateable:function(e){this.rotateable=e,this.gizmo.rotate.showable=e,this.resetHelpers()},setTranslateable:function(e){this.translateable=e,this.gizmo.translate.showable=e,this.resetHelpers()},setDefaultMode:function(e){this.defaultMode=e},setScaleRate:function(e){this.scaleRate=e||1},setForceSameScale:function(e){this.forceSameScale=e},setSpaceMode:function(e){e=="world"?this.space="world":this.space="local",this.update()},createTextNote:function(){this.textNote=document.createElement("div"),this.textNote.style.position="relative",this.textNote.style.color="black",this.textNote.style.height="0px",this.textNote.style.zIndex="1000",this.domElement.appendChild(this.textNote);var e=document.createElement("table");this.noteTable=e,this.textNote.appendChild(this.noteTable);var t=e.createTHead();e.style.borderLeft="1px solid #ffa500",e.style.borderTop="1px solid #ffa500",e.style.fontSize="14px",e.style.backgroundColor="rgba(255, 170, 13, 0.5)",e.setAttribute("border",0),e.setAttribute("cellspacing",0),e.setAttribute("cellpadding",0);for(var n=0;n<4;n++){var r=document.createElement("tr");for(var i=0;i<4;i++){var s=document.createElement("td");s.style.borderRight="1px solid #ffa500",s.style.borderBottom="1px solid #ffa500",s.style.paddingLeft="5px",s.style.paddingRight="5px",s.style.paddingTop="2px",s.style.paddingBottom="2px",n==0&&i>0||n>0&&i==0?(s.style.textAlign="center",s.style.fontWeight="bold"):s.style.textAlign="right",r.appendChild(s)}e.appendChild(r)}},showTextNote:function(){if(!this.showNote)return;this.textNote==null&&this.createTextNote(),this.textNote.style.display=""},hideTextNote:function(){this.textNote&&(this.textNote.style.display="none")},updateTextNote:function(e,t){if(t==null||!this.showNote)return;var n=this.network.getRootView().getBoundingClientRect();this.showTextNote(),this.textNote.style.top=e.clientY-n.top+20+"px",this.textNote.style.left=e.clientX-n.left+20+"px";var r=t.getRotation(),i=t.getPosition(),s=t.getScale(),o=[[" ","x","y","z"],["p",i.x,i.y,i.z],["r",r.x,r.y,r.z],["s",s.x,s.y,s.z]],u=this.noteTable;for(var a=0;a<4;a++)for(var f=0;f<4;f++){var l=o[a][f];a>0&&f>0&&(a==2?l=(l*180/Math.PI).toFixed(0)+"&deg;":l=l.toFixed(2)),u.rows[a].cells[f].innerHTML=""+l}}});var ui=1e-5,ai=0,fi=1,li=2,ci=3;n.CSG=function(e){var t,r,i,o,u,a,f,c=[],h;if(!(e instanceof n.Element)){if(e instanceof di)return this.tree=e,this.matrix=new l,this;throw"TGL.CSG: Given geometry is unsupported"}e.computeNodeData&&e.computeNodeData(),e.updateWorldMatrix(!0),this.matrix=e.worldMatrix.clone();for(t=0,r=e.faces.length;t<r;t++){i=e.faces[t],u=e.uvs[t],a=e.uv2s[t],f=new hi;if(i instanceof C)o=e.vertices[i.a],o=new pi(o.x,o.y,o.z,i.vertexNormals[0],new s(u[0].x,u[0].y),a[0].clone()),o.materialIndex=i.materialIndex,o.applyMatrix4(this.matrix),f.vertices.push(o),o=e.vertices[i.b],o=new pi(o.x,o.y,o.z,i.vertexNormals[1],new s(u[1].x,u[1].y),a[1].clone()),o.materialIndex=i.materialIndex,o.applyMatrix4(this.matrix),f.vertices.push(o),o=e.vertices[i.c],o=new pi(o.x,o.y,o.z,i.vertexNormals[2],new s(u[2].x,u[2].y),a[2].clone()),o.applyMatrix4(this.matrix),o.materialIndex=i.materialIndex,f.vertices.push(o);else{if(!(i instanceof k))throw"Invalid face type at index "+t;o=e.vertices[i.a],o=new pi(o.x,o.y,o.z,i.vertexNormals[0],new s(u[0].x,u[0].y),a[0].clone()),o.materialIndex=i.materialIndex,o.applyMatrix4(this.matrix),f.vertices.push(o),o=e.vertices[i.b],o=new pi(o.x,o.y,o.z,i.vertexNormals[1],new s(u[1].x,u[1].y),a[1].clone()),o.materialIndex=i.materialIndex,o.applyMatrix4(this.matrix),f.vertices.push(o),o=e.vertices[i.c],o=new pi(o.x,o.y,o.z,i.vertexNormals[2],new s(u[2].x,u[2].y),a[2].clone()),o.materialIndex=i.materialIndex,o.applyMatrix4(this.matrix),f.vertices.push(o),o=e.vertices[i.d],o=new pi(o.x,o.y,o.z,i.vertexNormals[3],new s(u[3].x,u[3].y),a[3].clone()),o.applyMatrix4(this.matrix),o.materialIndex=i.materialIndex,f.vertices.push(o)}isNaN(f.calculateProperties().w)?console.log("Not right polygon"):c.push(f)}this.tree=new di(c),this.tree.materialSize=e.getMaterialSize?e.getMaterialSize():0;if(e.material instanceof n.ArrayMaterial)this.tree.material=e.material;else{var p=new n.ArrayMaterial;this.tree.material=p;for(var t=0;t<this.tree.materialSize;t++)p.push(e.material)}},n.CSG.prototype.substract=function(e){var t=this.tree.clone(),r=e.tree.clone();return t.sumMateriaSize(r),t.invert(),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t.invert(),t=new n.CSG(t),t.matrix=this.matrix,t},n.CSG.prototype.union=function(e){var t=this.tree.clone(),r=e.tree.clone();return t.sumMateriaSize(r),t.clipTo(r),r.clipTo(t),r.invert(),r.clipTo(t),r.invert(),t.build(r.allPolygons()),t=new n.CSG(t),t.matrix=this.matrix,t},n.CSG.prototype.intersect=function(e){var t=this.tree.clone(),r=e.tree.clone();return t.sumMateriaSize(r),t.invert(),r.clipTo(t),r.invert(),t.clipTo(r),r.clipTo(t),t.build(r.allPolygons()),t.invert(),t=new n.CSG(t),t.matrix=this.matrix,t},n.CSG.prototype.inverse=function(){var e=this.tree.clone();return e.polygons.map(function(e){e.flip()}),e=new n.CSG(e),e},n.CSG.prototype.toGeometry=function(e){var t,r,i=(new l).getInverse(this.matrix),u=new n.Entity(this.tree.material,e),a=this.tree.allPolygons(),f=a.length,c,h,p={},d,v,m,g,y,b,w;for(t=0;t<f;t++){c=a[t],h=c.vertices.length;for(r=2;r<h;r++){b=[],w=[],g=c.vertices[0],b.push(new s(g.uv.x,g.uv.y)),w.push(g.uv2.clone());var E=g.materialIndex;g=new o(g.x,g.y,g.z),typeof p[g.x+","+g.y+","+g.z]!="undefined"?d=p[g.x+","+g.y+","+g.z]:(u.vertices.push(g),d=p[g.x+","+g.y+","+g.z]=u.vertices.length-1),g=c.vertices[r-1],b.push(new s(g.uv.x,g.uv.y)),w.push(g.uv2.clone()),g=new o(g.x,g.y,g.z),typeof p[g.x+","+g.y+","+g.z]!="undefined"?v=p[g.x+","+g.y+","+g.z]:(u.vertices.push(g),v=p[g.x+","+g.y+","+g.z]=u.vertices.length-1),g=c.vertices[r],b.push(new s(g.uv.x,g.uv.y)),w.push(g.uv2.clone()),g=new o(g.x,g.y,g.z),typeof p[g.x+","+g.y+","+g.z]!="undefined"?m=p[g.x+","+g.y+","+g.z]:(u.vertices.push(g),m=p[g.x+","+g.y+","+g.z]=u.vertices.length-1),y=new C(d,v,m,new o(c.normal.x,c.normal.y,c.normal.z)),y.materialIndex=E||0,u.faces.push(y),u.uvs.push(b),u.uv2s.push(w)}}return u},n.CSG.prototype.toMesh=function(e){var t=this.toGeometry(e);return t.computeBoundingBox(),t};var hi=function(e,n,r){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=t};hi.prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],n=this.vertices[2],r=t.clone().subtract(e),i=n.clone().subtract(e);return this.normal=r.cross(i).normalize(),this.w=this.normal.clone().dot(e),this},hi.prototype.clone=function(){var e,t,n=new hi;for(e=0,t=this.vertices.length;e<t;e++)n.vertices.push(this.vertices[e].clone());return n.calculateProperties(),n},hi.prototype.flip=function(){var e,t=[];this.normal.multiplyScalar(-1),this.w*=-1;for(e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this},hi.prototype.classifyVertex=function(e){var t=this.normal.dot(e)-this.w;return t<-ui?li:t>ui?fi:ai},hi.prototype.classifySide=function(e){var t,n,r,i=0,s=0,o=e.vertices.length;for(t=0;t<o;t++)n=e.vertices[t],r=this.classifyVertex(n),r===fi?i++:r===li&&s++;return i>0&&s===0?fi:i===0&&s>0?li:i===0&&s===0?ai:ci},hi.prototype.splitPolygon=function(e,t,n,r,i){var s=this.classifySide(e);if(s===ai)(this.normal.dot(e.normal)>0?t:n).push(e);else if(s===fi)r.push(e);else if(s===li)i.push(e);else{var o,u,a,f,l,c,h,p,d,v=[],m=[];for(u=0,o=e.vertices.length;u<o;u++)a=(u+1)%o,c=e.vertices[u],h=e.vertices[a],f=this.classifyVertex(c),l=this.classifyVertex(h),f!=li&&v.push(c),f!=fi&&m.push(c),(f|l)===ci&&(p=(this.w-this.normal.dot(c))/this.normal.dot(h.clone().subtract(c)),d=c.interpolate(h,p),v.push(d),m.push(d));v.length>=3&&r.push((new hi(v)).calculateProperties()),m.length>=3&&i.push((new hi(m)).calculateProperties())}},n.CSG.Polygon=hi;var pi=function(e,t,n,r,i,u){this.x=e,this.y=t,this.z=n,this.normal=r||new o,this.uv=i||new s,this.uv2=u||new s};pi.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},pi.prototype.clone=function(){var e=new pi(this.x,this.y,this.z,this.normal.clone(),this.uv.clone(),this.uv2.clone());return e.materialIndex=this.materialIndex,e},pi.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},pi.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},pi.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},pi.prototype.cross=function(e){var t=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-n*e.x,this},pi.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},pi.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},pi.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this.uv2.add(e.uv2.clone().sub(this.uv2).multiplyScalar(t)),this},pi.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},pi.prototype.applyMatrix4=function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this},n.CSG.Vertex=pi;var di=function(e){var n,r,i=[],s=[];this.polygons=[],this.front=this.back=t;if(!(e instanceof Array&&e.length!==0))return;this.divider=e[0].clone();for(n=0,r=e.length;n<r;n++)this.divider.splitPolygon(e[n],this.polygons,this.polygons,i,s);i.length>0&&(this.front=new di(i)),s.length>0&&(this.back=new di(s))};di.isConvex=function(e){var t,n;for(t=0;t<e.length;t++)for(n=0;n<e.length;n++)if(t!==n&&e[t].classifySide(e[n])!==li)return!1;return!0},di.prototype.build=function(e){var t,n,r=[],i=[];this.divider||(this.divider=e[0].clone());for(t=0,n=e.length;t<n;t++)this.divider.splitPolygon(e[t],this.polygons,this.polygons,r,i);r.length>0&&(this.front||(this.front=new di),this.front.build(r)),i.length>0&&(this.back||(this.back=new di),this.back.build(i))},di.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},di.prototype.clone=function(){var e=new di;this.divider&&(e.divider=this.divider.clone()),e.polygons=this.polygons.map(function(e){return e.clone()}),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.materialSize=this.materialSize,e.material=new n.ArrayMaterial;if(this.material)for(var t=0;t<this.material.materials.length;t++)e.material.materials.push(this.material.materials[t]);return e},di.prototype.invert=function(){var e,t,n;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider&&this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),n=this.front,this.front=this.back,this.back=n,this},di.prototype.clipPolygons=function(e){var t,n,r,i;if(!this.divider)return e.slice();r=[],i=[];for(t=0,n=e.length;t<n;t++)this.divider.splitPolygon(e[t],r,i,r,i);return this.front&&(r=this.front.clipPolygons(r)),this.back?i=this.back.clipPolygons(i):i=[],r.concat(i)},di.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},di.prototype.sumMateriaSize=function(e){e.changeMaterialIndex(this.materialSize),this.materialSize=this.materialSize+e.materialSize;for(var t=0;t<e.material.materials.length;t++)this.material.materials.push(e.material.materials[t])},di.prototype.changeMaterialIndex=function(e){for(var t=0;t<this.polygons.length;t++){var n=this.polygons[t];for(var r=0;r<n.vertices.length;r++){var i=n.vertices[r];i.materialIndex=i.materialIndex+e}}this.front&&this.front.changeMaterialIndex(e),this.back&&this.back.changeMaterialIndex(e)},n.CSG.Node=di,n.XmlSerializer=function(e,t,r){this.dataBox=e,this.settings=t?t:new n.SerializationSettings,this.filterFunction=r,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},n.extend(n.XmlSerializer,Object,{serialize:function(){return this.xmlString="<TGL version='"+n.version+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</TGL>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this)},isSerializable:function(e){return this.dataBox.contains(e)?this.filterFunction&&!this.filterFunction(e)?!1:!0:!1},getPropertyType:function(e,t){var n=this.settings.getPropertyType(t);return n||e.__SizePropeties&&e.__SizePropeties.indexOf(t)!=-1&&(n="number"),n},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),n=this.refMap[e.getId()];this.xmlString+="<data class='"+e.getClassName()+"' ref='"+n+"'",this.settings.getPropertyType("id")!=null&&(this.xmlString+=" id='"+e.getId()+"'"),this.xmlString+=">\n",e.serializeXml(this,t),this.xmlString+="</data>\n"}e.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(e,t,r){var i=this.getPropertyType(e,t);if(i){var s=n.getValue(e,t,i),o=n.getValue(r,t,i);s!==o&&this.serializeValue("p",t,s,o,i)}},serializeStyleXml:function(e,t,n){var r=this.settings.getStyleType(t);if(r){var i=e.getStyle(t),s=n.getStyle(t);i!=s&&this.serializeValue("s",t,i,s,r)}},serializeClientXml:function(e,t,n){var r=this.settings.getClientType(t);if(r!=null){var i=e.getClient(t),s=n.getClient(t);i!=s&&this.serializeValue("c",t,i,s,r)}},serializeValue:function(e,t,n,r,i){e==="s"&&(n=this.flattenArray(n),n instanceof Array&&i!=="string"&&i!=="color"&&i!=="number"&&(i="list."+i,n=new S(n)));if(n==null)this.xmlString+="	<"+e+" n='"+t+"' none=''/>\n";else if(i==="cdata")this.xmlString+="	<"+e+" n='"+t+"'><![CDATA["+n+"]]></"+e+">\n";else if(i==="data"){var s=this.refMap[n.getId()];s!=null&&(this.xmlString+="	<"+e+" n='"+t+"' ref='"+s+"'/>\n")}else if(i==="vec2"){if(!r||n.x!==r.x||n.y!==r.y)this.xmlString+="	<"+e+" n='"+t+"' x='"+n.x+"' y='"+n.y+"'/>\n"}else if(i==="vec3"){if(!r||n.x!==r.x||n.y!==r.y||n.z!=r.z)this.xmlString+="	<"+e+" n='"+t+"' x='"+n.x+"' y='"+n.y+"' z='"+n.z+"'/>\n"}else i==="list.vec2"?(this.xmlString+="	<"+e+" n='"+t+"'>\n",n instanceof Array&&(n=new S(n)),n.forEach(function(t){if(t instanceof Array){this.xmlString+="	<"+e+">\n";for(var n=0;n<t.length;n++){var r=t[n];this.xmlString+="		<p x='"+r.x+"' y='"+r.y+"'/>\n"}this.xmlString+="	</"+e+">\n"}else this.xmlString+="		<p x='"+t.x+"' y='"+t.y+"'/>\n"},this),this.xmlString+="	</"+e+">\n"):i==="list.vec3"?(this.xmlString+="	<"+e+" n='"+t+"'>\n",n instanceof Array&&(n=new S(n)),n.forEach(function(t){if(t instanceof Array){this.xmlString+="	<"+e+">\n";for(var n=0;n<t.length;n++){var r=t[n];this.xmlString+="	<"+e+"' x='"+r.x+"' y='"+r.y+"' z='"+r.z+"'/>\n"}this.xmlString+="	</"+e+">\n"}else this.xmlString+="		<"+e+"' x='"+t.x+"' y='"+t.y+"' z='"+t.z+"'/>\n"},this),this.xmlString+="	</"+e+">\n"):i==="list.string"||i==="list.number"||i==="list.color"?(this.xmlString+="	<"+e+" n='"+t+"'>\n",n.forEach(function(e){this.xmlString+="		<s>"+e+"</s>\n"},this),this.xmlString+="	</"+e+">\n"):this.xmlString+="	<"+e+" n='"+t+"'>"+n+"</"+e+">\n"},flattenArray:function(e){if(e instanceof Array){for(var t=0;t<e.length-1;t++)if(e[t]!=e[t+1]){if(!e[t]||!e[t].equals)return e;if(!e[t].equals(e[t+1]))return e}return e[0]}return e},deserialize:function(e,t){n.isDeserializing=!0,this.xmlString=e;var r=n.xml(e).documentElement;this.refMap={},this.idMap={};var i=new S,s=new S,o,u,a,f=r.getElementsByTagName("data"),l=f.length;for(a=0;a<l;a++){u=f[a];var c=u.getAttribute("class"),h=this.settings.getPropertyType("id");if(h&&u.hasAttribute("id")){var p=null;if(h==="string")p=u.getAttribute("id");else if(h==="int")p=parseInt(u.getAttribute("id"));else{if(h!=="number")throw"Unsupported id type '"+h+"'";p=parseFloat(u.getAttribute("id"))}if(u.getAttribute("action")==="remove"){this.dataBox.removeById(p);continue}o=this.dataBox.getDataById(p),o||(o=n.newInstance(c,p))}else o=n.newInstance(c);if(u.hasAttribute("ref")){var d=u.getAttribute("ref");this.refMap[d]=o}i.add(o),s.add(u),this.idMap[o.getId()]=o}this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),l=i.size();for(a=0;a<l;a++){o=i.get(a);if(this.dataBox.containsById(o.getId()))continue;t&&!o.getParent()&&o.setParent(t),this.dataBox.add(o)}for(a=0;a<l;a++)o=i.get(a),u=s.get(a),o.deserializeXml(this,u);this.settings.isDataBoxSerializable&&r.getElementsByTagName("dataBox").length===1&&this.dataBox.deserializeXml(this,r.getElementsByTagName("dataBox")[0]),n.isDeserializing=!1},deserializePropertyXml:function(e,t,r){var i=this.getPropertyType(e,r);i&&n.setValue(e,r,this.deserializeValue(t,i))},deserializeStyleXml:function(e,t,n){var r=this.settings.getStyleType(n);r&&e.setStyle(n,this.deserializeValue(t,r))},deserializeClientXml:function(e,t,n){var r=this.settings.getClientType(n);r&&e.setClient(n,this.deserializeValue(t,r))},deserializePoint:function(e){var t=e.getAttribute("x")?parseFloat(e.getAttribute("x")):null,r=e.getAttribute("a")?parseFloat(e.getAttribute("a")):null;if(t!=null){var i=e.getAttribute("y")?parseFloat(e.getAttribute("y")):null,s=e.getAttribute("z")?parseFloat(e.getAttribute("z")):null,o=e.getAttribute("w")?parseFloat(e.getAttribute("w")):null;return o!=null?new n.Vec4(t,i,s,o):s!=null?new n.Vec3(t,i,s):new n.Vec2(t,i)}if(r!=null){var u=e.getAttribute("b")?parseFloat(e.getAttribute("b")):null,a=e.getAttribute("c")?parseFloat(e.getAttribute("c")):null,f=e.getAttribute("d")?parseFloat(e.getAttribute("d")):null;return f!=null?new n.Face4(r,u,a,f):new n.Face3(r,u,a)}return null},arrayStyleValue:function(e,t){var r=[];if(e.indexOf(",")){r=e.split(",");if(t==="string")return r;if(t==="number"){var i=[];for(var s=0;s<r.length;s++)i.push(parseFloat(r[s]));return i}if(t==="color"){var o=[];for(var s=0;s<r.length;s++)o.push(new n.Color(r[s]));return o}}},deserializeValue:function(e,t,r){if(e.hasAttribute("@none"))return null;var i=e.nodeName==="s",s=i&&e.textContent.indexOf(",")!==-1;if(t==="string")return s?this.arrayStyleValue(e.textContent,t):e.textContent;if(t==="color")return s?this.arrayStyleValue(e.textContent,t):e.textContent;if(t==="number")return s?this.arrayStyleValue(e.textContent,t):parseFloat(e.textContent);if(t==="boolean")return e.textContent==="true";if(t==="int")return parseInt(e.textContent);if(t==="point")return this.deserializePoint(e);if(t==="vec2"){var o=parseFloat(e.getAttribute("x")),u=parseFloat(e.getAttribute("y"));if(!isNaN(o)&&!isNaN(u)||!i)return new n.Vec2(o,u);t="list.point"}if(t==="vec3"){var o=parseFloat(e.getAttribute("x")),u=parseFloat(e.getAttribute("y")),a=parseFloat(e.getAttribute("z"));return new n.Vec3(o,u,a)}if(t==="data"){var f=e.getAttribute("ref"),l=this.refMap[f];return l?l:this.idMap[f]}var c,h,p,d;if(t==="list.point"){var v=new S,m=e.getElementsByTagName("p");c=m.length;for(d=0;d<c;d++){var g=m[d];v.add(this.deserializePoint(g))}return i?v._as:v}if(t==="list.string"){var y=new S;p=e.getElementsByTagName("s"),c=p.length;for(d=0;d<c;d++)y.add(p[d].textContent);return y}if(t==="list.number"){h=new S,p=e.getElementsByTagName("s"),c=p.length;for(d=0;d<c;d++)h.add(parseFloat(p[d].textContent));return h}if(t==="array.string")return e.textContent.split(",");if(t==="array.number"){h=e.textContent.split(","),c=h.length;for(d=0;d<c;d++)h[d]=parseFloat(h[d]);return h}return t==="rectangle"?{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),width:parseFloat(e.getAttribute("w")),height:parseFloat(e.getAttribute("h"))}:e.textContent}}),n.addMethod(n.Data,{serializeXml:function(e,t){if(this.__SizePropeties&&this.__SizePropeties.length){var n,r;for(n=0,r=this.__SizePropeties.length;n<r;n++)this.serializePropertyXml(e,this.__SizePropeties[n],t)}else this.serializePropertyXml(e,"materialSize",t),this.vertices&&this.vertices.length&&this.serializePropertyXml(e,"vertices",t),this.faces&&this.faces.length&&this.serializePropertyXml(e,"faces",t),this.uvs&&this.uvs.length&&this.serializePropertyXml(e,"uvs",t);if(e.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(e,i,t);this.serializePropertyXml(e,"name",t),this.serializePropertyXml(e,"parent",t)},serializePropertyXml:function(e,t,n){e.serializePropertyXml(this,t,n)},serializeClientXml:function(e,t,n){e.serializeClientXml(this,t,n)},deserializeXml:function(e,t){var n=t.getElementsByTagName("p"),r=n.length,i,s,o,u;for(i=0;i<r;i++)s=n[i],s.hasAttribute("n")&&this.deserializePropertyXml(e,s,s.getAttribute("n"));if(e.settings.isClientSerializable){o=t.getElementsByTagName("c"),r=o.length;for(i=0;i<r;i++)u=o[i],u.hasAttribute("n")&&this.deserializeClientXml(e,u,u.getAttribute("n"))}},deserializePropertyXml:function(e,t,n){e.deserializePropertyXml(this,t,n)},deserializeClientXml:function(e,t,n){e.deserializeClientXml(this,t,n)}}),n.addMethod(n.Element,{serializeXml:function(e,t){if(e.settings.isStyleSerializable&&this.styleMap)for(var r in this.styleMap)this.isSideStyle(r)||this.serializeStyleXml(e,r,t);this.serializePropertyXml(e,"position",t),this.serializePropertyXml(e,"rotation",t),this.serializePropertyXml(e,"scale",t),n.Element.superClass.serializeXml.call(this,e,t),this._alarmState.getHighestNativeAlarmSeverity()&&e.settings.getPropertyType("alarmState")==="alarmstate"&&(e.xmlString+="	<p n='alarmState'>\n",n.AlarmSeverity.forEach(function(t){var n=this.getNewAlarmCount(t);n>0&&(e.xmlString+="		<n n='"+t.name+"' c='"+n+"'/>\n")},this._alarmState),n.AlarmSeverity.forEach(function(t){var n=this.getAcknowledgedAlarmCount(t);n>0&&(e.xmlString+="		<a n='"+t.name+"' c='"+n+"'/>\n")},this._alarmState),e.xmlString+="	</p>\n")},serializeStyleXml:function(e,t,n){e.serializeStyleXml(this,t,n)},deserializeXml:function(e,t){n.Element.superClass.deserializeXml.call(this,e,t);if(e.settings.isStyleSerializable){var r=t.getElementsByTagName("s"),i=r.length,s,o;for(s=0;s<i;s++)o=r[s],o.hasAttribute("n")&&this.deserializeStyleXml(e,o,o.getAttribute("n"))}},deserializeStyleXml:function(e,t,n){e.deserializeStyleXml(this,t,n)},deserializePropertyXml:function(e,t,r){if(r==="alarmState"){if(e.settings.getPropertyType("alarmState")==="alarmstate"){var i,s,o,u,a=t.getElementsByTagName("n");for(o=0;o<a.length;o++)u=a[o],s=twaver.AlarmSeverity.getByName(u.getAttribute("n")),this._alarmState.setNewAlarmCount(s,parseInt(u.getAttribute("c")));a=t.getElementsByTagName("a");for(o=0;o<a.length;o++)u=a[o],s=twaver.AlarmSeverity.getByName(u.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(s,parseInt(u.getAttribute("c")))}}else n.Element.superClass.deserializePropertyXml.call(this,e,t,r)}}),n.addMethod(n.DataBox,{serializeXml:function(e,t){if(e.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientXml(e,n,t);this.serializePropertyXml(e,"name",t)},serializePropertyXml:function(e,t,n){e.serializePropertyXml(this,t,n)},serializeClientXml:function(e,t,n){e.serializeClientXml(this,t,n)},deserializeXml:function(e,t){var n=t.getElementsByTagName("p"),r=n.length,i,s,o,u;for(i=0;i<r;i++)s=n[i],s.hasAttribute("n")&&this.deserializePropertyXml(e,s,s.getAttribute("n"));if(e.settings.isClientSerializable){o=t.getElementsByTagName("c"),r=o.length;for(i=0;i<r;i++)u=o[i],u.hasAttribute("n")&&this.deserializeClientXml(e,u,u.getAttribute("n"))}},deserializePropertyXml:function(e,t,n){e.deserializePropertyXml(this,t,n)},deserializeClientXml:function(e,t,n){e.deserializeClientXml(this,t,n)}}),n.JsonSerializer=function(e,t,r){this.dataBox=e,this.settings=t?t:new n.SerializationSettings,this.filterFunction=r,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},n.extend(n.JsonSerializer,Object,{constructor:n.JsonSerializer,className:"TGL.JsonSerializer",serialize:function(){return this.jsonObject={v:n.version,platform:"html5"},this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this);if(this.settings.isDataBoxSerializable){var e={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=e,this.dataBox.serializeJson(this,this.dataBox.newInstance(),e),O.isEmptyObject(e.p)&&delete e.p,O.isEmptyObject(e.s)&&delete e.s,O.isEmptyObject(e.c)&&delete e.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this);if(e instanceof n.ComboNode)for(var t=0;t<e.combos.length;t++){var r=e.combos[t];this.refMap[r.getId()]||(this.refMap[r.getId()]=this.ref++)}},isSerializable:function(e){return this.dataBox.contains(e)?this.filterFunction&&!this.filterFunction(e)?!1:!0:!1},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),n=this.refMap[e.getId()],r={"class":e.getClassName(),ref:n,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=e.getId()),this.jsonObject.datas.push(r),e.serializeJson(this,t,r),O.isEmptyObject(r.p)&&delete r.p,O.isEmptyObject(r.s)&&delete 
r.s,O.isEmptyObject(r.c)&&delete r.c}e.getChildren().forEach(this.serializeData,this)},serializeDataValue:function(e){var t=e.newInstance(),n=this.refMap[e.getId()],r={"class":e.getClassName(),ref:n,p:{},s:{},c:{}};return e.serializeJson(this,t,r),O.isEmptyObject(r.p)&&delete r.p,O.isEmptyObject(r.s)&&delete r.s,O.isEmptyObject(r.c)&&delete r.c,r},getPropertyType:function(e,t){var n=this.settings.getPropertyType(t);return n||(e.__bool&&e.__bool.indexOf(t)!=-1?n="boolean":e.__SizePropeties&&e.__SizePropeties.indexOf(t)!=-1&&(n="number")),n},getStyleType:function(e,t){e.isSideStyle(t)&&(t=t.substr(t.indexOf(".")+1));var n=this.settings.getStyleType(t);return n},serializePropertyJson:function(e,t,r,i){var s=this.getPropertyType(e,t);if(s){var o=n.getValue(e,t,s),u=n.getValue(r,t,s);o!==u&&(o&&o.equals?!o.equals(u)&&this.serializeValue(t,o,u,s,i.p):this.serializeValue(t,o,u,s,i.p))}},serializeStyleJson:function(e,t,n,r){var i=this.getStyleType(e,t);if(i){var s=e.getStyle(t),o=n.getStyle(t);t.startsWith("m.")&&(s=this.flattenArray(s),o=this.flattenArray(o)),t.endsWith(".image")&&(s=this.encodeURI(s),o=this.encodeURI(o)),s!=o&&(s&&s.equals?!s.equals(o)&&this.serializeValue(t,s,o,i,r.s):this.serializeValue(t,s,o,i,r.s))}},serializeClientJson:function(e,t,n,r){var i=this.settings.getClientType(t);if(i!=null){var s=e.getClient(t),o=n.getClient(t);s!=o&&(s&&s.equals?!s.equals(o)&&this.serializeValue(t,s,o,i,r.c):this.serializeValue(t,s,o,i,r.c))}},serializeValue:function(e,t,n,r,i){if(t==null)i[e]=null;else if(t instanceof S)i[e]=t._as;else if(r==="data"){var s=this.refMap[t.getId()];s!=null&&(i[e]=s)}else if(r==="data.list"){var o=[];for(var u=0;u<t.length;u++)o.push(this.serializeDataValue(t[u]));i[e]=o}else if(r==="serializeabe.list"){var o=[];for(var u=0;u<t.length;u++)o.push(t[u].serializeJsonValue());i[e]=o}else t.serializeJsonValue?i[e]=t.serializeJsonValue():i[e]=t},deserialize:function(e,t){n.isDeserializing=!0,this.jsonObject=JSON.parse(e),this.refMap={},this.idMap={};var r=new S,i=new S,s,o=this.jsonObject.datas.length;this.deserializeStartCreateData!=null&&this.deserializeStartCreateData(o);for(var u=0;u<o;u++){var a=this.jsonObject.datas[u],f=a["class"],l=this.settings.getPropertyType("id");if(l&&a.id!=null){if(a.action==="remove"){this.dataBox.removeById(a.id);continue}s=this.dataBox.getDataById(a.id),s||(s=n.newInstance(f,a.id))}else{var c={};s=n.newInstance(f)}a.ref!=null&&(this.refMap[a.ref]=s),r.add(s),i.add(a),this.idMap[s.getId()]=s,this.deserializeCreateData&&this.deserializeCreateData(u,o)}this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),o=r.size(),this.deserializeStartFillData&&this.deserializeStartFillData(o);for(u=0;u<o;u++)s=r.get(u),s.deserializeJson(this,i.get(u)),this.deserializeFillData&&this.deserializeFillData(u,o);this.deserializeStartAddData&&this.deserializeStartAddData(o);for(u=0;u<o;u++){s=r.get(u);if(this.dataBox.containsById(s.getId()))continue;t&&!s.getParent()&&s.setParent(t),s.getClassName()==="TGL.Entity"&&(s.computed=!1,s.computeNodeData()),this.dataBox.add(s),this.deserializeAddData&&this.deserializeAddData(u,o)}this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),n.isDeserializing=!1},deserializePropertyJson:function(e,t,r){var i=this.getPropertyType(e,r);i&&n.setValue(e,r,this.deserializeValue(t,i))},deserializeStyleJson:function(e,t,n){var r=this.getStyleType(e,n);if(r){var i=this.deserializeValue(t,r);i._as&&(i=i._as),e.setStyle(n,i)}},deserializeClientJson:function(e,t,n){var r=this.settings.getClientType(n);r&&e.setClient(n,this.deserializeValue(t,r))},getClassName:function(e){if(e==null)return;if(e.class)return e.class;if(e.w!==t&&e.x!==t&&e.y!==t&&e.z!==t)return"TGL.Vec4";if(e.x!==t&&e.y!==t&&e.z!==t)return"TGL.Vec3";if(e.x!==t&&e.y!==t)return"TGL.Vec2";if(e.a!==t&&e.b!==t&&e.c!==t&&e.d!==t)return"TGL.Face4";if(e.a!==t&&e.b!==t&&e.c!==t)return"TGL.Face3"},translateJson:function(e){if(e==null)return;if(this.getClassName(e)!=null){var t=n.newInstance(this.getClassName(e));if(t.deserializeJsonValue)t.deserializeJsonValue(e);else for(var r in e)t[r]=e[r];return t}if(e instanceof Array)for(var i=0;i<e.length;i++)e[i]=this.translateJson(e[i]);return e},isChinese:function(e){return e=e||"",escape(e).indexOf("%u")>0},encodeURI:function(e){if(e instanceof Array){for(var t=0;t<e.length;t++)e[t]=this.encodeURI(e[t]);return e}return typeof e=="string"&&this.isChinese(e)?encodeURI(e):e},flattenArray:function(e){if(e instanceof Array){for(var t=0;t<e.length-1;t++)if(e[t]!=e[t+1]){if(!e[t]||!e[t].equals)return e;if(!e[t].equals(e[t+1]))return e}return e[0]}return e},deserializeValue:function(e,r){if(r==="data"){var i=this.refMap[e];return i?i:this.idMap[e]}if(r==="data.list"){var s=[],o,u;for(var a=0;a<e.length;a++)o=e[a],u=n.newInstance(o.class),o.ref!=null&&(this.refMap[o.ref]=u),u.deserializeJson(this,o),s.push(u);return s}if(r==="color"&&e.r!=t){var f=new n.Color;return f.setRGB(e.r,e.g,e.b),f}if(e.class==="TGL.Path"){var l=new n.Path;return l.deserializeJsonValue(e),l}if(e instanceof Array){for(var a=0;a<e.length;a++)e[a]=this.translateJson(e[a]);return e}return this.getClassName(e)!=null?this.translateJson(e):e}}),n.addMethod(n.DataBox,{serializeJson:function(e,t,n){if(e.settings.isClientSerializable&&this._clientMap)for(var r in this._clientMap)this.serializeClientJson(e,r,t,n);this.serializePropertyJson(e,"name",t,n)},serializePropertyJson:function(e,t,n,r){e.serializePropertyJson(this,t,n,r)},serializeClientJson:function(e,t,n,r){e.serializeClientJson(this,t,n,r)},deserializeJson:function(e,t){var n;for(n in t.p)this.deserializePropertyJson(e,t.p[n],n);if(e.settings.isClientSerializable)for(n in t.c)this.deserializeClientJson(e,t.c[n],n)},deserializePropertyJson:function(e,t,n){e.deserializePropertyJson(this,t,n)},deserializeClientJson:function(e,t,n){e.deserializeClientJson(this,t,n)}}),n.addMethod(n.Data,{serializeJson:function(e,t,r){if(this.__SizePropeties&&this.__SizePropeties.length){var i,s;for(i=0,s=this.__SizePropeties.length;i<s;i++)this.serializePropertyJson(e,this.__SizePropeties[i],t,r)}else this.materialSize&&this.serializePropertyJson(e,"materialSize",t,r),this instanceof n.Entity&&(this.vertices&&this.vertices.length&&this.serializePropertyJson(e,"vertices",t,r),this.faces&&this.faces.length&&this.serializePropertyJson(e,"faces",t,r),this.uvs&&this.uvs.length&&this.serializePropertyJson(e,"uvs",t,r),this.uv2s&&this.uv2s.length&&this.serializePropertyJson(e,"uv2s",t,r));if(e.settings.isClientSerializable&&this._clientMap)for(var o in this._clientMap)this.serializeClientJson(e,o,t,r);this.serializePropertyJson(e,"name",t,r),this.serializePropertyJson(e,"parent",t,r)},serializePropertyJson:function(e,t,n,r){e.serializePropertyJson(this,t,n,r)},serializeClientJson:function(e,t,n,r){e.serializeClientJson(this,t,n,r)},deserializeJson:function(e,t){var n;for(n in t.p)this.deserializePropertyJson(e,t.p[n],n);if(e.settings.isClientSerializable)for(n in t.c)this.deserializeClientJson(e,t.c[n],n)},deserializePropertyJson:function(e,t,n){e.deserializePropertyJson(this,t,n)},deserializeClientJson:function(e,t,n){e.deserializeClientJson(this,t,n)}}),n.addMethod(n.Element,{serializeJson:function(e,t,r){if(e.settings.isStyleSerializable&&this.styleMap)for(var i in this.styleMap)this.isSideStyle(i)||this.serializeStyleJson(e,i,t,r);n.Element.superClass.serializeJson.call(this,e,t,r),this.serializePropertyJson(e,"position",t,r),this.serializePropertyJson(e,"rotation",t,r),this.serializePropertyJson(e,"scale",t,r);if(this._alarmState.getHighestNativeAlarmSeverity()&&e.settings.getPropertyType("alarmState")==="alarmstate"){var s={n:{},a:{}};r.p.alarmState=s,n.AlarmSeverity.forEach(function(e){var t=this.getNewAlarmCount(e);t>0&&(s.n[e.name]=t)},this._alarmState),n.AlarmSeverity.forEach(function(e){var t=this.getAcknowledgedAlarmCount(e);t>0&&(s.a[e.name]=t)},this._alarmState),O.isEmptyObject(s.n)&&delete s.n,O.isEmptyObject(s.a)&&delete s.a,O.isEmptyObject(s)&&delete r.p.alarmState}},serializeStyleJson:function(e,t,n,r){e.serializeStyleJson(this,t,n,r)},deserializeJson:function(e,t){n.Element.superClass.deserializeJson.call(this,e,t);if(e.settings.isStyleSerializable)for(var r in t.s)this.deserializeStyleJson(e,t.s[r],r)},deserializeStyleJson:function(e,t,n){e.deserializeStyleJson(this,t,n)},deserializePropertyJson:function(e,t,r){if(r==="alarmState"){if(e.settings.getPropertyType("alarmState")==="alarmstate"){var i;for(i in t.n)this._alarmState.setNewAlarmCount(twaver.AlarmSeverity.getByName(i),t.n[i]);for(i in t.a)this._alarmState.setAcknowledgedAlarmCount(twaver.AlarmSeverity.getByName(i),t.a[i])}}else n.Element.superClass.deserializePropertyJson.call(this,e,t,r)}}),n.addMethod(n.Light,{serializeJson:function(e,t,r){n.Light.superClass.serializeJson.call(this,e,t,r),this.serializePropertyJson(e,"color",t,r),this.serializePropertyJson(e,"ambient",t,r),this.serializePropertyJson(e,"diffuse",t,r),this.serializePropertyJson(e,"specular",t,r),this.serializePropertyJson(e,"castShadow",t,r),this.serializePropertyJson(e,"onlyShadow",t,r);if(t.__accessor&&t.__accessor.length)for(var i=0;i<t.__accessor.length;i++)this.serializePropertyJson(e,t.__accessor[i],t,r)}})})(window);!function(){function HtmlLabelAttachment(e,t){HtmlBasicAttachment.call(this,e,t),this.label=!0}function split(e,t,i){if(t=t||[],e.length<=3)return t.push(e),t;for(var n=[],a=e.length,o=[],r=[],s=0,l=0;a>l;l++){var d=e[l],c=e[l+1===a?0:l+1],h={x:c.x-d.x,y:c.y-d.y};o.push(h),r.push(d),s+=(c.x-d.x)*(c.y+d.y)}i=void 0===i?0>s:i;for(var u=o.length,g=!1,l=0;u-1>l;l++)if(isConcave(o[l],o[l+1],i)){for(var m=l+1,p=null,f=0;u>f;f++)if(area(e[f],e[m-1],e[m],i)<0&&area(e[f],e[m],e[m+1===a?0:m+1],i)<0){p=f;break}if(null===p&&(p=m-2,0>p&&(p+=e.length)),null!=p){var v=p;v>m&&(v-=e.length);for(var y=v;m>=y;y++){var b=y;0>b&&(b+=e.length),n.push(e[b])}t.push(n);for(var y=m-1;y>v;y--){var b=y;0>b&&(b+=e.length);var C=e[b],w=r.indexOf(C);r.splice(w,1)}split(r,t,i),g=!0}break}return r.length>0&&!g&&t.push(r),t}function isConcave(e,t,i){var n=i?1:-1;return(e.x*t.y-t.x*e.y)*n<0?!0:!1}function area(e,t,i,n){var a=n?1:-1;if(!e||!t||!i)return 1;var o=-e.x*t.y-t.x*i.y-i.x*e.y+i.x*t.y+t.x*e.y+e.x*i.y;return o*a}function initElement(e){e.setStyle("select.offset",1),e.setStyle("select.width",1)}function getRadius(e,t,i){var n=e.x-t.x,a=e.y-t.y,o=Math.sqrt(n*n+a*a);return o*(1+i*i)/(4*Math.abs(i))}function drawPathA(e,t,i,n,a,o,r,s,l,d){var c={x:e,y:t};a*=Math.PI/180;var h={x:s,y:l},u={x:Math.cos(a)*(c.x-h.x)/2+Math.sin(a)*(c.y-h.y)/2,y:-Math.sin(a)*(c.x-h.x)/2+Math.cos(a)*(c.y-h.y)/2},g=Math.pow(u.x,2)/Math.pow(i,2)+Math.pow(u.y,2)/Math.pow(n,2);g>1&&(i*=Math.sqrt(g),n*=Math.sqrt(g));var m=(o==r?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(n,2)-Math.pow(i,2)*Math.pow(u.y,2)-Math.pow(n,2)*Math.pow(u.x,2))/(Math.pow(i,2)*Math.pow(u.y,2)+Math.pow(n,2)*Math.pow(u.x,2)));isNaN(m)&&(m=0);var p={x:m*i*u.y/n,y:m*-n*u.x/i},f={x:(c.x+h.x)/2+Math.cos(a)*p.x-Math.sin(a)*p.y,y:(c.y+h.y)/2+Math.sin(a)*p.x+Math.cos(a)*p.y},v=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},y=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(v(e)*v(t))},b=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(y(e,t))},C=b([1,0],[(u.x-p.x)/i,(u.y-p.y)/n]),w=[(u.x-p.x)/i,(u.y-p.y)/n],S=[(-u.x-p.x)/i,(-u.y-p.y)/n],x=b(w,S);y(w,S)<=-1&&(x=Math.PI),y(w,S)>=1&&(x=0);var y=i>n?i:n,I=i>n?1:i/n,P=i>n?n/i:1;d.translate(f.x,f.y),d.rotate(a),d.scale(I,P),d.arc(0,0,y,C,C+x,1-r),d.scale(1/I,1/P),d.rotate(-a),d.translate(-f.x,-f.y)}function setTableBorder(){var e="#DDDDDD";tr1.style["border-bottom"]="2pt solid "+e,td1.style["border-right"]="2pt solid "+e}HtmlBasicAttachment=function(e,t){function i(e,t,i,n,a,o,r){i||(i=this._origin.x),n||(n=this._origin.y),a||(a=this._location.x),o||(o=this._location.y),e=e-i-a,t=t-n-o;var s=twaver.Util.transformPoint({x:i+a,y:n+o},r?this._radian:-this._radian,e,t).point;return s}twaver.network.BasicAttachment.superClass.constructor.call(this,e,t),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._triangleDiv=twaver.Util.createDiv(),this._roundDiv=twaver.Util.createDiv(),this._contentDiv=twaver.Util.createDiv(),twaver.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),twaver.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var n=this;this.hit=function(e,t){if(this._radian&&this._origin){var a=i.call(n,e,t);e=a.x,t=a.y}return twaver.Util.containsPoint(this._roundRect,e,t)||twaver.Util.containsPoint(this._pointerRect,e,t)},this.intersects=function(e){var t={x:e.x,y:e.y},a={x:e.x+e.width,y:e.y},o={x:e.x,y:e.y+e.height},r={x:e.x+e.width,y:e.y+e.height};if(this._radian&&this._origin){if(e.width*e.height>50)return!1;t=i.call(n,t.x,t.y),a=i.call(n,a.x,a.y),o=i.call(n,o.x,o.y),r=i.call(n,r.x,r.y)}return e=twaver.Util.getRect([t,a,o,r]),twaver.Util.intersects(this._roundRect,e)||twaver.Util.intersects(this._pointerRect,e)},this.getContentWidth=function(){return this._contentDiv.scrollWidth||parseInt(twaver.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},this.getContentHeight=function(){return this._contentDiv.scrollHeight||parseInt(twaver.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},this._view.appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},twaver.Util.ext(HtmlBasicAttachment,twaver.network.BasicAttachment,{calculateMeasure:function(){var e=this.getContentWidth(),t=this.getContentHeight(),i=Math.min(this.getCornerRadius(),t/2),n=this.getPointerLength(),a=this.getPointerWidth(),o=this.getPosition(),r=this.getXOffset(),s=this.getYOffset();this._contentRect.width=e,this._contentRect.height=t,this._contentRect.x=i;var l=this._roundRect;l.width=e+2*i,l.height=t;var d;if(n>0){var c=this.getDirection();d=this._network.getPosition(o,this._ui,null,r,s);if("aboveleft"===c){l.y=d.y-n-l.height,l.x=d.x-(l.width-i),this._pointers=[d,{x:d.x,y:d.y-n},{x:d.x-Math.min(a,e),y:d.y-n}];var h=n/2,u=Math.min(a,e)/2,g=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+u+"px "+h+"px "+u+"px",this._triangleBorderColorStyle=g+" "+g+" transparent transparent",this._triangleDivLocation=this._pointers[2]}else if("aboveright"===c){l.y=d.y-n-l.height,l.x=d.x-i,this._pointers=[d,{x:d.x,y:d.y-n},{x:d.x+Math.min(a,e),y:d.y-n}];var h=n/2,u=Math.min(a,e)/2,g=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+u+"px "+h+"px "+u+"px",this._triangleBorderColorStyle=g+" transparent transparent "+g,this._triangleDivLocation=this._pointers[1]}else if("belowleft"===c){l.y=d.y+n,l.x=d.x-(l.width-i),this._pointers=[d,{x:d.x,y:d.y+n},{x:d.x-Math.min(a,e),y:d.y+n}];var h=n/2,u=Math.min(a,e)/2,g=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+u+"px "+h+"px "+u+"px",this._triangleBorderColorStyle=" transparent "+g+" "+g+" transparent",this._triangleDivLocation={x:this._pointers[2].x,y:d.y}}else if("belowright"===c){l.y=d.y+n,l.x=d.x-i,this._pointers=[d,{x:d.x,y:d.y+n},{x:d.x+Math.min(a,e),y:d.y+n}];var h=n/2,u=Math.min(a,e)/2,g=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+u+"px "+h+"px "+u+"px",this._triangleBorderColorStyle="transparent transparent "+g+" "+g,this._triangleDivLocation=this._pointers[0]}else if("above"===c){l.y=d.y-n-l.height,l.x=d.x-l.width/2,this._pointers=[d,{x:d.x-Math.min(a,e)/2,y:d.y-n},{x:d.x+Math.min(a,e)/2,y:d.y-n}];var h=n,u=Math.min(a,e)/2,g=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+u+"px 0px "+u+"px",this._triangleBorderColorStyle=g+" transparent transparent transparent",this._triangleDivLocation=this._pointers[1]}else if("below"===c){l.y=d.y+n,l.x=d.x-l.width/2,this._pointers=[d,{x:d.x-Math.min(a,e)/2,y:d.y+n},{x:d.x+Math.min(a,e)/2,y:d.y+n}];var h=n,u=Math.min(a,e)/2,g=this.getFillColor();this._triangleBorderWidthStyle="0px "+u+"px "+h+"px "+u+"px",this._triangleBorderColorStyle="transparent transparent "+g+" transparent ",this._triangleDivLocation={x:this._pointers[1].x,y:d.y}}else if("left"===c){l.y=d.y-l.height/2,l.x=d.x-l.width-n,this._pointers=[d,{x:d.x-n,y:d.y-Math.min(a,t)/2},{x:d.x-n,y:d.y+Math.min(a,t)/2}];var h=Math.min(a,t)/2,u=n,g=this.getFillColor();this._triangleBorderWidthStyle=h+"px 0px "+h+"px "+u+"px",this._triangleBorderColorStyle="transparent transparent  transparent "+g,this._triangleDivLocation=this._pointers[1]}else{if("right"!==c)throw"Can not resolve '"+c+"' attachment direction";l.y=d.y-l.height/2,l.x=d.x+n,this._pointers=[d,{x:d.x+n,y:d.y-Math.min(a,t)/2},{x:d.x+n,y:d.y+Math.min(a,t)/2}];var h=Math.min(a,t)/2,u=n,g=this.getFillColor();this._triangleBorderWidthStyle=h+"px "+u+"px "+h+"px 0px",this._triangleBorderColorStyle="transparent "+g+" transparent  transparent ",this._triangleDivLocation={x:d.x,y:this._pointers[1].y}}}else d=this._network.getPosition(o,this._ui,{width:l.width,height:l.height},r,s),l.x=d.x,l.y=d.y,this._pointers=null;this._location=d},updateMeasure:function(){if(this.calculateMeasure(),this._ui.isShadowable()&&this.isShadowable()?twaver.Util.setCSSStyle(this._roundDiv,"text-shadow",this._ui._shadowXOffset+"px "+this._ui._shadowYOffset+"px "+this._ui._shadowBlur+"px "+this._ui._shadowColor):twaver.Util.removeCSSStyle(this._roundDiv,"text-shadow"),this._pointerRect=twaver.Util.getRect(this._pointers),this._viewRect=twaver.Util.unionRect(this._pointerRect,this._roundRect),twaver.Util.setCSSStyle(this._contentDiv,"left",this._contentRect.x+"px"),twaver.Util.setCSSStyle(this._contentDiv,"top",this._contentRect.y+"px"),twaver.Util.setCSSStyle(this._roundDiv,"left",this._roundRect.x+"px"),twaver.Util.setCSSStyle(this._roundDiv,"top",this._roundRect.y+"px"),twaver.Util.setCSSStyle(this._roundDiv,"width",this._roundRect.width+"px"),twaver.Util.setCSSStyle(this._roundDiv,"height",this._roundRect.height+"px"),twaver.Util.setCSSStyle(this._roundDiv,"background",this.isFill()?this.getFillColor():null),twaver.Util.setCSSStyle(this._roundDiv,"-webkit-border-radius",this.getCornerRadius()+"px"),twaver.Util.setCSSStyle(this._roundDiv,"-moz-border-radius",this.getCornerRadius()+"px"),twaver.Util.setCSSStyle(this._roundDiv,"border-radius",this.getCornerRadius()+"px"),this._pointers?(twaver.Util.setCSSStyle(this._triangleDiv,"left",this._triangleDivLocation.x+"px"),twaver.Util.setCSSStyle(this._triangleDiv,"top",this._triangleDivLocation.y+"px"),twaver.Util.setCSSStyle(this._triangleDiv,"border-width",this._triangleBorderWidthStyle),twaver.Util.setCSSStyle(this._triangleDiv,"border-color",this._triangleBorderColorStyle),this._view.appendChild(this._triangleDiv)):this._triangleDiv.parentNode==this._view&&this._view.removeChild(this._triangleDiv),this._element.getStyle("label.rotatable")&&this.label){var e=this._ui.getFromPoint(),t=this._ui.getToPoint(),i=this._ui.getLinkPoints();i.size()%2==0&&(e=i.get(i.size()/2-1),t=i.get(i.size()/2)),this._radian=e.x>t.x?twaver.Util.getRadiansBetweenLines(t,e):twaver.Util.getRadiansBetweenLines(e,t),this._origin={x:this._contentRect.width/2,y:0};var n="rotate("+twaver.Util.toDegrees(this._radian)+"deg)",a=this._origin.x+"px "+this._origin.y+"px";twaver.Util.isChrome||twaver.Util.isSafari?(twaver.Util.setCSSStyle(this._roundDiv,"-webkit-transform",n),twaver.Util.setCSSStyle(this._roundDiv,"-webkit-transform-origin",a)):twaver.Util.isIE?(twaver.Util.setCSSStyle(this._roundDiv,"-ms-transform",n),twaver.Util.setCSSStyle(this._roundDiv,"-ms-transform-origin",a)):(twaver.Util.setCSSStyle(this._roundDiv,"transform",n),twaver.Util.setCSSStyle(this._roundDiv,"transform-origin",a))}else twaver.Util.removeCSSStyle(this._roundDiv,"-webkit-transform"),twaver.Util.removeCSSStyle(this._roundDiv,"-webkit-transform-origin"),twaver.Util.removeCSSStyle(this._roundDiv,"-ms-transform"),twaver.Util.removeCSSStyle(this._roundDiv,"-ms-transform-origin"),twaver.Util.removeCSSStyle(this._roundDiv,"transform"),twaver.Util.removeCSSStyle(this._roundDiv,"transform-origin"),delete this._origin,delete this._radian}}),HtmlAlarmAttachment=function(e,t){HtmlBasicAttachment.call(this,e,t),this.alarm=!0},twaver.Util.ext(HtmlAlarmAttachment,twaver.network.AlarmAttachment,{updateMeasure:function(){var e=this.getFont("alarm.font");this._contentDiv.innerHTML=this._network.getAlarmLabel(this._element),twaver.Util.setCSSStyle(this._contentDiv,"font",e),this._fillColor=this._network.getAlarmFillColor(this._element),HtmlBasicAttachment.prototype.updateMeasure.call(this),twaver.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:HtmlBasicAttachment.prototype.calculateMeasure}),twaver.Util.ext(HtmlLabelAttachment,twaver.network.LabelAttachment,{updateMeasure:function(){var e=this.getFont("label.font"),t=this.getLabel();this._contentDiv.innerHTML=t,twaver.Util.setCSSStyle(this._contentDiv,"font",e),HtmlBasicAttachment.prototype.updateMeasure.call(this),twaver.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:HtmlBasicAttachment.prototype.calculateMeasure}),HtmlComponentAttachment=function(e,t){HtmlBasicAttachment.call(this,e,t)},twaver.Util.ext(HtmlComponentAttachment,HtmlBasicAttachment,{updateMeasure:function(){var e=this._element.getStyle("component.content");e.parentNode&&e.parentNode==this._contentDiv||this._contentDiv.appendChild(e),this._fillColor=this._element.getStyle("component.fillcolor"),this._fillColor||(this._fillColor="blue"),HtmlBasicAttachment.prototype.updateMeasure.call(this)},getPosition:function(){return this.getStyle("component.position")},getDirection:function(){return this.getStyle("component.direction")},getPointerLength:function(){return this.getStyle("component.pointer.length")},getPointerWidth:function(){return this.getStyle("component.pointer.width")},isShadowable:function(){return!1},getCornerRadius:function(){var e=this.getStyle("component.corner.radius");return e?e:10},getPointerLength:function(){var e=this.getStyle("component.pointer.length");return e?e:8},getPointerWidth:function(){var e=this.getStyle("component.pointer.width");return e?e:5},getPosition:function(){var e=this.getStyle("component.position");return e?e:"top"},getXOffset:function(){var e=this.getStyle("component.xoffset");return e?e:0},getYOffset:function(){var e=this.getStyle("component.yoffset");return e?e:0},getDirection:function(){var e=this.getStyle("component.direction");return e?e:"aboveright"},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor}});var TWEEN=TWEEN||function(){var e=[];return{REVISION:"14",getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){t=e.indexOf(t),-1!==t&&e.splice(t,1)},update:function(t){if(0===e.length)return!1;for(var i=0,t=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();i<e.length;)e[i].update(t)?i++:e.splice(i,1);return!0}}}();TWEEN.Tween=function(e){var t,i={},n={},a={},o=1e3,r=0,s=!1,l=!1,d=0,c=null,h=TWEEN.Easing.Linear.None,u=TWEEN.Interpolation.Linear,g=[],m=null,p=!1,f=null,v=null,y=null;for(t in e)i[t]=parseFloat(e[t],10);this.to=function(e,t){return void 0!==t&&(o=t),n=e,this},this.start=function(t){TWEEN.add(this),l=!0,p=!1,c=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),c+=d;for(var o in n){if(n[o]instanceof Array){if(0===n[o].length)continue;n[o]=[e[o]].concat(n[o])}i[o]=e[o],!1==i[o]instanceof Array&&(i[o]*=1),a[o]=i[o]||0}return this},this.stop=function(){return l?(TWEEN.remove(this),l=!1,null!==y&&y.call(e),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=g.length;t>e;e++)g[e].stop()},this.delay=function(e){return d=e,this},this.repeat=function(e){return r=e,this},this.yoyo=function(e){return s=e,this},this.easing=function(e){return h=e,this},this.interpolation=function(e){return u=e,this},this.chain=function(){return g=arguments,this},this.onStart=function(e){return m=e,this},this.onUpdate=function(e){return f=e,this},this.onComplete=function(e){return v=e,this},this.onStop=function(e){return y=e,this},this.update=function(t){var l;if(c>t)return!0;!1===p&&(null!==m&&m.call(e),p=!0);var y=(t-c)/o,y=y>1?1:y,b=h(y);for(l in n){var C=i[l]||0,w=n[l];w instanceof Array?e[l]=u(w,b):("string"==typeof w&&(w=C+parseFloat(w,10)),"number"==typeof w&&(e[l]=C+(w-C)*b))}if(null!==f&&f.call(e,b),1==y){if(!(r>0)){for(null!==v&&v.call(e),l=0,y=g.length;y>l;l++)g[l].start(t);return!1}isFinite(r)&&r--;for(l in a)"string"==typeof n[l]&&(a[l]+=parseFloat(n[l],10)),s&&(y=a[l],a[l]=n[l],n[l]=y),i[l]=a[l];c=t+d}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return 1>(e*=2)?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:1>(e*=2)?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return 1>(e*=2)?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,i=.1;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=.1):t=.4*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)))},Out:function(e){var t,i=.1;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=.1):t=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/.4)+1)},InOut:function(e){var t,i=.1;return 0===e?0:1===e?1:(!i||1>i?(i=1,t=.1):t=.4*Math.asin(1/i)/(2*Math.PI),1>(e*=2)?-.5*i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4):.5*i*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)+1)}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){return 1>(e*=2)?.5*e*e*(3.5949095*e-2.5949095):.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var i=e.length-1,n=i*t,a=Math.floor(n),o=TWEEN.Interpolation.Utils.Linear;return 0>t?o(e[0],e[1],n):t>1?o(e[i],e[i-1],i-n):o(e[a],e[a+1>i?i:a+1],n-a)},Bezier:function(e,t){var i,n=0,a=e.length-1,o=Math.pow,r=TWEEN.Interpolation.Utils.Bernstein;for(i=0;a>=i;i++)n+=o(1-t,a-i)*o(t,i)*e[i]*r(a,i);return n},CatmullRom:function(e,t){var i=e.length-1,n=i*t,a=Math.floor(n),o=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(0>t&&(a=Math.floor(n=i*(1+t))),o(e[(a-1+i)%i],e[a],e[(a+1)%i],e[(a+2)%i],n-a)):0>t?e[0]-(o(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[i]-(o(e[i],e[i],e[i-1],e[i-1],n-i)-e[i]):o(e[a?a-1:0],e[a],e[a+1>i?i:a+1],e[a+2>i?i:a+2],n-a)},Utils:{Linear:function(e,t,i){return(t-e)*i+e},Bernstein:function(e,t){var i=TWEEN.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){var e=[1];return function(t){var i,n=1;if(e[t])return e[t];for(i=t;i>1;i--)n*=i;return e[t]=n}}(),CatmullRom:function(e,t,i,n,a){var e=.5*(i-e),n=.5*(n-t),o=a*a;return(2*t-2*i+e+n)*a*o+(-3*t+3*i-2*e-n)*o+e*a+t}}},function(){abc={},modelnode={},modelimp={},interaction={},gadgets={},modellib={},editnodes={},DEFAULT_THUMBNAIL="crash.png",MaterialDesc=function(){this.type="phong",this.sides=mono.DoubleSide,this.repeat=null,this.tType=6,this.wraps=mono.RepeatWrapping,this.wrapt=mono.RepeatWrapping,this.transparent=!1,this.opacity=[],this.texture=[]},twaver.Util.ext("MaterialDesc",Object,{wrap3DStyle:function(e){var t={};if(this.texture=Utils.handlerTexture(this.texture),this.texture&&(t[M_MAP_SRC]=this.texture),this.type||(this.type="phong"),this.repeat)if(2!=this.repeat.length||this.repeat[0]instanceof Array){if(this.repeat instanceof Array){var i=[];for(var n in this.repeat)i.push(new mono.Vec2(this.repeat[n][0],this.repeat[n][1]));this.repeat=i}}else this.repeat=new mono.Vec2(this.repeat[0],this.repeat[1]);else this.repeat=new mono.Vec2(1,1);t[M_MAP_REPEAT]=this.repeat,this.type&&(t[M_TYPE]=this.type),this.transparent instanceof Array?t[M_TRANSPARENT]=this.transparent:void 0!=this.transparent&&(t[M_TRANSPARENT]=this.transparent),t[M_OPACITY]=this.opacity instanceof Array?this.opacity:void 0!=this.opacity?this.opacity:1,t[M_VISIBLE]=this.visible instanceof Array?this.visible:!1===this.visible?!1:!0,t[M_TEXTURE_FLIPX]=this.flipX instanceof Array?this.flipX:!0===this.flipX?!0:!1,t[M_TEXTURE_FLIPY]=this.flipY instanceof Array?this.flipY:!0===this.flipY?!0:!1,this.specularStrength instanceof Array?t[M_SPECULARSTRENGTH]=this.specularStrength:void 0!=this.specularStrength&&(t[M_SPECULARSTRENGTH]=this.specularStrength),t[M_POLYGONOFFSET]=this.polygonOffset instanceof Array?this.polygonOffset:!0===this.polygonOffset?!0:!1,this.polygonOffsetFactor instanceof Array?t[M_POLYGONOFFSETFACTOR]=this.polygonOffsetFactor:void 0!=this.polygonOffsetFactor&&(t[M_POLYGONOFFSETFACTOR]=this.polygonOffsetFactor),this.polygonOffsetUnits instanceof Array?t[M_POLYGONOFFSETUNITS]=this.polygonOffsetUnits:void 0!=this.polygonOffsetUnits&&(t[M_POLYGONOFFSETUNITS]=this.polygonOffsetUnits),this.type&&(t[M_TYPE]=this.type),this.ambient&&(t[M_AMBIENT]=this.ambient),t[M_SIDE]=mono.DoubleSide,this.color&&(t[M_COLOR]=this.color),e instanceof mono.Billboard||(e.setStyle(M_WRAPS,mono.RepeatWrapping),e.setStyle(M_WRAPT,mono.RepeatWrapping)),e instanceof mono.Cylinder&&(this.openTop&&e.setOpenTop(!0),this.openBottom&&e.setOpenBottom(this.openBottom)),e.s(t)}}),Cylinder_faces=["side","top","bottom"],MaterialDesc.faces=["right","left","top","bottom","front","back"],M_MAP_SRC="m.texture.image",M_MAP_REPEAT="m.texture.repeat",M_VISIBLE="m.visible",M_TRANSPARENT="m.transparent",M_COLOR="m.color",M_WRAPS="m.texture.wrapS",M_WRAPT="m.texture.wrapT",M_OPACITY="m.opacity",M_CUBE_REPEAT=[1,1],M_TYPE="m.type",M_SIDE="m.side",M_ALIGNMENT="m.alignment",M_AMBIENT="m.ambient",M_TEXTURE_FLIPX="m.texture.flipX",M_TEXTURE_FLIPY="m.texture.flipY",M_SPECULARSTRENGTH="m.specularStrength",M_POLYGONOFFSET="m.polygonOffset",M_POLYGONOFFSETFACTOR="m.polygonOffsetFactor",M_POLYGONOFFSETUNITS="m.polygonOffsetUnits",GeometryTranslater={},GeometryTranslater.get3DGeometryFromModelImp=function(e){var t=modelManager.getModelLib(),i=t.getValue(e,"size"),n=t.getValue(e,"pos"),a=t.getValue(e,"className");a||(a=t.getValue(e,"type"));var o=t.getValue(e,"scale"),r=t.getValue(e,"dt"),s=t.getValue(e,"repeat"),l=t.getValue(e,"types"),d=t.getValue(e,"color"),c=t.getValue(e,"transparent"),h=t.getValue(e,"opacity"),u=t.getValue(e,"visible"),g=t.getValue(e,"ambient"),m=t.getValue(e,TAG_ANIMATION),p=t.getValue(e,"animationGroup"),f=t.getValue(e,CUSTOM_PROPS),v=t.getValue(e,"flipX"),y=t.getValue(e,"flipY"),b=t.getValue(e,"specularStrength"),C=t.getValue(e,"polygonOffset"),w=t.getValue(e,"polygonOffsetFactor"),S=t.getValue(e,"polygonOffsetUnits"),x=t.getValue(e,"openTop"),I=t.getValue(e,"openBottom"),P=t.getValue(e,"object3dId"),_=t.getValue(e,"scaleValue"),E=t.getValue(e,"mainVisible"),T=t.getValue(e,OID),A=new MaterialDesc;A.type=l,A.repeat=s,A.texture=r,A.color=d,A.opacity=h,A.transparent=c,A.visible=u,A.ambient=g,A.flipX=v,A.flipY=y,A.openTop=x,A.openBottom=I,A.specularStrength=b,A.polygonOffset=C,A.polygonOffsetFactor=w,A.polygonOffsetUnits=S,A.tType=r instanceof Array?6:1;var L=t.getValue(e,"rot"),N=GeometryTranslater.get3DOtherGeometry(e,a),k=GeometryTranslater.get3DGeometry(A,a,i,n,o,L,void 0,N);if(m&&k.setClient(TAG_ANIMATION,m),p&&k.setClient("animationGroup",p),f){var O;for(var D in f)O=f[D],k.setClient(O,t.getValue(e,O));k.setClient(CUSTOM_PROPS,f)}for(var D=0;6>D;D++){var R=t.getValue(e,"face"+D);R&&k.setClient("face"+D,R)}return P&&k.setClient("object3dId",P),_&&k.setClient("scaleValue",_),Utils.isNotNull(E)&&k.setClient("mainVisible",E),T&&k.setClient(OID,T),k},GeometryTranslater.get3DGeometry=function(e,t,i,n,a,o,r,s,l,d){t||(t="mono.Cube"),0!=t.indexOf("mono.")&&(t="mono."+t);var c=null,h=null;switch(s&&(h=s.id),h&&d&&(c=d.getDataById(h)),t){case"mono.Cube":c||(c=h?new mono.Cube({id:h}):new mono.Cube),i&&(c.setWidth(i.x),c.setHeight(i.y),c.setDepth(i.z)),s.wrapMode&&c.setWrapMode(s.wrapMode);break;case"mono.Sphere":c||(c=h?new mono.Sphere({id:h}):new mono.Sphere),i&&i.x&&c.setRadius(i.x/2);break;case"mono.Cylinder":c||(c=h?new mono.Cylinder({id:h}):new mono.Cylinder);var u=null;s&&(u=s.radialSegments),u||(u=4),i.x&&c.setRadiusTop(i.x),i.z&&c.setRadiusBottom(i.z),i.y&&c.setHeight(i.y),u&&c.setSegmentsR(u);break;case"mono.Torus":c||(c=h?new mono.Torus({id:h}):new mono.Torus),s.radius&&c.setRadius(s.radius),s.tube&&c.setTube(s.tube),s.radialSegments&&c.setSegmentsR(s.radialSegments),s.tubularSegments&&c.setSegmentsT(s.tubularSegments),s.arc&&c.setArc(s.arc);break;case"mono.Billboard":c||(c=h?new mono.Billboard(h):new mono.Billboard);var g=mono.BillboardAlignment.bottomCenter;s&&s.alignment&&(g=s.alignment),a||i&&(a={x:i.x,y:i.y,z:1}),c.setStyle(M_ALIGNMENT,g);break;case"mono.Floor":r&&(c=new mono.Floor(r));break;case"mono.PathNode":c||(c=h?new mono.PathNode({id:h}):new mono.PathNode),s&&(s.radius&&c.setRadius(parseFloat(s.radius)),s.path&&c.setPath(Utils._createPath(s.path)),s.segments&&c.setSegments(parseInt(s.segments)),s.segmentsR&&c.setSegmentsR(parseInt(s.segmentsR)),s.startCap&&c.setStartCap(s.startCap),s.endCap&&c.setEndCap(s.endCap),s.startCapSize&&c.setStartCapSize(parseFloat(s.startCapSize)),s.endCapSize&&c.setEndCapSize(parseFloat(s.endCapSize)),s.segmentsCap&&c.setSegmentsCap(parseInt(s.segmentsCap)));break;case"mono.TextNode":c||(c=h?new mono.TextNode({id:h}):new mono.TextNode),s&&(s.text&&c.setText(s.text),s.height&&c.setHeight(s.height),s.weight&&c.setWeight(s.weight),s.style&&c.setStyle(s.style),s.curveSegments&&c.setCurveSegments(s.curveSegments),s.bevelEnabled&&c.setBevelEnabled(s.bevelEnabled),s.textSize&&c.setSize(s.textSize));break;case"mono.ComboNode":var m=[];if(s.combos&&s.combos.length>1)for(var p=0;p<s.combos.length;p++){var f=s.combos[p].id,v=modelManager.getModelNode(f);if(v){var y=ModelFactory.getModelFromModelNode(modelManager.getModelLib(),v);if(y instanceof modelimp.ModelImp)for(var b=y.get2DObjects(),C=0;C<b.length;C++){b[C].setHost(l?l:new twaver.Node);var w=b[C].translate3d();d&&d.remove(w),m.push(w)}}}c||(c=h?new mono.ComboNode({id:h}):new mono.ComboNode),m.length>0&&(c.setCombos(m),s.operators&&c.setOperators(s.operators)),s.centralized&&Utils.setComboCentralized(c),e.texture==Utils.Path+PropertyConsts.DEFAULT_IMAGE&&(e.texture=null);break;case"mono.LatheNode":c||(c=h?new mono.LatheNode({id:h}):new mono.LatheNode),s&&(s.path&&c.setPath(Utils._createPath(s.path)),s.segmentsH&&c.setSegmentsH(s.segmentsH),s.segmentsR&&c.setSegmentsR(s.segmentsR),s.arc&&c.setArc(s.arc),void 0!==s.startClosed&&c.setStartClosed(s.startClosed),void 0!==s.endClosed&&c.setEndClosed(s.endClosed));break;case"mono.Entity":if(c||(c=h?new mono.Entity({id:h}):new mono.Entity),s){if(s.vertices&&c.setVertices(s.vertices),s.faces){var S=[];c.setFaces(S)}s.uvs&&c.setUvs(s.uvs)}break;case"mono.PointLight":c||(c=h?new mono.PointLight({id:h}):new mono.PointLight);break;case"mono.SpotLight":c||(h?(c=new mono.SpotLight({id:h}),c._id=h):c=new mono.SpotLight)}return n&&c.setPosition(n.x,n.y,n.z),o&&c.setRotation(o.x,o.y,o.z),a&&c.setScale(a.x,a.y,a.z),s&&Utils.isNotNull(s.mainVisible)&&c.setClient("mainVisible",s.mainVisible),e&&e.wrap3DStyle(c),c},GeometryTranslater.get2DGeometry=function(e,t,i){var i=getValue(this,"size"),n=getValue(this,"pos"),a=new PrimitiveNode,o=getValue(this,"ov",PropertyConsts.DEFAULT_IMAGE);i&&a.setClient("size",i);var r=getValue(this,"scale");r&&a.setClient("scale",r);var s=getValue(this,"dt");s&&a.setClient("texture",s);var l=getValue(this,"rot");l&&a.setClient("rot",l);var d=getValue(this,"scaleValue");d&&a.setClient("scaleValue",d),o&&(a.setImage(o),Utils.registerImage(Utils.Path+o)),a.setName(this.pid),n&&a.setClient("position",n),this.ishost&&(a.ishost=!0);var t=getValue(this,"className","mono.Cube");return a.setClient("className",t),a},GeometryTranslater.get3DCombination=function(e){var t,i,n,a,o=e.operations,r=e.primitives,s=1;if(r.length>=2&&o.length==r.length-1){t=r[0],n=new mono.CSG(t);for(var l=0;l<o.length;l++){i=r[s],a=new mono.CSG(i);var d=o[l];"+"==d?n=n.union(a):"-"==d&&(n=n.substract(a))}}},GeometryTranslater.copyPropertyForRoom2D=function(e,t,i){var n=t,a=e;if($cpc(a,n),a[WALL_INNER_PATH]&&n.setClient(WALL_INNER_PATH,a[WALL_INNER_PATH]),a[WALL_OUTER_PATH]&&n.setClient(WALL_OUTER_PATH,a[WALL_OUTER_PATH]),!1===i.getValue(a,WALL_CLOSED)&&n.setClient("shapenode.closed",!1),a[WALL_SIZE]){var o=a[WALL_SIZE];n.setClient(WALL_SIZE,{x:0,y:o[1],z:o[2]})}a[POLE_IMAGE_PATH]&&n.setClient(POLE_IMAGE_PATH,a[POLE_IMAGE_PATH]),!0===i.getValue(a,USE_TEXTURE)&&n.setClient(USE_TEXTURE,!0),a[OUTFRAME_IMAGE_PATH]&&n.setClient(OUTFRAME_IMAGE_PATH,a[OUTFRAME_IMAGE_PATH])},GeometryTranslater.copyCommonPropertyFor2D=function(e,t){var i=t;if(i.setClient(GID,e[GID]),e[OID]&&i.setClient(OID,e[OID]),e[BID]&&i.setClient(BID,e[BID]),e[PRIMITIVE_NAME]&&i.setClient(PRIMITIVE_NAME,e[PRIMITIVE_NAME]),e[FLOOR_NAME]&&i.setClient(FLOOR_NAME,e[FLOOR_NAME]),e[FLOOR_HEIGHT]&&i.setClient(FLOOR_HEIGHT,e[FLOOR_HEIGHT]),e[CUSTOM_PROPS]){var n=e[CUSTOM_PROPS];for(var a in n){var o=n[a];i.setClient(o,e[o])}i.setClient(CUSTOM_PROPS,n)}e[PropertyConsts.LAYERID]&&i.setClient(PropertyConsts.LAYERID,e[PropertyConsts.LAYERID]),e[TRA_PAR]&&i.setClient(TRA_PAR,e[TRA_PAR]),e[OPA]&&i.setClient(OPA,e[OPA])},GeometryTranslater.copyPropertyForStandObject2D=function(e,t,i){var n=t,a=e;if($cpc(e,t),a[SPACE_SCALE]){var o=a[SPACE_SCALE];n.setClient(DESIGN_SCALE,100*o[0])}var r=i.getValue(a,SPACE_POSITION);r&&n.setCenterLocation({x:r[0],y:r[2]});var s=i.getValue(a,SPACE_ROTATION);s&&n.setClient(SPACE_ROTATION,s);var l=i.getValue(a,SPACE_POS_Y);l&&n.setClient(SPACE_POS_Y,l);var d=i.getValue(a,"selectable");void 0!=d&&n.setClient("selectable",d);var c=i.getValue(a,ANGLE);c&&n.setAngle(c)},GeometryTranslater.get3DOtherGeometry=function(e,t){function i(t){e.wrapMode&&(t.wrapMode=e.wrapMode)}function n(t){e.path&&(t.path=e.path),e.segments&&(t.segments=e.segments);var i=e.getValue(e,"segmentsR");i&&(t.segmentsR=i),e.startCap&&(t.startCap=e.startCap),e.endCap&&(t.endCap=e.endCap),e.startCapSize&&(t.startCapSize=e.startCapSize),e.endCapSize&&(t.endCapSize=e.endCapSize),e.segmentsCap&&(t.segmentsCap=e.segmentsCap)}function a(t){e.text&&(t.text=e.text),e.textSize&&(t.textSize=e.textSize),e.height&&(t.height=e.height),e.weight&&(t.weight=e.weight),e.style&&(t.style=e.style),e.curveSegments&&(t.curveSegments=e.curveSegments),e.bevelEnabled&&(t.bevelEnabled=e.bevelEnabled)}function o(t){e.operators&&(t.operators=e.operators),e.combos&&(t.combos=e.combos),e.centralized&&(t.centralized=e.centralized)}function r(t){e[PATH]&&(t.path=e[PATH]),e[SEGMENTSH]&&(t.segmentsH=e[SEGMENTSH]),e[SEGMENTSR]&&(t.segmentsR=e[SEGMENTSR]),e[ARC]&&(t.arc=e[ARC]),void 0!==e[START_CLOSED]&&(t.startClosed=e[START_CLOSED]),void 0!==e[END_CLOSED]&&(t.endClosed=e[END_CLOSED])}function s(t){e[VERTICES]&&(t.vertices=e[VERTICES]),e[FACES]&&(t.faces=e[FACES]),e[UVS]&&(t.uvs=e[UVS])}var l={},d=e.getValue(e,"radialSegments");d&&(l.radialSegments=d),e.radius&&(l.radius=e.radius),e.tube&&(l.tube=e.tube),e.tubularSegments&&(l.tubularSegments=e.tubularSegments),e.arc&&(l.arc=e.arc);var c=e.getValue(e,"alignment");return c&&(l.alignment=c),"mono.Cube"===t?i(l):"mono.PathNode"===t?n(l):"mono.TextNode"===t?a(l):"mono.ComboNode"===t?o(l):"mono.LatheNode"===t?r(l):"mono.Entity"===t&&s(l),l},$gt3d=GeometryTranslater.get3DGeometry,$cpfr=GeometryTranslater.copyPropertyForRoom2D,$cpc=GeometryTranslater.copyCommonPropertyFor2D,$cpfs2=GeometryTranslater.copyPropertyForStandObject2D,$gt3dog=GeometryTranslater.get3DOtherGeometry,modellib.ModelNode=function(){},twaver.Util.ext("modellib.ModelNode",Object,{getID:function(){var e=this.pid;return e||(e=this.assembleid),e||(e=this.id),e},getType:function(){return this.type},getThumbnail:function(){return this.thumbnail?this.thumbnail:DEFAULT_THUMBNAIL},getOverview:function(){return this.ov?this.ov:this.getThumbnail()},getContents:function(){return this.children},getTips:function(){return this.tips?this.tips:this.id},getLabel:function(){return this.label=this.label?this.label:this.name,this.label=this.label?this.label:this.id,this.label},getTexture:function(){return this.dt?this.dt:DEFAULT_THUMBNAIL},getClassType:function(){return this.classType},getClassName:function(){return this.className}}),modellib.ModelNode.TYPE_ASSEMBLE="assemble",modellib.ModelNode.TYPE_PRIMITIVE="primitive",modellib.Assemble=function(e){this.id=e,this.children=[]
},twaver.Util.ext("modellib.Assemble",Object,{addChild:function(e){if(e instanceof modellib.Assemble){var t={id:e.id};e.pos&&(t.pos=e.pos),e.rot&&(t.rot=e.rot),this._children.push(t)}this.children.push(e)},setHost:function(e){var t=this.findByID(e);t&&(t.ishost=!0)},findByID:function(e){return o(this.children,e)}}),modellib.ModelLibEvent=function(){},modellib.ModelLibEvent.LIBCONTENT_ADDED="lib.contents.added",modellib.ModelLibEvent.LIBCONTENT_REMOVED="lib.contents.removed",modellib.ModelLibrary=function(){this._library={},this._primitives={},this._assembles={},this._categories={},this._subTitles={},this.targetCount=3,this._contentsChangedispatcher=new twaver.EventDispatcher},twaver.Util.ext("modellib.ModelLibrary",Object,{parsePrimitives:function(e,t,i,n){for(var a=e.length,o=0;a>o;o++){var r=new modellib.ModelNode(modellib.ModelNode.TYPE_PRIMITIVE),s=e[o];for(var l in s)r[l]=s[l];this.addPrimitive(r)}this.targetCount--,i&&i.call(n,t,"executed")},parseAssembles:function(e,t,i,n){for(var a=e.length,o=0;a>o;o++){var r=new modellib.ModelNode(modellib.ModelNode.TYPE_ASSEMBLE),s=e[o];for(var l in s)r[l]=s[l];this.addAssemble(r)}this.targetCount--,i&&i.call(n,t,"executed")},parseLib:function(e,t,i,n){this._categories=e.categories;for(var a=0;a<this._categories.length;a++){var o=this._categories[a];this._library[o.id]=o;for(var r=o.contents,s=0;s<r.length;s++){var l=r[s];this._subTitles[l.subtitle]=l}}this.targetCount--,i&&i.call(n,t,"executed")},isLoaded:function(){return 0==this.targetCount},getCategories:function(){var e=[];for(var t in this._library)e.push(this._library[t]);return e},getChildren:function(e){return this._library[e]},getModelNode:function(e){var t=this._assembles[e];return t||(t=this._primitives[e]),t},getModelNodeByTemplateName:function(e){var t=null;if(this._assembles)for(var i in this._assembles)this._assembles[i].templateName==e&&(t=this._assembles[i]);return t},addModelNode:function(e){modellib.ModelNode.TYPE_ASSEMBLE==e.getType()?this.addAssemble(e):this.addPrimitive(e)},addPrimitive:function(e){if(e&&e.id){var t=e.id;this._primitives[t]||(this._primitives[t]=e)}},addAssemble:function(e){if(e&&e.id){var t=e.id;this._assembles[t]||(this._assembles[t]=e)}},removeAccemble:function(e){if(this._accemble[e]){{this._accemble[e]}delete this._accemble[e]}},fireContentsChangedEvent:function(e){this._contentsChangedispatcher.fire(e)},addContentsChangedListener:function(e,t){this._contentsChangedispatcher.add(e,t)},getDefaultModelValue:function(e,t){var i=this.getModelNode(e);return i?i[t]:null},getValue:function(e,t){if(!e)return null;var i=e[t];return(void 0===i||null===i)&&(i=this.getDefaultModelValue(e.id,t)),(void 0===i||null===i)&&3==arguments.length&&(i=arguments[2]),i},getModelNodeContents:function(e){var t=null;if(e.getContents&&(t=e.getContents()),!t){var i=this.getModelNode(e.id);i||(i=this.getModelNode(e.pid)),i&&(t=i.getContents())}return t}}),modellib.ModelManager=function(){modellib.ModelManager.superClass.constructor.apply(this,arguments),this._modellib=new modellib.ModelLibrary,this.init(),this.initSerializationSettings(),localStorage.getItem(LIB_PRIMITIVES)||localStorage.setItem(LIB_PRIMITIVES,"{}"),localStorage.getItem(LIB_ASSEMBLES)||localStorage.setItem(LIB_ASSEMBLES,"{}"),localStorage.getItem(LIB_GRAPH)||localStorage.setItem(LIB_GRAPH,"{}"),localStorage.getItem(LIB_COMPONENTS)||localStorage.setItem(LIB_COMPONENTS,"{}"),this.roots=[],this.assembleCache=[],this.primitivesCache=[],this.nodesMap={},this.lastAssemble=null,this.buildings=[],this.equipments=[],this.targets=[],this.pipes=[],this.floors=[],this.roomAssembles=[],this.roomPrimitives=[],this.jsonVersion=1.1},twaver.Util.ext("modellib.ModelManager",Object,{lastAssemble:null,init:function(){this.loadResource=localStorage.getItem(LOAD_RESOURCE_TYPE)||TYPE_LOCAL,this._modellib.addContentsChangedListener(this.onLibContentsChanged,this)},initSerializationSettings:function(){mono.SerializationSettings.setClientType(MAIN_VISIBLE,"boolean"),mono.SerializationSettings.setClientType(OID,"string"),mono.SerializationSettings.setClientType(TAG_ANIMATION,"string")},getModelLib:function(){return this._modellib},parsePrimitives:function(e){this._modellib.parsePrimitives(e),this.loadSharedPrimitive()},parseAssembles:function(e){this._modellib.parseAssembles(e),this.loadSharedAssemble(e)},parseLib:function(e){this._modellib.parseLib(e)},wrapModelNodeIntoItem:function(e,t,i,n){var a=this.getModelNode(t);if(a||e!=TEMPLATES||(a=this._modellib.getModelNodeByTemplateName(i)),a){a.label=a.label||i,a.tips=a.tips||i,a.templateName=i;var o={className:this._modellib.getValue(a,"shape")||a.getClassName(),image:n?n:a.getThumbnail(),classType:a.getClassType(),actionType:this._modellib.getValue(a,"actionType"),tooltip:a.getTips(),label:a.getLabel(),dragImage:a.getOverview(),image3d:a.getTexture(),id:a.id,embeded:a.embeded,json:a.json,args:a.args,texture:a.texture,material:a.material,color:a.color,material_index:a.material_index,resize:a.resize,panel:a.panel,shape:a.shape,faces:a.faces,transparent:a.transparent,layer:a.layer,wrapMode:a.wrapMode},r=this._modellib.getValue(a,"type");r&&(o.type=r);var s=this._modellib.getValue(a,"radialSegments");return s&&(o.radialSegments=s),o}if(a=this.getSharedGraph(t)){var l=i,d=n?n:a.thumbnail;d=n?n:"crash.png";var o={className:"Graph",image:d,classType:"Graph",actionType:"loadTemplate",tooltip:l,label:l,dragImage:d,id:t};return o}return null},getModelNode:function(e){return this._modellib.getModelNode(e)},getCategory:function(e){return JSON.parse(localStorage.getItem(e))},getSharedComponent:function(e){var t=JSON.parse(localStorage.getItem(LIB_COMPONENTS));return t?t[e]:null},getSharedGraph:function(e){var t=JSON.parse(localStorage.getItem(LIB_GRAPH));return t?t[e]:null},getSharedAssemble:function(e){var t=this.getSharedAssembles();return t?t[e]:null},getSharedPrimitive:function(e){var t=this.getSharedPrimitives();return t?t[e]:null},getSharedComponent:function(e){var t=this.getSharedComponents();return t?t[e]:null},removeShareComponent:function(e){var t=this.getSharedComponents();if(t&&t[e]){delete t[e];var i=JSON.stringify(t);localStorage.setItem(LIB_COMPONENTS,i)}},removeShareCategory:function(e,t){var i=localStorage.getItem(LOAD_RESOURCE_TYPE);if(i===TYPE_CLOUD)this.deleteItemFromDB(t,null,this);else{if(e){var n=null,a=null;if(n=JSON.parse(localStorage.getItem(e)))for(var o=0;o<n.contents.length;o++)a=n.contents[o],a&&ModelUtils.containsID(a.children,t)&&ModelUtils.removeChild(a.children,t)}"Templates"===e&&this.removeShareItem(t),localStorage.setItem(e,JSON.stringify(n))}},deleteItemFromDB:function(e,t,i){var n={method:"remove",module:"templates",arguments:{id:e}};require(MONO_URL,n,t,i)},removeShareAssemble:function(e){var t=this.getSharedAssembles();if(t&&t[e]){delete t[e];var i=JSON.stringify(t);localStorage.setItem(LIB_ASSEMBLES,i)}},removeShareGraph:function(e){var t=this.getSharedGraphLibrary();if(t&&t[e]){delete t[e];var i=JSON.stringify(t);localStorage.setItem(LIB_GRAPH,i)}},removeShareItem:function(e){var t=this.getSharedAssembles();if(t&&t[e]){for(var i=t[e],n=i.children,a=this.getSharedPrimitives(),o=0;o<n.length;o++){var r=n[o].id;a[r]&&delete a[r]}var s=JSON.stringify(a);localStorage.setItem(LIB_PRIMITIVES,s),delete t[e];var l=JSON.stringify(t);localStorage.setItem(LIB_ASSEMBLES,l)}else{var d=this.getSharedGraphLibrary();if(d&&d[e]){delete d[e];var c=JSON.stringify(d);localStorage.setItem(LIB_GRAPH,c)}}},shareGraph:function(e,t,i,n,a){if(i){var o=null,r=null;if(e&&(o=this.getCategory(e),o||(o={id:e,contents:[]}),o)){for(var s=0;s<o.contents.length;s++)t==o.contents[s].subtitle&&(r=o.contents[s]);r||(r={subtitle:t,children:[]},o.contents.push(r))}var l=this.getSharedGraphLibrary();if(l){l[i.id]=i,r&&(ModelUtils.containsID(r.children,i.id)||r.children.push({id:i.id,name:a,thumbnail:n}));var d=JSON.stringify(l);localStorage.setItem(LIB_GRAPH,d),localStorage.setItem(e,JSON.stringify(o))}}},sharePrimitive:function(e,t,i,n){if(i){var a=null,o=null;if(e&&(a=JSON.parse(localStorage.getItem(e)),a||(a={id:e,contents:[]}),a)){for(var r=0;r<a.contents.length;r++)t==a.contents[r].subtitle&&(o=a.contents[r]);o||(o={subtitle:t,children:[]},a.contents.push(o))}var s=this.getSharedPrimitives();if(s){if(i instanceof Array)for(var r=0;r<i.length;r++)s[i[r].id]=i[r],o&&(ModelUtils.containsID(o.children,i[r].id)||o.children.push(i[r]));else s[i.id]=i,o&&(ModelUtils.containsID(o.children,i.id)||o.children.push(i));var l=JSON.stringify(s);localStorage.setItem(LIB_PRIMITIVES,l),n&&localStorage.setItem(e,JSON.stringify(a))}}},shareAssemble:function(e,t,i,n,a){if(i){var o=null,r=null;if(e&&(o=JSON.parse(localStorage.getItem(e)),o||(o={id:e,contents:[]}),o)){for(var s=0;s<o.contents.length;s++)t==o.contents[s].subtitle&&(r=o.contents[s]);r||(r={subtitle:t,children:[]},o.contents.push(r))}var l=this.getSharedAssembles();if(l){if(i instanceof Array)for(var s=0;s<i.length;s++)l[i[s].id]=i[s],r&&i[s].templateName===n&&(ModelUtils.containsID(r.children,i[s].id)||r.children.push({id:i[s].id,name:n,thumbnail:a}));else l[i.id]=i,r&&i.templateName===n&&(ModelUtils.containsID(r.children,i.id)||r.children.push({id:i.id,name:n,thumbnail:a}));var d=JSON.stringify(l);localStorage.setItem(LIB_ASSEMBLES,d),localStorage.setItem(e,JSON.stringify(o))}}},getSharedPrimitives:function(){return JSON.parse(localStorage.getItem(LIB_PRIMITIVES))},getSharedAssembles:function(){return JSON.parse(localStorage.getItem(LIB_ASSEMBLES))},getSharedGraphLibrary:function(){return JSON.parse(localStorage.getItem(LIB_GRAPH))},getSharedComponents:function(){return JSON.parse(localStorage.getItem(LIB_COMPONENTS))},loadResourceFile:function(e,t){var i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src","resources/"+e),t&&(i.onload=t.call(i,e,"loaded")),document.getElementsByTagName("head")[0].appendChild(i)},loadGraph:function(e,t,i,n,a){var o=new twaver.ElementBox,r=this.loadGraphto2d(o,t,a),s=this.show3D(o,e,r,i,n);return{box2d:o,box3d:s}},loadGraphto2d:function(e,t,i){var n=null,a=null;if(t){var o=t.scaleValue,r=this.parseSketch(t,!1,i);if(r instanceof Array){var s,l;e.forEach(function(e){Utils.isTargetFlag(e)?s=e:Utils.isOriginalFlag(e)&&(l=e)});for(var d=0;d<r.length;d++)if(r[d]instanceof twaver.Layer){var c=!1,h=Utils.getUnPredefinedFloorLayers(e);h.forEach(function(e){return e.getClient("floorRef")?void(c=!0):void 0}),e.getLayerBox().getDataById(r[d].getId())||Utils.getLayerByFloorName(e.getLayerBox(),r[d].getClient(FLOOR_NAME))||(c&&r[d].getClient("floorRef")&&r[d].setClient("floorRef",!1),e.getLayerBox().add(r[d]))}else r[d]instanceof TargetFlagNode?(Utils.isTargetFlag(r[d])?(s&&e.remove(s),s=r[d],n=r[d]):Utils.isOriginalFlag(r[d])&&(l&&e.remove(l),l=r[d],a=r[d]),e.add(r[d])):r[d]&&e.add(r[d])}this.scale=1/parseFloat(o),this.scale=this.scale||1;var u=this,g={};e.forEach(function(e){e instanceof PrimitiveNode&&(g[e.getId()]=e.getCenterLocation())}),e.forEach(function(e){if(e instanceof twaver.ShapeNode){if(e instanceof PipeShapeNode){var t=e.getStyle("vector.outline.width"),i=Math.abs(Math.log(u.scale));t=u.scale>1?t/Math.pow(1.5,i):t*Math.pow(1.5,i),e.setStyle("vector.outline.width",t)}var n=new twaver.List,a=e.getPoints();a.forEach(function(e){n.add({x:e.x/u.scale,y:e.y/u.scale})}),e.setPoints(n)}else if(e instanceof Window||e instanceof Door||e instanceof Cutoff){var o=e.getClient("length"),r=e.getStyle("vector.outline.width"),i=Math.abs(Math.log(u.scale));r=u.scale>1?r/Math.pow(1.5,i):r*Math.pow(1.5,i),e.setStyle("vector.outline.width",r),e.setClient("length",o/u.scale)}}),e.forEach(function(e){if(e instanceof PrimitiveNode){var t=parseFloat(1)/parseFloat(e.scaleValue||1),i=e.getHeight(),n=e.getWidth();e.setHeight(i/t),e.setWidth(n/t);var a=g[e.getId()]||e.getCenterLocation(),o={x:a.x/u.scale,y:a.y/u.scale};e.setCenterLocation(o)}})}return{targetPoint:n,originalPoint:a}},addPrimitiveInfoIntoModelLib:function(e,t){var i=new modellib.ModelNode(e);ModelUtils.copyProperties(i,t),i.type="primitive",i.shape="PrimitiveModel",this._modellib.addPrimitive(i)},addAssembleInfoIntoModelLib:function(e,t){var i=new modellib.ModelNode(e);ModelUtils.copyProperties(i,t),i.type="assemble",i.shape="AssembleModel",this._modellib.addAssemble(i)},loadSharedPrimitive:function(){var e;if(e=arguments.length>0?arguments[0]:this.getSharedPrimitives(),e instanceof Array)for(var t=0;t<e.length;t++)this.addPrimitiveInfoIntoModelLib(modellib.ModelNode.TYPE_PRIMITIVE,e[t]);else for(var i in e)this.addPrimitiveInfoIntoModelLib(modellib.ModelNode.TYPE_PRIMITIVE,e[i])},loadSharedAssemble:function(){if(assembles=arguments.length>0?arguments[0]:this.getSharedAssembles(),assembles instanceof Array)for(var e=0;e<assembles.length;e++)this.addAssembleInfoIntoModelLib(modellib.ModelNode.TYPE_ASSEMBLE,assembles[e]);else for(var t in assembles)this.addAssembleInfoIntoModelLib(modellib.ModelNode.TYPE_ASSEMBLE,assembles[t])},parseSketch:function(e,t,i){var n=e.assembles,a=e.primitives,o=e.sketch;a&&this.loadSharedPrimitive(a),n&&this.loadSharedAssemble(n);var r=this.parseCustomSketch(o,t,i);return this.wrapImageShapeNodeHost(r),r},wrapImageShapeNodeHost:function(e){var t={};if(e instanceof Array){for(var i=0;i<e.length;i++)e[i]&&e[i].getClient("primitiveName")&&e[i].setName(e[i].getClient("primitiveName")),e[i]&&e[i].getClient(OID)&&(t[e[i].getClient(OID)]=e[i].getId());for(var i=0;i<e.length;i++)if(e[i]&&e[i]instanceof ImageShapeNode){e[i].getClient(OID)&&e[i].setClient(OID,e[i].getId());var n=e[i].getClient("hostNodeId");n&&e[i].setClient("hostNodeId",t[n])}}},parseCustomSketch:function(e,t,i){var n=e.buildings,a=e.equipments,o=e.floors,r=e.pipes,s=e.layers,l=e.targets,d=[];if(s instanceof Array)for(var c=0;c<s.length;c++)d=d.concat(this.parseLayer(s[c],t));if(n instanceof Array)for(var c=0;c<n.length;c++){var h=n[c];d=d.concat(this.parseCustomBuilding(h,t))}if(a instanceof Array)for(var c=0;c<a.length;c++)d=d.concat(this.parseStandObject3D(a[c],t,i));if(o instanceof Array)for(var c=0;c<o.length;c++)d=d.concat(this.parseFloor(o[c],t));if(r instanceof Array)for(var c=0;c<r.length;c++)d=d.concat(this.parsePipes(r[c],t));if(l&&l instanceof Array)for(var c=0;c<l.length;c++)d=d.concat(this.parseTarget(l[c],t));return d},parseLayer:function(e,t){if(!t){var i=new twaver.Layer;return i.setClient(FLOOR_NAME,e[FLOOR_NAME]),i.setClient(FLOOR_HEIGHT,e[FLOOR_HEIGHT]),i.setClient(FLOOR_VISIBLE,e[FLOOR_VISIBLE]),i.setClient(FLOOR_REF,e[FLOOR_REF]),i.setClient(FLOOR_LAYER,e[FLOOR_LAYER]),[i]}},parseCustomBuilding:function(e,t){var i=[],n=this._modellib.getValue(e,IS_INNER_WALL)?new InnerWallShapeNode:new ImageShapeNode,a=e.children,o=this._modellib.getValue(e,OUTLINE_SHAPE);if(o.length%3==0){for(var r=[],s=0;s<o.length;s+=3)r.push({x:o[s],y:o[s+2]});n.setPoints(new twaver.List(r))}if($cpfr(e,n,this._modellib),a instanceof Array)for(var s=0;s<a.length;s++){var l=a[s];if(l.children)i=i.concat(this.parseCustomBuilding(l));else{var d=null,c=l.bType;d="window"===c?new Window:"door"===c?new Door:"cutoff"===c?new Cutoff:new Block;var h=l[IMAGE_SRC],u=l[SPACE_SIZE];l[SIZE_LENGTH]&&d.setClient(SIZE_LENGTH,l[SIZE_LENGTH]),l[TAG_ANIMATION]&&d.setClient(TAG_ANIMATION,l[TAG_ANIMATION]),l[SIZE_HEIGHT]&&d.setClient(SIZE_HEIGHT,l[SIZE_HEIGHT]),l[FLOOR_NAME]&&d.setClient(FLOOR_NAME,l[FLOOR_NAME]),l[FLOOR_HEIGHT]&&d.setClient(FLOOR_HEIGHT,l[FLOOR_HEIGHT]),l[SIZE_LENGTH]||l[SIZE_HEIGHT]||(u||(u=this._modellib.getValue(this.getModelNode(l.gid),SPACE_SIZE)),u&&(d.setClient(SIZE_LENGTH,u[0]),d.setClient(SIZE_HEIGHT,u[1])));var g=l[SPACE_POS_Y];if(g)"door"!=c&&d.setClient(SPACE_POS_Y,g);else{var m=l[SPACE_POSITION];m&&"door"!=c&&d.setClient(SPACE_POS_Y,m[1])}h&&d.setClient(IMAGE_SRC,h),d.setClient(BELONG_ID,l[BELONG_ID]),d.setClient(SHAPE_TYPE,"BlockModel"),d.setClient(GID,l.gid),d.setClient(BLOCK_OFFSET,l[BLOCK_OFFSET]),d.setClient(SPE_STR,l[SPE_STR]),d.setClient("transparent",l[TRA_PAR]),d.setClient("opacity",l[OPA]),this.parseCustomProps(d,l),n.addChild(d)}}if(t){var p=new mono.DataBox;return n.translate3d(p,n.getChildren().toArray()),i=i.concat(p.getNodes().toArray())}var f=[n];return f=f.concat(n.getChildren().toArray())},parseStandObject3D:function(e,t,i){var n=[],a=this._modellib.getModelNode(e.gid);if(a){var o=ModelFactory.getModelFromModelNode(this._modellib,a);if(t){n=n.concat(o.get3DObjects());var r=o.hostModel3DNode;if(r){var s=this._modellib.getValue(e,SPACE_POSITION),l=this._modellib.getValue(e,SPACE_POS_Y);s&&(l&&(s.y+=l),r.setPosition(s[0],s[1],s[2]));var d=this._modellib.getValue(e,"scale"),c=this._modellib.getValue(e,DESIGN_SCALE);d||(d=[1,1,1]),c instanceof Array&&(d=[d[0]*c[0],d[1]*c[1],d[2]*c[2]]),r.setScale(d[0],d[1],d[2]);var h=this._modellib.getValue(e,"rot");h&&r.setRotation(h[0],h[1],h[2]),r[GID]=e[GID],r[OID]=e[OID]}}else{n=n.concat(o.get2DObjects(!i));var r=o.mainNode;r||(r=n[0]),r&&($cpfs2(e,r,this._modellib),r.scaleValue=o.scaleValue)}}return n},parseFloor:function(e,t){var i=[],n=new FloorShapeNode;n[GID]=e[GID],n[OID]=e[OID];var a=this.getModelNode(e[GID]),o=this._modellib.getValue(e,OUTLINE_SHAPE);if(o||a&&(o=this._modellib.getValue(a,OUTLINE_SHAPE)),o&&o.length%3==0){for(var r=[],s=0;s<o.length;s+=3)r.push({x:o[s],y:o[s+2]});n.setPoints(new twaver.List(r))}var l=this._modellib.getValue(e,IMAGE_SRC);l||a&&(l=this._modellib.getValue(a,"dt")),l&&(refreshNetwork?Utils.registerImage(l,null,null,refreshNetwork):Utils.registerImage(l),n.setClient(IMAGE_SRC,l));var d=this._modellib.getValue(e,HOST_NODE_ID);d&&n.setClient(HOST_NODE_ID,d);var c=this._modellib.getValue(e,FLOOR_NAME);c&&n.setClient(FLOOR_NAME,c);var h=this._modellib.getValue(e,FLOOR_HEIGHT);h&&n.setClient(FLOOR_HEIGHT,h);var u=this._modellib.getValue(e,"repeat");u&&n.setClient("repeat",u);var g=this._modellib.getValue(e,"size");g&&n.setClient("size",g);var m=this._modellib.getValue(e,TRA_PAR);m&&n.setClient(TRA_PAR,m);var p=this._modellib.getValue(e,OPA);if(p&&n.setClient(OPA,p),this.parseCustomProps(n,e),t){var f=new mono.DataBox;return n.translate3d(f,n.getChildren().toArray()),i=i.concat(f.getNodes().toArray())}return[n]},parsePipes:function(e,t){var i=[],n=new PipeShapeNode;if(e.className&&"RoundPipeShapeNode"==e.className&&(n=new RoundPipeShapeNode),e[GID]&&(n.setClient(GID,e[GID]),n[GID]=e[GID]),e[OID]&&n.setClient(OID,e[OID]),e.repeat&&n.setClient("repeat",e.repeat),e.positionY&&n.setClient("positionY",e.positionY),e[OUTLINE_SHAPE])var a=e[OUTLINE_SHAPE];var a=e[OUTLINE_SHAPE];if(a&&a.length%3==0){for(var o=[],r=0;r<a.length;r+=3)o.push({x:a[r],y:a[r+2]});n.setPoints(new twaver.List(o))}if(e[FLOOR_NAME]&&n.setClient(FLOOR_NAME,e[FLOOR_NAME]),e.startCap&&n.setClient("startCap",e.startCap),e.endCap&&n.setClient("endCap",e.endCap),e.startCapSize&&n.setClient("startCapSize",e.startCapSize),e.endCapSize&&n.setClient("endCapSize",e.endCapSize),e.radius&&n.setClient("radius",e.radius),e.segments&&n.setClient("segments",e.segments),e[IMAGE_SRC]&&n.setClient(IMAGE_SRC,e[IMAGE_SRC]),e.pointPositions&&n.setClient("pointPositions",e.pointPositions),this.parseCustomProps(n,e),t){var s=new mono.DataBox;return n.translate3d(s,n.getChildren().toArray()),i=i.concat(s.getNodes().toArray())}return[n]},parseTarget:function(e){var t=new TargetFlagNode(e.type);return t.setCenterLocation(e.x,e.z),t.setClient(SPACE_POS_Y,e.y),t.setShowPoint(e.visible),[t]},parseCustomProps:function(e,t){var i=this._modellib.getValue(t,CUSTOM_PROPS);if(i){for(var n in i)e.setClient(i[n],this._modellib.getValue(t,i[n]));e.setClient(CUSTOM_PROPS,i)}var a=this._modellib.getValue(t,PropertyConsts.LAYERID);a&&e.setClient(PropertyConsts.LAYERID,a)},loadTemplate:function(e,t){var i=this;if("object"==typeof t){var n=t,a={module:"templates",method:"getData",arguments:{id:n.id}},o=function(){var t=JSON.parse(arguments[0]);if(t.error)return void alert(t.error);var n=JSON.parse(t.value);i.loadDataCheck(cloudKey,this.loadGraphto2d,[e,n]),refreshNetwork()};require(MONO_URL,a,o,this)}else{var r=this.getSharedGraph(t);this.loadGraphto2d(e,r),refreshNetwork()}},loadDataCheck:function(e,t,i){var n=i[1],a=this;if(n){for(var o=[],r=n.sketch.equipments,s=0;s<r.length;s++){var l=this._modellib.getModelNode(r[s].gid);l||o.indexOf(r[s].gid)<0&&o.push(r[s].gid)}if(o.length>0){var d={module:"templates",method:"getDatas",arguments:{gids:o.join(",")}},c=function(){var e=JSON.parse(arguments[0]);if(e.error)return void alert(e.error);var n=e.value;if(n&&n.length>0)for(s in n){var o=JSON.parse(n[s].data);o.primitives||o.assembles?(a.loadSharedPrimitive(o.primitives),a.loadSharedAssemble(o.assembles)):(a.loadSharedPrimitive(o.primitivesCache),a.loadSharedAssemble(o.assembleCache))}t.apply(a,i)};require(MONO_URL,d,c,this)}else t.apply(a,i)}},loadDataFromRoom:function(e,t){var i,n,a=new twaver.ElementBox,o=this.parseSketch(e);if(o instanceof Array)for(var r=0;r<o.length;r++)o[r]instanceof twaver.Layer?a.getLayerBox().add(o[r]):o[r]instanceof TargetFlagNode?(Utils.isTargetFlag(o[r])?i=o[r]:Utils.isOriginalFlag(o[r])&&(n=o[r]),a.add(o[r])):a.add(o[r]);this.show3D(a,t,{targetPoint:i,originalPoint:n})},loadDatafromComponent:function(e,t,i){this.loadSharedPrimitive(t.primitives),this.loadSharedAssemble(t.assembles);var n={x:120,y:100},a=this._modellib.getModelNode(i);if(a){var o=ModelFactory.getModelFromModelNode(this._modellib,a);if(o instanceof modelimp.ModelImp){var r,s=(e.getDataBox(),new twaver.ElementBox),l=o.get2DObjects();l[0]&&(o.mainNode?(o.mainNode.setCenterLocation(n),o.mainNode instanceof PrimitiveNode&&o.mainNode.setName(o.id),r=o.mainNode):(l[0].setCenterLocation(n),l[0]instanceof PrimitiveNode&&l[0].setName(o.id),r=l[0]),r&&(r.getX()<0&&r.setX(0),r.getY()<0&&r.setY(0)));for(var d=0;d<l.length;d++)s.add(l[d]);this.show3D(s,e)}}},show3D:function(e,t,i,n,a){t||(t=new mono.Network3D);var o=t.getDataBox();if(a||(o.clear(),o.getAlarmBox().clear()),i)var r=i.targetPoint,s=i.originalPoint;o.addDataBoxChangeListener(function(e){if(e.data&&e.data.getPosition()){var t=e.data.getPosition();if(s&&s.isShowPoint()){var i=s.getCenterLocation();t.x=t.x-i.x,t.y=t.y-s.getClient(SPACE_POS_Y),t.z=t.y-i.y}}},this);var l={},d=0;o.startBatch(),e.forEach(function(e){var i=e;if(i instanceof twaver.ShapeNode){var n=i.getPoints(),a=n.size();if(a>0&&i instanceof ImageShapeNode){i.setClient("shapeNodeIndex",d++);var r=i.getChildren(),s=[];r&&r.forEach(function(e){e instanceof Block&&s.push(e)}),i.translate3d(o,s,t)}}else i instanceof PrimitiveNode&&(l[i.getId()]=i.translate3d(o,t))}),e.forEach(function(e){var t=e;if(t.getHost){var i=t.getHost();i&&l[t.getId()].setParent(l[i.getId()])}});var c=[];for(var h in l)l[h].getParent()||c.push(l[h]);o.getRoots().forEachReverse(function(e){e instanceof mono.ComboNode&&e.getClient("entity")&&o.remove(e)});for(var u=0;u<c.length;u++){var g=c[u];if(!o.getDataById(g.getId())){var m=g.getDescendants();if(g.getClient("isEntity")){m.push(g);var p=new mono.ComboNode(m,null,null,"entity"+g.getId());p.setClient("floorName",g.getClient("floorName")),p.setClient(BID,g.getClient(BID)),p.setClient("entity",!0),o.add(p)}else o.addByDescendant(g)}}if(o.endBatch(),l=null,r&&r.isShowPoint()){var f=r.getCenterLocation(),v=new mono.Vec3(f.x,100,f.y);t.getCamera().look(v);for(var y=t.getInteractions(),h=0;h<y.length;h++)y[h]instanceof mono.DefaultInteraction&&(y[h].target=v)}return o},loadGraphUrl:function(e,t,i,n,a,o){var r=this;this.loadFile(t,function(t){var s=JSON.parse(t);if(s){var l=r.loadGraph(e,s,i,n);o&&o.call(a,l.box2d,l.box3d)}})},loadGraphDatas:function(e){var t=this,i=new mono.Network3D;return this.loadFile(e,function(e){var n=JSON.parse(e);n&&t.loadGraph(i,n)}),i.getDataBox().getDatas()},loadFile:function(e,t){if(e){var i=new XMLHttpRequest;void 0!==t&&i.addEventListener("load",function(e){t(e.target.responseText)},!1),i.open("GET",e,!0),i.send(null)}},loadComponentDatas:function(e,t){var i={};if(this.loadResource===TYPE_CLOUD){var n={module:"templates",method:"getData",arguments:{id:e}};require(MONO_URL,n,t,this)}else{var a=modelManager.getSharedComponent(e);a&&(i=a.data)}return i},loadCloudTemplateById:function(e,t,i,n,a){var o=this,r={module:"templates",method:"getData",arguments:{id:t}};loadCloud=function(){var t=JSON.parse(arguments[0]);if(t.error)return void alert(t.error);if(!t.value)return void alert("No Template with Id "+id);var r,s=JSON.parse(t.value);if(s.primitives&&s.primitives.length>0&&s.assembles&&s.assembles.length>0||s.primitivesCache&&s.assembleCache){var l=e?e.getDataBox():null;r=o.loadComponentTemplateFromContents(l,t.value,i,!1)}else o.loadDataCheck(null,o.loadGraph,[e,s,!0]);a&&a.call(n,r)},require(MONO_URL,r,loadCloud,this)},loadTemplateFromCloud:function(e,t,i,n){var a={module:"templates",method:"search",arguments:{name:t}},o=this,r=function(){if(1===arguments.length){var s=JSON.parse(arguments[0]);if(s.error)return void alert(s.error);if(!s.value||s.value.length<=0)return void alert(t+" dese not exist");var l=s.value[0];a={module:"templates",method:"getData",arguments:{id:l.id}},r=function(){var a=JSON.parse(arguments[0]);if(a.error)return void alert(a.error);if(!a.value)return void alert("No Template with name "+t);var r=JSON.parse(a.value);"Component"===l.type?o.loadDatafromComponent(e,r,t):o.loadDataCheck(i,o.loadGraph,[e,r,n])},require(MONO_URL,a,r,this)}};require(MONO_URL,a,r,this)},exportRoomToTemplate:function(e,t,i,n,a,o,r,s,l){var d=n;if(!d)return alert("Template name is required"),!1;if(this.loadResource===TYPE_CLOUD&&!a)return alert("Template category is required"),!1;d||(d="Your Graph");var c=this.serializeGraphInfo(e);if(c.id=Utils.generateAssembleId(),this.loadResource===TYPE_CLOUD){var h=JSON.stringify(c);if(l)u={module:"templates",method:"update",arguments:{id:o,name:n,data:h,category:a,gid:c.id,icon:t,author:r,tags:s,preview:i}};else var u={module:"templates",method:"add",arguments:{name:n,data:h,category:a,scope:0,gid:c.id,icon:t,preview:i,author:r,tag:s}};var g=function(){if(1===arguments.length){var e=JSON.parse(arguments[0]);if(e.error)return void alert(e.error);alert("Models have been export to the cloud library.")}};require(MONO_URL,u,g,this)}else this.shareGraph(TEMPLATES,SUBTITLE_ROOM,c,t,d),alert("Models have been export to the local library.");return c},serializeDatasInfo:function(e,t){for(var i=e.size(),n=0;i>n;n++)this.dfs2DNodes(e.get(n));for(var a={buildings:this.buildings,equipments:this.equipments,pipes:this.pipes,floors:this.floors},o={primitives:[],assembles:[],sketch:a},n=0;i>n;n++)delete e.get(n).visited;return t&&(o.scaleValue=t),this.buildings=[],this.equipments=[],this.floors=[],this.pipes=[],JSON.stringify(o)},serializeGraphInfo:function(e,t){for(var i=e.getDatas(),n=i.size(),a=0;n>a;a++)this.dfs2DNodes(i.get(a));var o=[],r=Utils.getUnPredefinedFloorLayers(e);if(r&&r.size()>0){var s=this;r.forEach(function(e){o.push(s.dfs2DLayers(e))})}var l={buildings:this.buildings,equipments:this.equipments,targets:this.targets,pipes:this.pipes,floors:this.floors,layers:o},d={primitives:[],assembles:[],sketch:l};t&&(this.handlePrimitivesInfo(),this.handleAssemblesInfo(),d={primitives:this.roomPrimitives,assembles:this.roomAssembles,sketch:l});var c=e.getClient("scaleValue");c&&(d.scaleValue=c);for(var a=0;n>a;a++)delete i.get(a).visited;return this.buildings=[],this.equipments=[],this.targets=[],this.floors=[],this.pipes=[],this.layerInfo=[],this.roomPrimitives=[],this.roomAssembles=[],d},handleAssemblesInfo:function(){for(var e,t,i=this.roomAssembles,n=0;n<i.length;n++){e=i[n],t=e.getContents();for(var a=0;a<t.length;a++){var o=t[a],r=this.getModelNode(o.id);for(var s in o)"id"!=s&&o[s]==r[s]&&(o[s]=void 0);o.type=void 0,o.shape=void 0}e.type=void 0,e.shape=void 0}},handlePrimitivesInfo:function(){for(var e,t=this.roomPrimitives,i=0;i<t.length;i++)e=t[i],e.type=void 0,e.shape=void 0},searchTemplatesFromDB:function(e,t,i,n,a){var o={module:"templates",method:"search",arguments:{scope:t,category:a}};require(MONO_URL,o,i,n)},getPreviewById:function(e,t,i){var n=(localStorage.getItem(CLOUD_KEY),{module:"templates",method:"getPreview",arguments:{id:e}});require(MONO_URL,n,t,i,!0)},dfs2DNodes:function(e){if(!e.visited){e.visited=!0;var t,i=e.getParent();if(i)i instanceof ImageShapeNode&&(t=this.getBlockInfo(e));else if(t=this.getBasicInfo(e),e instanceof PipeShapeNode)this.wrapPipeInfo(t,e),this.pipes.push(t);else if(e instanceof FloorShapeNode)this.wrapFloorInfo(t,e),this.floors.push(t);else if(e instanceof ImageShapeNode){var n=e.getChildren().size();if(this.wrapRoomInfo(t,e),this.buildings.push(t),n>0)for(var a=e.getChildren(),o=0;n>o;o++){var r=a.get(o);t.children.push(this.dfs2DNodes(r))}}else e instanceof TargetFlagNode?(t=this.pointsFlagInfo(t,e),this.targets.push(t)):this.equipments.push(t);return e.visited=!1,t}},dfs2DLayers:function(e){var t={};return t[FLOOR_NAME]=e.getClient(FLOOR_NAME),t[FLOOR_HEIGHT]=e.getClient(FLOOR_HEIGHT),t[FLOOR_VISIBLE]=e.getClient(FLOOR_VISIBLE),t[FLOOR_REF]=e.getClient(FLOOR_REF),t[FLOOR_LAYER]=e.getClient(FLOOR_LAYER),t},getBasicInfo:function(e){var t=e.getClient(GID);t&&!r(this.roomAssembles,t)&&this.buildingAssembles(t);var i=e.getClient(OID),n=ModelUtils.covertTo3DPosition(e),a={id:e.getId(),oid:i};a[GID]=t,a[SPACE_POSITION]=[n.x,n.y,n.z],a[SPACE_POS_Y]=e.getClient(SPACE_POS_Y),a[SPACE_ROTATION]=e.getClient(SPACE_ROTATION),a[PRIMITIVE_NAME]=e.getClient(PRIMITIVE_NAME),a[FLOOR_NAME]=e.getClient(FLOOR_NAME),a[FLOOR_HEIGHT]=e.getClient(FLOOR_HEIGHT),a[BID]=e.getClient(BID),a[ANGLE]=e.getAngle();var o=e.getClient(DESIGN_SCALE);o&&(o/=100,a[SPACE_SCALE]=[o,o,o]);var s=e.getClient("animation");s&&""!=s&&(a.animation=s);var l=e.getClient(CUSTOM_PROPS);if(l){for(var d in l){var c=l[d];a[c]=e.getClient(c)}a.customProps=l}var h=e.getClient(PropertyConsts.LAYERID);return h&&(a.layerId=h),a},pointsFlagInfo:function(e,t){e={};var i=t.getLocation();return e.x=i.x,e.y=t.getClient(SPACE_POS_Y),e.z=i.y,e.visible=t.isShowPoint(),e.type=t.getType(),e},wrapPipeInfo:function(e,t){e.dshape=this.getDShapeOfImageShapedNode(t),t instanceof RoundPipeShapeNode&&(e.className="RoundPipeShapeNode"),e.repeat=t.getClient("repeat"),e[IMAGE_SRC]=t.getClient(IMAGE_SRC),e.pointPositions=t.getClient("pointPositions"),e.startCap=t.getClient("startCap"),e.endCap=t.getClient("endCap"),e.startCapSize=t.getClient("startCapSize"),e.endCapSize=t.getClient("endCapSize"),e.radius=t.getClient("radius"),e.segments=t.getClient("segments"),e.positionY=t.getClient("positionY")},wrapFloorInfo:function(e,t){e.dshape=this.getDShapeOfImageShapedNode(t),e[IMAGE_SRC]=t.getClient(IMAGE_SRC),e.repeat=t.getClient("repeat"),e.size=t.getClient("size");var i=t.getClient("hostNodeId");i&&""!=i&&(e.hostNodeId=i),e[TRA_PAR]=t.getClient(TRA_PAR),e[OPA]=t.getClient(OPA)},wrapRoomInfo:function(e,t){var i=modelManager.getModelNode(e[GID]);e.dshape=this.getDShapeOfImageShapedNode(t),e.children=[];var n=t.getClient(USE_TEXTURE);e[USE_TEXTURE]=!0===n?!0:!1;var a=t.getClient(WALL_SIZE),o=!0;if(a){var r=this._modellib.getValue(i,WALL_SIZE);r&&a.x==r.x&&a.y==r.y&&a.z==r.z&&(o=!1)}o&&(e[WALL_SIZE]=[a.x,a.y,a.z],o=!1);var s=t.getClient(WALL_CLOSED);!1===s&&(e[WALL_CLOSED]=!1),e[POLE_IMAGE_PATH]=t.getClient(POLE_IMAGE_PATH),e[OUTFRAME_IMAGE_PATH]=t.getClient(OUTFRAME_IMAGE_PATH),e[WALL_INNER_PATH]=t.getClient(WALL_INNER_PATH),e[WALL_OUTER_PATH]=t.getClient(WALL_OUTER_PATH),e[IS_INNER_WALL]=t instanceof InnerWallShapeNode;var l=t.getClient(OID);l&&""!=l&&(e[OID]=l);t.getClient(TRA_PAR),t.getClient(OPA);e[TRA_PAR]=t.getClient(TRA_PAR),e[OPA]=t.getClient(OPA)},getDShapeOfImageShapedNode:function(e){for(var t=e.getPoints(),i=[],n=t.size(),a=0;n>a;a++){var o=t.get(a);i=i.concat([o.x,0,o.y])}return i},buildingAssembles:function(e){var t=this.getModelNode(e);if(t)if(t.children&&t.children.length>0){this.roomAssembles.push(t);for(var i=0;i<t.children.length;i++){var n=t.children[i].id;this.buildingAssembles(n)}}else if(!r(this.roomPrimitives,t.id)&&(this.roomPrimitives.push(t),"mono.ComboNode"===t.className&&t.combos))for(var a=t.combos,i=0;i<a.length;i++)this.buildingAssembles(a[i].id)},getBlockInfo:function(e){info=this.getBasicInfo(e),e instanceof Window?info[BTYPE]="window":e instanceof Door?info[BTYPE]="door":e instanceof Cutoff&&(info[BTYPE]="cutoff");
this.getModelNode(info[GID]);info[BELONG_ID]=e.getClient(BELONG_ID),info[IMAGE_SRC]=e.getClient(IMAGE_SRC);var t=e.getClient(SPACE_SIZE);return info[SPACE_POSITION][1]=e.getClient(SPACE_POS_Y),info[SPACE_SIZE]=t?[t.x,t.y,t.z]:[e.getClient(SIZE_LENGTH),e.getClient(SIZE_HEIGHT),e.getClient(SIZE_DEPTH)],info[BLOCK_OFFSET]=e.getClient(BLOCK_OFFSET),info[SPE_STR]=e.getClient(SPE_STR),info[TRA_PAR]=e.getClient(TRA_PAR),info[OPA]=e.getClient(OPA),console.log(info),info},organizeComponentsDrawing:function(e){var t=(this.serializeComponentsInfo(e),{primitives:this.primitivesCache,assembles:this.assembleCache});return console.log(t),this.disposeComponents(e.getNodes().toArray(),e.getBillboards().toArray()),t},exportComponentToTemplate:function(e,t,i,n,a,o,r,s,l,d,c){var h=n;return h?this.loadResource!==TYPE_CLOUD||a?void this.organizeAssembles(e,h,null,t,i,a,o,r,s,l,d,c):(alert("Template category is required"),!1):(alert("Template name is required"),!1)},serializeComponentsInfo:function(e,t,i,n){for(var a=e.getNodes().toArray(),o=e.getBillboards().toArray(),r=0;r<a.length;r++){var s=a[r];s.getClient(PropertyConsts.COMPONENTFLOOR||s instanceof mono.Floor)||this.serialize3DDate(s,a,o,e)}for(var l=this.assembleCache,d=0;d<l.length;d++){var c=l[d].boundingBox;if(c){l[d].assembleSize=c.size();var h=ModelUtils.getCenterOfBoundingBox(c);h={x:h.x,y:h.y,z:h.z},l[d].off=h}0!=d&&delete l[d].boundingBox}for(var r=0;r<o.length;r++)if(!o[r].visited){var u={};this.getInfoOfBillboard(u,o[r]),this.primitivesCache.push(u),this.roots.push(o[r]),this.nodesMap[o[r].getId()]=o[r]}var g=null;if(this.roots.length>1||1==this.roots.length&&0==this.assembleCache.length){var m=Utils.generateAssembleId(i);g=new modellib.Assemble(m);for(var r=0;r<this.roots.length;r++){var s=this.roots[r],p=null;p=s.assembleID?{id:s.assembleID}:{id:this.roots[r].getId()},s.oid&&(p.oid=s.oid),this.wrapAnimation(p,s),this.wrapCustomProps(p,s),g&&g.addChild(p)}var f=mono.Utils.getBoundingBox(this.roots,!0);g.assembleSize=f.size();var h=ModelUtils.getCenterOfBoundingBox(f);h={x:h.x,y:h.y,z:h.z},g.off=h,g.ishost=!0,t&&(g.templateName=t),this.assembleCache.push(g)}else{var v=ModelUtils.indexInArray(this.assembleCache,this.roots[0].assembleID);g=this.assembleCache[v];var m=Utils.generateAssembleId(i);this.roots[0].assembleID=m,t&&(g.templateName=t),g.id=m,g.ishost=!0}if(g&&g.children.length>0){g.scaleValue=comScaleValue,g.isEntity=n;for(var y=g.off,b=!1,r=0;r<g.children.length;r++){var p=g.children[r];p.ishost&&(b=!0)}for(var r=0;r<g.children.length;r++){var p=g.children[r];b?p.ishost&&this.setChildPosition(p,y):this.setChildPosition(p,y)}}return this.assembleCache.length>0&&delete this.assembleCache[0].boundingBox,g},setChildPosition:function(e,t){var i=e.id;i.startsWith("assemble")&&(i=i.substring("assemble".length,i.length));var n=this.nodesMap[i].getPosition();e.pos={x:n.x-t.x,y:n.y-t.y,z:n.z-t.z}},organizeAssembles:function(e,t,i,n,a,o,r,s,l,d,c,h){console.log(a);var u=this.serializeComponentsInfo(e,t,null,d);if(this.loadResource===TYPE_CLOUD){for(var g,m=0;m<this.assembleCache.length;m++)this.assembleCache[m].ishost&&(c&&h&&(this.assembleCache[m].id=h),g=this.assembleCache[m].id,d&&(this.assembleCache[m].isEntity=!0));var p={primitives:this.primitivesCache,assembles:this.assembleCache},f=JSON.stringify(p);console.log(f);var v;v=c?{module:"templates",method:"update",arguments:{id:r,name:t,data:f,category:o,method:"Component",gid:g,icon:n,author:s,tags:l,preview:a}}:{module:"templates",method:"add",arguments:{name:t,data:f,category:o,method:"Component",scope:0,gid:g,icon:n,author:s,tags:l,preview:a}};var y=function(){if(1===arguments.length){var e=JSON.parse(arguments[0]);if(e.error)return void alert(e.error);alert("Models have been export to the cloud library.")}};require(MONO_URL,v,y,this)}else{for(var m=0;m<this.primitivesCache.length;m++)this.sharePrimitive("Private Templates","Component",this.primitivesCache[m],!1);u&&(this.shareAssemble("Private Templates","Component",u,t,n),delete u.off);for(var b=this.assembleCache,C=0;m<b.length;C++)b[C].ishost&&d&&(b[C].isEntity=!0),modelManager.shareAssemble("Private Templates","Component",b[C],t,n);alert("Models have been export to the local library.")}console.log("primitives ext lib:\n"+localStorage.getItem(LIB_PRIMITIVES)),console.log(localStorage.getItem(LIB_PRIMITIVES).length),console.log("assemble ext lib:\n"+localStorage.getItem(LIB_ASSEMBLES)),this.disposeComponents(e.getNodes().toArray(),e.getBillboards().toArray())},loadComponentTemplateFromContents:function(e,t,i,n){var a,o=JSON.parse(t);if(o.primitives&&o.assembles||o.primitivesCache&&o.assembleCache){this.loadSharedPrimitive(o.primitives||o.primitivesCache),this.loadSharedAssemble(o.assembles||o.assembleCache);var r=this.getTemplateGID(o.assembles||o.assembleCache);r&&(a=this.create3DElementsFromModelNode(e,r,n)),i&&a&&a.setParent(i)}return a},getTemplateGID:function(e){var t;if(e)for(var i=0;i<e.length;i++)if(e[i].ishost||e[i].templateName){t=e[i].id;break}return t},loadComponentTemplateFromURL:function(e,t,i,n,a){var o=this;this.loadFile(t,function(t){if(t){var r=o.loadComponentTemplateFromContents(e,t,i,!1);a&&a.call(n,r)}})},loadComponentTemplate:function(e,t,i,n,a){if(this.loadResource!==TYPE_CLOUD)return this.create3DElementsFromModelNode(e,t,i);var o={module:"templates",method:"get",arguments:{id:t}},r=function(){var t=JSON.parse(arguments[0]);if(t.error)return void alert(t.error);var o=t.value;if(o){var r=JSON.parse(o.data);r.primitives||r.assembles?(this.loadSharedPrimitive(r.primitives),this.loadSharedAssemble(r.assembles)):(this.loadSharedPrimitive(r.primitivesCache),this.loadSharedAssemble(r.assembleCache));var s=this.create3DElementsFromModelNode(e,o.gid,i,o.version);a&&a.call(n,s)}};require(MONO_URL,o,r,this)},create3DElementsFromModelNode:function(e,t,i){var n,a=!i,o=this.getModelNode(t);if(o||(o=this._modellib.getModelNodeByTemplateName(t)),o){var r=ModelFactory.getModelFromModelNode(this._modellib,o);if(r instanceof modelimp.ModelImp){var s=r.get3DObjects(a),l=parseFloat(r.scaleValue)/parseFloat(e.scaleValue||1);if(e)for(var d=0;d<s.length;d++)Utils.scale3DElement(s[d],l),e.add(s[d]);2!=s.length||i||s[0]instanceof mono.Cube&&(s[0].setSelectable(r.mainNode.isSelectable()),s[0].setEditable(r.mainNode.isEditable()),e.remove(r.mainNode,!0),r.mainNode=s[0]),r.mainNode?n=r.mainNode:r.rootNodes&&1==r.rootNodes.length&&(n=r.rootNodes[0])}}return n},getHostNodeAssembleSize:function(e){var t,i=this.getModelNode(e);if(i||(i=this._modellib.getModelNodeByTemplateName(e)),i){var n=ModelFactory.getModelFromModelNode(this._modellib,i);n&&(t=n.assembleSize),n instanceof modelimp.ModelImp&&n.mainNode&&n.mainNode.getClient("assembleSize")&&(t=n.mainNode.getClient("assembleSize"))}return t},loadTemplatesAssembleSize:function(e,t,i){if(this.loadResource!==TYPE_CLOUD)return this.getHostNodeAssembleSize(e);var n={module:"templates",method:"get",arguments:{id:e}},a=function(){var e=JSON.parse(arguments[0]);if(e.error)return void alert(e.error);var n=e.value;if(n){var a=JSON.parse(n.data);this.loadSharedPrimitive(a.primitives),this.loadSharedAssemble(a.assembles);var o=this.getHostNodeAssembleSize(n.gid);i&&i.call(t,o)}};require(MONO_URL,n,a,this)},disposeComponents:function(e,t){this.nodesMap={},this.assembleCache=[],this.primitives=[],this.primitivesCache=[],this.roots=[];for(var i=0;i<e.length;i++)delete e[i].visited,delete e[i].assembleID;for(var i=0;i<t.length;i++)delete t[i].visited},serialize3DDate:function(e,t,i,n){if(!e.visited){if(e.visited=!0,!ModelUtils.containsInArray(t,e.getId(),"_id")&&!ModelUtils.containsInArray(i,e.getId(),"_id"))return;e.getParent()||this.roots.push(e);var a=this.pushPrimitive(e,n);if(this.nodesMap[e.getId()]=e,e.getChildren().size()>0){var o,r=e.getChildren(),s=this.createAssembleID(e.getId()),l=ModelUtils.indexInArray(this.assembleCache,s);o=l>=0?this.assembleCache[l]:new modellib.Assemble(s);var d={id:a.id,oid:e.getClient(OID)};this.wrapAnimation(d,e),this.wrapCustomProps(d,e),o.addChild(d),e.assembleID=o.id;var c=mono.Utils.getBoundingBox([e],!0);o.boundingBox=c,o.setHost(e.getId()),ModelUtils.containsInArray(this.assembleCache,o.id)||this.assembleCache.push(o);for(var h=0;h<r._as.length;h++){var u=r._as[h];if(this.serialize3DDate(u,t,i,n),u.getChildren()._as.length<=0){var d={id:u.getId(),pos:u.getPosition(),oid:u.getClient(OID)};this.wrapAnimation(d,u),this.wrapCustomProps(d,u),o.addChild(d)}else{var g=this.createAssembleID(u.getId()),d={id:g,pos:u.getPosition(),oid:u.getClient(OID)};this.wrapAnimation(d,u),this.wrapCustomProps(d,u),o.addChild(d)}}}}},pushPrimitive:function(e){var t=this.getModelInfo(e);return this.primitivesCache.push(t),t},getCommonInfo:function(e){var t={};return t.id=e.getId(),e.getScale()&&(t.scale=e.getScale()),e.getPosition()&&(t.pos=e.getPosition()),e.getRotation()&&(t.rot=e.getRotation()),e.getGroupId()&&(t.groupid=e.getGroupId()),t},getStyleInfo:function(e,t){t.styleMap[M_AMBIENT]&&(e.ambient=t.getStyle(M_AMBIENT)),t.styleMap[M_COLOR]&&(e.color=t.getStyle(M_COLOR)),t.styleMap[M_MAP_SRC]&&(e.dt=t.getStyle(M_MAP_SRC)),t.styleMap[M_TRANSPARENT]&&(e.transparent=t.getStyle(M_TRANSPARENT)),t.styleMap[M_TYPE]&&(e.types=t.getStyle(M_TYPE)),t.styleMap[M_VISIBLE]&&(e.visible=t.getStyle(M_VISIBLE)),t.styleMap[M_OPACITY]&&(e.opacity=t.getStyle(M_OPACITY)),t.styleMap[M_TEXTURE_FLIPX]&&(e.flipX=t.getStyle(M_TEXTURE_FLIPX)),t.styleMap[M_TEXTURE_FLIPY]&&(e.flipY=t.getStyle(M_TEXTURE_FLIPY)),t.styleMap[M_SPECULARSTRENGTH]&&(e.specularStrength=t.getStyle(M_SPECULARSTRENGTH)),t.styleMap[M_POLYGONOFFSET]&&(e.polygonOffset=t.getStyle(M_POLYGONOFFSET)),t.styleMap[M_POLYGONOFFSETFACTOR]&&(e.polygonOffsetFactor=t.getStyle(M_POLYGONOFFSETFACTOR)),t.styleMap[M_POLYGONOFFSETUNITS]&&(e.polygonOffsetUnits=t.getStyle(M_POLYGONOFFSETUNITS));var i=t.getStyle(M_MAP_REPEAT);if(e.repeat=[],i instanceof Array)for(var n=0;n<i.length;n++)e.repeat.push(i[n]?[i[n].x,i[n].y]:[1,1]);else e.repeat=[i.x,i.y]},getClientInfo:function(e,t){t.getClient("object3dId")&&(e.object3dId=t.getClient("object3dId")),t.getClient("scaleValue")&&(e.scaleValue=t.getClient("scaleValue")),Utils.isNotNull(t.getClient("mainVisible"))&&(e.mainVisible=t.getClient("mainVisible")),t.getClient(OID)&&(e.oid=t.getClient(OID)),t.getClient("animationGroup")&&(e.animationGroup=t.getClient("animationGroup"))},getModelInfo:function(e){var t=this.getCommonInfo(e);return this.getObject3DInfo(t,e),this.getStyleInfo(t,e),this.getClientInfo(t,e),t},getObject3DInfo:function(e,t){return t instanceof mono.Cube?this.getInfoOfCube(e,t):t instanceof mono.Sphere?this.getInfoOfSphere(e,t):t instanceof mono.Cylinder?this.getInfoOfCylinder(e,t):t instanceof mono.Torus?this.getInfoOfTorus(e,t):t instanceof mono.PathNode?this.getInfoOfPathNode(e,t):t instanceof mono.TextNode?this.getInfoOfTextNode(e,t):t instanceof mono.ComboNode?this.getInfoOfComboNode(e,t):t instanceof mono.LatheNode?this.getInfoOfLatheNode(e,t):t instanceof mono.Billboard?this.getInfoOfBillboard(e,t):t instanceof mono.Entity?this.getInfoOfEntity(e,t):e},getInfoOfCube:function(e,t){e.size={x:t.width,y:t.height,z:t.depth},e.className="mono.Cube";for(var i=0;6>i;i++)t.getClient("face"+i)&&(e["face"+i]=t.getClient("face"+i));var n=(t.material,t.getWrapMode());return n&&(e.wrapMode=n),e},getInfoOfSphere:function(e,t){var i=2*t.radius;e.size={x:i,y:i,z:i};t.material;return e.className="mono.Sphere",e},getInfoOfBillboard:function(e,t){return e.id=t.getId(),e.scale={x:t.getScale().x,y:t.getScale().y,z:t.getScale().z},e.className="mono.Billboard",e.dt=t.getStyle(M_MAP_SRC),e.alignment=t.getStyle(M_ALIGNMENT),e.transparent=t.getStyle(M_TRANSPARENT),e.opacity=t.getStyle(M_OPACITY),e.pos={x:t.getPosition().x,y:t.getPosition().y,z:t.getPosition().z},e[OID]=t.getClient(OID),e},getInfoOfCylinder:function(e,t){var i=t.radiusTop,n=t.radiusBottom,a=t.height;e.size={x:i,y:a,z:n};t.material;return e.className="mono.Cylinder",e.radialSegments=t.segmentsR,e.openTop=t.openTop,e.openBottom=t.openBottom,e},getInfoOfTorus:function(e,t){e[SHAPE_TYPE]="mono.Torus",e.radialSegments=t.segmentsR,e.radius=t.radius,e.tube=t.tube,e.tubularSegments=t.segmentsT,e.arc=t.arc;var i=t.radius+t.tube;return e[SPACE_SIZE]={x:i,y:i,z:i},e},getInfoOfPathNode:function(e,t){return e[SHAPE_TYPE]="mono.PathNode",e.radius=t.radius,e.path=t.getPath().toArray(),e.segments=t.segments,e.segmentsR=t.segmentsR,e.startCap=t.startCap,e.endCap=t.endCap,e.startCapSize=t.startCapSize,e.endCapSize=t.endCapSize,e.segmentsCap=t.segmentsCap,e},getInfoOfTextNode:function(e,t){return e[SHAPE_TYPE]="mono.TextNode",e.text=t.text,e.textSize=t.size,e.height=t.height,e.weight=t.weight,e.style=t.style,e.curveSegments=t.curveSegments,e.bevelEnabled=t.bevelEnabled,e},getInfoOfComboNode:function(e,t){var i=[];if(e[SHAPE_TYPE]="mono.ComboNode",e.operators=t.getOperators(),t.getCombos())for(var n=t.getCombos(),a=0;a<n.length;a++){var o=this.pushPrimitive(n[a]);i.push({id:o.id})}return e.combos=i,e.centralized=t.isCentralized(),e},getInfoOfLatheNode:function(e,t){return e[SHAPE_TYPE]="mono.LatheNode",e[PATH]=t.getPath().toArray(),e[SEGMENTSH]=t.getSegmentsH(),e[SEGMENTSR]=t.getSegmentsR(),e[ARC]=t.getArc(),e[START_CLOSED]=t.isStartClosed(),e[END_CLOSED]=t.isEndClosed(),e},getInfoOfEntity:function(e,t){return e[SHAPE_TYPE]="mono.Entity",e[VERTICES]=t.getVertices(),e[FACES]=t.getFaces(),e[UVS]=t.getUvs(),e},createAssembleID:function(e){return"assemble"+e},wrapAnimation:function(e,t){var i=t.getClient("animation");i&&""!=i&&(e.animation=i)},wrapCustomProps:function(e,t){var i=t.getClient(CUSTOM_PROPS),n=PropertyConsts.CUSTOM_PROPS,a=!1,o=!0;if(i)for(var r in i){if(!n[r]){o=!1;break}if(i[r]!=n[r]){o=!1;break}}if(o){var s;for(var l in i)t.getClient(i[l])&&(a=!0)}if(a&&i){var s;for(var l in i)s=i[l],e[s]=t.getClient(s);e.customProps=i}}}),ModelUtils={};var e;ModelUtils.setDefaultModelManager=function(t){e=t};var t=(180/Math.PI,Math.PI/180),i=function(e){return e*t},n=function(e){return e?!0:!1};require=function(e,t,i,n,o){a(e,t,i,n,o)};var a=function(e,t,i,a,o){if(n(e)||i("error: url error, "+e),!navigator.onLine)return void alert("NETWORK CONNECT ERROR");var r=Utils.createProgressBar(40,50),s=new FormData,l=t.module;l&&(e+="/"+l);var d=t.method;d&&(e+="/"+d);var c=t.arguments;if(c)for(var h in c)s.append(h,c[h]);var u=new XMLHttpRequest;u.open("POST",e,!0),u.withCredentials=!0,u.timeout=15e4;var g;u.ontimeout=function(){r&&r.parentNode&&r.parentNode.removeChild(r),g&&g.parentNode&&g.parentNode.removeChild(g),alert("request timeout")},setTimeout(function(){if((4!=u.readyState||200!=u.status)&&!o){g=Utils.addMask("progressBars"),g.style.zIndex=1001,r.style.zIndex=1002;var e=g.offsetWidth,t=g.offsetHeight;r.style.left=e/2-20+"px",r.style.top=t/2-25+"px",document.body.appendChild(r)}},1e3);var m=function(e){i&&i.call(this.scope,e)};m.scope=a,u.onreadystatechange=function(){if(navigator.onLine||(r&&r.parentNode&&r.parentNode.removeChild(r),g&&g.parentNode&&g.parentNode.removeChild(g),alert("NETWORK CONNECT ERROR")),404==u.status&&(r&&r.parentNode&&r.parentNode.removeChild(r),g&&g.parentNode&&g.parentNode.removeChild(g)),4==u.readyState&&200==u.status){if(i){var e=JSON.parse(u.responseText);e.error?"Login First"==e.error?document.location.href="login.html":alert(e.error):i.call(a,u.responseText)}r&&r.parentNode&&r.parentNode.removeChild(r),g&&g.parentNode&&g.parentNode.removeChild(g)}},u.send(s)},o=function(e,t){for(var i=0;i<e.length;i++)if(t==e[i].id)return e[i];return null};ModelUtils.containsInArray=function(e,t,i){return ModelUtils.indexInArray(e,t,i)>=0?!0:!1},ModelUtils.indexInArray=function(e,t,i){i||(i="id");for(var n=0;n<e.length;n++)if(t==e[n][i])return n;return-1};var r=function(e,t){if(e&&e instanceof Array)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.id==t)return!0}return!1};ModelUtils.covertTo3DPosition=function(e){var t=e.getCenterLocation(),i={};i.x=t.x;var n=e.getClient("size");return n&&(i.y=n.y/2),i.z=t.y,i},ModelUtils.isEquals=function(e,t){return e?e.x==t.x&&e.y==t.y&&e.z==t.z:t?!1:!0},ModelUtils.containsID=function(e,t){for(var i=0;i<e.length;i++)if(t==e[i].id)return!0;return!1},ModelUtils.removeChild=function(e,t){for(var i,n=0;n<e.length;n++)t==e[n].id&&(i=e[n]);if(i){var a=e.indexOf(i);a>-1&&e.splice(a,1)}},ModelUtils.copyProperties=function(e,t,i){for(var n in t)n!=i&&(e[n]=t[n])},ModelUtils.copyNeedProperties=function(e,t){for(var i in t)e[i]?e[i]!=t[i]&&(e[i]=t[i]):e[i]=t[i]},ModelUtils.mergeBoundingBox=function(e,t,i){e||(e=new mono.BoundingBox),t||(t=new mono.BoundingBox);var n=(t.max.x-t.min.x)/2,a=(t.max.y-t.min.y)/2,o=(t.max.z-t.min.z)/2,r=i.x+n,s=i.y+a,l=i.z+o,d=i.x-n,c=i.y-a,h=i.z-o,u={x:e.max.x>r?e.max.x:r,y:e.max.y>s?e.max.y:s,z:e.max.z>l?e.max.z:l},g={x:e.min.x<d?e.min.x:d,y:e.min.y<c?e.min.y:c,z:e.min.z<h?e.min.z:h};return new mono.BoundingBox(g,u)},ModelUtils.getCenterOfBoundingBox=function(e){return{x:(e.max.x+e.min.x)/2,y:(e.max.y+e.min.y)/2,z:(e.max.z+e.min.z)/2}},modelimp.ModelImp=function(){modelimp.ModelImp.superClass.constructor.apply(this)},twaver.Util.ext("modelimp.ModelImp",Object,{parse:function(e){this._modelnode=e},getContents:function(){return this._contents},get3DObjects:function(){return default3DShape},get2DObjects:function(){return defautl2DShape},getValue:function(e,t){if(!e)return null;var i=e[t];return(void 0===i||null===i)&&3==arguments.length&&(i=arguments[2]),i}}),modelimp.AssembleModel=function(){modelimp.AssembleModel.superClass.constructor.apply(this),this._contents=[],this.hostModelNode=null,this.mainNode=null,this.version},twaver.Util.ext("modelimp.AssembleModel",modelimp.ModelImp,{appendChild:function(e){this._contents.push(e)},get3DObjects:function(e){for(var t=[],i=0;i<this._contents.length;i++){var n=this._contents[i],a=this._contents[i].get3DObjects(this.version);if(e&&(this.ishost||this.templateName)){var o=this.getValue(this,"assembleSize");this.mainNode=new mono.Cube(o.x,o.y,o.z),this.mainNode.setClient("mainVisible",!1),this.mainNode.setStyle("m.transparent",!0),this.mainNode.setStyle("m.opacity",.001)}n.ishost&&(this.hostModelNode=a[0],this.pos&&this.hostModelNode.setPosition(this.pos.x,this.pos.y,this.pos.z)),t=t.concat(a)}if(!e&&this.mainNode&&(this.mainNode=void 0),this.hostModelNode)for(var i=0;i<t.length;i++)this.hostModelNode!=t[i]&&(t[i].getParent()||t[i].setParent(this.hostModelNode));if(this.mainNode){t=t.concat(this.mainNode);for(var i=0;i<t.length;i++)this.mainNode!=t[i]&&(t[i].getParent()||t[i].setParent(this.mainNode))}this.rootNodes=[];for(var i=0;i<t.length;i++)t[i].getParent()||this.rootNodes.push(t[i]);return t},get2DObjects:function(e){for(var t=[],i=0;i<this._contents.length;i++){var n=this._contents[i],a=this._contents[i].get2DObjects();if(e&&(this.ishost||this.templateName)){var o=this.getValue(this,"assembleSize");this.mainNode=new PrimitiveNode,this.mainNode.setClient("mainVisible",!1),this.mainNode.setClient("assembleSize",o),this.mainNode.setClient("gid",this.id),this.isEntity&&this.mainNode.setClient("isEntity",!0)}n.ishost&&(this.hostModelNode=a[0]),t=t.concat(a)}if(!e&&this.mainNode&&(this.mainNode=void 0),this.hostModelNode){var r=(this.getValue(this,"rot"),this.getValue(this,"pos"));r&&(this.hostModelNode.setCenterLocation({x:r.x,y:r.y}),this.hostModelNode.setClient("position",r));var s=this.getValue(this,"scaleValue");s&&this.hostModelNode.setClient("scaleValue",s);for(var l=this.hostModelNode.getCenterLocation(),i=0;i<t.length;i++)if(this.hostModelNode!=t[i]){var d=t[i].getCenterLocation();t[i].getHost()||(t[i].setCenterLocation({x:l.x+d.x,y:l.y+d.y}),t[i].setHost(this.hostModelNode),t[i].setParent(this.hostModelNode))}}if(this.mainNode){t=t.concat(this.mainNode);for(var l=this.mainNode.getClient("off"),i=0;i<t.length;i++)this.mainNode!=t[i]&&(t[i].getParent()||(t[i].setParent(this.mainNode),t[i].setHost(this.mainNode)))}return t}}),modelimp.PrimitiveModel=function(){modelimp.PrimitiveModel.superClass.constructor.apply(this),this.databox=new mono.DataBox},twaver.Util.ext("modelimp.PrimitiveModel",modelimp.ModelImp,{getContents:function(){return this._contents},get3DObjects:function(e){var t=[];if(e){var i={};for(var n in this){var a=this[n];"function"==typeof a&&a.constructor==Function||a instanceof mono.DataBox||(console.log(n,":",this[n]+">>>>>>>"),i[n]=this[n])}this.databox.clear();var o=new mono.SerializationSettings;o.isDataBoxSerializable=!1;var r=new mono.JsonSerializer(this.databox,o),s=r.serialize(),l=JSON.parse(s);l.datas.push(i),r.deserialize(JSON.stringify(l)),t.push(this.dataBox.getDataAt(0))}else t.push(GeometryTranslater.get3DGeometryFromModelImp(this));return t},get2DObjects:function(){var e=[],t=new PrimitiveNode,i=this.getValue(this,"className","mono.Cube");t.setClient("className",i),this.setBasicInfo(t);var n={},a=this.getValue(this,"radialSegments");a&&(n.radialSegments=a),this.radius&&(n.radius=this.radius),this.tube&&(n.tube=this.tube),this.tubularSegments&&(n.tubularSegments=this.tubularSegments),this.arc&&(n.arc=this.arc);var o=this.getValue(this,"alignment");o&&(n.alignment=o);var r=this.getValue(this,"mainVisible");return Utils.isNotNull(r)&&(n.mainVisible=r),"mono.Cube"===i?this.setCubeInfo(n):"mono.PathNode"===i?this.setPathNodeInfo(n):"mono.TextNode"===i?this.setTextNodeInfo(n):"mono.ComboNode"===i?this.setComboNodeInfo(n):"mono.LatheNode"===i?this.setLatheNodeInfo(n):"mono.Cylinder"===i&&this.setCylinderInfo(n),t.setClient("other",n),e.push(t),e},setBasicInfo:function(e){var t=this.getValue(this,"selectable");e.setClient("selectable",t);var i=this.getValue(this,"editable");e.setClient("editable",i);var n=this.getValue(this,"size");n&&e.setClient("size",n);var a=this.getValue(this,"scale");a&&e.setClient("scale",a);var o=this.getValue(this,"dt");o&&e.setClient("texture",o);var r=this.getValue(this,"rot");r&&e.setClient("rot",r);var s=this.getValue(this,"scaleValue");s&&e.setClient("scaleValue",s);var l=this.getValue(this,"transparent");l&&e.setClient("transparent",l);var d=this.getValue(this,"repeat");d&&e.setClient("repeat",d);var c=this.getValue(this,"types");c&&e.setClient("types",c);var h=this.getValue(this,"ov");h&&(e.setImage(Utils.Path+h),Utils.registerImage(Utils.Path+h,null,null,function(t,i){e.setSize(t,i)}));var u=this.getValue(this,"oid");u&&e.setClient(OID,u);var g=this.getValue(this,"id");g||(g=this.pid),e.setClient(GID,g);var m=this.getValue(this,"visible");e.setClient("visible",m),e.setClient("opacity",this.getValue(this,"opacity"));var p=this.getValue(this,"pos");p&&e.setClient("position",p),this.ishost&&(e.ishost=!0);var f=this.getValue(this,"color");f&&e.setClient("colors",f),e.setClient("ambient",this.getValue(this,"ambient"));var v=this.getValue(this,TAG_ANIMATION);v&&e.setClient(TAG_ANIMATION,v);var y=this.getValue(this,"animationGroup");y&&e.setClient("animationGroup",y),e.setClient("groupid",this.getValue(this,"groupid"));var b=this.getValue(this,CUSTOM_PROPS);if(b){for(var C in b)e.setClient(b[C],this.getValue(this,b[C]));e.setClient(CUSTOM_PROPS,b)}var w=this.getValue(this,"flipX");w&&e.setClient("flipX",w);var S=this.getValue(this,"flipY");S&&e.setClient("flipY",S);var x=this.getValue(this,PropertyConsts.LAYERID);x&&e.setClient(PropertyConsts.LAYERID,x);var I=this.getValue(this,"specularStrength");I&&e.setClient("specularStrength",I);var P=this.getValue(this,"polygonOffset");Utils.isNotNull(P)&&e.setClient("polygonOffset",P);var _=this.getValue(this,"polygonOffsetFactor");_&&e.setClient("polygonOffsetFactor",_);var E=this.getValue(this,"polygonOffsetUnits");E&&e.setClient("polygonOffsetUnits",E)},setCubeInfo:function(e){this.wrapMode&&(e.wrapMode=this.wrapMode)},setPathNodeInfo:function(e){this.path&&(e.path=this.path),this.segments&&(e.segments=this.segments);var t=this.getValue(this,"segmentsR");t&&(e.segmentsR=t),this.startCap&&(e.startCap=this.startCap),this.endCap&&(e.endCap=this.endCap),this.startCapSize&&(e.startCapSize=this.startCapSize),this.endCapSize&&(e.endCapSize=this.endCapSize),this.segmentsCap&&(e.segmentsCap=this.segmentsCap)},setTextNodeInfo:function(e){this.text&&(e.text=this.text),this.textSize&&(e.textSize=this.textSize),this.height&&(e.height=this.height),this.weight&&(e.weight=this.weight),this.style&&(e.style=this.style),this.curveSegments&&(e.curveSegments=this.curveSegments),this.bevelEnabled&&(e.bevelEnabled=this.bevelEnabled)},setComboNodeInfo:function(e){this.operators&&(e.operators=this.operators),this.combos&&(e.combos=this.combos),this.centralized&&(e.centralized=this.centralized)},setLatheNodeInfo:function(e){this[PATH]&&(e.path=this[PATH]),this[SEGMENTSH]&&(e.segmentsH=this[SEGMENTSH]),this[SEGMENTSR]&&(e.segmentsR=this[SEGMENTSR]),this[ARC]&&(e.arc=this[ARC]),void 0!==this[START_CLOSED]&&(e.startClosed=this[START_CLOSED]),void 0!==this[END_CLOSED]&&(e.endClosed=this[END_CLOSED])},setCylinderInfo:function(e){Utils.isNotNull(this.openTop)&&(e.openTop=this.openTop),Utils.isNotNull(this.openBottom)&&(e.openBottom=this.openBottom)}}),modelimp.Normal=function(){modelimp.Normal.superClass.constructor.apply(this)},twaver.Util.ext("modelimp.Normal",modelimp.PrimitiveModel,{get2DObjects:function(){var e=[],t=getValue(this,"size"),n={x:-t.x/2,y:0},a={x:t.x/2,y:0},o=getValue(this,"rot");if(o){var r=i(o.y),s=_twaver.math.createMatrix(r,0,0);n=s.transform(n),a=s.transform(a)}var l=new ImageShapeNode,d=[n,a];return l.setStyle("vector.outline.color","#333333"),t&&(l.setStyle("vector.outline.width",t.z),l.setClient("size",t)),l.setStyle("shapenode.closed",!1),l.setPoints(new twaver.List(d)),e.push(l),e}}),modelimp.FloorShapedModel=function(){modelimp.FloorShapedModel.superClass.constructor.apply(this)},twaver.Util.ext("modelimp.FloorShapedModel",modelimp.PrimitiveModel,{get3DObjects:function(){return default3DShape},get2DObjects:function(){var e=this.getValue(this,"dt"),t=this.getValue(this,OUTLINE_SHAPE),i=this.getValue(this,TRA_PAR),n=this.getValue(this,OPA),a=this.getValue(this,PropertyConsts.LAYERID);if(t.length%3==0){for(var o=[],r=0;r<t.length;r+=3)o.push({x:t[r],y:t[r+2]});var s=new FloorShapeNode;return s.setLayerId(bottomLayer.getId()),s.setPoints(new twaver.List(o)),s.setClient(SHAPE_TYPE,"FloorShapedModel"),s.setClient(GID,this.getID()),s.setClient(TRA_PAR,i),s.setClient(OPA,n),a&&s.setClient(PropertyConsts.LAYERID,a),e&&(Utils.registerImage(Utils.Path+e),s.setClient(IMAGE_SRC,Utils.Path+e)),[s]}return null}}),modelimp.RoomModel=function(){modelimp.RoomModel.superClass.constructor.apply(this)},twaver.Util.ext("modelimp.RoomModel",modelimp.FloorShapedModel,{get3DObjects:function(){return[]},get2DObjects:function(){var e=this.getValue(this,OUTLINE_SHAPE),t=this.getValue(this,TRA_PAR),i=this.getValue(this,OPA),n=this.getValue(this,PropertyConsts.LAYERID);if(e.length%3==0){for(var a=[],o=0;o<e.length;o+=3)a.push({x:e[o],y:e[o+2]});var r=this.getValue(this,"size"),s=new ImageShapeNode;return r&&s.setClient("size",{x:r.x,y:r.y,z:r.z}),s.setPoints(new twaver.List(a)),s.setClient("className","RoomModel"),s.setClient("gid",this.getID()),s.setClient(TRA_PAR,t),s.setClient(OPA,i),n&&s.setClient(PropertyConsts.LAYERID,n),[s]}return null}}),modelimp.BlockModel=function(){modelimp.BlockModel.superClass.constructor.apply(this)},twaver.Util.ext("modelimp.BlockModel",modelimp.PrimitiveModel,{get3DObjects:function(){return default3DShape},get2DObjects:function(){var e=this.getValue(this,"dt"),t=this.getValue(this,"dsize"),i=this.getValue(this,"pos"),n=this.getValue(this,"btype"),a=this.getValue(this,"specularStrength"),o=this.getValue(this,TRA_PAR),r=this.getValue(this,OPA),s=this.getValue(this,PropertyConsts.LAYERID),l=null;l="window"==n?new Window:"door"==n?new Door:"cutoff"==n?new Cutoff:new Block,l.setClient("length",t.x),l.setClient("height",t.y),a&&l.setClient("specularStrength",a),i&&l.setClient("positionY",i.y),e&&l.setClient("picture",Utils.Path+e);var d=this.getValue(this,"rot");return d&&l.setClient("angle",d.y),o&&l.setClient(TRA_PAR,o),r&&l.setClient(OPA,r),s&&l.setClient(PropertyConsts.LAYERID,s),l.setClient("className","BlockModel"),l.setClient("gid",this.getID()),[l]}}),ModelFactory={},ModelFactory.models={},ModelFactory.createModel=function(e){var t=e;t&&t.indexOf(".")<0&&(t="modelimp."+t);var i=_twaver.newInstance(t);return i},ModelFactory.getModelFromModelNode=function(e,t){if(!t)return null;var i=t.pid;i||(i=t.id);var n=ModelFactory.models[i];return n||(n=ModelFactory.createModelFromModelNode(e,t),n&&(ModelFactory.models[i]=n)),n},ModelFactory.createModelFromModelNode=function(e,t){if(!t)return null;var i=e.getValue(t,"type"),n=e.getValue(t,"shape");if(modellib.ModelNode.TYPE_ASSEMBLE==i){var a=null;if(n||(n="AssembleModel"),a=ModelFactory.createModel(n)){a.id=t.id,a.pid=t.pid;for(var o=e.getModelNodeContents(t),r=0;r<o.length;r++){var s=o[r],l=e.getModelNode(s.id),d={},c=ModelFactory.getModelFromModelNode(e,l);ModelUtils.copyNeedProperties(d,c),ModelUtils.copyNeedProperties(d,s),a.appendChild(d)}ModelUtils.copyProperties(a,t)}return a}n||(n="PrimitiveModel");var h=ModelFactory.createModel(n);return h.id=t.id,ModelUtils.copyProperties(h,t),h}}(),TGL.Bridge=function(e,t,i){this.box2d=e,this.box3d=t,this.mainBox=i==this.box3d?this.box3d:this.box2d,this.binded=!1,this.refMap2d={},this.refMap3d={},this.isAdjusting=!1,this.positionSynchronizeFunction=null},twaver&&null==twaver.Element.prototype.s3d&&(twaver.Element.prototype.s3d=function(e,t){var i="t3d.",n=1==arguments.length;if(n)for(var a in e)this.setStyle(i+a,e[a]);else this.setStyle(i+e,t)},twaver.Element.prototype.getStyle3D=function(e){var t="t3d.";return this.getStyle(t+e)}),TGL.extend(TGL.Bridge,Object,{bind:function(){this.binded||(this.mainBox===this.box2d?(this.box3d.clear(),this._synchronize2dData()):(this.box2d.clear(),this._synchronize3dData()),this.box2d.addDataBoxChangeListener(this._handle2dBoxChange,this),this.box2d.addDataPropertyChangeListener(this._handle2dDataChange,this),this.box2d.getAlarmBox().addDataBoxChangeListener(this._handle2dAlarmBoxChange,this),this.box2d.getSelectionModel().addSelectionChangeListener(this._handle2dSelectionChange,this),this.box3d.addDataBoxChangeListener(this._handle3dBoxChange,this),this.box3d.addDataPropertyChangeListener(this._handle3dDataChange,this),this.box3d.getAlarmBox().addDataBoxChangeListener(this._handle2dAlarmBoxChange,this),this.box3d.getSelectionModel().addSelectionChangeListener(this._handle3dSelectionChange,this),this.binded=!0)},unbind:function(){this.box2d.removeDataBoxChangeListener(this._handle2dBoxChange,this),this.box2d.removeDataPropertyChangeListener(this._handle2dDataChange,this),this.box2d.getAlarmBox().removeDataBoxChangeListener(this._handle2dAlarmBoxChange,this),this.box2d.getSelectionModel().removeSelectionChangeListener(this._handle2dSelectionChange,this),this.box3d.removeDataBoxChangeListener(this._handle3dBoxChange,this),this.box3d.removeDataPropertyChangeListener(this._handle3dDataChange,this),this.box3d.getAlarmBox().removeDataBoxChangeListener(this._handle3dAlarmBoxChange,this),this.box3d.getSelectionModel().removeSelectionChangeListener(this._handle3dSelectionChange,this),this.binded=!1},synchronizeFilter:function(){return!0},_synchronize2dData:function(){var e=this.box2d;e.getRoots().forEach(this._add3dData,this)},_get3dConstructor:function(e){if("pathcube"==e)return"PathCube";if("pathnode"==e)return"PathNode";if("shapenode"==e)return"ShapeNode";if("combonode"==e)return"ComboNode";if("pointlight"==e)return"PointLight";if("ambientlight"==e)return"AmbientLight";if("directionallight"==e)return"DirectionalLight";if("spotlight"==e)return"SpotLight";var t=e.charAt(0).toUpperCase()+e.slice(1);return t},_get3dStyleProperties:function(e){var t={styles:{},properties:{}},i=e._styleMap;for(var n in i)if(n.startsWith("t3d.m.")||n.startsWith("t3d.select.")){var a=n.substr(n.indexOf(".")+1);t.styles[a]=i[n]}else if(n.startsWith("t3d.")){var o=n.substr(4);"position"!=o&&"rotation"!=o&&"scale"!=o&&"shape"!=o&&(t.properties[o]=i[n])}return t.properties.id=e.getId(),t},_get3dData:function(e){var t=this._get3dStyleProperties(e),i=t.styles,n=t.properties,a=e.getStyle("t3d.shape")||"cube",o=e.getStyle("t3d.position"),r=e.getStyle("t3d.rotation"),s=e.getStyle("t3d.scale");
a=a.toLowerCase();var l="combonode"==a;if(l){var d=n.combos,c=[];if(null!=d&&d.length>0)for(var h=0;h<d.length;h++){var u=d[h],g=this.box3d.getDataById(u.getId());null==g&&(g=this._get3dData(u)),c.push(g)}n.combos=c}var m=this._get3dConstructor(a);m=mono[m];var p=new m(n);return p.s(i),null!=o&&o.length&&o.length>=3?p.setPosition(o[0],o[1],o[2]):this.positionSynchronizeFunction&&this.positionSynchronizeFunction(e,p),null!=r&&r.length&&r.length>=3&&p.setRotation(r[0],r[1],r[2]),null!=s&&s.length&&s.length>=3&&p.setScale(s[0],s[1],s[2]),p},_add3dData:function(e){if(this.synchronizeFilter(e,null)){if(this.box2d.contains(e)){var t=this._get3dData(e);if(this.box3d.add(t),this.refMap3d[e.getId()]=t,null!=e.getParent()){var i=this.refMap3d[e.getParent().getId()];t.setParent(i)}}e.getChildren().forEach(this._add3dData,this)}},_remove3dData:function(e){null!=e&&(this.box3d.removeById(e.getId(),!0),delete this.refMap3d[e.getId()])},_synchronize3dData:function(){var e=this.box3d;e.getRoots().forEach(this._add2dData,this)},_handle2dBoxChange:function(e){if(!this.isAdjusting){this.isAdjusting=!0;var t=e.data,i=e.kind;"add"==i?this._add3dData(t):"remove"==i?this._remove3dData(t):"clear"==i&&this.box3d.clear(),this.isAdjusting=!1}},_resetSpaceValue:function(e,t){return(null==e||e.length<3)&&(e=t?[1,1,1]:[0,0,0]),e},_handle2dDataChange:function(e){if(!this.isAdjusting){this.isAdjusting=!0;var t=e.source,i=e.newValue,n=e.oldValue,a=e.property,o=this.box3d.getDataById(t.getId());if(a.startsWith("S:"))if("S:t3d.shape"==a)this._remove3dData(t),this._add3dData(t);else if(a.startsWith("S:t3d.m.")||a.startsWith("S:t3d.select.")){var r=a.substr(6);o.setStyle(r,i)}else if("S:t3d.position"==a)i=this._resetSpaceValue(i),o.setPosition(i[0],i[1],i[2]);else if("S:t3d.rotation"==a)i=this._resetSpaceValue(i),o.setRotation(i[0],i[1],i[2]);else if("S:t3d.scale"==a)i=this._resetSpaceValue(i,!0),o.setRotation(i[0],i[1],i[2]);else{var s=a.substr(6);if("combos"==s.toLowerCase()&&i&&i.length>0){for(var l=[],d=0;d<i.length;d++){var c=i[d],h=this.box3d.getDataById(c.getId());null==h&&(h=this._get3dData(c)),l.push(h)}i=l}o[s]=i,o.onSizeChanged(),o.firePropertyChange(s,n,o[s])}else"location"==a?null==t.getStyle("S:t3d.position")&&this.positionSynchronizeFunction&&this.positionSynchronizeFunction(t,o):a.startsWith("C")&&(s=a.substr(a.indexOf(":")+1),o.setClient(s,i));this.isAdjusting=!1}},_handle3dBoxChange:function(e){if(!this.isAdjusting){this.isAdjusting=!0;var t=e.data,i=e.kind;"add"==i?this._add2dData(t):"remove"==i?this._remove2dData(t):"clear"==i&&this.box2d.clear(),this.isAdjusting=!1}},_handle3dDataChange:function(e){if(!this.isAdjusting){this.isAdjusting=!0;var t=e.property,i=e.source,n=i.__accessor,a=e.newValue,o=this.box2d.getDataById(i.getId());o&&(t.startsWith("S:")?(t=t.substr(t.indexOf(":")+1),o.setStyle("t3d."+t,a)):n&&-1!=n.indexOf(t)?o.setStyle("t3d."+t,a):"position"==t||"rotation"==t||"scale"==t?"position"==t&&this.positionSynchronizeFunction?this.positionSynchronizeFunction(o,i,!0):o.setStyle("t3d."+t,[a.x,a.y,a.z]):t.startsWith("C:")&&(t=t.substr(t.indexOf(":")+1),o.setClient(t,a))),this.isAdjusting=!1}},_remove2dData:function(e){null!=e&&this.box2d.removeById(e.getId())},_get2dData:function(e){var t=new twaver.Node(e.getId()),i=e.getClassName();i&&-1!=i.indexOf(".")&&(i=i.substr(i.indexOf(".")+1)),t.setStyle("t3d.shape",i);var n=e.__accessor;if(n&&n.length)for(var a=0;a<n.length;a++)"shape"!==n[a]&&t.setStyle("t3d."+n[a],e[n[a]]);var o={};for(var r in e.styleMap)o[r]=e.styleMap[r],t.setStyle("t3d."+r,e.styleMap[r]);var s={};for(var r in e._clientMap)s[r]=e._clientMap[r],t.setClient(r,e._clientMap[r]);var l=e.getPosition(),d=e.getRotation(),c=e.getScale();return(0!=l.x||0!=l.y||0!=l.z)&&(0!=l.y&&t.setStyle("t3d.position",[l.x,l.y,l.z]),this.positionSynchronizeFunction&&this.positionSynchronizeFunction(t,e,!0)),(0!=d.x||0!=d.y||0!=d.z)&&t.setStyle("t3d.rotation",[d.x,d.y,d.z]),(0!=c.x||0!=c.y||0!=c.z)&&t.setStyle("t3d.scale",[c.x,c.y,c.z]),t},_add2dData:function(e){if(this.synchronizeFilter(null,e)){if(this.box3d.contains(e)){var t=this._get2dData(e);if(this.box2d.getDataById(t.getId())||this.box2d.add(t),this.refMap2d[e.getId()]=t,null!=e.getParent()){var i=this.refMap2d[e.getParent().getId()];t.setParent(i)}if(e.getChildren().size()>0)for(var n=0;n<e.getChildren().size();n++){var a=this.refMap2d[e.getChildren().get(n).getId()];a&&a.setParent(t)}}e.getChildren().forEach(this._add2dData,this)}},_handle3dAlarmBoxChange:function(e){if(!this.isAdjusting){this.isAdjusting=!0;var t=e.kind;if("clear"==t)this.box2d.getAlarmBox().clear();else{var i=e.data,n=i.getElementId(),a=i.getid(),o=i.getAlarmSeverity();if("add"==t){{new twaver.AlarmSeverity(o.value,o.name,o.nickName,o.color,o.diplayName),new twaver.Alarm(a,n,s3d,i.isAcked(),i.isCleared())}this.box2d.getAlarmBox().add(alarm3d)}else"remove"==t&&this.box2d.getAlarmBox().removeById(a)}this.isAdjusting=!1}},_handle2dAlarmBoxChange:function(e){if(!this.isAdjusting){this.isAdjusting=!0;var t=e.kind;if("clear"==t)this.box3d.getAlarmBox().clear();else{var i=e.data,n=i.getElementId(),a=i.getId(),o=i.getAlarmSeverity();if("add"==t){var r=new TGL.AlarmSeverity(o.value,o.name,o.nickName,o.color,o.displayName),s=new TGL.Alarm(a,n,r,i.isAcked(),i.isCleared());this.box3d.getAlarmBox().add(s)}else"remove"==t&&this.box3d.getAlarmBox().removeById(a)}this.isAdjusting=!1}},_handle3dSelectionChange:function(e){if(!this.isAdjusting){this.isAdjusting=!0;var t=e.kind,i=e.datas;if("clear"==t)this.box2d.getSelectionModel().clearSelection();else{var n=new twaver.List,a=this;i.forEach(function(e){n.add(a.box2d.getDataById(e.getId()))}),this.box2d.getSelectionModel().appendSelection(n)}this.isAdjusting=!1}},_handle2dSelectionChange:function(e){if(!this.isAdjusting){this.isAdjusting=!0;var t=e.kind,i=e.datas;if("clear"==t)this.box3d.getSelectionModel().clearSelection();else if("set"==t){this.box3d.getSelectionModel().clearSelection();var n=this.box2d.getSelectionModel().getLastData(),a=this.box3d.getDataById(n.getId());this.box3d.getSelectionModel().setSelection(a)}else{var o=new TGL.List,r=this;i.forEach(function(e){o.add(r.box3d.getDataById(e.getId()))}),this.box3d.getSelectionModel().appendSelection(o)}this.isAdjusting=!1}}}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JSZip=e()}}(function(){return function e(t,i,n){function a(r,s){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+r+"'")}var d=i[r]={exports:{}};t[r][0].call(d.exports,function(e){var i=t[r][1][e];return a(i?i:e)},d,d.exports,e,t,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)a(n[r]);return a}({1:[function(e,t,i){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e){for(var t,i,a,o,r,s,l,d="",c=0;c<e.length;)t=e.charCodeAt(c++),i=e.charCodeAt(c++),a=e.charCodeAt(c++),o=t>>2,r=(3&t)<<4|i>>4,s=(15&i)<<2|a>>6,l=63&a,isNaN(i)?s=l=64:isNaN(a)&&(l=64),d=d+n.charAt(o)+n.charAt(r)+n.charAt(s)+n.charAt(l);return d},i.decode=function(e){var t,i,a,o,r,s,l,d="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)o=n.indexOf(e.charAt(c++)),r=n.indexOf(e.charAt(c++)),s=n.indexOf(e.charAt(c++)),l=n.indexOf(e.charAt(c++)),t=o<<2|r>>4,i=(15&r)<<4|s>>2,a=(3&s)<<6|l,d+=String.fromCharCode(t),64!=s&&(d+=String.fromCharCode(i)),64!=l&&(d+=String.fromCharCode(a));return d}},{}],2:[function(e,t){"use strict";function i(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}i.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=i},{}],3:[function(e,t,i){"use strict";i.STORE={magic:"\x00\x00",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},i.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t){"use strict";var i=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if("undefined"==typeof e||!e.length)return 0;var a="string"!==i.getTypeOf(e);"undefined"==typeof t&&(t=0);var o=0,r=0,s=0;t=-1^t;for(var l=0,d=e.length;d>l;l++)s=a?e[l]:e.charCodeAt(l),r=255&(t^s),o=n[r],t=t>>>8^o;return-1^t}},{"./utils":21}],5:[function(e,t){"use strict";function i(){this.data=null,this.length=0,this.index=0}var n=e("./utils");i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||0>e)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=i},{"./utils":21}],6:[function(e,t,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!1,i.date=null,i.compression=null,i.comment=null},{}],7:[function(e,t,i){"use strict";var n=e("./utils");i.string2binary=function(e){return n.string2binary(e)},i.string2Uint8Array=function(e){return n.transformTo("uint8array",e)},i.uint8Array2String=function(e){return n.transformTo("string",e)},i.string2Blob=function(e){var t=n.transformTo("arraybuffer",e);return n.arrayBuffer2Blob(t)},i.arrayBuffer2Blob=function(e){return n.arrayBuffer2Blob(e)},i.transformTo=function(e,t){return n.transformTo(e,t)},i.getTypeOf=function(e){return n.getTypeOf(e)},i.checkSupport=function(e){return n.checkSupport(e)},i.MAX_VALUE_16BITS=n.MAX_VALUE_16BITS,i.MAX_VALUE_32BITS=n.MAX_VALUE_32BITS,i.pretty=function(e){return n.pretty(e)},i.findCompression=function(e){return n.findCompression(e)},i.isRegExp=function(e){return n.isRegExp(e)}},{"./utils":21}],8:[function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,a=e("pako");i.uncompressInputType=n?"uint8array":"array",i.compressInputType=n?"uint8array":"array",i.magic="\b\x00",i.compress=function(e){return a.deflateRaw(e)},i.uncompress=function(e){return a.inflateRaw(e)}},{pako:24}],9:[function(e,t){"use strict";function i(e,t){return this instanceof i?(this.files={},this.comment=null,this.root="",e&&this.load(e,t),void(this.clone=function(){var e=new i;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e})):new i(e,t)}var n=e("./base64");i.prototype=e("./object"),i.prototype.load=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.utils=e("./deprecatedPublicUtils"),i.base64={encode:function(e){return n.encode(e)},decode:function(e){return n.decode(e)}},i.compressions=e("./compressions"),t.exports=i},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t){"use strict";var i=e("./base64"),n=e("./zipEntries");t.exports=function(e,t){var a,o,r,s;for(t=t||{},t.base64&&(e=i.decode(e)),o=new n(e,t),a=o.files,r=0;r<a.length;r++)s=a[r],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,createFolders:t.createFolders});return o.zipComment.length&&(this.comment=o.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,t){(function(e){"use strict";t.exports=function(t,i){return new e(t,i)},t.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(e,t){"use strict";function i(e){this.data=e,this.length=this.data.length,this.index=0}var n=e("./uint8ArrayReader");i.prototype=new n,i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=i},{"./uint8ArrayReader":18}],13:[function(e,t){"use strict";var i=e("./support"),n=e("./utils"),a=e("./crc32"),o=e("./signature"),r=e("./defaults"),s=e("./base64"),l=e("./compressions"),d=e("./compressedObject"),c=e("./nodeBuffer"),h=e("./utf8"),u=e("./stringWriter"),g=e("./uint8ArrayWriter"),m=function(e){if(e._data instanceof d&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===n.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},p=function(e){var t=m(e),a=n.getTypeOf(t);return"string"===a?!e.options.binary&&i.nodebuffer?c(t,"utf-8"):e.asBinary():t},f=function(e){var t=m(this);return null===t||"undefined"==typeof t?"":(this.options.base64&&(t=s.decode(t)),t=e&&this.options.binary?_.utf8decode(t):n.transformTo("string",t),e||this.options.binary||(t=n.transformTo("string",_.utf8encode(t))),t)},v=function(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this._data=t,this.options=i,this._initialMetadata={dir:i.dir,date:i.date}};v.prototype={asText:function(){return f.call(this,!0)},asBinary:function(){return f.call(this,!1)},asNodeBuffer:function(){var e=p(this);return n.transformTo("nodebuffer",e)},asUint8Array:function(){var e=p(this);return n.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var y=function(e,t){var i,n="";for(i=0;t>i;i++)n+=String.fromCharCode(255&e),e>>>=8;return n},b=function(){var e,t,i={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&"undefined"==typeof i[t]&&(i[t]=arguments[e][t]);return i},C=function(e){return e=e||{},e.base64!==!0||null!==e.binary&&void 0!==e.binary||(e.binary=!0),e=b(e,r),e.date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},w=function(e,t,i){var a,o=n.getTypeOf(t);if(i=C(i),i.createFolders&&(a=S(e))&&x.call(this,a,!0),i.dir||null===t||"undefined"==typeof t)i.base64=!1,i.binary=!1,t=null;else if("string"===o)i.binary&&!i.base64&&i.optimizedBinaryString!==!0&&(t=n.string2binary(t));else{if(i.base64=!1,i.binary=!0,!(o||t instanceof d))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===o&&(t=n.transformTo("uint8array",t))}var r=new v(e,t,i);return this.files[e]=r,r},S=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},x=function(e,t){return"/"!=e.slice(-1)&&(e+="/"),t="undefined"!=typeof t?t:!1,this.files[e]||w.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},I=function(e,t){var i,o=new d;return e._data instanceof d?(o.uncompressedSize=e._data.uncompressedSize,o.crc32=e._data.crc32,0===o.uncompressedSize||e.dir?(t=l.STORE,o.compressedContent="",o.crc32=0):e._data.compressionMethod===t.magic?o.compressedContent=e._data.getCompressedContent():(i=e._data.getContent(),o.compressedContent=t.compress(n.transformTo(t.compressInputType,i)))):(i=p(e),(!i||0===i.length||e.dir)&&(t=l.STORE,i=""),o.uncompressedSize=i.length,o.crc32=a(i),o.compressedContent=t.compress(n.transformTo(t.compressInputType,i))),o.compressedSize=o.compressedContent.length,o.compressionMethod=t.magic,o},P=function(e,t,i,r){var s,l,d,c,u=(i.compressedContent,n.transformTo("string",h.utf8encode(t.name))),g=t.comment||"",m=n.transformTo("string",h.utf8encode(g)),p=u.length!==t.name.length,f=m.length!==g.length,v=t.options,b="",C="",w="";d=t._initialMetadata.dir!==t.dir?t.dir:v.dir,c=t._initialMetadata.date!==t.date?t.date:v.date,s=c.getHours(),s<<=6,s|=c.getMinutes(),s<<=5,s|=c.getSeconds()/2,l=c.getFullYear()-1980,l<<=4,l|=c.getMonth()+1,l<<=5,l|=c.getDate(),p&&(C=y(1,1)+y(a(u),4)+u,b+="up"+y(C.length,2)+C),f&&(w=y(1,1)+y(this.crc32(m),4)+m,b+="uc"+y(w.length,2)+w);var S="";S+="\n\x00",S+=p||f?"\x00\b":"\x00\x00",S+=i.compressionMethod,S+=y(s,2),S+=y(l,2),S+=y(i.crc32,4),S+=y(i.compressedSize,4),S+=y(i.uncompressedSize,4),S+=y(u.length,2),S+=y(b.length,2);var x=o.LOCAL_FILE_HEADER+S+u+b,I=o.CENTRAL_FILE_HEADER+"\x00"+S+y(m.length,2)+"\x00\x00\x00\x00"+(d===!0?"\x00\x00\x00":"\x00\x00\x00\x00")+y(r,4)+u+b+m;return{fileRecord:x,dirRecord:I,compressedObject:i}},_={load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,i,n,a,o=[];for(t in this.files)this.files.hasOwnProperty(t)&&(n=this.files[t],a=new v(n.name,n._data,b(n.options)),i=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(i,a)&&o.push(a));return o},file:function(e,t,i){if(1===arguments.length){if(n.isRegExp(e)){var a=e;return this.filter(function(e,t){return!t.dir&&a.test(e)})}return this.filter(function(t,i){return!i.dir&&t===e})[0]||null}return e=this.root+e,w.call(this,e,t,i),this},folder:function(e){if(!e)return this;if(n.isRegExp(e))return this.filter(function(t,i){return i.dir&&e.test(t)});var t=this.root+e,i=x.call(this,t),a=this.clone();return a.root=i.name,a},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var i=this.filter(function(t,i){return i.name.slice(0,e.length)===e}),n=0;n<i.length;n++)delete this.files[i[n].name];return this},generate:function(e){e=b(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),n.checkSupport(e.type);var t,i,a=[],r=0,d=0,c=n.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var h in this.files)if(this.files.hasOwnProperty(h)){var m=this.files[h],p=m.options.compression||e.compression.toUpperCase(),f=l[p];if(!f)throw new Error(p+" is not a valid compression method !");var v=I.call(this,m,f),C=P.call(this,h,m,v,r);r+=C.fileRecord.length+v.compressedSize,d+=C.dirRecord.length,a.push(C)}var w="";w=o.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+y(a.length,2)+y(a.length,2)+y(d,4)+y(r,4)+y(c.length,2)+c;var S=e.type.toLowerCase();for(t="uint8array"===S||"arraybuffer"===S||"blob"===S||"nodebuffer"===S?new g(r+d+w.length):new u(r+d+w.length),i=0;i<a.length;i++)t.append(a[i].fileRecord),t.append(a[i].compressedObject.compressedContent);for(i=0;i<a.length;i++)t.append(a[i].dirRecord);t.append(w);var x=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return n.transformTo(e.type.toLowerCase(),x);case"blob":return n.arrayBuffer2Blob(n.transformTo("arraybuffer",x));case"base64":return e.base64?s.encode(x):x;default:return x}},crc32:function(e,t){return a(e,t)},utf8encode:function(e){return n.transformTo("string",h.utf8encode(e))},utf8decode:function(e){return h.utf8decode(e)}};t.exports=_},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,t){"use strict";function i(e,t){this.data=e,t||(this.data=a.string2binary(this.data)),this.length=this.data.length,this.index=0}var n=e("./dataReader"),a=e("./utils");i.prototype=new n,i.prototype.byteAt=function(e){return this.data.charCodeAt(e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=i},{"./dataReader":5,"./utils":21}],16:[function(e,t){"use strict";var i=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=i.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=n},{"./utils":21}],17:[function(e,t,i){(function(e){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof e,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var t=new ArrayBuffer(0);try{i.blob=0===new Blob([t],{type:"application/zip"}).size}catch(n){try{var a=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,o=new a;o.append(t),i.blob=0===o.getBlob("application/zip").size}catch(n){i.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(e,t){"use strict";function i(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var n=e("./dataReader");i.prototype=new n,i.prototype.byteAt=function(e){return this.data[e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),n=e.charCodeAt(2),a=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===i&&this.data[o+2]===n&&this.data[o+3]===a)return o;return-1},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=i},{"./dataReader":5}],19:[function(e,t){"use strict";var i=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=i.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=n},{"./utils":21}],20:[function(e,t,i){"use strict";for(var n=e("./utils"),a=e("./support"),o=e("./nodeBuffer"),r=new Array(256),s=0;256>s;s++)r[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;r[254]=r[254]=1;var l=function(e){var t,i,n,o,r,s=e.length,l=0;for(o=0;s>o;o++)i=e.charCodeAt(o),55296===(64512&i)&&s>o+1&&(n=e.charCodeAt(o+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),o++)),l+=128>i?1:2048>i?2:65536>i?3:4;for(t=a.uint8array?new Uint8Array(l):new Array(l),r=0,o=0;l>r;o++)i=e.charCodeAt(o),55296===(64512&i)&&s>o+1&&(n=e.charCodeAt(o+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),o++)),128>i?t[r++]=i:2048>i?(t[r++]=192|i>>>6,t[r++]=128|63&i):65536>i?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},d=function(e,t){var i;for(t=t||e.length,t>e.length&&(t=e.length),i=t-1;i>=0&&128===(192&e[i]);)i--;return 0>i?t:0===i?t:i+r[e[i]]>t?i:t},c=function(e){var t,i,a,o,s=e.length,l=new Array(2*s);for(i=0,t=0;s>t;)if(a=e[t++],128>a)l[i++]=a;else if(o=r[a],o>4)l[i++]=65533,t+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&s>t;)a=a<<6|63&e[t++],o--;o>1?l[i++]=65533:65536>a?l[i++]=a:(a-=65536,l[i++]=55296|a>>10&1023,l[i++]=56320|1023&a)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),n.applyFromCharCode(l)};i.utf8encode=function(e){return a.nodebuffer?o(e,"utf-8"):l(e)},i.utf8decode=function(e){if(a.nodebuffer)return n.transformTo("nodebuffer",e).toString("utf-8");e=n.transformTo(a.uint8array?"uint8array":"array",e);for(var t=[],i=0,o=e.length,r=65536;o>i;){var s=d(e,Math.min(i+r,o));t.push(a.uint8array?c(e.subarray(i,s)):c(e.slice(i,s))),i=s}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,i){"use strict";function n(e){return e}function a(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}function o(e){var t=65536,n=[],a=e.length,o=i.getTypeOf(e),r=0,s=!0;try{switch(o){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,d(0))}}catch(l){s=!1}if(!s){for(var c="",h=0;h<e.length;h++)c+=String.fromCharCode(e[h]);return c}for(;a>r&&t>1;)try{n.push("array"===o||"nodebuffer"===o?String.fromCharCode.apply(null,e.slice(r,Math.min(r+t,a))):String.fromCharCode.apply(null,e.subarray(r,Math.min(r+t,a)))),r+=t}catch(l){t=Math.floor(t/2)}return n.join("")}function r(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}var s=e("./support"),l=e("./compressions"),d=e("./nodeBuffer");i.string2binary=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(255&e.charCodeAt(i));return t},i.arrayBuffer2Blob=function(e){i.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(t){try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,a=new n;return a.append(e),a.getBlob("application/zip")}catch(t){throw new Error("Bug : can't construct the Blob.")}}},i.applyFromCharCode=o;var c={};c.string={string:n,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return c.string.uint8array(e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:function(e){return a(e,d(e.length))}},c.array={string:o,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return d(e)}},c.arraybuffer={string:function(e){return o(new Uint8Array(e))},array:function(e){return r(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return d(new Uint8Array(e))}},c.uint8array={string:o,array:function(e){return r(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return d(e)}},c.nodebuffer={string:o,array:function(e){return r(e,new Array(e.length))},arraybuffer:function(e){return c.nodebuffer.uint8array(e).buffer},uint8array:function(e){return r(e,new Uint8Array(e.length))},nodebuffer:n},i.transformTo=function(e,t){if(t||(t=""),!e)return t;i.checkSupport(e);var n=i.getTypeOf(t),a=c[n][e](t);return a},i.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":s.nodebuffer&&d.test(e)?"nodebuffer":s.uint8array&&e instanceof Uint8Array?"uint8array":s.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(e){var t=s[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this browser")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(e){var t,i,n="";for(i=0;i<(e||"").length;i++)t=e.charCodeAt(i),n+="\\x"+(16>t?"0":"")+t.toString(16).toUpperCase();return n},i.findCompression=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null},i.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t){"use strict";function i(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var n=e("./stringReader"),a=e("./nodeBufferReader"),o=e("./uint8ArrayReader"),r=e("./utils"),s=e("./signature"),l=e("./zipEntry"),d=e("./support"),c=e("./object");i.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+r.pretty(t)+", expected "+r.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=c.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,n=this.zip64EndOfCentralSize-44,a=0;n>a;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===s.CENTRAL_FILE_HEADER;)e=new l({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),-1===e)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");
this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=r.getTypeOf(e);this.reader="string"!==t||d.uint8array?"nodebuffer"===t?new a(e):new o(r.transformTo("uint8array",e)):new n(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=i},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t){"use strict";function i(e,t){this.options=e,this.loadOptions=t}var n=e("./stringReader"),a=e("./utils"),o=e("./compressedObject"),r=e("./object");i.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},prepareCompressedContent:function(e,t,i){return function(){var n=e.index;e.setIndex(t);var a=e.readData(i);return e.setIndex(n),a}},prepareContent:function(e,t,i,n,o){return function(){var e=a.transformTo(n.uncompressInputType,this.getCompressedContent()),t=n.uncompress(e);if(t.length!==o)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,i;if(e.skip(22),this.fileNameLength=e.readInt(2),i=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(i),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(t=a.findCompression(this.compressionMethod),null===t)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new o,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=a.transformTo("string",this.decompressed.getContent()),r.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=16&this.externalFileAttributes?!0:!1},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=new n(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,i,n,a=e.index;for(this.extraFields=this.extraFields||{};e.index<a+this.extraFieldsLength;)t=e.readInt(2),i=e.readInt(2),n=e.readString(i),this.extraFields[t]={id:t,length:i,value:n}},handleUTF8:function(){if(this.useUTF8())this.fileName=r.utf8decode(this.fileName),this.fileComment=r.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:r.crc32(this.fileName)!==t.readInt(4)?null:r.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new n(e.value);return 1!==t.readInt(1)?null:r.crc32(this.fileComment)!==t.readInt(4)?null:r.utf8decode(t.readString(e.length-5))}return null}},t.exports=i},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t){"use strict";var i=e("./lib/utils/common").assign,n=e("./lib/deflate"),a=e("./lib/inflate"),o=e("./lib/zlib/constants"),r={};i(r,n,a,o),t.exports=r},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,i){"use strict";function n(e,t){var i=new y(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}function a(e,t){return t=t||{},t.raw=!0,n(e,t)}function o(e,t){return t=t||{},t.gzip=!0,n(e,t)}var r=e("./zlib/deflate.js"),s=e("./utils/common"),l=e("./utils/strings"),d=e("./zlib/messages"),c=e("./zlib/zstream"),h=0,u=4,g=0,m=1,p=-1,f=0,v=8,y=function(e){this.options=s.assign({level:p,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==g)throw new Error(d[i]);t.header&&r.deflateSetHeader(this.strm,t.header)};y.prototype.push=function(e,t){var i,n,a=this.strm,o=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:t===!0?u:h,a.input="string"==typeof e?l.string2buf(e):e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new s.Buf8(o),a.next_out=0,a.avail_out=o),i=r.deflate(a,n),i!==m&&i!==g)return this.onEnd(i),this.ended=!0,!1;(0===a.avail_out||0===a.avail_in&&n===u)&&this.onData("string"===this.options.to?l.buf2binstring(s.shrinkBuf(a.output,a.next_out)):s.shrinkBuf(a.output,a.next_out))}while((a.avail_in>0||0===a.avail_out)&&i!==m);return n===u?(i=r.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===g):!0},y.prototype.onData=function(e){this.chunks.push(e)},y.prototype.onEnd=function(e){e===g&&(this.result="string"===this.options.to?this.chunks.join(""):s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=y,i.deflate=n,i.deflateRaw=a,i.gzip=o},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,i){"use strict";function n(e,t){var i=new u(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}function a(e,t){return t=t||{},t.raw=!0,n(e,t)}var o=e("./zlib/inflate.js"),r=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/constants"),d=e("./zlib/messages"),c=e("./zlib/zstream"),h=e("./zlib/gzheader"),u=function(e){this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=o.inflateInit2(this.strm,t.windowBits);if(i!==l.Z_OK)throw new Error(d[i]);this.header=new h,o.inflateGetHeader(this.strm,this.header)};u.prototype.push=function(e,t){var i,n,a,d,c,h=this.strm,u=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:t===!0?l.Z_FINISH:l.Z_NO_FLUSH,h.input="string"==typeof e?s.binstring2buf(e):e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new r.Buf8(u),h.next_out=0,h.avail_out=u),i=o.inflate(h,l.Z_NO_FLUSH),i!==l.Z_STREAM_END&&i!==l.Z_OK)return this.onEnd(i),this.ended=!0,!1;h.next_out&&(0===h.avail_out||i===l.Z_STREAM_END||0===h.avail_in&&n===l.Z_FINISH)&&("string"===this.options.to?(a=s.utf8border(h.output,h.next_out),d=h.next_out-a,c=s.buf2string(h.output,a),h.next_out=d,h.avail_out=u-d,d&&r.arraySet(h.output,h.output,a,d,0),this.onData(c)):this.onData(r.shrinkBuf(h.output,h.next_out)))}while(h.avail_in>0&&i!==l.Z_STREAM_END);return i===l.Z_STREAM_END&&(n=l.Z_FINISH),n===l.Z_FINISH?(i=o.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l.Z_OK):!0},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===l.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=u,i.inflate=n,i.inflateRaw=a,i.ungzip=n},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,i,n,a){if(t.subarray&&e.subarray)return void e.set(t.subarray(i,i+n),a);for(var o=0;n>o;o++)e[a+o]=t[i+o]},flattenChunks:function(e){var t,i,n,a,o,r;for(n=0,t=0,i=e.length;i>t;t++)n+=e[t].length;for(r=new Uint8Array(n),a=0,t=0,i=e.length;i>t;t++)o=e[t],r.set(o,a),a+=o.length;return r}},o={arraySet:function(e,t,i,n,a){for(var o=0;n>o;o++)e[a+o]=t[i+o]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(n)},{}],28:[function(e,t,i){"use strict";function n(e,t){if(65537>t&&(e.subarray&&r||!e.subarray&&o))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var i="",n=0;t>n;n++)i+=String.fromCharCode(e[n]);return i}var a=e("./common"),o=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(s){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(s){r=!1}for(var l=new a.Buf8(256),d=0;256>d;d++)l[d]=d>=252?6:d>=248?5:d>=240?4:d>=224?3:d>=192?2:1;l[254]=l[254]=1,i.string2buf=function(e){var t,i,n,o,r,s=e.length,l=0;for(o=0;s>o;o++)i=e.charCodeAt(o),55296===(64512&i)&&s>o+1&&(n=e.charCodeAt(o+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),o++)),l+=128>i?1:2048>i?2:65536>i?3:4;for(t=new a.Buf8(l),r=0,o=0;l>r;o++)i=e.charCodeAt(o),55296===(64512&i)&&s>o+1&&(n=e.charCodeAt(o+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),o++)),128>i?t[r++]=i:2048>i?(t[r++]=192|i>>>6,t[r++]=128|63&i):65536>i?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},i.buf2binstring=function(e){return n(e,e.length)},i.binstring2buf=function(e){for(var t=new a.Buf8(e.length),i=0,n=t.length;n>i;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,a,o,r,s=t||e.length,d=new Array(2*s);for(a=0,i=0;s>i;)if(o=e[i++],128>o)d[a++]=o;else if(r=l[o],r>4)d[a++]=65533,i+=r-1;else{for(o&=2===r?31:3===r?15:7;r>1&&s>i;)o=o<<6|63&e[i++],r--;r>1?d[a++]=65533:65536>o?d[a++]=o:(o-=65536,d[a++]=55296|o>>10&1023,d[a++]=56320|1023&o)}return n(d,a)},i.utf8border=function(e,t){var i;for(t=t||e.length,t>e.length&&(t=e.length),i=t-1;i>=0&&128===(192&e[i]);)i--;return 0>i?t:0===i?t:i+l[e[i]]>t?i:t}},{"./common":27}],29:[function(e,t){"use strict";function i(e,t,i,n){for(var a=65535&e|0,o=e>>>16&65535|0,r=0;0!==i;){r=i>2e3?2e3:i,i-=r;do a=a+t[n++]|0,o=o+a|0;while(--r);a%=65521,o%=65521}return a|o<<16|0}t.exports=i},{}],30:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t){"use strict";function i(){for(var e,t=[],i=0;256>i;i++){e=i;for(var n=0;8>n;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}function n(e,t,i,n){var o=a,r=n+i;e=-1^e;for(var s=n;r>s;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}var a=i();t.exports=n},{}],32:[function(e,t,i){"use strict";function n(e,t){return e.msg=k[t],t}function a(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function r(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(T.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function s(e,t){A._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,r(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function d(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,i,n){var a=e.avail_in;return a>n&&(a=n),0===a?0:(e.avail_in-=a,T.arraySet(t,e.input,e.next_in,a,i),1===e.state.wrap?e.adler=L(e.adler,t,a,i):2===e.state.wrap&&(e.adler=N(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)}function h(e,t){var i,n,a=e.max_chain_length,o=e.strstart,r=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-dt?e.strstart-(e.w_size-dt):0,d=e.window,c=e.w_mask,h=e.prev,u=e.strstart+lt,g=d[o+r-1],m=d[o+r];e.prev_length>=e.good_match&&(a>>=2),s>e.lookahead&&(s=e.lookahead);do if(i=t,d[i+r]===m&&d[i+r-1]===g&&d[i]===d[o]&&d[++i]===d[o+1]){o+=2,i++;do;while(d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&d[++o]===d[++i]&&u>o);if(n=lt-(u-o),o=u-lt,n>r){if(e.match_start=t,r=n,n>=s)break;g=d[o+r-1],m=d[o+r]}}while((t=h[t&c])>l&&0!==--a);return r<=e.lookahead?r:e.lookahead}function u(e){var t,i,n,a,o,r=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-dt)){T.arraySet(e.window,e.window,r,r,0),e.match_start-=r,e.strstart-=r,e.block_start-=r,i=e.hash_size,t=i;do n=e.head[--t],e.head[t]=n>=r?n-r:0;while(--i);i=r,t=i;do n=e.prev[--t],e.prev[t]=n>=r?n-r:0;while(--i);a+=r}if(0===e.strm.avail_in)break;if(i=c(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=i,e.lookahead+e.insert>=st)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+st-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<st)););}while(e.lookahead<dt&&0!==e.strm.avail_in)}function g(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(u(e),0===e.lookahead&&t===O)return yt;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+i;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,s(e,!1),0===e.strm.avail_out))return yt;if(e.strstart-e.block_start>=e.w_size-dt&&(s(e,!1),0===e.strm.avail_out))return yt}return e.insert=0,t===M?(s(e,!0),0===e.strm.avail_out?Ct:wt):e.strstart>e.block_start&&(s(e,!1),0===e.strm.avail_out)?yt:yt}function m(e,t){for(var i,n;;){if(e.lookahead<dt){if(u(e),e.lookahead<dt&&t===O)return yt;if(0===e.lookahead)break}if(i=0,e.lookahead>=st&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+st-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-dt&&(e.match_length=h(e,i)),e.match_length>=st)if(n=A._tr_tally(e,e.strstart-e.match_start,e.match_length-st),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=st){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+st-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(s(e,!1),0===e.strm.avail_out))return yt}return e.insert=e.strstart<st-1?e.strstart:st-1,t===M?(s(e,!0),0===e.strm.avail_out?Ct:wt):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?yt:bt}function p(e,t){for(var i,n,a;;){if(e.lookahead<dt){if(u(e),e.lookahead<dt&&t===O)return yt;if(0===e.lookahead)break}if(i=0,e.lookahead>=st&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+st-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=st-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-dt&&(e.match_length=h(e,i),e.match_length<=5&&(e.strategy===W||e.match_length===st&&e.strstart-e.match_start>4096)&&(e.match_length=st-1)),e.prev_length>=st&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-st,n=A._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-st),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+st-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!==--e.prev_length);if(e.match_available=0,e.match_length=st-1,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return yt}else if(e.match_available){if(n=A._tr_tally(e,0,e.window[e.strstart-1]),n&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return yt}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=A._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<st-1?e.strstart:st-1,t===M?(s(e,!0),0===e.strm.avail_out?Ct:wt):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?yt:bt}function f(e,t){for(var i,n,a,o,r=e.window;;){if(e.lookahead<=lt){if(u(e),e.lookahead<=lt&&t===O)return yt;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=st&&e.strstart>0&&(a=e.strstart-1,n=r[a],n===r[++a]&&n===r[++a]&&n===r[++a])){o=e.strstart+lt;do;while(n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&o>a);e.match_length=lt-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=st?(i=A._tr_tally(e,1,e.match_length-st),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(s(e,!1),0===e.strm.avail_out))return yt}return e.insert=0,t===M?(s(e,!0),0===e.strm.avail_out?Ct:wt):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?yt:bt}function v(e,t){for(var i;;){if(0===e.lookahead&&(u(e),0===e.lookahead)){if(t===O)return yt;break}if(e.match_length=0,i=A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(s(e,!1),0===e.strm.avail_out))return yt}return e.insert=0,t===M?(s(e,!0),0===e.strm.avail_out?Ct:wt):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?yt:bt}function y(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=E[e.level].max_lazy,e.good_match=E[e.level].good_length,e.nice_match=E[e.level].nice_length,e.max_chain_length=E[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=st-1,e.match_available=0,e.ins_h=0}function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new T.Buf16(2*ot),this.dyn_dtree=new T.Buf16(2*(2*nt+1)),this.bl_tree=new T.Buf16(2*(2*at+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new T.Buf16(rt+1),this.heap=new T.Buf16(2*it+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new T.Buf16(2*it+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function C(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=J,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ht:ft,e.adler=2===t.wrap?0:1,t.last_flush=O,A._tr_init(t),U):n(e,z)}function w(e){var t=C(e);return t===U&&y(e.state),t}function S(e,t){return e&&e.state?2!==e.state.wrap?z:(e.state.gzhead=t,U):z}function x(e,t,i,a,o,r){if(!e)return z;var s=1;if(t===G&&(t=6),0>a?(s=0,a=-a):a>15&&(s=2,a-=16),1>o||o>K||i!==q||8>a||a>15||0>t||t>9||0>r||r>X)return n(e,z);8===a&&(a=9);var l=new b;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=a,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+st-1)/st),l.window=new T.Buf8(2*l.w_size),l.head=new T.Buf16(l.hash_size),l.prev=new T.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new T.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=r,l.method=i,w(e)}function I(e,t){return x(e,t,q,Q,$,Z)}function P(e,t){var i,s,c,h;if(!e||!e.state||t>B||0>t)return e?n(e,z):z;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===vt&&t!==M)return n(e,0===e.avail_out?H:z);if(s.strm=e,i=s.last_flush,s.last_flush=t,s.status===ht)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=Y||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=N(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=ut):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=Y||s.level<2?4:0),l(s,St),s.status=ft);else{var u=q+(s.w_bits-8<<4)<<8,g=-1;g=s.strategy>=Y||s.level<2?0:s.level<6?1:6===s.level?2:3,u|=g<<6,0!==s.strstart&&(u|=ct),u+=31-u%31,s.status=ft,d(s,u),0!==s.strstart&&(d(s,e.adler>>>16),d(s,65535&e.adler)),e.adler=1}if(s.status===ut)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=N(e.adler,s.pending_buf,s.pending-c,c)),r(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=N(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=gt)}else s.status=gt;if(s.status===gt)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=N(e.adler,s.pending_buf,s.pending-c,c)),r(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=N(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.gzindex=0,s.status=mt)}else s.status=mt;if(s.status===mt)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=N(e.adler,s.pending_buf,s.pending-c,c)),r(e),c=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>c&&(e.adler=N(e.adler,s.pending_buf,s.pending-c,c)),0===h&&(s.status=pt)}else s.status=pt;if(s.status===pt&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&r(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=ft)):s.status=ft),0!==s.pending){if(r(e),0===e.avail_out)return s.last_flush=-1,U}else if(0===e.avail_in&&a(t)<=a(i)&&t!==M)return n(e,H);if(s.status===vt&&0!==e.avail_in)return n(e,H);if(0!==e.avail_in||0!==s.lookahead||t!==O&&s.status!==vt){var m=s.strategy===Y?v(s,t):s.strategy===j?f(s,t):E[s.level].func(s,t);if((m===Ct||m===wt)&&(s.status=vt),m===yt||m===Ct)return 0===e.avail_out&&(s.last_flush=-1),U;if(m===bt&&(t===D?A._tr_align(s):t!==B&&(A._tr_stored_block(s,0,0,!1),t===R&&(o(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),r(e),0===e.avail_out))return s.last_flush=-1,U}return t!==M?U:s.wrap<=0?F:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(d(s,e.adler>>>16),d(s,65535&e.adler)),r(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?U:F)}function _(e){var t;return e&&e.state?(t=e.state.status,t!==ht&&t!==ut&&t!==gt&&t!==mt&&t!==pt&&t!==ft&&t!==vt?n(e,z):(e.state=null,t===ft?n(e,V):U)):z}var E,T=e("../utils/common"),A=e("./trees"),L=e("./adler32"),N=e("./crc32"),k=e("./messages"),O=0,D=1,R=3,M=4,B=5,U=0,F=1,z=-2,V=-3,H=-5,G=-1,W=1,Y=2,j=3,X=4,Z=0,J=2,q=8,K=9,Q=15,$=8,et=29,tt=256,it=tt+1+et,nt=30,at=19,ot=2*it+1,rt=15,st=3,lt=258,dt=lt+st+1,ct=32,ht=42,ut=69,gt=73,mt=91,pt=103,ft=113,vt=666,yt=1,bt=2,Ct=3,wt=4,St=3,xt=function(e,t,i,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=a};E=[new xt(0,0,0,0,g),new xt(4,4,8,4,m),new xt(4,5,16,8,m),new xt(4,6,32,32,m),new xt(4,4,16,16,p),new xt(8,16,32,32,p),new xt(8,16,128,128,p),new xt(8,32,128,256,p),new xt(32,128,258,1024,p),new xt(32,258,258,4096,p)],i.deflateInit=I,i.deflateInit2=x,i.deflateReset=w,i.deflateResetKeep=C,i.deflateSetHeader=S,i.deflate=P,i.deflateEnd=_,i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t){"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=i},{}],34:[function(e,t){"use strict";var i=30,n=12;t.exports=function(e,t){var a,o,r,s,l,d,c,h,u,g,m,p,f,v,y,b,C,w,S,x,I,P,_,E,T;a=e.state,o=e.next_in,E=e.input,r=o+(e.avail_in-5),s=e.next_out,T=e.output,l=s-(t-e.avail_out),d=s+(e.avail_out-257),c=a.dmax,h=a.wsize,u=a.whave,g=a.wnext,m=a.window,p=a.hold,f=a.bits,v=a.lencode,y=a.distcode,b=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;e:do{15>f&&(p+=E[o++]<<f,f+=8,p+=E[o++]<<f,f+=8),w=v[p&b];t:for(;;){if(S=w>>>24,p>>>=S,f-=S,S=w>>>16&255,0===S)T[s++]=65535&w;else{if(!(16&S)){if(0===(64&S)){w=v[(65535&w)+(p&(1<<S)-1)];continue t}if(32&S){a.mode=n;break e}e.msg="invalid literal/length code",a.mode=i;break e}x=65535&w,S&=15,S&&(S>f&&(p+=E[o++]<<f,f+=8),x+=p&(1<<S)-1,p>>>=S,f-=S),15>f&&(p+=E[o++]<<f,f+=8,p+=E[o++]<<f,f+=8),w=y[p&C];i:for(;;){if(S=w>>>24,p>>>=S,f-=S,S=w>>>16&255,!(16&S)){if(0===(64&S)){w=y[(65535&w)+(p&(1<<S)-1)];continue i}e.msg="invalid distance code",a.mode=i;break e}if(I=65535&w,S&=15,S>f&&(p+=E[o++]<<f,f+=8,S>f&&(p+=E[o++]<<f,f+=8)),I+=p&(1<<S)-1,I>c){e.msg="invalid distance too far back",a.mode=i;break e}if(p>>>=S,f-=S,S=s-l,I>S){if(S=I-S,S>u&&a.sane){e.msg="invalid distance too far back",a.mode=i;break e}if(P=0,_=m,0===g){if(P+=h-S,x>S){x-=S;do T[s++]=m[P++];while(--S);P=s-I,_=T}}else if(S>g){if(P+=h+g-S,S-=g,x>S){x-=S;do T[s++]=m[P++];while(--S);if(P=0,x>g){S=g,x-=S;do T[s++]=m[P++];while(--S);P=s-I,_=T}}}else if(P+=g-S,x>S){x-=S;do T[s++]=m[P++];while(--S);P=s-I,_=T}for(;x>2;)T[s++]=_[P++],T[s++]=_[P++],T[s++]=_[P++],x-=3;x&&(T[s++]=_[P++],x>1&&(T[s++]=_[P++]))}else{P=s-I;do T[s++]=T[P++],T[s++]=T[P++],T[s++]=T[P++],x-=3;while(x>2);x&&(T[s++]=T[P++],x>1&&(T[s++]=T[P++]))}break}}break}}while(r>o&&d>s);x=f>>3,o-=x,f-=x<<3,p&=(1<<f)-1,e.next_in=o,e.next_out=s,e.avail_in=r>o?5+(r-o):5-(o-r),e.avail_out=d>s?257+(d-s):257-(s-d),a.hold=p,a.bits=f}},{}],35:[function(e,t,i){"use strict";function n(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new v.Buf16(320),this.work=new v.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=M,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new v.Buf32(mt),t.distcode=t.distdyn=new v.Buf32(pt),t.sane=1,t.back=-1,T):N}function r(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,o(e)):N}function s(e,t){var i,n;return e&&e.state?(n=e.state,0>t?(i=0,t=-t):(i=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||t>15)?N:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,r(e))):N}function l(e,t){var i,n;return e?(n=new a,e.state=n,n.window=null,i=s(e,t),i!==T&&(e.state=null),i):N}function d(e){return l(e,vt)}function c(e){if(yt){var t;for(p=new v.Buf32(512),f=new v.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(w(x,e.lens,0,288,p,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;w(I,e.lens,0,32,f,0,e.work,{bits:5}),yt=!1}e.lencode=p,e.lenbits=9,e.distcode=f,e.distbits=5}function h(e,t,i,n){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new v.Buf8(o.wsize)),n>=o.wsize?(v.arraySet(o.window,t,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(a=o.wsize-o.wnext,a>n&&(a=n),v.arraySet(o.window,t,i-n,a,o.wnext),n-=a,n?(v.arraySet(o.window,t,i-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}function u(e,t){var i,a,o,r,s,l,d,u,g,m,p,f,mt,pt,ft,vt,yt,bt,Ct,wt,St,xt,It,Pt,_t=0,Et=new v.Buf8(4),Tt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return N;i=e.state,i.mode===X&&(i.mode=Z),s=e.next_out,o=e.output,d=e.avail_out,r=e.next_in,a=e.input,l=e.avail_in,u=i.hold,g=i.bits,m=l,p=d,xt=T;e:for(;;)switch(i.mode){case M:if(0===i.wrap){i.mode=Z;break}for(;16>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if(2&i.wrap&&35615===u){i.check=0,Et[0]=255&u,Et[1]=u>>>8&255,i.check=b(i.check,Et,2,0),u=0,g=0,i.mode=B;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",i.mode=ht;break}if((15&u)!==R){e.msg="unknown compression method",i.mode=ht;break}if(u>>>=4,g-=4,St=(15&u)+8,0===i.wbits)i.wbits=St;else if(St>i.wbits){e.msg="invalid window size",i.mode=ht;break}i.dmax=1<<St,e.adler=i.check=1,i.mode=512&u?Y:X,u=0,g=0;break;case B:for(;16>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if(i.flags=u,(255&i.flags)!==R){e.msg="unknown compression method",i.mode=ht;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=ht;break}i.head&&(i.head.text=u>>8&1),512&i.flags&&(Et[0]=255&u,Et[1]=u>>>8&255,i.check=b(i.check,Et,2,0)),u=0,g=0,i.mode=U;case U:for(;32>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}i.head&&(i.head.time=u),512&i.flags&&(Et[0]=255&u,Et[1]=u>>>8&255,Et[2]=u>>>16&255,Et[3]=u>>>24&255,i.check=b(i.check,Et,4,0)),u=0,g=0,i.mode=F;
case F:for(;16>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}i.head&&(i.head.xflags=255&u,i.head.os=u>>8),512&i.flags&&(Et[0]=255&u,Et[1]=u>>>8&255,i.check=b(i.check,Et,2,0)),u=0,g=0,i.mode=z;case z:if(1024&i.flags){for(;16>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}i.length=u,i.head&&(i.head.extra_len=u),512&i.flags&&(Et[0]=255&u,Et[1]=u>>>8&255,i.check=b(i.check,Et,2,0)),u=0,g=0}else i.head&&(i.head.extra=null);i.mode=V;case V:if(1024&i.flags&&(f=i.length,f>l&&(f=l),f&&(i.head&&(St=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),v.arraySet(i.head.extra,a,r,f,St)),512&i.flags&&(i.check=b(i.check,a,f,r)),l-=f,r+=f,i.length-=f),i.length))break e;i.length=0,i.mode=H;case H:if(2048&i.flags){if(0===l)break e;f=0;do St=a[r+f++],i.head&&St&&i.length<65536&&(i.head.name+=String.fromCharCode(St));while(St&&l>f);if(512&i.flags&&(i.check=b(i.check,a,f,r)),l-=f,r+=f,St)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=G;case G:if(4096&i.flags){if(0===l)break e;f=0;do St=a[r+f++],i.head&&St&&i.length<65536&&(i.head.comment+=String.fromCharCode(St));while(St&&l>f);if(512&i.flags&&(i.check=b(i.check,a,f,r)),l-=f,r+=f,St)break e}else i.head&&(i.head.comment=null);i.mode=W;case W:if(512&i.flags){for(;16>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if(u!==(65535&i.check)){e.msg="header crc mismatch",i.mode=ht;break}u=0,g=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=X;break;case Y:for(;32>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}e.adler=i.check=n(u),u=0,g=0,i.mode=j;case j:if(0===i.havedict)return e.next_out=s,e.avail_out=d,e.next_in=r,e.avail_in=l,i.hold=u,i.bits=g,L;e.adler=i.check=1,i.mode=X;case X:if(t===_||t===E)break e;case Z:if(i.last){u>>>=7&g,g-=7&g,i.mode=lt;break}for(;3>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}switch(i.last=1&u,u>>>=1,g-=1,3&u){case 0:i.mode=J;break;case 1:if(c(i),i.mode=tt,t===E){u>>>=2,g-=2;break e}break;case 2:i.mode=Q;break;case 3:e.msg="invalid block type",i.mode=ht}u>>>=2,g-=2;break;case J:for(u>>>=7&g,g-=7&g;32>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if((65535&u)!==(u>>>16^65535)){e.msg="invalid stored block lengths",i.mode=ht;break}if(i.length=65535&u,u=0,g=0,i.mode=q,t===E)break e;case q:i.mode=K;case K:if(f=i.length){if(f>l&&(f=l),f>d&&(f=d),0===f)break e;v.arraySet(o,a,r,f,s),l-=f,r+=f,d-=f,s+=f,i.length-=f;break}i.mode=X;break;case Q:for(;14>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if(i.nlen=(31&u)+257,u>>>=5,g-=5,i.ndist=(31&u)+1,u>>>=5,g-=5,i.ncode=(15&u)+4,u>>>=4,g-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=ht;break}i.have=0,i.mode=$;case $:for(;i.have<i.ncode;){for(;3>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}i.lens[Tt[i.have++]]=7&u,u>>>=3,g-=3}for(;i.have<19;)i.lens[Tt[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,It={bits:i.lenbits},xt=w(S,i.lens,0,19,i.lencode,0,i.work,It),i.lenbits=It.bits,xt){e.msg="invalid code lengths set",i.mode=ht;break}i.have=0,i.mode=et;case et:for(;i.have<i.nlen+i.ndist;){for(;_t=i.lencode[u&(1<<i.lenbits)-1],ft=_t>>>24,vt=_t>>>16&255,yt=65535&_t,!(g>=ft);){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if(16>yt)u>>>=ft,g-=ft,i.lens[i.have++]=yt;else{if(16===yt){for(Pt=ft+2;Pt>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if(u>>>=ft,g-=ft,0===i.have){e.msg="invalid bit length repeat",i.mode=ht;break}St=i.lens[i.have-1],f=3+(3&u),u>>>=2,g-=2}else if(17===yt){for(Pt=ft+3;Pt>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}u>>>=ft,g-=ft,St=0,f=3+(7&u),u>>>=3,g-=3}else{for(Pt=ft+7;Pt>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}u>>>=ft,g-=ft,St=0,f=11+(127&u),u>>>=7,g-=7}if(i.have+f>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=ht;break}for(;f--;)i.lens[i.have++]=St}}if(i.mode===ht)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=ht;break}if(i.lenbits=9,It={bits:i.lenbits},xt=w(x,i.lens,0,i.nlen,i.lencode,0,i.work,It),i.lenbits=It.bits,xt){e.msg="invalid literal/lengths set",i.mode=ht;break}if(i.distbits=6,i.distcode=i.distdyn,It={bits:i.distbits},xt=w(I,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,It),i.distbits=It.bits,xt){e.msg="invalid distances set",i.mode=ht;break}if(i.mode=tt,t===E)break e;case tt:i.mode=it;case it:if(l>=6&&d>=258){e.next_out=s,e.avail_out=d,e.next_in=r,e.avail_in=l,i.hold=u,i.bits=g,C(e,p),s=e.next_out,o=e.output,d=e.avail_out,r=e.next_in,a=e.input,l=e.avail_in,u=i.hold,g=i.bits,i.mode===X&&(i.back=-1);break}for(i.back=0;_t=i.lencode[u&(1<<i.lenbits)-1],ft=_t>>>24,vt=_t>>>16&255,yt=65535&_t,!(g>=ft);){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if(vt&&0===(240&vt)){for(bt=ft,Ct=vt,wt=yt;_t=i.lencode[wt+((u&(1<<bt+Ct)-1)>>bt)],ft=_t>>>24,vt=_t>>>16&255,yt=65535&_t,!(g>=bt+ft);){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}u>>>=bt,g-=bt,i.back+=bt}if(u>>>=ft,g-=ft,i.back+=ft,i.length=yt,0===vt){i.mode=st;break}if(32&vt){i.back=-1,i.mode=X;break}if(64&vt){e.msg="invalid literal/length code",i.mode=ht;break}i.extra=15&vt,i.mode=nt;case nt:if(i.extra){for(Pt=i.extra;Pt>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}i.length+=u&(1<<i.extra)-1,u>>>=i.extra,g-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=at;case at:for(;_t=i.distcode[u&(1<<i.distbits)-1],ft=_t>>>24,vt=_t>>>16&255,yt=65535&_t,!(g>=ft);){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if(0===(240&vt)){for(bt=ft,Ct=vt,wt=yt;_t=i.distcode[wt+((u&(1<<bt+Ct)-1)>>bt)],ft=_t>>>24,vt=_t>>>16&255,yt=65535&_t,!(g>=bt+ft);){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}u>>>=bt,g-=bt,i.back+=bt}if(u>>>=ft,g-=ft,i.back+=ft,64&vt){e.msg="invalid distance code",i.mode=ht;break}i.offset=yt,i.extra=15&vt,i.mode=ot;case ot:if(i.extra){for(Pt=i.extra;Pt>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}i.offset+=u&(1<<i.extra)-1,u>>>=i.extra,g-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=ht;break}i.mode=rt;case rt:if(0===d)break e;if(f=p-d,i.offset>f){if(f=i.offset-f,f>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=ht;break}f>i.wnext?(f-=i.wnext,mt=i.wsize-f):mt=i.wnext-f,f>i.length&&(f=i.length),pt=i.window}else pt=o,mt=s-i.offset,f=i.length;f>d&&(f=d),d-=f,i.length-=f;do o[s++]=pt[mt++];while(--f);0===i.length&&(i.mode=it);break;case st:if(0===d)break e;o[s++]=i.length,d--,i.mode=it;break;case lt:if(i.wrap){for(;32>g;){if(0===l)break e;l--,u|=a[r++]<<g,g+=8}if(p-=d,e.total_out+=p,i.total+=p,p&&(e.adler=i.check=i.flags?b(i.check,o,p,s-p):y(i.check,o,p,s-p)),p=d,(i.flags?u:n(u))!==i.check){e.msg="incorrect data check",i.mode=ht;break}u=0,g=0}i.mode=dt;case dt:if(i.wrap&&i.flags){for(;32>g;){if(0===l)break e;l--,u+=a[r++]<<g,g+=8}if(u!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=ht;break}u=0,g=0}i.mode=ct;case ct:xt=A;break e;case ht:xt=k;break e;case ut:return O;case gt:default:return N}return e.next_out=s,e.avail_out=d,e.next_in=r,e.avail_in=l,i.hold=u,i.bits=g,(i.wsize||p!==e.avail_out&&i.mode<ht&&(i.mode<lt||t!==P))&&h(e,e.output,e.next_out,p-e.avail_out)?(i.mode=ut,O):(m-=e.avail_in,p-=e.avail_out,e.total_in+=m,e.total_out+=p,i.total+=p,i.wrap&&p&&(e.adler=i.check=i.flags?b(i.check,o,p,e.next_out-p):y(i.check,o,p,e.next_out-p)),e.data_type=i.bits+(i.last?64:0)+(i.mode===X?128:0)+(i.mode===tt||i.mode===q?256:0),(0===m&&0===p||t===P)&&xt===T&&(xt=D),xt)}function g(e){if(!e||!e.state)return N;var t=e.state;return t.window&&(t.window=null),e.state=null,T}function m(e,t){var i;return e&&e.state?(i=e.state,0===(2&i.wrap)?N:(i.head=t,t.done=!1,T)):N}var p,f,v=e("../utils/common"),y=e("./adler32"),b=e("./crc32"),C=e("./inffast"),w=e("./inftrees"),S=0,x=1,I=2,P=4,_=5,E=6,T=0,A=1,L=2,N=-2,k=-3,O=-4,D=-5,R=8,M=1,B=2,U=3,F=4,z=5,V=6,H=7,G=8,W=9,Y=10,j=11,X=12,Z=13,J=14,q=15,K=16,Q=17,$=18,et=19,tt=20,it=21,nt=22,at=23,ot=24,rt=25,st=26,lt=27,dt=28,ct=29,ht=30,ut=31,gt=32,mt=852,pt=592,ft=15,vt=ft,yt=!0;i.inflateReset=r,i.inflateReset2=s,i.inflateResetKeep=o,i.inflateInit=d,i.inflateInit2=l,i.inflate=u,i.inflateEnd=g,i.inflateGetHeader=m,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t){"use strict";var i=e("../utils/common"),n=15,a=852,o=592,r=0,s=1,l=2,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,g,m,p,f,v,y){var b,C,w,S,x,I,P,_,E,T=y.bits,A=0,L=0,N=0,k=0,O=0,D=0,R=0,M=0,B=0,U=0,F=null,z=0,V=new i.Buf16(n+1),H=new i.Buf16(n+1),G=null,W=0;for(A=0;n>=A;A++)V[A]=0;for(L=0;m>L;L++)V[t[g+L]]++;for(O=T,k=n;k>=1&&0===V[k];k--);if(O>k&&(O=k),0===k)return p[f++]=20971520,p[f++]=20971520,y.bits=1,0;for(N=1;k>N&&0===V[N];N++);for(N>O&&(O=N),M=1,A=1;n>=A;A++)if(M<<=1,M-=V[A],0>M)return-1;if(M>0&&(e===r||1!==k))return-1;for(H[1]=0,A=1;n>A;A++)H[A+1]=H[A]+V[A];for(L=0;m>L;L++)0!==t[g+L]&&(v[H[t[g+L]]++]=L);if(e===r?(F=G=v,I=19):e===s?(F=d,z-=257,G=c,W-=257,I=256):(F=h,G=u,I=-1),U=0,L=0,A=N,x=f,D=O,R=0,w=-1,B=1<<O,S=B-1,e===s&&B>a||e===l&&B>o)return 1;for(var Y=0;;){Y++,P=A-R,v[L]<I?(_=0,E=v[L]):v[L]>I?(_=G[W+v[L]],E=F[z+v[L]]):(_=96,E=0),b=1<<A-R,C=1<<D,N=C;do C-=b,p[x+(U>>R)+C]=P<<24|_<<16|E|0;while(0!==C);for(b=1<<A-1;U&b;)b>>=1;if(0!==b?(U&=b-1,U+=b):U=0,L++,0===--V[A]){if(A===k)break;A=t[g+v[L]]}if(A>O&&(U&S)!==w){for(0===R&&(R=O),x+=N,D=A-R,M=1<<D;k>D+R&&(M-=V[D+R],!(0>=M));)D++,M<<=1;if(B+=1<<D,e===s&&B>a||e===l&&B>o)return 1;w=U&S,p[w]=O<<24|D<<16|x-f|0}}return 0!==U&&(p[x+U]=A-R<<24|64<<16|0),y.bits=O,0}},{"../utils/common":27}],37:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,i){"use strict";function n(e){for(var t=e.length;--t>=0;)e[t]=0}function a(e){return 256>e?rt[e]:rt[256+(e>>>7)]}function o(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function r(e,t,i){e.bi_valid>X-i?(e.bi_buf|=t<<e.bi_valid&65535,o(e,e.bi_buf),e.bi_buf=t>>X-e.bi_valid,e.bi_valid+=i-X):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function s(e,t,i){r(e,i[2*t],i[2*t+1])}function l(e,t){var i=0;do i|=1&e,e>>>=1,i<<=1;while(--t>0);return i>>>1}function d(e){16===e.bi_valid?(o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function c(e,t){var i,n,a,o,r,s,l=t.dyn_tree,d=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,u=t.stat_desc.extra_bits,g=t.stat_desc.extra_base,m=t.stat_desc.max_length,p=0;for(o=0;j>=o;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;Y>i;i++)n=e.heap[i],o=l[2*l[2*n+1]+1]+1,o>m&&(o=m,p++),l[2*n+1]=o,n>d||(e.bl_count[o]++,r=0,n>=g&&(r=u[n-g]),s=l[2*n],e.opt_len+=s*(o+r),h&&(e.static_len+=s*(c[2*n+1]+r)));if(0!==p){do{for(o=m-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[m]--,p-=2}while(p>0);for(o=m;0!==o;o--)for(n=e.bl_count[o];0!==n;)a=e.heap[--i],a>d||(l[2*a+1]!==o&&(e.opt_len+=(o-l[2*a+1])*l[2*a],l[2*a+1]=o),n--)}}function h(e,t,i){var n,a,o=new Array(j+1),r=0;for(n=1;j>=n;n++)o[n]=r=r+i[n-1]<<1;for(a=0;t>=a;a++){var s=e[2*a+1];0!==s&&(e[2*a]=l(o[s]++,s))}}function u(){var e,t,i,n,a,o=new Array(j+1);for(i=0,n=0;z-1>n;n++)for(lt[n]=i,e=0;e<1<<$[n];e++)st[i++]=n;for(st[i-1]=n,a=0,n=0;16>n;n++)for(dt[n]=a,e=0;e<1<<et[n];e++)rt[a++]=n;for(a>>=7;G>n;n++)for(dt[n]=a<<7,e=0;e<1<<et[n]-7;e++)rt[256+a++]=n;for(t=0;j>=t;t++)o[t]=0;for(e=0;143>=e;)at[2*e+1]=8,e++,o[8]++;for(;255>=e;)at[2*e+1]=9,e++,o[9]++;for(;279>=e;)at[2*e+1]=7,e++,o[7]++;for(;287>=e;)at[2*e+1]=8,e++,o[8]++;for(h(at,H+1,o),e=0;G>e;e++)ot[2*e+1]=5,ot[2*e]=l(e,5);ct=new gt(at,$,V+1,H,j),ht=new gt(ot,et,0,G,j),ut=new gt(new Array(0),tt,0,W,Z)}function g(e){var t;for(t=0;H>t;t++)e.dyn_ltree[2*t]=0;for(t=0;G>t;t++)e.dyn_dtree[2*t]=0;for(t=0;W>t;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*J]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function m(e){e.bi_valid>8?o(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function p(e,t,i,n){m(e),n&&(o(e,i),o(e,~i)),L.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}function f(e,t,i,n){var a=2*t,o=2*i;return e[a]<e[o]||e[a]===e[o]&&n[t]<=n[i]}function v(e,t,i){for(var n=e.heap[i],a=i<<1;a<=e.heap_len&&(a<e.heap_len&&f(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!f(t,n,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=n}function y(e,t,i){var n,o,l,d,c=0;if(0!==e.last_lit)do n=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],o=e.pending_buf[e.l_buf+c],c++,0===n?s(e,o,t):(l=st[o],s(e,l+V+1,t),d=$[l],0!==d&&(o-=lt[l],r(e,o,d)),n--,l=a(n),s(e,l,i),d=et[l],0!==d&&(n-=dt[l],r(e,n,d)));while(c<e.last_lit);s(e,J,t)}function b(e,t){var i,n,a,o=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=Y,i=0;l>i;i++)0!==o[2*i]?(e.heap[++e.heap_len]=d=i,e.depth[i]=0):o[2*i+1]=0;for(;e.heap_len<2;)a=e.heap[++e.heap_len]=2>d?++d:0,o[2*a]=1,e.depth[a]=0,e.opt_len--,s&&(e.static_len-=r[2*a+1]);for(t.max_code=d,i=e.heap_len>>1;i>=1;i--)v(e,o,i);a=l;do i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],v(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=n,o[2*a]=o[2*i]+o[2*n],e.depth[a]=(e.depth[i]>=e.depth[n]?e.depth[i]:e.depth[n])+1,o[2*i+1]=o[2*n+1]=a,e.heap[1]=a++,v(e,o,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],c(e,t),h(o,d,e.bl_count)}function C(e,t,i){var n,a,o=-1,r=t[1],s=0,l=7,d=4;for(0===r&&(l=138,d=3),t[2*(i+1)+1]=65535,n=0;i>=n;n++)a=r,r=t[2*(n+1)+1],++s<l&&a===r||(d>s?e.bl_tree[2*a]+=s:0!==a?(a!==o&&e.bl_tree[2*a]++,e.bl_tree[2*q]++):10>=s?e.bl_tree[2*K]++:e.bl_tree[2*Q]++,s=0,o=a,0===r?(l=138,d=3):a===r?(l=6,d=3):(l=7,d=4))}function w(e,t,i){var n,a,o=-1,l=t[1],d=0,c=7,h=4;for(0===l&&(c=138,h=3),n=0;i>=n;n++)if(a=l,l=t[2*(n+1)+1],!(++d<c&&a===l)){if(h>d){do s(e,a,e.bl_tree);while(0!==--d)}else 0!==a?(a!==o&&(s(e,a,e.bl_tree),d--),s(e,q,e.bl_tree),r(e,d-3,2)):10>=d?(s(e,K,e.bl_tree),r(e,d-3,3)):(s(e,Q,e.bl_tree),r(e,d-11,7));d=0,o=a,0===l?(c=138,h=3):a===l?(c=6,h=3):(c=7,h=4)}}function S(e){var t;for(C(e,e.dyn_ltree,e.l_desc.max_code),C(e,e.dyn_dtree,e.d_desc.max_code),b(e,e.bl_desc),t=W-1;t>=3&&0===e.bl_tree[2*it[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function x(e,t,i,n){var a;for(r(e,t-257,5),r(e,i-1,5),r(e,n-4,4),a=0;n>a;a++)r(e,e.bl_tree[2*it[a]+1],3);w(e,e.dyn_ltree,t-1),w(e,e.dyn_dtree,i-1)}function I(e){var t,i=4093624447;for(t=0;31>=t;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return k;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return O;for(t=32;V>t;t++)if(0!==e.dyn_ltree[2*t])return O;return k}function P(e){pt||(u(),pt=!0),e.l_desc=new mt(e.dyn_ltree,ct),e.d_desc=new mt(e.dyn_dtree,ht),e.bl_desc=new mt(e.bl_tree,ut),e.bi_buf=0,e.bi_valid=0,g(e)}function _(e,t,i,n){r(e,(R<<1)+(n?1:0),3),p(e,t,i,!0)}function E(e){r(e,M<<1,3),s(e,J,at),d(e)}function T(e,t,i,n){var a,o,s=0;e.level>0?(e.strm.data_type===D&&(e.strm.data_type=I(e)),b(e,e.l_desc),b(e,e.d_desc),s=S(e),a=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,a>=o&&(a=o)):a=o=i+5,a>=i+4&&-1!==t?_(e,t,i,n):e.strategy===N||o===a?(r(e,(M<<1)+(n?1:0),3),y(e,at,ot)):(r(e,(B<<1)+(n?1:0),3),x(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),y(e,e.dyn_ltree,e.dyn_dtree)),g(e),n&&m(e)}function A(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(st[i]+V+1)]++,e.dyn_dtree[2*a(t)]++),e.last_lit===e.lit_bufsize-1}var L=e("../utils/common"),N=4,k=0,O=1,D=2,R=0,M=1,B=2,U=3,F=258,z=29,V=256,H=V+1+z,G=30,W=19,Y=2*H+1,j=15,X=16,Z=7,J=256,q=16,K=17,Q=18,$=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],et=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],tt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],it=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],nt=512,at=new Array(2*(H+2));n(at);var ot=new Array(2*G);n(ot);var rt=new Array(nt);n(rt);var st=new Array(F-U+1);n(st);var lt=new Array(z);n(lt);var dt=new Array(G);n(dt);var ct,ht,ut,gt=function(e,t,i,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=a,this.has_stree=e&&e.length},mt=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},pt=!1;i._tr_init=P,i._tr_stored_block=_,i._tr_flush_block=T,i._tr_tally=A,i._tr_align=E},{"../utils/common":27}],39:[function(e,t){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i},{}]},{},[9])(9)}),OUTLINE_SHAPE="dshape",WALL_INNER_PATH="wallInnerPic",WALL_OUTER_PATH="wallOuterPic",WALL_CLOSED="shapenode.closed",WALL_SIZE="size",POLE_IMAGE_PATH="poleTexture",USE_TEXTURE="useTexture",OUTFRAME_IMAGE_PATH="framePic",POLE_SEGMENTS="poleSegments",IS_INNER_WALL="isInnerWall",BELONG_ID="edgeIndex",BLOCK_OFFSET="offset",IMAGE_SRC="picture",SPACE_POS_Y="positionY",SPACE_SIZE="size",BTYPE="bType",GID="gid",OID="oid",SPACE_POSITION="position",SHAPE_TYPE="className",DESIGN_SCALE="oscale",SPACE_SCALE="scale",SPACE_ROTATION="rot",SIZE_LENGTH="length",SIZE_DEPTH="depth",SIZE_HEIGHT="height",TEXTURE="texture",PRIMITIVE_NAME="primitiveName",HOST_NODE_ID="hostNodeId",FLOOR_HEIGHT="floorHeight",BID="businessId",GENERAL="General",CUSTOM_PROPS="customProps",SPE_STR="specularStrength",TRA_PAR="transparent",OPA="opacity",ANGLE="angle",MAIN_VISIBLE="mainVisible",LIB_PRIMITIVES="primitivesLib",LIB_ASSEMBLES="assemblesLib",LIB_GRAPH="graphLib",LIB_COMPONENTS="componentLib",TAG_ANIMATION="animation",FLOOR_NAME="floorName",FLOOR_HEIGHT="floorHeight",FLOOR_VISIBLE="floorVisible",FLOOR_REF="floorRef",FLOOR_LAYER="floorLayer",PATH="path",SEGMENTSH="segmentsH",SEGMENTSR="segmentsR",ARC="arc",START_CLOSED="startClosed",END_CLOSED="endClosed",VERTICES="vertices",FACES="faces",UVS="uvs",LOAD_RESOURCE_TYPE="loadResource",CLOUD_KEY="cloudKey",CLOUD_PASSWORD="cloudPassword",TYPE_LOCAL="local",TYPE_CLOUD="cloud",MONO_URL="https://mono-design.cn/api",MONO_URL_LOGIN="https://mono-design.cn/login",MONO_URL_LOGOUT="https://mono-design.cn/logout",SHOW_FLOOR="showFloor",ALL_VIEW_SELECTABLE="allViewSelectable",AMBIENT_LIGHT_ON="ambientLightOn",AMBIENT_LIGHT_COLOR="ambientLightColor",POINT_LIGHT_ON="pointLightOn",POINT_LIGHT_POSITION="pointLightPosition",POINT_LIGHT_COLOR="pointLightColor",POINT_LIGHT_INTENSITY="pointLightIntensity",POINT_LIGHT_ON1="pointLightOn1",POINT_LIGHT_POSITION1="pointLightPosition1",POINT_LIGHT_COLOR1="pointLightColor1",POINT_LIGHT_INTENSITY1="pointLightIntensity1",POINT_LIGHT_ON2="pointLightOn2",POINT_LIGHT_POSITION2="pointLightPosition2",POINT_LIGHT_COLOR2="pointLightColor2",POINT_LIGHT_INTENSITY2="pointLightIntensity2",POINT_LIGHT_ON3="pointLightOn3",POINT_LIGHT_POSITION3="pointLightPosition3",POINT_LIGHT_COLOR3="pointLightColor3",POINT_LIGHT_INTENSITY3="pointLightIntensity3",POINT_LIGHT_ON4="pointLightOn4",POINT_LIGHT_POSITION4="pointLightPosition4",POINT_LIGHT_COLOR4="pointLightColor4",POINT_LIGHT_INTENSITY4="pointLightIntensity4",POINT_LIGHT_ON5="pointLightOn5",POINT_LIGHT_POSITION5="pointLightPosition5",POINT_LIGHT_COLOR5="pointLightColor5",POINT_LIGHT_INTENSITY5="pointLightIntensity5",SHOW_PROPERTY_SHEET="showPropertySheet",SHOW_AXIS="showAxis",SHOW_AXIS_TEXT="showAxisText",SHOW_DIM="showDim",SHOW_COORD="showCoord",SHOW_TARGET_FLAG="showTargetFlag",SHOW_GRID="showGrid",GRID_GAP="gridGap",SNAPGRID="snapGrid",DECIMAL_NUMBER="decimalNumber",IS_FULL_ROTATION="isFullRotation",IS_FULL_ROTATION_COMPONENT="isFullRotationComponent",ZOOM_SPEED="zoomSpeed",ROTATE_SPEED="rotateSpeed",PAN_SPEED="panSpeed",MAX_DISTANCE="maxDistance",MIN_DISTANCE="minDistance",ZOOM_SPEED_COMPONENT="zoomSpeedComponent",ROTATE_SPEED_COMPONENT="rotateSpeedComponent",PAN_SPEED_COMPONENT="panSpeedComponent",MAX_DISTANCE_COMPONENT="maxDistanceComponent",MIN_DISTANCE_COMPONENT="minDistanceComponent",SHOW_ORIGINAL_FLAG="showOriginalFlag",SCALE_MIN_LIMIT="scaleMinLimit",SCALE_MAX_LIMIT="scaleMaxLimit",ENABLE_SCALE="enableScale",COMPONENT_TEMPLATES="componentTemplates",PUBLIC_TEMPLATES="Public Templates",TEMPLATES="Private Templates",ROOMS="Rooms",SUBTITLE_ROOM="Room",SUBTITLE_COMPONENT="Component",SUBTITLE_MODEL="Model",DEFALUT_POINTS_SHAPE="-200,0,-200,200,0,-200,200,0,200,-200,0,200",PropertyConsts={ROOM_PRIVATE_CATEGORY:"roomPrivateCategory",ROOM_PUBLIC_CATEGORY:"roomPublicCategory",COMPONENT_PRIVATE_CATEGORY:"componentPrivateCategory",COMPONENT_PUBLIC_CATEGORY:"componentPublicCategory",SCOPE_PRIMITIVE:0,SCOPE_PUBLIC:1,Font:{fontFamily:["gentilis","helvetiker","optimer"],fontStyle:["bold","normal"]},WRAPMODE:["six-each","front-other","back-other","left-other","right-other","top-other","bottom-other"],CUSTOM_PROPS:["p1","p2","p3","p4"],FloorStyle:{BUFFER_NODE_FLOOR:"Half Transparent",PLANE_FLOOR:"Wireframe"},FloorSize:{SMALL:"Small",MEDIUM:"Medium",LARGE:"Large"},LocalStorage:{FLOOR_STYLE:"floorStyle",FLOOR_SIZE:"floorSize",SELECT_STYLE:"selectStyle"},COMPONENTFLOOR:"componentFloor",MONO_KEY:"mono2025",MONO_IMG_PRE:"https://mono-design.cn/",MONO_URL_PRE:"https://mono-design.cn/",TYPE_ROOMS:"rooms",TYPE_COMPONENT:"component",TYPE_ROOTCATEGORY:"rootCategory",DEFAULT_IMAGE:"crash.png",NEAR_PLANE:"nearPlane",FAR_PLANE:"farPlane",FOV:"fov",NEAR_PLANE_COMPONENT:"nearPlaneComponent",FAR_PLANE_COMPONENT:"farPlaneComponent",FOV_COMPONENT:"fovComponent",ORDER_BY_ASC:0,ORDER_BY_DESC:1,LINK_STYPE:["","orthogonal.x","orthogonal.x.n","orthogonal.y","orthogonal.y.n","orthogonal.z","orthogonal.z.n","control"],SELECT_STYLE:{WIREFRAME:"wireframe",NORMAL:"normal",BORDER:"border"},Layer:{WALL:"Wall",FLOOR:"Floor",WINDOW:"Window",DOOR:"Door",PIPE:"Pipe",BILLBOARD:"Billboard",TEMPLATE:"Template",DEFAULT:"default"},LAYERID:"layerId",ENABLE_EASING:"enableEasing",TEMPLATE_AUTHOR:"templateAuthor",SHOW_RULER_GUIDES:"showRulerGuides",SHOW_RULER:"showRuler",SCALE_UNIT_TEXT:"scaleUnitText"},AccordionPane=function(){this.categoryMap={},this.subTitleDiv={},this.itemDataDiv=[],this.categoryButtonMap={},this.refreshButtonMap={},this.titleIdMap={},this.accordion=new MyAccordion,this.isEdit=!1,this.validateCategoryMap={},this.modelManager,this.titleMultiSteps={},this.init()},twaver.Util.ext("AccordionPane",Object,{_refreshFunction:null,_removeItemFunction:null,_clearTemplateFunction:null,init:function(){var e=this;this.accordion.getView().setAttribute("class","edit_accordion"),this.accordion.setTitleHeight(35),this.accordion.setCollapseIcon("images/collapse.png"),this.accordion.setExpandIcon("images/expand.png"),this.accordion.setBorderBottomColor("#c0beaa"),this.accordion.setTitleBackground("#f1f2f3"),this.validateCategoryMap[TEMPLATES]=!0,this.validateCategoryMap[PUBLIC_TEMPLATES]=!0,this.accordion.onExpanded=function(t){e.validateCategoryMap[t]&&setTimeout(function(){e._refreshCategory(t)},100)}},getRefreshFunction:function(){return this._refreshFunction},setRefreshFunction:function(e){this._refreshFunction=e},getRemoveItemFunction:function(){return this._removeItemFunction},setRemoveItemFunction:function(e){this._removeItemFunction=e},getClearTemplateFunction:function(){return this._clearTemplateFunction},setClearTemplateFunction:function(e){this._clearTemplateFunction=e},setModelManager:function(e){this.modelManager=e},getAllCategory:function(){var e=[];for(var t in this.categoryMap)e.push(t);return e},getSubTitlesByCategory:function(e){var t=[];for(var i in this.subTitleDiv)if(i.startsWith(e+":")){var n=i.substring((e+":").length,i.length);t.push(n)}return t},addCategory:function(e,t,i){var n=this;if(!this.accordion._titleMap[e]){var a=document.createElement("div");a.setAttribute("id",e),a.style.overflow="auto",this.refreshButtonMap[e]=i,t&&n._addButtonsByCategory(e,a),this.categoryMap[e]=a,this.categoryButtonMap[e]=t,this.accordion.add(e,a)}},_addButtonsByCategory:function(e,t){var i=this,n=document.createElement("div");n.style.position="fixed",n.style.width="286px",n.style.background="#ffffff";var a=document.createElement("div");a.setAttribute("id",e+"button"),n.appendChild(a),t.insertBefore(n,t.firstChild),t||(t=document.getElementById(e));var o=document.createElement("button");o.setAttribute("class","accordion_refresh"),o.title="Refresh",o.onclick=function(){i._refreshCategory(e)};var r=document.createElement("a");if(r.appendChild(o),a.appendChild(r),!this.refreshButtonMap[e]){var s=i.isEdit?"block":"none",l=document.createElement("button");l.setAttribute("class","accordion_remove"),l.title="Remove Selected",l.style.display=s,l.onclick=function(){if(confirm("Sure to Remove Selected Templates?"))for(var e=i.getAllCheckedItems(),t=0;t<e.length;t++){var n=e[t];i.removeItemData(n),i._removeItemFunction(n)}};var r=document.createElement("a");r.appendChild(l),a.appendChild(r);var d=document.createElement("span");d.innerHTML=i.isEdit?"Done":"Edit",d.setAttribute("class","accordion_edit"),d.onclick=function(){i.isEdit=!i.isEdit,i._refreshCategory(e),i.toggleEditButton(i.isEdit,this,l)};var r=document.createElement("a");r.appendChild(d),a.appendChild(r)}},toggleEditButton:function(e,t,i){e?(t.innerHTML="Done",i.style.display="block"):(t.innerHTML="Edit",i.style.display="none")},_removeButtonsByCategory:function(e){if(this.accordion._titleMap[e]){var t=document.getElementById(e+"button"),i=document.getElementById(e);if(i&&t){for(;t.hasChildNodes();)t.removeChild(t.firstChild);i&&i.childNodes[0].removeChild(t)}}},clearAllCategories:function(){for(var e=this.getAllCategory(),t=0;t<e.length;t++)this.clearCategory(e[t])},clearCategoryContent:function(e){if(this.accordion._titleMap[e]){for(var t=this.getSubTitlesByCategory(e),i=(this.categoryMap[e],document.getElementById(e)),n=0;n<t.length;n++){var a=document.getElementById(e+":"+t[n]);if(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild);i&&i.removeChild(a)}delete this.subTitleDiv[e+":"+t[n]]}this.accordion.invalidate()}},clearCategory:function(e){if(this.accordion._titleMap[e]){for(var t=this.getSubTitlesByCategory(e),i=0;i<t.length;i++)delete this.subTitleDiv[e+":"+t[i]];this.accordion.remove(e),delete this.accordion._titleMap[e],this.accordion.invalidate()}},addItemDiv:function(e,t){if(!this.accordion._titleMap[e])throw"Title "+e+" does not exists";this.categoryMap[e]&&this.categoryMap[e].appendChild(t),this.accordion.invalidate()},addItemData:function(e,t,i){if(!this.accordion._titleMap[e])throw"Title "+e+" does not exists";var n=this.subTitleDiv[e+":"+t];n||(n=this._createSubTitleDiv(e,t),this.subTitleDiv[e+":"+t]=n);var a=e+":"+t+":"+i.label,o=i.id;o||(o=a);var r=this._createItemDiv(i,o,e);r.parentId=e+":"+t,this.itemDataDiv[o]=r,n.appendChild(r),this.categoryMap[e]&&this.categoryMap[e].appendChild(n),this.accordion.invalidate()},removeItemData:function(e){var t=this.itemDataDiv[e],i=this.subTitleDiv[t.parentId];i.removeChild(t),this.itemDataDiv[e]=void 0},moveItemData:function(e){if(loadResource===TYPE_CLOUD){var t={module:"templates",method:"publicTemplate",arguments:{id:e}},i=function(){if(1===arguments.length){console.log(arguments[0]);var e=JSON.parse(arguments[0]);if(e.error)return void alert(e.error)}};require(MONO_URL,t,i,this)}},searchItemData:function(e,t){if(!t)return void alert("Template name is required");var i=this;if(loadResource===TYPE_CLOUD){var n={module:"templates",method:"search",arguments:{name:t,scope:e===TEMPLATES?0:1}},a=function(){if(1===arguments.length){var n=JSON.parse(arguments[0]);if(n.error)return void alert(n.error);if(!n.value||n.value.length<=0)return void alert(t+" dese not exist");var a=n.value[0],o=i._getAncestor(Utils.categoryCache,Utils.categoryCache[a.category]);if(!o)return;var r=o.id+o.name;i.clearTemplateSub(e,r),i.addITemplateData(e,r,{id:a.id,label:a.name,image:a.icon,isTemplate:!0,type:a.type,method:a.method})}};require(MONO_URL,n,a,this)}},_getAncestor:function(e,t){if(t){for(var i=t;i.parent_id;)i=e[i.parent_id];return i}},getAllCheckedItems:function(){for(var e=[],t=document.getElementsByClassName("accordion_check"),i=0;i<t.length;i++)t[i].checked&&e.push(t[i].id);return e},_createSubTitleDiv:function(e,t){var i=document.createElement("div");i.setAttribute("class","accordion_sub_title"),i.setAttribute("id",e+":"+t),this.subTitleDiv[e+":"+t]=i;var n=document.createElement("div");return n.innerHTML=t,n.setAttribute("class","editor_category_title"),i.appendChild(n),i},_createSubTitleDivWithoutTitle:function(e,t){var i=document.createElement("div");return i.setAttribute("class","accordion_sub_title1"),i.setAttribute("id",e+":"+t),this.subTitleDiv[e+":"+t]=i,i},isCategoryExist:function(e){return this.accordion._titleMap[e]?!0:!1},addItem:function(e,t){if(!this.accordion._titleMap[e])throw"Title "+e+" does not exists";if(t&&t.title){var i=this.subTitleDiv[e+":"+t.title];if(i||(i=this._createSubTitleDiv(e,t.title)),t.items){var n=t.items;if(n.length>0)for(var a=0;a<n.length;a++){var o;t.title&&n[a].label&&(o=e+":"+t.title+":"+n[a].label,n[a].id&&(this.titleIdMap[n[a].id]=o,o=data.id));var r=this._createItemDiv(n[a],o,e);this.itemDataDiv[o]=r,i.appendChild(r)}}this.categoryMap[e]&&this.categoryMap[e].appendChild(i),this.accordion.invalidate()}},_createItemDiv:function(e,t,i){var n=this,a=document.getElementById("toolTipId"),o=document.getElementById("toolTipTextId"),r=document.createElement("div");r.setAttribute("class","edit_accordion_item");var s=document.createElement("a"),l=document.createElement("img");l.setAttribute("src",Utils.getImageSrc(e.image)),e.tooltip&&l.setAttribute("title",e.tooltip),l.setAttribute("draggable",!0),l.ondragstart=function(t){n.drag(t,e)};var d=document.createElement("img");if(i!=TEMPLATES&&i!=PUBLIC_TEMPLATES||loadResource!=TYPE_CLOUD||(l.onmouseover=function(i){if(r.content){var s=r.content,c=new Date(s.create_date).format("yyyy-MM-dd"),h=s.downloads+" download";parseInt(s.downloads)>1&&(h+="s");var u=s.author||"unknown",g=parseInt(s.size).format(0,3,",",".")+" bytes",m=s.tags||"mono",p=s.id||-1,f=g+" | "+m+" | "+p,v=h+" | <b>"+u+"</b> | "+c,y=document.createElement("span");y.style.display="block",y.innerHTML=f,o.appendChild(y);var b=document.createElement("span");b.style.display="block",b.style.position="absolute",b.style.top="180px",b.innerHTML=v,o.appendChild(b)}n.modelManager&&n.modelManager.getPreviewById(t,function(t){if(t){if(src=JSON.parse(t).value)d.setAttribute("src",src);else{var i=Utils.getImageSrc(e.image);d.setAttribute("src",i),d.setAttribute("width","180")}a.style.backgroundImage="url(images/loadBackground.png)",a.style.backgroundRepeat="repeat"}},this),a.style.display="block",a.style.left=i.clientX+l.width/4+"px",a.style.top=i.clientY+l.height/4+"px",i.clientY+parseInt(a.style.height)>document.documentElement.clientHeight?(a.style.top=i.clientY-parseInt(a.style.height)-l.width/4+"px",a.setAttribute("class","bubble-bottom arrow")):a.setAttribute("class","bubble arrow"),a.contains(d)||a.appendChild(d)},l.onmouseout=function(){a.contains(d)&&a.removeChild(d),a.style.display="none",a.style.backgroundImage="url(images/loading.png)",a.style.backgroundRepeat="no-repeat",a.style.backgroundColor="#FCFBF7",o.innerHTML=""}),s.appendChild(l),n.isEdit&&!this.refreshButtonMap[i]){var c=document.createElement("input");t&&(c.id=t),c.setAttribute("type","checkbox"),c.setAttribute("class","accordion_check"),s.appendChild(c)}if(e.label){var h=document.createElement("div");h.innerHTML=e.label,e.labelClass&&h.setAttribute("class",e.labelClass),s.appendChild(h)}return r.appendChild(s),r},_refreshCategory:function(e){var t=document.getElementById(e);t&&(this.clearCategoryContent(e),this._refreshFunction(e),this.accordion.invalidate())},addAction:function(e,t){var i=document.createElement("div");if(i.setAttribute("class","accordion_action"),t&&t.title){var n=document.createElement("div");n.setAttribute("class","accordion_action_title"),n.innerHTML=t.title,i.appendChild(n)
}if(t&&t.material){var a=t.material;if(a.length>0)for(var o=0;o<a.length;o++){var r=document.createElement("a"),s=document.createElement("img");s.setAttribute("class","material_image"),s.setAttribute("src",Utils.Path+a[o].image),a[o].tooltip&&s.setAttribute("title",a[o].tooltip),s.ondragstart=this.dragImage(a[o]),r.appendChild(s),i.appendChild(r)}}this.categoryMap[e]&&this.categoryMap[e].appendChild(i)},dragImage:function(e){var t=this;return function(i){t.drag(i,e)}},drag:function(e,t){var i=JSON.stringify(t);if(e.dataTransfer.setData("Text",i),t.dragImage||(t.dragImage=t.image),t.dragImage){var n=document.createElement("img");n.setAttribute("src",Utils.getImageSrc(t.dragImage)),e.dataTransfer.setDragImage&&e.dataTransfer.setDragImage(n,n.width/2,n.height/2)}},getView:function(){return this.accordion.getView()},expand:function(e){this.accordion.expand(e)},getAccodion:function(){return this.accordion},addMultiStepPane:function(e,t){var i=this.titleMultiSteps[e];if(i){var n=t.getCurrentCategory();i[n]=t}else{var n=t.getCurrentCategory();this.titleMultiSteps[e]=i={},i[n]=t}var a=this.subTitleDiv[e+":"+t.getCurrentCategory()+t.getCategoryName()];a||(a=this._createCategoryTemplateDiv(e,t),this.subTitleDiv[e+":"+t.getCurrentCategory()+t.getCategoryName()]=a),this.categoryMap[e]&&this.categoryMap[e].appendChild(a),this.accordion.invalidate()},addTreeComboBoxPane:function(e,t){t.getValue();this.categoryMap[e]&&this.categoryMap[e].firstChild.appendChild(t.getView()),this.accordion.invalidate()},_createCategoryTemplateDiv:function(e,t){var i=document.createElement("div");return i.setAttribute("class","accordion_sub_title"),i.setAttribute("id",e+":"+t.getCurrentCategory()+t.getCategoryName()),i.style.marginTop="25px",i.appendChild(t.getView()),i},clearTemplateSub:function(e,t){if(this.accordion._titleMap[e]){var i=this.subTitleDiv[e+":"+t];if(i){var n=i;if(n)for(;n.hasChildNodes()&&n.childNodes.length>1;)n.removeChild(n.lastChild);this.accordion.invalidate()}}},addITemplateData:function(e,t,i,n){if(!this.accordion._titleMap[e])throw"Title "+e+" does not exists";var a=this.subTitleDiv[e+":"+t];a||(a=this._createSubTitleDivWithoutTitle(e,t),this.subTitleDiv[e+":"+t]=a);var o,r=a,s=e+":"+t+":"+i.label;loadResource===TYPE_CLOUD&&i.id&&(this.titleIdMap[i.id]=s,o=i.id),o||(o=s);var l=this._createItemDiv(i,o,e);if(l.parentId=e+":"+t,this.itemDataDiv[o]=l,r&&r.appendChild(l),this.categoryMap[e]){var d=this.categoryMap[e].lastChild.id;d==e+":"+t&&this.categoryMap[e].removeChild(this.categoryMap[e].lastChild),this.categoryMap[e].appendChild(a)}return this.accordion.invalidate(),l.content=n,l},_cacheMultiStepItem:function(e){var t=this.titleMultiSteps[e];if(t){var i={};for(p in t)if(t.hasOwnProperty(p)){var n=t[p].getSelectedItems();i[p]=n}return i}},_refreshMultiStep:function(e,t){var i=this.titleMultiSteps[e];if(i&&t)for(p in t)t.hasOwnProperty(p)&&i[p].setSelectedItems(t[p])}}),MyAccordion=function(){MyAccordion.superClass.constructor.apply(this,arguments)},twaver.Util.ext("MyAccordion",twaver.controls.Accordion,{handleMouseDown:function(e){if(0===e.button){var t=e.target._title;t||(t=e.target.parentNode._title),t&&this._currentTitle!==t&&this.expand(t)}},validateImpl:function(){var e=this;twaver.controls.Accordion.prototype.validateImpl.call(this),this.getTitles().forEach(function(t){e.getCurrentTitle()===t?(e._titleMap[t].titleDiv.setAttribute("class","category_title_expand"),e._titleMap[t].titleDiv.style.background="#f07819"):(e._titleMap[t].titleDiv.setAttribute("class","category_title_collapse"),e._titleMap[t].titleDiv.style.background="#EBEBEB")})}}),MultiStepPane=function(e,t,i){this.box=new twaver.ElementBox,this.tree=new twaver.controls.Tree(this.box),this.multi=document.createElement("div"),this.categoryCache=t,this.callback=i,this.init(e)},twaver.Util.ext("MultiStepPane",Object,{suffix:"Arrow",isShowing:!1,init:function(e){var t=this;this.multi.style.display="table",this.currentCategory=e,t._createStep(null,e.id,e.name+this.getCategoryTemplateCountString(e)),this._initTree(),this.multi.addEventListener("click",function(e){t.stopPropagation(e);var i=e.target;if("LABEL"==i.tagName){var n=i.id;n||(n="root"+i.itemId);for(var a=document.getElementById(n+"Arrow"),o=a?a:i;o.nextElementSibling;){var r=o.nextElementSibling;t.multi.removeChild(r)}t.callback&&t.callback.apply(t,[i.itemId,t.currentCategory.id+t.currentCategory.name])}},!1),this.multi.addEventListener("mouseover",function(e){t.stopPropagation(e);var i=e.target;if("LABEL"==i.tagName){i.setAttribute("class","category-label-over");var n=i.nextElementSibling;n?n.setAttribute("class","category-button-over"):i.setAttribute("class","category-without-label")}else if("INPUT"==i.tagName){i.setAttribute("class","category-button-over");var a=i.previousElementSibling;a&&a.setAttribute("class","category-label-over")}},!1),this.multi.addEventListener("mouseout",function(e){t.stopPropagation(e);var i=e.target;if("LABEL"==i.tagName){i.setAttribute("class","category-label");var n=i.nextElementSibling;n&&n.setAttribute("class","category-button")}else if("INPUT"==i.tagName){i.setAttribute("class","category-button");var a=i.previousElementSibling;a&&a.setAttribute("class","category-label")}},!1),this.multi.addEventListener("mousedown",function(e){t.stopPropagation(e);e.target},!1),this.multi.addEventListener("mouseup",function(e){t.stopPropagation(e);e.target},!1)},_initDatas:function(e){this.box.clear();var t=this._getCategoryChildren(e);if(t&&t.length>0){this.maxItemLen=0;for(var i=0;i<t.length;i++){var n=t[i],a=new twaver.Node(n.id);a.setStyle("select.color","#f07819"),a.setName(n.name+this.getCategoryTemplateCountString(n)),a.setClient("parentId",n.parent_id),this.box.add(a);var o=this._getStringPixelLength(n.name);this.maxItemLen=Math.max(this.maxItemLen,o)}}},_clickHandle:function(e,t,i){if(this.isShowing)return document.body.removeChild(this.isShowing),this.isShowing=!1,i.setAttribute("src",Utils.Path+"arrowright.png"),i.style.padding="6px",void document.removeEventListener("click",c,!1);this.stopPropagation(e);var n=this;i.setAttribute("src",Utils.Path+"arrowdown.png"),i.style.padding="7.5px 4.5px",n._initDatas(t.itemId);var a=i.getBoundingClientRect(),o=t.getBoundingClientRect(),r=n.tree.getView();n.tree.setRowHeight(twaver.Defaults.LIST_ROW_HEIGHT+2);var s=this.maxItemLen+80||200,l=n.box.size()*n.tree.getRowHeight()+2;r.style.left=a.left+"px",r.style.top=o.bottom+"px",r.style.width=s+"px",r.style.height=l+"px",document.body.appendChild(r),this.isShowing=r;var d=function(e){n.stopPropagation(e);var t=n.tree.getDataAt(e);if(t){var a=t.getClient("parentId"),o=document.getElementById(a),s=document.getElementById(a+"Arrow");if(o){if(o.itemId!=t.getId()){for(var l=s?s:o;l.nextElementSibling;){var h=l.nextElementSibling;n.multi.removeChild(h)}o.innerHTML=t.getName(),o.itemId=t.getId();var u=n._getCategoryChildren(t.getId());s?(!u||u.length<=0)&&n.multi.removeChild(s):u&&u.length>0&&(s=document.createElement("input"),s.id=a+n.suffix,s.setAttribute("type","image"),s.setAttribute("src",Utils.Path+"arrowright.png"),s.onclick=function(e){n._clickHandle(e,o,s)},s.style.padding="6px",s.style.float="left",n.multi.appendChild(s))}}else n._createStep(a,t.getId(),t.getName());n.callback&&n.callback.apply(n,[t.getId(),n.currentCategory.id+n.currentCategory.name]),r.removeEventListener("mousedown",d,!1),document.body.removeChild(r),n.isShowing=!1,document.removeEventListener("click",c,!1),i.setAttribute("src",Utils.Path+"arrowright.png"),i.style.padding="6px"}};r.addEventListener("mousedown",d,!1);var c=function(e){n.stopPropagation(e),e.x>a.left&&e.x<a.left+s&&e.y>a.bottom&&a.bottom<a.bottom+l||(document.body.contains(r)&&(document.body.removeChild(r),n.isShowing=!1),document.removeEventListener("click",c,!1),i.setAttribute("src",Utils.Path+"arrowright.png"),i.style.padding="6px")};document.addEventListener("click",c,!1)},_initTree:function(){var e=this;this.tree.getIcon=function(){return null},this.tree.expandAll();var t=this.tree.getView();t.style.position="fixed",t.setAttribute("id","categoryTree"),t.setAttribute("class","category"),t.addEventListener("mouseover",function(t){e.newdata=e.tree.getDataAt(t),e.olddata!==e.newdata&&(e.olddata&&e.tree.invalidateData(e.olddata),e.newdata&&e.tree.invalidateData(e.newdata),e.olddata=e.newdata)}),this.tree.onDataRendered=function(t,i,n,a){a?(t.style.background="#f07819",t.style.color="#ffffff"):i==e.newdata?(t.style.background="#f07819",t.style.color="#ffffff"):(t.style.background="#f0781900",t.style.color="#000000"),t.style.paddingTop="2px"},this.tree.getSelectColor=function(){return"#f07819"}},stopPropagation:function(e){e=e||window.event,e&&e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},getView:function(){return this.multi},getCurrentCategory:function(){return this.currentCategory.id},getCategoryName:function(){return this.currentCategory.name},_createStep:function(e,t,i){var n=this,a=document.createElement("label");a.setAttribute("class","category-label"),a.innerHTML=i,a.itemId=t,e?a.id=e:e="root"+t,n.multi.appendChild(a);var o=n._getCategoryChildren(t);if(o&&o.length>0){var r=document.createElement("input");r.id=e+this.suffix,r.setAttribute("type","image"),r.setAttribute("src",Utils.Path+"arrowright.png"),r.onclick=function(e){n._clickHandle(e,a,r)},r.setAttribute("class","category-button"),this.multi.appendChild(r)}return{label:a,button:r}},_getCategoryChildren:function(e){var t=this;return t.currentCategory.type==PropertyConsts.TYPE_COMPONENT?t.categoryCache[t.currentCategory.type][e].children:t.categoryCache[e].children},_getStringPixelLength:function(e){return this.context||(this.context=document.createElement("canvas").getContext("2d")),this.context.measureText(e).width},getSelectedItems:function(){for(var e=[],t=this.multi.firstChild;t;){if("LABEL"==t.tagName){var i={parentId:t.id,id:t.itemId,name:t.innerHTML};e.push(i)}t=t.nextSibling}return e},setSelectedItems:function(e){if(e&&!(e.length<=0)){for(var t=0;t<e.length;t++){var i=e[t];i.parentId&&this._createStep(i.parentId,i.id,i.name)}var n=e[e.length-1];this.callback&&this.callback.apply(this,[n.id,this.currentCategory.id+this.currentCategory.name])}},getCategoryTemplateCountString:function(e){return" ("+e.count+")"}}),mono.AniUtil={},mono.AniUtil.Easing=TWEEN.Easing,mono.AniUtil.DefaultEasing=mono.AniUtil.Easing.Linear.None,mono.AniUtil.AllEasings={"Linear.None":mono.AniUtil.Easing.Linear.None,"Quadratic.In":mono.AniUtil.Easing.Quadratic.In,"Quadratic.Out":mono.AniUtil.Easing.Quadratic.Out,"Quadratic.InOut":mono.AniUtil.Easing.Quadratic.InOut,"Cubic.In":mono.AniUtil.Easing.Cubic.In,"Cubic.Out":mono.AniUtil.Easing.Cubic.Out,"Cubic.InOut":mono.AniUtil.Easing.Cubic.InOut,"Quartic.In":mono.AniUtil.Easing.Quartic.In,"Quartic.Out":mono.AniUtil.Easing.Quartic.Out,"Quartic.InOut":mono.AniUtil.Easing.Quartic.InOut,"Quintic.In":mono.AniUtil.Easing.Quintic.In,"Quintic.Out":mono.AniUtil.Easing.Quintic.Out,"Quintic.InOut":mono.AniUtil.Easing.Quintic.InOut,"Sinusoidal.In":mono.AniUtil.Easing.Sinusoidal.In,"Sinusoidal.Out":mono.AniUtil.Easing.Sinusoidal.Out,"Sinusoidal.InOut":mono.AniUtil.Easing.Sinusoidal.InOut,"Exponential.In":mono.AniUtil.Easing.Exponential.In,"Exponential.Out":mono.AniUtil.Easing.Exponential.Out,"Exponential.InOut":mono.AniUtil.Easing.Exponential.InOut,"Circular.In":mono.AniUtil.Easing.Circular.In,"Circular.Out":mono.AniUtil.Easing.Circular.Out,"Circular.InOut":mono.AniUtil.Easing.Circular.InOut,"Elastic.In":mono.AniUtil.Easing.Elastic.In,"Elastic.Out":mono.AniUtil.Easing.Elastic.Out,"Elastic.InOut":mono.AniUtil.Easing.Elastic.InOut,"Back.In":mono.AniUtil.Easing.Back.In,"Back.Out":mono.AniUtil.Easing.Back.Out,"Back.InOut":mono.AniUtil.Easing.Back.InOut,"Bounce.In":mono.AniUtil.Easing.Bounce.In,"Bounce.Out":mono.AniUtil.Easing.Bounce.Out,"Bounce.InOut":mono.AniUtil.Easing.Bounce.InOut},mono.AniUtil.AllEasingNames=[];for(name in mono.AniUtil.AllEasings)mono.AniUtil.AllEasingNames.push(name);mono.AniUtil.getAllActions=function(){return["","rotation","move","scale"]},mono.AniUtil.getAllAnchors=function(){return["","left","right","top","bottom","front","back","center-x","center-y","center-z"]},mono.AniUtil.getAllValues=function(){return[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.25,1.5,1.75,2,30,60,90,120,150,180,210,240,270,300,330,360,-30,-60,-90,-120,-150,-180,-210,-240,-270,-300,-330,-360]},mono.AniUtil.oldAnimationTypes=["LeftMove","RightMove","FrontMove","BackMove","LeftRotationClockwise90","LeftRotationAnticlockwise90","LeftRotationClockwise120","LeftRotationAnticlockwise120","CenterRotationClockwise270","CenterRotationAnticlockwise270"],mono.AniUtil.animate=function(e){requestAnimationFrame(mono.AniUtil.animate),TWEEN.update(e)},mono.AniUtil.animate(),mono.AniUtil.createAxisByName=function(e){var t=new mono.Vec3(0,1,0);return"y"===e&&(t=new mono.Vec3(0,1,0)),"x"===e&&(t=new mono.Vec3(1,0,0)),"z"===e&&(t=new mono.Vec3(0,0,1)),t},mono.AniUtil.createAnchorPosition=function(e,t){var i=e.getBoundingBox(),n=i.size(),a=0,o=0,r=0;return"center"===t.substring(0,6)||("left"===t?a=-n.x/2:"right"===t?a=n.x/2:"front"===t?r=n.z/2:"back"===t?r=-n.z/2:"top"===t?o=n.y/2:"bottom"===t&&(o=-n.y/2)),new mono.Vec3(a,o,r)},mono.AniUtil.playRotate=function(e,t,i,n,a,o,r,s){var l=mono.AniUtil.createAxisByName(t),d=mono.AniUtil.createAnchorPosition(e,i);if(!e.__tween){var c=0,h=e.__animated?n:-n;return e.__tweenLastRotation=c,e.__tweenDestRotation=h,e.__animated=!e.__animated,a=a||1e3,o=o||0,r=r||mono.AniUtil.DefaultEasing,e.__tween=new TWEEN.Tween({v:c}).to({v:h},a).easing(r).delay(o).onUpdate(function(){e.rotateFromAxis(l,d,this.v-e.__tweenLastRotation),e.__tweenLastRotation=this.v}).onComplete(function(){delete e.__tween,delete e.__tweenLastRotation,delete e.__tweenDestRotation,s&&s.apply(e)}).start(),e.__tween}},mono.AniUtil.playScale=function(e,t,i,n,a,o,r){if(!e.__tween){var s=0,l=i||1;1>i&&(s=1,l=i||0),n=n||1e3,a=a||0,o=o||mono.AniUtil.DefaultEasing,e.__fromPosition=e.getPosition().clone(),e.__fromScale=e.getScale().clone();var d,c;"top"===t||"bottom"===t?(d=e.getHeight()/2,c="y","bottom"===t&&(d=-1*d)):"front"===t||"back"===t?(d=e.getDepth()/2,c="z","back"===t&&(d=-1*d)):"left"===t||"right"===t?(d=e.getWidth()/2,c="x","left"===t&&(d=-1*d)):"center-x"===t?c="x":"center-y"===t?c="y":"center-z"===t?c="z":(d=e.getHeight()/2,c="y");var h=e.getPosition()[c]-d*e.getScale()[c],u=e.getPosition()[c]/e.getScale()[c]*i;return 1>i&&(h=e.getPosition()[c],u=e.getPosition()[c]/e.getScale()[c]*i-d*e.getScale()[c]),console.log(h,u),e.__tween=new TWEEN.Tween({scale:s,v:h}).to({scale:l,v:u},n).easing(o).delay(a).onUpdate(function(){if(d){var t=e.__fromPosition.clone();t[c]=this.v,e.setPosition(t)}var i=e.__fromScale.clone();i[c]=this.scale,e.setScale(i)}).onComplete(function(){delete e.__tween,delete e.__fromPosition,delete e.__fromScale,r&&r.apply(e)}).start(),e.__tween}},mono.AniUtil.playMove=function(e,t,i,n,a,o,r){var s;("left"===t||"right"===t)&&(s="x","left"===t&&(i=-1*i)),("top"===t||"bottom"===t)&&(s="y","bottom"===t&&(i=-1*i)),("front"===t||"back"===t)&&(s="z","back"===t&&(i=-1*i));var l=e.getBoundingBox(),d=l.max.x-l.min.x,c=l.max.y-l.min.y,h=l.max.z-l.min.z;if("x"===s&&(i*=d),"y"===s&&(i*=c),"z"===s&&(i*=h),!e.__tween){var u=e.getPosition()[s],g=e.__animated?e.getPosition()[s]-i:e.getPosition()[s]+i;return e.__animated=!e.__animated,e.__fromPosition=e.getPosition().clone(),n=n||1e3,a=a||0,o=o||mono.AniUtil.DefaultEasing,e.__tween=new TWEEN.Tween({v:u}).to({v:g},n).easing(o).delay(a).onUpdate(function(){var t=e.__fromPosition.clone();t[s]=this.v,e.setPosition(t)}).onComplete(function(){delete e.__tween,r&&r.apply(e)}).start(),e.__tween}},mono.AniUtil.getAxisByAnchor=function(e){if("top"===e||"bottom"===e)return"x";if("left"===e||"right"===e)return"y";if("front"===e||"back"===e)return"y";if("center"===e.substring(0,6)){var t=e.split("-");return t[1]}},mono.AniUtil.playAnimation=function(e,t,i,n,a,o){if(e&&t){if(-1!=mono.AniUtil.oldAnimationTypes.indexOf(t))switch(t){case"LeftMove":t="move:left:0.9";break;case"RightMove":t="move:right:0.9";break;case"FrontMove":t="move:front:0.9";break;case"BackMove":t="move:back:0.9";break;case"LeftRotationClockwise90":t="rotation:left:90";break;case"LeftRotationAnticlockwise90":t="rotation:left:-90";break;case"LeftRotationClockwise120":t="rotation:left:120";break;case"LeftRotationAnticlockwise120":t="rotation:left:-120";break;case"CenterRotationClockwise270":t="rotation:center-y:270";break;case"CenterRotationAnticlockwise270":t="rotation:center-y:-270"}i=i||1e3,n=n||0,a=a||mono.AniUtil.DefaultEasing;var r=t.split(":"),s=r[0],l=r[1],d=parseFloat(r[2]);if(r.length>3&&(i=parseInt(r[3])),r.length>4&&(n=parseInt(r[4])),r.length>5&&(a=mono.AniUtil.AllEasings[r[5]]),"rotation"===s){var c=mono.AniUtil.getAxisByAnchor(l);return d=d/180*Math.PI,mono.AniUtil.playRotate(e,c,l,d,i,n,a,o)}return"move"===s?mono.AniUtil.playMove(e,l,d,i,n,a,o):"scale"===s?mono.AniUtil.playScale(e,l,d,i,n,a,o):void 0}},mono.AniUtil.getAnimationString=function(e,t,i,n,a,o){if(!e||!t||!i)return"";var r=e+":"+t+":"+i;return n&&(r+=":"+n),r+=a?":"+a:":0",o&&(r+=":"+o),r},mono.AniUtil.findAnimationAgent=function(e){for(var t=e.getClient("animation");!t&&e.getParent();)t=e.getParent().getClient("animation"),e=e.getParent();return t?e:null},mono.AniUtil.playAlarmAnimation=function(e,t,i,n,a,o){if(!e.__tween){var r=0,s=60;return i=i||1500,n=n||0,a=a||TWEEN.Easing.Elastic.Out,e.__tween=new TWEEN.Tween({scale:r}).to({scale:s},i).easing(a).delay(n).onUpdate(function(){t.setScale(this.scale,this.scale,1)}).onComplete(function(){delete e.__tween,o&&o.apply()}).start()}},mono.AniUtil.playInspection=function(e,t,i){return t.unshift({px:e.getCamera().getPosition().x,py:e.getCamera().getPosition().y,pz:e.getCamera().getPosition().z,tx:e.getCamera().getTarget().x,ty:e.getCamera().getTarget().y,tz:e.getCamera().getTarget().z}),t.__cursor||(t.__cursor=1),mono.AniUtil._doPlayInspection(e,t,i)},mono.AniUtil._doPlayInspection=function(e,t,i){if(t.__cursor<t.length){var n=t[t.__cursor-1],a=t[t.__cursor],o=mono.AniUtil._createInspectionTween(e,n,a);return o.onComplete(function(){t.__cursor++,mono.AniUtil._doPlayInspection(e,t,i)}),o.start(),o}i&&i.apply()},mono.AniUtil._fixStopMissingValues=function(e,t){null==t.px&&(t.px=e.getCamera().getPosition().x),null==t.py&&(t.py=e.getCamera().getPosition().y),null==t.pz&&(t.pz=e.getCamera().getPosition().z),null==t.tx&&(t.tx=e.getCamera().getTarget().x),null==t.ty&&(t.ty=e.getCamera().getTarget().y),null==t.tz&&(t.tz=e.getCamera().getTarget().z)},mono.AniUtil._createInspectionTween=function(e,t,i){var n=i.time?i.time:2e3,a=i.delay?i.delay:0,o=i.easing?i.easing:mono.AniUtil.DefaultEasing;return mono.AniUtil._fixStopMissingValues(e,t),mono.AniUtil._fixStopMissingValues(e,i),new TWEEN.Tween(t).to(i,n).easing(o).delay(a).onUpdate(function(){e.getCamera().look(new mono.Vec3(this.tx,this.ty,this.tz)),e.getCamera().setPosition(this.px,this.py,this.pz)})},mono.AniUtil.playTransform=function(e,t,i,n,a,o){i=i||2e3,n=n||0,a=a||TWEEN.Easing.Linear.None,mono.AniUtil._fixTransformMissingValues(e,t);var r=mono.AniUtil.createElementTransform(e);return new TWEEN.Tween(r).to(t,i).easing(a).delay(n).onUpdate(function(){e.setPosition(this.px,this.py,this.pz),e.setRotation(this.rx,this.ry,this.rz),e.setScale(this.sx,this.sy,this.sz)}).onComplete(function(){o&&o.apply()}).start()},mono.AniUtil._fixTransformMissingValues=function(e,t){null==t.px&&(t.px=t.getPosition().x),null==t.py&&(t.py=t.getPosition().y),null==t.pz&&(t.pz=t.getPosition().z),null==t.rx&&(t.rx=t.getRotation().x),null==t.ry&&(t.ry=t.getRotation().y),null==t.rz&&(t.rz=t.getRotation().z),null==t.sx&&(t.sx=t.getScale().x),null==t.sy&&(t.sy=t.getScale().y),null==t.sz&&(t.sz=t.getScale().z)},mono.AniUtil.createElementTransform=function(e){return{px:e.getPosition().x,py:e.getPosition().y,pz:e.getPosition().z,rx:e.getRotation().x,ry:e.getRotation().y,rz:e.getRotation().z,sx:e.getScale().x,sy:e.getScale().y,sz:e.getScale().z}},mono.AniUtil.createTransform=function(e,t,i,n,a,o,r,s,l){return{px:e,py:t,pz:i,rx:n,ry:a,rz:o,sx:r,sy:s,sz:l}},mono.AniUtil.isAnimated=function(e){return e&&null!=e.__animated&&e.__animated===!0},mono.AniUtil.resetAnimation=function(e){if(e){var t=e.getNodes().toArray();if(t)for(var i=0;i<t.length;i++){var n=t[i];mono.AniUtil.isAnimated(n)&&mono.AniUtil.playAnimation(n,n.getClient("animation"))}}},mono.AniUtil.resetAnimatedFlag=function(e){e&&(delete e.__animated,delete e.__played)},mono.AniUtil.playCameraAnimation=function(e,t,i,n,a,o){if(e&&t){i=i||1e3,n=n||0,a=a||mono.AniUtil.DefaultEasing;var r=t.split(":"),s=(r[0],parseFloat(r[1]));s=s/180*Math.PI;var l=mono.AniUtil.createAxisByName("y"),d=e.getTarget();if(!e.__tween){var c=0,h=s;return e.__tweenLastRotation=c,e.__tweenDestRotation=h,e.__tween=new TWEEN.Tween({v:c}).to({v:h},i).easing(a).delay(n).onUpdate(function(){var t=getCameraPosition(l,e.getPosition(),d,this.v-e.__tweenLastRotation);e.setPosition(t),e.__tweenLastRotation=this.v}).onComplete(function(){delete e.__tween,delete e.__tweenLastRotation,delete e.__tweenDestRotation,o&&o.apply(e)}).start(),e.__tween}}};var getCameraPosition=function(e,t,i,n){var a=t.clone();return a.rotateFromAxisAndCenter(e,n,i)};mono.AnimationData=function(e,t,i,n){this.object=t,this.animation=i,this.groupName=n,this._id=e},twaver.Util.ext("mono.AnimationData",Object,{play:function(){if(this.object instanceof mono.Entity){this.object.__animated=this.object.__played;var e=this.animation.split(";");e.length>=1&&(this.object.__played?this.playAnimationString(e,e.length-1,e.length,this.object.__played):this.playAnimationString(e,0,e.length,this.object.__played)),this.object.__played=!this.object.__played}},playAnimationString:function(e,t,i,n){var a=this;this.object.__animated=n,n?e[i-1]&&t>=0&&mono.AniUtil.playAnimation(this.object,e[t],null,null,null,function(){a.playAnimationString(e,--t,i,n)}):e[t]&&i>t&&mono.AniUtil.playAnimation(this.object,e[t],null,null,null,function(){a.playAnimationString(e,++t,i,n)})},setAnimationGroup:function(e){this.groupName=e},setAnimation:function(e){this.animation=e},isPlayed:function(){return this.object&&null!=this.object.__played&&this.object.__played===!0},reset:function(){this.isPlayed()&&this.play()}}),mono.AnimationManager=function(e){this.name=e,this.animations=[],this.animationMap={},this.totalAnimations=[],this.isPlayed=!1},twaver.Util.ext("mono.AnimationManager",Object,{add:function(e){this.animations.push(e),this.totalAnimations.push(e),this.animationMap[e._id]=e},remove:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1),this.animationMap[e._id]=null,t=this.totalAnimations.indexOf(e),-1!==t&&this.totalAnimations.splice(t,1)},getAnimationById:function(e){return this.animationMap[e]},stop:function(){var e=this.getCurrentAnimation();e.stop()},setTotalAnimations:function(e){if(e&&e.length>0)for(var t in e){var i=this.totalAnimations.indexOf(e[t]);-1!==i&&this.totalAnimations.push(e[t])}},playAll:function(){if(this.animations&&this.animations.length>0)if(isPlayed)for(var e=this.animations.length-1;e>=0;e--)this.play(this.animations[e]);else for(var e=0;e<animations.length;e++)this.play(this.animations[e]);isPlayed=!isPlayed},getCurrentAnimation:function(){if(this.animations&&this.animations.length>0)for(var e in this.animations)if(this.animations[e].isPlaying)return this.animations[e]},reset:function(){for(var e in this.animations)this.animations[e].reset()},play:function(e){if(e.groupName){var t=this.getAllAnimationsByGroupName(e.groupName);for(var i in t)t[i].play()}else e.play()},getAllAnimations:function(){return this.animations},getAllAnimationsByGroupName:function(e){var t=[];if(this.totalAnimations&&this.totalAnimations.length>0)for(var i in this.totalAnimations)this.totalAnimations[i].groupName==e&&t.push(this.totalAnimations[i]);return t},resetAllAnimations:function(){if(this.animations&&this.animations.length>0)for(var e in this.animations)this.animations[e].reset()}}),ImageShapeNode=function(){ImageShapeNode.superClass.constructor.apply(this,arguments),this.setClient(IMAGE_SRC,Utils.Path+"room.png"),this.setStyle("vector.outline.color","#333333"),this.setStyle("vector.outline.width",10),this.setClient("shapenode.closed",!0),this.setClient("focusColor","green"),this.setClient("resizeBorderWidth",10),this.setClient("resizeBorderLength",18),this.setClient("resizeBorderGap",10),this.setClient("resizeBorderColor","yellow"),this.setClient("wallInnerPic",Utils.Path+"wall00-inner.png"),this.setClient("wallOuterPic",Utils.Path+"wall00.png"),this.setClient("size",{x:0,y:300,z:10}),this.setClient("useTexture",!1),this.setClient("framePic",Utils.Path+"wall00-frame.png"),this.setClient("fill",!0),this.setClient("showDim",showDim),this.setClient("dimLeadLength",35),this.setClient("dimLineOffset",.7),this.setClient("dimLineWidth",1),this.setClient("dimColor","#F07819"),this.setClient("dimTextGap",5),this.setClient("dimTextFont","12px Arial"),this.setClient("dimArrowWidth",8),this.setClient("dimArrowHeight",3),this.setClient("showCoord",showCoord),this.setClient("coordTextColor","white"),this.setClient("coordTextFont","12px Arial"),this.setClient("coordTextOffsetX",0),this.setClient("coordTextOffsetY",20),this.setClient("coordTextAlign","center"),this.setClient("coordTextBaseline","middle"),this.setClient("coordTextBackground","rgba(240,120,25,0.7)"),this.setClient("decimalNumber",0),this.setClient("room.gap.right",100),this.setClient("room.gap.bottom",100),this.offsetY=0,this.offsetX=0,this.negatedYInterval=!1},twaver.Util.ext("ImageShapeNode",twaver.ShapeNode,{getCanvasUIClass:function(){return ImageShapeNodeUI},getElementUIClass:function(){return ImageShapeNodeUI},getVectorUIClass:function(){return ImageShapeNodeUI},onChildRemoved:function(){this.refreshChilden()},onChildAdded:function(){this.refreshChilden()},onPropertyChanged:function(e){ImageShapeNode.superClass.onPropertyChanged.call(this,e),"points"===e.property&&this.refreshChilden()},checkBlockOnEdge:function(e){var t=!1;return this.getChildren().forEach(function(i){i.getClient("edgeIndex")===e&&(t=!0)}),t},refreshChilden:function(){this.getChildren().forEach(function(e){e.refresh()})},translate3d:function(e,t,i){var n=new Array,a=this.getPoints(),o=this.getCenterLocation(),r=new twaver.List;a.forEach(function(e){r.add({x:e.x-o.x,y:e.y-o.y})});var s=a.size();if(!(0>=s)){2==s&&this.setClient("shapenode.closed",!1);var l=this.getClient("shapenode.closed");this._wallInnerPic=""===this.getClient("wallInnerPic")?null:Utils.handlerTexture(this.getClient("wallInnerPic")),this._wallOuterPic=""===this.getClient("wallOuterPic")?null:Utils.handlerTexture(this.getClient("wallOuterPic")),this._wallFramePic=""===this.getClient("framePic")?null:Utils.handlerTexture(this.getClient("framePic")),this._lightMapPic=Utils.handlerTexture(Utils.Path+"lightmap.png"),this instanceof InnerWallShapeNode&&(this._wallOuterPic=this._wallInnerPic),this.floorName=this.getClient("floorName"),this.floorHeight=this.getClient("floorHeight");var d=this.getClient("size"),c=this.getClient("useTexture"),h=this.getClient("transparent"),u=this.getClient("opacity"),g=this.getClient(CUSTOM_PROPS),m=this.getClient(PropertyConsts.LAYERID);this.deep=10;var p=300;this.repeat=50,d&&(this.deep=d.z,p=d.y),0==c&&(this.repeat=p);for(var f=new mono.Path,v=0;s>v;v++){if(i)var y=r.get(v);else var y=a.get(v);0==v?f.moveTo(y.x,-y.y,0):f.lineTo(y.x,-y.y,0)}l&&f.closePath();var b=this.getId(),C=e.getDataById(b),w=new mono.PathCube({path:f,width:this.deep,height:p,repeat:this.repeat});e.startBatch(),w.setStyle("m.texture.image",this._wallOuterPic),w.setStyle("inside.m.texture.image",this._wallInnerPic),w.setStyle("top.m.texture.image",this._wallFramePic),w.setStyle("bottom.m.texture.image",this._wallFramePic),w.setStyle("aside.m.texture.image",this._wallFramePic),w.setStyle("zside.m.texture.image",this._wallFramePic),w.setStyle("m.transparent",h),w.setStyle("inside.m.lightmap.image",this._lightMapPic),w.setStyle("outside.m.lightmap.image",this._lightMapPic),w.setStyle("m.opacity",u);var S=this.getClient("shapeNodeIndex");Utils.setPolygonOffset(w,2*-S),e.endBatch();var x=[],I=[];x.push(w);for(var P=0;P<t.length;P++){var _=t[P],E=this.createBlocks(e,_,n,o);x.push(E),I.push("-")}return!C&&b&&(C=b?new mono.ComboNode(x,I,!1,b):new mono.ComboNode),x.length>0&&C.setCombos(x),I&&C.setOperators(I),C.setStyle("m.type","phong"),C.setClient("floorName",this.floorName),C.setPositionY(this.floorHeight||0),C.setPositionX(o.x),C.setPositionZ(o.y),C.setEditable(!0),C.setSelectable(!0),Utils.setElementCustomProps(this,C,g),m&&C.setClient(PropertyConsts.LAYERID,m),e.getDataById(b)||e.add(C),n.push(C),n}},createBlocks:function(e,t,i,n){var a=new mono.Path,o=t.getCenterLocation(),r=t.getClient("leftPoint"),s=t.getClient("rightPoint");r={x:r.x-n.x,y:r.y-n.y},s={x:s.x-n.x,y:s.y-n.y},a.moveTo(r.x,-r.y,0),a.lineTo(s.x,-s.y,0);var l=t.getClient("height"),d=t.getClient("positionY"),c=new mono.PathCube(a,this.deep,l,null,this.repeat);if(c.setStyle("m.texture.image",this._wallFramePic),c.setPositionY(d||0),!t.isCutoff()){var h=t.getBlockPicture(),u=t.getStyle("vector.outline.width"),g=t.getBlockWidth()+u,m=t.getBlockHeight(),p=this.deep/3,f=s.x-r.x,v=s.y-r.y,y=t.getAngle(f,-v),b=new MaterialDesc,C=t.getClient("transparent"),w=t.getClient("opacity"),S=t.getClient(PropertyConsts.LAYERID);b.transparent=!0,null==h?(b.color="white",b.alpha=0):b.texture=h,e.getDataById(t.getId())&&e.removeById(t.getId());var x=t.getClient(CUSTOM_PROPS),I=GeometryTranslater.get3DGeometry(b,"mono.Cube",{x:g,y:m,z:p},{x:o.x,y:d+(this.floorHeight||0)+m/2,z:o.y},null,null,null,{id:t.getId()});I.setRotationY(y),I.setClient("floorName",this.floorName),I.setClient("animation",t.getClient("animation")),I.setStyle("m.specularStrength",t.getClient("specularStrength")),I.setStyle("m.opacity",1),I.setStyle("m.transparent",!1),I.setStyle("front.m.transparent",C),I.setStyle("front.m.opacity",w),I.setStyle("back.m.transparent",C),I.setStyle("back.m.opacity",w),I.setStyle("m.polygonOffset",!0),I.setStyle("m.polygonOffsetFactor",.1),I.setStyle("m.polygonOffsetUnits",1),I.setEditable(!1),I.setSelectable(!1),I.setWidth(g),t.getClient("horizontalFlip")&&I.setStyle("back.m.texture.flipX",t.getClient("horizontalFlip")),S&&I.setClient(PropertyConsts.LAYERID,S),Utils.setElementCustomProps(t,I,x),e.getDataById(t.getId())||e.add(I),i.push(I)}return c},isPointOnPoints:function(e){for(var t=this.getPoints(),i=0;i<t.size();i++)if(_twaver.math.getDistance(e,t.get(i))<=10)return!0;return!1},getPointIndex:function(e){var t=this.getPoints();if(t.size()<2)return-1;for(var i=0;i<t.size();i++)if(_twaver.math.getDistance(e,t.get(i))<=10)return-1;for(var n,a=t.get(0),i=1;i<t.size();i++){if(n=t.get(i),this.isPointOnLine(e,a,n,10))return i-1;a=n}return a=t.get(0),this.isPointOnLine(e,a,n,10)?t.size()-1:-1},isPointOnLine:function(e,t,i,n){0>n&&(n=0);var a=this.getDistanceFromPointToLine(e,t,i);return n>=a&&e.x>=Math.min(t.x,i.x)-n&&e.x<=Math.max(t.x,i.x)+n&&e.y>=Math.min(t.y,i.y)-n&&e.y<=Math.max(t.y,i.y)+n},getDistanceFromPointToLine:function(e,t,i){if(t.x===i.x)return Math.abs(e.x-t.x);var n=(i.y-t.y)/(i.x-t.x),a=(i.x*t.y-t.x*i.y)/(i.x-t.x);return Math.abs(n*e.x-e.y+a)/Math.sqrt(n*n+1)},setOffsetYofPoints:function(e){this.offsetY=e},setOffsetXofPoints:function(e){this.offsetX=e},getOffsetYofPoints:function(){return this.offsetY},getOffsetXofPoints:function(){return this.offsetX},setNegatedYInterval:function(e){this.negatedYInterval=e},getNegatedYInterval:function(){return this.negatedYInterval}}),ImageShapeNodeUI=function(){ImageShapeNodeUI.superClass.constructor.apply(this,arguments)},twaver.Util.ext("ImageShapeNodeUI",twaver.vector.ShapeNodeUI,{drawDefaultBody:function(e){var t=this._element;if(t._points&&!(t._points.size()<1)){var i=this._getZoomPoints(),n=t._segments,a=t.getStyle("vector.outline.width"),o=t.getStyle("vector.outline.pattern"),r=t.getStyle("vector.outline.width"),s=t.getStyle("vector.outline.color"),l=t.getClient("shapenode.closed"),d=twaver.Util.getRect(i),c=e;
a>0&&twaver.Util.grow(d,a,a);var h,u=this._network.isSelected(this._element),g=this._element.getClient("resizeBorderWidth"),m=this._element.getClient("resizeBorderLength"),p=this._element.getClient("resizeBorderGap"),f=this._element.getClient("resizeBorderColor"),v=t.getClient("showDim"),y=t.getClient("showCoord");u&&(h=_twaver.clone(d)),c=this.setShadow(this,c),c.beginPath();var b=twaver.Util.getImageAsset(t.getClient(IMAGE_SRC));b&&(c.fillStyle=c.createPattern(b.getImage(),"repeat")),c.lineWidth=r,c.strokeStyle=s,_twaver.g.drawLinePoints(c,i,o,n,l),t.getClient("fill")&&c.fill(),c.stroke();var C=t.getClient("focusIndex");if(C>=0){var w=i.get(C),S=i.get(C===i.size()-1?0:C+1);c.beginPath(),c.strokeStyle=t.getClient("focusColor"),c.moveTo(w.x,w.y),c.lineTo(S.x,S.y),c.stroke()}if(u){c.lineWidth=g+2,c.strokeStyle="black",c.beginPath(),this._borderLines=[];var x,I,P;x={x:h.x-p,y:h.y-p},I={x:x.x,y:x.y+m},P={x:x.x+m,y:x.y},this._addBorderLine(c,x,I,P),x={x:h.x+h.width+p,y:h.y-p},I={x:x.x-m,y:x.y},P={x:x.x,y:x.y+m},this._addBorderLine(c,x,I,P),x={x:h.x+h.width+p,y:h.y+h.height+p},I={x:x.x,y:x.y-m},P={x:x.x-m,y:x.y},this._addBorderLine(c,x,I,P),x={x:h.x-p,y:h.y+h.height+p},I={x:x.x+m,y:x.y},P={x:x.x,y:x.y-m},this._addBorderLine(c,x,I,P),c.stroke(),c.beginPath(),c.lineWidth=g,c.strokeStyle=f,m-=1,x={x:h.x-p,y:h.y-p},I={x:x.x,y:x.y+m},P={x:x.x+m,y:x.y},c.moveTo(I.x,I.y),c.lineTo(x.x,x.y),c.lineTo(P.x,P.y),x={x:h.x+h.width+p,y:h.y-p},I={x:x.x-m,y:x.y},P={x:x.x,y:x.y+m},c.moveTo(I.x,I.y),c.lineTo(x.x,x.y),c.lineTo(P.x,P.y),x={x:h.x+h.width+p,y:h.y+h.height+p},I={x:x.x,y:x.y-m},P={x:x.x-m,y:x.y},c.moveTo(I.x,I.y),c.lineTo(x.x,x.y),c.lineTo(P.x,P.y),x={x:h.x-p,y:h.y+h.height+p},I={x:x.x+m,y:x.y},P={x:x.x,y:x.y-m},c.moveTo(I.x,I.y),c.lineTo(x.x,x.y),c.lineTo(P.x,P.y),c.stroke()}u&&(y&&this.drawCoord(c),v&&this.drawDim(c))}},validateBodyBounds:function(){ImageShapeNodeUI.superClass.validateBodyBounds.call(this);var e=this._element;if(e._points&&!(e._points.size()<1)){var t=this._getZoomPoints();if(!(t.size()<2)){var i=e.getStyle("vector.outline.width"),n=this.getPathRect("vector",!0);i>0&&twaver.Util.grow(n,i,i);var a=this._network.isSelected(this._element),o=this._element.getClient("resizeBorderWidth"),r=this._element.getClient("resizeBorderGap");a&&twaver.Util.grow(n,(o+r)/this._network.getZoom()*2+2,(o+r)/this._network.getZoom()*2+2),this.addBodyBounds(n)}}},_addBorderLine:function(e,t,i,n){this._borderLines.push({point1:i,point2:t}),this._borderLines.push({point1:t,point2:n}),e.moveTo(i.x,i.y),e.lineTo(t.x,t.y),e.lineTo(n.x,n.y)},isPointOnBorderLine:function(e){if(!this._borderLines)return null;for(var t=this._element.getClient("resizeBorderWidth"),i=0;i<this._borderLines.length;i++){var n=this._borderLines[i];if(this._element.isPointOnLine(e,n.point1,n.point2,t))return Math.floor(i/2)}return null},drawDim:function(e){function t(e,t,a){var o=_twaver.math.getCenterPoint(e,t),r=angle1=_twaver.math.getAngle(e,t);t.x<e.x&&(r=Math.PI+r);var s=a.toFixed(2),c=n.measureText(s).width,h=_twaver.math.createMatrix(r,e.x,e.y),g=h.transform({x:e.x,y:e.y-l}),f=h.transform({x:e.x,y:e.y-l*d});h=_twaver.math.createMatrix(r,t.x,t.y);var v=h.transform({x:t.x,y:t.y-l}),y=h.transform({x:t.x,y:t.y-l*d}),b=i.getPointBetween(f,y,.5-(c/2+u)/a),C=i.getPointBetween(f,y,.5+(c/2+u)/a),w=i.getPointBetween(f,y,m/a);h=_twaver.math.createMatrix(r,w.x,w.y);var S=h.transform({x:w.x,y:w.y-p}),x=h.transform({x:w.x,y:w.y+p}),I=i.getPointBetween(f,y,1-m/a);h=_twaver.math.createMatrix(r,I.x,I.y);var P=h.transform({x:I.x,y:I.y-p}),_=h.transform({x:I.x,y:I.y+p});n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(g.x,g.y),n.moveTo(t.x,t.y),n.lineTo(v.x,v.y),n.moveTo(f.x,f.y),n.lineTo(b.x,b.y),n.moveTo(C.x,C.y),n.lineTo(y.x,y.y),n.moveTo(f.x,f.y),n.lineTo(S.x,S.y),n.moveTo(f.x,f.y),n.lineTo(x.x,x.y),n.moveTo(y.x,y.y),n.lineTo(P.x,P.y),n.moveTo(y.x,y.y),n.lineTo(_.x,_.y),n.stroke(),n.save(),o={x:(f.x+y.x)/2,y:(f.y+y.y)/2},n.translate(o.x,o.y),n.rotate(angle1),n.translate(-o.x,-o.y),n.fillText(s,o.x,o.y),n.restore()}var i=this,n=e,a=this._element,o=this._getZoomPoints(),r=a.getPoints();if(o&&!(o.size()<2)&&this._network.isSelected(a)){var s=this.getBodyRect(),l=a.getClient("dimLeadLength"),d=a.getClient("dimLineOffset"),c=a.getClient("dimLineWidth"),h=a.getClient("dimColor"),u=a.getClient("dimTextGap"),g=a.getClient("dimTextFont"),m=a.getClient("dimArrowWidth"),p=a.getClient("dimArrowHeight"),f={x:s.x-l,y:s.y-l,width:s.width+2*l,height:s.height+2*l};this.isClockwise()&&(l=-l),this.addBodyBounds(f),n=this.setShadow(this,n),n.strokeStyle=h,n.lineWidth=c,n.fillStyle=h,n.font=g,n.textAlign="center",n.textBaseline="middle";for(var v=o.get(0),y=r.get(0),b=1,C=o.size();C>b;b++){var w=o.get(b),S=r.get(b),x=_twaver.math.getDistance(y,S);y=S,t(v,w,x),v=w}if(C>2){var x=_twaver.math.getDistance(y,r.get(0));t(v,o.get(0),x)}}},getPointBetween:function(e,t,i){return{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}},isClockwise:function(e){var t=this._element,e=t.getPoints();if(!e||e.size()<2)return!0;for(var i=0,n=e.size(),a=0;n>a;a++){var o=e.get(a),r=e.get(a+1===n?0:a+1);i+=(r.x-o.x)*(r.y+o.y)}return i>0},drawCoord:function(e){var t=e,i=this._element,n=this._getZoomPoints(),a=i.getPoints();if(n&&a){var o=this.getBodyRect(),r=i.getClient("coordTextColor"),s=i.getClient("coordTextFont"),l=i.getClient("coordTextOffsetX"),d=i.getClient("coordTextOffsetY"),c=i.getClient("coordTextAlign"),h=i.getClient("coordTextBaseline"),u=i.getClient("coordTextBackground"),g=i.getClient("decimalNumber"),m={x:o.x-100,y:o.y-50,width:o.width+200,height:o.height+100};this.addBodyBounds(m),t=this.setShadow(this,t),t.save(),t.font=s;for(var p=0,f=n.size();f>p;p++){var v=n.get(p),y=a.get(p),b="("+(v.x+i.getOffsetXofPoints()).toFixed(g)+", "+(v.y*(i.getNegatedYInterval()?-1:1)+i.getOffsetYofPoints()).toFixed(g)+")";y&&(b="("+(y.x+i.getOffsetXofPoints()).toFixed(g)+", "+(y.y*(i.getNegatedYInterval()?-1:1)+i.getOffsetYofPoints()).toFixed(g)+")");var C=_twaver.g.getTextSize(t.font,b);t.fillStyle=u,t.fillRect(v.x-C.width/2+l,v.y-C.height/2+d,C.width,C.height),t.fillStyle=r,t.textAlign=c,t.textBaseline=h,t.fillText(b,v.x,v.y+d)}t.restore()}}}),FloorShapeNode=function(){FloorShapeNode.superClass.constructor.apply(this,arguments),this.setClient(IMAGE_SRC,Utils.Path+"floor02_3d.png"),this.setStyle("vector.outline.color","#FFFFFF"),this.setStyle("vector.outline.width",0),this.setClient("shapenode.closed",!0),this.setClient("focusColor","blue"),this.setClient("repeat",100),this.setClient("size",{x:0,y:0,z:.1}),this.setClient("transparent",!1),this.setClient("opacity",1)},twaver.Util.ext("FloorShapeNode",ImageShapeNode,{translate3d:function(e){var t=this.getPoints(),i=t.size(),n=this.getCenterLocation(),a=new twaver.List;if(t.forEach(function(e){a.add({x:e.x-n.x,y:e.y-n.y})}),!(0>=i||2>=i)){for(var o=this.getClient("floorHeight"),r=this.getClient("floorName"),s=this.getClient("transparent"),l=this.getClient("opacity"),d=Utils.handlerTexture(""===this.getClient(IMAGE_SRC)?null:this.getClient(IMAGE_SRC)),c=this.getClient("repeat"),h=this.getClient(CUSTOM_PROPS),u=this.getClient(PropertyConsts.LAYERID),g=new mono.Path,m=0;i>m;m++){var p=a.get(m);0==m?g.moveTo(p.x,-p.y,0):g.lineTo(p.x,-p.y,0)}var f=.1,i=this.getClient("size");i&&(f=i.z),f=parseFloat(f||1);var v=e.getDataById(this.getId());if(!v)var v=new mono.ShapeNode({id:this.getId(),path:g});return o=(o||0)-1,v.setPath(g),v.setPositionX(n.x),v.setPositionZ(n.y),v.setAmount(f),v.setVertical(!0),v.setRepeat(c),v.setStyle("m.texture.image",d),v.setStyle("m.type","phong"),v.setStyle("m.transparent",s),v.setStyle("m.opacity",l),v.setClient("floorName",r),v.setPositionY(o),v.setSelectable(!1),Utils.setElementCustomProps(this,v,h),u&&v.setClient(PropertyConsts.LAYERID,u),e.getDataById(this.getId())||e.add(v),v}}}),PipeShapeNode=function(){PipeShapeNode.superClass.constructor.apply(this,arguments),this.setClient(IMAGE_SRC,Utils.Path+"default_texture.png"),this.setStyle("vector.outline.color","red"),this.setStyle("vector.outline.width",5),this.setClient("shapenode.closed",!0),this.setClient("focusColor","blue"),this.setClient("shapenode.closed",!1),this.setClient("fill",!1),this.setClient("radius",10),this.setClient("segments",20),this.setClient("positionY",100),this.setClient("startCap","none"),this.setClient("endCap","none"),this.setClient("startCapSize","1"),this.setClient("endCapSize","1"),this.setClient("repeat",{row:100,column:3}),this.setClient("pointPositions",{}),this.setClient("adjust",!1),this.setClient("adjust.degree",10),this.setClient("transparent",!1),this.setClient("opacity",1)},twaver.Util.ext("PipeShapeNode",ImageShapeNode,{getPointPositionY:function(e){var t=this.getClient("floorHeight"),i=""+e,n=this.getClient("pointPositions")[i];return parseInt(n?n+t:this.getClient("positionY")+t)},translate3d:function(e){var t=this.getClient("floorName"),i=this.getPoints(),n=this.getClient("startCap"),a=this.getClient("endCap"),o=this.getClient("startCapSize"),r=this.getClient("endCapSize"),s=this.getClient("transparent"),l=this.getClient("opacity"),d=this.getClient(CUSTOM_PROPS),c=this.getClient(PropertyConsts.LAYERID),h=new mono.Path;if(i&&i.size()>1){h.moveTo(i.get(0).x,this.getPointPositionY(0),i.get(0).y);for(var u=1;u<i.size();u++)h.lineTo(i.get(u).x,this.getPointPositionY(u),i.get(u).y)}var g=parseInt(this.getClient("radius"));h=this.adjustPath(h);var m=parseInt(this.getClient("segments")),p=e.getDataById(this.getId());p||(p=new mono.PathNode({id:this.getId()})),p.setPath(h),p.setSegments(m),p.setRadius(g),p.setSegmentsR(50),p.setStartCap(n),p.setEndCap(a),p.setStartCapSize(o),p.setEndCapSize(r);var f=""===this.getClient(IMAGE_SRC)?null:this.getClient(IMAGE_SRC),v=this.getClient("repeat");return v||(v={row:100,column:3}),p.setStyle("m.texture.image",f),p.setStyle("m.texture.wrapS",mono.RepeatWrapping),p.setStyle("m.texture.wrapT",mono.RepeatWrapping),p.setStyle("m.texture.repeat",new mono.Vec2(v.row,v.column)),p.setStyle("m.side",mono.DoubleSide),p.setStyle("m.type","phong"),p.setStyle("m.transparent",s),p.setStyle("m.opacity",l),p.setEditable(!1),p.setSelectable(!1),p.setClient("floorName",t),Utils.setElementCustomProps(this,p,d),c&&p.setClient(PropertyConsts.LAYERID,c),e.getDataById(this.getId())||e.add(p),p},adjustPath:function(e){if(this.getClient("adjust")){var t=this.getClient("adjust.degree")||10,i=parseInt(this.getClient("radius"));return mono.PathNode.prototype.adjustPath(e,i,t)}return e}}),RoundPipeShapeNode=function(){RoundPipeShapeNode.superClass.constructor.apply(this,arguments),this.setClient("adjust",!0),this.setStyle("vector.outline.color","green")},twaver.Util.ext("RoundPipeShapeNode",PipeShapeNode,{}),ImageNode=function(){ImageNode.superClass.constructor.apply(this,arguments)},twaver.Util.ext("ImageNode",twaver.Node,{getElementUIClass:function(){return ImageNodeUI}}),ImageNodeUI=function(){ImageNodeUI.superClass.constructor.apply(this,arguments),this._nodeCanvas=twaver.Util.createCanvas()},twaver.Util.ext("ImageNodeUI",twaver.network.NodeUI,{drawDefaultBody:function(){var e=this._element,t=_twaver.getImageAsset(e.getImage()),i=this.getBodyRect();if(!t)return this.addBodyBounds(i),void(this._currentImageAsset=null);_twaver.math.addPadding(i,this._element,"image.padding",1);var n=e.getClient("repeat");if(t.getImage()){this._nodeCanvas||(this._nodeCanvas=_twaver.html.createCanvas());var a=_twaver.clone(i),o=this.setShadow(this,this._nodeCanvas,a);if(n)for(var r=n[0],s=n[1],l=0;r>l;l++)for(var d=0;s>d;d++)o.drawImage(t.getImage(this._innerColor,i.width/r,i.height/s),i.x+i.width/r*l,i.y+i.height/s*d,i.width/r,i.height/s);else o.drawImage(t.getImage(this._innerColor,i.width,i.height),i.x,i.y,i.width,i.height);i=a,this.addComponent(this._nodeCanvas)}else if(t.getSrc())this._nodeImage||(this._nodeImage=_twaver.html.createImg()),_twaver.html.setImg(this._nodeImage,t.getSrc(),i),this.addComponent(this._nodeImage);else{if(!t.getFunction())throw"ImageAsset '"+e.getImage()+" ' is empty";this._nodeComponent=this._currentImageAsset!==t?t.getFunction()(this,i):t.getFunction()(this,i,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=_twaver.clone(i)}this.addBodyBounds(i),this._currentImageAsset=t}}),Block=function(){Block.superClass.constructor.apply(this,arguments),this.setClient("length",90),this.setClient("edgeIndex",-1),this.setClient("offset",.5),this.setClient("gap",0),this.setClient("angle",0),this.setClient("focus",!1),this.setStyle("vector.outline.width",2),this.setStyle("vector.outline.color","gray"),this.setStyle("vector.fill.color","white"),this.setSize(0,0),this.setClient("fullWidth",!1),this.setClient("horizontalFlip",!1),this.setImage("image_block"),this.isDoor()&&(this.blockPicture=this.blockPicture||Utils.Path+"door00_3d.png",this.blockWidth=this.blockWidth||80,this.blockHeight=this.blockHeight||200,this.positionY=this.positionY||0),this.isWindow()&&(this.blockPicture=this.blockPicture||Utils.Path+"window00_3d.png",this.blockWidth=this.blockWidth||100,this.blockHeight=this.blockHeight||120,this.positionY=this.positionY||(this.height-this.blockHeight)/2);var e=this.getClient("transparent"),t=this.getClient("opacity");this.setStyle("m.transparent",e),this.setStyle("m.opacity",t),this.isCutoff()&&(this.blockWidth=this.blockWidth||100,this.blockHeight=this.blockHeight||100,this.positionY=this.positionY||(this.height-this.blockHeight)/2,this.blockPicture||(this.blockPicture=new mono.BasicMaterial({color:"green",transparent:!0,opacity:.5}))),this.setClient("height",this.blockHeight),this.setClient("positionY",this.positionY)},twaver.Util.ext("Block",twaver.Node,{onPropertyChanged:function(e){Block.superClass.onPropertyChanged.call(this,e),!this.getParent()||"C:length"!==e.property&&"C:edgeIndex"!==e.property&&"C:offset"!==e.property&&"C:gap"!==e.property||this.refresh()},refresh:function(){var e=this.getParent(),t=this.getClient("edgeIndex"),i=this.getClient("offset"),n=e.getPoints();if(n&&t>=0&&t<n.size()){var a=n.get(t),o=n.get(t===n.size()-1?0:t+1),r=o.x-a.x,s=o.y-a.y,l={x:a.x+r*i,y:a.y+s*i},d=this.getAngle(r,s),c=this.getStyle("vector.outline.width"),h=this.getClient("gap"),u=this.getClient("length")/2+c/2,g=e.getStyle("vector.outline.width")/2+c/2+h,m=twaver.Util.getRect([twaver.Util.transformPoint(l,d,-u,-g).point,twaver.Util.transformPoint(l,d,u,-g).point,twaver.Util.transformPoint(l,d,u,g).point,twaver.Util.transformPoint(l,d,-u,g).point]);this.setSize(m.width,m.height),this.setCenterLocation(l),this.setClient("angle",d),this.setClient("leftPoint",twaver.Util.transformPoint(l,d,-u,0).point),this.setClient("rightPoint",twaver.Util.transformPoint(l,d,u,0).point)}},getAngle:function(e,t){return 0===e?0===t?0:t>0?Math.PI/2:-Math.PI/2:Math.atan(t/e)},getEdgeIndex:function(){return this.getClient("edgeIndex")},isDoor:function(){return this instanceof Door},isWindow:function(){return this instanceof Window},isCutoff:function(){return this instanceof Cutoff},getBlockWidth:function(){return Math.abs(this.getClient("length"))},getBlockHeight:function(){return Math.abs(this.getClient("height"))},getBlockPicture:function(){return this.getClient("picture")},getBlockPositionY:function(){return Math.abs(this.getClient("positionY"))}}),Door=function(){Door.superClass.constructor.apply(this,arguments),this.setClient("positionY",0)},twaver.Util.ext("Door",Block,{}),Window=function(){Window.superClass.constructor.apply(this,arguments),this.setClient("positionY",100)},twaver.Util.ext("Window",Block,{}),Cutoff=function(){Cutoff.superClass.constructor.apply(this,arguments),this.setClient("positionY",100)},twaver.Util.ext("Cutoff",Block,{}),twaver.Util.registerImage("image_block",{rotate:'<%=getClient("angle")*180/Math.PI%>',diameter:function(e){var t=10,i=e.getParent();return i&&(t=i.getStyle("vector.outline.width")+2*e.getClient("gap")),t/network.getZoom()},v:[{shape:"rect",rect:function(e){var t=e.getClient("length");t&&(t=Math.abs(t));var i=e.getParent(),n=10;i&&(n=i.getStyle("vector.outline.width")+2*e.getClient("gap"));var a=this.diameter(e);return t>a&&(t-=a),n/=network.getZoom(),[-t/2,-n/2,t,n]},lineWidth:'<%=getStyle("vector.outline.width")%>',lineColor:'<%if(getClient("focus")){return "green"}else{return getStyle("vector.outline.color")}%>',fill:'<%=getStyle("vector.fill.color")%>'},{shape:"line",x1:function(e){if(e instanceof Window||e instanceof Door){var t=e.getClient("length");t&&(t=Math.abs(t));var i=this.diameter(e);return t>i&&(t-=i),-t/2}return 0},y1:0,x2:function(e){if(e instanceof Window||e instanceof Door){var t=e.getClient("length");t&&(t=Math.abs(t));var i=this.diameter(e);return t>i&&(t-=i),t/2}return 0},y2:0,lineWidth:1,lineColor:'<%if(getClient("focus")){return "green"}else{return getStyle("vector.outline.color")}%>',lineDash:function(e){return e instanceof Window?[10,2]:void 0}},{shape:"circle",cx:function(e){var t=e.getClient("length");t&&(t=Math.abs(t));var i=this.diameter(e);return t>i&&(t-=i),-t/2},cy:0,r:function(e){if(null==network||!network.getSelectionModel().contains(e))return 0;var t=e.getParent(),i=10;return t&&(i=t.getStyle("vector.outline.width")+2*e.getClient("gap")),i/=network.getZoom(),i/2},lineWidth:1,fill:"yellow",stroke:"black"},{shape:"circle",cx:function(e){var t=e.getClient("length");t&&(t=Math.abs(t));var i=this.diameter(e);return t>i&&(t-=i),t/2},cy:0,r:function(e){if(null==network||!network.getSelectionModel().contains(e))return 0;var t=e.getParent(),i=10;return t&&(i=t.getStyle("vector.outline.width")+2*e.getClient("gap")),i/=network.getZoom(),i/2},lineWidth:1,fill:"yellow",stroke:"black"}]}),mono.Floor=function(e){this.material=new mono.EntityMaterial,this.materialSize=1,mono.BufferNode.call(this),this.points=e._as?e._as:e,this.points=split(this.points),this.compuateBufferData(),this.renderDepth=1e3},mono.extend(mono.Floor,mono.BufferNode,{constructor:mono.Floor,fixCenter:function(){var e=new Array;if(this.points){for(var t=0,i=0,n=0;n<this.points.length;n++){var a=this.points[n];t+=a.x,i+=a.y}t/=this.points.length,i/=this.points.length;for(var n=0;n<this.points.length;n++){var a=this.points[n];e.push({x:a.x-t,y:a.y-i})}this.points=e,this.setPosition(new mono.Vec3(a.x,0,a.y))}},compuateBufferData:function(){for(var e={},t=0,i=0,n=0,a=0,o=0,i=0;i<this.points.length;i++){var r=this.points[i];n+=3*r.length,a+=3*(r.length-2),o+=2*r.length}var s=new Float32Array(n);for(e.array=s,e.itemSize=3,e.numItems=n,this.attributes.position=e,i=0;i<this.points.length;i++)for(var r=this.points[i],l=0;l<r.length;l++){var d=r[l],c=d.length?d[0]:d.x,h=d.length?d[1]:d.y;s[t]=c,s[t+1]=0,s[t+2]=h,t+=3}this.offsets=[{index:0,count:a}];var u={};u.array=new Uint16Array(a),this.attributes.index=u,t=0;var g=0;for(i=0;i<this.points.length;i++){for(var r=this.points[i],l=0;l<r.length-2;l++)u.array[t]=g,u.array[t+1]=g+l+1,u.array[t+2]=g+l+2,t+=3;g+=r.length}var m={};m.itemSize=2,m.numItems=o,m.array=new Float32Array(o),this.attributes.uv=m;var p=this.getRect();for(t=0,i=0;i<this.points.length;i++)for(var r=this.points[i],l=0;l<r.length;l++){var d=r[l],c=d.length?d[0]:d.x,f=d.length?d[1]:d.y,v=(c-p.x)/p.width,y=(f-p.y)/p.height;m.array[t]=v,m.array[t+1]=y,t+=2}this.verticesNeedUpdate=!0,this.elementsNeedUpdate=!0,this.uvsNeedUpdate=!0},getRect:function(){for(var e=null,t=0;t<this.points.length;t++){var i=this.points[t];if(null===e)e=this.getPointsRect(i);else{var n=this.getPointsRect(i);e=this.unionRect(e,n)}}return e},unionRect:function(e,t){if(e&&t){var i={};return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i.width=Math.max(e.x+e.width,t.x+t.width)-i.x,i.height=Math.max(e.y+e.height,t.y+t.height)-i.y,i}return null},getPointsRect:function(e){if(!e)return null;e._as&&(e=e._as);var t=e.length;if(0>=t)return null;for(var i=e[0],n=i.length?i[0]:i.x,a=i.length?i[1]:i.y,o={x:n,y:a,width:0,height:0},r=1;t>r;r++){i=e[r];var n=i.length?i[0]:i.x,a=i.length?i[1]:i.y,s=Math.min(o.x,n),l=Math.max(o.x+o.width,n),d=Math.min(o.y,a),c=Math.max(o.y+o.height,a);o.x=s,o.y=d,o.width=l-s,o.height=c-d}return o}}),PrimitiveNode=function(){PrimitiveNode.superClass.constructor.apply(this,arguments),this.setClient("oscale",100),this.setClient("scaleFont","18px Verdana"),this.setClient("scaleColor","black"),this.setClient("maskColor","white"),this.setClient("maskAlpha",.5),this.setClient("tipsFont","12px Calibri"),this.setClient("tips","Scroll to Scale"),this.setClient("selectedColor","yellow"),this.setStyle("label.position","center"),this.setStyle("select.style","null"),this.setClient("vertical",!0),this.setImage("primitiveNode_Image")},twaver.Util.ext("PrimitiveNode",twaver.Follower,{translate3d:function(e){var t=this.getClient("scale"),i=this.getClient("oscale"),n=this.getClient("size"),a=this.getClient("assembleSize"),o=this.getClient("rot"),r=this.getClient("texture"),s=this.getClient("className"),l=this.getClient("transparent"),d=this.getClient("opacity"),c=null,h=this.getClient(CUSTOM_PROPS),u=this.getClient("vertical"),g=this.getClient(PropertyConsts.LAYERID);c=r?r instanceof Array?r:r instanceof twaver.List?r.toArray():r.indexOf(Utils.Path)>=0?r:Utils.Path+r:Utils.Path+PropertyConsts.DEFAULT_IMAGE,this.setClient(IMAGE_SRC,c);var m=this.getClient("repeat"),p=this.getClient("types"),f=this.getClient("colors"),v=this.getClient("visible"),y=this.getClient("other"),b=this.getClient("positionY"),C=this.getClient("floorHeight"),w=this.getClient("flipX"),S=this.getClient("flipY"),x=new MaterialDesc;c instanceof Array&&(x.tType=c.length),x.texture=c,m&&m instanceof twaver.List&&(m=m.toArray()),(m instanceof Array&&m.length>0||!m instanceof Array)&&(x.repeat=m),p&&(p instanceof twaver.List&&(p=p.toArray()),(p instanceof Array&&p.length>0||!p instanceof Array)&&(x.type=p)),f&&(f instanceof twaver.List&&(f=f.toArray()),(f instanceof Array&&f.length>0||!f instanceof Array)&&(x.color=f)),l&&(l instanceof twaver.List&&(l=l.toArray()),(l instanceof Array&&l.length>0||!l instanceof Array)&&(x.transparent=l)),d&&(d instanceof twaver.List&&(d=d.toArray()),x.opacity=d),v&&(v instanceof twaver.List&&(v=v.toArray()),(v instanceof Array&&v.length>0||!v instanceof Array)&&(x.visible=v)),w&&(w instanceof twaver.List&&(w=w.toArray()),(w instanceof Array&&w.length>0||!w instanceof Array)&&(x.flipX=w)),S&&(S instanceof twaver.List&&(S=S.toArray()),(S instanceof Array&&S.length>0||!S instanceof Array)&&(x.flipY=S)),y&&Utils.isNotNull(y.openTop)&&(x.openTop=y.openTop),y&&Utils.isNotNull(y.openBottom)&&(x.openBottom=y.openBottom),x.color=this.getClient("colors"),x.ambient=this.getClient("ambient"),y=y||{},n=n||a,y.id=this.getId();var I=this.get3DShape(x,s,n,y,e);if(I.setName(this.getClient("primitiveName")),I){Utils.setElementCustomProps(this,I,h),g&&I.setClient(PropertyConsts.LAYERID,g);var P=this.getClient(OID);P&&I.setClient(OID,P);var _=this.getClient(BID);_&&I.setClient(BID,_),o&&I.setRotation(o.x,o.y,o.z),Utils.isNotNull(this.getAngle())&&0!=this.getAngle()&&(isSettingRotation=!0,I.setRotation(0,0,0),isSettingRotation=!1,I.rotateFromWorldYAxis(Utils.convert2Radian(-this.getAngle())));var E=this.getCenterLocation();if(null==this.getHost()||this.getHost()instanceof FloorShapeNode){if(E){I.setPositionX(E.x),I.setPositionY(a?a.y/2:0),I.setPositionZ(E.y);var T=this.getClient("off");T&&(I.setPositionX(E.x-T.x),I.setPositionZ(E.y-T.z))}}else if(E){var A=this.getClient("position");A&&I.setPosition(A.x,A.y,A.z)}var t=this.getClient("scale");t||(t=new mono.Vec3(1,1,1)),t&&(i&&(i/=100,t=new mono.Vec3(t.x*i,t.y*i,t.z*i),I.setPositionY(I.getPosition().y*i)),I.setScale(t)),void 0!==u&&I.setStyle("m.vertical",u),b=b?b:0,I.setPositionY(I.getPosition().y+b),C&&I.setPositionY(I.getPosition().y+C),I.setEditable(!0),I.setSelectable(!0);var L=this.getClient(TAG_ANIMATION);L&&I.setClient(TAG_ANIMATION,L);var N=this.getClient("animationGroup");N&&I.setClient("animationGroup",N);var k=this.getClient("mainVisible");Utils.isNotNull(k)&&(I.setClient("mainVisible",k),I.setStyle("m.transparent",!0),I.setStyle("m.opacity",.001)),I.setClient("floorName",this.getClient("floorName")),I.setGroupId(this.getClient("groupid")),I.setClient("nodeId",this.getId()),this.getClient("isEntity")&&I.setClient("isEntity",!0);var O=parseFloat(this.getClient("scaleValue"));if(O)if(I instanceof mono.Billboard){I.setPositionX(parseFloat(I.getPositionX()*O)),I.setPositionY(parseFloat(I.getPositionY()*O)),I.setPositionZ(parseFloat(I.getPositionZ()*O));var t=I.getScale();I.setScale(parseFloat(t.x*O),parseFloat(t.y*O),parseFloat(t.z*O))}else if(I instanceof mono.Cube){var D=I.getWidth(),R=I.getHeight(),M=I.getDepth();I.setWidth(D*O),I.setHeight(R*O),I.setDepth(M*O),this.getParent()&&(I.setPositionX(parseFloat(I.getPositionX()*O)),I.setPositionY(parseFloat(I.getPositionY()*O)),I.setPositionZ(parseFloat(I.getPositionZ()*O)))}else{I.setPositionX(parseFloat(I.getPositionX()*O)),I.setPositionY(parseFloat(I.getPositionY()*O)),I.setPositionZ(parseFloat(I.getPositionZ()*O));var t=I.getScale();I.setScale(parseFloat(t.x*O),parseFloat(t.y*O),parseFloat(t.z*O))}if(I instanceof mono.PointLight){if(this.getClient("lightPosition")){var B=this.getClient("lightPosition").split(",");3===B.length&&I.setPosition(new mono.Vec3(parseFloat(B[0]),parseFloat(B[1]),parseFloat(B[2])))}this.getClient("lightColor")&&I.setColor(this.getClient("lightColor")),this.getClient("lightIntensity")&&I.setIntensity(parseFloat(this.getClient("lightIntensity")))}if(I instanceof mono.SpotLight){if(this.getClient("lightPosition")){var B=this.getClient("lightPosition").split(",");3===B.length&&I.setPosition(new mono.Vec3(parseFloat(B[0]),parseFloat(B[1]),parseFloat(B[2])))}else I.setPositionY(100);this.getClient("lightColor")&&I.setColor(this.getClient("lightColor")),this.getClient("lightIntensity")&&I.setIntensity(parseFloat(this.getClient("lightIntensity"))),this.getClient("angle")&&I.setAngle(parseFloat(this.getClient("angle")))}return this.afterTranslate3d(I),I}},afterTranslate3d:function(e){mono.AniUtil.resetAnimatedFlag(e)},get3DShape:function(e,t,i,n,a){var o=$gt3d(e,t,i,null,null,null,null,n,this,a);return o.setSelectable(!0),o},getVectorUIClass:function(){return PrimitiveNodeUI}}),PrimitiveNodeUI=function(){PrimitiveNodeUI.superClass.constructor.apply(this,arguments)},twaver.Util.ext("PrimitiveNodeUI",twaver.vector.NodeUI,{validateBodyBounds:function(){PrimitiveNodeUI.superClass.validateBodyBounds.call(this);var e=this.getBodyRect();0!=this._element.getAngle()&&(e=this._element.getOriginalRect()),this.addBodyBounds(e)}}),twaver.Util.registerShape("triangle",function(e,t,i,n){var a=i.getOriginalRect(),o=a.width,r=a.height;o>12/n.getZoom()&&(o-=12/n.getZoom()),r>12/n.getZoom()&&(r-=12/n.getZoom()),e.moveTo(-o/2,r/2),e.lineTo(o/2,r/2),e.lineTo(0,0),e.lineTo(-o/2,r/2),e.closePath()}),twaver.Util.registerShape("small_triangle",function(e,t,i,n){if(i.getHost()){var a=i.getOriginalRect(),o=8/n.getZoom();o>a.width&&(o=a.width),o>a.height&&(o=a.height),a.height/2<o&&(o=0),e.moveTo(0,0),e.lineTo(0,o)}}),twaver.Util.registerImage("primitiveNode_Image",{v:[{shape:"rect",fill:function(e){var t=network.isSelected(e),i=e.getClient("maskColor");return t&&(i=e.getClient("selectedColor")),i},alpha:'<%=getClient("maskAlpha")%>',rect:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>12/network.getZoom()&&(i-=12/network.getZoom()),n>12/network.getZoom()&&(n-=12/network.getZoom()),[-i/2,-n/2,i,n]}},{shape:"rect",alpha:1,lineColor:"#927652",lineWidth:6,rect:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>6/network.getZoom()&&(i-=6/network.getZoom()),n>6/network.getZoom()&&(n-=6/network.getZoom()),[-i/2,-n/2,i,n]}},{shape:"line",fill:"gray",lineWidth:1,p1:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>12/network.getZoom()?i-=12/network.getZoom():i=0,n>12/network.getZoom()?n-=12/network.getZoom():n=0,{x:-i/2,y:-n/2}},p2:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>12/network.getZoom()?i-=12/network.getZoom():i=0,n>12/network.getZoom()?n-=12/network.getZoom():n=0,{x:i/2,y:n/2}}},{shape:"line",fill:"gray",lineWidth:1,p1:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>12/network.getZoom()?i-=12/network.getZoom():i=0,n>12/network.getZoom()?n-=12/network.getZoom():n=0,{x:-i/2,y:n/2}},p2:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>12/network.getZoom()?i-=12/network.getZoom():i=0,n>12/network.getZoom()?n-=12/network.getZoom():n=0,{x:i/2,y:-n/2}}},{shape:"triangle",fill:"#927652",data:{w:90,h:90},alpha:.4},{shape:"small_triangle",position:0,lineWidth:8,lineColor:"#927652",translate:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>17/network.getZoom()?i-=17/network.getZoom():i=0,n-=11/network.getZoom(),{x:-i/2,y:-n/2}}},{shape:"small_triangle",position:1,lineWidth:8,lineColor:"#927652",translate:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>17/network.getZoom()?i-=17/network.getZoom():i=0,n-=11/network.getZoom(),{x:i/2,y:-n/2}}},{shape:"small_triangle",position:0,lineWidth:8,lineColor:"#927652",translate:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>17/network.getZoom()?i-=17/network.getZoom():i=0,n-=25/network.getZoom(),{x:-i/2,y:n/2}}},{shape:"small_triangle",position:1,lineWidth:8,lineColor:"#927652",translate:function(e){var t=e.getOriginalRect(),i=t.width,n=t.height;return i>17/network.getZoom()?i-=17/network.getZoom():i=0,n-=25/network.getZoom(),{x:i/2,y:n/2}}}]}),InnerWallShapeNode=function(){InnerWallShapeNode.superClass.constructor.apply(this,arguments),this.setClient(IMAGE_SRC,Utils.Path+"room.png"),this.setStyle("vector.outline.color","#333333"),this.setStyle("vector.outline.width",5),this.setClient("shapenode.closed",!1),this.setClient("focusColor","green"),this.setClient("resizeBorderWidth",10),this.setClient("resizeBorderLength",25),this.setClient("resizeBorderGap",10),this.setClient("resizeBorderColor","yellow"),this.setClient("size",{x:0,y:230,z:4}),this.setClient("repeat",{row:1,column:1})},twaver.Util.ext("InnerWallShapeNode",ImageShapeNode,{translate3d:function(e,t,i){var n=this.getPoints(),a=n.size();if(!(0>=a)){for(var o=0;a>o;o++)this.setStyle("inner_wall_"+o,!0);return ImageShapeNode.prototype.translate3d.call(this,e,t,i)}}}),CGrid=function(e){CGrid.superClass.constructor.call(this,e);var t=document.createElement("div");t.style.width="21px",t.style.height="21px",t.style.border="1px solid black",this.setStyle("component.content",t),this.setStyle("component.visible",!0),this.setStyle("component.position","topright"),this.setStyle("component.fillcolor","#FF8000")},twaver.Util.ext("CGrid",twaver.Grid,{getElementUIClass:function(){return CGridUI},getVectorUIClass:function(){return CGridUI}}),CGridUI=function(e,t){CGridUI.superClass.constructor.call(this,e,t)},twaver.Util.ext(CGridUI,twaver.network.GridUI,{checkAttachments:function(){twaver.network.NodeUI.prototype.checkAttachments.call(this),this.checkComponentAttachment()},checkComponentAttachment:function(){!this._componentAttachment&&this._element.getStyle("component.content")&&(this._componentAttachment=new ComponentAttachment(this),this.addAttachment(this._componentAttachment)),this._componentAttachment&&!this._element.getStyle("component.visible")&&(this._componentAttachment.getView().style.display="none"),this._componentAttachment&&this._element.getStyle("component.visible")&&(this._componentAttachment.getView().style.display="block")},checkLabelAttachment:function(){var e=this._network.getLabel(this._element);null!=e&&""!==e?this._labelAttachment||(this._labelAttachment=new HtmlLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},drawGridBody:function(){var e=this.getStyle("grid.fill"),t=this.getStyle("grid.deep"),i=this.getStyle("grid.cell.deep");if(e||0!==t||0!==i){var n=this.getBodyRect(),a=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=document.createElement("canvas"),this._nodeCanvas.style.position="absolute",this._nodeCanvas.style.msTouchAction="none",this._nodeCanvas.width=0,this._nodeCanvas.height=0);
var o=_twaver.clone(n),r=this.setShadow(this,this._nodeCanvas,o);if(e&&(r.fillStyle=a,r.rect(n.x,n.y,n.width,n.height),r.fill(),this.addComponent(this._nodeCanvas)),0!=t&&_twaver.g.draw3DRect(r,a,t,n.x,n.y,n.width,n.height),0!=i)for(var s=this.getStyle("grid.row.count"),l=this.getStyle("grid.column.count"),d=0;s>d;d++)for(var c=0;l>c;c++){var h=this._element.getCellRect(d,c);null!=h&&_twaver.g.draw3DRect(r,"#FF8000",i,h.x,h.y,h.width,h.height)}this.addBodyBounds(o)}}}),ComponentAttachment=function(e,t){HtmlBasicAttachment.call(this,e,t)},twaver.Util.ext("ComponentAttachment",HtmlBasicAttachment,{updateMeasure:function(){var e=this._element.getStyle("component.content");e.parentNode&&e.parentNode==this._contentDiv||this._contentDiv.appendChild(e),this._fillColor=this._element.getStyle("component.fillcolor"),this._fillColor||(this._fillColor="blue"),HtmlBasicAttachment.prototype.updateMeasure.call(this)},getPosition:function(){return this.getStyle("component.position")},getDirection:function(){return this.getStyle("component.direction")},getPointerLength:function(){return this.getStyle("component.pointer.length")},getPointerWidth:function(){return this.getStyle("component.pointer.width")},isShadowable:function(){return!1},getCornerRadius:function(){var e=this.getStyle("component.corner.radius");return e?e:0},getPointerLength:function(){return 0},getPointerWidth:function(){return 0},getPosition:function(){var e=this.getStyle("component.position");return e?e:"top"},getXOffset:function(){var e=this.getStyle("component.xoffset");return e?e:0},getYOffset:function(){var e=this.getStyle("component.yoffset");return e?e:-10},getDirection:function(){var e=this.getStyle("component.direction");return e?e:"aboveright"},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor}}),TargetFlagNode=function(e){TargetFlagNode.superClass.constructor.apply(this,arguments),this.type=e||PointFlag.TARGET_POINT,this.type==PointFlag.ORIGINAL_POINT?(this.setImage("images/originalpoint.png"),this.setClient(SPACE_POS_Y,0)):(this.setImage("images/targetpoint.png"),this.setClient(SPACE_POS_Y,100)),this.showPoint=!0},twaver.Util.ext("TargetFlagNode",twaver.Follower,{isShowPoint:function(){return this.showPoint},setShowPoint:function(e){this.showPoint=e},getType:function(){return this.type}});var PointFlag={TARGET_POINT:"targetPoint",ORIGINAL_POINT:"originalPoint"};GridNetwork=function(e){GridNetwork.superClass.constructor.call(this,e),this.backgroundDiv=document.createElement("div");document.createElement("div")},twaver.Util.ext("GridNetwork",twaver.vector.Network,{_gridGap:50,_gridLineWidth:1,_gridLineColor:"#ccc",_gridIntervalLineColor:"#eee",_showGrid:!0,_scaleUnitValue:1,delay:twaver.Defaults.CALL_LATER_DELAY,_background:null,_showBackground:!1,_showTwoimensionAxis:!1,_getGridGap:function(){var e=localStorage.getItem("gridGap");return e?parseInt(e):20},resizeCanvas:function(){this.repaint()},repaint:function(){this.invalidateElementUIs()},getBackground:function(){return this._background},setBackground:function(e){this._background=e,this.invalidate(this.delay)},isShowBackground:function(){return this._showBackground},setShowBackground:function(e){this._showBackground=e,this.repaint()},setShowGrid:function(e){this._showGrid=e,this.repaint()},isShowGrid:function(){return this._showGrid},setGridGap:function(e){this._gridGap;this._gridGap=e,this.repaint()},getGridGap:function(){return this._gridGap},setGridLineWidth:function(e){this._gridLineWidth=e,this.repaint()},getGridLineWidth:function(){return this._gridLineWidth},setGridLineColor:function(e){this._gridLineColor=e,this.repaint()},getGridLineColor:function(){return this._gridLineColor},setCursorPosition:function(e){this.cursorPosition=e,this.repaint()},getCursorPosition:function(){return this.cursorPosition},paintGrid:function(e){var t=this.getViewRect(),i=t.x,n=t.y,a=t.width,o=t.height,r=e;if(this._showGrid){r.save(),r.clearRect(i,n,a,o);var s=this.getZoom(),l=this._gridGap*s;xOffset=i%l,yOffset=n%l,i=i-xOffset-l,n=n-yOffset-l,a+=Math.round(2*l),o+=Math.round(2*l),xFrom=i,xEnd=i+a,yFrom=n,yEnd=n+o;var d=Math.round(xFrom/l),c=Math.round(yFrom/l);r.beginPath(),r.lineWidth=this._gridLineWidth,r.strokeStyle=this._gridLineColor;for(var h=xFrom;xEnd>h;h+=l)d%2===0&&(r.moveTo(h,yFrom),r.lineTo(h,yFrom+o)),d++;for(var u=yFrom;yEnd>u;u+=l)c%2===0&&(r.moveTo(xFrom,u),r.lineTo(xFrom+a,u)),c++;r.stroke(),d=Math.round(xFrom/l),c=Math.round(yFrom/l),r.beginPath(),r.lineWidth=this._gridLineWidth,r.strokeStyle=this._gridIntervalLineColor;for(var h=xFrom;xEnd>h;h+=l)d%2!==0&&(r.moveTo(h,yFrom),r.lineTo(h,yFrom+o)),d++;for(var u=yFrom;yEnd>u;u+=l)c%2!==0&&(r.moveTo(xFrom,u),r.lineTo(xFrom+a,u)),c++;r.stroke(),r.restore()}if(this._showTwoimensionAxis){r.strokeStyle="black",r.fillStyle="black",r.font="normal 14px Arial",r.lineWidth=2,r.beginPath();var g=i+this._view.scrollLeft,m=n+this._view.clientHeight+this._view.scrollTop;Utils.paintArrow(r,{x:g+100,y:m-50},{x:g+100,y:m-150}),r.fillText("y",g+110,m-130),Utils.paintArrow(r,{x:g+100,y:m-50},{x:g+200,y:m-50},"right"),r.fillText("x",g+180,m-60),r.closePath(),r.stroke()}return},paintBottom:function(e,t){this.paintGrid(e,t)},setShowTwoimensionAxis:function(e){this._showTwoimensionAxis=e,this.repaint()},setScaleY:function(e){this.scaleY=e},setScaleYGap:function(e){this.scaleYGap=e},setScaleX:function(e){this.scaleX=e},setScaleXGap:function(e){this.scaleXGap=e}}),Ruler=function(e){Ruler.superClass.constructor.apply(this,arguments),this._view=this.createElement("div"),this._topRuler=this.createElement("canvas"),this._leftRuler=this.createElement("canvas"),this._initRuler(),this.setComponent(e),this.init(),this.invalidate()},twaver.Util.ext("Ruler",twaver.controls.ControlBase,{_defaultGap:10,_rulerWidth:20,_lineColor:"#888",_lineIntervalLineColor:"#ccc",_mousePoint:null,_showGuides:!0,onPropertyChanged:function(){this.invalidate()},init:function(){this._topRuler.visible&&this._view.appendChild(this._topRuler),this._leftRuler.visible&&this._view.appendChild(this._leftRuler),this._view.appendChild(this.component.getView?this.component.getView():this.component)},setComponent:function(e){var t=this.component,i=this;this.component=e,this.firePropertyChange("component",t,e),this.addViewPropertyChangeListener(e,this._handleViewPropertyChange),this.component.getView().addEventListener("mousemove",function(e){if(i._showGuides){var t=i.getAbsPostion(i.component._rootCanvas);i._mousePoint={x:e.clientX-t.left,y:e.clientY-t.top},i._drawRuler()}})},getAbsPostion:function(e){for(var t=0,i=0;e=e.offsetParent;)t+=e.offsetTop,i+=e.offsetLeft;return{left:i,top:t}},_initRuler:function(){this._topRuler.visible=!0,this._leftRuler.visible=!0,this._topRuler.style.borderBottom="1px solid "+this._lineColor,this._topRuler.style.borderLeft="1px solid "+this._lineColor,this._leftRuler.style.borderRight="1px solid "+this._lineColor,this._leftRuler.style.borderTop="1px solid "+this._lineColor},_drawRuler:function(){var e=this.getComponentViewRect(),t=this.getComponentZoom();this.calculateGap(t);var i=this.getGap(),n=e.x,a=e.y,o=e.width,r=e.height,s=n%(5*i),n=n-s-5*i-1,l=Math.round((e.x-s-5*i)/t),d=n-e.x;1===Math.abs(Math.round(n/(5*i))%2)&&(d-=5*i,l-=5*this._defaultGap);var c=o+10*i;if(e&&this._topRuler.visible){var h=Utils.transforAndScaleCanvasContext(this._topRuler);this._drawHRuler(h,d,l,i,c,this._rulerWidth)}var u=a%(5*i),a=a-u-5*i-1,g=Math.round((e.y-u-5*i)/t),m=a-e.y;1===Math.abs(Math.round(a/(5*i))%2)&&(m-=5*i,g-=5*this._defaultGap);var p=r+10*i;if(e&&this._leftRuler.visible){var h=Utils.transforAndScaleCanvasContext(this._leftRuler);this._drawVRuler(h,m,g,i,p,this._rulerWidth)}},_drawHRuler:function(e,t,i,n,a,o){e.clearRect(t,0,a,o),e.save(),e.strokeStyle=this._lineIntervalLineColor,e.beginPath(),e.lineWidth=1;for(var r=1,s=o,l=o-6,d=(this.getComponentZoom(),t+n);t+a>d;d+=n)l=o-6,r%5==0&&(l=o-10),r%10!==0&&(e.moveTo(d,s),e.lineTo(d,l)),r++;e.closePath(),e.stroke(),r=1,e.beginPath(),e.strokeStyle=this._lineColor;for(var d=t+n;t+a>d;d+=n)r%10===0&&(l=1,e.moveTo(d,s),e.lineTo(d,l)),r++;e.stroke(),e.restore(),e.save(),e.textBaseline="middle",e.font="11px Arial",e.fillStyle=this._lineColor;for(var c=i,h=t;t+a>h;h+=10*n,c+=10*this._defaultGap)e.fillText(c,h+5,8);e.restore(),this._showGuides&&this._mousePoint&&(e.save(),e.strokeStyle="#f07819",e.lineWidth=3,e.beginPath(),e.moveTo(this._mousePoint.x,0),e.lineTo(this._mousePoint.x,20),e.stroke(),e.restore())},_drawVRuler:function(e,t,i,n,a,o){e.clearRect(0,t,o,a),e.save(),e.strokeStyle=this._lineIntervalLineColor,e.beginPath(),e.lineWidth=1;for(var r=1,s=o,l=o-6,d=(this.getComponentZoom(),t+n);t+a>d;d+=n)l=o-6,r%5==0&&(l=o-10),r%10!==0&&(e.moveTo(s,d),e.lineTo(l,d)),r++;e.closePath(),e.stroke(),e.restore(),r=1,e.beginPath(),e.strokeStyle=this._lineColor;for(var d=t+n;t+a>d;d+=n)r%10===0&&(l=1,e.moveTo(s,d),e.lineTo(l,d)),r++;e.stroke(),e.restore(),e.save(),e.textBaseline="middle",e.textAlign="left",e.font="11px Arial",e.fillStyle=this._lineColor;for(var c=i,h=t;t+a>h;h+=10*n,c+=10*this._defaultGap){e.save();var u=_twaver.g.getTextSize(e.font,c),g={x:2,y:h-8,width:u.width,height:u.height};e.translate(g.x,g.y),e.rotate(3*Math.PI/2),e.translate(-g.x,-g.y),e.fillText(c,0,h-2),e.restore()}e.restore(),this._showGuides&&this._mousePoint&&(e.save(),e.strokeStyle="#f07819",e.lineWidth=3,e.beginPath(),e.moveTo(0,this._mousePoint.y),e.lineTo(20,this._mousePoint.y),e.stroke(),e.restore())},getComponentZoom:function(){return this.component.getZoom()||1},getGap:function(){var e=this.getComponentZoom();return this._defaultGap*e},calculateGap:function(e){this._defaultGap=.6>e?20:e>1.5?5:10},setShowGuides:function(e){this._showGuides;this._showGuides=e,this._drawRuler()},isShowGuides:function(){return this._showGuides},setShowRuler:function(e){var t=this._topRuler.visible;this._topRuler.visible=e,this._leftRuler.visible=e,e?(this.hasChildNode(this._view,this._topRuler)||this._view.appendChild(this._topRuler),this.hasChildNode(this._view,this._leftRuler)||this._view.appendChild(this._leftRuler)):(this.hasChildNode(this._view,this._topRuler)&&this._view.removeChild(this._topRuler),this.hasChildNode(this._view,this._leftRuler)&&this._view.removeChild(this._leftRuler)),this.firePropertyChange("showRuler",t,e)},hasChildNode:function(e,t){var i=e.childNodes;for(var n in i)if(i[n]==t)return!0;return!1},getComponentViewRect:function(){return this.component.getViewRect?this.component.getViewRect():null},addViewPropertyChangeListener:function(e,t){e&&e.addPropertyChangeListener&&e.addPropertyChangeListener(t,this)},_handleViewPropertyChange:function(e){var t=this;"viewRect"==e.property&&t._drawRuler()},createElement:function(e){return document.createElement(e)},validateImpl:function(){var e=this._view.offsetWidth,t=this._view.offsetHeight,i=0,n=0,a=0,o=0,r=0,s=0,l=e,d=t;this._topRuler.visible&&(i=this._rulerWidth,o=this._rulerWidth,s=this._rulerWidth),this._leftRuler.visible&&(n=this._rulerWidth,a=this._rulerWidth,r=this._rulerWidth),l=e-n,d=t-i,this._topRuler.visible&&(this._topRuler.width=l,this._topRuler.height=i,_twaver.setViewBounds(this._topRuler,{x:a,y:0,width:l,height:i}),Utils.transforAndScaleCanvasContext(this._topRuler,!0)),this._leftRuler.visible&&(this._leftRuler.width=n,this._leftRuler.height=d,_twaver.setViewBounds(this._leftRuler,{x:0,y:o,width:n,height:d}),Utils.transforAndScaleCanvasContext(this._leftRuler,!0)),this.component&&(_twaver.setViewBounds(this.component,{x:r,y:s,width:l,height:d}),Utils.transforAndScaleCanvasContext(this.component._rootCanvas,!0))}});var FloorPane=function(e){this.network=e,this.layerBox=e.getElementBox().getLayerBox(),this.findByFloorName=new twaver.QuickFinder(this.layerBox,"floorName","client"),this.tempLayerBox=new twaver.LayerBox,this.clientPros=["floorName","floorLayer","floorHeight","needClone","predefined","floorVisible","floorRef"],this.moveLayer=!0};twaver.Util.ext(FloorPane,Object,{oldValue:null,init:function(){var e=this;this.selectView=document.createElement("select"),this.selectView.setAttribute("class","selectView"),this.initFloors(),this.repaintBuilding(),this.selectView.onfocus=function(){e.oldValue=this.value;var t=e.getFloorByFloorName(this.value);t.getClient("floorRef")&&e.saveNetworkBackgroundData()},this.selectView.onchange=function(){e.onChangeItem(this)},this.layerBox.addDataBoxChangeListener(function(){e.repaintBuilding()}),this.layerBox.addHierarchyChangeListener(function(){e.repaintBuilding()})},initFloors:function(){this.addFloor("1st Floor",0),this.addFloor("Add New",null,null,null,!0),this.addFloor("Floor Management",null,null,null,!0)},addFloor:function(e,t,i,n,a){if(!e)return void alert("floor name can not be null");var o=this.getFloorByFloorName(e);if(o)throw'floor "'+e+'" already exist';var r=new twaver.Layer;r.setClient("floorName",e),r.setClient("floorLayer",!0),r.setClient("floorHeight",t),r.setClient("needClone",i),r.setClient("predefined",a),r.setClient("floorVisible",!0),r.setClient("floorRef",!1),n&&r.setClient("cloneFloorName",n),this.layerBox.add(r)},createItem:function(e){var t=document.createElement("option");t.innerHTML=e,t.setAttribute("value",e),this.selectView.appendChild(t)},repaintBuilding:function(){for(;this.selectView.hasChildNodes();)this.selectView.removeChild(this.selectView.firstChild);var e=this.getAllFloorLayers();if(e&&e.size()>0)for(var t=0;t<e.size();t++){var i=e.get(t);this.createItem(i.getClient("floorName"))}this.moveAllPredefinedLayersToBottom()},onChangeItem:function(){var e=this.getCurrentFloor();if(e){var t=e.getClient("floorName");if("Floor Management"===t)this.openFloorManagerDiv(),this.selectView.value=this.oldValue;else if("Add New"===t)this.openCreateFloorDiv(),this.selectView.value=this.oldValue;else{var e=this.getFloorByFloorName(this.selectView.value);this.network.setShowBackground(this.getFloorRefByFloorId(e.getId())?!1:!0),this.oldValue=this.selectView.value,this.network.invalidateElementVisibility()}}},saveNetworkBackgroundData:function(){var e=this,t=this.network.getElementBox(),i=t.getSelectionModel().getSelection(),n=i.toList();i.size()>0&&t.getSelectionModel().clearSelection();var a=this.network.isShowGrid();a&&this.network.setShowGrid(!1),setTimeout(function(){var i=e.network.toCanvas(e.network.getView().scrollWidth,e.network.getView().scrollHeight);networkBackgroundData=i.toDataURL(),e.network.setBackground(networkBackgroundData),n.size()>0&&t.getSelectionModel().setSelection(n),a&&e.network.setShowGrid(!0)},100)},openFloorManagerDiv:function(){var e=this;this.repaintBuilding(),this.syncTempLayerBoxFromLayerBox();var t=new twaver.controls.Table(this.tempLayerBox),i=new twaver.controls.TablePane(t);t.setRowHeight(30),t.setEditable(!0),i.getTableHeader().setHeight(30),i.getTableHeader().getView().style.background="#FF9A44",i.getView().style.width="390px",i.getView().style.height="200px",this.addColumn(t,"Name","floorName","client","string",!0,80),this.addColumn(t,"Height","floorHeight","client","int",!0,80),this.addColumn(t,"Ref","floorRef","client","boolean",!0,80);var n=this.addColumn(t,"Action","action","client","string",!0,150);n.renderCell=function(t){var i=document.createElement("div");i.setAttribute("class","floorAction"),e.createATagButton(i,"upFloor",function(){e.moveFloor(t.data,"up")}),e.createATagButton(i,"downFloor",function(){e.moveFloor(t.data,"down")}),e.createATagButton(i,"deleteFloor",function(){e.deleteFloor(t.data)}),t.div.appendChild(i)},Utils.showDialog("floor_manager",i.getView(),"Floor Management",!0,!1,null,e.saveFloor,this,[],[]),i.getView().parentNode.style.width="390px",i.getView().parentNode.style.height="200px",Utils.setDialogRect("floor_manager"),t.setVisibleFunction(function(e){return e.getClient("floorLayer")&&!e.getClient("predefined")?!0:!1})},createATagButton:function(e,t,i){var n=document.createElement("a"),a=document.createElement("input");a.setAttribute("type","button"),a.setAttribute("class",t),a.onclick=i,n.appendChild(a),e.appendChild(n)},saveFloor:function(){if(!this.checkFloorData())return!1;this.syncLayerBoxFromTempLayerBox();var e=this.getFloorByFloorName(this.oldValue);e&&(this.selectView.value=this.oldValue);for(var t=!1,i=this.getUnPredefinedFloorLayers(),n=0;n<i.size();n++){var a=i.get(n);a.getClient("floorRef")&&(t=!0)}t||this.network.setBackground(null)},moveFloor:function(e,t){"up"===t?this.tempLayerBox.moveUp(e):"down"===t&&this.tempLayerBox.moveDown(e)},deleteFloor:function(e){return this.tempLayerBox.size()<=2?void alert("can not delete the only one floor"):void this.tempLayerBox.remove(e)},addColumn:function(e,t,i,n,a,o,r){var s=new twaver.Column(t);return s.setName(t),s.setWidth(r),s.setHorizontalAlign("center"),s.setPropertyName(i),s.setPropertyType(n),a&&s.setValueType(a),s.setEditable(o),s.renderHeader=function(e){var t=document.createElement("span");t.setAttribute("title",t.innerHTML),t.innerHTML=s.getName()?s.getName():s.getPropertyName(),e.setAttribute("class","floorHeader"),e.appendChild(t)},e.getColumnBox().add(s),s},openCreateFloorDiv:function(){var e=new Array,t=this.getUnPredefinedFloorLayers();t&&t.size()>0&&t.forEach(function(t){e.push(t.getClient("floorName"))});var i=[{label:"Floor Name:",id:"name"},{label:"Floor Height:",id:"height"},{label:"Clone:",id:"needClone",type:"checkbox",inner:"Clone another Floor"},{label:"Clone Floor:",id:"cloneFloorName",type:"select",options:e}];Utils.showInputDialog(i,"Add New Floor",!0,this.addNewFloor,this)},addNewFloor:function(e){var t=e.height;t=t?parseInt(t):0,this.addFloor(e.name,t,e.needClone,e.cloneFloorName),e.name&&(this.selectView.value=e.name)},showFloorVisibleDialog:function(){this.syncTempLayerBoxFromLayerBox();var e=new twaver.controls.Table(this.tempLayerBox),t=new twaver.controls.TablePane(e);e.setRowHeight(30),e.setEditable(!0),t.getTableHeader().setHeight(30),t.getTableHeader().getView().style.background="#FF9A44",t.getView().style.width="230px",t.getView().style.height="200px",this.addColumn(e,"Name","floorName","client","string",!1,80),this.addColumn(e,"Visible","floorVisible","client","boolean",!0,150),Utils.showDialog("floor_visible",t.getView(),"Floor Visiblity",!0,!1,null,this.saveFloor,this,[],[]),t.getView().parentNode.style.width="230px",t.getView().parentNode.style.height="200px",Utils.setDialogRect("floor_visible"),e.setVisibleFunction(function(e){return e.getClient("floorLayer")&&!e.getClient("predefined")?!0:!1})},moveAllPredefinedLayersToBottom:function(){var e=this;if(this.moveLayer){this.moveLayer=!1;var t=this.getPredefinedFloorLayers();t.forEach(function(t){e.layerBox.moveToBottom(t)}),this.moveLayer=!0}},syncTempLayerBoxFromLayerBox:function(){var e=this;this.tempLayerBox.clear();var t=this.getUnPredefinedFloorLayers();t.forEach(function(t){for(var i=new twaver.Layer(t.getId()),n=0;n<e.clientPros.length;n++)i.setClient(e.clientPros[n],t.getClient(e.clientPros[n]));e.tempLayerBox.add(i)})},syncLayerBoxFromTempLayerBox:function(){var e=this,t=this.getUnPredefinedFloorLayers(),i={};this.tempLayerBox.forEach(function(e){i[e.getId()]=e}),t.forEach(function(t){i[t.getId()]||"default"===t.getId()||e.layerBox.remove(t)});for(var n=this.tempLayerBox.getRoots(),a=0;a<n.size();a++){var o=n.get(a);if("default"!==o.getId()){for(var r=e.layerBox.getDataById(o.getId()),s=0;s<e.clientPros.length;s++)r.setClient(e.clientPros[s],o.getClient(e.clientPros[s]));e.layerBox.moveTo(r,a)}}},checkFloorData:function(){var e=0;return this.tempLayerBox.forEach(function(t){t.getClient("floorRef")&&e++}),e>1?(alert("can not set more than one ref floor"),!1):!0},getCurrentFloor:function(){var e=this.selectView.value;return this.getFloorByFloorName(e)},getCurrentFloorName:function(){return this.selectView.value},getAllFloorLayers:function(){var e=new twaver.List;return this.layerBox.getRoots().forEach(function(t){t.getClient("floorLayer")&&e.add(t)}),e},getUnPredefinedFloorLayers:function(){var e=new twaver.List;return this.layerBox.getRoots().forEach(function(t){t.getClient("floorLayer")&&!t.getClient("predefined")&&e.add(t)}),e},getPredefinedFloorLayers:function(){var e=new twaver.List;return this.layerBox.forEach(function(t){t.getClient("floorLayer")&&t.getClient("predefined")&&e.add(t)}),e},getFloorByFloorName:function(e){return this.findByFloorName.findFirst(e)},getFloorHeightByFloorName:function(e){var t=this.getFloorByFloorName(e);if(t){var i=t.getClient("floorHeight");if(i)return parseInt(i)}return 0},getFloorRefByFloorId:function(e){var t=this.layerBox.getDataById(e);return t?t.getClient("floorRef"):!1},isFloorVisibility:function(e){var t=this.getFloorByFloorName(e);return t?t.getClient("floorVisible"):!0},getView:function(){return this.selectView}}),PropertySheetPane=function(e){this.elementBox=e,this.sheetAccordionPane=new AccordionPane},twaver.Util.ext("PropertySheetPane",Object,{init:function(){var e="Property";this.sheetAccordionPane.addCategory(e),this.sheetAccordionPane.addItemDiv(e,this.initPropertySheet().getView()),this.sheetAccordionPane.expand(e)},initPropertySheet:function(){var e=this,t=new MyPropertySheet(this.elementBox);e.sheet=t;var i=t.getPropertyBox();t.setEditable(!0),t.getView().style.width="230px",t.getView().style.height="600px",t.getView().addEventListener("keydown",function(e){13==e.keyCode&&t.validateImpl()});var n=function(e){return e instanceof twaver.Element},a=function(t,a,o,r,s,l,d){var c=e._addProperty(i,t,"Basic",r,null==a?"client":a);return c.setEditable(null==o?!0:o),c.isVisible=d?d:n,s&&(c.renderValue=s),l&&(c.setValue=l),c},o=function(e,t,i,n,o){return a(e,null,!0,t,n,o,i)},r=function(e,t){var i=e.valueRender,n=e.value,a=document.createElement("input");a.style.border="0px",t(a,n),i.appendChild(a),e.value=a.value,e.valueRender._editInfo=e};a("location","accessor",!0,null,function(e){r(e,function(e,t){t&&(e.value=t.x.toFixed(decimalNumber)+","+t.y.toFixed(decimalNumber))})},function(e,t){if(t.indexOf(",")>0){var i=t.split(",");if(2==i.length){{({x:i[0],y:i[1]})}e.setLocation(parseInt(i[0]),parseInt(i[1]))}}});o("picture","Image",function(e){return e instanceof ImageShapeNode},null,function(e,t){"undefined"!=typeof t&&(Utils.registerImage(t),e.setClient("picture",t))});var s=function(e){return e instanceof FloorShapeNode||e instanceof PipeShapeNode};o("repeat",null,s,function(e){r(e,function(e,t){t&&(e.value=t.row+","+t.column)})},function(e,t){if(t.indexOf(",")>0){var i=t.split(",");if(2==i.length){var n={row:i[0],column:i[1]};e.setClient("repeat",n)}}});var l=function(e){return e instanceof ImageShapeNode&&!(e instanceof FloorShapeNode)&&!(e instanceof PipeShapeNode)};o("size","Height",l,function(e){r(e,function(e,t){t&&(e.value=t.y)})},function(e,t){if(t){var i=e.getClient("size");i.y=parseInt(t),e.setClient("size",i)}}),o("size","Deep",l,function(e){r(e,function(e,t){t&&(e.value=t.z)})},function(e,t){if(t){var i=e.getClient("size");i.z=parseInt(t),e.setClient("size",i)}}),o("shapenode.closed","Closed Room",l).setValueType("boolean"),o("poleTexture","Pole Texture Image",l),o("useTexture","Use Textured Wall",l).setValueType("boolean"),o("framePic","Frame image",l);var d=function(e){return l(e)&&e instanceof InnerWallShapeNode};o("wallInnerPic","Texture image",d);var c=function(e){return l(e)&&!(e instanceof InnerWallShapeNode)};o("wallInnerPic","Inner image",c),o("wallOuterPic","Outer image",c);var h=function(e){return e instanceof Window||e instanceof Cutoff||e instanceof Door};o("fullWidth","Full Width",h,null,function(e,t){if(t){{var i=e.getClient("edgeIndex"),n=e.getParent().getPoints(),a=n.get(i),o=n.get(i===n.size()-1?0:i+1),r=o.x-a.x,s=o.y-a.y,l=Math.sqrt(r*r+s*s)-.1;Math.abs(r)>Math.abs(s)}e.setClient("length",l),e.setClient("offset",.5)}}).setValueType("boolean"),o("height","Height",h);var u=function(e){return e instanceof Window||e instanceof Door};o("animation","Animation",u);var g=function(e){return e instanceof Window||e instanceof Cutoff||e instanceof PrimitiveNode||e instanceof TargetFlagNode||e instanceof PipeShapeNode},m=function(e){return e instanceof PrimitiveNode};o(SPACE_POS_Y,"Position Y",g);var p=function(e){return e instanceof PrimitiveNode};o("businessId","BID",p),o("primitiveName","Name",p),a("angle","accessor",!0,"Rotate Angle",function(e){r(e,function(e,t){t&&(e.value=parseInt(t))})},null,m);var f=function(e){return e instanceof PipeShapeNode};return o("radius","Radius",f),o("segments","Path segments",f),o("startCap","Start cap",f),o("endCap","End cap",f),o("startCapSize","Start cap size",f),o("endCapSize","End cap size",f),t},_addProperty:function(e,t,i,n,a){var o=new twaver.Property;o.setCategoryName(i),n||(n=this._getNameFromPropertyName(t)),o.setName(n),o.setEditable(!0),o.setPropertyType(a),o.setPropertyName(t);var r;return r="style"===a?twaver.SerializationSettings.getStyleType(t):"client"===a?twaver.SerializationSettings.getClientType(t):twaver.SerializationSettings.getPropertyType(t),r&&o.setValueType(r),e.add(o),o},_getNameFromPropertyName:function(e){for(var t=e.split("."),i="",n=0;n<t.length;n++)t[n].length>0&&(i+=t[n].substring(0,1).toUpperCase()+t[n].substring(1,t[n].length)),n<t.length-1&&(i+=" ");return i},getView:function(){return this.sheetAccordionPane.getView()},getAccodionPane:function(){return this.sheetAccordionPane}}),MyPropertySheet=function(){MyPropertySheet.superClass.constructor.apply(this,arguments)},twaver.Util.ext("MyPropertySheet",twaver.controls.PropertySheet,{onCategoryRendered:function(){}}),ComponentDialog=function(e,t){this.box=e,this.object=t},twaver.Util.ext("ComponentDialog",Object,{_getFaceName:function(){var e=this.object.element;if(e instanceof mono.Entity){var t,i=this.object.face,n=i?i.materialIndex:0,a=e.getIndexSideMapping();return a&&(t=e.getIndexSideMapping()[n],t+="."),void 0===t&&(t=""),t}return null},getStyleValue:function(e,t){return e instanceof Array?e.length>0?e[t]:null:e},showDialog:function(){var e=this.object.element;if(e instanceof mono.Entity){var t=[],i=e.getClient("customProps");if(i)for(property in i){var n=[{label:i[property],id:property,readonly:!1,tab:"User Properties","class":"customlabel",value:e.getClient(i[property])}];t=t.concat(n)}var a=this.object.face,o=a?a.materialIndex:0,r=(this._getFaceName(),this.getStyleValue(e.getStyle("m.texture.image"),o)),s=this.getStyleValue(e.getStyle("m.texture.repeat"),o),l=s?s.x:1,d=s?s.y:1,c=this.getStyleValue(e.getStyle("m.opacity"),o),h=this.getStyleValue(e.getStyle("m.transparent"),o),u=this.getStyleValue(e.getStyle("m.texture.flipX"),o),g=this.getStyleValue(e.getStyle("m.texture.flipY"),o),m=Utils.createImageRow("Texture Picture:","pic",r),p=e.getClient("animation")||"",f="animation",v={label:"Animation:",id:f,pick:!0,value:p,pickFunction:function(){Utils.pickAnimation(f,p)}},y=e.getClient("animationGroup")||"",b=this.getStyleValue(e.getStyle("m.specularStrength"),o),C=Utils.string2Boolean(this.getStyleValue(e.getStyle("m.polygonOffset"),o)),w=this.getStyleValue(e.getStyle("m.polygonOffsetFactor"),o),S=this.getStyleValue(e.getStyle("m.polygonOffsetUnits"),o),x="#FFFFFF",I=this.getStyleValue(e.getStyle("m.color"),o);x=I instanceof mono.Color?"#"+I.getHexString():I;var P="#FFFFFF",_=this.getStyleValue(e.getStyle("m.ambient"),o);P=_ instanceof mono.Color?"#"+_.getHexString():_;var E=e.getClient(OID)||"",T=[{label:"OID:",id:"oid",value:E,list:[]},v,{label:"Animation Group:",id:"animationGroup",value:y},{label:"Position:",type:"label","return":!0},{label:"Position:",labelMinor:" x",id:"positionX",type:"multipleF","return":!0,value:parseFloat(e.getPosition().x).toFixed(decimalNumber)},{label:"Position:",labelMinor:" y",id:"positionY",type:"multipleS","return":!0,value:parseFloat(e.getPosition().y).toFixed(decimalNumber)},{label:"Position:",labelMinor:" z",id:"positionZ",type:"multipleT","return":!0,value:parseFloat(e.getPosition().z).toFixed(decimalNumber)},{label:"PositionReset",type:"button"},{label:"Rotation(°):",type:"label","return":!0},{label:"Rotation:",labelMinor:" x",id:"rotationX",type:"multipleF","return":!0,value:Utils.convert2Angle(e.getRotationX())},{label:"Rotation:",labelMinor:" y",id:"rotationY",type:"multipleS","return":!0,value:Utils.convert2Angle(e.getRotationY())},{label:"Rotation:",labelMinor:" z",id:"rotationZ",type:"multipleT","return":!0,value:Utils.convert2Angle(e.getRotationZ())},{label:"RotationReset",type:"button"},{label:"Scale:",type:"label","return":!0},{label:"Scale:",labelMinor:" x",id:"scaleX",type:"multipleF","return":!0,value:parseFloat(e.getScaleX()).toFixed(decimalNumber)},{label:"Scale:",labelMinor:" y",id:"scaleY",type:"multipleS","return":!0,value:parseFloat(e.getScaleY()).toFixed(decimalNumber)},{label:"Scale:",labelMinor:" z",id:"scaleZ",type:"multipleT","return":!0,value:parseFloat(e.getScaleZ()).toFixed(decimalNumber)},{label:"ScaleReset",type:"button"},m,{label:"",id:"imageChanges",type:"checkbox",inner:"Apply texture picture to all faces"},{label:"Texture Repeat Row:",type:"label","return":!0},{label:"Row:",labelMinor:" Row",labelId:"textureRow",id:"textureRepeatR",type:"multipleF","return":!0,value:l},{label:"Column:",labelMinor:" Column",labelId:"textureColumn",id:"textureRepeatC",type:"multipleT","return":!0,value:d},{label:"TextureReset",type:"button"},{label:"",id:"textureChanges",type:"checkbox",inner:"Apply texture repeat to all faces"},{label:"",id:"flipX",value:h,type:"checkbox",tab:"Advance",inner:"Horizontal Flip",checked:u},{label:"",id:"flipY",value:h,type:"checkbox",tab:"Advance",inner:"Vertical Flip",checked:g},{label:"Transparent:",id:"transparent",value:h,type:"checkbox",inner:"Set the transparency and effective",checked:h,eve:"onchange",listener:function(){var e=document.getElementById("opacity"),t=document.getElementById("labelOpacity"),i=document.getElementById("transparent").checked;i?(e.style.display="block",t.style.display="block"):(e.style.display="none",t.style.display="none")}},{label:"Opacity:",labelId:"labelOpacity",id:"opacity",value:c,display:h},{label:"",id:"specularStrengthChanges",type:"checkbox",tab:"Advance",inner:"Apply specular strength to all faces"},{label:"Specular Strength:",id:"specularStrength",tab:"Advance",value:b},{label:"Polygon Offset:",id:"polygonOffset",type:"checkbox",tab:"Advance",inner:"Set the polygon offset parameters",eve:"onchange",checked:C,listener:function(){var e=document.getElementById("polygonOffsetFactor"),t=document.getElementById("labelPolygonOffsetFactor"),i=document.getElementById("polygonOffsetUnits"),n=document.getElementById("labelPolygonOffsetUnits"),a=document.getElementById("polygonOffset").checked;console.log(a),a?(e.style.display="block",t.style.display="block",i.style.display="block",n.style.display="block"):(e.style.display="none",t.style.display="none",i.style.display="none",n.style.display="none")}},{label:"Polygon Offset Factor:",id:"polygonOffsetFactor",labelId:"labelPolygonOffsetFactor",tab:"Advance",value:w,display:C},{label:"Polygon Offset Units:",id:"polygonOffsetUnits",labelId:"labelPolygonOffsetUnits",tab:"Advance",value:S,dispaly:C},{label:"Color:",id:"mColor",tab:"Advance",value:x},{label:"Ambient:",id:"mAmbient",tab:"Advance",value:P}];T=this._appendEntityProperties(e,T),T=T.concat(t),t&&t.length>0?Utils.showInputDialog(T,"Object Properties",!0,this._setResult,this,[this.object]):Utils.showInputDialog(T,"Object Properties",!0,this._setResult,this,[this.object],!0)}else if(e instanceof mono.Billboard){var c=e.getStyle("m.opacity"),h=e.getStyle("m.transparent"),A=e.getStyle("m.texture.image"),T=[{label:"",id:"transparent",value:h,type:"checkbox",inner:"Transparent",checked:h},{label:"Opacity:",id:"opacity",value:c},{label:"Image",id:"image",value:A},{label:"Vertical",id:"vertical",type:"checkbox",checked:Utils.string2Boolean(e.getStyle("m.vertical"))}];T&&T.length>0?Utils.showInputDialog(T,"Object Properties",!0,this._setBillBoardResult,this,[this.object]):Utils.showInputDialog(T,"Object Properties",!0,this._setBillBoardResult,this,[this.object],!0)}else if(e instanceof mono.Link){var T=[{label:"Link Style:",id:"linkStyle",type:"select",options:PropertyConsts.LINK_STYPE,value:e.getLinkType()},{label:"Link Color:",id:"linkColor",value:e.getStyle("m.color")},{label:"Link Size:",id:"linkSize",value:e.getStyle("m.linewidth")},{label:"Link Extend:",id:"linkExtend",value:e.getExtend()},{label:"Link point data:",id:"linkPoints",tab:"Link Points",type:"textArea",readonly:!1,value:e.getControls()}];
Utils.showInputDialog(T,"Link Properties",!0,this._setLinkResult,this,[this.object],!0)}},pickImage:function(e){var t=new TextureImagePanel;t.init(),console.log(this),Utils.showDialog("imagepane",t.getView().getView(),"Image Pick",!0,!0,null,this.setImageCategory,this,[e,t])},setImageCategory:function(e,t){var i=t.getLastNetworkData();i&&document.getElementById(e)&&(document.getElementById(e).value=i.getClient("imageId"))},_appendEntityProperties:function(e,t){if(e instanceof mono.Cube){var i=[{label:"Wrap Mode:",id:"wrapmode",value:e.getWrapMode(),list:PropertyConsts.WRAPMODE},{label:"Shape:",type:"label","return":!0},{label:"Shape:",labelMinor:" W",id:"shapeW",type:"multipleF","return":!0,value:parseFloat(e.width).toFixed(decimalNumber)},{label:"Shape",labelMinor:" H",id:"shapeH",type:"multipleS","return":!0,value:parseFloat(e.height).toFixed(decimalNumber)},{label:"Shape",labelMinor:" D",id:"shapeD",type:"multipleT","return":!0,value:parseFloat(e.depth).toFixed(decimalNumber)}];t=t.concat(i)}if(e instanceof mono.ComboNode){var n=e.getBoundingBox(),a=n.size(),i=[{label:"Shape:",type:"label","return":!0},{label:"Shape:",labelMinor:" W",id:"shapeW",type:"multipleF","return":!0,value:Utils.changeTwoDecimal(a.x)},{label:"Shape",labelMinor:" H",id:"shapeH",type:"multipleS","return":!0,value:Utils.changeTwoDecimal(a.y)},{label:"Shape",labelMinor:" D",id:"shapeD",type:"multipleT","return":!0,value:Utils.changeTwoDecimal(a.z)}];t=t.concat(i)}if(e instanceof mono.Sphere){var i=[{label:"Sphere Radius:",id:"radius",value:parseFloat(e.radius).toFixed(decimalNumber),tab:"Sphere"},{label:"Width Segments:",id:"segmentsW",value:e.segmentsW,tab:"Sphere"},{label:"Height Segments:",id:"segmentsH",value:e.segmentsH,tab:"Sphere"}];t=t.concat(i)}if(e instanceof mono.Cylinder){var i=[{label:"Height:",id:"height",value:parseFloat(e.height).toFixed(decimalNumber),tab:"Cylinder"},{label:"Top Radius:",id:"radiusTop",value:parseFloat(e.radiusTop).toFixed(decimalNumber),tab:"Cylinder"},{label:"Bottom Radius:",id:"radiusBottom",value:parseFloat(e.radiusBottom).toFixed(decimalNumber),tab:"Cylinder"},{label:"Radial Segments:",id:"segmentsR",value:e.segmentsR,tab:"Cylinder"},{label:"",id:"openTop",type:"checkbox",inner:"Opened Top",checked:e.openTop,tab:"Cylinder"},{label:"",id:"openBottom",type:"checkbox",inner:"Opened Bottom",checked:e.openBottom,tab:"Cylinder"}];t=t.concat(i)}if(e instanceof mono.Torus){var i=[{label:"Radius:",id:"radius",value:parseFloat(e.radius).toFixed(decimalNumber),tab:"Torus"},{label:"Tube:",id:"tube",value:e.tube,tab:"Torus"},{label:"Radial Segments:",id:"segmentsR",value:e.segmentsR,tab:"Torus"},{label:"Tubular Segments:",id:"segmentsT",value:e.segmentsT,tab:"Torus"},{label:"Arc:",id:"arc",value:e.arc/Math.PI*180,tab:"Torus"}];t=t.concat(i)}if(e instanceof mono.PathNode){var i=[{label:"Radius:",id:"radius",value:parseFloat(e.radius).toFixed(decimalNumber),tab:"Pipe"},{label:"Path:",id:"path",value:e.getPath().toArray(),tab:"Pipe"},{label:"Path Segments:",id:"segments",value:e.segments,tab:"Pipe"},{label:"Shape Segments:",id:"segmentsR",value:e.segmentsR,tab:"Pipe"},{label:"Start Cap:",id:"startCap",type:"select",options:["none","plain","round"],value:e.startCap,tab:"Pipe"},{label:"End Cap:",id:"endCap",type:"select",options:["none","plain","round"],value:e.endCap,tab:"Pipe"},{label:"Start Cap Size:",id:"startCapSize",value:e.startCapSize,tab:"Pipe"},{label:"End Cap Size:",id:"endCapSize",value:e.endCapSize,tab:"Pipe"},{label:"Cap Segments:",id:"segmentsCap",value:e.segmentsCap,tab:"Pipe"}];t=t.concat(i)}if(e instanceof mono.LatheNode){var i=[{label:"Height Segments:",id:"segmentsH",value:e.getSegmentsH(),tab:"Lathe"},{label:"Radius Segments:",id:"segmentsR",value:e.getSegmentsR(),tab:"Lathe"},{label:"Rotation Angle:",id:"rotationAngle",value:180*e.getArc()/Math.PI,tab:"Lathe"},{label:"",id:"startClosed",checked:e.isStartClosed(),inner:"Start Closed",type:"checkbox",tab:"Lathe"},{label:"",id:"endClosed",checked:e.isEndClosed(),inner:"End Closed",type:"checkbox",tab:"Lathe"}];t=t.concat(i)}if(e instanceof mono.TextNode){var i=[{label:"Text:",id:"text3d",value:e.getText(),tab:"Text"},{label:"Font:",id:"font3d",type:"select",options:PropertyConsts.Font.fontFamily,value:e.getFont(),tab:"Text"},{label:"Style:",id:"style3d",type:"select",options:PropertyConsts.Font.fontStyle,value:e.getWeight(),tab:"Text"}];t=t.concat(i)}return t},_setBillBoardResult:function(e,t){var i=e.element;i.setStyle("m.transparent",t.transparent);var n=parseFloat(t.opacity);i.setStyle("m.opacity",n);var a=t.image;i.setStyle("m.texture.image",a);var o=Utils.string2Boolean(t.vertical);i.setStyle("m.vertical",o)},_setLinkResult:function(e,t){var i=e.element;if(i.setExtend(parseFloat(t.linkExtend)),i.setLinkType(t.linkStyle),i.s({"m.color":t.linkColor,"m.linewidth":parseFloat(t.linkSize)}),"control"==t.linkStyle&&t.linkPoints){for(var n=t.linkPoints.toString().replace(/\s/g,",").replace(/\r\n/g,","),a=n.split(","),o=[],r=0;r<a.length;r+=3)isNaN(parseFloat(a[r]))||o.push(new TGL.Vec3(parseFloat(a[r]),parseFloat(a[r+1]),parseFloat(a[r+2])));i.setControls(o)}},_setResult:function(e,t){var i=e.element;if(this._setEntityResult(e,t),t.customProps){var n=i.getClient("customProps");if(n)for(var a in n)void 0==t.customProps[a]&&i.setClient(a,null);var o=[];for(var r in t.customProps)r?(o.push(r),i.setClient(r,t.customProps[r]),registerProperties.indexOf(r)<0&&(registerProperties.push(r),mono.SerializationSettings.setClientType(r,"string"))):delete t.customProps[r];i.setClient("customProps",o)}t.oid&&i.setClient(OID,t.oid),""===t.animation?i.setClient("animation",null):i.setClient("animation",t.animation),Utils.isNotNull(t.animationGroup)&&i.setClient("animationGroup",t.animationGroup),i.setPosition(parseFloat(t.positionX),parseFloat(t.positionY),parseFloat(t.positionZ)),i.setRotation(Utils.convert2Radian(parseFloat(t.rotationX)),Utils.convert2Radian(parseFloat(t.rotationY)),Utils.convert2Radian(parseFloat(t.rotationZ))),i.setScale(parseFloat(t.scaleX),parseFloat(t.scaleY),parseFloat(t.scaleZ));var s=e.face,l=t.textureChanges,d=t.imageChanges,c=parseInt(t.textureRepeatR),h=parseInt(t.textureRepeatC),u=t.pic,g=parseFloat(t.opacity),m=t.transparent,p=t.flipX,f=t.flipY,v=s?s.materialIndex:0,y=this._getFaceName(),b=t.polygonOffset,C=t.polygonOffsetFactor,w=t.polygonOffsetUnits,S=t.mColor,x=t.mAmbient,I=t.specularStrengthChanges,P=t.specularStrength;if(null===y||""===y){for(var _=[],E=i.material.materials,T=0;T<E.length;T++)_.push(E[T].map?E[T].map.getImage().src:null);var A=["m.texture.image","m.texture.repeat","m.texture.flipX","m.texture.flipY","m.transparent","m.opacity","m.specularStrength"];for(nameIndex in A){var L=A[nameIndex],N=i.getStyle(L,!0);"m.texture.image"===L&&(d?N=u:N[v]=u),"m.texture.repeat"===L&&(l?N=new mono.Vec2(c,h):N[v]=new mono.Vec2(c,h)),"m.texture.flipX"===L&&(N[v]=p),"m.texture.flipY"===L&&(N[v]=f),"m.transparent"===L&&(N[v]=m),"m.opacity"===L&&(N[v]=g),"m.specularStrength"===L&&(I?N=P:N[v]=P),i.setStyle(L,N)}}else l?i.setStyle("m.texture.repeat",new mono.Vec2(c,h)):i.setStyle(y+"m.texture.repeat",new mono.Vec2(c,h)),d?u&&i.setStyle("m.texture.image",u):u&&i.setStyle(y+"m.texture.image",u),I?i.setStyle("m.specularStrength",P):i.setStyle(y+"m.specularStrength",P),i.setStyle(y+"m.texture.flipX",p),i.setStyle(y+"m.texture.flipY",f),i.setStyle(y+"m.transparent",m),i.setStyle(y+"m.opacity",g),i.setStyle(y+"m.polygonOffset",b),i.setStyle(y+"m.polygonOffsetFactor",C),i.setStyle(y+"m.polygonOffsetUnits",w),i.setStyle(y+"m.color",S),i.setStyle(y+"m.ambient",x)},_setEntityResult:function(e,t){var i=e.element;i instanceof mono.Cube&&(i.setWidth(parseFloat(t.shapeW)),i.setHeight(parseFloat(t.shapeH)),i.setDepth(parseFloat(t.shapeD)),i.setWrapMode(t.wrapmode)),i instanceof mono.Sphere&&(i.setRadius(parseFloat(t.radius)),i.setSegmentsW(parseInt(t.segmentsW)),i.setSegmentsH(parseInt(t.segmentsH))),i instanceof mono.Cylinder&&(i.setHeight(parseFloat(t.height)),i.setRadiusTop(parseFloat(t.radiusTop)),i.setRadiusBottom(parseFloat(t.radiusBottom)),i.setSegmentsR(parseInt(t.segmentsR)),i.setOpenTop(t.openTop),i.setOpenBottom(t.openBottom)),i instanceof mono.Torus&&(i.setRadius(parseFloat(t.radius)),i.setTube(parseInt(t.tube)),i.setSegmentsR(parseInt(t.segmentsR)),i.setSegmentsT(parseInt(t.segmentsT)),i.setArc(parseInt(t.arc)*Math.PI/180)),i instanceof mono.PathNode&&(i.setRadius(parseFloat(t.radius)),i.setPath(Utils._createPath(t.path.split(","))),i.setSegments(parseInt(t.segments)),i.setSegmentsR(parseInt(t.segmentsR)),i.setStartCap(t.startCap),i.setEndCap(t.endCap),i.setStartCapSize(parseFloat(t.startCapSize)),i.setEndCapSize(parseFloat(t.endCapSize)),i.setSegmentsCap(parseInt(t.segmentsCap))),i instanceof mono.LatheNode&&(i.setSegmentsH(parseInt(t.segmentsH)),i.setSegmentsR(parseInt(t.segmentsR)),i.setArc(parseInt(t.rotationAngle)*Math.PI/180),i.setStartClosed(t.startClosed),i.setEndClosed(t.endClosed)),i instanceof mono.TextNode&&(i.setText(t.text3d),i.setFont(t.font3d),i.setWeight(t.style3d)),i instanceof mono.Billboard,Utils.updateBoxInfo(box)}}),RoomDialog=function(e,t){this.element=e,this.pointIndex=t},twaver.Util.ext("RoomDialog",Object,{show:function(){if(this.element){var e=(this.element.getChildAt(0),[]),t=this.element.getClient("customProps");if(t)for(T in t){var i=[{label:t[T],id:T,readonly:!1,tab:"User Properties","class":"customlabel",value:this.element.getClient(t[T])}];e=e.concat(i)}var n=finderByHostNodeId.find(this.element.getClient(OID)).get(0),a=sidebarLayerbox.getDataById(this.element.getClient(PropertyConsts.LAYERID)),o=a?a.getName():"",r=new TreeComboBox("Layer:",null,!0,sidebarLayerbox.getRoots(),null,null,o),s={value:r.getView(),type:"div"};if(this.element instanceof PipeShapeNode){var l={row:100,column:1};this.element.getClient("repeat")&&this.element.getClient("repeat").row&&this.element.getClient("repeat").column&&(l=this.element.getClient("repeat"));var d,c=Utils.createImageRow("Image:","picture",this.element.getClient(IMAGE_SRC)),h=[c,{label:"Radius:",id:"radius",value:parseFloat(this.element.getClient("radius")).toFixed(decimalNumber)},{label:"Vertical Position:",id:"positionY",value:this.element.getClient("positionY")},{label:"Path segments:",id:"segments",value:this.element.getClient("segments")},{label:"Start cap:",id:"startCap",type:"select",options:["none","plain","round"],value:this.element.getClient("startCap")},{label:"End cap:",id:"endCap",type:"select",options:["none","plain","round"],value:this.element.getClient("endCap")},{label:"Start cap size:",id:"startCapSize",value:this.element.getClient("startCapSize")},{label:"End cap size:",id:"endCapSize",value:this.element.getClient("endCapSize")},{label:"Repeat row:",id:"repeatRow",value:l.row},{label:"Repeat column:",id:"repeatColumn",value:l.column},s],u=this.element.getPoints();if(u&&u.size()>1&&this.pointIndex<0){var g=1e3,m=new GridNetwork;m.setEditInteractions(),m.setEditPointSize(10),m.setShowTwoimensionAxis(!0),m.setScaleY(g),m.setScaleYGap(-50),m.getView().addEventListener("mousedown",function(e){_twaver.isAltDown(e)&&e.stopPropagation()},!0);var p=new PipeShapeNode;this.element instanceof RoundPipeShapeNode&&(p=new RoundPipeShapeNode);for(var f=this.element.getClient("pointPositions"),v="",y=0;y<u.size();y++){var b=f[""+y];b||(b=this.element.getClient("positionY")),p.addPoint({x:u.get(y).x,y:-b+g}),v+=u.get(y).x+","+b+","+u.get(y).y+"\n"}p.setOffsetYofPoints(g),p.setNegatedYInterval(!0),m.getElementBox().add(p),m.getElementBox().getSelectionModel().setSelection(p),d=function(e){"Points"==e&&_twaver.callLater(function(){m.adjustBounds({width:800,height:400}),m.getView().style.position="relative",m.makeVisible(p),m.invalidate(),setTimeout(function(){m.makeVisible(p)},100)},this,[],18)},h.push({id:"points",type:"div",value:m.getView(),tab:"Points"});var C=[{label:"the pipe point data:           ",id:"shapePoints",tab:"Shape",type:"textArea",readonly:!1,value:v},{type:"label",tab:"Shape",inner:"<font color='red'>Press shift and enter to a new line!</font>"}];h=h.concat(C)}var w="Pipe Property";if(this.pointIndex>=0){var S=""+this.pointIndex,b=this.element.getClient("pointPositions")[S];b||(b=this.element.getClient("positionY")),h=[{label:"Point Position X:",id:"pointPositionsX",value:u.get(this.pointIndex).x},{label:"Point Position Y:",id:"pointPositions",value:b},{label:"Point Position Z:",id:"pointPositionZ",value:u.get(this.pointIndex).y}],w="Pipe Point Property"}return h=h.concat(e),void this.showDialog(e,h,w,this.setPipe,[m,g,r],d)}if(this.element instanceof TargetFlagNode){var x=this.element.getClient(SPACE_POS_Y),I=this.element.getCenterLocation(),P=[{label:"Point Position X:",id:"pointPositionsX",value:I.x},{label:"Point Position Y:",id:"pointPositionY",value:x},{label:"Point Position Z:",id:"pointPositionZ",value:I.y}];return w="Point Property",P=P.concat(e),void this.showDialog(e,P,w,this.setTargetFlag)}var _=this.element.getClient("transparent"),E=[{label:"Location X:",id:"locationx",value:parseInt(this.element.getX())},{label:"Location Y:",id:"locationy",value:parseInt(this.element.getY())}];if(E=E.concat(e),!(this.element instanceof PrimitiveNode)){var T=[{label:"Transparent:",id:"transparent",type:"checkbox",inner:"Set the transparency and effective",checked:_,eve:"onchange",listener:function(){var e=document.getElementById("opacity"),t=document.getElementById("labelOpacity"),i=document.getElementById("transparent").checked;i?(e.style.display="block",t.style.display="block"):(e.style.display="none",t.style.display="none")}},{label:"Opacity:",id:"opacity",labelId:"labelOpacity",value:this.element.getClient("opacity"),display:_}];E=E.concat(T)}if(this.element instanceof FloorShapeNode){var A=Utils.createImageRow("Image:","picture",this.element.getClient(IMAGE_SRC)),L=[A,{label:"Repeat:",id:"repeat",value:this.element.getClient("repeat")},{label:"Deep:",id:"deep",value:this.element.getClient("size").z},s];L=E.concat(L);var N=this.element.getPoints(),k="";N.forEach(function(e){k+=e.x+",0,"+e.y+"\n"});var C=[{label:"the room point data:           ",id:"shapePoints",tab:"Shape",type:"textArea",readonly:!1,value:k},{type:"label",tab:"Shape",inner:"<font color='red'>Press shift and enter to a new line!</font>"}];return L=L.concat(C),void this.showDialog(e,L,"Floor Property",this.setRoom,[r])}if(this.element instanceof ImageShapeNode&&!(this.element instanceof FloorShapeNode)){var O=Utils.createImageRow("Frame image:","framePic",this.element.getClient("framePic")),D=[{label:"Height:",id:"height",value:parseFloat(this.element.getClient("size").y).toFixed(decimalNumber)},{label:"Deep:",id:"deep",value:parseFloat(this.element.getClient("size").z).toFixed(decimalNumber)},{label:"",id:"closed",type:"checkbox",inner:"Closed Room",checked:this.element.getClient("shapenode.closed"),display:this.element.getPoints()._as.length>2},{label:"",id:"useTexture",type:"checkbox",inner:"Use Textured Wall",checked:this.element.getClient("useTexture")},{label:"Render Depth:",id:"renderDepth",type:"input",value:this.element.renderDepth},s,O];if(this.pointIndex>=0){var R=this.element.getPoints().get(this.pointIndex);return roomPointProperty=[{label:"Point Position X:",id:"pointPositionX",value:R.x,tab:"Points"},{label:"Point Position Z:",id:"pointPositionZ",value:R.y,tab:"Points"}],w="Room Point Property",roomPointProperty=roomPointProperty.concat(e),void this.showDialog(e,roomPointProperty,w,this.setRoom,[r])}var M=this.element.getPoints(),B="";M.forEach(function(e){B+=e.x+",0,"+e.y+"\n"});var U=[{label:"the room point data:           ",id:"shapePoints",tab:"Shape",type:"textArea",readonly:!1,value:B},{type:"label",tab:"Shape",inner:"<font color='red'>Press shift and enter to a new line!</font>"}];E=E.concat(U);var F;if(null!=this.element.getClient(OID)){var z=n.getClient("transparent"),V=n.getClient("opacity"),A=Utils.createImageRow("Image:","picture",n.getClient(IMAGE_SRC),"Floor"),a=sidebarLayerbox.getDataById(n.getClient(PropertyConsts.LAYERID)),o=a?a.getName():"";F=new TreeComboBox("Layer:",null,!0,sidebarLayerbox.getRoots(),null,null,o,"floorCategory");var H={value:F.getView(),type:"div",tab:"Floor"},L=[{label:"Transparent:",id:"floorTransparent",tab:"Floor",type:"checkbox",inner:"Set the transparency and effective",checked:z,eve:"onchange",listener:function(){var e=document.getElementById("floorOpacity"),t=document.getElementById("labelFloorOpacity"),i=document.getElementById("floorTransparent").checked;i?(e.style.display="block",t.style.display="block"):(e.style.display="none",t.style.display="none")}},{label:"Opacity:",id:"floorOpacity",labelId:"labelFloorOpacity",tab:"Floor",value:V,display:z},A,{label:"Repeat:",id:"repeat",tab:"Floor",readonly:!1,value:n.getClient("repeat")},{label:"Deep:",id:"floorDeep",tab:"Floor",value:n.getClient("size").z},H];E=E.concat(L)}var G=Utils.createImageRow("Inner image:","innerwall",this.element.getClient("wallInnerPic")),W=Utils.createImageRow("Outer image:","outwall",this.element.getClient("wallOuterPic"));if(this.element instanceof InnerWallShapeNode){var Y=Utils.createImageRow("Texture image:","innerwall",this.element.getClient("wallInnerPic")),j=[Y];return j=E.concat(D).concat(j),void this.showDialog(e,j,"Room Property",this.setRoom,[r])}var X=[G,W];return X=E.concat(D).concat(X),void this.showDialog(e,X,"Room Property",this.setRoom,[{txtLayer:r,txtFloorLayer:F}])}var Z=[{label:"",id:"fullWidth",inner:"Full Width",type:"checkbox",checked:this.element.getClient("fullWidth")},{label:"Height:",id:"height",value:parseFloat(this.element.getClient("height")).toFixed(decimalNumber)},{label:"Length:",id:"length",value:parseFloat(this.element.getClient("length")).toFixed(decimalNumber)},{label:"Specular Strength:",id:"specularStrength",value:this.element.getClient(SPE_STR)},{label:"Transparent:",id:"transparent",type:"checkbox",checked:_,inner:"Set the transparency and effective",eve:"onchange",listener:function(){var e=document.getElementById("opacity"),t=document.getElementById("labelOpacity"),i=document.getElementById("transparent").checked;i?(e.style.display="block",t.style.display="block"):(e.style.display="none",t.style.display="none")}},{label:"Opacity:",id:"opacity",labelId:"labelOpacity",value:this.element.getClient("opacity"),display:_},s];Z=Z.concat(e);var J=this.element.getClient("animation")||"",q="animation",K={label:"Animation:",id:q,pick:!0,value:J,pickFunction:function(){Utils.pickAnimation(q,J)}},Q=[Utils.createImageRow("Picture:","picture",this.element.getClient("picture")),{label:"",id:"horizontalFlip",type:"checkbox",inner:"Horizontal Flip",checked:this.element.getClient("horizontalFlip")}];if(this.element instanceof Window){var w="Window Property",$=[{label:"Vertical Position:",id:"positionY",value:this.element.getClient("positionY")},K];return $=Z.concat($),$=$.concat(Q),void this.showDialog(e,$,w,this.setWindow,[r])}if(this.element instanceof Cutoff){w="Cutoff Property";var et=[{label:"Vertical Position:",id:"positionY",value:this.element.getClient("positionY")}];return et=Z.concat(et),void this.showDialog(e,et,w,this.setWindow,[r])}if(this.element instanceof Door){var tt=Z.concat(K);return tt=tt.concat(Q),void this.showDialog(e,tt,"Door Property",this.setWindow,[r])}if(this.element instanceof PrimitiveNode){var x=this.element.getClient("positionY");x=x?x:0;var it;if("mono.PointLight"==this.element.getClient("className")){var nt,at=this.element.getClient("lightPosition");if(at){var ot=at.split(",");at=3===ot.length?this.element.getX()+","+this.element.getY()+","+parseFloat(ot[2]):null}return at||(at=this.element.getX()+","+this.element.getY()+",100"),this.element.setClient("lightPosition",at),nt=this.element.getClient("lightColor")&&this.element.getClient("lightColor")instanceof mono.Color?"#"+this.element.getClient("lightColor").getHexString():this.element.getClient("lightColor"),it=[{label:"BID:",id:"businessId",value:this.element.getClient(BID)},{label:"Color:",id:"lightColor",value:nt},{label:"Position:",id:"lightPosition",value:at},{label:"Intensity:",id:"lightIntensity",value:this.element.getClient("lightIntensity")}],e&&e.length>0&&(it=it.concat(e)),void this.showDialog(e,it,"PointLight Property",this.setPointLight)}return it=[{label:"BID:",id:"businessId",value:this.element.getClient(BID)},{label:"Name:",id:"primitiveName",value:this.element.getClient("primitiveName")},{label:"Vertical Position:",id:"positionY",value:x},{label:"Rotation Angle:",id:"rotationAngle",value:parseInt(this.element.getAngle())},{label:"",id:"vertical",type:"checkbox",inner:"Vertical",checked:Utils.string2Boolean(this.element.getClient("vertical"))},s],it=E.concat(it),void this.showDialog(e,it,"Component Property",this.setWindow,[r])}}},setWindow:function(e,t){if(t.primitiveName&&this.element.setClient("primitiveName",t.primitiveName),t.businessId&&this.element.setClient(BID,t.businessId),t.locationx&&this.element.setX(parseInt(t.locationx)),t.locationy&&this.element.setY(parseInt(t.locationy)),t.positionY&&this.element.setClient("positionY",parseInt(t.positionY)),t.height&&this.element.setClient("height",parseFloat(t.height).toFixed(decimalNumber)),t.specularStrength&&this.element.setClient("specularStrength",t.specularStrength),t.length&&this.element.setClient("length",parseFloat(t.length).toFixed(decimalNumber)),!(this.element instanceof PrimitiveNode)){{t.transparent}this.element.setClient("transparent",t.transparent);{t.opacity.toString().split(",")}t.opacity&&this.element.setClient("opacity",t.opacity)}if(t.rotationAngle&&this.element.setAngle(t.rotationAngle),void 0!==t.vertical&&this.element.setClient("vertical",Utils.string2Boolean(t.vertical)),t.fullWidth){{var i=this.element.getClient("edgeIndex"),n=this.element.getParent().getPoints(),a=n.get(i),o=n.get(i===n.size()-1?0:i+1),r=o.x-a.x,s=o.y-a.y,l=Math.sqrt(r*r+s*s)-.1;Math.abs(r)>Math.abs(s)}this.element.setClient("length",l),this.element.setClient("offset",.5)}""===t.animation?this.element.setClient("animation",null):this.element.setClient("animation",t.animation),t.customProps&&this.setCustomProperties(t.customProps),t.picture&&(this.element.setClient("picture",t.picture),this.element.setClient("horizontalFlip",t.horizontalFlip)),this.setObjectCommonProperties(this.element,t,e)},setRoom:function(e,t){var i=this.element.getClient("size");if(t.shapePoints){for(var n=t.shapePoints.toString().replace(/\s/g,",").replace(/\r\n/g,","),a=n.split(","),o=new twaver.List,r=0;r<a.length;r+=3)isNaN(parseFloat(a[r]))||o.add({x:parseFloat(a[r]),y:parseFloat(a[r+2])});this.element.setPoints(o)}if(this.element.setClient("transparent",t.transparent),t.opacity&&this.element.setClient("opacity",parseFloat(t.opacity)),this.element.getClient(OID)||this.element instanceof FloorShapeNode){var s=finderByHostNodeId.find(this.element.getClient(OID)).get(0);if(this.element instanceof FloorShapeNode&&(s=this.element),t.floorTransparent&&s.setClient("transparent",t.floorTransparent),t.floorOpacity&&s.setClient("opacity",parseFloat(t.floorOpacity)),t.picture&&(Utils.registerImage(t.picture),s.setClient(IMAGE_SRC,t.picture)),t.repeat&&s.setClient("repeat",parseFloat(t.repeat)),t.floorDeep){var l=s.getClient("size");l.z=parseFloat(t.floorDeep).toFixed(decimalNumber),l&&s.setClient("size",l)}e.txtFloorLayer&&s.setClient(PropertyConsts.LAYERID,e.txtFloorLayer.getHideValue())}if(t.height&&i&&(i.y=parseFloat(t.height).toFixed(decimalNumber)),t.deep&&i&&(i.z=parseFloat(t.deep).toFixed(decimalNumber)),i&&this.element.setClient("size",i),"undefined"!=typeof t.closed&&this.element.setClient("shapenode.closed",t.closed),this.element.setClient("useTexture",t.useTexture),"undefined"!=typeof t.innerwall&&this.element.setClient("wallInnerPic",t.innerwall),"undefined"!=typeof t.outwall&&this.element.setClient("wallOuterPic",t.outwall),"undefined"!=typeof t.framePic&&this.element.setClient("framePic",t.framePic),t.locationx&&this.element.setX(parseInt(t.locationx)),t.locationy&&this.element.setY(parseInt(t.locationy)),t.poleSegments&&this.element.setClient(POLE_SEGMENTS,parseInt(t.poleSegments)),"undefined"!=typeof t.poleTexture&&this.element.setClient("poleTexture",t.poleTexture),t.repeat&&this.element.setClient("repeat",t.repeat),t.customProps&&this.setCustomProperties(t.customProps),this.setObjectCommonProperties(this.element,t,e),t.pointPositionX){var d=this.element.getPoints();d.get(this.pointIndex).x=parseInt(t.pointPositionX),this.element.setPoints(d)}if(t.pointPositionZ){var d=this.element.getPoints();console.log(d),d.get(this.pointIndex).y=parseInt(t.pointPositionZ),this.element.setPoints(d)}t.renderDepth&&(this.element.renderDepth=parseInt(t.renderDepth))},setPipe:function(e,t,i,n){if("undefined"!=typeof n.picture&&(Utils.registerImage(n.picture),this.element.setClient(IMAGE_SRC,n.picture)),n.repeatRow&&n.repeatColumn){var a={row:n.repeatRow,column:n.repeatColumn};this.element.setClient("repeat",a)}if(n.radius&&this.element.setClient("radius",parseFloat(n.radius).toFixed(decimalNumber)),n.segments&&this.element.setClient("segments",parseInt(n.segments)),n.positionY&&this.element.setClient("positionY",parseInt(n.positionY)),n.startCap&&this.element.setClient("startCap",n.startCap),n.endCap&&this.element.setClient("endCap",n.endCap),n.startCapSize&&this.element.setClient("startCapSize",n.startCapSize),n.endCapSize&&this.element.setClient("endCapSize",n.endCapSize),n.customProps&&this.setCustomProperties(n.customProps),n.pointPositions){var o=""+this.pointIndex;this.element.getClient("pointPositions")[o]=parseFloat(n.pointPositions)}if(n.shapePoints){for(var r=n.shapePoints.toString().replace(/\s/g,",").replace(/\r\n/g,","),s=r.split(","),l=new twaver.List,d=0,c=0;c<s.length;c+=3)isNaN(parseFloat(s[c]))||l.add({x:parseFloat(s[c]),y:parseFloat(s[c+2])}),d++;this.element.setPoints(l)}if(n.pointPositionsX){var h=this.element.getPoints();h.get(this.pointIndex).x=parseFloat(n.pointPositionsX)}if(n.pointPositionZ){var h=this.element.getPoints();h.get(this.pointIndex).y=parseFloat(n.pointPositionZ)}if(this.setObjectCommonProperties(this.element,n,i),e){var u=e.getElementBox().getDatas().get(0);if(u instanceof PipeShapeNode){var h=this.element.getPoints(),g=u.getPoints();if(g){for(var m=this.element.getClient("pointPositions"),p=this.element.getClient("positionY"),c=0;c<g.size();c++){var f=g.get(c);h.get(c).x=f.x,m[""+c]=t-f.y+p-100}this.element.setPoints(h)}}}},setTargetFlag:function(e){e.pointPositionY&&this.element.setClient(SPACE_POS_Y,parseFloat(e.pointPositionY));var t=this.element.getCenterLocation();e.pointPositionsX&&(t.x=parseFloat(e.pointPositionsX),this.element.setCenterLocation(t.x,t.y)),e.pointPositionZ&&(t.y=parseFloat(e.pointPositionZ),this.element.setCenterLocation(t.x,t.y))},setPointLight:function(e){if(e.lightPosition){var t=e.lightPosition,i=t.split(",");if(3===i.length){var n=parseFloat(i[0]?i[0]:0),a=parseFloat(i[1]?i[1]:0),o=parseFloat(i[2]?i[2]:0);this.element.setClient("lightPosition",n+","+a+","+o),this.element.setX(n),this.element.setY(a)}}e.lightColor&&this.element.setClient("lightColor",e.lightColor),e.lightIntensity&&this.element.setClient("lightIntensity",e.lightIntensity),e.businessId&&this.element.setClient(BID,e.businessId),e.customProps&&this.setCustomProperties(e.customProps)},setCustomProperties:function(e){var t=this.element.getClient("customProps");if(t)for(var i in t){var n=t[i];void 0==e[n]&&this.element.setClient(n,null)}var a=[];for(var o in e)o&&""!==e[o]?(a.push(o),this.element.setClient(o,e[o]),registerProperties.indexOf(o)<0&&(registerProperties.push(o),mono.SerializationSettings.setClientType(o,"string"))):delete e[o];this.element.setClient("customProps",a)},setObjectCommonProperties:function(e,t,i){i.getHideValue?i.getHideValue()&&e.setClient(PropertyConsts.LAYERID,i.getHideValue()):i.txtLayer&&i.txtLayer.getHideValue&&i.txtLayer.getHideValue()&&e.setClient(PropertyConsts.LAYERID,i.txtLayer.getHideValue())},showDialog:function(e,t,i,n,a,o){e.length<=0?Utils.showInputDialog(t,i,!0,n,this,a,!0,o):Utils.showInputDialog(t,i,!0,n,this,a,null,o)}}),SelectedTreePane=function(e,t,i,n,a){this.selectId=e,this.box=new twaver.ElementBox,this.tree=null,this.categoryCache=t,this.callback=i,this.type=n,this.showCount=a},twaver.Util.ext("SelectedTreePane",Object,{init:function(){var e=this;if(this.clickHandleMethod=function(t){e._clickHandle(t,e.tree)},this.categoryCache instanceof twaver.List){var t=this.categoryCache;if(t&&t.size()>0)for(var i=0;i<t.size();i++){var n=t.get(i);if(!this.box.getDataById(n.getId())){var a=new twaver.Node(n.getId());a.setName(n.getName()),this.box.add(a),this.initTreeBox(n.getChildren()._as,a)}}}else{var t=this.categoryCache[PropertyConsts.TYPE_ROOTCATEGORY];if(e.type&&(t=this.categoryCache[e.type][PropertyConsts.TYPE_ROOTCATEGORY]),t&&t.children.length>0)for(var i=0;i<t.children.length;i++){var n=t.children[i];if(!this.box.getDataById(n.id)){var a=new twaver.Node(n.id);a.setName(this.showCount?n.name+"("+n.count+")":n.name),this.box.add(a),this.initTreeBox(n.children,a)}}}this.initTree(),document.body.appendChild(this.tree.getView()),document.addEventListener("click",this.clickHandleMethod,!1)},initTreeBox:function(e,t){if(e)for(var i=0;i<e.length;i++){var n=e[i],a=new twaver.Node(n.id||n.getId());a.setName(this.showCount?n.name+"("+n.count+")"||n.getName()+"("+n.count+")":n.name||n.getName()),t&&a.setParent(t),this.box.add(a),(n.children||n.getChildren)&&this.initTreeBox(n.children||n.getChildren()._as,a)}},initTree:function(){this.tree=new twaver.controls.Tree(this.box),this.tree.setExpandIcon(Utils.Path+"arrowdown.png"),this.tree.setCollapseIcon(Utils.Path+"arrowright.png"),this.tree.expandAll(),this.tree.getIcon=function(){return null},this.tree.getSelectColor=function(){return"#f07819"},this.tree.onDataRendered=function(e,t,n,a){a?(e.style.background="#f07819",e.style.color="#ffffff"):t==i.newdata?(e.style.background="#f07819",e.style.color="#000000"):(e.style.background="#f0781900",e.style.color="#000000"),e.style.paddingLeft="10px"};var e=this.tree.getView(),t=document.getElementById(this.selectId).getBoundingClientRect();this.setTreeRect(e,t),e.setAttribute("id","categoryTree"),e.setAttribute("class","category");var i=this;i.newdata=null;e.addEventListener("mouseover",function(e){i.newdata=i.tree.getDataAt(e),i.olddata!==i.newdata&&(i.olddata&&i.tree.invalidateData(i.olddata),i.newdata&&i.tree.invalidateData(i.newdata),i.olddata=i.newdata)}),this.tree.getSelectionModel().addSelectionChangeListener(function(){var t=i.tree.getDataBox().getSelectionModel().getLastData();if(t){for(var n=t.getName(),a=t;a.getParent();)a=a.getParent(),n=a.getName()+" - "+n;var o=document.getElementById(i.selectId);o.value=n,o.categoryId=t.getId(),i.callback&&i.callback({categoryId:t.getId(),categoryValue:n}),document.body.removeChild(e),document.removeEventListener("click",i.clickHandleMethod,!1)}})},setTreeRect:function(e,t){var i=t.right-t.left,n=this.box.size()*this.tree.getRowHeight();e.style.left=t.left+"px",e.style.top=t.bottom+"px",e.style.position="fixed",e.style.width=i+"px",e.style.height=n+"px",e.style.maxHeight="280px",e.style.overflowX="hidden"},_clickHandle:function(e,t){var i=document.getElementById(this.selectId);if(i){var n=i.getBoundingClientRect();if(n){var a=n.right-n.left,o=this.box.size()*this.tree.getRowHeight();if(e.x>n.left&&e.x<n.left+a&&e.y>n.bottom&&n.bottom<n.bottom+o){var r=t.getDataAt(e);t.getDataBox().getSelectionModel().setSelection(r)}else document.body.removeChild(this.tree.getView()),document.removeEventListener("click",this.clickHandleMethod,!1)}}else document.body.removeChild(this.tree.getView()),document.removeEventListener("click",this.clickHandleMethod,!1)},setCategoryCache:function(e){this.categoryCache=e}}),RoomByPointsDialog=function(e,t,i){this.obj=e,this.network=t,this.e=i,this.roomInteraction=new RoomInteraction(t)},twaver.Util.ext("RoomByPointsDialog",Object,{show:function(){if(this.obj){var e=[{label:"Input room point data:    ",id:"pointsShape",type:"textArea",value:DEFALUT_POINTS_SHAPE}];
this.showDialog(e,"Room Property",this.createRoomByPoints)}},createRoomByPoints:function(e){if(e.pointsShape){var t=[],i=e.pointsShape.toString().replace(/\s/g,",").replace(/\r\n/g,","),n=i.split(",");if(!(n.length>=6))return void alert("Please input correct point data.");for(var a=0;a<n.length;a++)t[a]=parseInt(n[a]);var o=this.roomInteraction._createElement(network,network.getLogicalPoint(this.e),"RoomByPoints"),r=this.roomInteraction._createElement(network,network.getLogicalPoint(this.e),"floor05");r.setClient("hostNodeId",o.getId()),o.setClient(OID,o.getId()),o.setClient("decimalNumber",decimalNumber);for(var s=new twaver.List,a=0;a<t.length;a+=3)s.add({x:t[a],y:t[a+2]});o.setPoints(s),r.setPoints(s),o.setLocation(this.network.getLogicalPoint(this.e))}},showDialog:function(e,t,i,n){Utils.showInputDialog(e,t,!0,i,this,n)}}),TabPanel=function(){this.tabNames=[],this.tabDiv=document.createElement("div"),this.tabDiv.setAttribute("class","tab"),this.tabs=document.createElement("ul"),this.tabDiv.appendChild(this.tabs),this.tabListDiv=document.createElement("div"),this.tabListDiv.className="tabContent",this.mainTab=document.createElement("div"),this.mainTab.appendChild(this.tabDiv),this.mainTab.appendChild(this.tabListDiv),this.lastTabName="",this._tabChangedFunction=null},mono.extend(TabPanel,Object,{prefix:"cont_",_tabPrefix:"tab_",addTab:function(e,t){var i=this,n=document.createElement("li");n.innerHTML=e,n.setAttribute("id",this._tabPrefix+e),n.onclick=function(){if(n.className="on",t.style.display="block",i.lastTabName&&i.lastTabName!=e){var a=document.getElementById(i._tabPrefix+i.lastTabName),o=document.getElementById(i.prefix+i.lastTabName);a.className="",o.style.display="none",i._tabChangedFunction&&i._tabChangedFunction(e)}i.lastTabName=e},this.tabs.appendChild(n),t.id=this.prefix+e,t.style.paddingLeft="10px",t.style.paddingRight="10px",t.style.paddingTop="5px",t.style.paddingBottom="10px",this.tabListDiv.appendChild(t),this.tabNames[0]?t.style.display="none":(n.className="on",this.lastTabName=e),this.tabNames.push(e)},showTab:function(e){if(this.tabNames.indexOf(e)>=0){var t=document.getElementById(e),i=document.getElementById(this.prefix+e);t.className="on",i.style.display="block",this.lastTabName=e}},getView:function(){return this.mainTab},setTabChangedFunction:function(e){this._tabChangedFunction=e}}),TreeComboBox=function(e,t,i,n,a,o,r,s,l,d){this.datas=n&&Object.keys(n).length>0?n:{},this.scope=a||0,this.moduleTable=t,this.view=document.createElement("div"),e&&(this.label=document.createElement("span"),this.label.setAttribute("class","field"),this.label.innerHTML=e,this.view.appendChild(this.label)),this.input=document.createElement("input"),this.input.setAttribute("class","input");var s=s||"categoryId";this.input.id=s,r&&(this.input.value=r),this.input.setAttribute("readonly",i),this.input.setAttribute("class","teee-comboNode-input"),this.btnPick=document.createElement("input"),this.btnPick.setAttribute("class","category-pick-button"),this.btnPick.setAttribute("type","button"),this.view.appendChild(this.input),this.view.appendChild(this.btnPick),this.callback=o,this.selectedTreeId=s,this.categoryType=l,this.showCount=d,this.init()},twaver.Util.ext("TreeComboBox",Object,{init:function(){var e=this;this.btnPick.addEventListener("click",function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault?t.preventDefault():t.returnValue=!1;var i=e.selectedTreeId||"categoryId",n=new SelectedTreePane(i,e.datas,e.callback,e.categoryType,e.showCount);e.datas&&Object.keys(e.datas).length>0?n.init():Utils.initCategory(e.datas,e.moduleTable,e.scope,function(){n.init()})})},getView:function(){return this.view},getInputView:function(){return this.input},getHideValue:function(){return this.input.categoryId},getValue:function(){return this.input.value}}),mono.Dialog=function(){this.init()},twaver.Util.ext("mono.Dialog",Object,{isResizeable:!0,isUpResizeable:!0,isRightResizeable:!0,isDownResizeable:!0,isLeftResizeable:!0,isLeftUpResizeable:!0,isRightUpResizeable:!0,isRightDownResizeable:!0,isLeftDownResizeable:!0,getResizeable:function(){return this.isResizeable},setResizeable:function(e){this.isResizeable=e},setEachResizeable:function(e){Utils.isNotNull(e.isUpResizeable)&&(this.isUpResizeable=e.isUpResizeable),Utils.isNotNull(e.isRightResizeable)&&(this.isRightResizeable=e.isRightResizeable),Utils.isNotNull(e.isDownResizeable)&&(this.isDownResizeable=e.isDownResizeable),Utils.isNotNull(e.isLeftResizeable)&&(this.isLeftResizeable=e.isLeftResizeable),Utils.isNotNull(e.isLeftUpResizeable)&&(this.isLeftUpResizeable=e.isLeftUpResizeable),Utils.isNotNull(e.isRightUpResizeable)&&(this.isRightUpResizeable=e.isRightUpResizeable),Utils.isNotNull(e.isRightDownResizeable)&&(this.isRightDownResizeable=e.isRightDownResizeable),Utils.isNotNull(e.isLeftDownResizeable)&&(this.isLeftDownResizeable=e.isLeftDownResizeable),this.paintResizeDiv()},init:function(){this.mainPane=this.c("div"),this.mainPane.setAttribute("class","mono-dialog-ui"),this.paintResizeDiv()},paintResizeDiv:function(){this.dUp&&(this.mainPane.removeChild(this.dUp),this.dUp=null),this.dRight&&(this.mainPane.removeChild(this.dRight),this.dRight=null),this.dDown&&(this.mainPane.removeChild(this.dDown),this.dDown=null),this.dLeft&&(this.mainPane.removeChild(this.dLeft),this.dLeft=null),this.dLeftUp&&(this.mainPane.removeChild(this.dLeftUp),this.dLeftUp=null),this.dRightUp&&(this.mainPane.removeChild(this.dRightUp),this.dRightUp=null),this.dRightDown&&(this.mainPane.removeChild(this.dRightDown),this.dRightDown=null),this.dLeftDown&&(this.mainPane.removeChild(this.dLeftDown),this.dLeftDown=null),this.isResizeable&&(this._fR=this.bindAsEventListener(this,this.Resize),this._fS=this.bind(this,this.Stop),this.isUpResizeable&&(this.dUp=this.c("div","mono-dialog-up"),this.mainPane.appendChild(this.dUp),this.bindEvent(this.dUp,"up")),this.isRightResizeable&&(this.dRight=this.c("div","mono-dialog-right"),this.mainPane.appendChild(this.dRight),this.bindEvent(this.dRight,"right")),this.isDownResizeable&&(this.dDown=this.c("div","mono-dialog-down"),this.mainPane.appendChild(this.dDown),this.bindEvent(this.dDown,"down")),this.isLeftResizeable&&(this.dLeft=this.c("div","mono-dialog-left"),this.mainPane.appendChild(this.dLeft),this.bindEvent(this.dLeft,"left")),this.isLeftUpResizeable&&(this.dLeftUp=this.c("div","mono-dialog-left-up"),this.mainPane.appendChild(this.dLeftUp),this.bindEvent(this.dLeftUp,"left-up")),this.isRightUpResizeable&&(this.dRightUp=this.c("div","mono-dialog-right-up"),this.mainPane.appendChild(this.dRightUp),this.bindEvent(this.dRightUp,"right-up")),this.isRightDownResizeable&&(this.dRightDown=this.c("div","mono-dialog-right-down"),this.mainPane.appendChild(this.dRightDown),this.bindEvent(this.dRightDown,"right-down")),this.isLeftDownResizeable&&(this.dLeftDown=this.c("div","mono-dialog-left-down"),this.mainPane.appendChild(this.dLeftDown),this.bindEvent(this.dLeftDown,"left-down")))},bindEvent:function(e,t){if(e){var i;switch(t.toLowerCase()){case"up":i=this.Up;break;case"down":i=this.Down;break;case"left":i=this.Left;break;case"right":i=this.Right;break;case"left-up":i=this.LeftUp;break;case"right-up":i=this.RightUp;break;case"left-down":i=this.LeftDown;break;case"right-down":default:i=this.RightDown}this.addEventHandler(e,"mousedown",this.bindAsEventListener(this,this.start,i))}},Up:function(e){this._styleHeight=Math.max(this._sideDown-e.clientY,0),this._styleTop=this._fixTop-this._styleHeight},Down:function(e){this._styleHeight=Math.max(e.clientY-this._sideUp,0)},Right:function(e){this._styleWidth=Math.max(e.clientX-this._sideLeft,0)},Left:function(e){this._styleWidth=Math.max(this._sideRight-e.clientX,0),this._styleLeft=this._fixLeft-this._styleWidth},RightDown:function(e){this.Right(e),this.Down(e)},RightUp:function(e){this.Right(e),this.Up(e)},LeftDown:function(e){this.Left(e),this.Down(e)},LeftUp:function(e){this.Left(e),this.Up(e)},start:function(e,t){this._fun=t,this._styleWidth=this.mainPane.clientWidth,this._styleHeight=this.mainPane.clientHeight,this._styleLeft=this.mainPane.offsetLeft,this._styleTop=this.mainPane.offsetTop,this._sideLeft=e.clientX-this._styleWidth,this._sideRight=e.clientX+this._styleWidth,this._sideUp=e.clientY-this._styleHeight,this._sideDown=e.clientY+this._styleHeight,this._fixLeft=this._styleWidth+this._styleLeft,this._fixTop=this._styleHeight+this._styleTop,this.addEventHandler(document,"mousemove",this._fR),this.addEventHandler(document,"mouseup",this._fS)},Resize:function(e){with(Utils.stopPropagation(e),this._fun(e),this.mainPane.style)width=this._styleWidth+"px",height=this._styleHeight+"px",top=this._styleTop+"px",left=this._styleLeft+"px";this.resizeCallback(this._styleLeft,this._styleTop,this._styleWidth,this._styleHeight)},Stop:function(e){Utils.stopPropagation(e),this.removeEventHandler(document,"mousemove",this._fR),this.removeEventHandler(document,"mouseup",this._fS)},c:function(e,t){return div=document.createElement(e),t&&div.setAttribute("id",t),div},g:function(e){return document.getElementById(e)},resizeCallback:function(){},addEventHandler:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},removeEventHandler:function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):e["on"+t]=null},bind:function(e,t){return function(){return t.apply(e,arguments)}},bindAsEventListener:function(e,t){var i=Array.prototype.slice.call(arguments).slice(2);return function(n){return t.apply(e,[n||window.event].concat(i))}},getView:function(){return this.mainPane},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(this.hasClass(e,t)){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(i,"")}}}),AutoPackTreeTable=function(e){AutoPackTreeTable.superClass.constructor.call(this,e)},twaver.Util.ext("AutoPackTreeTable",twaver.controls.TreeTable,{_minPackWidth:100,getMinPackWidth:function(){return this._minPackWidth},setMinPackWidth:function(e){this._minPackWidth=e},adjustBounds:function(e){AutoPackTreeTable.superClass.adjustBounds.call(this,e),this.packColumns(e.width)},packColumns:function(e){var t,i=new twaver.List;this.getColumnBox().getRoots().forEach(function(t){t.isVisible()&&(t.getClient("pack")?i.add(t):e-=t.getWidth())}),0!==i.size()&&(t=e/i.size(),t<this._minPackWidth&&(t=this._minPackWidth),i.forEach(function(e){e.setWidth(t)}))}}),BaseTreeTable=function(){},twaver.Util.ext("BaseTreeTable",mono.Dialog,{init:function(){this.table=new AutoPackTreeTable(this.databox),this.tablePane=new twaver.controls.TablePane(this.table),this.tablePane.getView().setAttribute("class","sidebar-treetable"),this.tablePane.getTableHeader().setHeight(21),this.tablePane.getTableHeader().onColumnRendered=function(e){e.style.backgroundColor="#E0E0E0",e.style.color="#000",e.style.borderColor="#E9E9E9"},this.table.setColumnLineColor("#E9E9E9"),this.table.setRowLineColor("#E9E9E9"),this.table.getIcon=function(){return null},this.table.setIndent(9),this.table.setEditable(!0),this.table.setCollapseIcon("images/tree-collapse-icon.png"),this.table.setExpandIcon("images/tree-expand-icon.png"),this.table.expandAll(),this.initTreeTable()},initTreeTable:function(){},createColumn:function(e,t,i,n,a,o,r,s,l,d,c){var h=new twaver.Column(t);return h.setName(t),h.setPropertyName(i),h.setPropertyType(n),a&&h.setValueType(a),o&&h.setWidth(o),l&&h.setClient("pack",!0),h.setEditable(r),h.setSortable(s),d&&h.setHorizontalAlign(d),h.renderHeader=function(e){var t=document.createElement("span");t.style.whiteSpace="nowrap",t.style.verticalAlign="middle",t.style.padding="1px 2px 1px 2px",t.innerHTML=h.getName()?h.getName():h.getPropertyName(),t.setAttribute("title",t.innerHTML),t.style.font="12px Helvetica",e.style.textAlign="center",e.appendChild(t)},c&&h.setEnumInfo(c),e.getColumnBox().add(h),h},expandTreeTable:function(){this.table.getTable().expandAll()},createHref:function(e,t){var i=document.createElement("button");return i.className=e,i.onclick=t,i},getView:function(){return this.tablePane.getView()},getTablePane:function(){return this.tablePane},getTreeTable:function(){return this.table},createATagButton:function(e,t,i){var n=document.createElement("a"),a=document.createElement("input");a.setAttribute("type","button"),a.setAttribute("class",t),a.onclick=i,n.appendChild(a),e.appendChild(n)}}),SidebarTreeTable=function(e){this.databox=e,e||(this.databox=new twaver.ElementBox),this.init()},twaver.Util.ext("SidebarTreeTable",BaseTreeTable,{initTreeTable:function(){this.tablePane.getView().setAttribute("onmousedown","Utils.stopPropagation(event)"),this.tablePane.getView().setAttribute("ondblclick","Utils.stopPropagation(event)"),this.table.getView().setAttribute("onmousedown","Utils.stopPropagation(event)"),this.table.getView().setAttribute("ondblclick","Utils.stopPropagation(event)"),this.createTreeTable()},createStdColumn:function(e){var t=this,e=e||"t3d.standout",i=this.createColumn(this.table,"Standout",e,"client","boolean",20,!0,!1),n=t.c("input");n.setAttribute("type","button"),n.checked=!0,n.setAttribute("class","sidebar-head-standout"),n.onclick=function(){var a=this.checked;i.checked=a,a?n.setAttribute("class","sidebar-head-standout"):n.setAttribute("class","sidebar-head-standout sidebar-head-standout-down"),this.checked=!this.checked,t.databox.forEach(function(t){t.setClient(e,a)})};t.c("div");i.renderHeader=function(e){e.style.textAlign="center",e.appendChild(n)},i.renderCell=function(i){var n=t.c("input");n.setAttribute("type","button");var a=i.data.getClient(e);a?n.setAttribute("class","sidebar-head-standout"):n.setAttribute("class","sidebar-head-standout sidebar-head-standout-down"),n.onclick=function(){var t=i.data.getClient(e);i.data.setClient(e,!t)},i.div.appendChild(n)}},createProColumn:function(){var e=this,t=this.createColumn(this.table,"Detail","selected","accessor","boolean",40,!1,!1);t.renderCell=function(t){var i=e.createHref("table-item-Editor table-item-detail",function(){e.showObjectDialog(t.data)});t.div.appendChild(i)},t.setHorizontalAlign("center")},showObjectDialog:function(){},createTreeTable:function(){}}),LayerTreeTable=function(e){this.databox=e,e||(this.databox=new twaver.LayerBox),this.init()},twaver.Util.ext("LayerTreeTable",SidebarTreeTable,{createTreeTable:function(){var e=this;this.table.setCheckMode("default"),this.table.getTreeColumn().renderHeader=function(t){var i=e.c("div");i.style.whiteSpace="nowrap",i.style.verticalAlign="middle",i.style.padding="1px 2px 1px 2px",i.innerHTML="Name",i.setAttribute("title",i.innerHTML),t.style.textAlign="center",t.appendChild(i)},this.table.getTreeColumn().setClient("pack",!0),this.createStdColumn("visible")},getDataBox:function(){return this.databox}}),Room2dSidebarTreeTable=function(e){this.databox=e,e||(this.databox=new twaver.ElementBox),this.init()},twaver.Util.ext("Room2dSidebarTreeTable",SidebarTreeTable,{createTreeTable:function(){var e=this;this.table.getTreeColumn().setClient("pack",!0),this.table.getTreeColumn().renderHeader=function(t){var i=e.c("div");i.style.whiteSpace="nowrap",i.style.verticalAlign="middle",i.style.padding="1px 2px 1px 2px",i.innerHTML="Name",i.setAttribute("title",i.innerHTML),t.style.textAlign="center",t.appendChild(i)};this.createColumn(this.table,"BID","businessId","client","string",60,!0,!1,!1,"right");this.createStdColumn(),this.createProColumn()},showObjectDialog:function(e){new RoomDialog(e,-1).show()}}),ComponentSidebarTreeTable=function(e){this.databox=e,e||(this.databox=new twaver.ElementBox),this.init()},twaver.Util.ext("ComponentSidebarTreeTable",SidebarTreeTable,{createTreeTable:function(){var e=this;this.table.getTreeColumn().setClient("pack",!0),this.table.getTreeColumn().renderHeader=function(t){var i=e.c("div");i.style.whiteSpace="nowrap",i.style.verticalAlign="middle",i.style.padding="1px 2px 1px 2px",i.innerHTML="Type",i.setAttribute("title",i.innerHTML),t.style.textAlign="center",t.appendChild(i)};this.createColumn(this.table,"OID","oid","client","string",60,!0,!1,!1,"right");this.createStdColumn(),this.createProColumn()},showObjectDialog:function(e){show3DObjectDialog(e.getId())}}),AnimationTable=function(e){this.currentLayerbox=e,e||(this.currentLayerbox=new twaver.LayerBox),this.databox=new twaver.LayerBox,this.clientPros=["action","anchor","value","time","delay","easing","levels"],this.syncTempBoxFromCurrentLayerBox(),this.init()},twaver.Util.ext("AnimationTable",BaseTreeTable,{initTreeTable:function(){var e=this;this.tablePane.getTableHeader().setHeight(30),this.tablePane.getTableHeader().onColumnRendered=function(e){e.style.backgroundColor="#FF8207",e.style.color="#fff",e.style.borderColor="#E0E0E0"},this.tablePane.getView().setAttribute("onmouseover","Utils.stopPropagation(event)"),this.table.getView().setAttribute("onmouseover","Utils.stopPropagation(event)"),this.tablePane.getView().style.width="690px",this.tablePane.getView().style.height="300px",this.table.setRowHeight(30),this.table.getTreeColumn().setWidth(0),this.table.getTreeColumn().setVisible(!1),this.table.getTreeColumn().setClient("pack",!1);this.createColumn(this.table,"Action","action","client","string",80,!0,!1,!1,"center",mono.AniUtil.getAllActions());this.createColumn(this.table,"Anchor/Direction","anchor","client","string",120,!0,!1,!1,"center",mono.AniUtil.getAllAnchors()),this.createColumn(this.table,"Value","value","client","number",80,!0,!1,!1,"center",mono.AniUtil.getAllValues()),this.createColumn(this.table,"Time","time","client","number",80,!0,!1,!0,"right"),this.createColumn(this.table,"Delay","delay","client","number",80,!0,!1,!1,"right"),this.createColumn(this.table,"Easing","easing","client","string",120,!0,!1,!1,"center",mono.AniUtil.AllEasingNames);var t=(this.databox.getRoots().size()-1,this.createColumn(this.table,"Levels","levels","client","levels",80,!0,!1,!1,"center"));t.renderCell=function(t){var i=document.createElement("div");i.setAttribute("class","floorAction"),e.createATagButton(i,"upFloor",function(){e.moveAnimation(t.data,"up")}),e.createATagButton(i,"downFloor",function(){e.moveAnimation(t.data,"down")}),console.log(e.databox.getRoots().get(0),t.data),"default"!==t.data.getId()?e.createATagButton(i,"deleteFloor",function(){e.deleteAnimation(t.data)}):e.createATagButton(i,"addFloor",function(){e.addAnimation()}),t.div.appendChild(i)}},createATagButton:function(e,t,i){var n=document.createElement("a"),a=document.createElement("input");a.setAttribute("type","button"),a.setAttribute("class",t),a.onclick=i,n.appendChild(a),e.appendChild(n)},moveAnimation:function(e,t){"up"===t?this.databox.moveUp(e):"down"===t&&this.databox.moveDown(e)},deleteAnimation:function(e){return this.databox.size()<=1?void alert("can not delete the default layer"):void this.databox.remove(e)},addAnimation:function(){var e=new twaver.Layer;e.setClient("time",1500),e.setClient("delay",0),e.setClient("easing","Linear.None"),this.databox.add(e)},syncTempBoxFromCurrentLayerBox:function(){var e=this;this.databox.clear(),this.currentLayerbox.forEach(function(t){var i=e.databox.getDataById(t.getId());i||(i=new twaver.Layer(t.getId()));for(var n=0;n<e.clientPros.length;n++)i.setClient(e.clientPros[n],t.getClient(e.clientPros[n]));e.databox.getDataById(t.getId())||e.databox.add(i)})},syncCurrentLayerBoxFromTempBox:function(){var e=this,t={};this.databox.forEach(function(i){t[i.getId()]=i,e.currentLayerbox.getDataById(i.getId())||e.currentLayerbox.add(i)}),this.currentLayerbox.forEach(function(i){t[i.getId()]||e.currentLayerbox.remove(i)});for(var i=this.databox.getRoots(),n=0;n<i.size();n++){for(var a=i.get(n),o=e.currentLayerbox.getDataById(a.getId()),r=0;r<e.clientPros.length;r++)o.setClient(e.clientPros[r],a.getClient(e.clientPros[r]));e.currentLayerbox.moveTo(o,n)}},saveAnimation:function(){return this.checkAnimationData()?void this.syncCurrentLayerBoxFromTempBox():!1},checkAnimationData:function(){return this.databox.forEach(function(e){return e.getClient("action")?e.getClient("anchor")?void 0:(alert("Anchor is required"),!1):(alert("Action is required"),!1)}),!0},showDialog:function(e){Utils.showDialog("animation_manager",this.getView(),"Animation Management",!0,!1,null,this.callback,this,[e],[]),this.getTablePane().getView().parentNode.style.width="690px",this.getTablePane().getView().parentNode.style.height="300px",Utils.setDialogRect("animation_manager")},callback:function(e){this.saveAnimation();var t="";this.currentLayerbox.getRoots().forEach(function(e){t+=mono.AniUtil.getAnimationString(e.getClient("action"),e.getClient("anchor"),e.getClient("value"),e.getClient("time"),e.getClient("delay"),e.getClient("easing"))+";"}),t=t.substring(0,t.length-1),document.getElementById(e).value=t}}),SidebarPane=function(){this.init()},twaver.Util.ext("SidebarPane",mono.Dialog,{init:function(){SidebarPane.superClass.init.call(this),this.setEachResizeable({isUpResizeable:!1,isRightResizeable:!1,isDownResizeable:!0,isLeftUpResizeable:!1,isRightUpResizeable:!1,isRightDownResizeable:!1,isLeftDownResizeable:!0});var e=this;this.addClass(this.mainPane,"sidebar-content"),this.sidebarContent=this.c("div"),this.sidebarTitle=this.c("div"),this.sidebarTitle.setAttribute("class","sidebar-title"),this.titleIcon=this.c("button"),this.titleIcon.setAttribute("class","sidebarPane-icon"),this.sidebarTitle.appendChild(this.titleIcon),this.centerPane=this.initCenterPane(),this.sidebarContent.appendChild(this.sidebarTitle),this.sidebarContent.appendChild(this.centerPane),this.mainPane.appendChild(this.sidebarContent),this.titleIcon.onclick=function(){e.setSidebarExpanded(!e.isDivVisible(e.centerPane))}},resetDivStyle:function(e){e.width="",e.height="",e.left="",e.right="",e.top=""},initCenterPane:function(){},getView:function(){return this.mainPane},isDivVisible:function(e){return"block"===e.style.display||""===e.style.display},setSidebarExpanded:function(e){var t=this;e?(t.centerPane.style.display="block",t.resetDivStyle(t.mainPane.style),t.removeClass(t.mainPane,"sidebar-content-min"),t.titleIcon.setAttribute("class","sidebarPane-icon"),t.setEachResizeable({isLeftResizeable:!0})):(t.centerPane.style.display="none",t.addClass(t.mainPane,"sidebar-content-min"),t.resetDivStyle(t.mainPane.style),t.titleIcon.setAttribute("class","sidebarPane-icon sidebarPane-icon-expand-img"),t.setEachResizeable({isLeftResizeable:!1})),this.resizeCallback()}}),Room2dSidebarLayerPane=function(e){this.layerbox=e,this.init()},twaver.Util.ext("Room2dSidebarLayerPane",Object,{init:function(){this.layerPane=document.createElement("div"),this.layerPane.appendChild(this.createSearchPane()),this.layerTree=new LayerTreeTable(this.layerbox),this.layerTree.addClass(this.layerTree.getView(),"layer-sidebar"),this.layerPane.appendChild(this.layerTree.getView()),this.databox=this.layerTree.getDataBox(),this.databox.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this)},getView:function(){return this.layerPane},getLayerTreeTable:function(){return this.layerTree},createSearchPane:function(){var e=this,t=document.createElement("div");t.setAttribute("class","layerSearch");var i=document.createElement("a");i.setAttribute("class","add"),i.innerHTML="<em></em>Add",t.appendChild(i),i.onclick=function(){e.showAddLayerDialog()};var n=document.createElement("a");n.setAttribute("class","edit"),n.innerHTML="<em></em>Edit",t.appendChild(n),n.onclick=function(){e.showEditLayerDialog()};var a=document.createElement("a");return a.setAttribute("class","deletelayer"),a.innerHTML="<em></em>Delete",t.appendChild(a),a.onclick=function(){e.showDeleteDialog()},t},showEditLayerDialog:function(){var e=this.databox.getSelectionModel().getSelection();if(!e||e.size()<=0)return void alert("No Selected Layer");var t=new TreeComboBox("Parent:",null,!0,this.databox.getRoots()),i=this.getunPredefinedLayers(this.databox.getSelectionModel().getSelection()).get(0);if(!i)return void alert("Can not Edit Pre-defined Layers");var n=[{label:"Name:",id:"name",readonly:!1,value:i.getName()},{value:t.getView(),type:"div"},{label:"",id:"visibled",type:"checkbox",inner:"Layer is visible",checked:i.getClient("visible")}];Utils.showInputDialog(n,"Edit Layer",!0,this.updateLayer,this,[t,i],null,null)},showDeleteDialog:function(){var e=this.databox.getSelectionModel().getSelection();if(!e||e.size()<=0)return void alert("No Selected Layers");if(confirm("Sure to Delete Layers"))for(var e=this.databox.getSelectionModel().getSelection(),t=e.size()-1;t>=0;t--){var i=e.get(t);if(i.getClient("predefined"))return void alert('Can not Remove "'+i.getName()+'" Layer');this.databox.remove(i)}},showAddLayerDialog:function(){var e=new TreeComboBox("Parent:",null,!0,this.databox.getRoots()),t=[{label:"Name:",id:"name",readonly:!1},{value:e.getView(),type:"div"},{label:"",id:"visibled",type:"checkbox",inner:"Layer is visible",checked:!0}];Utils.showInputDialog(t,"Add Layer",!0,this.addLayer,this,[e],null,null)},addLayer:function(e,t){var i=new twaver.Layer(t.name);i.setName(t.name),i.setParent(this.databox.getDataById(e.getHideValue())),i.setClient("visible",t.visibled),this.databox.add(i)},updateLayer:function(e,t,i){t.setName(i.name),t.setParent(this.databox.getDataById(e.getHideValue())),t.setClient("visible",i.visibled)},handleSelectionChange:function(){var e=document.getElementsByClassName("edit")[0];e.style.display=this.databox.getSelectionModel().getSelection().size()>=2?"none":"inline-block"},getunPredefinedLayers:function(e){var t=new twaver.List,i=e||this.databox.getDatas();return i.forEach(function(e){"default"===e.getId()||e.getClient("predefined")||t.add(e)}),t}}),Room2dSidebarPane=function(e,t,i){this.databox=e,this.layerbox=t,this.network=i,Room2dSidebarPane.superClass.constructor.call(this)},twaver.Util.ext("Room2dSidebarPane",SidebarPane,{init:function(){Room2dSidebarPane.superClass.init.call(this)},initCenterPane:function(){var e=this;this.addClass(this.mainPane,"room-sidebar-content"),this.topTabPane=new TabPanel,this.topTabPane.getView().setAttribute("class","sidebar-tabpane room-sidebar-tabpane"),this.treeTable=new Room2dSidebarTreeTable(this.databox),this.treeTable.getView().style.background="#ffffff",this.topTabPane.addTab("Tree View",this.treeTable.getView()),this.layerPane=new Room2dSidebarLayerPane(this.layerbox),this.topTabPane.addTab("Layer View",this.layerPane.getView()),this.topTabPane.setTabChangedFunction(function(t){"Layer View"==t?e.layerPane.getLayerTreeTable().getTablePane().invalidate():"Tree View"==t&&e.treeTable.getTablePane().invalidate()}),this.bottomTabPane=new TabPanel,this.bottomTabPane.getView().setAttribute("class","sidebar-tabpane overview-sidebar-tabpane"),this.overview=new twaver.vector.Overview(this.network),this.overview.setFillColor("rgba(240, 209, 181, 0.8)");var t=document.createElement("div");t.style.width="91%",t.style.height="91%'";var i=this.overview.getView();return i.style.left="0px",i.style.right="0px",i.style.top="0px",i.style.bottom="0px",t.appendChild(i),this.bottomTabPane.addTab("OverView",t),this.splitPane=new twaver.controls.SplitPane(this.topTabPane,this.bottomTabPane,"vertical",.6),this.splitPane.getView().setAttribute("class","sidebar-center"),this.splitPane.setDividerWidth(3),this.splitPane.setDividerBackground("#f07819"),this.splitPane.addPropertyChangeListener(function(t){"position"===t.property&&e.invalidate()}),this.splitPane.getView()},resizeCallback:function(){this.splitPane.invalidate();var e={};e.x=this.treeTable.getTreeTable().getView().style.left,e.y=this.treeTable.getTreeTable().getView().style.top,e.width="",e.height="",this.treeTable.getTablePane().adjustBounds(e),this.layerPane.getLayerTreeTable().getTablePane().invalidate()},invalidate:function(){this.treeTable.getTablePane().invalidate(),this.layerPane.getLayerTreeTable().getTablePane().invalidate()}}),Room3dSidebarPane=function(e){this.layerbox=e,Room3dSidebarPane.superClass.constructor.call(this)},twaver.Util.ext("Room3dSidebarPane",SidebarPane,{init:function(){Room3dSidebarPane.superClass.init.call(this)},initCenterPane:function(){this.addClass(this.mainPane,"room-3d-sidebar-content"),this.topTabPane=new TabPanel,this.topTabPane.getView().setAttribute("class","sidebar-tabpane room-sidebar-tabpane"),this.layerPane=new Room2dSidebarLayerPane(this.layerbox),this.topTabPane.addTab("Layer View",this.layerPane.getView());var e=this.c("div");return e.setAttribute("class","sidebar-center"),e.appendChild(this.topTabPane.getView()),e},resizeCallback:function(){this.invalidate()},invalidate:function(){this.layerPane.getLayerTreeTable().getTablePane().invalidate()}}),ComponentSidebarPane=function(e){this.databox=e,ComponentSidebarPane.superClass.constructor.call(this,e)},twaver.Util.ext("ComponentSidebarPane",SidebarPane,{init:function(){ComponentSidebarPane.superClass.init.call(this)},initCenterPane:function(){return this.addClass(this.mainPane,"com-sidebar-content"),this.centerPane=this.c("div"),this.centerPane.setAttribute("class","sidebar-center"),this.treeTable=new ComponentSidebarTreeTable(this.databox),this.tabPane=new TabPanel,this.tabPane.getView().setAttribute("class","sidebar-tabpane"),this.tabPane.addTab("Tree View",this.treeTable.getView()),this.centerPane.appendChild(this.tabPane.getView()),this.treeTable.getView().style.background="#ffffff",this.centerPane},resizeCallback:function(){var e={};e.x=this.treeTable.getTreeTable().getView().style.left,e.y=this.treeTable.getTreeTable().getView().style.top,e.width="",e.height="",this.treeTable.getTablePane().adjustBounds(e)}}),SettingDialog=function(e,t,i,n,a,o,r){this.isComponent=e,this.ambientLight=t,this.pointLights=i,this.box2d=n,this.box3d=a,this.allNetworks=o,this.viewCallback=r},twaver.Util.ext("SettingDialog",Object,{showSettingDialog:function(){var e=localStorage.getItem("roomBackground");if(this.isComponent&&(e=localStorage.getItem("componentBackground")),e||(e="#FFFFFF"),!this.isComponent){var t=parseInt(localStorage.getItem("gridGap"));t||(t=50);var i=parseInt(localStorage.getItem(SNAPGRID));i||(i=50)}var n=[];this.pointLights.forEach(function(e){n.push(e.getPosition().x+","+e.getPosition().y+","+e.getPosition().z)});var a=[{label:"Load Resource from:",id:"loadResource",type:"select",tab:"Login",options:[TYPE_LOCAL,TYPE_CLOUD],value:loadResource,eve:"onchange",listener:function(){var e=document.getElementById("cloudKey"),t=document.getElementById("lableCloudKey"),i=document.getElementById("cloudPassword"),n=document.getElementById("lableCloudPassword"),a=document.getElementById("loadResource").value;a===TYPE_CLOUD?(t.style.display="block",e.style.display="block",i.style.display="block",n.style.display="block"):(t.style.display="none",e.style.display="none",i.style.display="none",n.style.display="none")}},{label:"Cloud Key:",labelId:"lableCloudKey",id:"cloudKey",type:"input",tab:"Login",value:cloudKey,display:loadResource===TYPE_CLOUD},{label:"Cloud Password:",labelId:"lableCloudPassword",id:"cloudPassword",type:"password",tab:"Login",value:cloudPassword,display:loadResource===TYPE_CLOUD},{label:"Decimal Point Number:",id:"decimalNumber",type:"select",options:[0,1,2,3,4],value:decimalNumber},{label:"",id:"showAxis",type:"checkbox",inner:"Show Axis on 3D View",checked:showAxis},{label:"",id:"showAxisText",type:"checkbox",inner:"Show Axis Text on 3D View",checked:showAxisText},{label:"",id:"enableEasing",type:"checkbox",inner:"Enable Easing on 3D View",checked:enableEasing},{label:"Select Style:",id:"selectStyle",type:"select",options:[PropertyConsts.SELECT_STYLE.WIREFRAME,PropertyConsts.SELECT_STYLE.NORMAL,PropertyConsts.SELECT_STYLE.BORDER],value:selectStyle},{label:"Full Rotation:",id:"cameraRotation",inner:"Camera freely rotate in all direction",type:"checkbox",checked:isFullRotation,tab:"Camera"},{label:"Turn Ambient Light On:",id:"ambientLightOn",type:"checkbox","return":!0,checked:this.ambientLight.isVisible(),tab:"Lights"},{label:"Color:",id:"ambientLightColor",type:"multipleS",value:"#"+this.ambientLight.getColor().getHex().toString(16).toUpperCase(),tab:"Lights"},{label:"Turn Point Light1 On:",id:"pointLightOn",type:"checkbox","return":!0,checked:this.pointLights[0].isVisible(),tab:"Lights"},{label:"Color:",id:"pointLightColor",type:"multipleS",idTyle:"pointLightColor","return":!0,value:"#"+this.pointLights[0].getColor().getHex().toString(16).toUpperCase(),tab:"Lights"},{label:"Position:",id:"pointLightPosition",type:"multipleS",idTyle:"pointLightPosition","return":!0,value:n[0],tab:"Lights"},{label:"Intensity:",id:"pointLightIntensity",type:"multipleS",idTyle:"pointLightIntensity",value:this.pointLights[0].getIntensity(),tab:"Lights"},{label:"Turn Point Light2 On:",id:"pointLight2On",type:"checkbox","return":!0,checked:this.pointLights[1].isVisible(),tab:"Lights"},{label:"Color:",id:"pointLight2Color",type:"multipleS",idTyle:"pointLightColor","return":!0,value:"#"+this.pointLights[1].getColor().getHex().toString(16).toUpperCase(),tab:"Lights"},{label:"Position:",id:"pointLight2Position",type:"multipleS",idTyle:"pointLightPosition","return":!0,value:n[1],tab:"Lights"},{label:"Intensity:",id:"pointLight2Intensity",type:"multipleS",idTyle:"pointLightIntensity",value:this.pointLights[1].getIntensity(),tab:"Lights"},{label:"Turn Point Light3 On:",id:"pointLight3On",type:"checkbox","return":!0,checked:this.pointLights[2].isVisible(),tab:"Lights"},{label:"Color:",id:"pointLight3Color",type:"multipleS",idTyle:"pointLightColor","return":!0,value:"#"+this.pointLights[2].getColor().getHex().toString(16).toUpperCase(),tab:"Lights"},{label:"Position:",id:"pointLight3Position",type:"multipleS",idTyle:"pointLightPosition","return":!0,value:n[2],tab:"Lights"},{label:"Intensity:",id:"pointLight3Intensity",type:"multipleS",idTyle:"pointLightIntensity",value:this.pointLights[2].getIntensity(),tab:"Lights"},{label:"Turn Point Light4 On:",id:"pointLight4On",type:"checkbox","return":!0,checked:this.pointLights[3].isVisible(),tab:"Lights"},{label:"Color:",id:"pointLight4Color",type:"multipleS",idTyle:"pointLightColor","return":!0,value:"#"+this.pointLights[3].getColor().getHex().toString(16).toUpperCase(),tab:"Lights"},{label:"Position:",id:"pointLight4Position",type:"multipleS",idTyle:"pointLightPosition","return":!0,value:n[3],tab:"Lights"},{label:"Intensity:",id:"pointLight4Intensity",type:"multipleS",idTyle:"pointLightIntensity",value:this.pointLights[3].getIntensity(),tab:"Lights"},{label:"Turn Point Light5 On:",id:"pointLight5On",type:"checkbox","return":!0,checked:this.pointLights[4].isVisible(),tab:"Lights"},{label:"Color:",id:"pointLight5Color",type:"multipleS",idTyle:"pointLightColor","return":!0,value:"#"+this.pointLights[4].getColor().getHex().toString(16).toUpperCase(),tab:"Lights"},{label:"Position:",id:"pointLight5Position",type:"multipleS",idTyle:"pointLightPosition","return":!0,value:n[4],tab:"Lights"},{label:"Intensity:",id:"pointLight5Intensity",type:"multipleS",idTyle:"pointLightIntensity",value:this.pointLights[4].getIntensity(),tab:"Lights"},{label:"Network Background:",id:"networkBackground",type:"input",value:e.toUpperCase()}];
if(this.isComponent){var o=(this.allNetworks[1].getInteractions()[0],[{label:"",id:"showFloor",type:"checkbox",inner:"Show Floor",checked:showFloor,tab:"Floor",eve:"onchange",listener:function(){var e=document.getElementById("lableFloorStyle"),t=document.getElementById("floorStyle"),i=document.getElementById("lableFloorSize"),n=document.getElementById("floorSize"),a=document.getElementById("showFloor").checked;a?(e.style.display="block",t.style.display="block",i.style.display="block",n.style.display="block"):(e.style.display="none",t.style.display="none",i.style.display="none",n.style.display="none")}},{label:"Floor style:",labelId:"lableFloorStyle",id:"floorStyle",type:"select",tab:"Floor",options:[PropertyConsts.FloorStyle.BUFFER_NODE_FLOOR,PropertyConsts.FloorStyle.PLANE_FLOOR],value:floorStyle,display:showFloor},{label:"Floor size:",labelId:"lableFloorSize",id:"floorSize",type:"select",tab:"Floor",options:[PropertyConsts.FloorSize.SMALL,PropertyConsts.FloorSize.MEDIUM,PropertyConsts.FloorSize.LARGE],value:floorSize,display:showFloor},{label:"Selectable:",id:"allViewSelectable",type:"checkbox",checked:allViewSelectable,inner:"Enable selection"},{label:"Scale Minimum Limit:",id:"scaleMinLimit",type:"input",value:scaleMinLimit},{label:"Scale Maximum Limit:",id:"scaleMaxLimit",type:"input",value:scaleMaxLimit},{label:"Zoom Speed:",id:"zoomSpeed",type:"input",value:comZoomSpeed,tab:"Camera"},{label:"Rotate Speed:",id:"rotateSpeed",type:"input",value:comRotateSpeed,tab:"Camera"},{label:"Pan Speed:",id:"panSpeed",type:"input",value:comPanSpeed,tab:"Camera"},{label:"Max Distance:",id:"maxDistance",type:"input",value:comMaxDistance,tab:"Camera"},{label:"Min Distance:",id:"minDistance",type:"input",value:comMinDistance,tab:"Camera"},{label:"Near Clipping Plane:",id:"nearPlane",type:"input",value:comNearPlane,tab:"Camera"},{label:"Far Clipping Plane:",id:"farPlane",type:"input",value:comFarPlane,tab:"Camera"},{label:"Optic Angle:",id:"fov",type:"input",value:comFov,tab:"Camera"}]);a=a.concat(o)}else"block"===document.getElementById("floor2d").style.display&&(a.unshift({label:"",id:"showOriginalFlag",inner:"Show 2D Original Point",type:"checkbox",checked:originalFlagElement&&originalFlagElement.isShowPoint()}),a.unshift({label:"",id:"showTargetFlag",inner:"Camera Look at Target",type:"checkbox",checked:targetFlagElement&&targetFlagElement.isShowPoint(),tab:"Camera"})),a.unshift({label:"",id:"showPropertySheet",inner:"Show 2D Property Sheet",type:"checkbox",checked:showPropertySheet}),a.push({label:"",id:"showCoord",inner:"Show Room/Floor Point Coords",type:"checkbox",checked:showCoord},{label:"",id:"showDim",inner:"Show Room/Floor Dimensioning",type:"checkbox",checked:showDim},{label:"",id:"showRulerGuides",inner:"Show Ruler Guides",type:"checkbox",tab:"Grid",checked:showRulerGuides},{label:"",id:"showRuler",inner:"Show Ruler",type:"checkbox",tab:"Grid",checked:showRuler},{label:"",id:"showGrid",inner:"Show Grid",type:"checkbox",tab:"Grid",checked:showGrid},{label:"Grid Gap:",id:"gridGap",type:"select",tab:"Grid",options:[50,100,150,200],value:t},{label:"Snap Grid:",id:"snapGrid",type:"input",tab:"Grid",value:i},{type:"label",inner:"<font color='red'>Press and hold key 'S' to active grid snapping</font>"},{label:"",id:"enableScale",inner:"Enable Templates Scale",type:"checkbox",tab:"Template",checked:enableScale},{label:"Zoom Speed:",id:"zoomSpeed",type:"input",value:zoomSpeed,tab:"Camera"},{label:"Rotate Speed:",id:"rotateSpeed",type:"input",value:rotateSpeed,tab:"Camera"},{label:"Pan Speed:",id:"panSpeed",type:"input",value:panSpeed,tab:"Camera"},{label:"Max Distance:",id:"maxDistance",type:"input",value:maxDistance,tab:"Camera"},{label:"Min Distance:",id:"minDistance",type:"input",value:minDistance,tab:"Camera"},{label:"Near Clipping Plane:",id:"nearPlane",type:"input",value:nearPlane,tab:"Camera"},{label:"Far Clipping Plane:",id:"farPlane",type:"input",value:farPlane,tab:"Camera"},{label:"Optic Angle:",id:"fov",type:"input",value:fov,tab:"Camera"});Utils.showInputDialog(a,"Editor Settings",!0,this.updateViewSettings,this,[this.ambientLight,this.pointLights,this.box2d,this.box3d,this.allNetworks,this.viewCallback,this.isComponent])},updateViewSettings:function(e,t,i,n,a,o,r,s){if(r||(s.enableScale?interactions2d[0].addListener("mousewheel"):interactions2d[0].removeListener("mousewheel")),r){var l=a[1].getInteractions()[0];s.zoomSpeed&&l.zoomSpeed!==s.zoomSpeed&&(l.zoomSpeed=parseFloat(s.zoomSpeed),comZoomSpeed=s.zoomSpeed,localStorage.setItem(ZOOM_SPEED_COMPONENT,s.zoomSpeed)),s.rotateSpeed&&l.rotateSpeed!==s.rotateSpeed&&(l.rotateSpeed=parseFloat(s.rotateSpeed),comRotateSpeed=s.rotateSpeed,localStorage.setItem(ROTATE_SPEED_COMPONENT,s.rotateSpeed)),s.panSpeed&&l.panSpeed!==s.panSpeed&&(l.panSpeed=parseFloat(s.panSpeed),comPanSpeed=s.panSpeed,localStorage.setItem(PAN_SPEED_COMPONENT,s.panSpeed)),s.maxDistance&&l.maxDistance!==s.maxDistance&&(l.maxDistance=parseInt(s.maxDistance),comMaxDistance=s.maxDistance,localStorage.setItem(MAX_DISTANCE_COMPONENT,s.maxDistance)),s.minDistance&&l.minDistance!==s.minDistance&&(l.minDistance=parseInt(s.minDistance),comMinDistance=s.minDistance,localStorage.setItem(MIN_DISTANCE_COMPONENT,s.minDistance)),Utils.isNotNull(s.enableEasing)&&l.setEasing(s.enableEasing);var d=a[1].getCamera();s.nearPlane&&(d.setNear(parseFloat(s.nearPlane)),comNearPlane=parseFloat(s.nearPlane),localStorage.setItem(PropertyConsts.NEAR_PLANE_COMPONENT,s.nearPlane)),s.farPlane&&(d.setFar(parseFloat(s.farPlane)),comFarPlane=parseFloat(s.farPlane),localStorage.setItem(PropertyConsts.FAR_PLANE_COMPONENT,s.farPlane)),s.fov&&(d.fov=parseFloat(s.fov),comFov=parseFloat(s.fov),localStorage.setItem(PropertyConsts.FOV_COMPONENT,s.fov))}else{s.zoomSpeed&&defaultInteraction.zoomSpeed!==s.zoomSpeed&&(defaultInteraction.zoomSpeed=parseFloat(s.zoomSpeed),zoomSpeed=s.zoomSpeed,localStorage.setItem(ZOOM_SPEED,s.zoomSpeed)),s.rotateSpeed&&defaultInteraction.rotateSpeed!==s.rotateSpeed&&(defaultInteraction.rotateSpeed=parseFloat(s.rotateSpeed),rotateSpeed=s.rotateSpeed,localStorage.setItem(ROTATE_SPEED,s.rotateSpeed)),s.panSpeed&&defaultInteraction.panSpeed!==s.panSpeed&&(defaultInteraction.panSpeed=parseFloat(s.panSpeed),panSpeed=s.panSpeed,localStorage.setItem(PAN_SPEED,s.panSpeed)),s.maxDistance&&defaultInteraction.maxDistance!==s.maxDistance&&(defaultInteraction.maxDistance=parseInt(s.maxDistance),maxDistance=s.maxDistance,localStorage.setItem(MAX_DISTANCE,s.maxDistance)),s.minDistance&&defaultInteraction.minDistance!==s.minDistance&&(defaultInteraction.minDistance=parseInt(s.minDistance),minDistance=s.minDistance,localStorage.setItem(MIN_DISTANCE,s.minDistance)),Utils.isNotNull(s.enableEasing)&&defaultInteraction.setEasing(s.enableEasing);var c=network3d.getCamera();s.nearPlane&&(c.setNear(parseFloat(s.nearPlane)),nearPlane=s.nearPlane,localStorage.setItem(PropertyConsts.NEAR_PLANE,s.nearPlane)),s.farPlane&&(c.setFar(parseFloat(s.farPlane)),farPlane=s.farPlane,localStorage.setItem(PropertyConsts.FAR_PLANE,s.farPlane)),s.fov&&(c.fov=parseFloat(s.fov),fov=parseFloat(s.fov),localStorage.setItem(PropertyConsts.FOV,s.fov))}if(s.selectStyle&&(selectStyle=s.selectStyle,Utils.setBox3DSelectStyle(n,s.selectStyle),localStorage.setItem(PropertyConsts.LocalStorage.SELECT_STYLE,s.selectStyle)),"undefined"!=typeof defaultInteraction&&(s.cameraRotation?defaultInteraction.yRistrict=!1:(defaultInteraction.yRistrict=!0,defaultInteraction.yLowerLimitAngle=-Math.PI/8,defaultInteraction.yUpLimitAngle=Math.PI/2)),"undefined"!=typeof a[1]&&(a[1].getInteractions()[1].yRistrict=s.cameraRotation?!1:!0),null!=i&&i.forEach(function(e){var t=e;t instanceof ImageShapeNode&&(t.setClient("showCoord",s.showCoord),t.setClient("showDim",s.showDim),t.setClient("decimalNumber",s.decimalNumber))}),"undefined"!=typeof s.showFloor){var h=s.showFloor;showFloor!=h&&(showFloor=h,showFloor?n.add(viewFloor):n.remove(viewFloor),localStorage.setItem(SHOW_FLOOR,showFloor))}if("undefined"!=typeof s.floorStyle&&showFloor){var u=s.floorStyle;floorStyle!=u&&(floorStyle=s.floorStyle,n.remove(viewFloor),createViewFloor(),n.add(viewFloor),localStorage.setItem(PropertyConsts.LocalStorage.FLOOR_STYLE,floorStyle))}if("undefined"!=typeof s.floorSize&&showFloor){var g=s.floorSize;floorSize!=g&&(floorSize=s.floorSize,n.remove(viewFloor),createViewFloor(),n.add(viewFloor),localStorage.setItem(PropertyConsts.LocalStorage.FLOOR_SIZE,floorSize))}"undefined"!=typeof s.allViewSelectable&&(allViewSelectable=s.allViewSelectable,localStorage.setItem(ALL_VIEW_SELECTABLE,allViewSelectable)),e.setVisible(s.ambientLightOn),localStorage.setItem(AMBIENT_LIGHT_ON,s.ambientLightOn),e.setColor(s.ambientLightColor),localStorage.setItem(AMBIENT_LIGHT_COLOR,s.ambientLightColor),t[0].setVisible(s.pointLightOn),localStorage.setItem(POINT_LIGHT_ON1,s.pointLightOn);var m=s.pointLightPosition.split(",");3==m.length?t[0].setPosition(m[0],m[1],m[2]):t[0].setPosition(m[0],m[0],m[0]),localStorage.setItem(POINT_LIGHT_POSITION1,s.pointLightPosition),t[0].setColor(s.pointLightColor),t[0].setIntensity(s.pointLightIntensity),localStorage.setItem(POINT_LIGHT_COLOR1,s.pointLightColor),localStorage.setItem(POINT_LIGHT_INTENSITY1,s.pointLightIntensity),t[1].setVisible(s.pointLight2On);var p=s.pointLight2Position.split(",");3==p.length?t[1].setPosition(p[0],p[1],p[2]):t[1].setPosition(p[0],p[0],p[0]),t[1].setColor(s.pointLight2Color),t[1].setIntensity(s.pointLight2Intensity),localStorage.setItem(POINT_LIGHT_ON2,s.pointLight2On),localStorage.setItem(POINT_LIGHT_POSITION2,s.pointLight2Position),localStorage.setItem(POINT_LIGHT_COLOR2,s.pointLight2Color),localStorage.setItem(POINT_LIGHT_INTENSITY2,s.pointLight2Intensity),t[2].setVisible(s.pointLight3On);var f=s.pointLight3Position.split(",");3==f.length?t[2].setPosition(f[0],f[1],f[2]):t[2].setPosition(f[0],f[0],f[0]),t[2].setColor(s.pointLight3Color),t[2].setIntensity(s.pointLight3Intensity),localStorage.setItem(POINT_LIGHT_ON3,s.pointLight3On),localStorage.setItem(POINT_LIGHT_POSITION3,s.pointLight3Position),localStorage.setItem(POINT_LIGHT_COLOR3,s.pointLight3Color),localStorage.setItem(POINT_LIGHT_INTENSITY3,s.pointLight3Intensity),t[3].setVisible(s.pointLight4On);var v=s.pointLight4Position.split(",");3==v.length?t[3].setPosition(v[0],v[1],v[2]):t[3].setPosition(v[0],v[0],v[0]),t[3].setColor(s.pointLight4Color),t[3].setIntensity(s.pointLight4Intensity),localStorage.setItem(POINT_LIGHT_ON4,s.pointLight4On),localStorage.setItem(POINT_LIGHT_POSITION4,s.pointLight4Position),localStorage.setItem(POINT_LIGHT_COLOR4,s.pointLight4Color),localStorage.setItem(POINT_LIGHT_INTENSITY4,s.pointLight4Intensity),t[4].setVisible(s.pointLight5On);var y=s.pointLight5Position.split(",");3==y.length?t[4].setPosition(y[0],y[1],y[2]):t[4].setPosition(y[0],y[0],y[0]),t[4].setColor(s.pointLight5Color),t[4].setIntensity(s.pointLight5Intensity),localStorage.setItem(POINT_LIGHT_ON5,s.pointLight5On),localStorage.setItem(POINT_LIGHT_POSITION5,s.pointLight5Position),localStorage.setItem(POINT_LIGHT_COLOR5,s.pointLight5Color),localStorage.setItem(POINT_LIGHT_INTENSITY5,s.pointLight5Intensity);var b=loadResource!==s.loadResource,C=cloudKey!==s.cloudKey;C=C||cloudPassword!==s.cloudPassword,b?(loadResource=s.loadResource,localStorage.setItem(LOAD_RESOURCE_TYPE,loadResource),loadResource===TYPE_CLOUD?Utils.validateCloudKey(s.cloudKey,s.cloudPassword,r,function(e){Utils.validateCloudKeyCallback(e,s.cloudKey,s.cloudPassword,r)}):r?(accordion4C.clearAllCategories(),fillComponentCategoryView()):(accordionPane.clearAllCategories(),fillCategoryView())):C&&loadResource===TYPE_CLOUD&&Utils.validateCloudKey(s.cloudKey,s.cloudPassword,r,function(e){Utils.validateCloudKeyCallback(e,s.cloudKey,s.cloudPassword,r)});var w=s.showPropertySheet;if("undefined"!=typeof showPropertySheet&&showPropertySheet!=w&&(showPropertySheet=w,borderPane.setRight(showPropertySheet&&"undefined"!=typeof isShow3D&&!isShow3D?sheetPane:null),sheetPane.getAccodionPane().getAccodion().invalidate(),localStorage.setItem(SHOW_PROPERTY_SHEET,showPropertySheet)),a instanceof Array&&a.length)for(var S=0;S<a.length;S++){var x=a[S];x instanceof GridNetwork?(0/0!=parseInt(s.gridGap)&&x.setGridGap(parseInt(s.gridGap)),void 0!==s.showTargetFlag&&localStorage.setItem(SHOW_TARGET_FLAG,s.showTargetFlag),void 0!==s.showOriginalFlag&&localStorage.setItem(SHOW_ORIGINAL_FLAG,s.showOriginalFlag),Utils.checkPointFlag(x,targetFlagElement,s.showTargetFlag),Utils.checkPointFlag(x,originalFlagElement,s.showOriginalFlag,PointFlag.ORIGINAL_POINT),x.invalidateElementVisibility()):x instanceof mono.Network3D&&(x.setShowAxis(s.showAxis),x.setShowAxisText(s.showAxisText),s.networkBackground&&x.setClearColor(s.networkBackground))}r||enableScale!=s.enableScale&&(enableScale=s.enableScale,localStorage.setItem(ENABLE_SCALE,enableScale)),showAxis!=s.showAxis&&(showAxis=s.showAxis,localStorage.setItem(SHOW_AXIS,showAxis)),showAxisText!=s.showAxisText&&(showAxisText=s.showAxisText,localStorage.setItem(SHOW_AXIS_TEXT,showAxisText)),enableEasing!=s.enableEasing&&(enableEasing=s.enableEasing,localStorage.setItem(PropertyConsts.ENABLE_EASING,enableEasing)),void 0!==showDim&&showDim!=s.showDim&&(showDim=s.showDim,localStorage.setItem(SHOW_DIM,showDim)),void 0!==showCoord&&showCoord!=s.showCoord&&(showCoord=s.showCoord,localStorage.setItem(SHOW_COORD,showCoord)),r||(Utils.isNotNull(showRulerGuides)&&showRulerGuides!=s.showRulerGuides&&(showRulerGuides=s.showRulerGuides,localStorage.setItem(PropertyConsts.SHOW_RULER_GUIDES,showRulerGuides),ruler.setShowGuides(showRulerGuides)),Utils.isNotNull(showRuler)&&showRuler!=s.showRuler&&(showRuler=s.showRuler,localStorage.setItem(PropertyConsts.SHOW_RULER,showRuler),ruler.setShowRuler(showRuler)),void 0!==showGrid&&showGrid!=s.showGrid&&(showGrid=s.showGrid,localStorage.setItem(SHOW_GRID,showGrid),a[0].setShowGrid(Utils.string2Boolean(showGrid))),void 0!==gridGap&&gridGap!=s.gridGap&&(gridGap=s.gridGap,localStorage.setItem(GRID_GAP,gridGap)),void 0!==snapGrid&&snapGrid!=s.snapGrid&&0/0!=parseInt(s.snapGrid)&&(snapGrid=s.snapGrid,localStorage.setItem(SNAPGRID,snapGrid))),decimalNumber!=parseInt(s.decimalNumber)&&(decimalNumber=parseInt(s.decimalNumber),localStorage.setItem(DECIMAL_NUMBER,decimalNumber)),r&&isFullRotation!=s.cameraRotation&&(isFullRotation=s.cameraRotation,localStorage.setItem(IS_FULL_ROTATION_COMPONENT,s.cameraRotation)),r||isFullRotation!=s.cameraRotation&&(isFullRotation=s.cameraRotation,localStorage.setItem(IS_FULL_ROTATION,s.cameraRotation)),r?(localStorage.setItem("componentBackground",s.networkBackground),scaleMinLimit=Utils.string2Float(s.scaleMinLimit,.1),0>=scaleMinLimit&&(scaleMinLimit=.1),localStorage.setItem("scaleMinLimit",scaleMinLimit),scaleMaxLimit=Utils.string2Float(s.scaleMaxLimit,100),0>=scaleMaxLimit&&(scaleMaxLimit=100),localStorage.setItem("scaleMaxLimit",scaleMaxLimit)):localStorage.setItem("roomBackground",s.networkBackground),o&&o.call(this,s)}}),ToolBar=function(e,t){this.network3d=e,this.currentSelectFlag="default",this.viewButtons=["front_view","right_view","top_view","back_view","left_view","bottom_view"],this.buttonsAndEve=t,this.buttons=new Array,this.toolbar=document.createElement("div"),this.init()},twaver.Util.ext("ToolBar",Object,{init:function(){this.initToolbar(this.toolbar)},getView:function(){return this.toolbar},setNetwork:function(e){this.network3d=e},createImgButton:function(e,t,i,n,a,o,r,s){var l=document.createElement("img");t&&(l.id=t),i&&l.setAttribute("class",i),n&&l.setAttribute("src",n),a&&l.setAttribute("title",a),r&&l.setAttribute("draggable","true"),s&&(l.ondragstart=s),e.appendChild(l)},initToolbar:function(e){if(e.setAttribute("class","room-network3d-toolbar"),Utils.isNotNull(this.buttonsAndEve))for(var t=0;t<this.buttonsAndEve.length;t++){var i=this.buttonsAndEve[t];if(Utils.isNotNull(i)){var n,a,o=i.split(":");if(o.length>1?(n=o[0],Utils.isNotNull(n)&&(a=i.substring(n.length+1,i.length))):n=i,!Utils.isNotNull(n))continue;n.startsWith("max-")?createInputButton(e,n,"max","maximize view",a,"Utils.stopPropagation(event)"):(this.buttons.push(n),"default"==n?createInputButton(e,"default","default_hover","Default",a,null,"Utils.stopPropagation(event)"):"coarseSelect"==n?createInputButton(e,"coarseSelect","coarseSelect","Coarse Select",a,null,"Utils.stopPropagation(event)"):"carefulSelect"==n?createInputButton(e,"carefulSelect","carefulSelect","Careful Select",a,null,"Utils.stopPropagation(event)"):"unlockAllEditInteraction"==n?createInputButton(e,"unlockAllEditInteraction","unlockAllEditInteraction","Move and Rotate",a,null,"Utils.stopPropagation(event)"):"move"==n?createInputButton(e,"move","move","Move",a,null,"Utils.stopPropagation(event)"):"rotate"==n?createInputButton(e,"rotate","rotate","Rotate",a,null,"Utils.stopPropagation(event)"):"createLink"==n?createInputButton(e,"createLink","createLink","Create Link",a,null,"Utils.stopPropagation(event)"):"align"==n?createInputButton(e,"align","align","Align",a,null,"Utils.stopPropagation(event)"):"resize"==n?createInputButton(e,"resize","resize","Scale",a,null,"Utils.stopPropagation(event)"):"veilView"==n?createInputButton(e,"veilView","veilView","Veil View",a,null,"Utils.stopPropagation(event)"):"grid-comp"==n?this.createImgButton(e,null,"grid-comp",Utils.Path+"grid_icon.png","Drag to Network","grid_img",!0,function(e){e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("Text",JSON.stringify({className:"twaver.Grid"}))}):"zoom-reset-comp"==n?createInputButton(e,null,"zoom-reset-comp","Zoom Reset",a,"Utils.stopPropagation(event)"):"zoom-in-comp"==n?createInputButton(e,null,"zoom-in-comp","Zoom In",a,"Utils.stopPropagation(event)"):"zoom-out-comp"==n?createInputButton(e,null,"zoom-out-comp","Zoom Out",a,"Utils.stopPropagation(event)"):"zoom-over-view"==n?createInputButton(e,"zoom-over-view","zoom-over-view","Zoom OverView",a,"Utils.stopPropagation(event)"):"preview-view"==n&&createInputButton(e,"preview-view","preview-view","Preview",a,"Utils.stopPropagation(event)"))}}},eInteraction:function(e,t){Utils.setButtonsStyle(this.buttons,e),t?this.setEditorInteraction(e):this.setInteraction(e)},setInteraction:function(e){var t,i=this.network3d.getInteractions(),n=this.network3d.getDataBox();i&&i.forEach(function(e){e instanceof mono.EditInteraction&&(t=e)}),"coarseSelect"===e?removeFirstSelectElement():setFirstSelectElement(),n.forEach("default"===e||"init"===e?function(e){e.setEditable(!1),e.setSelectable(!1)}:function(e){var t=e.getClient("mainVisible");Utils.isNotNull(t)?(e.setEditable(!0),e.setSelectable(!0)):(e.setEditable(!1),e.setSelectable(!1))}),n.forEach(function(e){e.getRoot()&&0==e.getRoot().getClient("mainVisible")||e instanceof mono.Plane||e.getClient(PropertyConsts.COMPONENTFLOOR)?(e.setEditable(!1),e.setSelectable(!1)):(e.setEditable(!0),e.setSelectable(!0))}),t&&this.setValueForInteractions(e,t)},setValueForInteractions:function(e,t){t&&("resize"===e?(t.setShowHelpers(!0),t.setScaleable(!0),t.setRotateable(!1),t.setTranslateable(!1),this.currentSelectFlag="resize"):"rotate"===e?(t.setShowHelpers(!0),t.setScaleable(!1),t.setRotateable(!0),t.setTranslateable(!1),this.currentSelectFlag="rotate"):"move"===e?(t.setShowHelpers(!0),t.setScaleable(!1),t.setRotateable(!1),t.setTranslateable(!0),this.currentSelectFlag="move"):"default"===e||"init"===e?(t.setShowHelpers(!1),t.setScaleable(!1),t.setRotateable(!1),t.setTranslateable(!1),t.setDefaultMode(""),this.currentSelectFlag="default"):"unlockAllEditInteraction"===e?(t.setShowHelpers(!0),t.setScaleable(!0),t.setRotateable(!0),t.setTranslateable(!0),this.currentSelectFlag="parentSelect"):"coarseSelect"===e?(t.setShowHelpers(!1),t.setScaleable(!1),t.setRotateable(!1),t.setTranslateable(!1),t.setDefaultMode(""),this.currentSelectFlag="coarseSelect"):"carefulSelect"===e&&(t.setShowHelpers(!1),t.setScaleable(!1),t.setRotateable(!1),t.setTranslateable(!1),t.setDefaultMode(""),this.currentSelectFlag="carefulSelect"))},setEditorInteraction:function(e){var t,i=this,n=this.network3d.getInteractions();n&&n.forEach(function(e){e instanceof mono.EditInteraction&&(t=e)});var a=this.network3d.getDataBox();a.forEach("carefulSelect"===e?function(e){var t=e.getClient("mainVisible");if(Utils.isNotNull(t)){i.setElementFlag(e,!1,!1);var n=e.getDescendants();if(n.length>0)for(var a=0;a<n.length;a++)i.setElementFlag(n[a],!0,!0)}}:"default"===e||"init"===e?function(e){i.setElementFlag(e,!1,!1)}:function(e){var t=e.getClient("mainVisible");Utils.isNotNull(t)?i.setElementFlag(e,!0,!0):i.setElementFlag(e,!1,!1)}),t&&this.setValueForInteractions(e,t)},setElementFlag:function(e,t,i){e._editable=t,e._selectable=i},handleSelect:function(){var e=this.network3d.getDataBox(),t=this;e.forEach("default"===this.currentSelectFlag?function(e){t.setElementFlag(e,!1,!1)}:"coarseSelect"===this.currentSelectFlag?function(e){var i=e.getClient("mainVisible");Utils.isNotNull(i)?t.setElementFlag(e,!0,!0):t.setElementFlag(e,!1,!1)}:"carefulSelect"===this.currentSelectFlag?function(e){var i=e.getClient("mainVisible");if(Utils.isNotNull(i)){t.setElementFlag(e,!1,!1);var n=e.getDescendants();if(n.length>0)for(var a=0;a<n.length;a++)t.setElementFlag(e,!0,!0)}}:function(e){var i=e.getClient("mainVisible");Utils.isNotNull(i)?t.setElementFlag(e,!0,!0):t.setElementFlag(e,!1,!1)})},createMultiViewButtonDiv:function(){var e=document.createElement("div");e.style.visibility="hidden",e.setAttribute("class","shrinkbt"),e.setAttribute("id","buttonsDiv");for(var t=0;t<this.viewButtons.length;t++){var i=document.createElement("input");i.setAttribute("type","button"),i.setAttribute("class",this.viewButtons[t]),i.setAttribute("onclick","$sneta("+t+",1);"),e.appendChild(i)}return e},createViewButton:function(e,t,i){var n=document.createElement("input");n.setAttribute("type","button"),n.setAttribute("class",t),n.setAttribute("title",i),e.appendChild(n)}}),ZipFileUtils={},ZipFileUtils.exportTemplate=function(e,t,i,n,a){var o=JSON.stringify(e);if(t&&1==t){var r=getImagesPath(e,a);downloadZip(r,function(e){var t=new JSZip;t.file("images.zip",e,{base64:!0});var i=t.generate({type:"blob"});saveAs(i,"jsonimages.zip")});var s=[];if(n&&r&&r.length>0)for(var l=0;l<r.length;l++){var d=r[l],c=d;if(d){var h=d.split("/");h&&h.length>0&&(c=n+"/"+h[h.length-1],o=o.replace(new RegExp(d,"g"),c),s.push(c))}}}if(twaver.Util.isIE){var u=document.createElement("iframe");document.body.insertBefore(u),u.style.display="none",u.contentDocument.write(o),u.contentDocument.execCommand("SaveAs",!0),document.body.removeChild(u)}else{var g="data:text/json;charset=utf8,"+encodeURIComponent(o);window.open(g,"network")}};var downloadZip=function(e,t,i){var n={arguments:{images:e}};ZipFileUtils.getFiles(MONO_URL,n,t,i)},getImagesPath=function(e,t){if(e){var i=e.primitives;if(i&&!(i.length<1)){for(var n=[],a=0;a<i.length;a++)for(var o=i[a],r=getPathFromObj(o,t),s=0;s<r.length;s++){var l=r[s];l.length<4||(l.length<7&&(l="images/"+l),"http"!=l.substring(0,4)&&"images/"!=l.substring(0,7)&&(l="images/"+l),l=decodeURI(l),l&&!isContains(n,l)&&n.push(l))}var d=e.assembles;if(d&&d.length>0)for(var c=0;c<d.length;c++){var h=d[c],u=getPathFromObj(h,t);putImagesPath(n,u)}var g=e.sketch;if(g){var m=g.buildings;if(m&&m.length>0)for(var p=0;p<m.length;p++){var f=m[p],v=getPathFromObj(f,t);putImagesPath(n,v)}var y=g.floors;if(y&&y.length>0)for(var p=0;p<y.length;p++){var b=y[p],C=getPathFromObj(b,t);putImagesPath(n,C)}}return n}}},putImagesPath=function(e,t){if(void 0==e&&(e=[]),t&&t instanceof Array)for(var i=0;i<t.length;i++){var n=t[i];n&&!isContains(e,n)&&e.push(n)}},getPathFromObj=function(e,t){if(!e)return null;var i=[];if(e.dt)if(e.dt instanceof Array&&e.dt.length>0)for(var n=0;n<e.dt.length;n++){var a=e.dt[n];a&&i.push(a)}else i.push(e.dt);if(t&&t.length>0)for(var o=0;o<t.length;o++){var r=t[o];if(r&&"dt"!=r){var s=e[r];if(s)if(s instanceof Array&&s.length>0)for(var l=0;l<s.length;l++)s[l]&&i.push(s[l]);else i.push(s)}}return i},isContains=function(e,t){if(!e||!t)return!1;if(e.length<1)return!1;for(var i=0;i<e.length;i++){var n=e[i];if(n&&n==t)return!0}};ZipFileUtils.getFiles=function(e,t,i,n,a){if(e||i("error: url error, "+e),!navigator.onLine)return void alert("NETWORK CONNECT ERROR");var o=Utils.createProgressBar(40,50),r=new FormData;e+="/getFiles";var s=t.arguments;if(s)for(var l in s)r.append(l,s[l]);var d=new XMLHttpRequest;d.open("POST",e,!0),d.withCredentials=!0,d.timeout=6e4;var c;d.ontimeout=function(){o&&o.parentNode&&o.parentNode.removeChild(o),c&&c.parentNode&&c.parentNode.removeChild(c),alert("request timeout")},setTimeout(function(){if((4!=d.readyState||200!=d.status)&&!a){c=Utils.addMask("progressBars"),c.style.zIndex=1001,o.style.zIndex=1002;var e=c.offsetWidth,t=c.offsetHeight;o.style.left=e/2-20+"px",o.style.top=t/2-25+"px",document.body.appendChild(o)}},1e3);var h=function(e){i&&i.call(this.scope,e)};h.scope=n,d.onreadystatechange=function(){if(navigator.onLine||(o&&o.parentNode&&o.parentNode.removeChild(o),c&&c.parentNode&&c.parentNode.removeChild(c),alert("NETWORK CONNECT ERROR")),404==d.status&&(o&&o.parentNode&&o.parentNode.removeChild(o),c&&c.parentNode&&c.parentNode.removeChild(c)),4==d.readyState&&200==d.status){if(i){var e=JSON.parse(d.responseText);e.error?"Login First"==e.error?document.location.href="login.html":alert(e.error):e.value?i.call(n,e.value):i.call(n,d.responseText)}o&&o.parentNode&&o.parentNode.removeChild(o),c&&c.parentNode&&c.parentNode.removeChild(c)}},d.send(r)};var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,i=function(){return e.URL||e.webkitURL||e},n=e.URL||e.webkitURL||e,a=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o=!e.externalHost&&"download"in a,r=e.webkitRequestFileSystem,s=e.requestFileSystem||r||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d="application/octet-stream",c=0,h=[],u=function(){for(var e=h.length;e--;){var t=h[e];"string"==typeof t?n.revokeObjectURL(t):t.remove()}h.length=0},g=function(e,t,i){t=[].concat(t);for(var n=t.length;n--;){var a=e["on"+t[n]];if("function"==typeof a)try{a.call(e,i||e)}catch(o){l(o)}}},m=function(n,l){var u,m,p,f=this,v=n.type,y=!1,b=function(){var e=i().createObjectURL(n);return h.push(e),e},C=function(){g(f,"writestart progress write writeend".split(" "))},w=function(){(y||!u)&&(u=b(n)),m?m.location.href=u:window.open(u,"_blank"),f.readyState=f.DONE,C()},S=function(e){return function(){return f.readyState!==f.DONE?e.apply(this,arguments):void 0}},x={create:!0,exclusive:!1};if(f.readyState=f.INIT,l||(l="download"),o){u=b(n),t=e.document,a=t.createElementNS("http://www.w3.org/1999/xhtml","a"),a.href=u,a.download=l;var I=t.createEvent("MouseEvents");return I.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(I),f.readyState=f.DONE,void C()}return e.chrome&&v&&v!==d&&(p=n.slice||n.webkitSlice,n=p.call(n,0,n.size,d),y=!0),r&&"download"!==l&&(l+=".download"),(v===d||r)&&(m=e),s?(c+=n.size,void s(e.TEMPORARY,c,S(function(e){e.root.getDirectory("saved",x,S(function(e){var t=function(){e.getFile(l,x,S(function(e){e.createWriter(S(function(t){t.onwriteend=function(t){m.location.href=e.toURL(),h.push(e),f.readyState=f.DONE,g(f,"writeend",t)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=f["on"+e]}),t.write(n),f.abort=function(){t.abort(),f.readyState=f.DONE},f.readyState=f.WRITING}),w)}),w)};e.getFile(l,{create:!1},S(function(e){e.remove(),t()}),S(function(e){e.code===e.NOT_FOUND_ERR?t():w()}))}),w)}),w)):void w()},p=m.prototype,f=function(e,t){return new m(e,t)};return p.abort=function(){var e=this;e.readyState=e.DONE,g(e,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,e.addEventListener("unload",u,!1),f.unload=function(){u(),e.removeEventListener("unload",u,!1)},f}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);RoomInteraction=function(e){RoomInteraction.superClass.constructor.call(this,e)},twaver.Util.ext("RoomInteraction",twaver.vector.interaction.BaseInteraction,{lastIndex:-1,lastElement:null,lastLogicalPoint:null,mouseDown:null,mouseMoved:null,horizontal:null,vertical:null,block:null,addPointCursor:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAF7SURBVHjatJSxasJQFIa/q0GQBOLWpVIXBbO6iA+gQ8HVxTkiuHXu1FcQJM59Ajd9ACdnBV0qvoCBBCFU0uXapjHGRPRfkns5/8e593J+UavVCKkJtIAGUJV7K2AOTIFZsHixWBAlJfBfAgZAr1+xNaPg8aJ+A7B1lfpyn6uP1roJWMAQ+CJGSgD6YZbtbrvoks/6/4oM3cPQPV6fXW2yU9/GG/0JeI+DZ+R3YJbtbqfknEGDymd9OiUHs2x35emIAzeBXrvoklSytie9F8GtfsXW4jqN6rxfsTX5yBfBDaPgkVbS04gDV0+vn0bSU732eHdXBlhtXSW1UXpWceD5cp9LDZaeeRx4OlrrzuEoEkMPR8ForTtyxC+CZ4A12amJwbLWCudG1EgP5ZhGjnSw08lOZbzRP4HhKYCEED4gfP/PJwLpFhdCLPe50/EtCf3NiWvgxLEZjspIcHBxq+4GliCS5HFqdmjth/ceNtI3dRy+PiHE2f7DOv4ZAHRil+NB+pB1AAAAAElFTkSuQmCC'),auto",setUp:function(){this.addListener("mousedown","mousemove","mouseup","keydown","dragover","drop","dblclick")
},tearDown:function(){this.removeListener("mousedown","mousemove","mouseup","keydown","dragover","drop","dblclick")},handle_dblclick:function(e){var t=-1,i=this.network.getElementAt(e);i instanceof ImageShapeNode&&(t=twaver.Util.getPointIndex(i.getPoints(),this.network.getLogicalPoint(e),this.network.getEditPointSize()));var n=new RoomDialog(i,t);n.show()},handle_mousedown:function(e){if(this.mouseDown=!0,this.lastLogicalPoint=this.network.getLogicalPoint(e),this.lastLogicalPoint){var t=this.network.getElementAt(e);if(t instanceof ImageShapeNode&&!lock2d)if(resize=this.network.getElementUI(t).isPointOnBorderLine(this.lastLogicalPoint),null!==resize)this.lastElement=t,this.network.isMovable=function(){return!1};else{var i=t.getPointIndex(this.network.getLogicalPoint(e));i>=0&&(this.lastIndex=i,this.lastElement=t,this.network.isMovable=function(){return!1})}t instanceof Block&&(this.block=t)}},handleClicked:function(e,t,i){e.fireInteractionEvent(i?{kind:"clickElement",event:t,element:i}:{kind:"clickBackground",event:t})},handle_mousemove:function(e){if(!lock2d)if(this._setNetworkCreateShapeNodeCursor(),this.mouseDown){var t=this.network.getLogicalPoint(e);if(!t)return this.network.getView().scrollTop+=10,void(this.network.getView().scrollLeft+=10);if(offsetX=this.lastLogicalPoint?t.x-this.lastLogicalPoint.x:0,offsetY=this.lastLogicalPoint?t.y-this.lastLogicalPoint.y:0,this.lastIndex>=0){var i=this.lastElement.getPoints(),n=i.get(this.lastIndex),a=i.get(this.lastIndex===i.size()-1?0:this.lastIndex+1);this.network.enableSingleOrientationMove?this.mouseMoved||(this.horizontal=n.x==a.x,this.vertical=!this.horizontal,this.mouseMoved=!0):!this.mouseMoved&&_twaver.isCtrlDown(e)&&(this.horizontal=Math.abs(offsetX)>=Math.abs(offsetY),this.vertical=!this.horizontal,this.mouseMoved=!0),this.vertical||(n.x+=offsetX,a.x+=offsetX),this.horizontal||(n.y+=offsetY,a.y+=offsetY),this.lastElement.firePointsChange(),this.lastLogicalPoint=t}if(this.block){var o=this.block.getClient("edgeIndex"),r=this.block.getClient("length"),s=this.block.getClient("offset"),i=this.block.getParent().getPoints(),n=i.get(o),a=i.get(o===i.size()-1?0:o+1),l=a.x-n.x,d=a.y-n.y,c=Math.abs(l)>Math.abs(d),h=c?offsetX:offsetY,u=h;if(this.block.getClient("focusLeft"))c?l>0&&(u=-u):(l>=0&&0>d&&(h=-h),l>=0&&d>0&&(u=-u),0>l&&d>0&&(h=-h,u=-u)),this.block.setClient("length",r-h),this.block.setClient("offset",s-u/Math.abs(c?l:d)/2);else if(this.block.getClient("focusRight"))c?0>l&&(u=-u):(l>=0&&0>d&&(h=-h,u=-u),0>l&&d>0&&(h=-h),0>l&&0>d&&(u=-u)),this.block.setClient("length",r+h),this.block.setClient("offset",s+u/Math.abs(c?l:d)/2);else{var s=Math.abs(l)>Math.abs(d)?(t.x-this.lastLogicalPoint.x)/l:(t.y-this.lastLogicalPoint.y)/d;this.block.setClient("offset",this.block.getClient("offset")+s)}this.lastLogicalPoint=t}null!==resize&&this.lastElement&&(0===resize?(this.lastElement.setLocation(this.lastElement.getX()+offsetX,this.lastElement.getY()+offsetY),this.lastElement.setSize(this.lastElement.getWidth()-offsetX,this.lastElement.getHeight()-offsetY)):1===resize?(this.lastElement.setLocation(this.lastElement.getX(),this.lastElement.getY()+offsetY),this.lastElement.setSize(this.lastElement.getWidth()+offsetX,this.lastElement.getHeight()-offsetY)):2===resize?this.lastElement.setSize(this.lastElement.getWidth()+offsetX,this.lastElement.getHeight()+offsetY):3===resize&&(this.lastElement.setLocation(this.lastElement.getX()+offsetX,this.lastElement.getY()),this.lastElement.setSize(this.lastElement.getWidth()-offsetX,this.lastElement.getHeight()+offsetY)),this.lastLogicalPoint=t)}else{var g=this.network.getElementAt(e),t=this.network.getLogicalPoint(e);if(this.lastElement&&this.lastElement!==g&&(this.lastElement instanceof ImageShapeNode&&(this.lastElement.setClient("focusIndex",-1),this.network.getView().style.cursor="default"),this.lastElement instanceof Block&&(this.lastElement.setClient("focus",!1),this.lastElement.setClient("focusLeft",!1),this.lastElement.setClient("focusRight",!1),this.network.getView().style.cursor="default"),this.lastElement=null),g instanceof ImageShapeNode)if(resize=this.network.getElementUI(g).isPointOnBorderLine(t),null!==resize)this.lastElement=g,this.network.getView().style.cursor="move";else{var o=g.getPointIndex(t);g.setClient("focusIndex",o),o>=0?(this.lastElement=g,this.network.getView().style.cursor=_twaver.isAltDown(e)?this.addPointCursor:"move"):g.isPointOnPoints(t)||(this.network.getView().style.cursor="default")}else g instanceof Block?(g.setClient("focus",!0),this.network.getSelectionModel().contains(g)&&_twaver.math.getDistance(t,g.getClient("leftPoint"))<=10?(g.setClient("focusLeft",!0),g.setClient("focusRight",!1),this.network.getView().style.cursor="move"):this.network.getSelectionModel().contains(g)&&_twaver.math.getDistance(t,g.getClient("rightPoint"))<=10?(g.setClient("focusLeft",!1),g.setClient("focusRight",!0),this.network.getView().style.cursor="move"):(g.setClient("focusLeft",!1),g.setClient("focusRight",!1),this.network.getView().style.cursor="default"),this.lastElement=g):this.lastElement=null}},handle_mouseup:function(){this.mouseDown=!1,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.lastIndex=-1,this.lastElement=null,this.lastLogicalPoint=null,this.block=null,this.resize=!1,this.network.getView().style.cursor="default",lock2d||delete this.network.isMovable},handle_mousewheel:function(e){if(!lock2d){this.network.getSelectionModel().size()>0&&(e.preventDefault(),e.stopPropagation());var t=!1,i=this;e.wheelDelta!==e.wheelDeltaX&&(e.wheelDelta?e.wheelDelta>0&&(t=!0):e.detail<0&&(t=!0)),this.network.getSelectionModel().toSelection(function(e){e instanceof PrimitiveNode&&i._scaleElement(t,e)})}},handle_keydown:function(e){if(!lock2d){var t=!1;if(46==e.keyCode){if(this.network.getSelectionModel().getSelection().size()>0){var i=this.network.getSelectionModel().getSelection();if(1==i.size()&&this.network.getSelectionModel().getLastData()instanceof TargetFlagNode)return;if(confirm("Sure to Delete")){var n=this.network.getElementBox(),a=new twaver.List;a.addAll(i),a.forEach(function(e){e instanceof TargetFlagNode||n.remove(e)})}}t=!0}37==e.keyCode&&(this._moveSelectionElements("left"),t=!0),38==e.keyCode&&(this._moveSelectionElements("top"),t=!0),39==e.keyCode&&(this._moveSelectionElements("right"),t=!0),40==e.keyCode&&(this._moveSelectionElements("bottom"),t=!0),Utils.isCtrlDown(e)&&(67===e.keyCode&&(this._copySelection(),t=!0),86===e.keyCode&&(this._pasteSelection(),t=!0)),83===e.keyCode&&this._adsorptionSelectionElements(),t&&(e.preventDefault(),e.stopPropagation())}},handle_dragover:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,e.dataTransfer.dropEffect="copy";var t=this.network.getElementAt(e),i=this.network.getLogicalPoint(e);if(this.network.lastElement&&this.network.lastElement!==t&&(this.network.lastElement instanceof ImageShapeNode&&this.network.lastElement.setClient("focusIndex",-1),this.network.lastElement=null),t instanceof ImageShapeNode){var n=t.getPointIndex(i);t.setClient("focusIndex",n),n>=0&&(this.network.lastElement=t)}else this.network.lastElement=null;return!1},getAllElementsAt:function(e){var t={x:e.x-1,y:e.y-1,width:2,height:2},i=this.network.getElementsAtRect(t,!0,null,!1);return i},findFirstFloorAt:function(e){var t=this.getAllElementsAt(e);if(t)for(var i=0;i<t.size();i++)if(t.get(i)instanceof FloorShapeNode)return t.get(i)},handle_drop:function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1;var t=e.dataTransfer.getData("Text");if(!t)return!1;var i=JSON.parse(t);loadResource===TYPE_CLOUD&&i.isTemplate&&(i.loadFromCloud=!0,"Component"!=i.method&&(i.actionType="loadTemplate"));var n=this.network.getElementAt(e);if(i.actionType)"loadTemplate"===i.actionType?i.loadFromCloud?(modelManager.loadTemplate(this.network.getElementBox(),i),roomTemplateId=i.id):modelManager.loadTemplate(this.network.getElementBox(),i.id):(type="ImageShapeNode","CreateFloorShapeNode"===i.actionType?type="FloorShapeNode":"CreateInnerWallShapeNode"===i.actionType?type="InnerWallShapeNode":"CreatePipeShapeNode"===i.actionType?type="PipeShapeNode":"CreateRoundPipeShapeNode"===i.actionType?type="RoundPipeShapeNode":"CreateRoomWithFloorShapeNode"===i.actionType&&(type=function(t){var i=new ImageShapeNode;return i instanceof twaver.ShapeNode&&t&&(i.setPoints(t),i.setClient("isHostNode",!0),i.setClient("decimalNumber",decimalNumber),i.setClient("transparent",!1),i.setClient("opacity",1),i.setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.WALL),2==t._as.length&&(alert("Please draw more than two points!"),i.removeAt(0),i.removeAt(1),network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeNode}))),i}),classType=window[type]?window[type]:type,this._createShapeNodeInteractions(classType));else if(n&&n instanceof ImageShapeNode)if(!i.embeded||n instanceof FloorShapeNode)if("FloorShapedModel"!=i.className||n.getClient(OID)){var a=i.mtarget;if(a){if("Floor"===a){var o=this.network.getLogicalPoint2(e),r=this.findFirstFloorAt(o);if(r&&i.material){var s=Utils.Path+i.material;Utils.registerImage(s,this.network),r.setClient(IMAGE_SRC,s)}}"Room"===a&&n instanceof ImageShapeNode&&this.handleRoomMaterial(n,i)}else i.embeded||this._createRoom(this.network,e,i)}else{var l=this._createElement(this.network,n.getCenterLocation(),i.id);l.setClient("hostNodeId",n.getId()),n.setClient(OID,n.getId())}else{var o=this.network.getLogicalPoint(e);n.setClient("focusIndex",-1);var d=n.getPointIndex(o);if(d>=0){var c=n.getPoints(),h=c.get(d),u=c.get(d===c.size()-1?0:d+1),g=u.x-h.x,m=u.y-h.y,p=Math.abs(g)>Math.abs(m)?(o.x-h.x)/g:(o.y-h.y)/m;this._createPureElement(this.network,i,function(e){e.setClient("edgeIndex",d),e.setParent(n),e.setClient("offset",p);var t=parseFloat("1m")/parseFloat(network._scaleUnitValue),i=e.getClient("length"),a=e.getStyle("vector.outline.width"),o=Math.abs(Math.log(t));a=t>1?a/Math.pow(1.5,o):a*Math.pow(1.5,o),e.setClient("length",i*t)})}}else{if("BlockModel"==i.className&&i.embeded)return!1;var a=i.mtarget;n||"Room"!==a?this._createRoom(this.network,e,i):this.handleRoomMaterial(null,i)}return this._setNetworkCreateShapeNodeCursor(),!1},handleRoomMaterial:function(e,t){var i=!1;if(box2d.forEach(function(e){var t=e;return t instanceof ImageShapeNode&&!(t instanceof FloorShapeNode)?(i=!0,!1):void 0}),i){var n="Change Room Material",a=[];if(e||(n="Change All Room Material",a=[{label:"Scope:",id:"cfloor",name:"scope",type:"radio",checked:!0,inner:"For current floor's images"},{label:"",id:"afloor",name:"scope",type:"radio",checked:!1,inner:"For all floors' images"}]),t.texture)var o=[{label:"Image:",id:"pic",value:Utils.Path+t.material},{label:"Usage:",id:"outside",name:"side",type:"radio",checked:!0,inner:"For all external faces (incudes all frame and pole faces)"},{label:"",id:"inside",name:"side",type:"radio",checked:!1,inner:"For all internal faces"}];else var o=[{label:"External Image:",id:"external",value:Utils.Path+t.outside},{label:"Internal Image:",id:"internal",value:Utils.Path+t.inside},{label:"Frame Image:",id:"frame",value:Utils.Path+t.frame}];o=a.concat(o),Utils.showInputDialog(o,n,!0,this.setRoomMaterial,this,[e,t.texture])}},setRoomMaterial:function(e,t,i){var n=[];if(e?n.push(e):box2d.forEach(function(e){var t=e;t instanceof ImageShapeNode&&!(t instanceof FloorShapeNode)&&(i.cfloor?t.getClient("floorName")===floorPane.getCurrentFloorName()&&n.push(t):n.push(t))}),n.length>0)for(var a=0;a<n.length;a++){var o=n[a];t?(i.outside?(o.setClient("wallOuterPic",i.pic),o.setClient("framePic",i.pic),o.setClient("poleTexture",i.pic)):o.setClient("wallInnerPic",i.pic),o.setClient("useTexture",!0)):(o.setClient("wallOuterPic",i.external),o.setClient("wallInnerPic",i.internal),o.setClient("framePic",i.frame),o.setClient("poleTexture",i.external),o.setClient("useTexture",!1));var r=o instanceof InnerWallShapeNode;r&&(o.setClient("poleTexture",o.getClient("wallInnerPic")),o.setClient("wallOuterPic",o.getClient("wallInnerPic")))}},_createShapeNodeInteractions:function(e){this.network.setInteractions([new MyCreateShapeNodeInteraction(this.network,e),new twaver.vector.interaction.DefaultInteraction(this.network)])},_createPureElement:function(e,t,i){var n=t.id;a=modelManager.getModelNode(n);var o=modelManager.getModelLib();if(a){var r=ModelFactory.getModelFromModelNode(o,a);if(r instanceof modelimp.ModelImp)for(var s=r.get2DObjects(),l=e.getElementBox(),d=0;d<s.length;d++)l.add(s[d]),e.getSelectionModel().clearSelection(),e.getSelectionModel().setSelection(s[d]),i&&i(s[d])}},_createRoom:function(e,t,i){if("squareRoomWithFloor"===i.id){var n=this._createElement(e,e.getLogicalPoint(t),"floor02"),a=this._createElement(e,e.getLogicalPoint(t),"squareRoom");n.setClient("hostNodeId",a.getId()),a.setClient(OID,a.getId()),a.setClient("decimalNumber",decimalNumber)}else if("LShapedRoomWithFloor"===i.id){var n=this._createElement(e,e.getLogicalPoint(t),"floor03"),a=this._createElement(e,e.getLogicalPoint(t),"LShapedRoom");n.setClient("hostNodeId",a.getId()),a.setClient(OID,a.getId()),a.setClient("decimalNumber",decimalNumber)}else if("SquareAddOnRoomWithFloor"===i.id){var n=this._createElement(e,e.getLogicalPoint(t),"floor04"),a=this._createElement(e,e.getLogicalPoint(t),"SquareAddOnRoom");n.setClient("hostNodeId",a.getId()),a.setClient(OID,a.getId()),a.setClient("decimalNumber",decimalNumber)}else if("AngledAddOnRoomWithFloor"===i.id){var n=this._createElement(e,e.getLogicalPoint(t),"floor05"),a=this._createElement(e,e.getLogicalPoint(t),"AngledAddOnRoom");n.setClient("hostNodeId",a.getId()),a.setClient(OID,a.getId()),a.setClient("decimalNumber",decimalNumber)}else if("RoomByPoints"===i.id){var o=new RoomByPointsDialog(i,e,t);o.show()}else if(i.loadFromCloud)if(_twaver.isShiftDown(t))Utils.showTemplateDialog(this,e,t,i);else var r=function(e){processHost(e,t)},s=this._createElement(e,e.getLogicalPoint(t),i,r);else if(_twaver.isShiftDown(t))Utils.showTemplateDialog(this,e,t,i.id);else{var s=this._createElement(e,e.getLogicalPoint(t),i.id);if(processHost(s,t),!i.id)return;i.id.indexOf("billboard")>=0?s.setStyle("m.vertical",!0):i.id.indexOf("pointlight")>=0?"pointlight01"==i.id?(s.setClient("lightColor",new mono.Color(16777215)),s.setClient("lightIntensity",1)):"pointlight02"==i.id&&(s.setClient("lightColor",new mono.Color(16773335)),s.setClient("lightIntensity",1)):i.id.indexOf("spotlight")>=0&&"spotlight01"==i.id&&(s.setClient("lightColor",new mono.Color(14146559)),s.setClient("lightIntensity",1),s.setClient("angle",Math.PI))}},_createElement:function(e,t,i,n,a,o){if("object"!=typeof i)return this._createElementDeal(e,t,i,n);var r=i,s={module:"templates",method:"get",arguments:{id:r.id}},l=function(){var i=JSON.parse(arguments[0]);if(i.error)return void alert(i.error);var r=i.value;if(r){var s=JSON.parse(r.data);if(s)return s.primitives||s.assembles?(modelManager.loadSharedPrimitive(s.primitives),modelManager.loadSharedAssemble(s.assembles)):(modelManager.loadSharedPrimitive(s.primitivesCache),modelManager.loadSharedAssemble(s.assembleCache)),this._createElementDeal(e,t,r.gid,n,a,o)}};require(MONO_URL,s,l,this)},_createElementDeal:function(e,t,i,n,a,o){var r=modelManager.getModelLib(),s=modelManager.getModelNode(i);if(s||(s=r.getModelNodeByTemplateName(i)),s){var l=ModelFactory.getModelFromModelNode(r,s);if(l instanceof modelimp.ModelImp){var d,c=l.get2DObjects(!0),h=e.getElementBox();c[0]&&(l.mainNode?(l.mainNode instanceof PrimitiveNode&&l.mainNode.setName(l.templateName||l.id),d=l.mainNode,d.setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.TEMPLATE)):(c[0]instanceof PrimitiveNode&&(c[0].setName(l.templateName),c[0].getClient(PropertyConsts.LAYERID)||c[0].setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.TEMPLATE)),d=c[0]));for(var u=parseFloat(l.scaleValue||1),g=0;g<c.length;g++)h.add(c[g]),e.getSelectionModel().clearSelection(),e.getSelectionModel().setSelection(c[g]);l.mainNode&&(e.getSelectionModel().clearSelection(),e.getSelectionModel().setSelection(l.mainNode)),"mono.Billboard"==s.className&&c[0].setStyle("m.vertical",!0);var m=l.mainNode;m||(m=c[0]),m.scaleValue=s.scaleValue;var u=parseFloat(m.scaleValue||1),p=m.getHeight(),f=m.getWidth();return m.setHeight(p*u),m.setWidth(f*u),m.setCenterLocation(t),n&&n(m,a,o),m}}},_setNetworkCreateShapeNodeCursor:function(){var e=this;this.network.getInteractions().forEach(function(t){t instanceof twaver.vector.interaction.CreateShapeNodeInteraction&&(e.network.getView().style.cursor="crosshair")})},_scaleElement:function(e,t){if(t&&t instanceof PrimitiveNode&&this.network.isSelected(t)){var i=t.getSize(),n=t.getClient("oscale"),a=t.getCenterLocation();if(e&&1e3>n){var o=Math.round(1.1*n),r=1.1*i.width,s=1.1*i.height;o>1e3&&(o=1e3,r=i.width*(1e3/n),s=i.height*(1e3/n)),t.setSize(r,s),t.setClient("oscale",o)}else if(!e&&n>5){var o=Math.round(n/1.1),r=i.width/1.1,s=i.height/1.1;5>o&&(o=5,r=i.width*(5/n),s=i.height*(5/n)),t.setSize(r,s),t.setClient("oscale",o)}t.setName(Utils.changeTwoDecimal(t.getClient("oscale"))+"%\nScroll to Scale"),t.setCenterLocation(a)}},_adsorptionSelectionElements:function(){var e=box2d.getSelectionModel().getSelection(),t=parseInt(localStorage.getItem(SNAPGRID))||10;e.size()>0&&e.forEach(function(e){var i=e.getPoints();i.forEach(function(e){e.x=parseInt(e.x/t)*t+(e.x%t<t/2?0:t),e.y=parseInt(e.y/t)*t+(e.y%t<t/2?0:t)}),e.setPoints(i)})},_moveSelectionElements:function(e){var t=box2d.getSelectionModel().getSelection();if(t.size()>0){var i=0,n=0;"left"===e&&(i=-1),"right"===e&&(i=1),"top"===e&&(n=-1),"bottom"===e&&(n=1),twaver.Util.moveElements(t,i,n,!1)}},_copySelection:function(){var e=box2d.getSelectionModel().getSelection(),t=e.toList();e.forEach(function(i){box2d.forEach(function(n){!e.contains(n)&&n.isDescendantOf(i)&&t.add(n),n.getClient("hostNodeId")&&i.getClient("oid")&&n.getClient("hostNodeId")===i.getClient("oid")&&t.add(n)})}),Utils.copyDatasToBoxAnchor(t,box2d)},_pasteSelection:function(){var e=floorPane.getCurrentFloorName(),t=Utils.pasteBoxAnchorToBox(box2d,e);if(t&&t.length>0){box2d.getSelectionModel().clearSelection();for(var i in t)t[i]instanceof Block||t[i]instanceof FloorShapeNode&&t[i].getClient("hostNodeId")||(box2d.getSelectionModel().appendSelection(t[i]),t[i].setX(t[i].getX()+20),t[i].setY(t[i].getY()+20))}}}),MonoEditInteraction=function(e){MonoEditInteraction.superClass.constructor.call(this,e)},twaver.Util.ext("MonoEditInteraction",twaver.vector.interaction.EditInteraction,{deletePointCursor:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGYSURBVHja1JS/SwJhGMc/r16ieXENRSBJQijo0OIS/gE1BK4tzorQVHNTU3OB2ByNDW21tTidtClY0A+nFvHojsCyt+UNTvMujSL6LHccz/fD8/Lc+4hsNssQa8A6kAPS6lsTqAHnwIW72DRNRqG53hPAFlAqpyw9M9tjKfoKwL2jrTa6odVKyygCVeAQuMMHzSXdKyatQj7uEAnKgaKM0SNj9NhYdPSzdnTn6NpYAHb95AH13ComrcJmwv4kdRMJSjYTNsWkVVCnw0+8BpTycYdxUbUllfUUr5dTlu7X6ajOyylLV0P2FOcysz0mRWVyfuL0x/QnQWXSXw3vxwkAzXtHmzioMk0/ca3RDU0sVpman/i80jLs574YW/rcF1Rahq2uuKf4AqietaNji1VtdXhvuAnGYjGAVr0TngsH5cryzAtTAe9OTx90jq6NY2DfNM3uV+IucFXvhPsntzMrUU2GEDCtSV7eBDdPU1w+Rtg25+16J3ygpL5LSHxnbXqtygGxlPJX/mPtOyEhhPyzjn/1Sv8v8fsAeL2I1faEYBkAAAAASUVORK5CYII'),auto",setUp:function(){MonoEditInteraction.superClass.setUp.apply(this,arguments),this.addListener("keydown","keyup")},tearDown:function(){MonoEditInteraction.superClass.setUp.apply(this,arguments),this.removeListener("keydown","keyup")},handle_keydown:function(e){this.currentKeyEvent=e,this.showSnap=!0},handle_keyup:function(){this.currentKeyEvent=null,this.showSnap=!1},handle_mouseup:function(e){if(this.isStart){var t=_twaver.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var i=this,n=new twaver.animate.AnimateBounds(this.node,this.resizingRect,function(){i.network.fireInteractionEvent({kind:"lazyResizeEnd",event:e,element:i.node,resizeDirection:i.resizeDirection})});twaver.animate.AnimateManager.start(n)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:e,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:e,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&t){var a=this.shapeNode.getPoints().get(this.pointIndex);if(this.horizontal&&(t.y=a.y),this.vertical&&(t.x=a.x),this.currentKeyEvent&&83===this.currentKeyEvent.keyCode){var o=parseInt(localStorage.getItem(SNAPGRID))||10;t.x=parseInt(t.x/o)*o+(t.x%o<o/2?0:o),t.y=parseInt(t.y/o)*o+(t.y%o<o/2?0:o)}this.shapeNode.setPoint(this.pointIndex,t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&t){var a=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(t.y=a.y),this.vertical&&(t.x=a.x),this.shapeLink.setPoint(this.pointIndex,t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&t&&(this.linkUI.setControlPoint(t),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:e,element:this.linkUI._element}))}this._handle_mouseup(e),this.clear()},_isEditingShapeNode:function(e,t){if(this.node instanceof twaver.ShapeNode){this.shapeNode=this.node;for(var i=this.shapeNode.getPoints(),n=0,a=i.size();a>n;n++){var o=i.get(n);if(this._contains(e,o,this.editPointSize))return _twaver.isAltDown(t)?this._setCursor(this.deletePointCursor):this._setCrossCursor(),this.pointIndex=n,!0}if(null!=this.shapeNode.getPointIndex(e)&&this.shapeNode.getPointIndex(e)>=0)return!0}return this.pointIndex=-1,!1},handle_mousemove:function(e){if(this.network.isValidEvent(e)){if(this.isStartRotate&&this.node)return this._handleRotateElement(e,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(e);var t={},i=parseInt(localStorage.getItem(SNAPGRID))||10;if(this.currentKeyEvent&&83===this.currentKeyEvent.keyCode){var n=this.shapeNode.getPoints().get(this.pointIndex);t.x=parseInt(n.x/i)*i+(n.x%i<i/2?0:i),t.y=parseInt(n.y/i)*i+(n.y%i<i/2?0:i),(t.x!=n.x||t.y!=n.y)&&this.repaint()}return}if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(e);if(this.node&&this.resizeDirection)return void this._handleResizing(e);if(this.linkUI)return void this._handleMovingLinkControlPoint(e);var n=this.network.getLogicalPoint2(e);if(this.node&&this.node instanceof twaver.ShapeNode&&this.node.getPointIndex(n)&&this.node.getPointIndex(n)>=0)return void(this.network._dragToPan=!1)}else{var a=this.network.getElementAt(e);if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var o=this.network.getElementUI(a);if(!o||!o.getEditAttachment())return void this.clear();var n=this.network.getLogicalPoint2(e);if(a instanceof twaver.ShapeNode&&(n=this.network.getLogicalPoint(e)),a instanceof twaver.Node){if(this.node=a,this.node instanceof Block)return this.network._dragToPan=!1,void(this.isStart=!0);if(this._isEditingShapeNode(n,e)||this._isResizingNode(n))return void this.network.setEditingElement(!0);if(this._isRotatingElement(n))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(a instanceof twaver.ShapeLink){if(this.shapeLink=a,this._isEditingShapeLink(n))return void this.network.setEditingElement(!0)}else if(o instanceof twaver.network.LinkUI&&twaver.Link.isOrthogonalLink(o._element)){this.linkUI=o;var r=this.linkUI.getControlPoint();return void(r&&this._contains(n,r)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}this.clear()}}},handle_mousedown:function(e){if(0===e.button)if(!_twaver.isAltDown(e)||this.network.isEditingElement()){if(this.network.isEditingElement()&&!this.isStart&&!this.isStartRotate)if(this.node&&this.resizeDirection)this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:e,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0){var t=this.shapeNode.getPoints()._as.length;_twaver.isAltDown(e)?2==t?confirm("You will delete the entire wall, Sure to Delete")&&(this.shapeNode.removeAt(0),this.shapeNode.removeAt(1),this.network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeNode})):confirm("Sure to Delete")&&(3==t&&this.shapeNode.setClient("shapenode.closed",!1),this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:this.shapeNode,pointIndex:this.pointIndex}))}else this.shapeLink&&this.pointIndex>=0?_twaver.isAltDown(e)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:e,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(e),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:this.linkUI._element})):this.shapeNode?this.isStart=!0:this.node&&(this.node.getClient("className")&&"mono.Billboard"==this.node.getClient("className")||(this.isStartRotate=!0,this._handle_mousedown(e)))}else{var i=this.network.getElementAt(e),n=this.network.getLogicalPoint(e);if(i instanceof twaver.ShapeNode){var a=this.getPointIndex(i.getPoints(),n,!0);a>0&&(this._handle_mousedown(e),this.pointIndex=a,this.shapeNode=i,i.addPoint(n,a),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:e,element:i,pointIndex:a}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:i,pointIndex:a}))}if(i instanceof twaver.ShapeLink){var o=new twaver.List(i.getPoints()),r=this.network.getElementUI(i);o.add(r.getFromPoint(),0),o.add(r.getToPoint());var a=this.getPointIndex(o,n)-1;a>0&&(this._handle_mousedown(e),this.pointIndex=a,this.shapeLink=i,i.addPoint(n,a),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:e,element:i,pointIndex:a}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:e,element:i,pointIndex:a}))}}},paint:function(e){if(MonoEditInteraction.superClass.paint.apply(this,arguments),this.shapeNode){var t=10,i=new twaver.List,n={},a=this.shapeNode.getPoints().size(),o=this;if(snapGrid=parseInt(localStorage.getItem(SNAPGRID))||10,this.shapeNode&&this.pointIndex>=0&&this.showSnap){var r=this.shapeNode.getPoints(),s=r.get(this.pointIndex);if(!s)return;n.x=parseInt(s.x/snapGrid)*snapGrid+(s.x%snapGrid<snapGrid/2?0:snapGrid),n.y=parseInt(s.y/snapGrid)*snapGrid+(s.y%snapGrid<snapGrid/2?0:snapGrid);var l=this.pointIndex+1>=a?this.pointIndex+1-a:this.pointIndex+1,d=this.pointIndex-1<0?this.pointIndex-1+a:this.pointIndex-1;if(n.x&&n.y){this.img=new Image,i.add(r.get(l)),i.add(n),i.add(r.get(d));var c="("+n.x+","+n.y+")",h=_twaver.math.getRect(i),u=this.shapeNode.getClient("coordTextFont"),l=(i.get(0),n),d=i.get(1),g=_twaver.g.getTextSize(u,c);_twaver.math.grow(h,3*t+Math.max(g.width,g.height),3*t+Math.max(g.width,g.height));var m=e;m.fillStyle="rgb(0,100,0)",m.strokeStyle="#000000",m.beginPath(),m.arc(n.x,n.y,t,0,2*Math.PI),m.fill(),m.stroke(),m.closePath(),m.strokeStyle="rgb(0,100,0)";var p=new twaver.List(["moveto","lineto","lineto"]);m.beginPath(),_twaver.g.drawLinePoints(m,i,[5,5],p),m.stroke(),m.closePath(),m.fillStyle="rgba(0,100,0,0.5)",m.fillRect(n.x+t,n.y-g.height/2,g.width,g.height),m.font=u,m.fillStyle="#FFFFFF",m.textBaseline="middle",m.fillText(c,n.x+t,n.y),m.strokeStyle="rgb(0,100,0)",this.img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAXCAYAAAARIY8tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAANVSURBVHjapJVfaFtVHMc/9+Q2yU1jZq3RplLFaYu6LQrTTh/0QRixdP6BwRAftuGDlDvfBB9UrChDUQZDWNYHQZxvA/9b2UXxT3ErCI51tUxszexcGtusWxuSnCT35h4fmibNFtOsft/Oj3M+38Pv/H6/oymlaKZ4zBBADNgD7AB6gCCQAZLASeA48J1pyWtgWjODeMx4HHi/O9S25Y4OL53tHtq9Al1o2GVF3nZJZx0uLNmkMvZvwIumJX9a1yAeMzTgja4b9Nd7wz5uv9HLepq9UuLn8zkFDJuWfOs/DSopOdIX9g1FIwY+XaNVSdtl8p8C0+niQdOSr11jEI8ZHuBYX9j33EM9gbrD2ZLLdLpIctlG2i5Gm+C2TW30hn0EvaK6r+QoxmdzXFy2nzYt+WWdwdGB4GRfp771wavgZ1OSyVRhHjgEfA2kgG5gEHhpW8R/azRiVPfPZWx+mMleAHqrBiODIQWgXFftvDughYM6AKeTknPzhTFgt2nJSw3e6xbgm2jE2L4t4q/Gx//Kkbhc2icAjh94WFEx0oTQvp3Ju3MZm18v5jk3X7CAgUZwANOSC8CTZ1My67i1bPR0eAF2i69e2bVw+fwUrltGlZ1VE/FjIl/+faH4BfCUacl8s8c1LZkCPvxzsVSNdQY8AP0iOTEWXk2T5tFr9Ss8JyppKbVYRKfSWae6MNoEQJcApCYEYg0c+BjYZVqyzP+UAHYCy2tix4C9G2A9Em6vXbLgKIAFMTSaOQncUym/j4B9AEOjmZbJ8ZjRBezf3Fnr+MWcA/BLXR+MDIbYAHwTYEUjxo66Mp3NkVgs7dfWm6brwDuAE1u6/P0PdNcaLZWx+X4mOwfcKTYKPzoQvA8Y23oVvFRWTF8qAhwwLVnSNwIfGQxFNSHG77pJD9y/Bu64iok5yd9L9tumJT9fraLrhgMTQCCx5NqnZld6sOgoTiclf6SLh4BXW/pwGsCfAT4DUMpF0wSA0xMSutcD0+nim6Ylh1v+0RrDFW55pf+E8ICmgVJX3LLzjmnJdxs1WquKVu5UB/d4/cn+vcNTjeDXa3AQ+ABYGSuaRvDm7qXtz76cOPPp4UebjYqWNDSaKQMvAO8BZd3nn7r3ieePnPnk8GPNzv07AK/5bsWWYLHkAAAAAElFTkSuQmCC",this.img.onload=function(){m.drawImage(o.img,n.x-3*t,n.y-3*t,2*t,2*t)
}}}}},clear:function(){MonoEditInteraction.superClass.clear.apply(this,arguments),this.network._dragToPan=!0,this.network.setRotatePointSize(twaver.Defaults.NETWORK_ROTATE_POINT_SIZE)}}),MyCreateShapeNodeInteraction=function(e,t){MyCreateShapeNodeInteraction.superClass.constructor.call(this,e,t),t||(t=twaver.ShapeNode),this.shapeNodeFunction=twaver.Util.isTypeOf(t,twaver.ShapeNode)?function(e){var i=new t;if(i instanceof twaver.ShapeNode){{this.network.createElementUI(i)}e&&i.setPoints(e)}return i}:t},twaver.Util.ext("MyCreateShapeNodeInteraction",twaver.vector.interaction.CreateShapeNodeInteraction,{setUp:function(){MyCreateShapeNodeInteraction.superClass.setUp.apply(this,arguments),this.addListener("keydown","keyup")},tearDown:function(){MyCreateShapeNodeInteraction.superClass.tearDown.apply(this,arguments),this.removeListener("keydown","keyup")},handle_mousedown:function(e){var t=this.network.getLogicalPoint(e);if(t){if(this.currentKeyEvent&&83==this.currentKeyEvent.keyCode){var i=parseInt(localStorage.getItem(SNAPGRID))||10;t.x=parseInt(t.x/i)*i+(t.x%i<i/2?0:i),t.y=parseInt(t.y/i)*i+(t.y%i<i/2?0:i),this.updateMagnet(t)}if(2===e.detail){if(this.points){var n=this.shapeNodeFunction(this.points);this.points._as.length<=2&&n.setClient("shapenode.closed",!1),this.network.addElementByInteraction(n),this.clear();var a=this;setTimeout(function(){a.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new twaver.List),this.points.size()>0){var o=this.points.get(this.points.size()-1);if(o.x===t.x&&o.y===t.y)return}this._handle_mousedown(e),this.points.size()>0&&_twaver.isCtrlDown(e)&&(this.horizontal&&(t.y=o.y),this.vertical&&(t.x=o.x),this.horizontal=!1,this.vertical=!1),this.lastPoint=t,this.points.add(t),this.repaint()}}},handle_mousemove:function(e){this.network.getView().style.cursor="crosshair",this.currentPoint=this.network.getLogicalPoint(e);var t=this.network.getLogicalPoint(e);if(t&&(this.network.setCursorPosition(e),this.currentKeyEvent&&83==this.currentKeyEvent.keyCode)){var i=parseInt(localStorage.getItem(SNAPGRID))||10;t.x=parseInt(t.x/i)*i+(t.x%i<i/2?0:i),t.y=parseInt(t.y/i)*i+(t.y%i<i/2?0:i),this.updateMagnet(t)}},handle_keydown:function(e){this.currentKeyEvent=e},handle_keyup:function(){this.currentKeyEvent=null,this.clear()},updateMagnet:function(e){this.magnetLocation=e},convertPointFromView:function(e){var t=e.x*this.network.getZoom()-this.network.getViewRect().x,i=e.y*this.network.getZoom()-this.network.getViewRect().y;return{x:t,y:i}},paint:function(e){if(MyCreateShapeNodeInteraction.superClass.paint.apply(this,arguments),this.magnetLocation){var t=this.magnetLocation,i=new twaver.List,n=10,a={},o=parseInt(localStorage.getItem(SNAPGRID))||10;if(a.x=parseInt(t.x/o)*o+(t.x%o<o/2?0:o),a.y=parseInt(t.y/o)*o+(t.y%o<o/2?0:o),i.add(a),a.x&&a.y){var r="("+a.x+","+a.y+")",s={x:a.x-20,y:a.y-20,width:40,height:40},l="12px Arial",d=_twaver.g.getTextSize(l,r);_twaver.math.grow(s,3*n+Math.max(d.width,d.height),3*n+Math.max(d.width,d.height));var c=e;c.fillStyle="rgb(0,100,0)",c.strokeStyle="#000000",c.arc(a.x,a.y,n,0,2*Math.PI),c.fill(),c.stroke(),c.fillStyle="rgba(0,100,0,0.5)",c.fillRect(a.x+n,a.y-d.height/2,d.width,d.height),c.font=l,c.fillStyle="#FFFFFF",c.textBaseline="middle",c.fillText(r,a.x+n,a.y),c.strokeStyle="rgb(0,100,0)"}}}}),Utils={Path:"images/",RelativePath:"",renderNetwork:function(e,t,i){e.setRenderCallback(i)},createDraggableNetwork:function(e){if(!e)var e=new twaver.network.Network;return e.getView().addEventListener("dragover",function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,e.dataTransfer.dropEffect="copy",!1},!1),e.setEditableFunction(function(e){return"unresize"!==e.getClient("resize")}),e.getView().addEventListener("drop",function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault?t.preventDefault():t.returnValue=!1;var i=t.dataTransfer.getData("Text");Utils._handle2dDrop(t,i,e)},!1),e},_handle2dDrop:function(e,t,i){if(!t)return!1;var n=JSON.parse(t),a=i.getElementBox();if(void 0!==n.className&&"twaver.Grid"===n.className){var o,r,s,l;a.forEach(function(e){e instanceof ImageNode&&(o=e.getWidth(),r=e.getHeight(),s=e.getLocation(),l=e)});var d=Utils._createGrid(o,r,s,l);a.add(d)}else if("Material"===n.classType){var c=i.getElementAt(e);console.log(c),c instanceof twaver.Follower&&!(c.getParent()instanceof ImageNode)?(Utils.registerImage(Utils.Path+n.material,i),c.setImage(Utils.Path+n.material),c.setClient("material",n.material),handleText2d(i)):null==c&&a.forEach(function(e){if(e instanceof ImageNode){var t=Utils.Path+n.material;Utils.registerImage(t,i),e.setImage(t),0==faceObject.faceIndex?faceObject.element.setStyle("right.m.texture.image",t):1==faceObject.faceIndex?faceObject.element.setStyle("left.m.texture.image",t):2==faceObject.faceIndex?faceObject.element.setStyle("top.m.texture.image",t):3==faceObject.faceIndex?faceObject.element.setStyle("bottom.m.texture.image",t):4==faceObject.faceIndex?faceObject.element.setStyle("front.m.texture.image",t):5==faceObject.faceIndex&&faceObject.element.setStyle("back.m.texture.image",t)}})}else if("Cube"===n.classType)if(_twaver.isShiftDown(e))Utils.showPortDialog(i,e,n,t);else{var l=i.getElementAt(e),h=Utils.Path+n.material,o=n.args.x,r=n.args.y,u=Utils._createFollower(e,l,h,n.resize,o,r,t,i);a.add(u),a.getSelectionModel().setSelection(u),handleText2d(i)}else if("Template"===n.classType){var g=Utils.Path+"default_texture.png";if(loadResource===TYPE_CLOUD)modelManager.loadTemplatesAssembleSize(n.id,this,function(n){var o=i.getElementAt(e),r=Utils._createFollower(e,o,g,"unresize",n.x,n.y,t,i);a.add(r),handleText2d(i)});else{var m=modelManager.loadTemplatesAssembleSize(n.id),l=i.getElementAt(e),u=Utils._createFollower(e,l,g,"unresize",m.x,m.y,t,i);a.add(u),handleText2d(i)}}},_createGrid:function(e,t,i,n){var a=new CGrid;return a.setLocation(i),a.setSize(e,t),a.setStyle("grid.border",1),a.setStyle("grid.row.count",3),a.setStyle("grid.column.count",3),a.setStyle("grid.deep",1),a.setStyle("whole.alpha",.6),a.setClient("grid.outer.padding",0),a.setClient("width",e),a.setClient("height",t),a.setClient("location",i),a.setClient("offset",.1),a.setStyle("grid.padding",1),a.setParent(n),a},_createFollower:function(e,t,i,n,a,o,r,s){var l=new twaver.Follower;if(Utils.registerImage(i,s,"component"),l.setImage(i),l.setClient("text",r),l.setClient("resize",n),t instanceof twaver.Grid){var d=s.getLogicalPoint(e),c=t.getCellObject(d);if(null!=c){"unresize"===n&&(l.setStyle("follower.fill.cell",!1),l.setWidth(a*s.zoom),l.setHeight(o*s.zoom)),l.setStyle("follower.row.index",c.rowIndex),l.setStyle("follower.column.index",c.columnIndex),l.setParent(t),l.setHost(t);var h=l.getParent().getParent(),u=l.getCenterLocation().x-h.getCenterLocation().x,g=l.getCenterLocation().y-h.getCenterLocation().y;l.setClient("offsetX",u/s.zoom),l.setClient("offsetY",g/s.zoom);var m=t.getClient("offset");l.setClient("offset",m+.15),l.setClient("selfID",l.getId()),l.setClient("hostCell",t),console.log("translate to 2d")}}return l},createDraggableNetwork3D:function(e){if(!e)var e=new(new mono.Network3D);return e.getRootView().addEventListener("dragover",function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,e.dataTransfer.dropEffect="copy",!1},!1),e.getRootView().addEventListener("drop",function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault?t.preventDefault():t.returnValue=!1;var i=t.dataTransfer.getData("Text");return i?(Utils._handle3dDrop(t,i,e),!1):!1},!1),e.getRootView().setAttribute("draggable","true"),e},_findFirstObjectByMouse:function(e,t,i){i||(i=function(e){return!(e instanceof mono.Billboard||e.getClient(PropertyConsts.COMPONENTFLOOR))});var n=e.getElementsByMouseEvent(t);if(n.length)for(var a=0;a<n.length;a++){var o=n[a],r=o.element;if(i(r))return o}return null},_init3dObject:function(e){var t=Utils.Path+"default_texture.png";e.setStyle("m.texture.image",t),e.setStyle("m.texture.wrapS",mono.RepeatWrapping),e.setStyle("m.texture.wrapT",mono.RepeatWrapping),e.setStyle("m.texture.repeat",new mono.Vec2(3,3)),e.setStyle("m.side",mono.DoubleSide),e.setStyle("m.type","phong"),e.setEditable(!0),e.setSelectable(!0),initElement(e)},_createPath:function(e,t){var i=t||1,n=new mono.Path;if(e instanceof Array)for(var a=e.concat();a&&a.length>0;){var o=a.shift();"m"===o&&n.moveTo(parseInt(a.shift()*i),parseInt(a.shift()*i),parseInt(a.shift()*i)),"l"===o&&n.lineTo(parseInt(a.shift()*i),parseInt(a.shift()*i),parseInt(a.shift()*i)),"c"===o&&n.curveTo(parseInt(a.shift()*i),parseInt(a.shift()*i),parseInt(a.shift()*i),parseInt(a.shift()*i),parseInt(a.shift()*i),parseInt(a.shift()*i))}return n},_createPrimitiveObject:function(e,t){var i,n=("mono."+e.className,Utils.Path+"default_texture.png",e.args);if("Cube"===e.className&&(i=new mono.Cube(n.x,n.y,n.z)),"Sphere"===e.className&&(i=new mono.Sphere(n.radius)),"Cylinder"===e.className){var a=window.prompt("Segment count:",n.radialSegments);if(null===a)return;i=new mono.Cylinder(n.radiusTop,n.radiusBottom,n.height,a),n.smooth?(i.setStyle("m.normalType",mono.NormalTypeSmooth),i.setStyle("top.m.normalType",mono.NormalTypeFlat),i.setStyle("bottom.m.normalType",mono.NormalTypeFlat)):i.setStyle("m.normalType",mono.NormalTypeFlat)}if("Torus"===e.className&&(i=new mono.Torus(n.radius,n.tube,n.radialSegments,n.tubularSegments)),"PathNode"===e.className&&(i=new mono.PathNode(Utils._createPath(n.path),n.pathSegments,n.radius,n.shapeSegments,n.startCap,n.endCap),i.setSegmentsCap(10),n.startCapSize&&i.setStartCapSize(n.startCapSize),n.endCapSize&&i.setEndCapSize(n.endCapSize)),"TextNode"===e.className){var o=[{label:"Text:",id:"text3d",value:n.text,tab:"Properties"},{label:"Font:",id:"font3d",type:"select",options:PropertyConsts.Font.fontFamily,value:n.font,tab:"Properties"},{label:"Style:",id:"style3d",type:"select",options:PropertyConsts.Font.fontStyle,value:n.style,tab:"Properties"}],r="Text Property",s=function(e){var i=new mono.TextNode(e.text3d,null,n.height,e.font3d,e.style3d),a=n.scale||1;i.setScale(a,a,a),Utils._init3dObject(i),t.add(i),t.getSelectionModel().clearSelection(),i.setSelected(!0)};return void Utils.showInputDialog(o,r,!0,s)}return Utils._init3dObject(i),i},_createLatheObject:function(e){var t=new GridNetwork;t.setInteractions([new twaver.canvas.interaction.CreateShapeNodeInteraction(t,window.RoundPipeShapeNode),new twaver.canvas.interaction.EditInteraction(t,!1),new twaver.canvas.interaction.DefaultInteraction(t)]),t.setEditPointSize(10),t.addElementByInteraction=function(e){twaver.canvas.Network.prototype.addElementByInteraction.call(this,e),setTimeout(function(){t.setInteractions([new twaver.canvas.interaction.EditInteraction(t,!1),new twaver.canvas.interaction.SelectInteraction(t),new twaver.canvas.interaction.MoveInteraction(t,!1),new twaver.canvas.interaction.DefaultInteraction(t)])},500)};var i=new twaver.Node("axis");Utils.registerImage(Utils.Path+"axis.png"),i.setImage(Utils.Path+"axis.png"),i.setLocation(400,100),i.setStyle("select.style","none"),t.setEditableFunction(function(e){return e===i?!1:!0}),t.getElementBox().add(i);var n=document.createElement("div"),a=document.createElement("p");a.innerHTML="Note:double click to end path",n.appendChild(a),n.style.width="800px",n.style.height="400px",n.appendChild(t.getView()),setTimeout(function(){t.adjustBounds({width:800,height:400}),t.getView().style.position="relative"},100);var o=[{id:"shapePath",type:"div",value:n,tab:"Path"},{label:"Height Segments:",id:"segmentsH",value:64,tab:"Properties"},{label:"Radius Segments:",id:"segmentsR",value:20,tab:"Properties"},{label:"Rotation Angle:",id:"rotationAngle",value:360,tab:"Properties"},{label:"Start Closed:",id:"startClosed",checked:!1,type:"checkbox",tab:"Properties"},{label:"End Closed:",id:"endClosed",checked:!1,type:"checkbox",tab:"Properties"}],r="Lathe Property",s=function(t,i){var n=new mono.Path;if(t){var a,o=t.getElementBox().getDatas();o.forEach(function(e){e instanceof PipeShapeNode&&(a=e)});var r=t.getElementBox().getDataById("axis"),s=r.getRect(),l={x:s.x+7,y:s.y+s.height};if(a){var d=a.getPoints();if(d&&d.size()>1){var c=d.get(0);n.moveTo(c.x-l.x,l.y-c.y,0);for(var h=1;h<d.size();h++)c=d.get(h),n.lineTo(c.x-l.x,l.y-c.y,0)}var u=parseInt(i.segmentsH),g=parseInt(i.segmentsR),m=parseInt(i.rotationAngle)*Math.PI/180,p=new mono.LatheNode(n,u,g,m,i.startClosed,i.endClosed);p.setStyle("m.side",TGL.DoubleSide).setStyle("m.texture.image","images/default_texture.png"),e.add(p)}}};Utils.showInputDialog(o,r,!0,s,this,[t])},_createPipeObject:function(e){var t=e.getInteractions(),i=!1;t.forEach(function(t){t instanceof ComponentsDragPipeInteraction&&(t=new ComponentsDragPipeInteraction(e),i=!0)}),i||(t.push(new ComponentsDragPipeInteraction(e)),e.setInteractions(t))},_setDropPosition:function(e,t,i){var n=t.getElementsByMouseEvent(e);if(n.length){var a=n[0],o=(a.element,a.point);i.setPosition(o)}},_handle3dDrop:function(e,t,i,n){var a=JSON.parse(t);if("Primitive"===a.classType){var o=Utils._createPrimitiveObject(a,i.getDataBox());o&&(Utils._setDropPosition(e,i,o),i.getDataBox().add(o),i.getDataBox().getSelectionModel().clearSelection(),o.setEditable(!0),o.setSelectable(!0))}if("Pipe"===a.classType&&Utils._createPipeObject(i),"Combo"===a.classType){for(var r=(a.className,Utils.Path+"default_texture.png"),s=a.primitives,l=a.ops,d=0;d<s.length;d++){var c=s[d],o=Utils._createPrimitiveObject(c);o&&(c.position&&o.setPosition(c.position.x,c.position.y,c.position.z),c.rotation&&o.setRotation(c.rotation.x,c.rotation.y,c.rotation.z),initElement(o)),s[d]=o}var h=new mono.ComboNode(s,l,!0);initElement(h),Utils._setDropPosition(e,i,o),i.getDataBox().add(h),i.getDataBox().getSelectionModel().clearSelection(),h.setEditable(!0),h.setSelectable(!0)}if("Lathe"===a.classType&&Utils._createLatheObject(i.getDataBox()),"Billboard"===a.classType){var u,g=Utils._findFirstObjectByMouse(i,e);g&&(u=g.element);var r=Utils.Path+a.material,o=new mono.Billboard;if(o.setStyle("m.texture.image",r),o.setStyle("m.alignment",mono.BillboardAlignment.bottomCenter),o.setStyle("m.transparent",!1),o.setStyle("m.opacity",1),o.setStyle("m.vertical",!0),u){o.setParent(u),u.boundingBox||u.computeBoundingBox();var m=u.boundingBox.max.y;o.setPosition(0,m,0)}else Utils._setDropPosition(e,i,o);o.setEditable(!0),o.setSelectable(!0),o.setScale(a.args.x,a.args.y,1),i.getDataBox().add(o)}if("Cube"===a.classType){var p=Utils.Path+a.material,f=Utils.Path+"brush_metal.png",v=a.args,y=!1;a.transparent&&(y=a.transparent);var o=new mono.Cube(v.x,v.y,v.z);o.setStyle("m.texture.image",f),o.setStyle("m.texture.repeat",new mono.Vec2(1,1)),o.setClient("shape",a.shape);var b=["front"];a.faces&&(b=a.faces);for(var C=0;C<b.length;C++){var w=b[C];o.setStyle(w+".m.texture.image",p),o.setStyle(w+".m.transparent",y)}o.setEditable(!0),o.setSelectable(!0),initElement(o),Utils._setDropPosition(e,i,o);var g=Utils._findFirstObjectByMouse(i,e);if(Utils.stickOnSurface(o,i,e,g),a.text){var t=window.prompt("Text:",a.text.content),S=new mono.TextNode(t,null,a.text.height,a.text.font,a.text.style),x=a.text.scale||1;S.setScale(x,x,x),S.setEditable(!0),S.setSelectable(!0),S.setParent(o),S.editTransformToParent=!0,S.setStyle("m.texture.image",Utils.Path+a.text.material),initElement(S);var g=Utils._findFirstObjectByMouse(i,e);Utils.stickOnSurface(S,i,e,g),a.text.position&&S.setPosition(o.getPosition().x+a.text.position.x,o.getPosition().y+a.text.position.y,o.getPosition().z+a.text.position.z),a.text.rotation&&S.setRotation(o.getRotation().x+a.text.rotation.x,o.getRotation().y+a.text.rotation.y,o.getRotation().z+a.text.rotation.z),i.getDataBox().add(S)}i.getDataBox().add(o);var I;if(a.panel){if(I=new mono.Cube(a.panel.x,a.panel.y,a.panel.z),I.setStyle("m.texture.image",f),a.panel.pic){var P=Utils.Path+a.panel.pic;I.setStyle("front.m.texture.image",P)}I.setParent(o),I.editTransformToParent=!0,I.getPosition().z+=o.depth/2,initElement(I),i.getDataBox().add(I);var _=o.getId()+":"+I.getId();o.setGroupId(_),I.setGroupId(_)}if(n){o.setClient("cellID",n.getId());var E=faceObject.element.depth;"verticalCard"===a.shape?(o.setHeight(n.getHeight()),I&&I.setHeight(n.getHeight())):"horizontalCard"===a.shape?(o.setWidth(n.getWidth()),I&&I.setWidth(n.getWidth())):"cube"===a.shape&&(o.setWidth(n.getWidth()),o.setHeight(n.getHeight()),o.setDepth(E/10));var T=n.getClient("offsetX"),A=n.getClient("offsetY");setPositionByRelative(faceObject.faceIndex,o,T,A)}}if("Material"===a.classType){var r=Utils.Path+a.material,L=1,N=1,k=!0,y=!1;a.texture&&(L=a.texture.row,N=a.texture.column),void 0!==a.visible&&(k=a.visible),a.transparent&&(y=a.transparent);var g=Utils._findFirstObjectByMouse(i,e);if(g)if(a.texture){var O=[{label:"Row:",id:"row",value:L},{label:"Column:",id:"column",value:N},{label:"Scope:",id:"useForAllFaces",type:"checkbox",inner:"Use this material for all faces"}];Utils.showInputDialog(O,"Set Material",!0,this.setMaterial,this,[r,k,y,g])}else{var D={};D.row=L,D.column=N,this.setMaterial(r,k,y,g,D,a.wrapMode)}}if("Dye-Color"===a.classType){var g=Utils._findFirstObjectByMouse(i,e),R=a.color;if(g&&R){var o=g.element,O=[{label:"Scope:",id:"useForAllFaces",type:"checkbox",inner:"Use this dye color for all faces"}];Utils.showInputDialog(O,"Set Dye Color",!0,this.setDyeColor,this,[R,g])}}if("Template"===a.classType){var M="Load Template",B=[{label:"","class":"lb-save-template",id:"opentemp",name:"templates",type:"radio",checked:!0,inner:"Open template in the scense"},{label:"","class":"lb-save-template",id:"loadtemp",name:"templates",type:"radio",checked:!1,inner:"Insert template in the scense"}];Utils.showInputDialog(B,M,!0,function(t){var n=Utils._findFirstObjectByMouse(i,e),o=modelManager.loadComponentTemplate(i.getDataBox(),a.id,t.opentemp,this,function(a){t.opentemp||(Utils._setDropPosition(e,i,a),a.setPositionY(a.getHeight()/2),Utils.stickOnSurface(a,i,e,n))});o&&!t.opentemp&&(Utils._setDropPosition(e,i,o),o.setPositionY(o.getHeight()/2),Utils.stickOnSurface(o,i,e,n))})}i.getView().focus()},stickOnSurface:function(e,t,i,n){if(n){{var a=n.face,o=n.element,r=n.point;o.getPosition()}r=o.worldToLocal(r),e.setParent(o),e.setPosition(r.x,r.y,r.z),e.getPosition().z+=1,e.setClient("faceIndex",a.materialIndex);var s=a.normal.clone();o.setClient("parentFaceIndex",a.materialIndex);for(var l,d,c=e.getParent();c;)l=c,d=l.getClient("parentFaceIndex"),c=c.getParent();0==d?s=new mono.Vec3(1,0,0):1==d?s=new mono.Vec3(-1,0,0):2==d?s=new mono.Vec3(0,1,0):3==d?s=new mono.Vec3(0,-1,0):4==d?s=new mono.Vec3(0,0,1):5==d&&(s=new mono.Vec3(0,0,-1)),s=s.applyMatrix4((new mono.Mat4).extractRotation(o.matrix)),s.normalize();var h=new mono.Vec3(0,0,1),u=Math.acos(s.dot(h)/s.length()/h.length()),g=(new mono.Vec3).crossVectors(s,h).normalize(),m=new mono.Mat4;m.makeRotationAxis(g,-u);var p=(new mono.Vec3).setEulerFromRotationMatrix((new mono.Mat4).extractRotation(m)),p=o.getRotation();e.setRotation(p)}Utils.isCtrlDown(i)&&e.setRotationZ(e.getRotation().z+Math.PI/2)},setDyeColor:function(e,t,i){var n=t.face,a=t.element,o=n.materialIndex;if(i.useForAllFaces){var r="m.color";a.setStyle(r,e),r="m.ambient",a.setStyle(r,e)}else{var r="m.color";a.getIndexSideMapping()&&(r=a.getIndexSideMapping()[o]+"."+r),a.setStyle(r,e),r="m.ambient",a.getIndexSideMapping()&&(r=a.getIndexSideMapping()[o]+"."+r),a.setStyle(r,e)}},setMaterial:function(e,t,i,n,a,o){repeatRow=parseInt(a.row),repeatColumn=parseInt(a.column);var r,s=n.element,l=n.face,d=l.materialIndex,c=a.useForAllFaces,h=s.getIndexSideMapping();if(!o&&h&&(r=s.getIndexSideMapping()[d],r+="."),void 0===r){var u=["m.texture.image","m.texture.repeat","m.visible","m.transparent"];for(nameIndex in u){var g,m=u[nameIndex],p=s.getStyle(m,!0,!0);if("m.texture.image"===m&&(g=e),"m.texture.repeat"===m&&(g=new mono.Vec2(repeatRow,repeatColumn)),"m.visible"===m&&(g=t),"m.transparent"===m&&(g=i),c)for(var f=0;f<p.length;f++)p[f]=g;else p[d]=g;s.setStyle(m,p)}o&&(s.setStyle("m.texture.image",e),s.setStyle("m.texture.repeat",new mono.Vec2(1,1)),s.setWrapMode(o))}else if(c){if(h)for(var f=0;f<s.getIndexSideMapping().length;f++){var r=s.getIndexSideMapping()[f];r+=".",s.setStyle(r+"m.texture.image",null),s.setStyle(r+"m.texture.repeat",null),s.setStyle(r+"m.visible",null),s.setStyle(r+"m.transparent",null)}s.setStyle("m.texture.image",e),s.setStyle("m.texture.repeat",new mono.Vec2(repeatRow,repeatColumn)),s.setStyle("m.visible",t),s.setStyle("m.transparent",i)}else s.setStyle(r+"m.texture.image",e),s.setStyle(r+"m.texture.repeat",new mono.Vec2(repeatRow,repeatColumn)),s.setStyle(r+"m.visible",t),s.setStyle(r+"m.transparent",i)},registerImage:function(e,t,i,n,a,o){var r=new Image;e.startsWith("data:image")?r.src=e:(r.crossOrigin="",r.src=Utils.RelativePath+e);var s=arguments;o&&(e=o),r.onload=function(){"component"==i?twaver.Util.registerImage(e,r,r.width,r.height,t):twaver.Util.registerImage(e,r,r.width,r.height),n&&n.call(a,r.width,r.height);for(var o=1;o<s.length;o++){var l=s[o];l&&l.invalidateElementUIs&&l.invalidateElementUIs(),l&&l.invalidateDisplay&&l.invalidateDisplay()}}},getImageName:function(e){var t=e.lastIndexOf("/"),i=e;return t>=0&&(i=e.substring(t+1)),t=i.lastIndexOf("."),t>=0&&(i=i.substring(0,t)),i},addMask:function(e){{var t;parseInt(window.screen.availWidth),parseInt(window.screen.availHeight)}return t=document.createElement("div"),e?t.setAttribute("id","mask_"+e):t.setAttribute("id","mask"),t.setAttribute("class","mask"),document.body.appendChild(t),t},randomInt:function(e){return Math.floor(Math.random()*e)},randomColor:function(){var e=Utils.randomInt(255),t=Utils.randomInt(255),i=Utils.randomInt(255);return"#"+Utils._formatNumber(e<<16|t<<8|i)},_formatNumber:function(e){for(var t=e.toString(16);t.length<6;)t="0"+t;return t},changeTwoDecimal:function(e){return Utils.changeDecimalDigit(e,2)},rChangeTwoDecimal:function(e){return e?parseFloat(e.toString().replace(/[^\d\.-]/g,"")):0},changeDecimalDigit:function(e,n){n=n>0&&20>=n?n:2,e=Utils.rChangeTwoDecimal(e),e=parseFloat((e+"").replace(/[^\d\.-]/g,"")).toFixed(n)+"";var a=e.split(".")[0].split("").reverse(),o=e.split(".")[1];for(t="",i=0;i<a.length;i++)t+=a[i];var r=t.split("").reverse().join("")+"."+o;return parseFloat(r)},disposeDialog:function(e){document.body.removeChild(document.getElementById("mask_"+e)?document.getElementById("mask_"+e):document.getElementById("mask")),document.body.removeChild(document.getElementById(e))},parameterReset:function(e,t){if(this.setButtonStyle(e),"ScaleReset"===e){var i=document.getElementById(t+"X");i.value=parseFloat(1).toFixed(decimalNumber),i=document.getElementById(t+"Y"),i.value=parseFloat(1).toFixed(decimalNumber),i=document.getElementById(t+"Z"),i.value=parseFloat(1).toFixed(decimalNumber)}else if("PositionReset"===e){var i=document.getElementById(t+"X");i.value=parseFloat(0).toFixed(decimalNumber),i=document.getElementById(t+"Y"),i.value=parseFloat(0).toFixed(decimalNumber),i=document.getElementById(t+"Z"),i.value=parseFloat(0).toFixed(decimalNumber)}else if("RotationReset"===e){var i=document.getElementById(t+"X");i.value=0,i=document.getElementById(t+"Y"),i.value=0,i=document.getElementById(t+"Z"),i.value=0}else if("TextureReset"===e){var i=document.getElementById(t+"C");i.value=1,i=document.getElementById(t+"R"),i.value=1}},setButtonStyleHover:function(e){var t=document.getElementById(e);t.setAttribute("class","parameterReset_hover")},setButtonStyle:function(e){var t=document.getElementById(e);t.setAttribute("class","parameterReset")},showInputDialog:function(e,t,i,n,a,o,r,s,l){if(e){var d,c,h=[],u=[],g=[],m={};if(r){var p=[{label:"p1",id:"p1",tab:"User Properties",readonly:!1,"class":"customlabel"},{label:"p2",id:"p2",tab:"User Properties",readonly:!1,"class":"customlabel"},{label:"p3",id:"p3",tab:"User Properties",readonly:!1,"class":"customlabel"},{label:"p4",id:"p4",tab:"User Properties",readonly:!1,"class":"customlabel"}];e=e.concat(p)}for(var f=0,v=e.length;v>f;f++){var y=e[f];c=y.tab||GENERAL,d=m[c]||document.createElement("form");{var b=y.id,C=y.type?y.type:"text";y.label}if("div"!==C){var w=document.createElement("input");"undefined"!=typeof y.label&&w.setAttribute("value",y.label),w.tabIndex="-1",y.readonly!==!1&&w.setAttribute("readonly",!0),y.class?w.setAttribute("class",y.class):w.setAttribute("class","field"),y.labelId?w.setAttribute("id",y.labelId):y.id&&w.setAttribute("id","label"+y.id);var S="select"===C,x=document.createElement("input");if(S){x=document.createElement("select"),x.style.width="304px";var I=y.value,P=y.options;if(P)for(var _=0;_<P.length;_++){var E=P[_],T=document.createElement("option");T.innerHTML=E,T.setAttribute("value",E),I&&I===E&&T.setAttribute("selected","true"),x.appendChild(T)}}if(!S&&(x.setAttribute("type",C),y.pick?(x.style.borderRight="0px",x.style.width="272px"):x.setAttribute("size",40),y.list)){var A=b+"_datalist";x.setAttribute("list",A);var L=document.createElement("datalist");L.setAttribute("id",A);for(var N=0;N<y.list.length;N++){var k=y.list[N],O=document.createElement("option");O.setAttribute("value",k),L.appendChild(O)}y.datalist=L}if(void 0===C||"input"===C||"text"===C||"password"===C?x.setAttribute("class","input"):"label"===C||x.setAttribute("class","input-r"),y.name&&x.setAttribute("name",y.name),y.pick&&(x.pickImage=!0),void 0!==y.display&&(y.display?(w.style.display="block",x.style.display="block"):(w.style.display="none",x.style.display="none")),void 0===y.min||isNaN(y.min)||x.setAttribute("min",y.min),void 0===y.max||isNaN(y.max)||x.setAttribute("max",y.max),y.listener&&(x[y.eve]=y.listener),0==y.editable&&(x.setAttribute("readonly","readonly"),x.style.border="0px",x.style.borderBottom="1px solid #ABADB3"),"checkbox"===C||"radio"===C){var D=y.checked;void 0===D&&(D=!1),D&&x.setAttribute("checked",D)}if(y.id&&(x.setAttribute("id",y.id),"User Properties"==y.tab?u.push(y.id):h.push(y.id)),"undefined"!=typeof y.value&&x.setAttribute("value",y.value),"multipleF"!=C&&"multipleS"!==C&&"multipleT"!==C&&"button"!==C&&d.appendChild(w),("multipleF"===C||"multipleS"===C||"multipleT"===C)&&("undefined"!=typeof y.labelMinor&&w.setAttribute("value",y.labelMinor),y.class?w.setAttribute("class",y.class):w.setAttribute("class","fieldlabel"),"textureRepeatC"===y.id?w.style.width="48px":"textureRepeatR"===y.id?w.style.width="30px":"shapeW"===y.id?w.style.width="17px":"shapeH"===y.id||"shapeD"===y.id?w.style.width="11px":"ambientLightColor"===y.id?w.style.width="50px":"pointLightColor"===y.idTyle?w.style.width="50px":"pointLightPosition"===y.idTyle?w.style.width="65px":"pointLightIntensity"===y.idTyle&&(w.style.width="70px"),d.appendChild(w)),"range"===C){var R=document.createElement("div"),M=document.createElement("output");M.value=x.value,M.style.paddingLeft="10px",M.setAttribute("id","rangeValue"),function(e,t){e.addEventListener("change",function(){t.value=e.value})}(x,M),R.appendChild(x),R.appendChild(M),d.appendChild(R)}else if("textArea"===C){var B=document.createElement("div"),M=document.createElement("textarea");M.setAttribute("id",b),M.value=y.value,M.style.width="500px",M.style.height="300px",B.appendChild(M),d.appendChild(B)}else if("multipleF"===C||"multipleS"===C||"multipleT"===C)x.style.width="84px",x.style.marginLeft="1px","textureRepeatC"===y.id||"textureRepeatR"===y.id?x.style.width="106px":"shapeW"===y.id||"shapeH"===y.id||"shapeD"===y.id?x.style.width="81px":"ambientLightColor"===y.id?x.style.width="60px":"pointLightColor"===y.idTyle?x.style.width="60px":"pointLightPosition"===y.idTyle?x.style.width="115px":"pointLightIntensity"===y.idTyle&&(x.style.width="60px"),d.appendChild(x);else if("label"==C);else if("button"==C){var U=document.createElement("input");U.id=y.label,U.setAttribute("type","button"),U.setAttribute("class","parameterReset"),U.setAttribute("title","reset"),"PositionReset"===y.label?(U.setAttribute("onclick","Utils.parameterReset('PositionReset','position')"),U.setAttribute("onmouseover","Utils.setButtonStyleHover('PositionReset')"),U.setAttribute("onmouseout","Utils.setButtonStyle('PositionReset')")):"RotationReset"===y.label?(U.setAttribute("onclick","Utils.parameterReset('RotationReset','rotation')"),U.setAttribute("onmouseover","Utils.setButtonStyleHover('RotationReset')"),U.setAttribute("onmouseout","Utils.setButtonStyle('RotationReset')")):"ScaleReset"===y.label?(U.setAttribute("onclick","Utils.parameterReset('ScaleReset','scale')"),U.setAttribute("onmouseover","Utils.setButtonStyleHover('ScaleReset')"),U.setAttribute("onmouseout","Utils.setButtonStyle('ScaleReset')")):"TextureReset"===y.label&&(U.setAttribute("onclick","Utils.parameterReset('TextureReset','textureRepeat')"),U.setAttribute("onmouseover","Utils.setButtonStyleHover('TextureReset')"),U.setAttribute("onmouseout","Utils.setButtonStyle('TextureReset')")),U.setAttribute("onmousedown","Utils.stopPropagation(event)"),d.appendChild(U)}else d.appendChild(x);if(y.inner&&y.display!==!1){var F=document.createElement("label");F.setAttribute("class","innerLabel"),F.innerHTML=y.inner,d.appendChild(F)}if(y.pick){var z=document.createElement("input");z.setAttribute("class","image-pick-button"),z.setAttribute("name","pick"),z.setAttribute("type","button"),z.onclick=y.pickFunction,d.appendChild(z)}if(void 0===y.return){var V=document.createElement("div");V.setAttribute("class","clear"),d.appendChild(V)}y.datalist&&d.appendChild(y.datalist),m[c]=d}else d?d.appendChild(y.value):(d=document.createElement("div"),d.style.width="800px",d.style.height="400px",d.appendChild(y.value)),m[c]=d,y.id&&h.push(y.id)}var H=new TabPanel;for(var G in m)H.addTab(G,m[G]);H.setTabChangedFunction(function(e){Utils.setDialogRect("dialog_id"),s&&s(e)});var W=l?l:"input_dialog_id";Utils.showDialog(W,H.getView(),t,i,!1,null,n,a,o,h,u,g)}},showDialog:function(e,t,i,n,a,o,r,s,l,d,c){Utils.addMask(e);var h=document.createElement("div");h.setAttribute("id",e),h.setAttribute("title",i),o?h.setAttribute("class",o):h.setAttribute("class","dialog");var u=document.createElement("div");u.setAttribute("id","dialog_title"+e),u.setAttribute("class","dialog-title-div");var g=document.createElement("img");if(g.setAttribute("class","new_icon"),g.setAttribute("src","images/tw.png"),u.appendChild(g),i){var m=document.createElement("span");m.innerHTML=i,m.setAttribute("class","nd"),h.appendChild(m),u.appendChild(m)}if(a){var p=document.createElement("img");p.setAttribute("src","images/index01_03.png"),p.setAttribute("class","delete"),p.onclick=function(){Utils.disposeDialog(e)},u.appendChild(p)}h.appendChild(u);var f=document.createElement("div");if(f.setAttribute("class","clear"),u.appendChild(f),t&&"string"==typeof t){var v=document.createElement("div");v.innerHTML=t,o||v.setAttribute("class","inner"),h.appendChild(v)}if(t&&"object"==typeof t){var v=document.createElement("div");if(v.appendChild(t),o||v.setAttribute("class","inner"),h.appendChild(v),t.resetRect){var y=document.getElementById("mask");document.getElementById("mask_"+e)&&(y=document.getElementById("mask_"+e));var b=y.offsetWidth,C=y.offsetHeight;t.style.width=parseInt(.8*b)+"px",t.style.height=parseInt(.7*C)+"px"}}var w={};if(n){if(r){var S=document.createElement("button");S.setAttribute("class","cbt"),S.onclick=function(){Utils.disposeDialog(e)};var x=document.createElement("a");x.appendChild(S),h.appendChild(x)}var I=document.createElement("button");I.setAttribute("class","obt");var P=document.createElement("a");P.appendChild(I),I.onclick=r?function(){if(c&&c.length>0){for(var t={},i=0;i<c.length;i++){var n=c[i],a=document.getElementById("label"+n).value,o=document.getElementById(n).value;t[a]=o}w.customProps=t}if(d)for(var i=0;i<d.length;i++){var h=d[i],u="";document.getElementById(h)&&(w[h]=document.getElementById(h).value,u=document.getElementById(h).type),"checkbox"===u||"radio"===u?w[h]=document.getElementById(h).checked:"select"===u?w[h]=document.getElementById(h).selected:"file"===u&&(w[h]=document.getElementById(h).files)}var g=[];l&&(g=l),g.push(w);var m=r.apply(s,g);("undefined"==typeof m||m)&&Utils.disposeDialog(e)
}:function(){Utils.disposeDialog(e)},h.appendChild(P)}return document.body.appendChild(h),Utils.setDialogRect(e),h.setAttribute("tabindex",-1),h.focus(),h.onkeydown=function(e){window.event?keynum=e.keyCode:e.which&&(keynum=e.which),!Utils.isShiftDown(e)&&13==keynum&&I&&I.click()},Utils.move("dialog_title"+e,e),w},getMouseP:function(e){e=e||window.event;var t=e.pageX||e.pageY?{x:e.pageX,y:e.pageY}:{x:e.clientX+document.body.scrollLeft-document.body.clientLeft,y:e.clientY+document.body.scrollTop-document.body.clientTop};return t},move:function(e,t){e=document.getElementById(e),t=document.getElementById(t),t.moving=!1,e.onmousedown=function(e){var i=Utils.getMouseP(e),n={x:i.x-t.offsetLeft,y:i.y-t.offsetTop};document.onmousemove=function(e){var i=Utils.getMouseP(e);t.style.left=i.x-n.x+"px",t.style.top=i.y-n.y+"px",t.moving=!0},document.onmouseup=function(){t.moving&&(window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),this.onmousemove=null,t.moving=!1)}}},setDialogRect:function(e){var t=document.getElementById("mask");if(document.getElementById("mask_"+e)&&(t=document.getElementById("mask_"+e)),t){var i=t.offsetWidth,n=t.offsetHeight,a=document.getElementById(e),o=a.offsetWidth,r=a.offsetHeight;a.style.left=i/2-o/2+"px",a.style.top=n/2-r/2+"px"}},createRoom:function(e){"room"===e?(document.body.removeChild(document.getElementById("mask_newEditor")),document.body.removeChild(document.getElementById("newEditor")),Utils.checkLoadLocalImage()):"component"===e&&(document.location.href="index.html?showEditor=false")},createComponent:function(e){"room"===e?document.location="components.html":"component"===e&&(document.body.removeChild(document.getElementById("mask_newEditor")),document.body.removeChild(document.getElementById("newEditor")),Utils.checkLoadLocalImage())},createLayerRow:function(e,t,i,n,a){var o=new TreeComboBox(e,null,!0,a.getRoots(),null,null,i),r={id:t,value:o.getView(),type:"div",tab:n};return r},createImageRow:function(e,t,i,n){var a=localStorage.getItem(LOAD_RESOURCE_TYPE)===TYPE_CLOUD?{label:e,id:t,value:i,pick:!0,tab:n,pickFunction:function(){Utils.pickImage(t)}}:{label:e,id:t,value:i,tab:n};return a},pickImage:function(e){var t=new TextureImagePanel;t.init(),Utils.showDialog("imagepane",t.getView(),"Select Image",!0,!1,null,Utils.setImageCategory,Utils,[e,t])},setImageCategory:function(e,t){var i=t.getLastNetworkData();i&&document.getElementById(e)&&(document.getElementById(e).value=i.getClient("path"))},pickAnimation:function(e,t){var t=document.getElementById(e).value,i=new twaver.LayerBox,n=i.getDataById("default");if(Utils.isNotNull(t)&&""!=t){var a=t.split(";");for(var o in a){var r=new twaver.Layer;0==o&&(r=n);var s=a[o],l=s?s.split(":"):["","",""],d=l[0],c=l[1],h=parseFloat(l[2]),u=l.length>3?parseInt(l[3]):1500,g=l.length>4?parseInt(l[4]):0,m=l.length>5?l[5]:"Linear.None";r.setClient("action",d),r.setClient("anchor",c),r.setClient("value",h),r.setClient("time",u),r.setClient("delay",g),r.setClient("easing",m),i.getDataById(r.getId())||i.add(r)}}else n.setClient("time",1500),n.setClient("delay",0),n.setClient("easing","Linear.None");var p=new AnimationTable(i);p.showDialog(e)},queryString:function(e,t){var i=new RegExp(""+t+"=([^&?]*)","ig");return e.match(i)?e.match(i)[0].substr(t.length+1):null},getImageSrc:function(e){var t="";return t=e.indexOf("http")>=0?e:e.indexOf("base64")>=0?e:e.indexOf(Utils.Path)>=0?e:Utils.Path+e},showPortDialog:function(e,t,i,n){var a=[{label:"Rows:",id:"rows",type:"input",value:2},{label:"Columns:",id:"columns",type:"input",value:2}];Utils.showInputDialog(a,"Port Params",!0,this.createPortByMat,this,[e,t,i,n])},createPortByMat:function(e,t,i,n,a){var o=parseInt(a.rows),r=parseInt(a.columns),s=e.getElementBox(),l=e.getElementAt(t);if(l instanceof twaver.Grid){var d=(i.resize,e.getLogicalPoint(t)),c=l.getCellObject(d);Utils.registerImage(Utils.Path+i.material,e,"component");for(var h=0;o>h;h++)for(var u=0;r>u;u++){var g=new twaver.Follower;if(g.setImage(Utils.Path+i.material),g.setClient("text",n),g.setClient("resize",i.resize),s.getSelectionModel().setSelection(g),null!=c){"unresize"===i.resize&&(g.setStyle("follower.fill.cell",!1),g.setWidth(i.args.x*e.zoom),g.setHeight(i.args.y*e.zoom)),g.setParent(l),g.setHost(l),g.setStyle("follower.row.index",c.rowIndex+h),g.setStyle("follower.column.index",c.columnIndex+u);var m=g.getParent().getParent(),p=g.getCenterLocation().x-m.getCenterLocation().x,f=g.getCenterLocation().y-m.getCenterLocation().y;g.setClient("offsetX",p/e.zoom),g.setClient("offsetY",f/e.zoom);var v=l.getClient("offset");g.setClient("offset",v+.15),g.setClient("selfID",g.getId()),g.setClient("hostCell",l),s.add(g)}}handleText2d(e)}},showTemplateDialog:function(e,t,i,n,a){var o=[{label:"Rows :",id:"rows",type:"input",value:2},{label:"Columns :",id:"columns",type:"input",value:2},{label:"X Gap :",id:"xGap",type:"input",value:20},{label:"Y Gap :",id:"yGap",type:"input",value:20}];Utils.showInputDialog(o,"Template Params",!0,this.createTemplateByMat,this,[e,t,i,n,a])},createTemplateByMat:function(e,t,i,n,a,o){var r=parseInt(o.rows),s=parseInt(o.columns),l=parseInt(o.xGap),d=parseInt(o.yGap),c=[];if(n.loadFromCloud)for(var a=function(e,n,a){processHost(e,i),e._host?e._host.setCenterLocation({x:t.getLogicalPoint(i).x+(e.getWidth()+l)*a,y:t.getLogicalPoint(i).y+(e.getHeight()+d)*n}):e.setCenterLocation({x:t.getLogicalPoint(i).x+(e.getWidth()+l)*a,y:t.getLogicalPoint(i).y+(e.getHeight()+d)*n}),c.push(e),t.getSelectionModel().clearSelection(),c.forEach(function(e){t.getSelectionModel().appendSelection(e)})},h=0;r>h;h++)for(var u=0;s>u;u++)e._createElement(t,t.getLogicalPoint(i),n,a,h,u);else for(var h=0;r>h;h++)for(var u=0;s>u;u++){var g=e._createElement(t,t.getLogicalPoint(i),n,a);g._host?g._host.setCenterLocation({x:t.getLogicalPoint(i).x+(g.getWidth()+l)*u,y:t.getLogicalPoint(i).y+(g.getHeight()+d)*h}):g.setCenterLocation({x:t.getLogicalPoint(i).x+(g.getWidth()+l)*u,y:t.getLogicalPoint(i).y+(g.getHeight()+d)*h})}},checkPointFlag:function(e,t,i,n){if("undefined"!=typeof i)if(t)t.setShowPoint(i);else if(i){t=new TargetFlagNode(n);var a=borderPane.getView();if(n==PointFlag.ORIGINAL_POINT)var o=0,r=0;else var o=a.offsetWidth-ACCORDION_WIDTH,r=a.offsetHeight;t.setCenterLocation(o/2,r/2),e.getElementBox().add(t)}},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},isAltDown:function(e){return e.altKey},isShiftDown:function(e){return e.shiftKey},getVersion:function(){return"2.1"},createPointLight:function(e,t){var i=new mono.PointLight(16777215,1),n=1e4;return"undefined"!=typeof e&&(n=e),i.setPosition(n,n,n),0==t&&i.setVisible(!1),i},clearLocalStorage:function(){localStorage&&(localStorage.clear(),alert("success"))},setNetworkBackground:function(e,t){var i=localStorage.getItem(t);i||(i="#FFFFFF"),e.setClearColor(i)},copyDatasToBoxAnchor:function(e,t){var i=modelManager.serializeDatasInfo(e,network._scaleUnitValue);console.log(i),t.copyAnchor=i},pasteBoxAnchorToBox:function(e,t){var i=[];if(e.copyAnchor){var n=modelManager.parseSketch(JSON.parse(e.copyAnchor));if(n instanceof Array)for(var a in n)t&&n[a].setClient("floorName",t),e.add(n[a]),i.push(n[a])}return i},string2Boolean:function(e){return e?"false"===e?!1:!0:!1},string2Float:function(e){return e?parseFloat(e):defautValue},loadPropertiesFromLocalStorage:function(e,t,i,n,a){var o=localStorage.getItem(LOAD_RESOURCE_TYPE);o?loadResource=o:document.URL.startsWith(PropertyConsts.MONO_URL_PRE)&&(loadResource=TYPE_CLOUD);var o=localStorage.getItem(DECIMAL_NUMBER);o&&(decimalNumber=parseInt(o)),o=localStorage.getItem(CLOUD_KEY),o&&(cloudKey=o),o=localStorage.getItem(CLOUD_PASSWORD),o&&(cloudPassword=o),o=localStorage.getItem(AMBIENT_LIGHT_ON),o&&t.setVisible(Utils.string2Boolean(o)),o=localStorage.getItem(AMBIENT_LIGHT_COLOR),o&&t.setColor(o),o=localStorage.getItem(PropertyConsts.LocalStorage.SELECT_STYLE),o&&(selectStyle=o);for(var r=1;r<=i.length;r++){if(o=localStorage.getItem(POINT_LIGHT_ON+r+""),o&&i[r-1].setVisible(Utils.string2Boolean(o)),o=localStorage.getItem(POINT_LIGHT_POSITION+r+"")){var s=o.split(",");3==s.length?i[r-1].setPosition(s[0],s[1],s[2]):i[r-1].setPosition(s[0],s[0],s[0])}o=localStorage.getItem(POINT_LIGHT_COLOR+r+""),o&&i[r-1].setColor(o),o=localStorage.getItem(POINT_LIGHT_INTENSITY+r+""),o&&i[r-1].setIntensity(parseFloat(o))}if(e)o=localStorage.getItem(PropertyConsts.LocalStorage.FLOOR_STYLE),o&&(floorStyle=o),o=localStorage.getItem(PropertyConsts.LocalStorage.FLOOR_SIZE),o&&(floorSize=o),o=localStorage.getItem(SHOW_FLOOR),o&&(showFloor=Utils.string2Boolean(o),showFloor||n.remove(viewFloor)),o=localStorage.getItem(ALL_VIEW_SELECTABLE),o&&(allViewSelectable=Utils.string2Boolean(o));else{if(o=localStorage.getItem(SHOW_PROPERTY_SHEET),Utils.isNotNull(o)?(showPropertySheet=Utils.string2Boolean(o),borderPane.setRight(showPropertySheet?sheetPane:null)):borderPane.setRight(null),o=localStorage.getItem(SHOW_TARGET_FLAG))var l=Utils.string2Boolean(o);if(o=localStorage.getItem(SHOW_ORIGINAL_FLAG))var d=Utils.string2Boolean(o);o=localStorage.getItem(SHOW_GRID),showGrid=Utils.isNotNull(o)?Utils.string2Boolean(o):!0,o=localStorage.getItem(PropertyConsts.SHOW_RULER_GUIDES),showRulerGuides=Utils.isNotNull(o)?Utils.string2Boolean(o):!1,o=localStorage.getItem(PropertyConsts.SHOW_RULER),showRuler=Utils.isNotNull(o)?Utils.string2Boolean(o):!0,a[0]instanceof GridNetwork&&setTimeout(function(){a[0].setShowGrid(0==showGrid?!1:!0)},100)}o=localStorage.getItem(ENABLE_SCALE),o&&(enableScale=Utils.string2Boolean(o)),o=localStorage.getItem(SHOW_AXIS),o&&(showAxis=Utils.string2Boolean(o)),o=localStorage.getItem(SHOW_AXIS_TEXT),o&&(showAxisText=Utils.string2Boolean(o)),o=localStorage.getItem(PropertyConsts.ENABLE_EASING),o&&(enableEasing=Utils.string2Boolean(o)),o=localStorage.getItem(SHOW_DIM),o&&(showDim=Utils.string2Boolean(o)),o=localStorage.getItem(SHOW_COORD),o&&(showCoord=Utils.string2Boolean(o)),e&&(o=localStorage.getItem(IS_FULL_ROTATION_COMPONENT),o&&(isFullRotation=Utils.string2Boolean(o),"undefined"!=typeof a[1]&&(isFullRotation?a[1].getInteractions()[1].yRistrict=!1:(a[1].getInteractions()[1].yRistrict=!0,reset4CCamera(6,3)))),o=localStorage.getItem(SCALE_MIN_LIMIT),o&&(scaleMinLimit=Utils.string2Float(o,.1)),o=localStorage.getItem(SCALE_MAX_LIMIT),o&&(scaleMaxLimit=Utils.string2Float(o,100)),o=localStorage.getItem(ZOOM_SPEED_COMPONENT),o&&(comZoomSpeed=parseFloat(o)),o=localStorage.getItem(ROTATE_SPEED_COMPONENT),o&&(comRotateSpeed=parseFloat(o)),o=localStorage.getItem(PAN_SPEED_COMPONENT),o&&(comPanSpeed=Utils.string2Float(o)),o=localStorage.getItem(MAX_DISTANCE_COMPONENT),o&&(comMaxDistance=parseFloat(o)),o=localStorage.getItem(MIN_DISTANCE_COMPONENT),o&&(comMinDistance=parseFloat(o)),o=localStorage.getItem(PropertyConsts.NEAR_PLANE_COMPONENT),o&&(comNearPlane=parseFloat(o)),o=localStorage.getItem(PropertyConsts.FAR_PLANE_COMPONENT),o&&(comFarPlane=parseFloat(o)),o=localStorage.getItem(PropertyConsts.FOV_COMPONENT),o&&(comFov=parseFloat(o))),e||(o=localStorage.getItem(IS_FULL_ROTATION),o&&(isFullRotation=Utils.string2Boolean(o),"undefined"!=typeof defaultInteraction&&(isFullRotation?defaultInteraction.yRistrict=!1:(defaultInteraction.yRistrict=!0,defaultInteraction.yLowerLimitAngle=-Math.PI/8,defaultInteraction.yUpLimitAngle=Math.PI/2))),o=localStorage.getItem(ZOOM_SPEED),o&&(zoomSpeed=parseInt(o)),o=localStorage.getItem(ROTATE_SPEED),o&&(rotateSpeed=parseInt(o)),o=localStorage.getItem(PAN_SPEED),o&&(panSpeed=Utils.string2Float(o)),o=localStorage.getItem(MAX_DISTANCE),o&&(maxDistance=parseInt(o)),o=localStorage.getItem(MIN_DISTANCE),o&&(minDistance=parseInt(o)),o=localStorage.getItem(PropertyConsts.NEAR_PLANE),o&&(nearPlane=parseFloat(o)),o=localStorage.getItem(PropertyConsts.FAR_PLANE),o&&(farPlane=parseFloat(o)),o=localStorage.getItem(PropertyConsts.FOV),o&&(fov=parseFloat(o)));var c=localStorage.getItem(e?"componentBackground":"roomBackground");if(a instanceof Array&&a.length)for(var r=0;r<a.length;r++){var h=a[r];if(h instanceof GridNetwork)Utils.checkPointFlag(h,targetFlagElement,l),Utils.checkPointFlag(h,originalFlagElement,d,PointFlag.ORIGINAL_POINT),h.invalidateElementVisibility();else if(h instanceof mono.Network3D&&(h.setShowAxis(showAxis),h.setShowAxisText(showAxisText),c&&h.setClearColor(c),Utils.isNotNull(enableEasing))){var u,g=h.getInteractions();g&&g.forEach(function(e){e instanceof mono.DefaultInteraction&&(u=e)}),u&&u.setEasing(enableEasing)}}},validateCloudKeyCallback:function(e,t,i,n){var a=JSON.parse(e);if(a.error)alert(a.error);else{var o=a.value;if(!o)return void alert("Cloud key is invalid");if(o.end_date){var r=new Date;if(Date.parse(o.end_date)-r<0)return void alert("Cloud key is past due")}localStorage.setItem(CLOUD_KEY,t),localStorage.setItem(CLOUD_PASSWORD,i),n?(accordion4C.clearAllCategories(),fillComponentCategoryView(),refreshComponentAccordion(accordion4C.getAccodion().getCurrentTitle())):(accordionPane.clearAllCategories(),fillCategoryView(),refreshAccordion(accordionPane.getAccodion().getCurrentTitle()))}},validateCloudKey:function(e,t,i,n){return e?void Utils.doLogin(e,t,this,n):void alert("Cloud key is required")},doLogin:function(e,t,i,n){var a={arguments:{username:e,password:t}};require(MONO_URL_LOGIN,a,n,i)},login:function(e,t,i,n){var a=new XMLHttpRequest;a.timeout=15e3,a.ontimeout=function(){n&&n.call(i,{error:"request timeout"})};var o=new FormData;o.append("username",e),o.append("password",t),a.open("post",MONO_URL_LOGIN,!0),a.withCredentials=!0,a.onreadystatechange=function(){4==a.readyState&&200==a.status&&n&&n.call(i,http.responseText)},a.send(o)},doLogout:function(){if(confirm("Logout?")){var e={arguments:{}};document.location.href="login.html",localStorage.setItem("mono-user",""),require(MONO_URL_LOGOUT,e)}},isNotNull:function(e){return void 0!==e&&"undefined"!==e&&null!==e&&"null"!==e&&""!==e},registerRandomImage:function(e,t){var i=new Image;i.src=Utils.RelativePath+t,i.crossOrigin="";i.onload=function(){twaver.Util.registerImage(e,i,i.width,i.height),i.onload=null}},handlerTexture:function(e,t,i){var n;if(Utils.isNotNull(e)){if(e instanceof Array){n=[];for(var a=0;a<e.length;a++){var o=Utils.handlerTexture(e[a],t,i);n.push(o)}}else"string"!=typeof e||e.startsWith("data:image")||e.startsWith("http")?n=e.startsWith("http")&&i&&e.indexOf("%")>=0?decodeURI(e):e:(n=Utils.RelativePath+e,t&&(n=PropertyConsts.MONO_IMG_PRE+n));return n}return n},scaleCanvas:function(e,t,i){var n=e.width,a=e.height;void 0==t&&(t=n),void 0==i&&(i=a);var o=a>n?n:a,r=n>o?(n-o)/2:0,s=a>o?(a-o)/2:0,l=document.createElement("canvas"),d=l.getContext("2d");return l.width=t,l.height=i,d.drawImage(e,r,s,o,o,0,0,t,i),l},checkLoadLocalImage:function(){try{var e=document.createElement("canvas"),t=new Image;t.src=Utils.getImageSrc("floor.png");var i=e.getContext("2d");i.fillStyle="#EEEEFF",i.fillRect(0,0,400,300),t.onload=function(){i.drawImage(t,0,0,100,100);try{i.getImageData(0,0,100,100)}catch(e){if(console.log(e),console.log(e.name),console.log(e.message),"SecurityError"===e.name&&(e.message.indexOf("the canvas has been tainted by cross-origin data")>=0||e.message.indexOf("SecurityError: DOM Exception 18")>=0)){var n="<div class='error_dialog'><span class='r_title'>Get cross-origin data</span><p>Your browser can not access local file and will get security error.<br>click <a href='http://twaver.servasoft.com/?p=7366' target='_blank'>twaver.servasoft.com</a> to get solution</p></div>";Utils.showDialog("errorDialog",n,"Warning",!1,!0,"loadimagedialog")}}}}catch(n){console.log(n)}},paintArrow:function(e,t,i,n,a,o){if(e&&t&&i){e.moveTo(t.x,t.y),e.lineTo(i.x,i.y);var r=i.x,s=i.y;a=a||10,o=o||5,n=n||"up",e.moveTo(r,s),"up"==n?(e.lineTo(r-a/2,s+o),e.lineTo(r+a/2,s+o)):"right"==n?(e.lineTo(r-o,s-a/2),e.lineTo(r-o,s+a/2)):"left"==n?(e.lineTo(r+o,s+a/2),e.lineTo(r+o,s-a/2)):"down"==n&&(e.lineTo(r+a/2,s-o),e.lineTo(r-a/2,s-o)),e.lineTo(r,s),e.fill()}},isTargetFlag:function(e){return e&&e instanceof TargetFlagNode&&e.getType()==PointFlag.TARGET_POINT},isOriginalFlag:function(e){return e&&e instanceof TargetFlagNode&&e.getType()==PointFlag.ORIGINAL_POINT},createSelectInput:function(e,t,i){if(e&&!(e.length<=0)){var n=document.createElement("select");t&&(i=i||"onchange",n[i]=t);for(var a=0;a<e.length;a++){var o=e[a],r=document.createElement("option");r.setAttribute("value",o),r.innerHTML=o,n.appendChild(r)}}},categoryCache:{},publicCategoryCache:{},initCategory:function(e,t,i,n){Object.getOwnPropertyNames(e).length<=0?Utils.getTemplateCategory(e,t,i,n):n&&n()},getTemplateCategory:function(e,t,i,n){function a(e,t,i){if(i.type&&i.type==PropertyConsts.TYPE_COMPONENT){var n=e[i.type];n||(e[i.type]=n={})}if(n){var a=n[t];a||(n[t]=a={})}else{var a=e[t];a||(e[t]=a={})}if(a.children?a.children.push(i):a.children=[i],i.type&&i.type==PropertyConsts.TYPE_COMPONENT&&t==PropertyConsts.TYPE_ROOTCATEGORY){var o=e[t];o||(e[t]=o={}),o.children?o.children.push(i):o.children=[i]}return a}var o={};Utils.isNotNull(i)&&(o.scope=i);var r={module:t,method:"search",arguments:o},s=function(){if(1===arguments.length){var t=JSON.parse(arguments[0]);if(t.error)return void alert(t.error);for(var i=t.value,o=0;o<i.length;o++){var r=i[o];r.type&&r.type==PropertyConsts.TYPE_COMPONENT&&(e[r.type]||(e[r.type]={}),e[r.type][r.id]=r),e[r.id]=r}for(var o=0;o<i.length;o++){var r=i[o];r.parent_id?a(e,r.parent_id,r):a(e,PropertyConsts.TYPE_ROOTCATEGORY,r)}n&&n()}};require(MONO_URL,r,s,this)},requestMono:function(e,t,i){require(MONO_URL,e,t,i)},stopPropagation:function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},convert2Radian:function(e){return e*Math.PI/180},convert2Angle:function(e){return 180*e/Math.PI},showLoginDialog:function(){var e=[{label:"Cloud Key:",id:"key"},{label:"Cloud Password:",type:"password",id:"password"}];Utils.showInputDialog(e,"Login",!0,function(){var e=document.getElementById("key").value,t=document.getElementById("password").value;Utils.validateCloudKey(e,t,!1,function(i){var n=JSON.parse(i);if(n.error)alert(n.error);else{var a=n.value;a?Date.parse(a.end_date)-new Date<0?alert("Cloud key is past due"):(localStorage.setItem(LOAD_RESOURCE_TYPE,TYPE_CLOUD),localStorage.setItem(CLOUD_KEY,e),localStorage.setItem(CLOUD_PASSWORD,t)):alert("Cloud key is invalid")}location.reload()})},this)},generateAssembleId:function(e){return e=e||mono.Math.generateUUID()},setButtonsStyle:function(e,t){if(e)for(var i=0;i<e.length;i++)if(e[i]!==t){var n=document.getElementById(e[i]);n.setAttribute("class",e[i])}else{var a=document.getElementById(t);a.setAttribute("class",t+"_hover")}},createLinkHandle:function(e){var t=e.getSelectionModel().getSelection();if(!(2!=t.size()||t.get(0)instanceof mono.Link||t.get(1)instanceof mono.Link)){var i=[{label:"Link Style:",id:"linkStyle",type:"select",options:PropertyConsts.LINK_STYPE,value:"orthogonal.y"},{label:"Link Color:",id:"linkColor",value:"blue"},{label:"Link Size:",id:"linkSize",value:5},{label:"Link Extend:",id:"linkExtend",value:0},{label:"Link point data:",id:"linkPoints",tab:"Link Points",type:"textArea",readonly:!1,value:""}];this.showInputDialog(i,"Link Properties",!0,this.createLinkDialogHandle,this,[e],!0)}},createLinkDialogHandle:function(e,t){var i=e.getSelectionModel().getSelection(),n=new TGL.Link(i.get(0),i.get(1));if(n.setExtend(parseFloat(t.linkExtend)),n.setLinkType(t.linkStyle),n.s({"m.color":t.linkColor,"m.linewidth":parseFloat(t.linkSize)}),"control"==t.linkStyle&&t.linkPoints){for(var a=t.linkPoints.toString().replace(/\s/g,",").replace(/\r\n/g,","),o=a.split(","),r=[],s=0;s<o.length;s+=3)isNaN(parseFloat(o[s]))||r.push(new TGL.Vec3(parseFloat(o[s]),parseFloat(o[s+1]),parseFloat(o[s+2])));n.setControls(r)}e.add(n)},scale3DElement:function(e,t){var i=e.getPosition().clone();e.setPosition(i.x*t,i.y*t,i.z*t);var n=e.getClassName();switch(n=n.replace("TGL.","mono.")){case"mono.Cube":e.setWidth(e.getWidth()*t),e.setHeight(e.getHeight()*t),e.setDepth(e.getDepth()*t);break;case"mono.Sphere":e.setRadius(e.getRadius()*t);break;case"mono.Cylinder":e.setRadiusTop(e.getRadiusTop()*t),e.setRadiusBottom(e.getRadiusBottom()*t),e.setHeight(e.getHeight()*t);break;case"mono.Torus":e.setRadius(e.getRadius()*t),e.setTube(e.getTube()*t);break;case"mono.Billboard":var a=e.getScale();e.setScale(a.x*t,a.y*t,1);break;case"mono.PathNode":e.setRadius(e.getRadius()*t);var o=e.getPath(),r=o.toArray(),s=Utils._createPath(r,t);e.setPath(s);break;case"mono.TextNode":var l=e.getScale();e.setHeight(e.getHeight()*t),e.setScale(l.x*t,l.y*t,l.z*t);break;case"mono.ComboNode":var d=e.getCombos(),c=e.getStyle("m.texture.image",!0),h=e.getStyle("m.texture.repeat",!0),u=[];for(var g in d)Utils.scale3DElement(d[g],t),u.push(d[g]);e.setCombos(u),e.setStyle("m.texture.image",c),e.setStyle("m.texture.repeat",h);break;case"mono.LatheNode":var o=e.getPath(),r=o.toArray(),s=Utils._createPath(r,t);e.setPath(s);break;case"mono.Entity":}}};var rotateSelectedObject=function(e){for(var t=box.getNodes().toArray(),i=t.length,n=0;i>n;n++){var a=t[n];a.isSelected()&&a.setRotationZ(a.getRotation().z+e)}};$rSelected=rotateSelectedObject;var groupObjects=function(){var e=box.getSelectionModel().getSelection(),t=e.size();if(0===t)alert("Select one or more objects.");else{var i="";1===t&&(i=e.get(0).getGroupId());for(var n=window.prompt("Group ID:",i),a=0;t>a;a++){var o=e.get(a);o.setGroupId(n)}}};$group=groupObjects;var align3DObjects=function(e){var t=[];t.push();var i=[{label:"Select align pattern:",id:"group_on_ground",name:"align",type:"radio",checked:!0,inner:'<img src="'+Utils.Path+'../images/align_group_on_ground.png" />   Group align on ground'},{label:"",id:"group_under_ground",name:"align",type:"radio",checked:!1,inner:'<img src="'+Utils.Path+'../images/align_group_under_ground.png" />   Group align under ground'},{label:"",id:"on_ground",name:"align",type:"radio",checked:!1,inner:'<img src="'+Utils.Path+'../images/align_on_ground.png" />   Align on ground'},{label:"",id:"under_ground",name:"align",type:"radio",checked:!1,inner:'<img src="'+Utils.Path+'../images/align_under_ground.png" />   Align under ground'},{label:"",id:"center",name:"align",type:"radio",checked:!1,inner:'<img src="'+Utils.Path+'../images/align_center_3d.png" />   Align center'},{label:"",id:"top",name:"align",type:"radio",checked:!1,inner:'<img src="'+Utils.Path+'../images/align_top_3d.png" />   Align top'},{label:"",id:"bottom",name:"align",type:"radio",checked:!1,inner:'<img src="'+Utils.Path+'../images/align_bottom_3d.png" />   Align bottom'}];Utils.showInputDialog(i,"Align Pattern",!0,handleAlign3DObjectsOption,this,[e])},handleAlign3DObjectsOption=function(e,t){for(var i=(t.group_on_ground||t.group_under_ground,new Array),n=e.getSelectionModel().getSelection(),a=n.size(),o=0;a>o;o++){var r=n.get(o);i.push(r)}var s,l;if(i.length>0)for(var o=0;o<i.length;o++){var r=i[o];if(r&&!r.getParent()){var d=r.getWorldBoundingBox();d&&(t.under_ground&&r.setPositionY(r.getPosition().y-d.max.y),t.on_ground&&r.setPositionY(r.getPosition().y-d.min.y),(!s||s<d.max.y)&&(s=d.max.y),(!l||l>d.min.y)&&(l=d.min.y))}}if(!t.under_ground&&!t.on_ground&&(s||l)&&i.length>0)for(var o=0;o<i.length;o++){var r=i[o];if(r&&!r.getParent()){if(t.top){var c=s-r.getWorldBoundingBox().max.y;r.setPositionY(r.getPosition().y+c)}if(t.group_under_ground&&r.setPositionY(r.getPosition().y-s),t.bottom){var c=r.getWorldBoundingBox().min.y-l;r.setPositionY(r.getPosition().y-c)}t.group_on_ground&&r.setPositionY(r.getPosition().y-l),t.center&&r.setPositionY((s+l)/2)}}};$align3d=align3DObjects;var layout3DObjects=function(){var e=[];e.push();var t=[{label:"Select layout pattern:",id:"star",name:"layout",type:"radio",checked:!0,inner:'<img src="'+Utils.Path+'../images/align_group_on_ground.png" />   Star layout'}];Utils.showInputDialog(t,"Layout Pattern",!0,handleLayout3DObjectsOption,this,[box])},handleLayout3DObjectsOption=function(e,t){for(var i=(t.group_on_ground||t.group_under_ground,new Array),n=e.getSelectionModel().getSelection(),a=n.size(),o=0;a>o;o++){var r=n.get(o);r.getParent()||i.push(r)}var s,l,d,c=new mono.Vec3(0,1,0);if(i.length>0)for(var o=0;o<i.length;o++){var r=i[o];if(r&&!r.getParent()){r.setRotation(0,0,0),0==o&&(s=r.getPosition().x,l=r.getPosition().y,d=r.getPosition().z),r.setPosition(s,l,d);var h=r.getWorldBoundingBox();if(h){var u=h.max.x-h.min.x;if(r.setPositionX(r.getPosition().x+u/2),o>0){var g=2*Math.PI/i.length*o;r.rotateFromAxis(c,new mono.Vec3(s-r.getPosition().x,l-r.getPosition().y,d-r.getPosition().z),g)}}}}};$layout3d=layout3DObjects;var comboSelectedObjects=function(e){for(var t=new Array,i=box.getSelectionModel().getSelection(),n=i.size(),a=0;n>a;a++){var o=i.get(a);t.push(o)}comboObjects(t,e)};$combo=comboSelectedObjects;var comboObjects=function(e,t){if(e.length>1){for(var i=[],n=1;n<e.length;n++)i.push(t);for(var a=new mono.ComboNode(e,i),n=0;n<e.length;n++){var o=e[n];box.remove(o)}Utils.setComboCentralized(a),box.add(a)}};Utils.setComboCentralized=function(e){if(e){e.setCentralized(!0);var t=e.getOffsetPosition(),i=e.getPosition();t&&e.setPosition(i.x+t.x,i.y+t.y,i.z+t.z)}};var showAboutDialog=function(){var e=(new Date).getFullYear(),t="<div id = 'about' class='mar' style='margin-top:0px;'><p>MONO DESIGN is a TWaver online 2D/3D modelling tool.</p><br><p>Visit our website to get more information:</p><p><a href='http://twaver.servasoft.com'>twaver.servasoft.com</a></p><p><a href='http://doc.servasoft.com/'>doc.servasoft.com</a></p><br><p>Contact us:<a href='mailto:info@servasoftware.com'>info@servasoftware.com</a></p><br><p>&copy; Copyright "+e+" <b>Serva Software LLC.</b> All rights reserved.</p><br></div>";Utils.showDialog("dialog-about",t,"About MONO DESIGN "+Utils.getVersion(),!0,!1)};$showabout=showAboutDialog;var createInputButton=function(e,t,i,n,a,o,r){var s=document.createElement("input");t&&(s.id=t),s.setAttribute("type","button"),i&&s.setAttribute("class",i),n&&s.setAttribute("title",n),a&&s.setAttribute("onclick",a),r&&s.setAttribute("onmousedown",r),o&&s.setAttribute("ondblclick",o),e.appendChild(s)};Utils.getUnPredefinedFloorLayers=function(e){var t=new twaver.List;return e.getLayerBox().getRoots().forEach(function(e){e.getClient("floorLayer")&&!e.getClient("predefined")&&t.add(e)}),t},Utils.addInteractionComboBox=function(e,t){var i=twaver.Util.isTouchable?["Touch","None"]:["Default-Lazy","Edit-Live"],n=function(){"Default-Lazy"===this.value?(allNetworks[2].setDefaultInteractions(!0),allNetworks[2]._lazyMoveAnimate=null):"Edit-Live"===this.value&&allNetworks[2].setEditInteractions()};Utils.addComboBox(e,i,n,t)},Utils.addComboBox=function(e,t,i,n){var a=document.createElement("select");return a.style.verticalAlign="top",a.setAttribute("class","combobox-comp"),t.forEach(function(e){var t=document.createElement("option");t.appendChild(document.createTextNode(e)),t.setAttribute("value",e),a.appendChild(t)}),i&&a.addEventListener("change",i,!1),n&&(a.value=n),e.appendChild(a),a},Utils.getLayerByFloorName=function(e,t){var i=null;return e.forEach(function(e){return e.getClient("floorName")==t?void(i=e):void 0}),i},Utils.createProgressBar=function(e,t){var i=document.createElement("div");i.style.width=e+"px",i.style.height=t+"px",i.style.position="absolute";for(var n=1;8>=n;n++){var a=document.createElement("div");a.className="blockG",a.id="rotateG_0"+n,i.appendChild(a)}return i},Utils.createToolTipDiv=function(e,t){if(0/0!=parseInt(e)&&0/0!=parseInt(t)){e=parseInt(e),t=parseInt(t);var i=document.createElement("div");i.style.width=e+"px",i.style.height=t+"px",i.style.zIndex="1001",i.style.display="none",i.id="toolTipId",i.setAttribute("class","bubble arrow"),i.style.backgroundColor="#FCFBF7",i.style.backgroundImage="url(images/loading.png)",i.style.backgroundRepeat="no-repeat",document.body.appendChild(i);var n=document.createElement("span");n.id="toolTipTextId",n.innerHTML="",n.style.color="rgb(240,120,25)",n.style.fontSize="11px",n.style.position="absolute",n.style.top="3px",n.style.left="5px",n.style.width="205px",i.appendChild(n)}},Utils.addNumberCommas=function(e){e+="",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var t=/(\d+)(\d{3})/;t.test(x1);)x1=x1.replace(t,"$1,$2");return x1+x2},Utils.loginMONO=function(e,t){if(!e||!t)return void alert("username and password is required");var i=new XMLHttpRequest,n=new FormData;n.append("username",e),n.append("password",t),i.open("post","https://mono-design.cn/login",!0),i.withCredentials=!0,i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var t=JSON.parse(i.responseText);t.error?alert(t.error):(localStorage.setItem("mono-user",e),localStorage.setItem("loadResource","cloud"))}},i.send(n)},Utils.setupLogout=function(){var e=document.getElementById("main_toolbar");if(e){var t=localStorage.getItem("mono-user");e.innerHTML+=null==t?'<img src="images/user.png"><a href="login.html"> Login</a>':'<img src="images/user.png"><a id="user" href="#" onclick="Utils.showUserProfile();" title="Click show your profile">'+t+'</a> | <a id="logout" href="#" onclick="Utils.doLogout();">Logout</a>'}},Utils.ready=function(e){return"complete"==document.readyState?e():void(window.addEventListener?window.addEventListener("load",e,!1):window.attachEvent?window.attachEvent("onload",e):window.onload=e)},Utils.ready(function(){Utils.setupLogout()}),Utils.showUserProfile=function(){var e=(localStorage.getItem("mono-user"),{arguments:{},method:"getSelf",module:"users"});require(MONO_URL,e,Utils.showUserProfileDialog)},Utils.publishTemplate=function(e,t,i){var n=(localStorage.getItem("mono-user"),{arguments:{template_id:e,category_id:i},method:"publish",module:"templates"});require(MONO_URL,n,function(){var e='Template "'+t+'" has been published successfully.';alert(e)})},Utils.unpublishTemplate=function(e,t,i){var n=(localStorage.getItem("mono-user"),{arguments:{template_id:e,category_id:i},method:"unpublish",module:"templates"});require(MONO_URL,n,function(){var e='Template "'+t+'" has been unpublished successfully.';alert(e)})},Utils.showUserProfileDialog=function(e){var t=JSON.parse(e),i=t.value,n=[{label:"User:",id:"user",readonly:!0,value:i.user,editable:!1},{label:"Valid From:",id:"start_date",readonly:!0,value:Utils.formatDate(i.start_date),editable:!1},{label:"Valid Thru:",id:"end_date",readonly:!0,value:Utils.formatDate(i.end_date),editable:!1},{label:"Old Password:",id:"old_password",readonly:!1,type:"password",value:"",editable:!0},{label:"New Password:",id:"password",readonly:!1,type:"password",value:"",editable:!0},{label:"Confirm Password:",id:"password2",readonly:!1,type:"password",value:"",editable:!0}],a=function(e){if(e.password!=e.password2)return void alert("New password and confirm password do not match");if(!e.password||e.length<8)return void alert("New password should at least 8 characters");var t={module:"users",method:"changepw",arguments:{old_password:e.old_password,new_password:e.password}};require(MONO_URL,t,function(){alert("New password has been set up")})};Utils.showInputDialog(n,"User Profile",!0,a,this,[],null,null)},Utils.formatDate=function(e){if(e){var t=Date.parse(e),i=new Date(t),n=new Date(i).format("yyyy-MM-dd");return n}return""},Utils.setPolygonOffset=function(e,t,i){var n="m.polygonOffset";if(i&&(n=i+"."+n),e){var a=n+"Factor",o=n+"Units";e.setStyle(n,!0),e.setStyle(a,1),e.setStyle(o,t)}},Utils.updateBoxInfo=function(e){if(!e.batch){var t=document.getElementById("boxInfo");if(t){for(var i=e.getDatas().toArray(),n=0,a=0,o=0;o<i.length;o++){var r=i[o];if(r.faces){if(r.getClient(PropertyConsts.COMPONENTFLOOR))continue;a+=r.faces.length,n++}}n=Utils.addNumberCommas(n),a=Utils.addNumberCommas(a),t.innerHTML="Objects: "+n+"<br>Faces: "+a}}},Utils.updateFpsInfo=function(e,t){var i=document.getElementById("fpsInfo");i&&(i.innerHTML="FPS: "+e+"<br>TPF: "+t+" ms")},Utils.setupEightLights=function(e,t){t=t||5e3;for(var i=.5,n=[[1,1,1],[-1,1,1],[1,1,-1],[-1,1,-1],[1,-1,1],[-1,-1,1],[1,-1,-1],[-1,-1,-1]],a=0;a<n.length;a++){var o=n[a][0]*t,r=n[a][1]*t,s=n[a][2]*t,l=new mono.PointLight(16777215,i);
l.setPosition(o,r,s),e.add(l)}},Utils.createNetworkInfoTag=function(e,t,i){var n=document.createElement("span");n.innerHTML="",n.style.position="absolute",n.style.left="2px",n.style.background="transparent",n.style.width="200px",n.style.top=i,n.style.color="#AAAAAA",n.setAttribute("id",t),e.appendChild(n)},Utils.setupNetworkInfoTags=function(e){var t=document.createElement("div");Utils.createNetworkInfoTag(t,"boxInfo","0px"),Utils.createNetworkInfoTag(t,"fpsInfo","25px"),t.setAttribute("class","network3d-boxinfo"),e.getRootView().appendChild(t)},Utils.createToggleImage=function(e,t,i){i=i||document.body;var n=document.createElement("div");n.setAttribute("class",e),i.appendChild(n);var a=document.createElement("div");return a.setAttribute("class",t),a.style.display="block",n.appendChild(a),a},Utils.createLeftToggleImage=function(e,t,i){var n=Utils.createToggleImage("hidden-left-div","left-expand-img",i);n.onclick=function(){var i=document.getElementsByClassName("hidden-left-div")[0];"left-expand-img"==this.getAttribute("class")?(this.setAttribute("class","left-expand-img left-collapse-img"),i.setAttribute("class","hidden-left-div hidden-left-collapse-div"),e()):(i.setAttribute("class","hidden-left-div"),this.setAttribute("class","left-expand-img"),t())}},Utils.createTopToggleImage=function(e,t,i){var n=Utils.createToggleImage("hidden-top-div","top-expand-img",i);n.onclick=function(){var i=document.getElementsByClassName("hidden-top-div")[0],n=document.getElementById("menubar");"top-expand-img"==this.getAttribute("class")?(this.setAttribute("class","top-expand-img top-collapse-img"),i.setAttribute("class","hidden-top-div hidden-top-collapse-div"),n.style.display="none",e()):(i.setAttribute("class","hidden-top-div"),this.setAttribute("class","top-expand-img"),n.style.display="block",t())}},Utils.isMainNode=function(e){var t=!1;return e&&e.getClient&&Utils.isNotNull(e.getClient("mainVisible"))&&0==e.getClient("mainVisible")&&(t=!0),t},Utils.setBox3DSelectStyle=function(e,t){e.forEach(function(e){e instanceof mono.Entity&&Utils.setElementSelectStyle(e,t)})},Utils.setElementSelectStyle=function(e,t){t==PropertyConsts.SELECT_STYLE.WIREFRAME?e.setStyle("select.style","outline.wireframe"):t==PropertyConsts.SELECT_STYLE.NORMAL?e.setStyle("select.style","outline.normal"):t==PropertyConsts.SELECT_STYLE.BORDER&&e.setStyle("select.style","border")},Utils.setElementCustomProps=function(e,t,i){var n=t.getClient(CUSTOM_PROPS);if(n)for(var a in n){var o=n[a];void 0==i[o]&&t.setClient(o,null)}if(i){var r;for(var a in i)r=i[a],t.setClient(r,e.getClient(r));t.setClient(CUSTOM_PROPS,i)}},Utils.isFloorVisibleByFloorName=function(e,t){var i=!0;return t.forEach(function(t){return t.getClient("floorName")==e?i=t.getClient("floorVisible"):void 0}),i},Utils.transforAndScaleCanvasContext=function(e,t){var i=e.getContext("2d");if(!t&&e.isTransfor&&e.width&&e.height)return i;if(devicePixelRatio=window.devicePixelRatio||1,backingStoreRatio=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,ratio=devicePixelRatio/backingStoreRatio,devicePixelRatio!==backingStoreRatio){var n=e.width,a=e.height;e.width=n*ratio,e.height=a*ratio,e.style.width=n+"px",e.style.height=a+"px",i.scale(ratio,ratio)}return e.width&&e.height&&(e.isTransfor=!0),i},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},Number.prototype.format=function(e,t,i,n){var a="\\d(?=(\\d{"+(t||3)+"})+"+(e>0?"\\D":"$")+")",o=this.toFixed(Math.max(0,~~e));return(n?o.replace(".",n):o).replace(new RegExp(a,"g"),"$&"+(i||","))},mono.Toolkits={},mono.Toolkits.loadGraph=function(e,t,i,n){return modelManager.loadGraph(e,t,i,n)},mono.Toolkits.loadTemplateByName=function(e,t,i,n,a){modelManager.loadTemplateFromCloud(e,t,i,a)},mono.Toolkits.loadTemplateById=function(e,t,i,n,a){modelManager.loadCloudTemplateById(e,t,i,n,a)},mono.Toolkits.loadGraphUrl=function(e,t,i,n,a,o){modelManager.loadGraphUrl(e,t,i,n,a,o)},mono.Toolkits.loadGraphDatas=function(e){return modelManager.loadGraphDatas(e)},mono.Toolkits.exportGraph=function(e){return modelManager.serializeGraphInfo(e,!0)},mono.Toolkits.loadTemplate=function(e,t,i){return modelManager.loadComponentTemplateFromContents(e,t,i,!1)},mono.Toolkits.loadTemplateUrl=function(e,t,i,n,a){modelManager.loadComponentTemplateFromURL(e,t,i,n,a)},mono.Toolkits.login=function(e,t,i,n){Utils.login(e,t,i,n)}+function(e,t){mono.LoadingManager=function(e,i,n){var a=this,o=0,r=0;this.onLoad=e,this.onProgress=i,this.onError=n,this.itemStart=function(){r++},this.itemEnd=function(e){o++,a.onProgress!==t&&a.onProgress(e,o,r),o===r&&a.onLoad!==t&&a.onLoad()}},mono.DefaultLoadingManager=new mono.LoadingManager,mono.ImageLoader=function(e){this.manager=e!==t?e:mono.DefaultLoadingManager},mono.ImageLoader.prototype={constructor:mono.ImageLoader,load:function(e,i,n,a){var o=this,r=document.createElement("img");return i!==t&&r.addEventListener("load",function(){o.manager.itemEnd(e),i(this)},!1),n!==t&&r.addEventListener("progress",function(e){n(e)},!1),a!==t&&r.addEventListener("error",function(e){a(e)},!1),this.crossOrigin!==t&&(r.crossOrigin=this.crossOrigin),r.src=e,o.manager.itemStart(e),r},loadFile:function(e,i,n,a){var o=this,r=new FileReader;i!==t&&(r.onload=function(){i(r.result),o.manager.itemEnd(e.name)}),n!==t&&r.addEventListener("progress",function(e){n(e)},!1),a!==t&&r.addEventListener("error",function(e){a(e)},!1),r.readAsDataURL(e),o.manager.itemStart(e.name)},setCrossOrigin:function(e){this.crossOrigin=e}},mono.XHRLoader=function(e){this.manager=e!==t?e:mono.DefaultLoadingManager},mono.XHRLoader.prototype={constructor:mono.XHRLoader,load:function(e,i,n,a){var o=this,r=new XMLHttpRequest;i!==t&&r.addEventListener("load",function(t){i(t.target.responseText),o.manager.itemEnd(e)},!1),n!==t&&r.addEventListener("progress",function(e){n(e)},!1),a!==t&&r.addEventListener("error",function(e){a(e)},!1),this.crossOrigin!==t&&(r.crossOrigin=this.crossOrigin),r.open("GET",e,!0),r.send(null),o.manager.itemStart(e)},loadFile:function(e,i,n,a){if(e){var o=this,r=new FileReader;i!==t&&(r.onload=function(){i(r.result),o.manager.itemEnd(e.name)}),n!==t&&r.addEventListener("progress",function(e){n(e)},!1),a!==t&&r.addEventListener("error",function(e){a(e)},!1),r.readAsText(e),o.manager.itemStart(e.name)}},setCrossOrigin:function(e){this.crossOrigin=e}},mono.MTLLoader=function(e,t,i){this.baseUrl=e,this.options=t,this.crossOrigin=i},mono.extend(mono.MTLLoader,null,{constructor:mono.MTLLoader,load:function(e,t){var i=this,n=new mono.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(e))})},loadFile:function(e,t){var i=this,n=new mono.XHRLoader;n.loadFile(e,function(e){t(i.parse(e))})},parse:function(e){for(var t=e.split("\n"),i={},n=/\s+/,a={},o=0;o<t.length;o++){var r=t[o];if(r=r.trim(),0!==r.length&&"#"!==r.charAt(0)){var s=r.indexOf(" "),l=s>=0?r.substring(0,s):r;l=l.toLowerCase();var d=s>=0?r.substring(s+1):"";if(d=d.trim(),"newmtl"===l)i={name:d},a[d]=i;else if(i)if("ka"===l||"kd"===l||"ks"===l){var c=d.split(n,3);i[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else i[l]=d}}var h=new mono.MTLLoader.MaterialCreator(this.baseUrl,this.options);return h.setMaterials(a),h}}),mono.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:mono.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:mono.RepeatWrapping},mono.extend(mono.MTLLoader.MaterialCreator,mono.EventDispatcher,{constructor:mono.MTLLoader.MaterialCreator,setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var n=e[i],a={};t[i]=a;for(var o in n){var r=!0,s=n[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(r=!1);break;case"d":this.options&&this.options.invertTransparency&&(s=1-s)}r&&(a[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return this.materials[e]===t&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,i=this.materialsInfo[e],n={name:e,side:this.side};for(var a in i){var o=i[a];switch(a.toLowerCase()){case"kd":n.diffuse=(new mono.Color).setRGB(o[0],o[1],o[2]);break;case"ka":n.ambient=(new mono.Color).setRGB(o[0],o[1],o[2]);break;case"ks":n.specular=(new mono.Color).setRGB(o[0],o[1],o[2]);break;case"map_kd":"string"==typeof this.baseUrl?(n.map=this.baseUrl+o,n.map.wrapS=this.wrap,n.map.wrapT=this.wrap):"object"==typeof this.baseUrl&&(o.indexOf(".")>0&&(o=o.substring(0,o.indexOf(".")).toLowerCase()),this.baseUrl[o]&&(n.map=this.baseUrl[o],n.map.wrapS=t.wrap,n.map.wrapT=t.wrap));break;case"ns":n.shininess=o;break;case"d":1>o&&(n.transparent=!0,n.opacity=o)}}return n.diffuse&&(n.ambient||(n.ambient=n.diffuse),n.color=n.diffuse),this.materials[e]=n,this.materials[e]},loadTexture:function(e,t,i,n){var a=/\.dds$/i.test(e);if(a)var o=mono.ImageUtils.loadCompressedTexture(e,t,i,n);else{var r=new Image,o=new mono.Texture(r,t),s=new mono.ImageLoader;s.crossOrigin=this.crossOrigin,s.load(e,function(e){o.image=mono.MTLLoader.ensurePowerOfTwo_(e),o.needsUpdate=!0,i&&i(o)})}return o}}),mono.MTLLoader.ensurePowerOfTwo_=function(e){if(!mono.MTLLoader.isPowerOfTwo_(e.width)||!mono.MTLLoader.isPowerOfTwo_(e.height)){var t=document.createElement("canvas");t.width=mono.MTLLoader.nextHighestPowerOfTwo_(e.width),t.height=mono.MTLLoader.nextHighestPowerOfTwo_(e.height);var i=t.getContext("2d");return i.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},mono.MTLLoader.isPowerOfTwo_=function(e){return 0===(e&e-1)},mono.MTLLoader.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1},mono.OBJLoader=function(e){this.manager=e!==t?e:mono.DefaultLoadingManager},mono.extend(mono.OBJLoader,Object,{constructor:mono.ObJLoader,load:function(e,t){var i=this,n=new mono.XHRLoader(i.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(e))})},parse:function(e){function i(e,t,i){return new mono.Vec3(e,t,i)}function n(e,t){return new mono.Vec2(e,t)}function a(e,t,i,n){return new mono.Face3(e,t,i,n)}function o(e,i,n,o){l.faces.push(o===t?a(parseInt(e)-(h+1),parseInt(i)-(h+1),parseInt(n)-(h+1)):a(parseInt(e)-(h+1),parseInt(i)-(h+1),parseInt(n)-(h+1),[g[parseInt(o[0])-1].clone(),g[parseInt(o[1])-1].clone(),g[parseInt(o[2])-1].clone()]))}function r(e,t,i){l.uvs.push([m[parseInt(e)-1].clone(),m[parseInt(t)-1].clone(),m[parseInt(i)-1].clone()])}function s(e,i,n){e[3]===t?(o(e[0],e[1],e[2],n),i!==t&&i.length>0&&r(i[0],i[1],i[2])):(n!==t&&n.length>0?(o(e[0],e[1],e[3],[n[0],n[1],n[3]]),o(e[1],e[2],e[3],[n[1],n[2],n[3]])):(o(e[0],e[1],e[3]),o(e[1],e[2],e[3])),i!==t&&i.length>0&&(r(i[0],i[1],i[3]),r(i[1],i[2],i[3])))}var l,d,c=new mono.Element,h=0;/^o /gm.test(e)===!1&&(l=new mono.Entity,d=new mono.BasicMaterial,l.setStyle("m.type","phong"),c.addChild(l));for(var u=0,g=[],m=[],p=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,f=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,v=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,y=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,b=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,C=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,w=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,S=e.split("\n"),x=0;x<S.length;x++){var I=S[x];I=I.trim();var P;if(0!==I.length&&"#"!==I.charAt(0))if(null!==(P=p.exec(I)))l.vertices.push(i(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])));else if(null!==(P=f.exec(I)))g.push(i(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])));else if(null!==(P=v.exec(I)))m.push(n(parseFloat(P[1]),parseFloat(P[2])));else if(null!==(P=y.exec(I)))s([P[1],P[2],P[3],P[4]]);else if(null!==(P=b.exec(I)))s([P[2],P[5],P[8],P[11]],[P[3],P[6],P[9],P[12]]);else if(null!==(P=C.exec(I)))s([P[2],P[6],P[10],P[14]],[P[3],P[7],P[11],P[15]],[P[4],P[8],P[12],P[16]]);else if(null!==(P=w.exec(I)))s([P[2],P[5],P[8],P[11]],[],[P[3],P[6],P[9],P[12]]);else if(/^o /.test(I))l!==t&&(h+=l.vertices.length),l=new mono.Entity,d=new mono.BasicMaterial,l.setStyle("m.type","phong"),l._name=I.substring(2).trim(),c.addChild(l),u=0;else if(/^g /.test(I));else if(/^usemtl /.test(I)){I.substring(7).trim()}else/^mtllib /.test(I)||/^s /.test(I)}for(var x=0,_=c._childList._as.length;_>x;x++){var l=c._childList._as[x];l.computed=!1,l.computeNodeData(),l.computeCentroids(),l.computeFaceNormals(),l.computeBoundingSphere()}return c}}),mono.OBJMTLLoader=function(){},mono.extend(mono.OBJMTLLoader,mono.MTLLoader,{constructor:mono.OBJMTLLoader,load:function(e,t,i,n){var a=this,o=new mono.MTLLoader(i);o.load(t,function(t){var i=t;i.preload();var o=new mono.XHRLoader(a.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(e){for(var t=a.parse(e),o=0;o<t._childList._as.length;o++){var r=t._childList._as[o];if(r.mname){var s=i.create(r.mname);r.setStyle("m.texture.image",s.map),r.setStyle("m.ambient",s.ambient),r.setStyle("m.diffuse",s.diffuse),r.setStyle("m.specular",s.specular),r.setStyle("m.color",s.color)}for(var l=0;l<r._childList._as.length;l++){var d=r._childList._as[l];if(d.mname){var c=i.create(d.mname);d.setStyle("m.texture.image",c.map),d.setStyle("m.ambient",c.ambient),d.setStyle("m.diffuse",c.diffuse),d.setStyle("m.specular",c.specular),d.setStyle("m.color",c.color)}}}n(t)})})},loadFiles:function(e,t,i,n){var a=this,o=new mono.MTLLoader(i);o.loadFile(t,function(t){var i=t;i.preload();var o=new mono.XHRLoader(a.manager);o.loadFile(e,function(e){for(var t=a.parse(e),o=0;o<t._childList._as.length;o++){var r=t._childList._as[o];if(r.mname){var s=i.create(r.mname);a.loadTexture(r,s.map),r.setStyle("m.ambient",s.ambient),r.setStyle("m.diffuse",s.diffuse),r.setStyle("m.specular",s.specular),r.setStyle("m.color",s.color)}for(var l=0;l<r._childList._as.length;l++){var d=r._childList._as[l];if(d.mname){var c=i.create(d.mname);a.loadTexture(d,c.map),d.setStyle("m.ambient",c.ambient),d.setStyle("m.diffuse",c.diffuse),d.setStyle("m.specular",c.specular),d.setStyle("m.color",c.color)}}}n(t)})})},loadTexture:function(e,t){if(e&&t){var i=new mono.ImageLoader;i.loadFile(t,function(t){e.setStyle("m.texture.image",t)})}},parse:function(e,i){function n(e,t,i){return new mono.Vec3(e,t,i)}function a(e,t){return new mono.Vec2(e,t)}function o(e,t,i,n){return new mono.Face3(e,t,i,n)}function r(e,i){if(m.length>0&&(g.vertices=m,g.computed=!1,g.computeCentroids(),g.computeFaceNormals(),g.computeBoundingSphere(),g.faces.length>0)){var n=g._name;u.addChild(g),g=new mono.Entity,g._name=n,g.setStyle("m.type","phong"),p=0}e!==t&&(g._name=e),i!==t&&(g.mname=i)}function s(e,i,n,a){g.faces.push(a===t?o(parseInt(e)-(c+1),parseInt(i)-(c+1),parseInt(n)-(c+1)):o(parseInt(e)-(c+1),parseInt(i)-(c+1),parseInt(n)-(c+1),[f[parseInt(a[0])-1].clone(),f[parseInt(a[1])-1].clone(),f[parseInt(a[2])-1].clone()]))}function l(e,t,i){g.uvs.push([v[parseInt(e)-1].clone(),v[parseInt(t)-1].clone(),v[parseInt(i)-1].clone()])}function d(e,i,n){e[3]===t?(s(e[0],e[1],e[2],n),i!==t&&i.length>0&&l(i[0],i[1],i[2])):(n!==t&&n.length>0?(s(e[0],e[1],e[3],[n[0],n[1],n[3]]),s(e[1],e[2],e[3],[n[1],n[2],n[3]])):(s(e[0],e[1],e[3]),s(e[1],e[2],e[3])),i!==t&&i.length>0&&(l(i[0],i[1],i[3]),l(i[1],i[2],i[3])))}var c=0,h=new mono.Entity,u=h,g=new mono.Entity;g.setStyle("m.type","phong");for(var m=[],p=0,f=[],v=[],y=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,b=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,C=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,w=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,S=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,x=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,I=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,P=e.split("\n"),_=0;_<P.length;_++){var E=P[_];E=E.trim();var T;if(0!==E.length&&"#"!==E.charAt(0))if(null!==(T=y.exec(E)))m.push(n(parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3])));else if(null!==(T=b.exec(E)))f.push(n(parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3])));else if(null!==(T=C.exec(E)))v.push(a(parseFloat(T[1]),parseFloat(T[2])));else if(null!==(T=w.exec(E)))d([T[1],T[2],T[3],T[4]]);else if(null!==(T=S.exec(E)))d([T[2],T[5],T[8],T[11]],[T[3],T[6],T[9],T[12]]);else if(null!==(T=x.exec(E)))d([T[2],T[6],T[10],T[14]],[T[3],T[7],T[11],T[15]],[T[4],T[8],T[12],T[16]]);else if(null!==(T=I.exec(E)))d([T[2],T[5],T[8],T[11]],[],[T[3],T[6],T[9],T[12]]);else if(/^o /.test(E))r(),c+=m.length,m=[],u=new mono.Entity,u._name=E.substring(2).trim(),h.addChild(u);else if(/^g /.test(E))r(E.substring(2).trim(),t);else if(/^usemtl /.test(E))r(t,E.substring(7).trim());else if(/^mtllib /.test(E)){if(i){var A=E.substring(7);A=A.trim(),i(A)}}else/^s /.test(E)}return r(t,t),h}})}(window),+function(e){"use strict";var t=e.dxf={},i=function(e,t){for(var i in t)e[i]=t[i]},n=function(e){return parseInt(e)},a=function(e){return parseFloat(e)},o=Math.PI,r=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,1,1],[0,0,1],[1,0,1],[1,1,1],[.5,.5,.5],[.75,.75,.75],[1,0,0],[1,.5,.5],[.65,0,0],[.65,.325,.325],[.5,0,0],[.5,.25,.25],[.3,0,0],[.3,.15,.15],[.15,0,0],[.15,.075,.075],[1,.25,0],[1,.625,.5],[.65,.1625,0],[.65,.4063,.325],[.5,.125,0],[.5,.3125,.25],[.3,.075,0],[.3,.1875,.15],[.15,.0375,0],[.15,.0938,.075],[1,.5,0],[1,.75,.5],[.65,.325,0],[.65,.4875,.325],[.5,.25,0],[.5,.375,.25],[.3,.15,0],[.3,.225,.15],[.15,.075,0],[.15,.1125,.075],[1,.75,0],[1,.875,.5],[.65,.4875,0],[.65,.5688,.325],[.5,.375,0],[.5,.4375,.25],[.3,.225,0],[.3,.2625,.15],[.15,.1125,0],[.15,.1313,.075],[1,1,0],[1,1,.5],[.65,.65,0],[.65,.65,.325],[.5,.5,0],[.5,.5,.25],[.3,.3,0],[.3,.3,.15],[.15,.15,0],[.15,.15,.075],[.75,1,0],[.875,1,.5],[.4875,.65,0],[.5688,.65,.325],[.375,.5,0],[.4375,.5,.25],[.225,.3,0],[.2625,.3,.15],[.1125,.15,0],[.1313,.15,.075],[.5,1,0],[.75,1,.5],[.325,.65,0],[.4875,.65,.325],[.25,.5,0],[.375,.5,.25],[.15,.3,0],[.225,.3,.15],[.075,.15,0],[.1125,.15,.075],[.25,1,0],[.625,1,.5],[.1625,.65,0],[.4063,.65,.325],[.125,.5,0],[.3125,.5,.25],[.075,.3,0],[.1875,.3,.15],[.0375,.15,0],[.0938,.15,.075],[0,1,0],[.5,1,.5],[0,.65,0],[.325,.65,.325],[0,.5,0],[.25,.5,.25],[0,.3,0],[.15,.3,.15],[0,.15,0],[.075,.15,.075],[0,1,.25],[.5,1,.625],[0,.65,.1625],[.325,.65,.4063],[0,.5,.125],[.25,.5,.3125],[0,.3,.075],[.15,.3,.1875],[0,.15,.0375],[.075,.15,.0938],[0,1,.5],[.5,1,.75],[0,.65,.325],[.325,.65,.4875],[0,.5,.25],[.25,.5,.375],[0,.3,.15],[.15,.3,.225],[0,.15,.075],[.075,.15,.1125],[0,1,.75],[.5,1,.875],[0,.65,.4875],[.325,.65,.5688],[0,.5,.375],[.25,.5,.4375],[0,.3,.225],[.15,.3,.2625],[0,.15,.1125],[.075,.15,.1313],[0,1,1],[.5,1,1],[0,.65,.65],[.325,.65,.65],[0,.5,.5],[.25,.5,.5],[0,.3,.3],[.15,.3,.3],[0,.15,.15],[.075,.15,.15],[0,.75,1],[.5,.875,1],[0,.4875,.65],[.325,.5688,.65],[0,.375,.5],[.25,.4375,.5],[0,.225,.3],[.15,.2625,.3],[0,.1125,.15],[.075,.1313,.15],[0,.5,1],[.5,.75,1],[0,.325,.65],[.325,.4875,.65],[0,.25,.5],[.25,.375,.5],[0,.15,.3],[.15,.225,.3],[0,.075,.15],[.075,.1125,.15],[0,.25,1],[.5,.625,1],[0,.1625,.65],[.325,.4063,.65],[0,.125,.5],[.25,.3125,.5],[0,.075,.3],[.15,.1875,.3],[0,.0375,.15],[.075,.0938,.15],[0,0,1],[.5,.5,1],[0,0,.65],[.325,.325,.65],[0,0,.5],[.25,.25,.5],[0,0,.3],[.15,.15,.3],[0,0,.15],[.075,.075,.15],[.25,0,1],[.625,.5,1],[.1625,0,.65],[.4063,.325,.65],[.125,0,.5],[.3125,.25,.5],[.075,0,.3],[.1875,.15,.3],[.0375,0,.15],[.0938,.075,.15],[.5,0,1],[.75,.5,1],[.325,0,.65],[.4875,.325,.65],[.25,0,.5],[.375,.25,.5],[.15,0,.3],[.225,.15,.3],[.075,0,.15],[.1125,.075,.15],[.75,0,1],[.875,.5,1],[.4875,0,.65],[.5688,.325,.65],[.375,0,.5],[.4375,.25,.5],[.225,0,.3],[.2625,.15,.3],[.1125,0,.15],[.1313,.075,.15],[1,0,1],[1,.5,1],[.65,0,.65],[.65,.325,.65],[.5,0,.5],[.5,.25,.5],[.3,0,.3],[.3,.15,.3],[.15,0,.15],[.15,.075,.15],[1,0,.75],[1,.5,.875],[.65,0,.4875],[.65,.325,.5688],[.5,0,.375],[.5,.25,.4375],[.3,0,.225],[.3,.15,.2625],[.15,0,.1125],[.15,.075,.1313],[1,0,.5],[1,.5,.75],[.65,0,.325],[.65,.325,.4875],[.5,0,.25],[.5,.25,.375],[.3,0,.15],[.3,.15,.225],[.15,0,.075],[.15,.075,.1125],[1,0,.25],[1,.5,.625],[.65,0,.1625],[.65,.325,.4063],[.5,0,.125],[.5,.25,.3125],[.3,0,.075],[.3,.15,.1875],[.15,0,.0375],[.15,.075,.0938],[.33,.33,.33],[.464,.464,.464],[.598,.598,.598],[.732,.732,.732],[.866,.866,.866],[1,1,1]];t.getColor=function(e){return r[e]},r.forEach(function(e,t){r[t]="rgb("+Math.floor(255*e[0])+","+Math.floor(255*e[1])+","+Math.floor(255*e[2])+")"});var s=t.Attributes=function(e,t,i,n,a,o){this.layer=e||"",this.color=t||0,this.color24=null==i?-1:i,this.width=n||0,this.lineType=a||"BYLAYER",this.handle=null==o?-1:o},l=t.Dxf=function(){var e=this;e.vertices=null,e.maxVertices=0,e.vertexIndex=0,e.groupCode=0,e.groupValue="",e.currentObjectType="",e.values={},e.attrib=null;e.sections={headers:{},tables:{layers:{}},blocks:{},entities:[]};e.handler={$:e.addSetting,LAYER:e.addLayer,BLOCK:e.addBlock,ENDBLK:e.endBlock,LINE:e.addLine,POLYLINE:e.addPolyline,LWPOLYLINE:e.addPolyline,VERTEX:e.addVertex,ARC:e.addArc,ELLIPSE:e.addEllipse,CIRCLE:e.addCircle,INSERT:e.addInsert,TEXT:e.addText,MTEXT:e.addMText,ATTRIB:e.addAttrib,SEQEND:e.endSequence}};i(l.prototype,{hasValue:function(e){return this.values.hasOwnProperty(e)},getIntValue:function(e,t){return this.hasValue(e)?n(this.values[e]):t},getStringValue:function(e,t){return this.hasValue(e)?this.values[e]:t},getRealValue:function(e,t){return this.hasValue(e)?a(this.values[e]):t},parse:function(e){var t=this;for(t.lines=e.split("\n"),t.lineCount=t.lines.length,t.index=0,t.currentObjectType="";t.readDxfGroups(););},readDxfGroups:function(){var e,t,i=this,a=i.index,o=i.lineCount,r=i.lines;return a>o-2?!1:(e=r[a].trim(),t=r[a+1].trim(),i.index+=2,e?(this.groupCode=n(e),this.groupValue=t,this.processDXFGroup(),i.index<i.lineCount-1):!1)},processDXFGroup:function(){var e=this,t=e.groupCode,i=e.groupValue;if(0===t||9===t){var n,a=e.getStringValue(8,"0");n=e.hasValue(39)&&!e.hasValue(370)?e.getIntValue(39,-1):e.hasValue(370)?e.getIntValue(370,-1):-1;var o=e.getIntValue(62,256),r=e.getIntValue(420,-1),l=e.getIntValue(5,-1),d=e.getStringValue(6,"BYLAYER");e.attrib=new s(a,o,r,n,d,l);var c=e.handler[e.currentObjectType];c&&c.call(e),e.values={},"$"===i[0]?(e.currentObjectType="$",e.settingKey=i):e.currentObjectType=i}else{var h=!1;"MTEXT"===e.currentObjectType?h=e.handleMTextData():"LWPOLYLINE"===e.currentObjectType&&(h=e.handleLWPolylineData()),h||(e.values[t]=i)}},addSetting:function(){var e=this,t=e.settingKey,i=e.sections.headers,a=e.values,o=n(Object.keys(a)[0]);o>=0&&9>=o?i[t]=a[o]:o>=10&&39>=o?10===o&&(i[t]={x:e.getRealValue(o,0),y:e.getRealValue(o+10,0),z:e.getRealValue(o+20,0)}):o>=40&&59>=o?i[t]=e.getRealValue(o,0):o>=60&&99>=o?i[t]=e.getIntValue(o,0):o>=0&&(i[t]=a[o])},addLayer:function(){var e=this,t=e.attrib;(256===t.color||0===t.color)&&(t.color=7),t.width<0&&(t.width=1);var i=t.lineType;i=i.toUpperCase(),("BYLAYER"===i||"BYBLOCK"===i)&&(t.lineType="CONTINUOUS");var n=e.getStringValue(2,"");if(n){var a=new d(n,e.getIntValue(70,0));a.attrib=t,e.sections.tables.layers[n]=a}},addBlock:function(){var e=this,t=e.getStringValue(2,"");t&&(e.block=new c(t,e.getIntValue(70,0),e.getRealValue(10,0),e.getRealValue(20,0),e.getRealValue(30,0)))},endBlock:function(){var e=this;e.sections.blocks[e.block.name]=e.block,e.block=null},addLine:function(){var e=this;e.addEntity(new h(e.getRealValue(10,0),e.getRealValue(20,0),e.getRealValue(30,0),e.getRealValue(11,0),e.getRealValue(21,0),e.getRealValue(31,0)))},addEntity:function(e){var t=this;e.attrib=t.attrib,(t.block||t.sections).entities.push(e)},addPolyline:function(){var e,t=this,i=t.vertices;if(t.polyline)throw"polyline";if(t.polyline=new m(t.maxVertices,t.getIntValue(71,0),t.getIntValue(72,0),t.getIntValue(70,0)),t.maxVertices=Math.min(t.maxVertices,t.vertexIndex+1),"LWPOLYLINE"===t.currentObjectType){for(e=0;e<t.maxVertices;e++)t.polyline.points.push(new p(i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]));t.vertices=null,t.addEntity(t.polyline),t.polyline=null}},addVertex:function(){var e=this;(!(128&e.getIntValue(70,0))||64&e.getIntValue(70,0))&&e.polyline.points.push(new p(e.getRealValue(10,0),e.getRealValue(20,0),e.getRealValue(30,0),e.getRealValue(42,0)))},addArc:function(){var e=this;e.addEntity(new u(e.getRealValue(10,0),e.getRealValue(20,0),e.getRealValue(30,0),e.getRealValue(40,0),e.getRealValue(50,0),e.getRealValue(51,0)))},addCircle:function(){var e=this;e.addEntity(new g(e.getRealValue(10,0),e.getRealValue(20,0),e.getRealValue(30,0),e.getRealValue(40,0)))},addEllipse:function(){var e=this;e.addEntity(new f(e.getRealValue(10,0),e.getRealValue(20,0),e.getRealValue(30,0),e.getRealValue(11,0),e.getRealValue(21,0),e.getRealValue(31,0),e.getRealValue(40,1),e.getRealValue(41,0),e.getRealValue(42,2*o)))},addInsert:function(){var e=this,t=e.getStringValue(2,"");t&&e.addEntity(new v(t,e.getRealValue(10,0),e.getRealValue(20,0),e.getRealValue(30,0),e.getRealValue(41,1),e.getRealValue(42,1),e.getRealValue(43,1),e.getRealValue(50,0),e.getIntValue(70,1),e.getIntValue(71,1),e.getRealValue(44,0),e.getRealValue(45,0)))},addMText:function(){var e,t,i=this,n=0;i.hasValue(50)?n=2*i.getRealValue(50,0)*o/360:i.hasValue(11)&&i.hasValue(21)&&(e=i.getRealValue(11,0),t=i.getRealValue(21,0),n=Math.abs(e)<1e-6?t>0?o/2:o/2*3:Math.atan(t/e)),i.addEntity(new y(i.getRealValue(10,0),i.getRealValue(20,0),i.getRealValue(30,0),i.getRealValue(11,0),i.getRealValue(21,0),i.getRealValue(31,0),i.getRealValue(40,2.5),i.getRealValue(41,0),i.getIntValue(71,1),i.getIntValue(72,1),i.getIntValue(73,1),i.getRealValue(44,1),i.getStringValue(1,""),i.getStringValue(7,""),n))},handleMTextData:function(){var e,t,i=this;return 3===i.groupCode?(e=(i.block||i.sections).entities,t=e[e.length],t instanceof y&&(t.text=t.text?t.text+i.groupValue:i.groupValue),!0):!1},handleLWPolylineData:function(){var e,t=this,i=t.groupCode,o=t.groupValue,r=t.maxVertices,s=t.vertexIndex,l=t.vertices;if(90===i){if(r=t.maxVertices=n(o),r>0)for(l=t.vertices=[],e=0;r>e;++e)l[4*e]=0,l[4*e+1]=0,l[4*e+2]=0,l[4*e+3]=0;return t.vertexIndex=-1,!0}return 10===i||20===i||30===i||42===i?(r-1>s&&10===i&&(s=++t.vertexIndex),30>=i?s>=0&&r>s&&(l[4*s+(Math.floor(i/10)-1)]=a(o)):42===i&&r>s&&(l[4*s+3]=a(o)),!0):!1},addText:function(){var e=this;e.addEntity(new b(e.getRealValue(10,0),e.getRealValue(20,0),e.getRealValue(30,0),e.getRealValue(11,0),e.getRealValue(21,0),e.getRealValue(31,0),e.getRealValue(40,2.5),e.getRealValue(41,1),e.getIntValue(71,0),e.getIntValue(72,0),e.getIntValue(73,0),e.getStringValue(1,""),e.getStringValue(7,""),2*e.getRealValue(50,0)*o/360))},addAttrib:function(){var e=this;e.addEntity(new b(e.getRealValue(10,0),e.getRealValue(20,0),e.getRealValue(30,0),e.getRealValue(11,0),e.getRealValue(21,0),e.getRealValue(31,0),e.getRealValue(40,2.5),e.getRealValue(41,1),e.getIntValue(71,0),e.getIntValue(72,0),e.getIntValue(74,0),e.getStringValue(1,""),e.getStringValue(7,""),2*e.getRealValue(50,0)*o/360))},endSequence:function(){var e=this;e.polyline&&(e.addEntity(e.polyline),e.polyline=null)}});var d=t.LayerData=function(e,t){this.name=e,this.flags=t},c=t.BlockData=function(e,t,i,n,a){this.name=e,this.flags=t,this.bpx=i,this.bpy=n,this.bpz=a,this.entities=[]},h=t.LineData=function(e,t,i,n,a,o){var r=this;r.x1=e,r.y1=t,r.z1=i,r.x2=n,r.y2=a,r.z2=o},u=t.ArcData=function(e,t,i,n,a,o){var r=this;r.cx=e,r.cy=t,r.cz=i,r.radius=n,r.angle1=a,r.angle2=o},g=t.CircleData=function(e,t,i,n){var a=this;a.cx=e,a.cy=t,a.cz=i,a.radius=n},m=t.PolylineData=function(e,t,i,n){var a=this;a.number=e,a.m=t,a.n=i,a.flags=n,a.points=[]},p=t.VertexData=function(e,t,i,n){var a=this;a.x=e,a.y=t,a.z=i,a.bulge=n},f=t.EllipseData=function(e,t,i,n,a,o,r,s,l){var d=this;d.cx=e,d.cy=t,d.cz=i,d.mx=n,d.my=a,d.mz=o,d.ratio=r,d.angle1=s,d.angle2=l},v=t.InsertData=function(e,t,i,n,a,o,r,s,l,d,c,h){var u=this;u.name=e,u.ipx=t||0,u.ipy=i||0,u.ipz=n||0,u.sx=a||1,u.sy=o||1,u.sz=r||1,u.angle=s||0,u.cols=l||0,u.rows=d||0,u.colSp=c||0,u.rowSp=h||0},y=t.MTextData=function(e,t,i,n,a,o,r,s,l,d,c,h,u,g,m){var p=this;p.ipx=e,p.ipy=t,p.ipz=i,p.dirx=n,p.diry=a,p.dirz=n,p.height=r,p.width=s,p.attachmentPoint=l,p.drawingDirection=d,p.lineSpacingStyle=c,p.lineSpacingFactor=h,p.text=u,p.style=g,p.angle=m},b=t.TextData=function(e,t,i,n,a,o,r,s,l,d,c,h,u,g){var m=this;m.ipx=e,m.ipy=t,m.ipz=i,m.apx=n,m.apy=a,m.apz=o,m.height=r,m.xScaleFactor=s,m.textGenerationFlags=l,m.hJustification=d,m.vJustification=c,m.text=h,m.style=u,m.angle=g}}(this);var DxfViewer=function(e,t,i){var n=this;DxfViewer.superClass.constructor.call(n,e),n.inverseColor=i,n.init(t),n.insertEntity=n.defaultInsertEntity,n.scale=1,n.offsetx=0,n.offsety=0,n.bounds={left:0,top:0,right:0,bottom:0}};twaver.Util.ext(DxfViewer,twaver.canvas.Network,{defaultInsertEntity:new dxf.InsertData,init:function(e){var t=this,i=t.getView();t.setRectSelectEnabled(!1),t.setToolTipEnabled(!1),i.style.backgroundColor=t.inverseColor?"black":"white",e?(t.setInteractions([new twaver.canvas.interaction.SelectInteraction(t),new twaver.canvas.interaction.MoveInteraction(t),new twaver.canvas.interaction.DefaultInteraction(t)]),i.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"}),i.addEventListener("drop",function(e){e.preventDefault();var i=e.dataTransfer.files;i.length&&t.loadDxf(i[0])}),i.addEventListener("mousedown",function(e){t.getElementAt(e)||(t.lastPoint={x:e.clientX,y:e.clientY})}),i.addEventListener("mousemove",function(e){if(t.lastPoint){var i={x:e.clientX,y:e.clientY};t.offsetx+=i.x-t.lastPoint.x,t.offsety+=i.y-t.lastPoint.y,t.loadData(),t.lastPoint=i}}),i.addEventListener("dblclick",function(){t.zoomOverview()}),i.addEventListener("mouseup",function(){t.lastPoint=null}),i.addEventListener(twaver.Util.isFirefox?"DOMMouseScroll":"mousewheel",function(e){e.preventDefault();var i=t.getLogicalPoint(e);delta=void 0===e.wheelDeltaX?{x:-e.deltaX,y:-e.deltaY}:{x:e.wheelDeltaX/3,y:e.wheelDeltaY/3},delta.y>0?t.zoomIn(i):delta.y<0&&t.zoomOut(i)})):t.setInteractions([])},zoomIn:function(e){var t=this;t.setZoom(1.1*t.scale,e)},zoomOut:function(e){var t=this;t.setZoom(t.scale/1.1,e)},zoomReset:function(){var e=this;e.scale=1,e.offsetx=0,e.offsety=0,e.loadData()},zoomOverview:function(){var e=this,t=e.getViewRect(),i={x:e.bounds.left,y:e.bounds.top,width:e.bounds.right-e.bounds.left,height:e.bounds.bottom-e.bounds.top};0!==i.width&&0!==i.height&&(e.scale=Math.min(t.width/i.width,t.height/i.height),i={x:i.x*e.scale,y:i.y*e.scale,width:i.width*e.scale,height:i.height*e.scale},e.offsetx=(t.width-i.width)/2-i.x,e.offsety=(t.height+i.height)/2-i.y,e.loadData())},setBounds:function(e){var t=this,i={x:t.bounds.left,y:t.bounds.top,width:t.bounds.right-t.bounds.left,height:t.bounds.bottom-t.bounds.top};0!==i.width&&0!==i.height&&(t.scale=Math.min(e.width/i.width,e.height/i.height),i={x:i.x*t.scale,y:i.y*t.scale,width:i.width*t.scale,height:i.height*t.scale},t.adjustBounds({x:0,y:0,width:2*e.x+i.width,height:2*e.y+i.height}),t.offsetx=e.x-i.x,t.offsety=e.y-i.y+i.height,t.loadData())},setZoom:function(e,t){var i=this,n=i.scale,a=i.getViewRect();
i.scale=e,t||(t={x:a.width/2,y:a.height/2}),i.offsetx=t.x-(t.x-i.offsetx)*e/n,i.offsety=t.y-(t.y-i.offsety)*e/n,i.loadData()},loadDxf:function(e){var t=this;if(e instanceof File)if(e.name.toLowerCase().endsWith(".dxf")){var i=new FileReader;i.onload=function(e){t.loadDxf(e.target.result)},i.readAsText(e)}else alert("Only dxf file is supported");else{var n=t.parser=new dxf.Dxf;n.parse(e),t.bounds={left:0,top:0,right:0,bottom:0},n.sections.entities.forEach(function(e){e instanceof dxf.InsertData?t.parser.sections.blocks[e.name].entities.forEach(function(i){t._calculateBounds(i,e)}):t._calculateBounds(e)}),t.onDxfLoaded()}},onDxfLoaded:function(){},_calculateBounds:function(e,t){var i,n=this;if(e instanceof dxf.ArcData)i={left:e.cx-e.radius,top:e.cy-e.radius,right:e.cx+e.radius,bottom:e.cy+e.radius};else if(e instanceof dxf.CircleData)i={left:e.cx-e.radius,top:e.cy-e.radius,right:e.cx+e.radius,bottom:e.cy+e.radius};else if(e instanceof dxf.EllipseData)i={left:e.cx-e.mx,top:e.cy-e.my,right:e.cx+e.mx,bottom:e.cy+e.my};else if(e instanceof dxf.LineData){var a=_twaver.math.getRect([{x:e.x1,y:e.y1},{x:e.x2,y:e.y2}]);i={left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height}}else if(e instanceof dxf.PolylineData){var a=_twaver.math.getRect(e.points);i={left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height}}i&&(t&&(i.left=i.left*t.sx+t.ipx,i.top=i.top*t.sy+t.ipy,i.right=i.right*t.sx+t.ipx,i.bottom=i.bottom*t.sy+t.ipy),n.bounds.left=i.left<n.bounds.left?i.left:n.bounds.left,n.bounds.top=i.top<n.bounds.top?i.top:n.bounds.top,n.bounds.right=i.right>n.bounds.right?i.right:n.bounds.right,n.bounds.bottom=i.bottom>n.bounds.bottom?i.bottom:n.bounds.bottom)},loadData:function(){var e=this;e._box.clear();var t=e.parser.sections.tables.layers;Object.keys(t).forEach(function(i){var n=(t[i],new twaver.Dummy(i));n.setName(i),e._box.add(n)}),e.parser.sections.entities.forEach(function(t){e.addData(t)})},addData:function(e){{var t=this;t._box}e instanceof dxf.InsertData?(t.insertEntity=e,t.parser.sections.blocks[e.name].entities.forEach(function(e){t._addData(e)}),t.insertEntity=t.defaultInsertEntity):t._addData(e)},_addData:function(e){var t,i=this,n=i._box;if(e instanceof dxf.ArcData){t=new ArcNode;var a=2*i.translateSize(e.radius),o=i.translatePoint({x:e.cx,y:e.cy});t.setSize(a,a),t.setCenterLocation(o),t.setClient("startAngle",-e.angle1/180*Math.PI),t.setClient("endAngle",-e.angle2/180*Math.PI),t.setClient("type","Arc"),n.add(t)}else if(e instanceof dxf.CircleData){t=new twaver.Node,t.setStyle("body.type","vector"),t.setStyle("vector.shape","circle");var a=2*i.translateSize(e.radius),o=i.translatePoint({x:e.cx,y:e.cy});t.setSize(a,a),t.setCenterLocation(o),t.setClient("type","Circle"),n.add(t)}else if(e instanceof dxf.EllipseData){t=new twaver.Node,t.setStyle("body.type","vector"),t.setStyle("vector.shape","oval");var r=i.translateSize(e.mx),s=i.translateSize(e.my),o=i.translatePoint({x:e.cx,y:e.cy});t.setSize(r,s),t.setCenterLocation(o),t.setClient("type","Ellipse"),n.add(t)}else if(e instanceof dxf.LineData)t=new twaver.ShapeNode,t.setPoints(new twaver.List(i.translatePoint({x:e.x1,y:e.y1}),i.translatePoint({x:e.x2,y:e.y2}))),t.setClient("type","Line"),n.add(t);else{if(!(e instanceof dxf.PolylineData))return!1;t=new PolyLineNode,points=[],e.points.forEach(function(e){points.push(i.translatePoint(e))}),1===e.flags&&points.push({x:points[0].x,y:points[0].y,bulge:points[0].bulge}),t.setPoints(new twaver.List(points)),t.setClient("type","Polyline"),n.add(t)}if(t){t.setStyle("vector.outline.width",1);var l=i.parser.sections.tables.layers[e.attrib.layer],d=e.attrib.color;d=!l||256!==d&&void 0!==d?d:l.attrib.color,i.inverseColor||7!==d&&255!==d||(d=0),t.setStyle("vector.outline.color",dxf.getColor(d)),t.setStyle("vector.fill",!1),t.setClient("entity",e),t.setClient("parent",i.insertEntity),t.setParent(n.getDataById(e.attrib.layer))}return!0},translatePoint:function(e){var t=this;return{x:(e.x*t.insertEntity.sx+t.insertEntity.ipx)*t.scale+t.offsetx,y:(-e.y*t.insertEntity.sy-t.insertEntity.ipy)*t.scale+t.offsety,bulge:e.bulge}},translateSize:function(e){var t=this;return e*t.scale*Math.abs(Math.max(t.insertEntity.sx,t.insertEntity.sy))}});var ArcNode=function(){ArcNode.superClass.constructor.apply(this,arguments)};twaver.Util.ext(ArcNode,twaver.Node,{getCanvasUIClass:function(){return ArcNodeUI}});var ArcNodeUI=function(){ArcNodeUI.superClass.constructor.apply(this,arguments)};twaver.Util.ext(ArcNodeUI,twaver.canvas.NodeUI,{paintBody:function(e){var t=this.getElement(),i=t.getCenterLocation();e.save(),e.beginPath(),e.strokeStyle=t.getStyle("vector.outline.color"),e.lineWidth=t.getStyle("vector.outline.width"),e.arc(i.x,i.y,t.getWidth()/2,t.getClient("startAngle"),t.getClient("endAngle"),!0),e.stroke(),e.restore()}});var PolyLineNode=function(){PolyLineNode.superClass.constructor.apply(this,arguments)};twaver.Util.ext(PolyLineNode,twaver.ShapeNode,{getCanvasUIClass:function(){return PolyLineNodeUI}});var PolyLineNodeUI=function(){PolyLineNodeUI.superClass.constructor.apply(this,arguments)};twaver.Util.ext(PolyLineNodeUI,twaver.canvas.ShapeNodeUI,{paintBody:function(e){var t,i=this.getElement(),n=i.getPoints();e.save(),e.beginPath(),e.strokeStyle=i.getStyle("vector.outline.color"),e.lineWidth=i.getStyle("vector.outline.width"),n.forEach(function(i){if(t)if(t.bulge){var n=t.bulge,a=getRadius(t,i,n);drawPathA(t.x,t.y,a,a,0,!1,0>n,i.x,i.y,e)}else e.lineTo(i.x,i.y);else e.moveTo(i.x,i.y);t=i}),e.stroke(),e.restore()}});var selectStyle=PropertyConsts.SELECT_STYLE.BORDER,registerProperties=["businessId"],enableEasing=!0,getCategoryValuefromLocalStorage=function(e,t){var i=localStorage.getItem(e?PropertyConsts.ROOM_PUBLIC_CATEGORY:PropertyConsts.ROOM_PRIVATE_CATEGORY);t&&(i=localStorage.getItem(e?PropertyConsts.COMPONENT_PUBLIC_CATEGORY:PropertyConsts.COMPONENT_PRIVATE_CATEGORY));var n="";return i&&(n=i.split(":")[1]),n},getCategoryIdfromLocalStorage=function(e,t){var i=localStorage.getItem(e?PropertyConsts.ROOM_PUBLIC_CATEGORY:PropertyConsts.ROOM_PRIVATE_CATEGORY);t&&(i=localStorage.getItem(e?PropertyConsts.COMPONENT_PUBLIC_CATEGORY:PropertyConsts.COMPONENT_PRIVATE_CATEGORY));var n="";return i&&(n=i.split(":")[0]),n};ComponentsInteraction=function(e){ComponentsInteraction.superClass.constructor.call(this,e)},twaver.Util.ext("ComponentsInteraction",twaver.network.interaction.BaseInteraction,{setUp:function(){this.addListener("keydown")},tearDown:function(){this.removeListener("keydown")},handle_keydown:function(e){var t=!1;Utils.isCtrlDown(e)&&(67===e.keyCode&&(this._copySelection(),t=!0),86===e.keyCode&&(this._pasteSelection(),t=!0)),37!=e.keyCode||Utils.isShiftDown(e)||Utils.isAltDown(e)||(this._moveSelectionElements("left"),t=!0),38!=e.keyCode||Utils.isShiftDown(e)||Utils.isAltDown(e)||(this._moveSelectionElements("top"),t=!0),39!=e.keyCode||Utils.isShiftDown(e)||Utils.isAltDown(e)||(this._moveSelectionElements("right"),t=!0),40!=e.keyCode||Utils.isShiftDown(e)||Utils.isAltDown(e)||(this._moveSelectionElements("bottom"),t=!0),Utils.isShiftDown(e)&&37==e.keyCode&&(this._resizeOutSideSelectionElements("left"),t=!0),Utils.isShiftDown(e)&&38==e.keyCode&&(this._resizeOutSideSelectionElements("top"),t=!0),Utils.isShiftDown(e)&&39==e.keyCode&&(this._resizeOutSideSelectionElements("right"),t=!0),Utils.isShiftDown(e)&&40==e.keyCode&&(this._resizeOutSideSelectionElements("bottom"),t=!0),Utils.isAltDown(e)&&37==e.keyCode&&(this._resizeInwardSelectionElements("left"),t=!0),Utils.isAltDown(e)&&38==e.keyCode&&(this._resizeInwardSelectionElements("top"),t=!0),Utils.isAltDown(e)&&39==e.keyCode&&(this._resizeInwardSelectionElements("right"),t=!0),Utils.isAltDown(e)&&40==e.keyCode&&(this._resizeInwardSelectionElements("bottom"),t=!0)},_copySelection:function(){var e=this.network.getElementBox().getSelectionModel().getSelection();if(e.isEmpty())return void(this.network.getElementBox().copyAnchor=null);e.forEach(function(e){if(e instanceof twaver.Follower&&e.getHost()&&e.getParent()){var t=e.getHost().getId(),i=e.getParent().getId();e.setClient("HostID",t),e.setClient("parentID",i),e.setClient("createType","copy")}});var t=new twaver.XmlSerializer(box2d,null,function(t){return e.contains(t)}).serialize();e.forEach(function(e){e instanceof twaver.Follower&&e.getHost()&&e.getParent()&&e.setClient("createType",null)}),this.network.getElementBox().copyAnchor=t},_pasteSelection:function(){var e,t=new twaver.List,i=this.network.getElementBox(),n=i.size();i.copyAnchor&&new twaver.XmlSerializer(i).deserialize(i.copyAnchor),i.forEach(function(t){t instanceof ImageNode&&(e=t)}),i.forEachReverse(function(t){if("copy"===t.getClient("createType")&&t instanceof twaver.Follower){if(void 0===t.getParent()){var n=t.getClient("parentID"),a=i.getDataById(n);t.setParent(a)}if(void 0===t.getHost()){var o=t.getClient("HostID"),r=i.getDataById(o);t.setHost(r)}t.setClient("selfID",t.getId())}t instanceof CGrid&&t.setParent(e)});var a=i.size();if(a>n)for(var o=i._dataList.toArray(),r=n;a>r;r++)t.add(o[r]),o[r].setX(o[r].getX()+20),o[r].setY(o[r].getY()+20);i.getSelectionModel().setSelection(t)},_resizeInwardSelectionElements:function(e){var t=this.network.getElementBox().getSelectionModel().getSelection();t.size()>0&&t.forEach(function(t){if(t instanceof CGrid&&t.getParent()instanceof ImageNode){var i=0,n=0;if("left"===e&&(i=-1,t.setWidth(t.getWidth()+i)),"right"===e){i=1;var a=t.getLocation();t.setLocation(a.x+i,a.y),t.setWidth(t.getWidth()-i)}if("top"===e&&(n=-1,t.setHeight(t.getHeight()+n)),"bottom"===e){n=1;var a=t.getLocation();t.setLocation(a.x,a.y+n),t.setHeight(t.getHeight()-n)}}})},_resizeOutSideSelectionElements:function(e){var t=this.network.getElementBox().getSelectionModel().getSelection();t.size()>0&&t.forEach(function(t){if(t instanceof CGrid&&t.getParent()instanceof ImageNode){var i=0,n=0;if("left"===e){i=-1;var a=t.getLocation();t.setLocation(a.x+i,a.y),t.setWidth(t.getWidth()-i)}if("right"===e&&(i=1,t.setWidth(t.getWidth()+i)),"top"===e){n=-1;var a=t.getLocation();t.setLocation(a.x,a.y+n),t.setHeight(t.getHeight()-n)}"bottom"===e&&(n=1,t.setHeight(t.getHeight()+n))}})},_moveSelectionElements:function(e){var t=this.network.getElementBox().getSelectionModel().getSelection();t.size()>0&&t.forEach(function(i){if(i instanceof CGrid&&i.getParent()instanceof ImageNode){var n=0,a=0;"left"===e&&(n=-1),"right"===e&&(n=1),"top"===e&&(a=-1),"bottom"===e&&(a=1),twaver.Util.moveElements(t,n,a,!1)}else if(i instanceof twaver.Follower&&i.getParent()instanceof CGrid&&i.getHost()instanceof CGrid){var o=i.getHost();if(t.contains(o))return;var r=o.getStyle("grid.row.count"),s=o.getStyle("grid.column.count"),l=i.getStyle("follower.row.index"),d=i.getStyle("follower.column.index");if("left"===e){if(0==d)return;i.setStyle("follower.column.index",d-1)}if("right"===e){if(d==s-1)return;i.setStyle("follower.column.index",d+1)}if("top"===e){if(0==l)return;i.setStyle("follower.row.index",l-1)}if("bottom"===e){if(l==r-1)return;i.setStyle("follower.row.index",l+1)}handleText2d(allNetworks[2])}})}}),ComponentsSelectInteraction=function(e){ComponentsSelectInteraction.superClass.constructor.call(this,e)},twaver.Util.ext("ComponentsSelectInteraction",twaver.network.interaction.SelectInteraction,{handle_mousedown:function(e){if(this._button=e.button,this.network.isValidEvent(e)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!e.shiftKey){var t=this.network.getElementAt(e),i=this.network.getSelectionModel();t?_twaver.isCtrlDown(e)?i.contains(t)?i.removeSelection(t):i.appendSelection(t):i.contains(t)||i.setSelection(t):(_twaver.isCtrlDown(e)||i.clearSelection(),this.end(e),this.network.getLogicalPoint(e)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(e))}}}),ComponentsMoveInteraction=function(e,t){ComponentsMoveInteraction.superClass.constructor.call(this,e,t)},twaver.Util.ext("ComponentsMoveInteraction",twaver.network.interaction.MoveInteraction,{handle_mousemove:function(e){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()||!this._startLogical)return void this.end(e);if(this._handle_mousemove(e),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:e});else{this.mark=_twaver.html.createDiv();var t;this.network.getMovableSelectedElements().forEach(function(e){var i=this.getElementUI(e);i&&(t=_twaver.math.unionRect(t,i.getBodyRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),_twaver.html.setDiv(this.mark,t,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:e})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else this.network.moveSelectedElements(this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=_twaver.html.getClientPoint(e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:e}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:e}));this.parentProcess(e,!1)}}),function(){ComponentsDragPipeInteraction=function(e){ComponentsDragPipeInteraction.superClass.constructor.call(this,e),this.selectedElements=new Array,this.allPoints=new Array,this.path=new mono.Path,this.pathNode=new mono.PathNode,this.setEditable=this.network.editableFunction,this.startElementTransparent=!1,this.endElementTransparent=!1,this.startElementOpacity=1,this.endElementOpacity=1},twaver.Util.ext("ComponentsDragPipeInteraction",mono.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(e){if(e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1,2===e.detail&&this.allPoints&&this.allPoints.length>=1){this.selectedElements[0]&&(this.selectedElements[0].setStyle("m.transparent",this.startElementTransparent),this.selectedElements[0].setStyle("m.opacity",this.startElementOpacity)),this.selectedElements[1]&&(this.selectedElements[1].setStyle("m.transparent",this.endElementTransparent),this.selectedElements[1].setStyle("m.opacity",this.endElementOpacity)),this.selectedElements=new Array;var t=this;setTimeout(function(){var e=t.network.getInteractions(),i=new Array,n=!1;e.forEach(function(e){e instanceof ComponentsDragPipeInteraction||e instanceof DrogPipeEditInteraction?n=!0:i.push(e)}),t.network.editableFunction=t.editableFunction,n&&t.network.setInteractions(i)},500);for(var i=this.allPoints.pop();i;)this.network.getDataBox().remove(i),i=this.allPoints.pop()}var n=this.network.getElementsByMouseEvent(e,!0),a=this.network.getFirstSelectElement(n,this);if(this.selectedElements||(this.selectedElements=new Array),a&&this.selectedElements.length<2){var o=a.getPosition(),r=null;if(this.selectedElements[0]&&(r=this.selectedElements[0].getPosition()),this.selectedElements.length<1?this.selectedElements.push(a):o&&r&&(o.getComponent(0)!=r.getComponent(0)||o.getComponent(1)!=r.getComponent(1)||o.getComponent(2)!=r.getComponent(2))&&this.selectedElements.push(a),this.allPoints=new Array,2==this.selectedElements.length){var s=[{label:"Points:",id:"points",tab:"GENERAL",value:3}],l=function(e){if(e&&e.points){var t=parseInt(e.points);if(t>0){t+=1,this.path=new mono.Path;var i=null,n=null;this.selectedElements[0]&&(i=this.selectedElements[0].getPosition()),this.selectedElements[1]&&(n=this.selectedElements[1].getPosition()),this.path.moveTo(i.getComponent(0),i.getComponent(1),i.getComponent(2));var a=new mono.Sphere(10,10,10);a.setPosition(i.getComponent(0),i.getComponent(1),i.getComponent(2)),this.allPoints.push(a),a.setStyle("m.color","0x000000"),this.network.getDataBox().add(a);for(var o=(n.getComponent(0)-i.getComponent(0))/t,r=(n.getComponent(1)-i.getComponent(1))/t,s=(n.getComponent(2)-i.getComponent(2))/t,l=1;t>=l;l++)a=new mono.Sphere(10,10,10),l===t?(this.path.lineTo(n.getComponent(0),n.getComponent(1),n.getComponent(2)),a.setPosition(n.getComponent(0),n.getComponent(1),n.getComponent(2))):(this.path.lineTo(i.getComponent(0)+l*o,i.getComponent(1)+l*r,i.getComponent(2)+l*s),a.setPosition(i.getComponent(0)+l*o,i.getComponent(1)+l*r,i.getComponent(2)+l*s)),this.allPoints.push(a),a.setStyle("m.color","0x000000"),this.network.getDataBox().add(a);this.path.lineTo(n.getComponent(0),n.getComponent(1),n.getComponent(2)),this.pathNode=new mono.PathNode(this.path,2,5,10),this.pathNode.setStyle("m.color","0x000000"),this.pathNode.setStyle("m.transparent",!0),this.pathNode.setStyle("m.opacity",.5),this.network.getDataBox().add(this.pathNode);var d=this.network.getInteractions(),c=!1;if(d.forEach(function(e){e instanceof DrogPipeEditInteraction&&(c=!0)}),!c){var h=new DrogPipeEditInteraction(this.network);h.setShowHelpers(!0),h.setScaleable(!1),h.setRotateable(!1),h.setTranslateable(!0),d.push(h),this.network.setInteractions(d)}this.selectedElements[0]&&(this.startElementTransparent=this.selectedElements[0].getStyle("m.transparent"),this.startElementOpacity=this.selectedElements[0].getStyle("m.opacity"),this.selectedElements[0].setStyle("m.transparent",!0),this.selectedElements[0].setStyle("m.opacity",.1)),this.selectedElements[1]&&(this.endElementTransparent=this.selectedElements[1].getStyle("m.transparent"),this.endElementOpacity=this.selectedElements[1].getStyle("m.opacity"),this.selectedElements[1].setStyle("m.transparent",!0),this.selectedElements[1].setStyle("m.opacity",.1));var u=this;this.network.editableFunction=function(e){if(e instanceof mono.Sphere)for(var t=0;t<u.allPoints.length;t++)if(e==u.allPoints[t])return!0;return!1};var g=this;this.network.getDataBox().addDataPropertyChangeListener(function(e){var t=e.source;if("position"===e.property)for(var i=0;i<g.allPoints.length;i++)if(g.allPoints[i]==t){var n=e.oldValue,a=e.newValue;if(g.path&&g.path.points)for(var o=g.path.points,r=new mono.Path,s=0;s<o.length;s++)o[s].getComponent(0)==n.getComponent(0)&&o[s].getComponent(1)==n.getComponent(1)&&o[s].getComponent(2)==n.getComponent(2)?0===s?r.moveTo(a.getComponent(0),a.getComponent(1),a.getComponent(2)):r.lineTo(a.getComponent(0),a.getComponent(1),a.getComponent(2)):0===s?r.moveTo(o[s].getComponent(0),o[s].getComponent(1),o[s].getComponent(2)):r.lineTo(o[s].getComponent(0),o[s].getComponent(1),o[s].getComponent(2));g.path=r,g.pathNode.setPath(g.path);break}})}}};Utils.showInputDialog(s,"Object Properties",!0,l,this,null)}}},update:function(){}}),DrogPipeEditInteraction=function(e){DrogPipeEditInteraction.superClass.constructor.call(this,e)},twaver.Util.ext("DrogPipeEditInteraction",mono.EditInteraction,{})}(window);var ComScalePane=function(e){this.box3d=e,this.scaleMap={"100px=0.1m":"0.1m","100px=1m":"1m","100px=10m":"10m","100px=100m":"100m","100px=1ft":"0.3048m","100px=10ft":"3.048m","100px=100ft":"30.48m"},this.defaultSelect="100px=1m"};twaver.Util.ext(ComScalePane,Object,{oldValue:null,scale:null,init:function(){var e=this;this.selectView=document.createElement("select"),this.selectView.setAttribute("class","selectView"),this.initScale(),this.selectView.onchange=function(){e.onChangeItem(this)}},onChangeItem:function(){var e=this.selectView.value;this.updateScaleSetting(e)},updateScaleSetting:function(e){comScaleValue=this.scaleMap[e],this.box3d.scaleValue=comScaleValue,localStorage.setItem(PropertyConsts.SCALE_UNIT_TEXT,e)},initScale:function(){for(var e in this.scaleMap)this.createItem(e)},createItem:function(e){var t=document.createElement("option");t.innerHTML=e,t.setAttribute("value",e),this.defaultSelect===e&&t.setAttribute("selected","selected"),this.selectView.appendChild(t)},getView:function(){return this.selectView}});var box2d,imageIcon,tmp3DNode,faceObject,comScalePane,comTemplateId,sidebar,animationManager,ACCORDION_WIDTH=295,borderPane=new twaver.controls.BorderPane,allRootViews=[document.createElement("div"),document.createElement("div")],cbtn3d=["default:$iInteraction('default')","coarseSelect:$iInteraction('coarseSelect')","unlockAllEditInteraction:$iInteraction('unlockAllEditInteraction',1,1)","move:$iInteraction('move',1,1)","rotate:$iInteraction('rotate',1,1)","resize:$iInteraction('resize',1,1)","createLink:Utils.createLinkHandle(box);","veilView:$clickbutton(this,'1')","align:$acdob()","zoom-over-view:$zoomoverview()","preview-view:$p3d()","max-1:$mmview(this,1);"],toolBar3D=new ToolBar(null,cbtn3d),cbtn2d=["grid-comp","zoom-reset-comp:$zreset2d(event)","zoom-in-comp:$zin2d(event)","zoom-out-comp:$zon2d(event)","max-0:$mmview(this,0);"],toolBar2D=new ToolBar(null,cbtn2d),allNetworks=[null,null],box=new mono.DataBox,allCameras=[null,new mono.PerspectiveCamera(30,1.5,.1,1e4)],accordion4C=new AccordionPane,maxedNetworkIndex=-1,showFloor=!0,allViewSelectable=!0,ambientLight=new mono.AmbientLight(8947848),pointLights=[Utils.createPointLight(0,!1),Utils.createPointLight(1e4,!1),Utils.createPointLight(-1e4,!1),Utils.createPointLight(5e3),Utils.createPointLight(-5e3,!1)],showAxis=!0,showAxisText=!0,scaleMinLimit=.1,scaleMaxLimit=100,loadResource=TYPE_LOCAL,cloudKey="",cloudPassword="",saveTemplate=!1,isFullRotation=!1,floorStyle=PropertyConsts.FloorStyle.PLANE_FLOOR,floorSize=PropertyConsts.FloorSize.SMALL,minZoom=.6,zoomValue=1.1,invalidateOffsetFlag=!0,invalidateImageNodeOffsetFlag=!1,invalidateElementSizeFlag=!0,enableScale=!1,objectIdFinder=new mono.QuickFinder(box,"object3dId","client"),veilViewFlag=!1,comScaleValue="1m",comZoomSpeed=1.5,comRotateSpeed=1,comPanSpeed=.3,comMaxDistance=5e3,comMinDistance=20,comNearPlane=10,comFarPlane=1e4,comFov=30,start4Components=function(){_twaver.ua.isTouchable=!1,init(),layout4CGUI(),Utils.checkLoadLocalImage(),Utils.loadPropertiesFromLocalStorage(!0,ambientLight,pointLights,box,allNetworks),createViewFloor(),showFloor&&box.add(viewFloor),Utils.updateBoxInfo(box),installInteraction("init");var e=document.getElementById("max-1");$mmview(e,1)};$start4C=start4Components;var layout4CGUI=function(){if(borderPane.invalidate(),accordion4C.accordion.invalidate(),-1===maxedNetworkIndex)for(var e=0;e<allNetworks.length;e++){var t=allNetworks[e],i=allCameras[e],n=borderPane.getView(),a=(n.offsetWidth-ACCORDION_WIDTH)/2,o=n.offsetHeight-3;if(i)updateNetworkViewRatio(t,i,a,o),Utils.setNetworkBackground(t,"componentBackground");else{var r=n.offsetHeight-29;t.getView().style.width=a+"px",t.getView().style.height=r+"px"}}else{var t=allNetworks[maxedNetworkIndex],i=allCameras[maxedNetworkIndex],n=borderPane.getView(),a=n.offsetWidth-ACCORDION_WIDTH,o=n.offsetHeight;t instanceof mono.Network3D&&(updateNetworkViewRatio(t,i,a,o),Utils.setNetworkBackground(t,"componentBackground"))}},init=function(){var e=localStorage.getItem("mono-user");if("mono"!=e){var t=document.getElementById("publish_template_menu");t.parentNode.removeChild(t);var i=document.getElementById("unpublish_template_menu");i.parentNode.removeChild(i)}initSerializationSettings(),comScalePane=new ComScalePane(box),comScalePane.init(),document.getElementById("scale")&&document.getElementById("scale").appendChild(comScalePane.getView()),setAccordionFunction(accordion4C),initCModelLib(),borderPane.setLeft(accordion4C),borderPane.setLeftWidth(ACCORDION_WIDTH);var n=borderPane.getView();n.style.left="0px",n.style.top="137px",n.style.right="0px",n.style.bottom="28px",document.getElementById("main").appendChild(n),initWindowListener(),box.addDataBoxChangeListener(handleCompDataBoxPropertyChange),box.addDataPropertyChangeListener(handleCompDataPropertyChange),initSidebar(),initNetworks();var a=new twaver.controls.PopupMenu(allNetworks[1].getRootView());initPopupMenu(a,allNetworks[1]),installInteraction("init"),box.add(ambientLight),pointLights.forEach(function(e){box.add(e)}),setupSkybox(),borderPane.setCenter(table),setTableBorder(),Utils.createToolTipDiv(180,180),createComponentToggleDiv(),setInterval(updateComponentFps,1e3),allNetworks[1].setBeforeRenderFunction(function(){null==allNetworks[1]._renderCount?allNetworks[1]._renderCount=0:allNetworks[1]._renderCount++,allNetworks[1]._startTime=(new Date).getTime()}),allNetworks[1].setRenderCallback(function(){var e=allNetworks[1]._startTime,t=(new Date).getTime();allNetworks[1]._renderTime+=t-e}),animationManager=new mono.AnimationManager},createComponentToggleDiv=function(){Utils.createLeftToggleImage(function(){ACCORDION_WIDTH=0,borderPane.setLeft(null),layout4CGUI()},function(){ACCORDION_WIDTH=295,borderPane.setLeftWidth(ACCORDION_WIDTH),borderPane.setLeft(accordion4C),layout4CGUI()},borderPane.getView()),Utils.createTopToggleImage(function(){borderPane.getView().style.top="75px",layout4CGUI()},function(){borderPane.getView().style.top="137px",layout4CGUI()})},initWindowListener=function(){window.onresize=layout4CGUI,window.onbeforeunload=function(){var e=checkBoxHasElements()&&!saveTemplate;return e?"not save data, sure to exit?":void 0}},initNetworks=function(){for(var e=0;e<allNetworks.length;e++){1===e?reset4CCamera(6,e):reset4CCamera(e,e);var t=allCameras[e];if(t){t.look(new mono.Vec3(0,0,0));var i=new mono.Network3D(box,t);allNetworks[e]=i,allRootViews[e]=i.getRootView(),i.setShowAxis(showAxis),Utils.createDraggableNetwork3D(i),i.getRootView().setAttribute("class","component-network3d"),toolBar3D.setNetwork(i);var n=toolBar3D.getView();n.setAttribute("class","network3d-toolbar"),i.getRootView().appendChild(n);var a=toolBar3D.createMultiViewButtonDiv();i.getRootView().appendChild(a),Utils.setupNetworkInfoTags(i),i.selectableFunction=function(){return allViewSelectable},i.renderSelectFunction=function(){return allViewSelectable},i.getRootView().addEventListener("dblclick",function(e){var t=e.currentTarget,n=allRootViews.indexOf(t),a=i.getElementsByMouseEvent(e);a.length&&1!=a.length||(reset4CCamera(6,n),a[0]instanceof mono.Plane&&reset4CCamera(6,n))});var o=createDefaultInteraction(i),r=new mono.SelectionInteraction(i),s=[o,r,new mono.EditInteraction(i)];i.setInteractions(s),allTds[e].appendChild(i.getRootView()),installKeyListeners(allRootViews[e]),i.setKeyboardRemoveEnabled(!1),i.doubleClickToLookAtFunction=function(e){return e.getClient(PropertyConsts.COMPONENTFLOOR)?!1:!0},i.getRootView().addEventListener("dblclick",function(e){var t=e.currentTarget,i=allRootViews.indexOf(t);if(1===i&&Utils.isCtrlDown(e));else if(1===i&&Utils.isShiftDown(e)){var n=allNetworks[i],a=Utils._findFirstObjectByMouse(n,e);if(a){var o=mono.AniUtil.findAnimationAgent(a.element);o&&animationManager.play(animationManager.getAnimationById(o.getId()))}}else if(Utils.isAltDown(e)){var n=allNetworks[i];faceObject=Utils._findFirstObjectByMouse(n,e),handleFaceImage(allNetworks[0],faceObject)}else{var n=allNetworks[i],r=n.getElementsByMouseEvent(e);r.length?showPropertyDialog(r):clearEditorColor()}}),i.sortNodes=!0,Utils.renderNetwork(i,t)}else{var l=new twaver.network.Network;allNetworks[e]=l,box2d=l.getElementBox(),Utils.createDraggableNetwork(l);var d=borderPane.getView(),c=d.offsetHeight-29;l.getView().style.position="relative",l.getView().style.width="100%",l.getView().style.height=c+"px";var h=new twaver.Layer("topLayer");box2d.getLayerBox().add(h);var u=box2d.getSelectionModel();u.setFilterFunction(function(e){return!(e instanceof ImageNode)});var g=[new ComponentsInteraction(l),new twaver.network.interaction.SelectInteraction(l),new twaver.network.interaction.EditInteraction(l,!0),new ComponentsMoveInteraction(l,!0),new twaver.network.interaction.DefaultInteraction(l)];l.setInteractions(g),l.setLimitElementInPositiveLocation(!1),l._lazyMoveAnimate=null,l.zoom=1,initNetwork2DListener(l),allRootViews[e]=l.getView(),allTds[e].style.position="relative",toolBar2D.setNetwork(l),toolBar2D.createViewButton(allTds[e],"view-2d-comp","2D View");var n=toolBar2D.getView();n.setAttribute("class","network2d-toolbar"),allTds[e].appendChild(n),allTds[e].appendChild(l.getView())}}},initPopupMenu=function(e,t){var i,n,a=t.getDataBox();e.onMenuShowing=function(a){var o=t.getElementsByMouseEvent(a);return o&&o.length>0&&(n=o[0].element.getPosition(),i=o[0].element,e.setMenuItems([{label:"Wrap Image"}]),i instanceof mono.Cube&&t.getDataBox().getSelectionModel().appendSelection(i)),!0},e.onAction=function(e){if("Wrap Image"===e.label){var t=i.getStyle("m.texture.image");mono.Utils.loadImages(t,function(e){var t=mono.Utils.createWrapMapFromImages(e,{0:"right",1:"left",2:"top",3:"bottom",4:"front",5:"back"},"six-each",512,512);if(i.setStyle("m.texture.image",t),i.setWrapMode("six-each"),a.getSelectionModel().removeSelection(i),twaver.Util.isIE){var n=document.createElement("iframe");document.body.insertBefore(n),n.style.display="none",n.contentDocument.write(text),n.contentDocument.execCommand("SaveAs",!0),document.body.removeChild(n)}else{var o=t.toDataURL("image/png");console.log(o),window.open(o,"image")}})}},e.isVisible=function(){return i instanceof mono.Cube}},initSidebar=function(){var e=new twaver.ElementBox;sidebar=new ComponentSidebarPane(e),document.body.appendChild(sidebar.getView()),sidebar.setSidebarExpanded(!1);var t=new mono.Bridge(e,box);t.synchronizeFilter=function(e,t){return!t||isFloorElement(t)||t instanceof mono.Light?!1:!0},e.addDataPropertyChangeListener(function(e){var t=e.source,i=(e.property,e.newValue);if("C:t3d.standout"===e.property){var n=box.getDataById(t.getId());n.setVisible(i===!1?!1:!0)}}),e.addDataBoxChangeListener(function(e){var t=e.data,i=e.kind,n="";"add"==i&&(n="["+t.getStyle("t3d.shape")+"]",t.setName(n),t.setClient("t3d.standout",!0))}),box.addDataPropertyChangeListener(function(t){var i=t.property,n=t.source,a=t.newValue,o=e.getDataById(n.getId());n&&"parent"==i&&o&&o.setParent(a?e.getDataById(a.getId()):null)}),t.bind()},updateComponentFps=function(){if(allNetworks[1]){null==allNetworks[1]._renderCount&&(allNetworks[1]._renderCount=0);var e=allNetworks[1]._renderTime/allNetworks[1]._renderCount;isNaN(e)&&(e=0),e=Math.floor(e),Utils.updateFpsInfo(allNetworks[1]._renderCount,e),allNetworks[1]._renderCount=0,allNetworks[1]._renderTime=0}},initSerializationSettings=function(){twaver.SerializationSettings.setClientType("text","string"),twaver.SerializationSettings.setClientType("offsetX","float"),twaver.SerializationSettings.setClientType("offsetY","float"),twaver.SerializationSettings.setClientType("offset","float"),twaver.SerializationSettings.setClientType("selfID","string"),twaver.SerializationSettings.setClientType("resize","string"),twaver.SerializationSettings.setClientType("createType","string"),twaver.SerializationSettings.setClientType("faceIndex","int"),twaver.SerializationSettings.setClientType("parentID","string"),twaver.SerializationSettings.setClientType("HostID","string"),twaver.SerializationSettings.setClientType("selfID","string"),twaver.SerializationSettings.setClientType("zoom","float"),twaver.SerializationSettings.setClientType("originalWidth","float"),twaver.SerializationSettings.setClientType("originalHeight","float"),twaver.SerializationSettings.setClientType("offsetParent","float"),twaver.SerializationSettings.setClientType("object3dId","string"),twaver.SerializationSettings.setClientType("childrenIds","Array"),twaver.SerializationSettings.setClientType("face4","string"),twaver.SerializationSettings.setClientType("repeatObject","object"),twaver.SerializationSettings.setClientType("copyObject","string")},initNetwork2DListener=function(e){e.getElementBox().addDataBoxChangeListener(function(t){var i=e.zoom;if("remove"==t.kind)for(var n=t.data.getClient("selfID"),a=box.getDatas().toArray(),o=0;o<a.length;o++){var r=a[o];r.getClient("selfID")&&r.getClient("selfID")===n&&(0==r.getClient("mainVisible")?box.removeByDescendant(r,!0):box.remove(r,!0))}if("add"==t.kind){var r=t.data;r.getClient("originalWidth")||r.setClient("originalWidth",r.getWidth()/i),r.getClient("originalHeight")||r.setClient("originalHeight",r.getHeight()/i),"copy"===r.getClient("createType")&&r.setClient("object3dId",null)
}}),e.getElementBox().addDataPropertyChangeListener(function(t){var i=e.zoom,n=t.source;if(invalidateElementSizeFlag){var a=t.property;"size"==a?(n.setClient("originalWidth",n.getWidth()/i),n.setClient("originalHeight",n.getHeight()/i)):"width"==a?n.setClient("originalWidth",n.getWidth()/i):"height"==a&&n.setClient("originalHeight",n.getHeight()/i)}if("location"===t.property){if(n.getParent()&&n.getParent()instanceof ImageNode){var o=(n.getLocation().x-n.getParent().getLocation().x)/i,r=(n.getLocation().y-n.getParent().getLocation().y)/i;n.setClient("offsetParent",{x:o,y:r})}else if(invalidateImageNodeOffsetFlag&&n instanceof ImageNode){var s=n.getChildren().get(0);if(invalidateImageNodeOffsetFlag=!1,s){var o=(s.getLocation().x-n.getLocation().x)/i,r=(s.getLocation().y-n.getLocation().y)/i;s.setClient("offsetParent",{x:o,y:r})}}if(invalidateOffsetFlag&&n instanceof twaver.Follower&&n.getParent()&&n.getParent().getParent()instanceof ImageNode){var l=n.getParent().getParent(),o=n.getCenterLocation().x-l.getCenterLocation().x,r=n.getCenterLocation().y-l.getCenterLocation().y;n.setClient("offsetX",o/i),n.setClient("offsetY",r/i)}handleText2d(e)}}),e.getView().addEventListener("dblclick",function(t){var i=e.getElementAt(t);if(i instanceof twaver.Grid){var n=[{label:"Grid Rows:",id:"gridRows",value:i.getStyle("grid.row.count")},{label:"Grid Columns:",id:"gridColumns",value:i.getStyle("grid.column.count")},{label:"Grid Inner Padding:",id:"gridInnerPadding",value:i.getStyle("grid.padding")},{label:"Reset:",id:"resizeFlag",type:"checkbox",checked:!1}];Utils.showInputDialog(n,"Grid Properties",!0,updateGridProperties,this,[i,e],!0)}}),e.addInteractionListener(function(t){if(invalidateElementSizeFlag&&("lazyMoveEnd"==t.kind||"liveMoveEnd"==t.kind)){var i=e.getElementBox().getSelectionModel().getLastData(),n=t.event;if(null==i)return;var a,o=e.getLogicalPoint(n);if(i instanceof twaver.Follower&&i.getHost()&&(a=i.getHost()),a instanceof Node&&!twaver.Util.containsPoint(a.getRect(),o))return!0;if(a instanceof twaver.Grid&&a.getHost()!==i&&i instanceof twaver.Follower){var r=a.getCellObject(o),s=0,l=0,d=a.getCellRect();null!=r&&(s=Math.ceil(parseFloat(i.getWidth())/parseFloat(d.width)),l=Math.ceil(parseFloat(i.getHeight())/parseFloat(d.height)),i.setHost(a),i.setParent(a),i.setStyle("follower.row.index",r.rowIndex),i.setStyle("follower.column.index",r.columnIndex))}handleText2d(e)}!invalidateElementSizeFlag||"lazyResizeEnd"!=t.kind&&"liveResizeEnd"!=t.kind||(t.element instanceof twaver.Grid||t.element instanceof twaver.Follower)&&handleText2d(e)})},isTranslating=!1,clearEditorColor=function(){void 0!==faceObject&&(0==faceObject.faceIndex&&"red"===faceObject.element.getStyle("right.m.color")?faceObject.element.setStyle("right.m.color","white"):1==faceObject.faceIndex&&"red"===faceObject.element.getStyle("left.m.color")?faceObject.element.setStyle("left.m.color","white"):2==faceObject.faceIndex&&"red"===faceObject.element.getStyle("top.m.color")?faceObject.element.setStyle("top.m.color","white"):3==faceObject.faceIndex&&"red"===faceObject.element.getStyle("bottom.m.color")?faceObject.element.setStyle("bottom.m.color","white"):4==faceObject.faceIndex&&"red"===faceObject.element.getStyle("front.m.color")?faceObject.element.setStyle("front.m.color","white"):5==faceObject.faceIndex&&"red"===faceObject.element.getStyle("back.m.color")&&faceObject.element.setStyle("back.m.color","white"))},handleText2d=function(e){translate2DTo3D(e),serializeBox2DToFaceObject(e.zoom)},serializeBox2DToFaceObject=function(e){box2d.setClient("zoom",e);var t=new twaver.JsonSerializer(box2d).serialize();faceObject.element.setClient("face"+faceObject.faceIndex,t)},translate2DTo3D=function(e){var t=e.getElementBox();t.forEach(function(e){if(e instanceof twaver.Follower&&void 0!==e.getClient("text")){var t=e.getClient("text"),i=JSON.parse(t),n=e.getClient("selfID"),a=e.getClient("material");a&&(i.material=a);var o=!1;i.transparent&&(o=i.transparent);var r,s=e.getClient("object3dId"),l=Utils.Path+"brush_metal.png";if(s&&(r=objectIdFinder.findFirst(s)),"Cube"===i.classType){var d=i.args;r||(r=new mono.Cube(d.x,d.y,d.z),r.setStyle("m.texture.image",l),r.setStyle("m.texture.repeat",new mono.Vec2(1,1)),r.setClient("shape",i.shape),r.setClient("createType","createFrom2D"),r.setClient("faceIndex",faceObject.faceIndex),r.setClient("parentID",faceObject.element.getId()),r.setClient("selfID",n),r.setEditable(!0),r.setSelectable(!0),initElement(r)),set3DObjectStyle(i,r,s,e)}else"Template"===i.classType&&(r||(r=modelManager.loadComponentTemplate(box,i.id,!1,this,function(t){t&&(set3DObjectStyle(i,t,s,e),t.setClient("createType","createFrom2D"),t.setClient("selfID",n))})),r&&(set3DObjectStyle(i,r,s,e),r.setClient("createType","createFrom2D"),r.setClient("selfID",n)))}})},set3DObjectStyle=function(e,t,i,n){var a=n.getClient("offsetX"),o=n.getClient("offsetY"),r=n.getClient("originalWidth"),s=n.getClient("originalHeight"),l=Utils.Path+e.material,d=["front"];if(e.faces&&(d=e.faces),e.material)for(var c=0;c<d.length;c++){var h=d[c];t.setStyle(h+".m.texture.image",l)}var u=faceObject;if(u){{var g=(u.face,u.element),m=u.point;g.depth}t.setParent(g),t.setPosition(m.x,m.y,m.z),t.setWidth(r),t.setHeight(s),"cube"===e.shape&&t.setDepth(10),void 0!==a&&void 0!==o&&setPositionByRelative(t,a,o)}(!i||i&&!objectIdFinder.findFirst(i))&&"Cube"===e.classType&&box.add(t),n.setClient("object3dId",t.getId()),t.setClient("object3dId",t.getId())},zoomNetwork2d=function(){isTranslating=!0,invalidateElementSizeFlag=!1,allNetworks[0].getElementBox().forEach(function(e){var t=e.getCenterLocation();(!(e instanceof twaver.Follower&&e.getHost())||e instanceof twaver.Follower&&"unresize"===e.getClient("resize"))&&(e.setWidth(e.getClient("originalWidth")*allNetworks[0].zoom),e.setHeight(e.getClient("originalHeight")*allNetworks[0].zoom),e.setClient("width",e.getWidth()),e.setClient("height",e.getHeight()),e.getParent()instanceof ImageNode||e.setCenterLocation(t))}),setGridLocation(),isTranslating=!1,invalidateElementSizeFlag=!0},zoomResetNetwork2d=function(e){Utils.stopPropagation(e),allNetworks[0].zoom=1,zoomNetwork2d(allNetworks[0].zoom),faceObject&&serializeBox2DToFaceObject(allNetworks[0].zoom)};$zreset2d=zoomResetNetwork2d;var zoomInNetwork2d=function(e){Utils.stopPropagation(e),faceObject&&allNetworks[0].zoom>minZoom&&(allNetworks[0].zoom=allNetworks[0].zoom/zoomValue,zoomNetwork2d(allNetworks[0].zoom),serializeBox2DToFaceObject(allNetworks[0].zoom))};$zin2d=zoomInNetwork2d;var zoomOutNetwork2d=function(e){Utils.stopPropagation(e),faceObject&&(allNetworks[0].zoom=allNetworks[0].zoom*zoomValue,zoomNetwork2d(allNetworks[0].zoom),serializeBox2DToFaceObject(allNetworks[0].zoom))};$zon2d=zoomOutNetwork2d;var setGridLocation=function(){allNetworks[0].getElementBox().forEach(function(e){var t=e.getParent();if(t&&e instanceof twaver.Grid&&t instanceof ImageNode){var i=t.getLocation(),n=e.getClient("offsetParent"),a=0,o=0;n&&(a=n.x,o=n.y);var r=i.x+a*allNetworks[0].zoom,s=i.y+o*allNetworks[0].zoom;e.setLocation(r,s)}})},setPositionByRelative=function(e,t,i,n){var a=faceObject.faceIndex,o=faceObject.element,r=o.depth,s=o.width,l=o.height,d=(e.getParent().getPositionZ(),0),c=e.getClient("shape");if("horizontalCard"===c||"verticalCard"===c)switch(a){case 0:d=(s-e.depth)/2+s/2+n,e.setPosition(d,-i,-t);break;case 1:d=(s-e.depth)/2+s/2+n,e.setPosition(-d,-i,t);break;case 2:d=(l-e.depth)/2+l/2+n,e.setPosition(t,d,i);break;case 3:d=(l-e.depth)/2+l/2+n,e.setPosition(t,-d,-i);break;case 4:d=(r-e.depth)/2+r/2+n,e.setPosition(t,-i,d);break;case 5:d=(r-e.depth)/2+r/2+n,e.setPosition(-t,-i,-d)}else switch(a){case 0:n=(s-e.depth)/2+.1,e.setPosition(n,-i,-t);break;case 1:n=(s-e.depth)/2+.1,e.setPosition(-n,-i,t);break;case 2:n=(l-e.depth)/2+.1,e.setPosition(t,n,i);break;case 3:n=(l-e.depth)/2+.1,e.setPosition(t,-n,-i);break;case 4:n=(r-e.depth)/2+.1,e.setPosition(t,-i,n);break;case 5:n=(r-e.depth)/2+.1,e.setPosition(-t,-i,-n)}},updateGridProperties=function(e,t,i){if(i.gridRows!==e.getStyle("grid.row.count")&&e.setStyle("grid.row.count",i.gridRows),i.gridColumns!==e.getStyle("grid.column.count")&&e.setStyle("grid.column.count",i.gridColumns),i.gridInnerPadding!=e.getStyle("grid.padding")&&e.setStyle("grid.padding",i.gridInnerPadding),i.resizeFlag){var n=e.getParent(),a=n.getLocation(),o=a.x,r=a.y;e.setLocation(o,r)}e.setClient("resize",i.resize),handleText2d(t)},setupSkybox=function(){return},checkBoxHasElements=function(){var e=box.getNodes().toArray();if(e)for(var t=0;t<e.length;t++){var i=e[t];if(!(i instanceof mono.Floor||i instanceof mono.AmbientLight||i instanceof mono.PointLight||i.getClient(PropertyConsts.COMPONENTFLOOR)))return!0}return!1},installKeyListeners=function(e){e.addEventListener("keydown",function(e){var t=!1,i=Utils.isCtrlDown(e),n=Utils.isShiftDown(e);33===e.keyCode&&(moveSelection("pageup",n),t=!0),34===e.keyCode&&(moveSelection("pagedown",n),t=!0),37===e.keyCode&&(moveSelection("left",n),t=!0),38===e.keyCode&&(moveSelection("up",n),t=!0),39===e.keyCode&&(moveSelection("right",n),t=!0),40===e.keyCode&&(moveSelection("down",n),t=!0),46===e.keyCode&&deleteSelection(),i&&(65===e.keyCode&&(selectAll(),t=!0),67===e.keyCode&&(copySelection(),t=!0),86===e.keyCode&&(pasteSelection(),t=!0),76===e.keyCode&&(Utils.createLinkHandle(box),t=!0)),n&&(37===e.keyCode&&(rotateCamera("left:-180"),t=!0),39===e.keyCode&&(rotateCamera("right:180"),t=!0)),t&&(e.preventDefault(),e.stopPropagation())})},rotateCamera=function(e){mono.AniUtil.playCameraAnimation(allCameras[1],e)},selectAll=function(){box.copyAnchor=[];var e=box.getNodes().toArray(),t=box.getBillboards().toArray();if(e)for(var i=0;i<e.length;i++){var n=e[i];n instanceof mono.Plane||n.setSelected(!0)}if(t)for(var i=0;i<t.length;i++){var a=t[i];a.setSelected(!0)}},copySelection=function(){box.copyAnchor=[];var e=box.getNodes().toArray();if(e)for(var t=0;t<e.length;t++){var i=e[t];i instanceof mono.Entity&&i.isSelected()&&box.copyAnchor.push(i.getId())}},pasteSelection=function(){if(box.copyAnchor){box.getSelectionModel().clearSelection();for(var e=0;e<box.copyAnchor.length;e++){var t=box.copyAnchor[e];if(box.containsById(t)){var i=box.getDataById(t);if(i instanceof mono.Element){var n=i.clone(void 0,!0,!1);cloneChildrenNode(n,i,box);var a=n.getPosition();n.setPositionX(a.x+10),n.setPositionY(a.y+10),n.setPositionZ(a.z+10),i.editing=!1,initElement(n),box.add(n),box.getSelectionModel().setSelection(n)}}}}},cloneChildrenNode=function(e,t,i){if(t.getChildren().size()>0)for(var n=0;n<t.getChildren().size();n++){var a=t.getChildren().get(n),o=a.clone(void 0,!0,!1);o.setParent(e),a.getChildren().size()>0&&cloneChildrenNode(o,a,i),i.add(o)}},moveSelection=function(e,t){var i=box.getNodes().toArray();if(i)for(var n=t?.1:1,a=0;a<i.length;a++){var o=i[a];o instanceof mono.Entity&&o.isSelected()&&("pageup"===e&&o.setPositionZ(o.getPosition().z+n),"pagedown"===e&&o.setPositionZ(o.getPosition().z-n),"up"===e&&o.setPositionY(o.getPosition().y+n),"down"===e&&o.setPositionY(o.getPosition().y-n),"left"===e&&o.setPositionX(o.getPosition().x-n),"right"===e&&o.setPositionX(o.getPosition().x+n))}},deleteSelection=function(){var e=box.getSelectionModel().getSelection().toArray();if(e&&e.length>0){for(var t=(e.length,0);t<e.length;t++)if("createFrom2D"===e[t].getClient("createType"))return;var i="Sure to Delete?";if(window.confirm(i)){for(var t=0;t<e.length;t++){var n=e[t];0==n.getClient("mainVisible")?box.removeByDescendant(n,!0):box.remove(n,!0)}box2d.clear()}}},updateNetworkViewRatio=function(e,t,i,n){e.adjustBounds(i,n),t.aspect=i/n,t.updateProjectionMatrix(),e.render()},setNetworkAction=function(e,t){reset4CCamera(e,t);var i=document.getElementById("buttonsDiv");i.style.display="block",i.style.visibility="hidden"};$sneta=setNetworkAction;var reset4CCamera=function(e,t){var i=allCameras[t];if(i){i.look(new mono.Vec3(0,0,0)),i.setPosition(0,0,0),i.up.set(0,0,0);var n=500;0==e?(i.up.set(0,1,0),i.setPositionZ(n)):1==e?(i.up.set(0,1,0),i.setPositionX(n)):2==e?(i.up.set(0,0,-1),i.setPositionY(n)):3==e?(i.up.set(0,1,0),i.setPositionZ(-n)):4==e?(i.up.set(0,1,0),i.setPositionX(-n)):5==e?(i.setPositionY(-n),i.up.set(0,0,-1)):6==e&&(i.up.set(0,1,0),i.setPosition(n,n,2*n))}},centerElements=function(){var e=allNetworks[0],t=null,i=0,n=0,a=new twaver.List;if(e.forEachElementUI(function(i){e.isVisible(i.getElement())&&(t=null==t?i.getUnionBodyBounds():twaver.Util.unionRect(t,i.getUnionBodyBounds()))}),e.getElementBox().forEach(function(e){a.add(e)}),null!=t){var o=parseFloat(allTds[0].clientWidth),r=parseFloat(allTds[0].clientHeight);t.width<o&&(i=(o/e.getZoom()-t.width)/2-t.x),t.height<r&&(n=(r/e.getZoom()-t.height)/2-t.y),console.log(i,n),invalidateImageNodeOffsetFlag=!0,invalidateElementSizeFlag=!1,invalidateOffsetFlag=!1,twaver.Util.moveElements(a,i,n,!1),invalidateElementSizeFlag=!0,invalidateOffsetFlag=!0}},maximizeView=function(e,t){var i=e.getAttribute("class");if(maxedNetworkIndex=-1,"max"===i){if(e.setAttribute("class","rest"),tr1.removeChild(allTds[0]),tr1.removeChild(allTds[1]),0===t){var n=borderPane.getView(),a=n.offsetWidth-ACCORDION_WIDTH;allNetworks[t].getView().style.width=a+"px"}borderPane.setCenter(allTds[t]),maxedNetworkIndex=t}else e.setAttribute("class","max"),borderPane.setCenter(table),allTds[t].removeAttribute("style"),allTds[t].style.position="relative",tr1.appendChild(allTds[0]),tr1.appendChild(allTds[1]),setTableBorder();if(void 0!==faceObject){var o,r,s,l=judgeTextureAndSize(faceObject.faceIndex,faceObject.element),d=l.width,c=l.height;if("max"===i){var n=borderPane.getView(),a=n.offsetWidth-ACCORDION_WIDTH,h=n.offsetHeight;o=Math.floor(Math.log(h/c)/Math.log(1.1)),r=Math.floor(Math.log(a/d)/Math.log(1.1))}else o=Math.floor(Math.log(allNetworks[0].getView().clientHeight/c)/Math.log(1.1)),r=Math.floor(Math.log(allNetworks[0].getView().clientWidth/d)/Math.log(1.1));s=Math.min(o,r),allNetworks[0].zoom=Math.pow(zoomValue,s),zoomNetwork2d(allNetworks[0].zoom)}layout4CGUI(),setTimeout(function(){0===t&&centerElements()},20)};$mmview=maximizeView;var zoomToOverView=function(){allNetworks[1].zoomEstimateOverview();var e=allNetworks[1].getNetworkBoundingBox(),t=e.max.x-e.min.x,i=e.max.y-e.min.y,n=e.max.z-e.min.z,a=Math.max(t,i);a=Math.max(a,n);var o=allNetworks[1].getInteractions()[0];o.maxDistance=parseInt(1.2*a),comMaxDistance=parseInt(1.2*a);var r=allNetworks[1].getCamera();r.setFar(parseInt(1.8*a)),comFarPlane=parseInt(1.8*a)};$zoomoverview=zoomToOverView,$clickbutton=function(){if(veilViewFlag){var e=document.getElementById("veilView");e.setAttribute("class","veilView"),veilViewFlag=!1}else{var e=document.getElementById("veilView");e.setAttribute("class","veilView_hover"),veilViewFlag=!0}var t=document.getElementById("buttonsDiv");t.style.visibility="hidden"===t.style.visibility?"visible":"hidden"};var createDefaultInteraction=function(e){var t=new mono.DefaultInteraction(e);return t.keyboardEnable=!1,t.zoomSpeed=parseFloat(comZoomSpeed),t.maxDistance=parseFloat(comMaxDistance),t.setUpdateIntervalTime(20),t.setEasing(enableEasing),t},installInteraction=function(e,t,i){if(void 0===t)for(var n=0;n<allNetworks.length;n++)1==n&&toolBar3D.setInteraction(e);else 1==i&&toolBar3D.setInteraction(e)};$iInteraction=function(e){toolBar3D.eInteraction(e,!1)};var createTagElement=function(e,t,i){var n=document.createElement(e);return n.setAttribute("vertical-align","top"),t&&t.appendChild(n),i&&n.appendChild(i),n};table=createTagElement("table"),tr1=createTagElement("tr",table),td1=createTagElement("td",tr1),td2=createTagElement("td",tr1),allTds=[td1,td2];_refreshCategory=function(){Utils.categoryCache={},Utils.initCategory(Utils.categoryCache,"tpl_categories")},_pickCategory=function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1;var t=new SelectedTreePane("templateCategory");Utils.initCategory(Utils.categoryCache,"tpl_categories",PropertyConsts.SCOPE_PRIMITIVE,function(){t.setCategoryCache(Utils.categoryCache[PropertyConsts.TYPE_COMPONENT]),t.init()})};var viewFloor,show3DObjectDialog=function(e){var t=box.getDataById(e);if(t){var i={};i.element=t,new ComponentDialog(box,i).showDialog()}},showPropertyDialog=function(e){for(var t,i=0;i<e.length;i++){var n=e[i];if(!n.element.getClient(PropertyConsts.COMPONENTFLOOR)&&box.getSelectionModel().contains(n.element)){t=n;break}}t&&new ComponentDialog(box,t).showDialog()},generateFloorSizeValue=function(e){return e===PropertyConsts.FloorSize.SMALL?1:e===PropertyConsts.FloorSize.MEDIUM?5:e===PropertyConsts.FloorSize.LARGE?10:1},createViewFloor=function(){var e=generateFloorSizeValue(floorSize);if(floorStyle===PropertyConsts.FloorStyle.BUFFER_NODE_FLOOR){var t=new mono.List,i=300*e;t.add({x:-i,y:-i}),t.add({x:i,y:-i}),t.add({x:i,y:i}),t.add({x:-i,y:i});var n=Utils.Path+"transparent_floor.png",a=10*e,o=new MaterialDesc;o.repeat=[a,a],o.texture=n,o.tType=1,o.type="basic",o.transparent=!0;var r=GeometryTranslater.get3DGeometry(o,"mono.Floor",null,null,null,null,t)}else{var r=new mono.Plane(1e3*e,1e3*e,20*e,20*e);r.setStyle("m.wireframe",!0).setStyle("m.color","orange").setStyle("m.side",mono.DoubleSide),r.setRotation(Math.PI/2,Math.PI,Math.PI/2),r.setSelectable(!1),r.setEditable(!1),r.setClient(PropertyConsts.COMPONENTFLOOR,!0)}viewFloor=r},handleFaceImage=function(e,t){if(-1!==maxedNetworkIndex){var i=document.getElementById("max-1");$mmview(i,1)}if(e&&t&&t.element instanceof mono.Cube){box2d.clear(),box.forEach(function(e){e instanceof mono.Cube&&(e.setStyle("right.m.color","white"),e.setStyle("left.m.color","white"),e.setStyle("top.m.color","white"),e.setStyle("bottom.m.color","white"),e.setStyle("front.m.color","white"),e.setStyle("back.m.color","white"))});var n=t.element.getClient("face"+t.faceIndex);if(0==t.faceIndex?t.element.setStyle("right.m.color","red"):1==t.faceIndex?t.element.setStyle("left.m.color","red"):2==t.faceIndex?t.element.setStyle("top.m.color","red"):3==t.faceIndex?t.element.setStyle("bottom.m.color","red"):4==t.faceIndex?t.element.setStyle("front.m.color","red"):5==t.faceIndex&&t.element.setStyle("back.m.color","red"),n){invalidateElementSizeFlag=!1;{JSON.parse(n)}new twaver.JsonSerializer(box2d).deserialize(n),box2d.forEach(function(i){if(i instanceof ImageNode){var n,a=parseInt(t.faceIndex),o=judgeTextureAndSize(a,t.element),r=o.texture,s=(o.width,o.height,t.element.getStyle(r));if(Utils.registerImage(s,e,"component"),t.element.getStyle("m.texture.repeat")[a]){var l=t.element.getStyle("m.texture.repeat")[a];n=[l.x,l.y]}i.setClient("repeat",n)}else if(i instanceof twaver.Follower){var s=i.getImage();s&&Utils.registerImage(s,e,"component")}}),e.zoom=box2d.getClient("zoom"),invalidateElementSizeFlag=!0}else{var a,o,r,s,l,d,c=parseInt(t.faceIndex);a=judgeTextureAndSize(c,t.element),o=a.texture,r=a.width,s=a.height,tmp3DNode=t.element,e.zoom=1;var h=new ImageNode,u=tmp3DNode.getStyle(o);Utils.registerImage(u,e,"component"),tmp3DNode.getStyle("m.texture.repeat")[c]&&(d=tmp3DNode.getStyle("m.texture.repeat")[c],l=[d.x,d.y]),h.setSize(r,s),h.setClient("repeat",l),h.setClient("repeatObject",l),h.setClient("groupId",h.getId()),h.setImage(u),h.setCenterLocation(e.getView().clientWidth/2,e.getView().clientHeight/2),box2d.add(h);var g=Math.floor(Math.log(e.getView().clientHeight/s)/Math.log(1.1)),m=Math.floor(Math.log(e.getView().clientWidth/r)/Math.log(1.1)),p=Math.min(g,m);e.zoom=Math.pow(zoomValue,p),zoomNetwork2d(e.zoom)}}},judgeTextureAndSize=function(e,t){var i,n,a,o=[];switch(e){case 0:i="right.m.texture.image",n=t.depth,a=t.height,o[0]="z",o[1]="y";break;case 1:i="left.m.texture.image",n=t.depth,a=t.height,o[0]="z",o[1]="y";break;case 2:i="top.m.texture.image",n=t.width,a=t.depth,o[0]="x",o[1]="z";break;case 3:i="bottom.m.texture.image",n=t.width,a=t.depth,o[0]="x",o[1]="z";break;case 4:i="front.m.texture.image",n=t.width,a=t.height,o[0]="x",o[1]="y";break;case 5:i="back.m.texture.image",n=t.width,a=t.height,o[0]="x",o[1]="y";break;default:i="front.m.texture.image",n=t.width,a=t.height,o[0]="x",o[1]="y",e=4}return{texture:i,width:n,height:a,faceIndex:e,project:o}},handleCompDataPropertyChange=function(e){var t=e.source,i=(t.getId(),e.newValue);if("scale"===e.property){var n=scaleMinLimit,a=scaleMaxLimit,o=!0,r=i.x,s=i.y,l=i.z;i.x<n?(r=n,o=!1):i.x>a&&(r=a,o=!1),i.y<n?(s=n,o=!1):i.y>a&&(s=a,o=!1),i.z<n?(l=n,o=!1):i.z>a&&(l=a,o=!1),o||t.setScale(r,s,l)}else if("C:animation"==e.property)if(Utils.isNotNull(i)){var d=animationManager.getAnimationById(t.getId());if(d)d.setAnimation(i),d.setAnimationGroup(t.getClient("animationGroup"));else{var d=new mono.AnimationData(t.getId(),t,i,t.getClient("animationGroup"));animationManager.add(d)}}else{var d=animationManager.getAnimationById(t.getId());animationManager.remove(d)}else if("C:animationGroup"==e.property){var d=animationManager.getAnimationById(t.getId());d&&d.setAnimationGroup(i)}},handleCompDataBoxPropertyChange=function(e){if("add"==e.kind){if(0==e.data.getClient("mainVisible")&&(e.data.setStyle("m.transparent",!0),e.data.setStyle("m.opacity",.001)),e.data.getRoot()&&0==e.data.getRoot().getClient("mainVisible")&&(e.data.setEditable(!1),e.data.setSelectable(!1)),e.data.getClient("animation")){var t=e.data,i=animationManager.getAnimationById(t.getId());if(!i){var i=new mono.AnimationData(t.getId(),t,t.getClient("animation"),t.getClient("animationGroup"));animationManager.add(i)}}selectStyle&&Utils.setElementSelectStyle(e.data,selectStyle)}else if("remove"==e.kind&&e.data.getClient("animation")){var i=animationManager.getAnimationById(e.data.getId());i&&animationManager.remove(i)}Utils.updateBoxInfo(box)},getMainElement=function(e){if(e){var t=e.getParent();if(t)if(Utils.isNotNull(t.getClient("mainVisible"))){if(!isFloorElement(t))return t}else getMainElement(t);else if(!isFloorElement(e))return e}},isFloorElement=function(e){return e?e instanceof mono.Floor||e.getClient(PropertyConsts.COMPONENTFLOOR):!1},setFirstSelectElement=function(){var e=allNetworks[1];e.getFirstSelectElement=function(e){if(null!=e){for(var t,i=0;i<e.length;){var n=e[i].element;if(!Utils.isNotNull(n.getClient("mainVisible"))&&!isFloorElement(n)){t=n;break}i++}if(t){var a=getMainElement(t);return a||isFloorElement(t)||(a=t),a}}}},removeFirstSelectElement=function(){var e=allNetworks[1];e.getFirstSelectElement=function(e){if(null!=e){for(var t,i=0;i<e.length;){var n=e[i].element;if(n.isSelected&&!isFloorElement(n)){t=n;break}i++}return t}}},showComponentDialog=function(){if(checkBoxHasElements()&&!saveTemplate&&confirm("Save as Template?"))return void saveIntoLocalStorage();clearAllElements(!0);var e="<div class='room mar'><span class='r_title'>Start a new Room</span><p>Drag-and-drop room shapes to the canvas or draw a free shape.</p><img src='images/033.png' /><a><button class='new_button sr' onclick='Utils.createRoom(\"component\")'>Start a new Room</button></a></div><img class='or' src='images/index01_11.png' /><div class='room'><span class='r_title'>Start a new Component</span><p>Use basic shapes to assemble a component.</p><img src='images/022.png' /><a><button type='button' class='new_button sr' onclick='Utils.createComponent(\"component\")'>Start a new Component</button></a></div><img class='or' src='images/index01_11.png' /><div class='link'><span class='link_title'>Quick Link</span><ul><li><a target='_blank' href='http://www.mono-design.cn:8888/'><span class='link_title01'>Help</span></a></li><li><a target='_blank' href='demo/index.html'><span class='link_title01'>Demo</span></a></li><li><a target='_blank' href='imageLibrary.html'><span class='link_title01'>Image Library</span></a></li><li><a target='_blank' href='imageCategory.html'><span class='link_title01'>Image Category</span></a></li><li><a target='_blank' href='templateLibrary.html'><span class='link_title01'>Template Library</span></a></li><li><a target='_blank' href='templateCategory.html'><span class='link_title01'>Template Category</span></a></li><li><a target='_blank' href='userManagement.html'><span class='link_title01'>User Management</span></a></li></ul></div>";Utils.showDialog("newEditor",e,"New Design",!1,!1,"new_editor")};$scDialog=showComponentDialog;var importDrawing=function(){setTimeout(function(){var e="<div><label class='field'>File Path:</label><input id='files' type='file' class='input' size='30' multiple='multiple'/></div>";Utils.showDialog("import",e,"Import Drawing",!0,!1,null,importObjDrawing,this,null,["files"])},100)};$importDrawing=importDrawing;var importObjDrawing=function(e){if(e.files&&e.files.length>0){for(var t,i,n={},a=0;a<e.files.length;a++){var o=e.files[a];if(o.type){if(o.type.startsWith("image")){var r=o.name.substring(0,o.name.indexOf(".")).toLowerCase();n[r]=o}}else o.name.indexOf(".")>0&&(o.name.endsWith("obj")?t=o:o.name.endsWith("mtl")&&(i=o))}if(!t)return void alert("File with suffix '.obj' is required");var s=new mono.OBJMTLLoader;box.startBatch(),s.loadFiles(t,i,n,function(e){for(var t=e.getBoundingBoxWithChildren(),i=t.size(),n=e.getPosition(),a=i.x+n.x+100,o=i.y+n.y+100,r=i.z+n.z+100,s=0;s<allNetworks.length;s++){var l=allCameras[s];l&&(0==s?l.setPositionZ(r):1==s?l.setPositionX(a):l.setPosition(a,o,r))}box.addByDescendant(e),box.getSelectionModel().setSelection(e.getChildren()),box.endBatch()})}},exportCompDrawing=function(){clearEditorColor();var e="<div><table><tr><td><label class='field'>Export Images:</label></td>";e+="     <td><input id='files' type='checkbox' class='input'/></td></tr>",e+="</table></div>",Utils.showDialog("export",e,"Export Template",!0,!1,null,exportCompTemplate,this,null,["files"])};$exportDrawing=exportCompDrawing;var exportCompTemplate=function(e){var t=modelManager.organizeComponentsDrawing(box),i=!1;if(e)var i=e.files;ZipFileUtils.exportTemplate(t,i,!1,null,null)},importTemplate=function(){var e="<div><label class='field'>File Path:</label><input id='files' type='file' class='input' size='30'/></div>";Utils.showDialog("import",e,"Import Template",!0,!1,null,importTemplateFile,this,null,["files"])};$importTemplate=importTemplate;var importTemplateFile=function(e){if(e.files&&e.files.length>0){var t=e.files[0];if(t.name.indexOf(".")>0){var i=t.name.split(".");if("json"!=i[1])return void alert("file format should be json");var n=new FileReader;n.readAsText(t),n.onloadend=function(){n.error?console.log(n.error):modelManager.loadComponentTemplateFromContents(box,n.result,!1,!0)}}}},exportComponentToFlex3D=function(){var e=new TGL.JsonSerializer(box);e.filterFunction=function(){return!0};var t=e.serialize();localStorage.setItem("flexJson",t),window.open("./flex3D.html")};$ectf=exportComponentToFlex3D;var clearAllElements=function(e){if(e||confirm("Remove all data?")){var t=box.getNodes().toArray();if(t)for(var i=0;i<t.length;i++){t[i]}box.clear(),allNetworks[0].getElementBox().clear(),showFloor&&box.add(viewFloor)}};$clearAEs=clearAllElements;var gid=null,openTemplateDialog=function(){var e=new TemplatesPanel;e.init(),Utils.showDialog("templatepickpane",e.getView(),"Open Template",!0,!1,null,function(){var t=e.getLastNetworkData();return t?(comTemplateId=t.getClient("templateId"),gid=t.getClient("gid"),void modelManager.loadComponentTemplate(box,comTemplateId,!0)):(alert("Please select a template."),!1)},[e])};$optDialog=openTemplateDialog;var publishTemplateDialog=function(){var e=new TemplatesPanel;e.init(),Utils.showDialog("templatepickpane",e.getView(),"Select Template to Publish",!0,!1,null,function(){var t=e.getLastNetworkData();if(!t)return alert("Please select a template."),!1;var i=t.getClient("templateId"),n=t.name,a=new TemplatesPanel(!0);a.init(),Utils.showDialog("publicCategoryPickPane",a.getView(),"Select Public Category to Publish",!0,!1,null,function(){var e=a.getSelectedTreeElement();if(!e)return alert("Please select a public category to publish."),!1;{var t=e.getId();e.getName()}Utils.publishTemplate(i,n,t)},[a])},[e])};$pbltDialog=publishTemplateDialog;var unpublishTemplateDialog=function(){var e=new TemplatesPanel(!0);e.init(),Utils.showDialog("fromTemplatePickPane",e.getView(),"Select Template to Unpublish",!0,!1,null,function(){var t=e.getLastNetworkData();if(!t)return alert("Please select a template."),!1;var i=t.getClient("templateId"),n=t.name,a=new TemplatesPanel(!1);a.init(),Utils.showDialog("toTemplatePickPane",a.getView(),"Select Private Category to Unpublish",!0,!1,null,function(){var e=a.getSelectedTreeElement();if(!e)return alert("Please select a private category to unpublish."),!1;{var t=e.getId();e.getName()}Utils.unpublishTemplate(i,n,t)},[a])},[e])};$upbltDialog=unpublishTemplateDialog;var alignC3dObjects=function(){align3DObjects(box)};$acdob=alignC3dObjects;var setParentRelationShip=function(){var e=box.getSelectionModel().getSelection(),t=e._as,i=e.size();if(1>=i)return void alert("At least need select 2 objects");if(confirm("First selected object will be other's parent. Continue?")){var n=t[0];if(n instanceof mono.Billboard)return void alert("Billboard can't be parent of other objects.");for(var a=1;i>a;a++){var o=t[a];if(o.getParent()!==n){var r=n.worldMatrix,s=(new mono.Mat4).getInverse(r);if(null!=o.getParent()){var l=o.getParent(),d=l.worldMatrix;o.setParent(null),o.applyMatrix(d)}o.setParent(n),o.applyMatrix(s)}}}};$bprs=setParentRelationShip;var cancelParentRelationShip=function(){var e=box.getSelectionModel().getSelection(),t=e._as,i=e.size();if(1>=i)return void alert("Select at least 2 objects");if(confirm("Cancel first selected object as others' parent?"))for(var n=t[0],a=1;i>a;a++){var o=t[a];if(null!=o.getParent()){var r=n.worldMatrix;o.setParent(null),o.applyMatrix(r)}}};$rprs=cancelParentRelationShip;var componentEditorSetting=function(){var e=new SettingDialog(!0,ambientLight,pointLights,null,box,allNetworks);e.showSettingDialog()};$cpesetting=componentEditorSetting;var saveIntoLocalStorage=function(){showSaveAsDialog()};$saveToDB=saveIntoLocalStorage;var saveIntoTemplate=function(e){showAssembleConfigure(e),clearEditorColor(),saveTemplate=!0},save=function(e,t,i,n){var a,o=document.getElementById("templateCategory");o&&(a=o.categoryId),box.forEach(function(e){e.setClient("scaleValue",comScaleValue?comScaleValue:"1m")}),modelManager.exportComponentToTemplate(box,e,i,n.templateName,a,comTemplateId,n.author,n.tags,n.isEntity,t,gid),comTemplateId=null,gid=null,n.author&&localStorage.setItem(PropertyConsts.TEMPLATE_AUTHOR,n.author)},showSaveAsDialog=function(){if(animationManager.resetAllAnimations(),comTemplateId){var e="Save Template",t=[{label:"","class":"lb-save-template",id:"santemp",name:"templates",type:"radio",checked:!0,inner:"Save as new template"},{label:"","class":"lb-save-template",id:"owtemp",name:"templates",type:"radio",checked:!1,inner:"Overwrite the old template"}];Utils.showInputDialog(t,e,!0,function(e){saveIntoTemplate(e.owtemp)})}else saveIntoTemplate(!1)},showAssembleConfigure=function(e){var t=allNetworks[1],i=t.getView().width,n=t.getView().height;if(0===i&&0===n)return void alert("The perspective view is visible");var a=n>i?i:n,o=i>a?(i-a)/2:0,r=n>a?(n-a)/2:0,s=showAxis,l=showAxisText,d=showFloor;showFloor&&(box.remove(viewFloor),showFloor=!1),s&&(t.setShowAxis(!1),showAxis=!1),l&&(t.setShowAxisText(!1),showAxisText=!1);var c=box.getSelectionModel().getSelection(),h=c.toList();c.size()>0&&box.getSelectionModel().clearSelection(),t.setClearAlpha(0),setTimeout(function(){imageIcon=t.toImageData("PNG",{x:o,y:r,w:a,h:a},42,42);var i=t.toImageData("PNG",{x:o,y:r,w:a,h:a},180,180);d!=showFloor&&(box.add(viewFloor),showFloor=!0),s!==showAxis&&(t.setShowAxis(s),showAxis=!0),l!==showAxisText&&(t.setShowAxisText(l),showAxisText=!0),h.size()>0&&box.getSelectionModel().setSelection(h),t.setClearAlpha(1);var n=["templateName"],c=localStorage.getItem(PropertyConsts.TEMPLATE_AUTHOR)||"",u="<div style='padding-bottom:40px;'><div><label class='field'>Image Icon:</label><img src="+imageIcon+" style='margin-left:5px; margin-top:-10px'></div><div style='height:40px'><label class='field'></label><span style='font:12px Calibri; color:red; float:left; margin-bottom:5px'>Adjust component in the perspective view <br>to generate your desired icon.</span></div><div style='height:40px'><label class='field'>Template Name:</label><input id='templateName' class='input' size='30'/></div>";
loadResource===TYPE_CLOUD&&(u+="<div style='height:40px'><label class='field'>Template Category:</label><input id='templateCategory' class='input' style='border-right-width: 0px; width: 246px;' size='30'/><input type='image' src='images/arrowdown2.png' onclick='_pickCategory(event)'/><input type='image' src='images/refresh_button.png' onclick='_refreshCategory(event)'/></div><div style='height:40px'><label class='field'>Author:</label><input id='author' class='input' size='30' value = '"+c+"'/></div><div style='height:40px'><label class='field'>Tags:</label><input id='tags' class='input' size='30'/></div><div style='height:40px'><label class='field'></label><label style='margin-left:10px;'>i.e. tag1, tag2, tag3...</label></div><div style='height:40px'><label class='field'></label><input id='isEntity' type = 'checkbox'/><span> Generate Entity when loaded the Template</span></div>",n.push("templateCategory"),n.push("author"),n.push("tags"),n.push("isEntity")),Utils.showDialog("save",u,"Save Template",!0,!1,null,save,this,[imageIcon,e,i],n)},100)},exportHtml5Json=function(){var e=new mono.DataBox,t=new mono.JsonSerializer(box);t.filterFunction=function(e){return!(isFloorElement(e)||e instanceof mono.Light)};var i=new mono.JsonSerializer(e);i.deserialize(t.serialize()),e.forEach(function(e){if(!(e instanceof mono.Light)){var t=e.getStyle("m.texture.image");if(t){var i=Utils.handlerTexture(t,!0,!0);e.setStyle("m.texture.image",i)}}}),i.filterFunction=function(e){return!(isFloorElement(e)||e instanceof mono.Light)};var n=i.serialize();if(twaver.Util.isIE){var a=document.createElement("iframe");document.body.insertBefore(a),a.style.display="none",a.contentDocument.write(n),a.contentDocument.execCommand("SaveAs",!0),document.body.removeChild(a)}else{var o="data:text/json;charset=utf8,"+encodeURIComponent(n);window.open(o,"network")}};$ehj=exportHtml5Json;var preview3DView=function(){var e=new mono.JsonSerializer(box);e.filterFunction=function(e){return!isFloorElement(e)};var t=e.serialize();console.log(box.getLights()),console.log(t),localStorage.setItem("flexJson",t),window.open("./components-preview.html")};$p3d=preview3DView;var setAccordionFunction=function(e){e.setRefreshFunction(refreshComponentAccordion),e.setRemoveItemFunction(removeComponentItem),e.setClearTemplateFunction(clearAllComponents)},refreshComponentAccordion=function(e){if(modelManager.loadSharedPrimitive(),modelManager.loadSharedAssemble(),loadResource===TYPE_LOCAL)for(var t=modelManager.getModelLib().getCategories(),i=0;i<t.length;i++)t[i].id==e&&insertComponentCategory(t[i]);else{var n=e==TEMPLATES?PropertyConsts.SCOPE_PRIMITIVE:PropertyConsts.SCOPE_PUBLIC,a=getCategoryIdfromLocalStorage(n,!0)||2,o=getCategoryValuefromLocalStorage(n,!0)||"Component";freshCompCategoryContent(a,n,e,o)}},removeComponentItem=function(e){modelManager.removeShareCategory(TEMPLATES,e)},clearAllComponents=function(){localStorage.setItem(LIB_COMPONENTS,"{}"),localStorage.removeItem(COMPONENT_TEMPLATES)},modelManager=new modellib.ModelManager,componentJsonFiles={"ComponentPrimitives.json":"new","ComponentAssembles.json":"new","ComponentLib.json":"new"},updateCModelLibLoadStatus=function(e,t){componentJsonFiles[e]=t,"executed"===t&&delete componentJsonFiles[e],0===Object.keys(componentJsonFiles).length&&(accordion4C.setModelManager(modelManager),doTheCFollowing())},initCModelLib=function(){for(var e in componentJsonFiles)modelManager.loadResourceFile(e,updateCModelLibLoadStatus)};parseComponentPrimitives=function(e){modelManager.getModelLib().parsePrimitives(e,"ComponentPrimitives.json",updateCModelLibLoadStatus,this),modelManager.loadSharedPrimitive()},parseComponentAssembles=function(e){modelManager.getModelLib().parseAssembles(e,"ComponentAssembles.json",updateCModelLibLoadStatus,this),modelManager.loadSharedAssemble()},parseComponentLib=function(e){modelManager.getModelLib().parseLib(e,"ComponentLib.json",updateCModelLibLoadStatus,this)};var network3d,defaultInteraction,toolBar,interactions,targetFlagElement,originalFlagElement,roomTemplateId,roomSidebar,roomAnimationManager,room3dSidebar,ruler,floorPane,networkBackgroundData,sidebarLayerbox,doTheCFollowing=function(){fillComponentCategoryView(),accordion4C.expand("Component"),accordion4C.accordion.invalidate()},fillComponentCategoryView=function(e){for(var t=modelManager.getModelLib().getCategories(),i=0;i<t.length;i++){var n=t[i];if(loadResource!==TYPE_LOCAL||n.id!==PUBLIC_TEMPLATES)if(e){if(e===n.id){insertComponentCategory(n);break}}else insertComponentCategory(n)}loadResource===TYPE_CLOUD&&(insertCCloudCategory(Utils.categoryCache,0,TEMPLATES),insertCCloudCategory(Utils.publicCategoryCache,1,PUBLIC_TEMPLATES))},insertCCloudCategory=function(e,t,i){var n=getCategoryValuefromLocalStorage(t,!0)||"Component",a=new TreeComboBox(null,"tpl_categories",!1,null,t,function(e){return localStorage.setItem(t?PropertyConsts.COMPONENT_PUBLIC_CATEGORY:PropertyConsts.COMPONENT_PRIVATE_CATEGORY,e.categoryId+":"+e.categoryValue),freshCompCategoryContent(e.categoryId,t,i,e.categoryValue)},n,null,"component",!0);a.getView().setAttribute("class","accordion-category"),a.getInputView().setAttribute("class","teee-comboNode-input accordion-comboNode-input"),accordion4C.addCategory(i,!0,t),accordion4C.addTreeComboBoxPane(i,a)},freshCompCategoryContent=function(e,t,i,n){Utils.isNotNull(e)&&(accordion4C.clearCategoryContent(i),modelManager.searchTemplatesFromDB("Rooms",t,function(e){handleComponentCategoryContent(e,i,n)},this,e))},insertCItemIntoCategory=function(e,t,i,n,a,o){if(e){var r;r=t==TEMPLATES?warpComponentTemplateItem(n,a,o):modelManager.wrapModelNodeIntoItem(t,n,a,o),r&&(t==TEMPLATES&&(r.labelClass="template-label-class"),e.addItemData(t,i,r))}},insertComponentCategory=function(e){var t=e.contents,i=e.actions;if(e.id===TEMPLATES||e.id===PUBLIC_TEMPLATES){t=[],accordion4C.addCategory(e.id,!0,e.id===PUBLIC_TEMPLATES?!0:!1);var n=localStorage.getItem(LOAD_RESOURCE_TYPE);if(n===TYPE_CLOUD)return}else accordion4C.addCategory(e.id);var a=JSON.parse(localStorage.getItem(e.id));a&&(t=t.concat(a.contents));for(var o=0;o<t.length;o++)for(var r=t[o],s=r.children,l=0;l<s.length;l++)r.subtitle!=SUBTITLE_MODEL&&(e.id===TEMPLATES?r.subtitle==SUBTITLE_COMPONENT&&insertCItemIntoCategory(accordion4C,e.id,r.subtitle,s[l].id,s[l].name,s[l].thumbnail):insertCItemIntoCategory(accordion4C,e.id,r.subtitle,s[l].id,s[l].name,s[l].thumbnail));if(i)for(var o=0;o<i.length;o++){var d=i[o];accordion4C.addAction(e.id,d)}},handleComponentCategoryContent=function(e,t,i){var n=JSON.parse(e);if(n.error)return void alert(n.error);var a=n.value;i&&accordion4C.clearTemplateSub(t,i);for(var o=0;o<a.length;o++){var r=a[o],s={id:r.id,label:r.name,image:r.icon,isTemplate:!0,type:r.type,classType:"Template",labelClass:"template-label-class"};i?accordion4C.addITemplateData(t,i,s,r):accordion4C.addItemData(t,r.category,s)}},warpComponentTemplateItem=function(e,t,i){var n=t,a=i?i:"crash.png",o={className:"Component",image:a,classType:"Template",actionType:"loadComponentTemplate",tooltip:n,label:n,dragImage:a,id:e};return o},ACCORDION_WIDTH=295,network=new GridNetwork,box2d=network.getElementBox(),lock2d=!1,borderPane=new twaver.controls.BorderPane,accordionPane=new AccordionPane,sheetPane=new PropertySheetPane(box2d),canvas3d=document.createElement("canvas"),box3d=new mono.DataBox,camera=new mono.PerspectiveCamera(30,1.5,10,1e4),bottomLayer=new twaver.Layer,wallLayer=new twaver.Layer,contentsLayer=new twaver.Layer,topLayer=new twaver.Layer,resize=null,ambientLight=new mono.AmbientLight(11184810),pointLights=[Utils.createPointLight(0,!1),Utils.createPointLight(1e4,!1),Utils.createPointLight(-1e4,!1),Utils.createPointLight(5e3),Utils.createPointLight(-5e3,!1)],showAxis=!1,showAxisText=!1,showCoord=!1,showDim=!1,showGrid=!0,showRulerGuides=!1,showRuler=!0,enableScale=!1,isSettingRotation=!1,showPropertySheet=!1,loadResource=TYPE_LOCAL,cloudKey="",cloudPassword="",needUpdateSize=!0,decimalNumber=2,isFullRotation=!1,zoomSpeed=1.5,rotateSpeed=1,panSpeed=.3,maxDistance=5e3,minDistance=20,nearPlane=10,farPlane=1e4,fov=30,interactions2d=[new RoomInteraction(network),new MonoEditInteraction(network,!1),new twaver.vector.interaction.DefaultInteraction(network)],finderByHostNodeId=new twaver.QuickFinder(box2d,"hostNodeId","client"),finderByFloorName=new twaver.QuickFinder(box2d,"floorName","client"),saveAsTemplate=!1,removeFlag=!0,isShow3D=!1,isShowed3D=!1,start=function(e){mono.SerializationSettings.setClientType("businessId","string"),_twaver.ua.isTouchable=!1,init2D(),init3D(),show2D(),e||showEditorDialog(),Utils.loadPropertiesFromLocalStorage(!1,ambientLight,pointLights,box3d,[network,network3d]),ruler.setShowGuides(showRulerGuides),ruler.setShowRuler(showRuler)};$startEditor=start;var init2D=function(){floorPane=new FloorPane(network),floorPane.init(),document.getElementById("floor2d")&&document.getElementById("floor2d").appendChild(floorPane.getView()),network.enableSingleOrientationMove=!0,network.getView().setAttribute("draggable","true"),network.setEditPointFillColor("yellow"),network.setEditPointOutlineColor("#333333"),network.setEditPointOutlineWidth(1),network.setEditPointSize(10),network.setResizePointSize(0),network.setToolTipEnabled(!1),network.setZoomManager(new twaver.vector.LogicalZoomManager(network,!0)),network.setMaxZoom(3),network.setMinZoom(.2),network.setInteractions(interactions2d),network.setKeyboardRemoveEnabled(!1),network.setRotatePointFillColor("yellow"),installNetwork2dFunctions(),installNetwork2dListeners(),box2d.getLayerBox().add(bottomLayer),box2d.getLayerBox().add(wallLayer),box2d.getLayerBox().moveToBottom(wallLayer),box2d.getLayerBox().moveToTop(bottomLayer),box2d.getLayerBox().add(contentsLayer),box2d.getLayerBox().moveToBottom(contentsLayer),box2d.getLayerBox().add(topLayer),box2d.getLayerBox().moveToBottom(topLayer),Utils.registerImage("images/floor02_3d.png",network),Utils.registerImage("images/room.png",network),Utils.registerImage("images/targetpoint.png",network),Utils.registerImage("images/originalpoint.png",network),initModelLib(accordionPane),accordionPane.setRefreshFunction(refreshAccordion),accordionPane.setRemoveItemFunction(removeItemFunction),accordionPane.setClearTemplateFunction(clearTemplates),borderPane.setLeft(accordionPane),borderPane.setLeftWidth(ACCORDION_WIDTH),sheetPane.init(),borderPane.setRight(sheetPane),borderPane.setRightWidth(240);var e=borderPane.getView();e.style.left="0px",e.style.top="137px",e.style.right="0px",e.style.bottom="28px",document.getElementById("main").appendChild(e),window.onresize=layoutGUI,window.onbeforeunload=function(){var e=checkEditorBoxHasElements()&&!saveAsTemplate;return e?"not save data, sure to exit?":void 0},Utils.createToolTipDiv(180,180),createToggleDiv(),initRSidebar(),roomAnimationManager=new mono.AnimationManager},createToggleDiv=function(){Utils.createLeftToggleImage(function(){borderPane.setLeft(null),ACCORDION_WIDTH=0,layoutGUI()},function(){ACCORDION_WIDTH=295,borderPane.setLeftWidth(ACCORDION_WIDTH),borderPane.setLeft(accordionPane),layoutGUI()},borderPane.getView()),Utils.createTopToggleImage(function(){borderPane.getView().style.top="75px",layoutGUI()},function(){borderPane.getView().style.top="137px",layoutGUI()})},initRSidebar=function(){sidebarLayerbox=new twaver.LayerBox,initSidebarLayerBox(),roomSidebar=new Room2dSidebarPane(box2d,sidebarLayerbox,network),document.body.appendChild(roomSidebar.getView()),roomSidebar.setSidebarExpanded(!1)},initSidebarLayerBox=function(){var e=sidebarLayerbox.getDataById("default");e.setClient("predefined",!0),e.setClient("visible",!0),sidebarLayerbox.add(createLayer(PropertyConsts.Layer.WALL,!0)),sidebarLayerbox.add(createLayer(PropertyConsts.Layer.FLOOR,!0)),sidebarLayerbox.add(createLayer(PropertyConsts.Layer.WINDOW,!0)),sidebarLayerbox.add(createLayer(PropertyConsts.Layer.DOOR,!0)),sidebarLayerbox.add(createLayer(PropertyConsts.Layer.PIPE,!0)),sidebarLayerbox.add(createLayer(PropertyConsts.Layer.BILLBOARD,!0)),sidebarLayerbox.add(createLayer(PropertyConsts.Layer.TEMPLATE,!0)),sidebarLayerbox.addDataPropertyChangeListener(function(e){"C:visible"===e.property&&(network.invalidateElementVisibility(),isShow3D&&(validateElementVisibility(),network3d.render()))});var t=new twaver.QuickFinder(box2d,PropertyConsts.LAYERID,"client");sidebarLayerbox.addDataBoxChangeListener(function(e){if("remove"===e.kind){var i=e.data.getId(),n=t.find(i);n.forEach(function(e){e.setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.DEFAULT),show3D&&box3d.getDataById(e.getId())&&box3d.getDataById(e.getId()).setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.DEFAULT)})}})},createLayer=function(e,t){var i=new twaver.Layer(e);return i.setName(e),i.setClient("predefined",t),i.setClient("visible",!0),i},installNetwork2dFunctions=function(){network.isEditable=function(){return!lock2d},network.isMovable=function(){return!lock2d},network.isRotatable=function(e){return!(e instanceof Block||e instanceof TargetFlagNode)},network.isRotatable=function(e){return e instanceof PrimitiveNode&&(!e.getClient("className")||"mono.Billboard"!=e.getClient("className"))?!0:!1},network.editType="xz";var e=network.getVisibleFunction();network.setVisibleFunction(function(t){var i=!0;"xz"==network.editType&&t.getHost&&null!=t.getHost()&&(null==t.getParent()&&t.getHost()instanceof ImageShapeNode||(i=!1));var n=floorPane.getCurrentFloorName();if(n&&(i&=t.getClient("floorName")===n),e&&(i&=e(t)),t instanceof TargetFlagNode)return t.isShowPoint();i&=t.getClient("t3d.standout");var a=t.getClient(PropertyConsts.LAYERID),o=!0;return a&&(o=sidebarLayerbox.getDataById(a).getClient("visible")),i&=o}),network.setMovableFunction(function(e){return movable=!(e instanceof Block)}),network.getSelectionModel().setFilterFunction(function(e){return e.getClient("hostNodeId")?!1:!0}),network.addElementByInteraction=function(e){if(twaver.network.Network.prototype.addElementByInteraction.call(this,e),e instanceof FloorShapeNode&&(e.setLayerId(bottomLayer.getId()),e.setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.FLOOR)),e instanceof InnerWallShapeNode&&(e.setLayerId(wallLayer.getId()),e.setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.WALL)),e instanceof ImageShapeNode)if(e.getClient("isHostNode")){var t=new FloorShapeNode;t.setPoints(e.getPoints()),t.setClient("hostNodeId",e.getId()),t.setLayerId(bottomLayer.getId()),t.setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.FLOOR),box2d.add(t),e.setClient(OID,e.getId())}else e.setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.WALL);e instanceof PipeShapeNode&&e.setClient(PropertyConsts.LAYERID,PropertyConsts.Layer.PIPE),setTimeout(function(){network.setInteractions(interactions2d)},500)}},installNetwork2dListeners=function(){network.addInteractionListener(function(e){("lazyMoveEnd"==e.kind||"liveMoveEnd"==e.kind)&&processHost(box2d.getSelectionModel().getLastData(),e.event)}),network.getElementBox().addDataBoxChangeListener(function(e){if("add"===e.kind){if(e.data instanceof FloorShapeNode)e.data.setLayerId(bottomLayer.getId());else if(e.data instanceof InnerWallShapeNode)e.data.setLayerId(wallLayer.getId());else if(e.data instanceof Block)e.data.setLayerId(topLayer.getId());else if(e.data instanceof TargetFlagNode)e.data.getType()==PointFlag.TARGET_POINT?targetFlagElement=e.data:originalFlagElement=e.data,e.data.setLayerId(topLayer.getId());else if(e.data instanceof PipeShapeNode)e.data.setLayerId(contentsLayer.getId());else if(e.data instanceof PrimitiveNode){var t=e.data,i=t.getCenterLocation();t.setLayerId(contentsLayer.getId());var n=t.getClient("size"),a=t.getClient("assembleSize"),o=(t.getClient("rot"),t.getClient(DESIGN_SCALE));o?o/=100:o=1,a&&(n=a),n&&("xz"==network.editType?n.x<1?t.setWidth(n.z*o):(t.setWidth(n.x*o),t.setHeight(n.z*o)):(t.setWidth(n.x*o),t.setHeight(n.y*o)),i&&t.setCenterLocation(i))}var r=e.data.getClient("floorName");r||(r=floorPane.getCurrentFloorName(),e.data.setClient("floorName",r));var s=floorPane.getFloorHeightByFloorName(r);e.data instanceof PrimitiveNode?e.data.getHost()||e.data.setClient("floorHeight",parseInt(s)):e.data.setClient("floorHeight",parseInt(s))}if("remove"===e.kind&&removeFlag){if(removeFlag=!1,e.data.getClient(OID)){var l=finderByHostNodeId.find(e.data.getClient(OID)).toList();l.forEach(function(e){e&&e instanceof twaver.ShapeNode&&network.getElementBox().remove(e)})}removeFlag=!0}},this),network.getElementBox().getSelectionModel().addSelectionChangeListener(function(e){e.datas.forEach(function(e){if(e instanceof PrimitiveNode)if(box2d.getSelectionModel().contains(e)){e.getName()&&e.setClient("primitiveName",e.getName());var t=Utils.changeTwoDecimal(e.getClient("oscale"));enableScale&&e.setName(t+"%\nScroll to Scale")}else e.setName(e.getClient("primitiveName"))},this)}),network.getElementBox().addDataPropertyChangeListener(handleDataPropertyChange,this),network.getElementBox().addDataBoxChangeListener(handleDataBoxChange,this),network.getElementBox().getLayerBox().addDataPropertyChangeListener(handleLayerPropertyChange,this),network.getElementBox().getLayerBox().addDataBoxChangeListener(handleLayerBoxChange,this)},handleDataPropertyChange=function(e){if("points"===e.property&&needUpdateSize){var t=box2d.getSelectionModel().getSelection();t&&t.size()>0&&t.forEach(function(e){if(e.getClient(OID)){var t=finderByHostNodeId.find(e.getClient(OID)).toList();t&&t.size()>0&&t.forEach(function(t){e&&e instanceof twaver.ShapeNode&&(needUpdateSize=!1,t.setPoints(e.getPoints()))})}}),needUpdateSize=!0}},handleLayerPropertyChange=function(e){if("C:floorHeight"===e.property&&"undefined"!=typeof e.newValue){var t=finderByFloorName.find(e.source.getClient("floorName"));t&&t.size()>0&&t.forEach(function(t){t instanceof PrimitiveNode?t.getHost()||t.setClient("floorHeight",parseInt(e.newValue)):t.setClient("floorHeight",parseInt(e.newValue))})}else"C:floorVisible"===e.property&&(validateElementVisibility(),network3d.render())},handleLayerBoxChange=function(e){if("remove"===e.kind){var t=finderByFloorName.find(e.data.getClient("floorName"));t&&t.size()>0&&t.forEach(function(e){box2d.remove(e)})}if("add"===e.kind){var i=e.data;if(i.getClient("needClone")&&i.getClient("cloneFloorName")){var n=floorPane.getFloorByFloorName(i.getClient("cloneFloorName")),t=finderByFloorName.find(n.getClient("floorName"));t&&t.size()>0&&cloneFloorDatas(t,i.getClient("floorName"))}}},handleDataBoxChange=function(e){"remove"===e.kind&&box3d.getDataById(e.data.getId())&&box3d.removeById(e.data.getId(),!0),"add"===e.kind&&e.data.setClient("t3d.standout",!0)},cloneFloorDatas=function(e,t){Utils.copyDatasToBoxAnchor(e,box2d),Utils.pasteBoxAnchorToBox(box2d,t)};$eInteraction=function(e){toolBar.eInteraction(e,!0)};var init3D=function(){mono.Styles.setStyle("alarm.billboard.scale",new mono.Vec3(0,0,0)),canvas3d.setAttribute("width","1200"),canvas3d.setAttribute("height","800"),network3d=new mono.Network3D(box3d,camera,canvas3d),network3d.sortNodes=!0;var e=["default:$eInteraction('default')","coarseSelect:$eInteraction('coarseSelect')","carefulSelect:$eInteraction('carefulSelect')","unlockAllEditInteraction:$eInteraction('unlockAllEditInteraction')","move:$eInteraction('move')","rotate:$eInteraction('rotate')","createLink:Utils.createLinkHandle(box3d);","align:$ardob()","preview-view:$rp3d()","zoom-over-view:$rzoomoverview()"];toolBar=new ToolBar(network3d,e),installBox3dListeners(),box3d.add(ambientLight),pointLights.forEach(function(e){box3d.add(e)});var t=new mono.SelectionInteraction(network3d);t.selectable=function(e){return this.network.isSelectable(e.element)&&this.network.getDataBox().getSelectionModel().isSelectable(e.element)},defaultInteraction=new mono.DefaultInteraction(network3d),defaultInteraction.zoomSpeed=parseFloat(zoomSpeed),defaultInteraction.yLowerLimitAngle=-Math.PI/8,defaultInteraction.yUpLimitAngle=Math.PI/2,defaultInteraction.maxDistance=parseFloat(maxDistance),defaultInteraction.minDistance=parseFloat(minDistance),defaultInteraction.target=new mono.Vec3(100,100,100),defaultInteraction.setEasing(enableEasing),camera.look(new mono.Vec3(100,100,100));var i=new mono.EditInteraction(network3d);interactions=[t,defaultInteraction,i],network3d.setInteractions(interactions),network3d.getRootView().addEventListener("dblclick",handleDoubleClick),Utils.renderNetwork(network3d,camera),network3d.getRootView().appendChild(toolBar.getView()),Utils.setupNetworkInfoTags(network3d),toolBar.setEditorInteraction("init"),network3d.renderAlarmBorderFunction=function(e){return!Utils.isNotNull(e.getClient("mainVisible"))},setInterval(updateRoomFps,1e3),network3d.setBeforeRenderFunction(function(){null==network3d._renderCount?network3d._renderCount=0:network3d._renderCount++,network3d._startTime=(new Date).getTime()}),network3d.setRenderCallback(function(){var e=network3d._startTime,t=(new Date).getTime();network3d._renderTime+=t-e}),init3dSidebar()},init3dSidebar=function(){room3dSidebar=new Room3dSidebarPane(sidebarLayerbox),document.body.appendChild(room3dSidebar.getView()),room3dSidebar.setSidebarExpanded(!1)},updateRoomFps=function(){if(network3d){null==network3d._renderCount&&(network3d._renderCount=0);var e=network3d._renderTime/network3d._renderCount;isNaN(e)&&(e=0),e=Math.floor(e),Utils.updateFpsInfo(network3d._renderCount,e),network3d._renderCount=0,network3d._renderTime=0}},installBox3dListeners=function(){box3d.addDataPropertyChangeListener(function(e){var t=e.source,i=e.newValue;if("position"===e.property){var n=t.getPosition(),a=t.getClient("nodeId"),o=box2d.getDataById(a);if(o instanceof PrimitiveNode&&Utils.isMainNode(o)){if(originalFlagElement&&originalFlagElement.isShowPoint()){var r=originalFlagElement.getCenterLocation();n.x=n.x+r.x,n.y=n.y+originalFlagElement.getClient(SPACE_POS_Y),n.z=n.z+r.y}o.setCenterLocation(n.x,n.z),o.setClient("positionY",parseInt(n.y-t.getHeight()/2))}}if("alarmBillboard"===e.property)e.newValue&&mono.AniUtil.playAlarmAnimation(e.source,e.newValue);else if("C:animation"==e.property)if(Utils.isNotNull(i)){var s=roomAnimationManager.getAnimationById(t.getId());if(s)s.setAnimation(i),s.setAnimationGroup(t.getClient("animationGroup"));else{var s=new mono.AnimationData(t.getId(),t,i,t.getClient("animationGroup"));animationManager.add(s)}}else{var s=roomAnimationManager.getAnimationById(t.getId());roomAnimationManager.remove(s)}else if("C:animationGroup"==e.property){var s=roomAnimationManager.getAnimationById(t.getId());s&&s.setAnimationGroup(i)}Utils.updateBoxInfo(box3d)}),box3d.addDataBoxChangeListener(function(e){if("add"==e.kind){if(e.data.getClient("animation")){var t=e.data,i=roomAnimationManager.getAnimationById(t.getId());if(!i){var i=new mono.AnimationData(t.getId(),t,t.getClient("animation"),t.getClient("animationGroup"));roomAnimationManager.add(i)}}selectStyle&&Utils.setElementSelectStyle(e.data,selectStyle)}else if("remove"==e.kind&&e.data.getClient("animation")){var i=roomAnimationManager.getAnimationById(e.data.getId());i&&roomAnimationManager.remove(i)}})},handleDoubleClick=function(e){var t=function(e){var t=e.getClient("mainVisible"),i=Utils.isNotNull(t);return!i},i=Utils._findFirstObjectByMouse(network3d,e,t);if(i){var n=mono.AniUtil.findAnimationAgent(i.element);if(n)return void roomAnimationManager.play(roomAnimationManager.getAnimationById(n.getId()));if(Utils.isAltDown(e)){var a=i.element.getId();if(box3d.getAlarmBox().containsById(a))box3d.getAlarmBox().removeById(a);else{var o=new mono.Alarm(a,a,mono.AlarmSeverity.CRITICAL);box3d.getAlarmBox().add(o)}return}i=Utils._findFirstObjectByMouse(network3d,e);var r=i.point,s=new mono.Vec3(r.x,r.y,r.z),l=new Object;l.px=network3d.getCamera().getPosition().x,l.py=network3d.getCamera().getPosition().y,l.pz=network3d.getCamera().getPosition().z,l.tx=network3d.getCamera().getTarget().x,l.ty=network3d.getCamera().getTarget().y,l.tz=network3d.getCamera().getTarget().z,defaultInteraction.target=s;var d=new Object;d.tx=r.x,d.ty=r.y,d.tz=r.z,s=new mono.Vec3(r.x,r.y,r.z);var c=200,h=i.face.normal.clone();h=h.applyMatrix4((new mono.Mat4).extractRotation(i.element.worldMatrix)),h.normalize();var u=h.multiplyScalar(c),g=i.element.getPosition().clone();g=g.addVectors(s,u),g.x++,g.y++,camera.position=g,playDblClick(l,d)}else resetCamera(!0)},playDblClick=function(e,t){var i=2e3,n=0,a=mono.AniUtil.DefaultEasing,o=new TWEEN.Tween(e).to(t,i).easing(a).delay(n).onUpdate(function(){network3d.getCamera().look(new mono.Vec3(this.tx,this.ty,this.tz))});o.start()},show2D=function(){showPropertySheet&&(borderPane.setRight(sheetPane),sheetPane.getAccodionPane().getAccodion().invalidate()),isShow3D=!1,angleFalge=!1,document.getElementById("btn2d")&&(document.getElementById("btn2d").setAttribute("class","transform2d_one"),document.getElementById("btn3d").setAttribute("class","transform2d_two")),document.getElementById("floor2d")&&(document.getElementById("floor2d").style.display="block",document.getElementById("floor3d").style.display="none"),network.invalidateElementUIs(!0),ruler=new Ruler(network),ruler.setShowGuides(showRulerGuides),ruler.setShowRuler(showRuler),borderPane.setCenter(ruler.getView()),roomSidebar.getView().style.display="block",room3dSidebar.getView().style.display="none",network.repaint(),(network._oldScrollTop||network._oldScrollLeft)&&(network.getView().scrollTop=network._oldScrollTop,network.getView().scrollLeft=network._oldScrollLeft,delete network._oldScrollTop,delete network._oldScrollLeft),roomSidebar.invalidate(),setTimeout(function(){isShowed3D&&ruler.invalidate()},100)};$s2d=show2D;var show3D=function(){if(!isShow3D){network._oldScrollTop=network.getView().scrollTop,network._oldScrollLeft=network.getView().scrollLeft,isShow3D=!0,borderPane.setRight(null),document.getElementById("floor2d").style.display="none",document.getElementById("floor3d").style.display="block",document.getElementById("btn2d").setAttribute("class","transform3d_one"),document.getElementById("btn3d").setAttribute("class","transform3d_two"),borderPane.setCenter(network3d.getRootView()),network3d.setShowAxis(showAxis),network3d.setShowAxisText(showAxisText),box3d.getAlarmBox().clear(),box3d.clear();var e={},t=0;box3d.startBatch();var i=(new Date).getTime();box2d.forEach(function(i){var n=i;if(n instanceof twaver.ShapeNode){var a=n.getPoints(),o=a.size();if(o>0&&n instanceof ImageShapeNode){n.setClient("shapeNodeIndex",t++);var r=n.getChildren(),s=[];r&&r.forEach(function(e){e instanceof Block&&s.push(e)}),n.translate3d(box3d,s,network)}}else if(n instanceof PrimitiveNode){{Date.now()}e[n.getId()]=n.translate3d(box3d,network)}});var n=(new Date).getTime();console.log(n-i,"11111111111"),box2d.forEach(function(t){var i=t;if(i.getHost){var n=i.getHost();n&&e[i.getId()].setParent(e[n.getId()])}});var a=[];for(var o in e)e[o].getParent()||a.push(e[o]);box3d.getRoots().forEachReverse(function(e){e instanceof mono.ComboNode&&e.getClient("entity")&&box3d.remove(e)});var r=(new Date).getTime();console.log(r-n,"222222222222");for(var s,l=0;l<a.length;l++){var d=a[l];if(!box3d.getDataById(d.getId())){var c=d.getDescendants();d.getClient("isEntity")?(c.push(d),s=new mono.ComboNode(c),s.setClient("floorName",d.getClient("floorName")),s.setClient(BID,d.getClient(BID)),s.setClient("entity",!0),box3d.add(s)):box3d.addByDescendant(d)}}var h=(new Date).getTime();if(console.log(h-r,"33333333333"),box3d.endBatch(),e=null,offsetOriginal(),isShowed3D||resetCamera(!1),network3d.render(),room3dSidebar.invalidate(),targetFlagElement&&targetFlagElement.isShowPoint()){var u=targetFlagElement.getCenterLocation();centerX=u.x,centerZ=u.y,centerY=targetFlagElement.getClient(SPACE_POS_Y),defaultInteraction.target=new mono.Vec3(centerX,centerY,centerZ),camera.look(defaultInteraction.target)}layoutGUI(),validateElementVisibility(),toolBar.handleSelect(),isShowed3D=!0}Utils.updateBoxInfo(box3d),roomSidebar.getView().style.display="none",room3dSidebar.getView().style.display="block";var g=(new Date).getTime();console.log(g-h,"444444444444")};$s3d=show3D;var offsetOriginal=function(){box3d.getDatas().forEach(function(e){if(!e.getParent()&&e instanceof mono.Entity){var t=e.getPosition();if(t&&originalFlagElement&&originalFlagElement.isShowPoint()){var i=originalFlagElement.getCenterLocation();t.x=t.x-i.x,t.y=t.y-originalFlagElement.getClient(SPACE_POS_Y),t.z=t.z-i.y,e.setPosition(t)}}})},resetCamera=function(e){if(box2d.size()>0){var t=0,i=0,n=100;if(targetFlagElement&&targetFlagElement.isShowPoint()){var a=targetFlagElement.getCenterLocation();t=a.x,i=a.y,n=targetFlagElement.getClient(SPACE_POS_Y)}else{var o=twaver.Util.getElementsBounds(box2d.getDatas(),network);t=o.x+o.width/2,i=o.y+o.height/2}defaultInteraction.target=new mono.Vec3(t,n,i),camera.look(defaultInteraction.target)}e&&camera.setPosition(1500,500,1500),camera.up.set(0,1,0)};resetCamera(!0);var layoutGUI=function(){borderPane.invalidate(),ruler.invalidate(),accordionPane.accordion.invalidate();var e=borderPane.getView(),t=e.offsetWidth-ACCORDION_WIDTH,i=e.offsetHeight;network3d.adjustBounds(t,i),camera.aspect=t/i,camera.updateProjectionMatrix(),network3d.render()},validateElementVisibility=function(){box3d.forEach(function(e){if(!(e instanceof mono.Light||e.getParent())){var t=floorPane.isFloorVisibility(e.getClient("floorName")),i=e.getClient(PropertyConsts.LAYERID),n=!0;i&&(n=sidebarLayerbox.getDataById(i).getClient("visible")),t&=n,e._visible=t}})};twaver.Util.getElementsBounds=function(e,t){var i=null;return e.forEach(function(e){if(e.getRect){var n,a;t&&(a=t.getElementUI(e),a&&(n=a.getViewRect())),n||(n=e.getRect()),i=i?twaver.Util.unionRect(i,n):n}}),i};var checkEditorBoxHasElements=function(){var e=box3d.getNodes().toArray();if(e)for(var t=0;t<e.length;t++){var i=e[t];if(!(i instanceof mono.Floor||i instanceof mono.AmbientLight||i instanceof mono.PointLight))return!0}if(e=box2d.getDatas().toArray())for(var t=0;t<e.length;t++){var i=e[t];if(!(i instanceof TargetFlagNode))return!0}return!1},processHost=function(e){if(!(null==e||e instanceof ImageShapeNode||e instanceof TargetFlagNode)){e.getHost&&e.getHost()instanceof ImageShapeNode&&e.setHost(null);var t=e.getCenterLocation();box2d.forEachByLayerReverse(function(i){return e===i||i.getClient("floorName")!==e.getClient("floorName")?!0:twaver.Util.containsPoint(i.getRect(),t)&&i instanceof FloorShapeNode?(e.setHost&&e.setHost(i),!1):!0},null,this)}},showEditorDialog=function(e){if(checkEditorBoxHasElements()&&!saveAsTemplate&&confirm("Save as Template?"))return void showSaveAsRoomDialog();if(showDialog="false"===Utils.queryString(window.location.search,"showEditor")?!1:!0,showDialog||e){box2d.clear(),box3d.clear(),box3d.getAlarmBox().clear();var t="<div class='room mar'><span class='r_title'>Start a new Room</span><p>Drag-and-drop room shapes to the canvas or draw a free shape.</p><img src='images/033.png' /><a><button class='new_button sr' onclick='Utils.createRoom(\"room\")'>Start a new Room</button></a></div><img class='or' src='images/index01_11.png' /><div class='room'><span class='r_title'>Start a new Component</span><p>Use basic shapes to assemble a component.</p><img src='images/022.png' /><a><button type='button' class='new_button sr' onclick='Utils.createComponent(\"room\")'>Start a new Component</button></a></div><img class='or' src='images/index01_11.png' /><div class='link'><span class='link_title'>Quick Link</span><ul><li><a target='_blank' href='http://www.mono-design.cn:8888/'><span class='link_title01'>Help</span></a></li><li><a target='_blank' href='demo/index.html'><span class='link_title01'>Demo</span></a></li><li><a target='_blank' href='imageLibrary.html'><span class='link_title01'>Image Library</span></a></li><li><a target='_blank' href='imageCategory.html'><span class='link_title01'>Image Category</span></a></li><li><a target='_blank' href='templateLibrary.html'><span class='link_title01'>Template Library</span></a></li><li><a target='_blank' href='templateCategory.html'><span class='link_title01'>Template Category</span></a></li><li><a target='_blank' href='userManagement.html'><span class='link_title01'>User Management</span></a></li><li><a target='_blank' href='logManagement.html'><span class='link_title01'>System Logs</span></a></li></ul></div>";
Utils.showDialog("newEditor",t,"New Design",!1,!1,"new_editor")}showDialog||Utils.checkLoadLocalImage()},showSaveAsRoomDialog=function(){if(roomTemplateId){if(0===box2d.size())return void Utils.showDialog("judgeNull","<div style='width:150px;height: 50px;'>The scene is null</div>","Save Template",!0);var e="Save Template",t=[{label:"","class":"lb-save-template",id:"santemp",name:"templates",type:"radio",checked:!0,inner:"Save as new template"},{label:"","class":"lb-save-template",id:"owtemp",name:"templates",type:"radio",checked:!1,inner:"Overwrite the old template"}];Utils.showInputDialog(t,e,!0,function(e){exportToLib(e.owtemp)})}else exportToLib(!1)};$ssard=showSaveAsRoomDialog,exportToSketch=function(e,t,i,n){console.log(i);var a,o=document.getElementById("templateCategory");o&&(a=o.categoryId),modelManager.exportRoomToTemplate(box2d,e,i,n.templateName,a,roomTemplateId,n.author,n.tags,t),roomTemplateId=null,accordionPane._refreshCategory("Private Templates"),saveAsTemplate=!0,n.author&&localStorage.setItem(PropertyConsts.TEMPLATE_AUTHOR,n.author)},_refreshRCategory=function(){Utils.categoryCache={},Utils.initCategory(Utils.categoryCache,"tpl_categories")},_pickRCategory=function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1;var t=new SelectedTreePane("templateCategory");Utils.initCategory(Utils.categoryCache,"tpl_categories",null,function(){t.setCategoryCache(Utils.categoryCache),t.init()})};var exportToLib=function(e){var t=network.getView().offsetWidth,i=network.getView().offsetHeight;if(0!=t&&0!==i){var n=box2d.getSelectionModel().getSelection(),a=n.toList();n.size()>0&&box2d.getSelectionModel().clearSelection(),network.setShowGrid(!1)}else{var t=network3d.getView().width,i=network3d.getView().height,o=i>t?t:i,r=t>o?(t-o)/2:0,s=i>o?(i-o)/2:0,l=showAxis,d=showAxisText;l&&(network3d.setShowAxis(!1),showAxis=!1),d&&(network3d.setShowAxisText(!1),showAxisText=!1);var n=box3d.getSelectionModel().getSelection(),a=n.toList();n.size()>0&&box3d.getSelectionModel().clearSelection(),network3d.setClearAlpha(0)}setTimeout(function(){var t=network.getView().scrollWidth,i=network.getView().scrollHeight;if(0!=t&&0!==i){var n=network.toCanvas(t,i);n=Utils.scaleCanvas(n,180,180);var c=n.toDataURL("image/png");n=Utils.scaleCanvas(n,42,42);var h=n.toDataURL("image/png");a.size()>0&&box2d.getSelectionModel().setSelection(a),network.setShowGrid(!0)}else{var h=network3d.toImageData("PNG",{x:r,y:s,w:o,h:o},42,42),c=network3d.toImageData("PNG",{x:r,y:s,w:o,h:o},180,180);l!==showAxis&&(network3d.setShowAxis(l),showAxis=!0),d!==showAxisText&&(network3d.setShowAxisText(d),showAxisText=!0),a.size()>0&&box3d.getSelectionModel().setSelection(a),network3d.setClearAlpha(1)}var u=["templateName"],g=localStorage.getItem(PropertyConsts.TEMPLATE_AUTHOR)||"",m="<div><label class='field'>Image Icon:</label><img src="+h+" style='margin-left:5px; margin-top:-10px'></div><div style='height:40px'><label class='field'></label><span style='font:12px Calibri; color:red; float:left; margin-bottom:5px'; >Adjust component in the perspective view <br>to generate your desired icon.</span></div><div style='height:40px'><label class='field'>Template Name:</label><input id='templateName' class='input' size='30'/></div>";loadResource===TYPE_CLOUD&&(m+="<div style='height:40px'><label class='field'>Template Category:</label><input id='templateCategory' class='input' style='border-right-width: 0px; width: 246px;' size='30'/><input type='image' src='images/arrowdown2.png' onclick='_pickRCategory(event)'/><input type='image' src='images/refresh_button.png' onclick='_refreshRCategory(event)'/></div><div style='height:40px'><label class='field'>Author:</label><input id='author' class='input' size='30' value = '"+g+"' /></div><div style='height:40px'><label class='field'>Tags:</label><input id='tags' class='input' size='30'/></div><div style='height:40px'><label class='field'></label><label style='margin-left:10px;'>i.e. tag1, tag2, tag3...</label></div>",u.push("templateCategory"),u.push("author"),u.push("tags")),Utils.showDialog("save",m,"Save Template",!0,!1,null,exportToSketch,this,[h,e,c],u)},100)};$exp=exportToLib;var alignR3dObjects=function(){align3DObjects(box3d)};$ardob=alignR3dObjects;var clearAllElements4R=function(){network.getElementBox().getDatas().size()>0&&confirm("Sure to Clear All Elements")&&(box2d.clear(),targetFlagElement&&box2d.add(targetFlagElement),originalFlagElement&&box2d.add(originalFlagElement),box3d.clear())};$cae4R=clearAllElements4R;var roomZoomToOverView=function(){network3d.zoomEstimateOverview();var e=network3d.getNetworkBoundingBox(),t=e.max.x-e.min.x,i=e.max.y-e.min.y,n=e.max.z-e.min.z,a=Math.max(t,i);if(a=Math.max(a,n),!(5e3>a)){defaultInteraction.maxDistance=parseInt(1.2*a),maxDistance=parseInt(1.2*a);var o=network3d.getCamera();o.setFar(parseInt(1.8*a)),farPlane=parseInt(1.8*a)}};$rzoomoverview=roomZoomToOverView;var rpreview3DView=function(){var e=new mono.JsonSerializer(box3d);e.filterFunction=function(){return!0};var t=e.serialize();localStorage.setItem("flexJson",t),window.open("./components-preview.html")};$rp3d=rpreview3DView,$sedialog=showEditorDialog;var lockNetwork=function(){var e=document.getElementById("lock").getAttribute("class");"lockup"==e&&(document.getElementById("lock").setAttribute("class","lockdown"),lock2d=!0),"lockdown"==e&&(document.getElementById("lock").setAttribute("class","lockup"),lock2d=!1),network.isEditable=function(){return!lock2d},network.isMovable=function(){return!lock2d},network.invalidateElementUIs()};$lsd=lockNetwork;var exportDrawingFile=function(){var e="<div><table><tr><td><label class='field'>Export Images:</label></td>";e+="     <td><input id='files' type='checkbox' class='input'/></td></tr>",e+=" <tr><td><label class='field'>New Path:</label></td>",e+=" <td><input id='newpath' type='text' class='input'/></td></tr>",e+="</table></div>",Utils.showDialog("export",e,"Export Template",!0,!1,null,exportTemplate,this,null,["files","newpath"])};$ed=exportDrawingFile;var exportTemplate=function(e){var t=modelManager.serializeGraphInfo(box2d,!0),i=!1,n="";if(e){var i=e.files;n=e.newpath}var a=["thumbnail","poleTexture","picture","WallInnerPic","wallInnerPic","WallOuterPic","wallOuterPic","FramePic","framePic"];ZipFileUtils.exportTemplate(t,i,!1,n,a)},refreshNetwork=function(){floorPane.repaintBuilding(),network.invalidateElementUIs&&network.invalidateElementUIs(),network.invalidateDisplay&&network.invalidateDisplay()},importJSONFile=function(e){if(e.files&&e.files.length>0){var t=e.files[0];if(t.name.indexOf(".")>0){var i=t.name.split(".");if("json"!=i[1])return void alert("file format should be json");var n=new FileReader;n.readAsText(t),n.onloadend=function(){if(n.error)console.log(n.error);else{var e=JSON.parse(n.result);modelManager.loadGraphto2d(box2d,e),setTimeout(function(){refreshNetwork()},200)}}}}},importDrawingFile=function(){var e="<div><label class='field'>File Path:</label><input id='files' type='file' class='input' size='30'/></div>";Utils.showDialog("import",e,"Import Drawing",!0,!1,null,importJSONFile,this,null,["files"])};$impdra=importDrawingFile;var exportToFlex3D=function(){var e=export3DJsonFrom2Dbox();localStorage.setItem("flexJson",e),window.open("./flex3D.html")};$etf=exportToFlex3D;var exportToFlexJson=function(){var e=export3DJsonFrom2Dbox();if(twaver.Util.isIE){var t=document.createElement("iframe");document.body.insertBefore(t),t.style.display="none",t.contentDocument.write(e),t.contentDocument.execCommand("SaveAs",!0),document.body.removeChild(t)}else{var i="data:text/json;charset=utf8,"+encodeURIComponent(e);window.open(i,"network")}};$efj=exportToFlexJson;var export3DJsonFrom2Dbox=function(){0==box3d.size()&&box2d.forEach(function(e){var t=e;if(t instanceof twaver.ShapeNode){var i=t.getPoints(),n=i.size();if(n>0&&t instanceof ImageShapeNode){var a=t.getChildren(),o=[];a&&a.forEach(function(e){e instanceof Block&&o.push(e)}),t.translate3d(box3d,o)}}else t instanceof PrimitiveNode&&(nmap[t.getId()]=t.translate3d(box3d))});var e=new TGL.JsonSerializer(box3d);e.filterFunction=function(e){return!(e instanceof mono.Light)};var t=e.serialize();return t},getElementsRect=function(e,t){var i=null;return e.forEach(function(e){if(e.getRect){var n,a;t&&(a=t.getElementUI(e),a&&(n=a.getViewRect())),n||(n=e.getRect()),i?(i.width+=n.width,i.height+=n.height):i=n}}),i},alignElement=function(e){var t=box2d.getSelectionModel().getSelection(),i=new twaver.List;if(t.forEach(function(e){e instanceof Block||i.add(e)}),i.size()>1){var n=i.get(0),a=n.getX(),o=n.getY(),r=n.getX()+n.getWidth(),s=n.getY()+n.getHeight(),l={x:a,y:o,width:0,height:0};i.forEach(function(e){e.getX()<a&&(a=e.getX()),e.getY()<o&&(o=e.getY()),e.getX()+e.getWidth()>r&&(r=e.getX()+e.getWidth()),e.getY()+e.getHeight()>s&&(s=e.getY()+e.getHeight()),l=twaver.Util.unionRect()});var d=(s+o)/2,c=(r+a)/2;if(i.forEach(function(t){"left"===e&&t.setX(a),"top"===e&&t.setY(o),"right"===e&&t.setX(r-t.getWidth()),"bottom"===e&&t.setY(s-t.getHeight()),"middle"===e&&t.setY(d-t.getHeight()/2),"center"===e&&t.setX(c-t.getWidth()/2)}),i.size()>2){var h=i.toList(),l=twaver.Util.getElementsBounds(h,network),u=getElementsRect(h,network);if("vertical"===e)for(var g=0,m=(l.width-u.width)/(i.size()-1),p=0;p<i.size();p++){var f=h.get(0),v=f.getX(),y=f,b=0;h.forEach(function(e){e.getX()-v<b&&(y=e,b=e.getX()-v)}),y.setX(p*m+a+g),h.remove(y);var C=twaver.Util.getElementsBounds([y],network);g+=C.width}else if("horizontal"===e)for(var w=0,S=(l.height-u.height)/(i.size()-1),p=0;p<i.size();p++){var f=h.get(0),x=f.getY(),y=f,b=0;h.forEach(function(e){e.getY()-x<b&&(y=e,b=e.getY()-x)}),y.setY(p*S+o+w),h.remove(y);var C=twaver.Util.getElementsBounds([y],network);w+=C.height}}}};$ae=alignElement,componentEditorSetting4R=function(){var e=new SettingDialog(!1,ambientLight,pointLights,box2d,box3d,[network,network3d]);e.showSettingDialog()},$ces4R=componentEditorSetting4R;var showFloorVisibleDialog=function(){floorPane.showFloorVisibleDialog()};$sfvd=showFloorVisibleDialog,loadDxfFile=function(){var e=document.createElement("input");e.setAttribute("type","file"),e.onchange=function(){var i=e.files[0];if(i.name.toLowerCase().endsWith(".dxf")){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsText(i)}else alert("Only dxf file is supported")},e.click();var t=function(e){function t(e){return{x:e.x+20,y:-e.y+n+20}}var i=new dxf.Dxf;i.parse(e);var n=0,a=[];i.sections.entities.forEach(function(e){"wall"===e.attrib.layer&&(e instanceof dxf.LineData?(n=e.y1>n?e.y1:n,n=e.y2>n?e.y2:n):e instanceof dxf.PolylineData&&e.points.forEach(function(e){n=e.y>n?e.y:n}))}),i.sections.entities.forEach(function(e){if("wall"===e.attrib.layer){var i,n=new twaver.List;if(e instanceof dxf.LineData?(n.add(t({x:e.x1,y:e.y1})),n.add(t({x:e.x2,y:e.y2}))):e instanceof dxf.PolylineData&&e.points.forEach(function(e){n.add(t({x:e.x,y:e.y}))}),2===n.size())i=new InnerWallShapeNode;else{i=new ImageShapeNode;var o=new FloorShapeNode;o.setClient("hostNodeId",i.getId()),o.setPoints(n),network.getElementBox().add(o)}a.push(i),i.setClient("oid",i.getId()),i.setPoints(n),i.setClient("shapenode.closed",1===e.flags),network.getElementBox().add(i)}}),i.sections.entities.forEach(function(e){if(e instanceof dxf.LineData&&("window"===e.attrib.layer||"door"===e.attrib.layer)){var i,n,o,r,s=t({x:e.x1,y:e.y1}),l=t({x:e.x2,y:e.y2});if(a.some(function(e){return n=e.getPointIndex(s),0>n&&(n=e.getPointIndex(l)),n>=0&&(r=e),null!=r}),null==r||0>n)return;var d={x:(s.x+l.x)/2,y:(s.y+l.y)/2},c=r.getPoints(),h=c.get(n),u=c.get(n==c.size()-1?0:n+1),g=u.x-h.x,m=u.y-h.y;o=Math.abs(g)>Math.abs(m)?(d.x-h.x)/g:(d.y-h.y)/m,"window"===e.attrib.layer?(i=new Window,i.setClient("picture","images/window03_3d.png"),i.setClient("positionY",80),i.setClient("transparent",!0)):"door"===e.attrib.layer&&(i=new Door,i.setClient("picture","images/door02_3d.png"),i.setClient("positionY",0)),i.setClient("edgeIndex",n),i.setParent(r),i.setClient("offset",o),network.getElementBox().add(i)}})}};var resetRoomSettings=function(){showAxis=!1,showAxisText=!1,network3d.setShowAxis(showAxis),network3d.setShowAxisText(showAxisText);for(var e=0;e<pointLights.length;e++)pointLights[e].setVisible(!0),pointLights[e].setPosition(1e4,1e4,1e4),pointLights[e].setColor("#FFFFFF");ambientLight.setVisible(!0),ambientLight.setColor("#888888"),network3d.setClearColor("#FFFFFF"),localStorage.setItem("roomBackground","#FFFFFF"),localStorage.setItem("scaleUnitText","1m")};$rrs=resetRoomSettings;var refreshAccordion=function(e){if(modelManager.loadSharedPrimitive(),modelManager.loadSharedAssemble(),loadResource===TYPE_LOCAL)for(var t=modelManager.getModelLib().getCategories(),i=0;i<t.length;i++)t[i].id==e&&insertLocalCategory(t[i]);else{var n=e==TEMPLATES?PropertyConsts.SCOPE_PRIMITIVE:PropertyConsts.SCOPE_PUBLIC,a=getCategoryIdfromLocalStorage(n)||1,o=getCategoryValuefromLocalStorage(n)||"Room";freshCategoryContent(a,n,e,o)}},removeItemFunction=function(e){modelManager.removeShareCategory("Templates",e)},clearTemplates=function(){localStorage.setItem(LIB_GRAPH,"{}"),localStorage.setItem(LIB_PRIMITIVES,"{}"),localStorage.setItem(LIB_ASSEMBLES,"{}"),localStorage.removeItem("Templates")},modelManager=new modellib.ModelManager,jsonFiles={"RoomPrimitives.json":"new","RoomAssembles.json":"new","RoomLib.json":"new"},updateModelLibLoadStatus=function(e,t){jsonFiles[e]=t,"executed"===t&&delete jsonFiles[e],0===Object.keys(jsonFiles).length&&(accordionPane.setModelManager(modelManager),doTheFollowing())},initModelLib=function(){for(var e in jsonFiles)modelManager.loadResourceFile(e,updateModelLibLoadStatus)},doTheFollowing=function(){fillCategoryView(),accordionPane.expand("Rooms"),accordionPane.accordion.invalidate()},fillCategoryView=function(e){for(var t=modelManager.getModelLib().getCategories(),i=0;i<t.length;i++){var n=t[i];if(loadResource!==TYPE_LOCAL||n.id!==PUBLIC_TEMPLATES)if(e){if(e===n.id){insertLocalCategory(n);break}}else insertLocalCategory(n)}loadResource===TYPE_CLOUD&&(insertCloudCategory(Utils.categoryCache,0,TEMPLATES),insertCloudCategory(Utils.publicCategoryCache,1,PUBLIC_TEMPLATES))},insertCloudCategory=function(e,t,i){var n=getCategoryValuefromLocalStorage(t)||"Room",a=new TreeComboBox(null,"tpl_categories",!1,null,t,function(e){return localStorage.setItem(t?PropertyConsts.ROOM_PUBLIC_CATEGORY:PropertyConsts.ROOM_PRIVATE_CATEGORY,e.categoryId+":"+e.categoryValue),freshCategoryContent(e.categoryId,t,i,e.categoryValue)},n,null,null,!0);a.getView().setAttribute("class","accordion-category"),a.getInputView().setAttribute("class","teee-comboNode-input accordion-comboNode-input"),accordionPane.addCategory(i,!0,t),accordionPane.addTreeComboBoxPane(i,a)},freshCategoryContent=function(e,t,i,n){Utils.isNotNull(e)&&(accordionPane.clearCategoryContent(i),modelManager.searchTemplatesFromDB("Rooms",t,function(e){handleCategoryContent(e,i,n)},this,e))},insertItemIntoCategory=function(e,t,i,n,a){if(accordionPane){var o=modelManager.wrapModelNodeIntoItem(e,i,n,a);o&&(e==TEMPLATES&&(o.labelClass="template-label-class"),accordionPane.addItemData(e,t,o))}},insertLocalCategory=function(e){var t=e.contents,i=e.actions;if(e.id!==TEMPLATES&&e.id!==PUBLIC_TEMPLATES||loadResource!==TYPE_CLOUD){e.id===TEMPLATES?accordionPane.addCategory(e.id,!0):accordionPane.addCategory(e.id);var n=JSON.parse(localStorage.getItem(e.id));n&&(t=t.concat(n.contents));for(var a=0;a<t.length;a++)for(var o=t[a],r=o.children,s=0;s<r.length;s++)o.subtitle!=SUBTITLE_MODEL&&insertItemIntoCategory(e.id,o.subtitle,r[s].id,r[s].name,r[s].thumbnail);if(i)for(var a=0;a<i.length;a++){var l=i[a];accordionPane.addAction(e.id,l)}}},handleCategoryContent=function(e,t,i){var n=JSON.parse(e);if(n.error)return void alert(n.error);var a=n.value;i&&accordionPane.clearTemplateSub(t,i);for(var o=0;o<a.length;o++){var r=a[o];i?accordionPane.addITemplateData(t,i,{id:r.id,label:r.name,image:r.icon,isTemplate:!0,type:r.type,method:r.method,labelClass:"template-label-class"},r):accordionPane.addItemData(t,r.category,{id:r.id,label:r.name,image:r.icon,isTemplate:!0,type:r.type,method:r.method,labelClass:"template-label-class"})}};parseRoomPrimitives=function(e){modelManager.getModelLib().parsePrimitives(e,"RoomPrimitives.json",updateModelLibLoadStatus,this),modelManager.loadSharedPrimitive()},parseRoomAssembles=function(e){modelManager.getModelLib().parseAssembles(e,"RoomAssembles.json",updateModelLibLoadStatus,this),modelManager.loadSharedAssemble()},parseRoomLib=function(e){modelManager.getModelLib().parseLib(e,"RoomLib.json",updateModelLibLoadStatus,this)},BasePane=function(){},twaver.Util.ext("BasePane",Object,{init:function(){this.mainPane=document.createElement("div"),this.mainPane.setAttribute("class","image-main-pane"),document.getElementById("main").appendChild(this.mainPane)},createColumn:function(e,t,i,n,a,o,r,s,l){var d=new twaver.Column(t);return d.setName(t),d.setPropertyName(i),d.setWidth(r),d.setSortable(!1),r||d.setWidth(100),s&&d.setHorizontalAlign(s),l&&d.setClient("pack",l),d.setPropertyType(n),a&&d.setValueType(a),d.setEditable(o),"number"===a&&(d.renderCell=function(e){var t=e.value;if(t||0===t){var i=document.createElement("span");i.innerHTML=t,i.style.whiteSpace="nowrap",e.div.appendChild(i)}}),"image"===a&&(d.renderCell=function(e){var t=e.value;if(t){var i=document.createElement("img");i.src=t.startsWith("data:image")?t:PropertyConsts.MONO_IMG_PRE+t,i.style.verticalAlign="middle",e.div.appendChild(i)}}),"date"===a&&(d.renderCell=function(e){var t=e.value;if(t){var i=document.createElement("span");t=new Date(t).format("yyyy-MM-dd "),i.innerHTML=t,i.style.whiteSpace="nowrap",e.div.appendChild(i)}}),e instanceof twaver.controls.TablePane?e.getTable().getColumnBox().add(d):e.getColumnBox().add(d),d},appendChild:function(e,t,i,n,a,o){e.style.position="absolute",null!=o&&(e.style.left=o+"px"),null!=i&&(e.style.top=i+"px"),null!=n&&(e.style.right=n+"px"),null!=a&&(e.style.bottom=a+"px"),t.appendChild(e)}}),PagedTablePane=function(e){PagedTablePane.superClass.constructor.call(this),this.dataPane=e,this.toolbar=document.createElement("div"),this.toolbar.style.margin="5px 0px",this.tablePane=new twaver.controls.TablePane(e.table),this.setCenter(this.tablePane),this.setTop(this.toolbar),this.setTopHeight(25),this.countPerPage=10;var t=this,i="undefined"!=typeof Storage;if(i){var n=e.getPageNumberStorageName();localStorage.getItem(n)&&(t.countPerPage=parseFloat(localStorage.getItem(n)))}this.cmbCountPerPage=document.createElement("select");for(var a,o=["10","20","50","100"],r=0;r<o.length;r++){a=o[r];var s=document.createElement("option");s.appendChild(document.createTextNode(a)),s.setAttribute("value",a),this.cmbCountPerPage.appendChild(s)}this.cmbCountPerPage.onchange=function(){var n=parseFloat(t.cmbCountPerPage.value);if(t.countPerPage=n,i){var a=e.getPageNumberStorageName();a&&localStorage.setItem(a,n)}t.search()},this.cmbCountPerPage.value=this.countPerPage,this.toolbar.appendChild(this.cmbCountPerPage),this.btnFirstPage=this.addButton(this.toolbar,"first",function(){t.currentPage=0,t.search()}),this.btnPreviousPage=this.addButton(this.toolbar,"previous",function(){t.currentPage--,t.search()}),this.btnNextPage=this.addButton(this.toolbar,"next",function(){t.currentPage++,t.search()}),this.btnLastPage=this.addButton(this.toolbar,"last",function(){t.currentPage=t.pageCount-1,t.search()}),this.label=document.createElement("label"),this.toolbar.appendChild(this.label),this.table=e.table,this.currentPage=0,this.tablePane.getTableHeader().setHeight(32),this.tablePane.getTableHeader().getView().style.backgroundColor="#EA7518",this.tablePane.getTableHeader().setColumnLineColor("#EA7518"),this.tablePane.getTableHeader().onColumnRendered=function(e){e.style.backgroundColor="#EA7518",e.style.color="#fff"}},twaver.Util.ext("PagedTablePane",twaver.controls.BorderPane,{search:function(){var e=this,t=e.dataPane._module,i={module:t,method:"count",arguments:e.dataPane._arguments};Utils.requestMono(i,function(t){e.setCountValue(t)},this)},setCountValue:function(e){var t=JSON.parse(e).value;this.count=parseInt(t),this.pageCount=Math.floor(this.count/this.countPerPage),this.count%this.countPerPage&&this.pageCount++,this.currentPage>=this.pageCount&&(this.currentPage=this.pageCount-1),this.currentPage<0&&this.pageCount>0&&(this.currentPage=0),this.label.innerHTML=" Total Count: "+this.count+"   Page: "+parseInt(this.currentPage+1)+"/"+this.pageCount,this.pageCount<2?(this.btnFirstPage.disabled=!0,this.btnPreviousPage.disabled=!0,this.btnNextPage.disabled=!0,this.btnLastPage.disabled=!0):(this.btnFirstPage.disabled=!1,this.btnPreviousPage.disabled=!1,this.btnNextPage.disabled=!1,this.btnLastPage.disabled=!1,0==this.currentPage&&(this.btnFirstPage.disabled=!0,this.btnPreviousPage.disabled=!0),this.currentPage==this.pageCount-1&&(this.btnNextPage.disabled=!0,this.btnLastPage.disabled=!0)),this.dataPane.initData()},getTablePane:function(){return this.tablePane},addButton:function(e,t,i,n,a){var o=document.createElement("input");return o.setAttribute("type","button"),o.setAttribute("class",t),o.setAttribute("title",t),o.value=" ",a&&o.setAttribute("class",a),n&&(o.style.float=n),o.onclick=i,e.appendChild(o),o}}),BaseListPane=function(){},twaver.Util.ext("BaseListPane",BasePane,{_firstIndex:0,_module:null,_method:null,_arguments:{},init:function(){BaseListPane.superClass.init.call(this);var e=this;if(this.toolbar=document.createElement("div"),this.toolbar.setAttribute("class","list-search-pane"),this.box=new twaver.ElementBox,this.table=new AutoPackTable(this.box),this.table.setColumnLineColor("#EA7518"),this.table.setRowLineColor("#EA7518"),this.pagePane=new PagedTablePane(this),this.tableListPane=document.createElement("div"),this.tableListPane.setAttribute("class","tableListPane"),this.pagePane.getView().setAttribute("class","pagePane"),this.tableListPane.appendChild(this.pagePane.getView()),this.mainPane.appendChild(this.toolbar),this.mainPane.appendChild(this.tableListPane),this.initContents(),this.initTable(),this.table.getColumnBox().size()>0){var t=this.table.getColumnBox().getDataAt(0),i=t.renderCell;t.renderCell=function(e){e.div.style.borderLeft="1px solid #EA7518",i?i(e):_twaver.render.render(t.getValueType(),e.value,e.div,e.view,t.isInnerText())}}this.initOtherPane(),window.onresize=function(){e.pagePane.invalidate()},this.pagePane.search()},initContents:function(){},initData:function(){var e=this;if(this._firstIndex=this.pagePane.currentPage*parseFloat(this.pagePane.countPerPage),this._firstIndex<0)return void this.table.getDataBox().clear();this._arguments.offset=this._firstIndex,this._arguments.count=this.pagePane.countPerPage;var t={module:e._module,method:e._method,arguments:e._arguments};Utils.requestMono(t,this.handleSearch,this)},initTable:function(){},initOtherPane:function(){},handleSearch:function(e){if(this.table.getDataBox().clear(),e){this.jsonObject=JSON.parse(e).value;for(var t=this.jsonObject.length,i=0;t>i;i++){var n=this.jsonObject[i],a=new twaver.Element({clients:n});a=this.handleElementClientProperty(a),this.table.getDataBox().add(a)}this.callLater()}},callLater:function(){var e=this.table.getRowHeight()*this.box.size()+this.pagePane.getTablePane().getTableHeader().getHeight()+50;this.tableListPane.style.height=e+"px",this.pagePane.getView().style.height=e+"px",this.pagePane.invalidate()},getPageName:function(){},handleElementClientProperty:function(e){return e}}),AutoPackTable=function(e){AutoPackTable.superClass.constructor.call(this,e)},twaver.Util.ext("AutoPackTable",twaver.controls.Table,{_minPackWidth:100,getMinPackWidth:function(){return this._minPackWidth},setMinPackWidth:function(e){this._minPackWidth=e},adjustBounds:function(e){AutoPackTable.superClass.adjustBounds.call(this,e),this.packColumns(e.width)},packColumns:function(e){var t,i=new twaver.List;this.getColumnBox().getRoots().forEach(function(t){t.getClient("pack")?i.add(t):e-=t.getWidth()}),0!==i.size()&&(t=e/i.size(),t<this._minPackWidth&&(t=this._minPackWidth),i.forEach(function(e){e.setWidth(t)}))},getSelectColor:function(){return"#F8CFAE"}}),ImageTablePane=function(){},twaver.Util.ext("ImageTablePane",BaseListPane,{initContents:function(){this._module="images",this._method="search",this._arguments.order_by=JSON.stringify({id:PropertyConsts.ORDER_BY_DESC}),this._arguments.scope=PropertyConsts.SCOPE_PRIMITIVE},initTable:function(){this.table.setEditable(!0),this.table.setRowHeight(80);var e=this.pagePane.getTablePane();this.createColumn(e,"Image","icon","client","image",!1,150,"center"),this.createColumn(e,"Name","name","client","string",!1,200,"left");var t=this.createColumn(e,"Size","width","client","string",!1,100,"center");t.renderCell=function(e){var t=e.data.getClient("width"),i=e.data.getClient("height");e.div.innerHTML=t+" x "+i},this.createColumn(e,"Category","category_name","client","string",!1,100,"center"),this.createColumn(e,"Path","path","client","string",!1,200,"left",!0),this.createColumn(e,"Created","create_date","client","date",!1,80,"center"),this.createColumn(e,"Updated","change_date","client","date",!1,80,"center");var i=this.createColumn(e,"Action","id","client","action",!1,150,"center"),n=this;i.renderCell=function(e){var t=e.value,i=document.createElement("button");i.className="tableEdit",i.onclick=function(){n.updateItem(t)},e.div.appendChild(i),i=document.createElement("button"),i.className="tableDelete",i.onclick=function(){n.deleteImage(t)},e.div.appendChild(i);var a=document.createElement("a");a.href=PropertyConsts.MONO_IMG_PRE+e.data.getClient("path"),i=document.createElement("button"),i.className="tableView",a.appendChild(i),e.div.appendChild(a)}},deleteImage:function(e){var t={module:"images",method:"remove",arguments:{id:e}},i=this;Utils.requestMono(t,function(){i.pagePane.search()},this)},updateItem:function(e){localStorage.setItem("ImageId",e),document.location="updateImage.html"},getPageNumberStorageName:function(){return"ImageTable"}}),function(){var e=function(){t(),o("imgCategory","categorytable"),o("templateCategory","templateCategorytable")},t=function(){var e=function(e){return function(){u(e)}},t=i("imgCategory","table-div1","Image Category",e("categorytable"),"Image Library","imageLibrary.html"),a=i("templateCategory","table-div2","Template Category",e("templateCategorytable"),"Template Library","#"),o=new twaver.controls.SplitPane(t,a,"horizontal",.5);o.setDividerWidth(0),n(o.getView(),document.getElementById("main"),100,0,0,100)},i=function(e,t,i,n,a,o){var r=document.createElement("div");r.setAttribute("id",e),r.setAttribute("class",t);var s=document.createElement("h2"),l=document.createElement("span");l.innerHTML=i,s.appendChild(l);var d=document.createElement("a");return d.setAttribute("class","add-new-h2"),d.onclick=n,d.innerHTML="Add New",s.appendChild(d),d=document.createElement("a"),d.setAttribute("class","add-new-h2"),d.innerHTML=a,d.href=o,s.appendChild(d),r.appendChild(s),r},n=function(e,t,i,n,a,o){e.style.position="absolute",null!=o&&(e.style.left=o+"px"),null!=i&&(e.style.top=i+"px"),null!=n&&(e.style.right=n+"px"),null!=a&&(e.style.bottom=a+"px"),t.appendChild(e)},a={},o=function(e,t){var i=new twaver.ElementBox,o=new twaver.controls.TreeTable(i);a[t]=o;var h=new twaver.controls.TablePane(o),u=new twaver.controls.BorderPane(h);n(u.getView(),document.getElementById(e),40,0,30,0);var g=u.getView().style;g.width="500px",o.setRowHeight(30),o.setColumnLineColor("#EA7518"),o.setRowLineColor("#EA7518"),o.getIcon=function(){return null},h.getTableHeader().setHeight(32),h.getTableHeader().setColumnLineColor("#EA7518"),h.getTableHeader().onColumnRendered=function(e){e.style.backgroundColor="#EA7518"},o.getTreeColumn().setClient("pack",!0),o.getTreeColumn().setWidth(169);var m=new twaver.Pool("span");o.addPool(m),o.getTreeColumn().renderHeader=function(e){var t=m.get();t.style.whiteSpace="nowrap",t.style.verticalAlign="middle",t.style.padding="1px 2px 1px 2px",t.innerHTML="Tree",t.setAttribute("title",t.innerHTML),t.style.font="bold 12px Helvetica",e.style.textAlign="center",e.appendChild(t)};var p=o.getTreeColumn().renderCell;o.getTreeColumn().renderCell=function(e){return e.div.style.borderLeft="1px solid #EA7518",p(e)},l(o,"ID","id","accessor","string",!1).setWidth(50),l(o,"Name","name","accessor","string",!0).setWidth(100),l(o,"Parent Id","parentId","client","string",!1).setWidth(80);var f=l(o,"Action","action","client","string",!0);f.setWidth(100),f.renderCell=function(e){var i={tableId:t,id:e.data.getId(),name:e.data.getName(),parent_id:e.data.getClient("parentId")},n=r("Edit",function(){c(i)}),a=r("Delete",function(){d(i)}),o=document.createElement("span");o.innerHTML=" | ",e.div.appendChild(n),e.div.appendChild(o),e.div.appendChild(a),e.div.setAttribute("class","table-item-action")},s(t)},r=function(e,t){var i=document.createElement("a");return i.innerHTML=e,i.href="#",i.onclick=t,i},s=function(e){var t=a[e],i=t.getDataBox(),n={module:g(e),method:"search",arguments:{}};Utils.requestMono(n,function(e){var n=JSON.parse(e);if(n.value&&n.value.length>0){var a=n.value;i.clear();for(var o=0;o<a.length;o++){var r=a[o],s=new twaver.Node(r.id);s.setName(r.name),s.setClient("parentId",r.parent_id);var l=i.getDataById(r.parent_id);l&&s.setParent(l),i.add(s)}t.expandAll()}})},l=function(e,t,i,n,a,o){var r=new twaver.Column(t);return r.setName(t),r.setPropertyName(i),r.setPropertyType(n),a&&r.setValueType(a),r.setEditable(o),r.renderHeader=function(e){var t=document.createElement("span");t.style.whiteSpace="nowrap",t.style.verticalAlign="middle",t.style.padding="1px 2px 1px 2px",t.innerHTML=r.getName()?r.getName():r.getPropertyName(),t.setAttribute("title",t.innerHTML),t.style.font="bold 12px Helvetica",e.style.textAlign="center",e.appendChild(t)},e.getColumnBox().add(r),r},d=function(e){var t=e.tableId,i={module:g(t),method:"remove",arguments:{id:e.id}};Utils.requestMono(i,f(t),this)},c=function(e){var t=e.tableId,i=e.parent_id;(void 0==i||null==i||0/0==i)&&(i="");var n=[{label:"ID:",id:"id",readonly:!0,value:e.id,editable:!1},{label:"Name:",id:"name",readonly:!1,value:e.name},{label:"Parent:",id:"parent",readonly:!1,value:i}];"categorytable"!=t&&n.push({label:"Type:",id:"templateType",type:"select",options:[PropertyConsts.TYPE_ROOMS,PropertyConsts.TYPE_COMPONENT]}),Utils.showInputDialog(n,"Update Category",!0,h,this,[e],null,null)},h=function(e,t){var i=e.tableId;if(t.name){var n={module:g(i),method:"update",arguments:{id:t.id,name:t.name,parent_id:parseInt(t.parent),type:t.templateType}};Utils.requestMono(n,f(i),this)}},u=function(e){var t=new TreeComboBox("Parent:",g(e),!0,0),i=[{label:"Name:",id:"name",readonly:!1},{value:t.getView(),type:"div"}];"categorytable"!=e&&i.push({label:"Type:",id:"templateType",type:"select",options:[PropertyConsts.TYPE_ROOMS,PropertyConsts.TYPE_COMPONENT]}),Utils.showInputDialog(i,"Add Category",!0,v,this,[e,t],null,null)},g=function(e){return"categorytable"==e?"img_categories":"tpl_categories"},m=function(){s("categorytable")},p=function(){s("templateCategorytable")},f=function(e){return"categorytable"==e?m:p},v=function(e,t,i){if(i.name){var n={module:g(e),method:"add",arguments:{name:i.name,parent_id:parseInt(t.getHideValue()),type:i.templateType}};Utils.requestMono(n,f(e),this)}};$icc=e}(),BaseSplitPane=function(){this.iconMaxWidth=80,this.iconMaxHeight=60,this.needResetLocation=!1,this.gap=15},twaver.Util.ext("BaseSplitPane",Object,{init:function(){this.mainPane=document.createElement("div"),this.treeDatabox=new twaver.DataBox,this.networkDatabox=new twaver.ElementBox,this.networkPane=new twaver.network.Network(this.networkDatabox),this.treePane=new twaver.controls.Tree(this.treeDatabox),this.initTree(),this.splitPane=new twaver.controls.SplitPane(this.treePane,this.networkPane,"horizontal",.2),this.splitPane.getView().setAttribute("class","image-split-pane"),this.splitPane.getView().style.position="relative",this.splitPane.setDividerWidth(3),this.splitPane.setDividerBackground("#e0e0e0"),this.splitPane.getView().resetRect=!0,this.treePane.getView().setAttribute("class","split-tree-pane"),this.networkPane.getView().setAttribute("class","split-network-pane"),this.mainPane.resetRect=!0,this.mainPane.appendChild(this.splitPane.getView()),this.initData(),this.installListeners(),this.addNetworkFilter()
},initTree:function(){this.treePane.setExpandIcon("images/arrowdown.png"),this.treePane.setCollapseIcon("images/arrowright.png"),this.treePane.getIcon=function(){return null};var e=this.treePane;e.newdata=null;this.treePane.onDataRendered=function(t,i,n,a){a?(t.style.background="#f07819",t.style.color="#ffffff"):i==e.newdata?(t.style.background="rgb(248, 207, 174)",t.style.color="#000000"):(t.style.background="#f0781900",t.style.color="#000000"),t.style.paddingLeft="10px"},this.treePane.getSelectColor=function(){return"#f07819"},this.treePane.getView().addEventListener("mouseover",function(t){e.newdata=e.getDataAt(t),e.olddata!==e.newdata&&(e.olddata&&e.invalidateData(e.olddata),e.newdata&&e.invalidateData(e.newdata),e.olddata=e.newdata)}),this.treePane.getView().addEventListener("click",function(t){var i=e.getDataAt(t);e.getDataBox().getSelectionModel().setSelection(i)})},fillNetworkDatas:function(e){this.networkDatabox.clear();var t=this,i=this.networkPane.getView().clientWidth;this.count=parseInt(i/(this.iconMaxWidth+this.gap));var n=JSON.parse(e).value;if(n&&n.length>0)for(var a=0;a<n.length;a++){var o=n[a],r=new twaver.Node;t.networkDatabox.add(r),t.setImageV(o,a,r)}},setElementCenterLocation:function(e,t){e.setCenterLocation((this.iconMaxWidth+this.gap)*parseInt(t%this.count)+this.gap+this.iconMaxWidth/2,this.gap+(this.iconMaxHeight+2*this.gap)*parseInt(t/this.count)+this.iconMaxHeight/2)},setElementStyleValue:function(e,t,i){e.setStyle("body.type","default.vector"),e.setStyle("vector.shape","rectangle"),e.setStyle("vector.fill.color","#FFFFFF"),e.setStyle("vector.padding.left",t),e.setStyle("vector.padding.right",t),e.setStyle("vector.padding.top",i),e.setStyle("vector.padding.bottom",i),e.setStyle("label.yoffset",i+2),e.setStyle("outer.color","#E0E0E0"),e.setStyle("outer.width",1),e.setStyle("outer.padding.left",t),e.setStyle("outer.padding.right",t),e.setStyle("outer.padding.top",i),e.setStyle("outer.padding.bottom",i),e.setStyle("select.style","border"),e.setStyle("select.color","#FF8207"),e.setStyle("select.padding.left",t),e.setStyle("select.padding.right",t),e.setStyle("select.padding.top",i),e.setStyle("select.padding.bottom",i)},resetElementLocation:function(){for(var e=0,t=0;e<this.networkDatabox.size();e++){var i=this.networkDatabox.getDatas().get(e);this.networkPane.isVisible(i)&&(this.setElementCenterLocation(i,t),t++)}},installListeners:function(){var e=this;this.treeDatabox.getSelectionModel().addSelectionChangeListener(function(){if(e.treeDatabox.getSelectionModel().size()>0){var t=e.treeDatabox.getSelectionModel().getLastData(),i=e.findNetworkDataByTreeData(t);Utils.requestMono(i,e.fillNetworkDatas,e)}}),this.networkPane.addViewListener(function(t){"validateEnd"===t.kind&&e.needResetLocation&&(e.resetElementLocation(),e.needResetLocation=!1)}),this.networkDatabox.getSelectionModel().addSelectionChangeListener(function(t){"set"==t.kind&&t.datas.forEach(function(t){e.networkDatabox.getSelectionModel().contains(t)?t.setStyle("outer.width",0):t.setStyle("outer.width",1)})})},addNetworkFilter:function(){},getView:function(){return this.mainPane},getLastNetworkData:function(){return this.networkDatabox.getSelectionModel().getLastData()},findNetworkDataByTreeData:function(){},getSelectedTreeElement:function(){return this.treeDatabox.getSelectionModel().getLastData()}}),TextureImagePanel=function(){this.iconMaxWidth=80,this.iconMaxHeight=60,this.needResetLocation=!1,this.gap=15},twaver.Util.ext("TextureImagePanel",BaseSplitPane,{init:function(){TextureImagePanel.superClass.init.call(this),this.checkTexture=document.createElement("input"),this.checkTexture.setAttribute("type","checkbox"),this.checkTexture.style.marginTop="10px",this.lbTexture=document.createElement("span"),this.lbTexture.innerHTML=" Only Show Texture Image",this.mainPane.appendChild(this.checkTexture),this.mainPane.appendChild(this.lbTexture),this.checkTexture.onchange=function(){self.needResetLocation=!0,self.networkPane.invalidateElementVisibility()}},initData:function(){var e={module:"img_categories",method:"search",arguments:{}};Utils.requestMono(e,this.fillTreeDatas,this)},fillTreeDatas:function(e){var t=JSON.parse(e).value;if(t&&t.length>0){this.treeDatabox.clear();for(var i=0;i<t.length;i++){var n=t[i],a=new twaver.Element(n.id);a.setName(n.name),this.treeDatabox.add(a)}for(var i=0;i<t.length;i++){var n=t[i];if(n.parent_id){var a=this.treeDatabox.getDataById(n.id),o=this.treeDatabox.getDataById(n.parent_id);a.setParent(o)}}}this.treePane.expandAll()},findNetworkDataByTreeData:function(e){var t=e.getId(),i={module:"images",method:"search",arguments:{category_id:t}};return i},addNetworkFilter:function(){var e=this;this.networkPane.setMovableFunction(function(){return!1}),this.networkPane.setVisibleFunction(function(t){return e.checkTexture.checked?mono.Utils.isPowerOfTwo(parseInt(t.getClient("image.width")))&&mono.Utils.isPowerOfTwo(parseInt(t.getClient("image.height")))?!0:!1:!0})},setImageV:function(e,t,i){var n=this;Utils.registerImage(PropertyConsts.MONO_IMG_PRE+e.icon,n.networkPane,!1,function(a,o){yPadding=(this.iconMaxHeight-o)/2,xPadding=(this.iconMaxWidth-a)/2,i.setImage(PropertyConsts.MONO_IMG_PRE+e.icon),i.setToolTip("<html>Name: "+e.name+"<br>Width: "+e.width+"<br>Height: "+e.height+"</html>"),i.setName(e.name),i.setClient("imageId",e.id),i.setClient("path",PropertyConsts.MONO_IMG_PRE+e.path),i.setClient("image.width",e.width),i.setClient("image.height",e.height),n.setElementCenterLocation(i,t),n.setElementStyleValue(i,xPadding,yPadding),n.needResetLocation=!0},n)}}),TemplatesPanel=function(e){this.iconMaxWidth=80,this.iconMaxHeight=60,this.needResetLocation=!1,this.gap=15,this.isPublic=null==e?!1:e},twaver.Util.ext("TemplatesPanel",BaseSplitPane,{initData:function(){var e={module:"tpl_categories",method:"search",arguments:{type:PropertyConsts.TYPE_COMPONENT,scope:this.isPublic?PropertyConsts.SCOPE_PUBLIC:PropertyConsts.SCOPE_PRIMITIVE}};Utils.requestMono(e,this.fillTreeDatas,this)},fillTreeDatas:function(e){var t=JSON.parse(e).value;if(t&&t.length>0){this.treeDatabox.clear();for(var i=0;i<t.length;i++){var n=t[i],a=new twaver.Element(n.id);a.setName(n.name+" ("+n.count+")"),this.treeDatabox.add(a)}for(var i=0;i<t.length;i++){var n=t[i];if(n.parent_id){var a=this.treeDatabox.getDataById(n.id),o=this.treeDatabox.getDataById(n.parent_id);a.setParent(o)}}}this.treePane.expandAll()},setImageV:function(e,t,i){var n=this;Utils.registerImage(e.icon,n.networkPane,!1,function(a,o){var r=(this.iconMaxHeight-o)/2,s=(this.iconMaxWidth-a)/2;i.setImage(e.id),i.setToolTip("<html>ID: "+e.id+"<br>Name: "+e.name+"<br>Width: "+a+"<br>Height: "+o+"</html>"),i.setName(e.name),i.setClient("gid",e.gid),i.setClient("templateId",e.id),n.setElementCenterLocation(i,t),n.setElementStyleValue(i,s,r),n.needResetLocation=!0},n,e.id)},findNetworkDataByTreeData:function(e){var t=e.getId(),i={module:"templates",method:"search",arguments:{category:t}};return i},addNetworkFilter:function(){this.networkPane.setMovableFunction(function(){return!1})}});var initUpdateImage=function(){var e=parseInt(localStorage.getItem("ImageId")),t={module:"images",method:"search",arguments:{id:e,offset:0,count:1}};Utils.requestMono(t,setUpdateImageValue,this),document.body.onscroll=function(){document.getElementsByClassName("footer")[0].style.bottom="0px"}},setUpdateImageValue=function(e){var t=JSON.parse(e).value[0],i=document.getElementById("imageName");i.value=t.name;var n=document.getElementById("imageCategory");setImageName(t.category_id,n);var a=document.getElementById("imagePath");a.src=PropertyConsts.MONO_IMG_PRE+t.path;var o=document.getElementById("imagePathP");o.innerHTML=PropertyConsts.MONO_IMG_PRE+t.path;var r=document.getElementById("imageDimension");r.innerHTML=t.width+"*"+t.height},updateImage=function(){var e=parseInt(localStorage.getItem("ImageId")),t=document.getElementById("imageName").value,i=document.getElementById("imageCategory").categoryId,n={module:"images",method:"update",arguments:{id:e,name:t,category_id:i}};Utils.requestMono(n,function(){document.getElementById("imageresult").innerHTML="Image updated"},this)};$uptImg=updateImage;var imageCategoryCache={},pickImagesCategory=function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1;var t=new SelectedTreePane("imageCategory",imageCategoryCache);Utils.initCategory(imageCategoryCache,"img_categories",null,function(){t.init()})};$pickics=pickImagesCategory,$iuig=initUpdateImage;var setImageName=function(e,t){Object.getOwnPropertyNames(imageCategoryCache).length<=0&&Utils.initCategory(imageCategoryCache,"img_categories",null,function(){t.value=getImageFullName(e,imageCategoryCache)})},getImageFullName=function(e,t){var i="";for(var n in t)n==e&&(i=t[n].name,t[n].parent_id&&(i=getImageFullName(t[n].parent_id,t)+" - "+i));return i},uploadImage=function(){if(doCheck()){for(var e=document.getElementById("category_id"),t=document.getElementById("image_name"),i={icon:!0,category_id:e.categoryId,name:t.value},n=document.getElementsByName("imagePath"),a=0;a<n.length;a++){var o=document.getElementById(n[a].value);n[a].checked&&("filePath"==n[a].value?i.image=o.files[0]:i.image_url=o.value)}var r={module:"images",method:"add",arguments:i};Utils.requestMono(r,function(e){var t=JSON.parse(e);return t.error?void alert(t.error):void(t.value&&(alert("Image has uploaded"),clearInputValue(),setImageValue(t.value)))},this)}};$uplImg=uploadImage,doCheck=function(){for(var e=document.getElementsByName("imagePath"),t=0;t<e.length;t++){var i=document.getElementById(e[t].value);if(e[t].checked){if("filePath"==e[t].value&&!i.files[0])return alert("No file chosen"),!1;if("filePath2"==e[t].value&&!i.value)return alert("Image Path required"),!1}}var n=document.getElementById("category_id");return n.categoryId?!0:(alert("No category selected"),!1)};var setImageValue=function(e){var t=document.createElement("div");t.setAttribute("class","tb-image-icon");var i=document.createElement("img");i.src=PropertyConsts.MONO_IMG_PRE+e.icon,t.appendChild(i);var n=document.createElement("span");n.setAttribute("class","tb-image-span"),n.innerHTML=e.name,t.appendChild(n),document.getElementById("categoryIcon").appendChild(t)},clearInputValue=function(){var e=document.getElementById("filePath"),t=document.getElementById("category_id");t.value="",t.categoryId=void 0,e.files[0]=void 0,e.value="",document.getElementById("image_name").value="";for(var i=document.getElementById("categoryIcon");i.hasChildNodes();)i.removeChild(i.firstChild)},imageCategoryCache={},pickImageCategory=function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1;var t=new SelectedTreePane("category_id",imageCategoryCache),i=PropertyConsts.SCOPE_PRIMITIVE;Utils.initCategory(imageCategoryCache,"img_categories",i,function(){t.init()})};$pickic=pickImageCategory;var checkPath=function(){for(var e=document.getElementsByName("imagePath"),t=0;t<e.length;t++){var i=document.getElementById(e[t].value);e[t].checked?(i.removeAttribute("disabled"),"image-http-path-disable"==i.getAttribute("class")&&i.setAttribute("class","image-http-path")):(i.setAttribute("disabled",!0),"image-http-path"==i.getAttribute("class")&&i.setAttribute("class","image-http-path-disable"))}};$pathch=checkPath,CategoryManager=function(){var e,t,i;1==arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(e=arguments[0],this.tableName=e.tableName,this.categoryText=e.categoryText,this.libraryText=e.libraryText,this.listSrc=e.listSrc,t=e.addHandler,i=e.updateHandler):(this.tableName=arguments[0],this.categoryText=arguments[1],this.libraryText=arguments[2],this.listSrc=arguments[3],t=arguments[4],i=arguments[5]),this.addHandler=t||this.addHandler,this.updateHandler=i||this.updateHandler,this.tableDiv="categoryContent",this.tableId="categoryTable",this.box=new twaver.ElementBox,this.table=new twaver.controls.TreeTable(this.box),this.table.getSelectColor=function(){return"#F8CFAE"}},twaver.Util.ext("CategoryManager",Object,{init:function(){this.createTableDiv(),this.initCategoryTreeTable()},createTableDiv:function(){var e=this.createCategory(this.categoryText,this.libraryText,this.listSrc);this.appendChild(e,document.getElementById("main"),100,0,0,100)},createCategory:function(e,t,i){var n=this,a=document.createElement("div");a.setAttribute("id",this.tableDiv),a.setAttribute("class","table-div1");var o=document.createElement("h2"),r=document.createElement("span");r.innerHTML=e,o.appendChild(r);var s=document.createElement("a");return s.setAttribute("class","add-new-h2"),s.onclick=function(){n.addHandler()},s.innerHTML="Add New",o.appendChild(s),s=document.createElement("a"),s.setAttribute("class","add-new-h2"),s.innerHTML=t,s.href=i,o.appendChild(s),a.appendChild(o),a},appendChild:function(e,t,i,n,a,o){e.style.position="absolute",null!=o&&(e.style.left=o+"px"),null!=i&&(e.style.top=i+"px"),null!=n&&(e.style.right=n+"px"),null!=a&&(e.style.bottom=a+"px"),t.appendChild(e)},initCategoryTreeTable:function(){var e=this,t=new twaver.controls.TablePane(this.table),i=new twaver.controls.BorderPane(t);this.appendChild(i.getView(),document.getElementById(this.tableDiv),40,0,30,0);var n=i.getView().style;n.width="970px",t.getTableHeader().setHeight(32),t.getTableHeader().setColumnLineColor("#EA7518"),t.getTableHeader().onColumnRendered=function(e){e.style.backgroundColor="#EA7518",e.style.color="#fff"},this.table.setRowHeight(30),this.table.setColumnLineColor("#EA7518"),this.table.setRowLineColor("#EA7518"),this.table.getIcon=function(){return null},this.table.getTreeColumn().setClient("pack",!0),this.table.getTreeColumn().setWidth(250);var a=new twaver.Pool("span");this.table.addPool(a),this.table.getTreeColumn().renderHeader=function(e){var t=a.get();t.style.whiteSpace="nowrap",t.style.verticalAlign="middle",t.style.padding="1px 2px 1px 2px",t.innerHTML="Tree",t.setAttribute("title",t.innerHTML),t.style.font="bold 12px Helvetica",e.style.textAlign="center",e.appendChild(t)};var o=this.table.getTreeColumn().renderCell;this.table.getTreeColumn().renderCell=function(e){return e.div.style.borderLeft="1px solid #EA7518",o(e)},this.createColumn("#","id","accessor","string",!1,"center").setWidth(50);var r=this.createColumn("Parent","parentId","client","string",!1,"center").setWidth(50);r=this.createColumn("Name","name","accessor","string",!0,"left").setWidth(300),r=this.createColumn("Template Count","count","client","string",!1,"right").setWidth(150),r=this.createColumn("Action","action","client","string",!0),r.setWidth(150),r.renderCell=function(t){var i={id:t.data.getId(),name:t.data.getName(),parent_id:t.data.getClient("parentId"),type:t.data.getClient("type")},n=e.createHref("tableEdit",function(){e.updateHandler(i)}),a=e.createHref("tableDelete",function(){e.deleteHandler(i)});t.div.appendChild(n),t.div.appendChild(a),t.div.setAttribute("class","table-item-action")},this.loadData(this.tableId)},createHref:function(e,t){var i=document.createElement("button");return i.className=e,i.onclick=t,i},loadData:function(){var e=this,t={module:e.tableName,method:"search",arguments:{scope:PropertyConsts.SCOPE_PRIMITIVE}};Utils.requestMono(t,function(t){var i=JSON.parse(t);if(i.value&&i.value.length>0){var n=i.value;e.box.clear();for(var a=0;a<n.length;a++){var o=n[a],r=new twaver.Node(o.id);r.setName(o.name),r.setClient("parentId",o.parent_id),r.setClient("type",o.type),0===o.count||"0"===o.count?r.setClient("count",""):r.setClient("count",o.count),e.box.add(r)}for(var a=0;a<n.length;a++){var o=n[a],s=e.box.getDataById(o.parent_id);if(s){var r=e.box.getDataById(o.id);r.setParent(s)}}e.table.expandAll()}})},createColumn:function(e,t,i,n,a,o){var r=new twaver.Column(e);return r.setName(e),r.setPropertyName(t),r.setPropertyType(i),n&&r.setValueType(n),r.setEditable(a),r.renderHeader=function(e){var t=document.createElement("span");t.style.whiteSpace="nowrap",t.style.verticalAlign="middle",t.style.padding="1px 2px 1px 2px",t.innerHTML=r.getName()?r.getName():r.getPropertyName(),t.setAttribute("title",t.innerHTML),t.style.font="bold 12px Helvetica",e.style.textAlign="center",e.appendChild(t)},o=o||"center",r.setHorizontalAlign(o),this.table.getColumnBox().add(r),r},deleteHandler:function(e){if(confirm("Delete this category?")){var t=this,i={module:t.tableName,method:"remove",arguments:{id:e.id}};Utils.requestMono(i,this.loadData,this)}},updateHandler:function(){},addHandler:function(){}}),CreateCategoryManager=function(e){this.isImage=e,e?CreateCategoryManager.superClass.constructor.apply(this,["img_categories","Image Category","Image Library","imageLibrary.html"]):CreateCategoryManager.superClass.constructor.apply(this,["tpl_categories","Template Category","Template Library","templateLibrary.html"])},twaver.Util.ext("CreateCategoryManager",CategoryManager,{updateHandler:function(e){var t=e.parent_id;(void 0==t||null==t||0/0==t)&&(t="");var i=[{label:"ID:",id:"id",readonly:!0,value:e.id,editable:!1},{label:"Name:",id:"name",readonly:!1,value:e.name},{label:"Parent:",id:"parent",readonly:!1,value:t}];if(!this.isImage){var n=e.type;i.push({label:"Type:",id:"templateType",type:"select",options:[PropertyConsts.TYPE_ROOMS,PropertyConsts.TYPE_COMPONENT],value:n})}Utils.showInputDialog(i,"Update Category",!0,this.updateCategory,this,[e],null,null)},updateCategory:function(e,t){var i=this;if(t.name){var n={module:i.tableName,method:"update",arguments:{id:t.id,name:t.name,parent_id:parseInt(t.parent),type:t.templateType}};Utils.requestMono(n,this.loadData,this)}},addHandler:function(){var e=new TreeComboBox("Parent:",this.tableName,!0),t=[{label:"Name:",id:"name",readonly:!1},{value:e.getView(),type:"div"}];this.isImage||t.push({label:"Type:",id:"templateType",type:"select",options:[PropertyConsts.TYPE_ROOMS,PropertyConsts.TYPE_COMPONENT]}),Utils.showInputDialog(t,"Add Category",!0,this.addCategory,this,[e],null,null)},addCategory:function(e,t){if(t.name){var i={module:this.tableName,method:"add",arguments:{name:t.name,parent_id:parseInt(e.getHideValue()),type:t.templateType}};Utils.requestMono(i,this.loadData,this)}}}),UserTablePane=function(){},twaver.Util.ext("UserTablePane",BaseListPane,{initContents:function(){this._module="users",this._method="search",this._arguments.order_by=JSON.stringify({id:PropertyConsts.ORDER_BY_ASC})},initTable:function(){this.table.setEditable(!0),this.table.setRowHeight(40);var e=this.pagePane.getTablePane();this.createColumn(e,"#","id","client","string",!1,50,"center"),this.createColumn(e,"User","user","client","string",!1,150,"center"),this.createColumn(e,"Customer","customer_name","client","string",!1,300,"left"),this.createColumn(e,"Comments","comments","client","string",!1,200,"left",!0),this.createColumn(e,"From","start_date","client","date",!1,100,"center");var t=this.createColumn(e,"To","end_date","client","date",!1,100,"center"),i=t.renderCell;t.renderCell=function(e){i(e);var t=new Date(Date.parse(e.value)),n=t.getTime()<(new Date).getTime();n&&(e.div.style.color="red")},this.createColumn(e,"Created","create_date","client","date",!1,100,"center"),this.createColumn(e,"Changed","change_date","client","date",!1,100,"center");var n=this.createColumn(e,"Action","id","client","action",!1,100,"center"),a=this;n.renderCell=function(e){var t=e.value,i=document.createElement("button");i.className="tableEdit",i.onclick=function(){a.updateHandler(t,e.data)},e.div.appendChild(i),i=document.createElement("button"),i.className="tableDelete",i.onclick=function(){a.deleteHandler(t)},e.div.appendChild(i)},e.getTableHeader().setHeight(50);var o=document.getElementById("add-button");o.table=this,o.onclick=this.addNewUser.bind(this)},deleteHandler:function(e){if(confirm("Delete this user?")){var t=this,i={module:t._module,method:"remove",arguments:{id:e}},t=this;Utils.requestMono(i,function(){t.pagePane.search()},this)}},updateHandler:function(e,t){var i=[{label:"User:",id:"user",readonly:!0,value:t.getClient("user"),editable:!1},{label:"Customer:",id:"customer_name",readonly:!1,value:this.getTextString(t.getClient("customer_name")),editable:!0},{label:"From:",id:"start_date",readonly:!1,value:Utils.formatDate(t.getClient("start_date")),editable:!0},{label:"To:",id:"end_date",readonly:!1,value:Utils.formatDate(t.getClient("end_date")),editable:!0},{label:"New Password:",id:"password",readonly:!1,type:"password",value:"",editable:!0},{label:"Confirm Password:",id:"password2",readonly:!1,type:"password",value:"",editable:!0},{label:"Comments:",id:"comments",readonly:!1,value:this.getTextString(t.getClient("comments")),editable:!0}];Utils.showInputDialog(i,"Update User",!0,this.updateUser,this,[e],null,null)},getTextString:function(e){return e?e:""},addNewUser:function(){var e=new Date,t=new Date((new Date).getTime()+6048e5),i=[{label:"User:",id:"mono_user",readonly:!1,value:"",editable:!0},{label:"Customer:",id:"customer_name",readonly:!1,value:"",editable:!0},{label:"From:",id:"start_date",readonly:!1,value:Utils.formatDate(e.toString()),editable:!0},{label:"To:",id:"end_date",readonly:!1,value:Utils.formatDate(t.toString()),editable:!0},{label:"New Password:",id:"password",readonly:!1,type:"password",value:"",editable:!0},{label:"Confirm Password:",id:"password2",readonly:!1,type:"password",value:"",editable:!0},{label:"Comments:",id:"comments",readonly:!1,value:"",editable:!0}];Utils.showInputDialog(i,"Create User",!0,this.doAddNewUser,this,[],null,null)},updateUser:function(e,t){if(t.password!=t.password2)return void alert("New password and confirm password do not match");var i=this,n={module:i._module,method:"update",arguments:{id:e,start_date:t.start_date,end_date:t.end_date,customer_name:t.customer_name,password:t.password,comments:t.comments}};t.password||delete n.arguments.password,Utils.requestMono(n,i.pagePane.search,i.pagePane)},doAddNewUser:function(e){if(e.password!=e.password2)return void alert("New password and confirm password do not match");if(e.password.length<8)return void alert("Password must have at least 8 characters");var t=this,i={module:t._module,method:"add",arguments:{user:e.mono_user,customer_name:e.customer_name,start_date:e.start_date,end_date:e.end_date,password:e.password,comments:e.comments}};Utils.requestMono(i,t.pagePane.search,t.pagePane)},getPageNumberStorageName:function(){return"UserTable"}}),TemplateTablePane=function(){},twaver.Util.ext("TemplateTablePane",BaseListPane,{templateCategoryCache:{},initContents:function(){this._module="templates",this._method="search",this._arguments.order_by=JSON.stringify({id:PropertyConsts.ORDER_BY_DESC}),this.initCategoryCache()},initCategoryCache:function(){Object.getOwnPropertyNames(this.templateCategoryCache).length<=0&&Utils.initCategory(this.templateCategoryCache,"tpl_categories",null)},initTable:function(){this.table.setEditable(!0),this.table.setRowHeight(60);var e=this.pagePane.getTablePane();this.createColumn(e,"Image","icon","client","image",!1,100,"center"),this.createColumn(e,"Name","name","client","string",!1,120,"left",!0),this.createColumn(e,"Category","category_name","client","string",!1,150,"center"),this.createColumn(e,"Author","author","client","string",!1,100,"center"),this.createColumn(e,"Tags","tags","client","string",!1,150,"center"),this.createColumn(e,"Create Date","create_date","client","date",!1,100,"center"),this.createColumn(e,"Change Date","change_date","client","date",!1,100,"center");var t=this.createColumn(e,"Action","id","client","action",!1,150,"center"),i=this;t.renderCell=function(e){var t=e.value,n=document.createElement("button");n.className="tableEdit",n.onclick=function(){i.updateHandler(t,e.data.getClient("name"),e.data.getClient("category"))},e.div.appendChild(n),n=document.createElement("button"),n.className="tableDelete",n.onclick=function(){i.deleteHandler(t)},e.div.appendChild(n),n=document.createElement("button"),n.className="tableDownload",n.onclick=function(){i.downloadHandler(t)},e.div.appendChild(n),n=document.createElement("button"),n.className="tablePublish",n.onclick=function(){i.transforuvs(t)},e.div.appendChild(n)},e.getTableHeader().setHeight(50)},deleteHandler:function(e){var t=this,i={module:t._module,method:"remove",arguments:{id:e}},t=this;Utils.requestMono(i,function(){t.pagePane.search()},this)},updateHandler:function(e,t,i){var n=this.getCategoryName(i),a=new TreeComboBox("Category:","tpl_categories",!0,null,null,null,n),o=[{label:"ID:",id:"templateId",readonly:!0,value:e,editable:!1},{label:"Name:",id:"tempName",value:t},{value:a.getView(),type:"div"}];Utils.showInputDialog(o,"Update Category of Template",!0,this.updateCategory,this,[a,i],null,null)},downloadHandler:function(e){console.log("downloading "+e+"...")},transforuvs:function(e){var t=this,i=new mono.DataBox;initModelLib(),modelManager.loadComponentTemplate(i,e,!0,null,function(){i.forEach(function(e){var t=e.getStyle("m.texture.image");if(t){var i=Utils.handlerTexture(t,!0);e.setStyle("m.texture.image",i)}});var n=new TGL.JsonSerializer(i);n.filterFunction=function(e){return!(e instanceof mono.Light)};var a=n.serialize(),o={module:t._module,method:"update",arguments:{id:e,uv_value:a}};Utils.requestMono(o,function(){alert("the template has been publish")})})},updateCategory:function(e,t,i){var n=this,a=e.getHideValue()||t,o={module:n._module,method:"update",arguments:{id:i.templateId,name:i.tempName,category:parseInt(a)}};Utils.requestMono(o,n.pagePane.search,n.pagePane)},getPageNumberStorageName:function(){return"TemplateTable"},getCategoryName:function(e){var t="",i=this;return Object.getOwnPropertyNames(i.templateCategoryCache).length>0&&(t=i.getCategoryFullName(e,i.templateCategoryCache)),t},getCategoryFullName:function(e,t){var i="";for(var n in t)n==e&&(i=t[n].name,t[n].parent_id&&(i=this.getCategoryFullName(t[n].parent_id,t)+" - "+i));return i}}),LogTablePane=function(){},twaver.Util.ext("LogTablePane",BaseListPane,{initContents:function(){this._module="logs",this._method="search",this._arguments.order_by=JSON.stringify({id:PropertyConsts.ORDER_BY_DESC})},initTable:function(){this.table.setEditable(!0),this.table.setRowHeight(40);var e=this.pagePane.getTablePane();this.createColumn(e,"#","id","client","string",!1,50,"center"),this.createColumn(e,"User","user","client","string",!1,80,"left"),this.createColumn(e,"IP","ip","client","string",!1,100,"center"),this.createColumn(e,"Module","module","client","string",!1,80,"left"),this.createColumn(e,"Method","method","client","string",!1,80,"left"),this.createColumn(e,"Session","session_id","client","string",!1,180,"left"),this.createColumn(e,"User Agent","user_agent","client","string",!1,200,"left",!0);var t=this.createColumn(e,"Data","data","client","string",!1,100,"left",!0);t.renderCell=function(e){var t=e.value;t&&(t=t.replace(/\n/g,"")),e.div.innerHTML=t},this.createColumn(e,"Error","error","client","string",!1,100,"left"),this.createColumn(e,"Cost","time","client","string",!1,50,"right");var i=this.createColumn(e,"Date","date","client","time",!1,150,"center");i.renderCell=function(e){var t=new Date(Date.parse(e.value));e.div.innerHTML=t.toLocaleDateString()+" "+t.toLocaleTimeString()},e.getTableHeader().setHeight(40)},getPageNumberStorageName:function(){return"LogTable"}})}();