(function(a,b){function z(a,b,c){a!=null&&("number"==typeof a?this.fromNumber(a,b,c):b==null&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function A(){return new z(null)}function B(a,b,c,d,e,f){while(--f>=0){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=g&67108863}return e}function C(a,b,c,d,e,f){var g=b&32767,h=b>>15;while(--f>=0){var i=this[a]&32767,j=this[a++]>>15,k=h*i+j*g;i=g*i+((k&32767)<<15)+c[d]+(e&1073741823),e=(i>>>30)+(k>>>15)+h*j+(e>>>30),c[d++]=i&1073741823}return e}function D(a,b,c,d,e,f){var g=b&16383,h=b>>14;while(--f>=0){var i=this[a]&16383,j=this[a++]>>14,k=h*i+j*g;i=g*i+((k&16383)<<14)+c[d]+e,e=(i>>28)+(k>>14)+h*j,c[d++]=i&268435455}return e}function J(a){return F.charAt(a)}function K(a,b){var c=G[a.charCodeAt(b)];return c==null?-1:c}function L(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s}function M(a){this.t=1,this.s=a<0?-1:0,a>0?this[0]=a:a<-1?this[0]=a+DV:this.t=0}function N(a){var b=A();return b.fromInt(a),b}function O(a,b){var c;if(b==16)c=4;else if(b==8)c=3;else if(b==256)c=8;else if(b==2)c=1;else if(b==32)c=5;else{if(b!=4){this.fromRadix(a,b);return}c=2}this.t=0,this.s=0;var d=a.length,e=!1,f=0;while(--d>=0){var g=c==8?a[d]&255:K(a,d);if(g<0){a.charAt(d)=="-"&&(e=!0);continue}e=!1,f==0?this[this.t++]=g:f+c>this.DB?(this[this.t-1]|=(g&(1<<this.DB-f)-1)<<f,this[this.t++]=g>>this.DB-f):this[this.t-1]|=g<<f,f+=c,f>=this.DB&&(f-=this.DB)}c==8&&(a[0]&128)!=0&&(this.s=-1,f>0&&(this[this.t-1]|=(1<<this.DB-f)-1<<f)),this.clamp(),e&&z.ZERO.subTo(this,this)}function P(){var a=this.s&this.DM;while(this.t>0&&this[this.t-1]==a)--this.t}function Q(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(a==16)b=4;else if(a==8)b=3;else if(a==2)b=1;else if(a==32)b=5;else{if(a!=4)return this.toRadix(a);b=2}var c=(1<<b)-1,d,e=!1,f="",g=this.t,h=this.DB-g*this.DB%b;if(g-->0){h<this.DB&&(d=this[g]>>h)>0&&(e=!0,f=J(d));while(g>=0)h<b?(d=(this[g]&(1<<h)-1)<<b-h,d|=this[--g]>>(h+=this.DB-b)):(d=this[g]>>(h-=b)&c,h<=0&&(h+=this.DB,--g)),d>0&&(e=!0),e&&(f+=J(d))}return e?f:"0"}function R(){var a=A();return z.ZERO.subTo(this,a),a}function S(){return this.s<0?this.negate():this}function T(a){var b=this.s-a.s;if(b!=0)return b;var c=this.t;b=c-a.t;if(b!=0)return b;while(--c>=0)if((b=this[c]-a[c])!=0)return b;return 0}function U(a){var b=1,c;return(c=a>>>16)!=0&&(a=c,b+=16),(c=a>>8)!=0&&(a=c,b+=8),(c=a>>4)!=0&&(a=c,b+=4),(c=a>>2)!=0&&(a=c,b+=2),(c=a>>1)!=0&&(a=c,b+=1),b}function V(){return this.t<=0?0:this.DB*(this.t-1)+U(this[this.t-1]^this.s&this.DM)}function W(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s}function X(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s}function Y(a,b){var c=a%this.DB,d=this.DB-c,e=(1<<d)-1,f=Math.floor(a/this.DB),g=this.s<<c&this.DM,h;for(h=this.t-1;h>=0;--h)b[h+f+1]=this[h]>>d|g,g=(this[h]&e)<<c;for(h=f-1;h>=0;--h)b[h]=0;b[f]=g,b.t=this.t+f+1,b.s=this.s,b.clamp()}function Z(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t){b.t=0;return}var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function $(a,b){var c=0,d=0,e=Math.min(a.t,this.t);while(c<e)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){d-=a.s;while(c<this.t)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{d+=this.s;while(c<a.t)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=d<0?-1:0,d<-1?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()}function _(a,b){var c=this.abs(),d=a.abs(),e=c.t;b.t=e+d.t;while(--e>=0)b[e]=0;for(e=0;e<d.t;++e)b[e+c.t]=c.am(0,d[e],b,e,0,c.t);b.s=0,b.clamp(),this.s!=a.s&&z.ZERO.subTo(b,b)}function ab(a){var b=this.abs(),c=a.t=2*b.t;while(--c>=0)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()}function bb(a,b,c){var d=a.abs();if(d.t<=0)return;var e=this.abs();if(e.t<d.t){b!=null&&b.fromInt(0),c!=null&&this.copyTo(c);return}c==null&&(c=A());var f=A(),g=this.s,h=a.s,i=this.DB-U(d[d.t-1]);i>0?(d.lShiftTo(i,f),e.lShiftTo(i,c)):(d.copyTo(f),e.copyTo(c));var j=f.t,k=f[j-1];if(k==0)return;var l=k*(1<<this.F1)+(j>1?f[j-2]>>this.F2:0),m=this.FV/l,n=(1<<this.F1)/l,o=1<<this.F2,p=c.t,q=p-j,r=b==null?A():b;f.dlShiftTo(q,r),c.compareTo(r)>=0&&(c[c.t++]=1,c.subTo(r,c)),z.ONE.dlShiftTo(j,r),r.subTo(f,f);while(f.t<j)f[f.t++]=0;while(--q>=0){var s=c[--p]==k?this.DM:Math.floor(c[p]*m+(c[p-1]+o)*n);if((c[p]+=f.am(0,s,c,q,0,j))<s){f.dlShiftTo(q,r),c.subTo(r,c);while(c[p]<--s)c.subTo(r,c)}}b!=null&&(c.drShiftTo(j,b),g!=h&&z.ZERO.subTo(b,b)),c.t=j,c.clamp(),i>0&&c.rShiftTo(i,c),g<0&&z.ZERO.subTo(c,c)}function cb(a){var b=A();return this.abs().divRemTo(a,null,b),this.s<0&&b.compareTo(z.ZERO)>0&&a.subTo(b,b),b}function db(a){this.m=a}function eb(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function fb(a){return a}function gb(a){a.divRemTo(this.m,null,a)}function hb(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function ib(a,b){a.squareTo(b),this.reduce(b)}function jb(){if(this.t<1)return 0;var a=this[0];if((a&1)==0)return 0;var b=a&3;return b=b*(2-(a&15)*b)&15,b=b*(2-(a&255)*b)&255,b=b*(2-((a&65535)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function kb(a){this.m=a,this.mp=a.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function lb(a){var b=A();return a.abs().dlShiftTo(this.m.t,b),b.divRemTo(this.m,null,b),a.s<0&&b.compareTo(z.ZERO)>0&&this.m.subTo(b,b),b}function mb(a){var b=A();return a.copyTo(b),this.reduce(b),b}function nb(a){while(a.t<=this.mt2)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=a[b]&32767,d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;c=b+this.m.t,a[c]+=this.m.am(0,d,a,b,0,this.m.t);while(a[c]>=a.DV)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function ob(a,b){a.squareTo(b),this.reduce(b)}function pb(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function qb(){return(this.t>0?this[0]&1:this.s)==0}function rb(a,b){if(a>4294967295||a<1)return z.ONE;var c=A(),d=A(),e=b.convert(this),f=U(a)-1;e.copyTo(c);while(--f>=0){b.sqrTo(c,d);if((a&1<<f)>0)b.mulTo(d,e,c);else{var g=c;c=d,d=g}}return b.revert(c)}function sb(a,b){var c;return a<256||b.isEven()?c=new db(b):c=new kb(b),this.exp(a,c)}function tb(){var a=A();return this.copyTo(a),a}function ub(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function vb(){return this.t==0?this.s:this[0]<<24>>24}function wb(){return this.t==0?this.s:this[0]<<16>>16}function xb(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function yb(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function zb(a){a==null&&(a=10);if(this.signum()==0||a<2||a>36)return"0";var b=this.chunkSize(a),c=Math.pow(a,b),d=N(c),e=A(),f=A(),g="";this.divRemTo(d,e,f);while(e.signum()>0)g=(c+f.intValue()).toString(a).substr(1)+g,e.divRemTo(d,e,f);return f.intValue().toString(a)+g}function Ab(a,b){this.fromInt(0),b==null&&(b=10);var c=this.chunkSize(b),d=Math.pow(b,c),e=!1,f=0,g=0;for(var h=0;h<a.length;++h){var i=K(a,h);if(i<0){a.charAt(h)=="-"&&this.signum()==0&&(e=!0);continue}g=b*g+i,++f>=c&&(this.dMultiply(d),this.dAddOffset(g,0),f=0,g=0)}f>0&&(this.dMultiply(Math.pow(b,f)),this.dAddOffset(g,0)),e&&z.ZERO.subTo(this,this)}function Bb(a,b,c){if("number"==typeof b)if(a<2)this.fromInt(1);else{this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(z.ONE.shiftLeft(a-1),Jb,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(b))this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(z.ONE.shiftLeft(a-1),this)}else{var d=new Array,e=a&7;d.length=(a>>3)+1,b.nextBytes(d),e>0?d[0]&=(1<<e)-1:d[0]=0,this.fromString(d,256)}}function Cb(){var a=this.t,b=new Array;b[0]=this.s;var c=this.DB-a*this.DB%8,d,e=0;if(a-->0){c<this.DB&&(d=this[a]>>c)!=(this.s&this.DM)>>c&&(b[e++]=d|this.s<<this.DB-c);while(a>=0){c<8?(d=(this[a]&(1<<c)-1)<<8-c,d|=this[--a]>>(c+=this.DB-8)):(d=this[a]>>(c-=8)&255,c<=0&&(c+=this.DB,--a)),(d&128)!=0&&(d|=-256),e==0&&(this.s&128)!=(d&128)&&++e;if(e>0||d!=this.s)b[e++]=d}}return b}function Db(a){return this.compareTo(a)==0}function Eb(a){return this.compareTo(a)<0?this:a}function Fb(a){return this.compareTo(a)>0?this:a}function Gb(a,b,c){var d,e,f=Math.min(a.t,this.t);for(d=0;d<f;++d)c[d]=b(this[d],a[d]);if(a.t<this.t){e=a.s&this.DM;for(d=f;d<this.t;++d)c[d]=b(this[d],e);c.t=this.t}else{e=this.s&this.DM;for(d=f;d<a.t;++d)c[d]=b(e,a[d]);c.t=a.t}c.s=b(this.s,a.s),c.clamp()}function Hb(a,b){return a&b}function Ib(a){var b=A();return this.bitwiseTo(a,Hb,b),b}function Jb(a,b){return a|b}function Kb(a){var b=A();return this.bitwiseTo(a,Jb,b),b}function Lb(a,b){return a^b}function Mb(a){var b=A();return this.bitwiseTo(a,Lb,b),b}function Nb(a,b){return a&~b}function Ob(a){var b=A();return this.bitwiseTo(a,Nb,b),b}function Pb(){var a=A();for(var b=0;b<this.t;++b)a[b]=this.DM&~this[b];return a.t=this.t,a.s=~this.s,a}function Qb(a){var b=A();return a<0?this.rShiftTo(-a,b):this.lShiftTo(a,b),b}function Rb(a){var b=A();return a<0?this.lShiftTo(-a,b):this.rShiftTo(a,b),b}function Sb(a){if(a==0)return-1;var b=0;return(a&65535)==0&&(a>>=16,b+=16),(a&255)==0&&(a>>=8,b+=8),(a&15)==0&&(a>>=4,b+=4),(a&3)==0&&(a>>=2,b+=2),(a&1)==0&&++b,b}function Tb(){for(var a=0;a<this.t;++a)if(this[a]!=0)return a*this.DB+Sb(this[a]);return this.s<0?this.t*this.DB:-1}function Ub(a){var b=0;while(a!=0)a&=a-1,++b;return b}function Vb(){var a=0,b=this.s&this.DM;for(var c=0;c<this.t;++c)a+=Ub(this[c]^b);return a}function Wb(a){var b=Math.floor(a/this.DB);return b>=this.t?this.s!=0:(this[b]&1<<a%this.DB)!=0}function Xb(a,b){var c=z.ONE.shiftLeft(a);return this.bitwiseTo(c,b,c),c}function Yb(a){return this.changeBit(a,Jb)}function Zb(a){return this.changeBit(a,Nb)}function $b(a){return this.changeBit(a,Lb)}function _b(a,b){var c=0,d=0,e=Math.min(a.t,this.t);while(c<e)d+=this[c]+a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){d+=a.s;while(c<this.t)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{d+=this.s;while(c<a.t)d+=a[c],b[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=d<0?-1:0,d>0?b[c++]=d:d<-1&&(b[c++]=this.DV+d),b.t=c,b.clamp()}function ac(a){var b=A();return this.addTo(a,b),b}function bc(a){var b=A();return this.subTo(a,b),b}function cc(a){var b=A();return this.multiplyTo(a,b),b}function dc(){var a=A();return this.squareTo(a),a}function ec(a){var b=A();return this.divRemTo(a,b,null),b}function fc(a){var b=A();return this.divRemTo(a,null,b),b}function gc(a){var b=A(),c=A();return this.divRemTo(a,b,c),new Array(b,c)}function hc(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function ic(a,b){if(a==0)return;while(this.t<=b)this[this.t++]=0;this[b]+=a;while(this[b]>=this.DV)this[b]-=this.DV,++b>=this.t&&(this[this.t++]=0),++this[b]}function jc(){}function kc(a){return a}function lc(a,b,c){a.multiplyTo(b,c)}function mc(a,b){a.squareTo(b)}function nc(a){return this.exp(a,new jc)}function oc(a,b,c){var d=Math.min(this.t+a.t,b);c.s=0,c.t=d;while(d>0)c[--d]=0;var e;for(e=c.t-this.t;d<e;++d)c[d+this.t]=this.am(0,a[d],c,d,0,this.t);for(e=Math.min(a.t,b);d<e;++d)this.am(0,a[d],c,d,0,b-d);c.clamp()}function pc(a,b,c){--b;var d=c.t=this.t+a.t-b;c.s=0;while(--d>=0)c[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c[this.t+d-b]=this.am(b-d,a[d],c,0,0,this.t+d-b);c.clamp(),c.drShiftTo(1,c)}function qc(a){this.r2=A(),this.q3=A(),z.ONE.dlShiftTo(2*a.t,this.r2),this.mu=this.r2.divide(a),this.m=a}function rc(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var b=A();return a.copyTo(b),this.reduce(b),b}function sc(a){return a}function tc(a){a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(a.compareTo(this.r2)<0)a.dAddOffset(1,this.m.t+1);a.subTo(this.r2,a);while(a.compareTo(this.m)>=0)a.subTo(this.m,a)}function uc(a,b){a.squareTo(b),this.reduce(b)}function vc(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function wc(a,b){var c=a.bitLength(),d,e=N(1),f;if(c<=0)return e;c<18?d=1:c<48?d=3:c<144?d=4:c<768?d=5:d=6,c<8?f=new db(b):b.isEven()?f=new qc(b):f=new kb(b);var g=new Array,h=3,i=d-1,j=(1<<d)-1;g[1]=f.convert(this);if(d>1){var k=A();f.sqrTo(g[1],k);while(h<=j)g[h]=A(),f.mulTo(k,g[h-2],g[h]),h+=2}var l=a.t-1,m,n=!0,o=A(),p;c=U(a[l])-1;while(l>=0){c>=i?m=a[l]>>c-i&j:(m=(a[l]&(1<<c+1)-1)<<i-c,l>0&&(m|=a[l-1]>>this.DB+c-i)),h=d;while((m&1)==0)m>>=1,--h;(c-=h)<0&&(c+=this.DB,--l);if(n)g[m].copyTo(e),n=!1;else{while(h>1)f.sqrTo(e,o),f.sqrTo(o,e),h-=2;h>0?f.sqrTo(e,o):(p=e,e=o,o=p),f.mulTo(o,g[m],e)}while(l>=0&&(a[l]&1<<c)==0)f.sqrTo(e,o),p=e,e=o,o=p,--c<0&&(c=this.DB-1,--l)}return f.revert(e)}function xc(a){var b=this.s<0?this.negate():this.clone(),c=a.s<0?a.negate():a.clone();if(b.compareTo(c)<0){var d=b;b=c,c=d}var e=b.getLowestSetBit(),f=c.getLowestSetBit();if(f<0)return b;e<f&&(f=e),f>0&&(b.rShiftTo(f,b),c.rShiftTo(f,c));while(b.signum()>0)(e=b.getLowestSetBit())>0&&b.rShiftTo(e,b),(e=c.getLowestSetBit())>0&&c.rShiftTo(e,c),b.compareTo(c)>=0?(b.subTo(c,b),b.rShiftTo(1,b)):(c.subTo(b,c),c.rShiftTo(1,c));return f>0&&c.lShiftTo(f,c),c}function yc(a){if(a<=0)return 0;var b=this.DV%a,c=this.s<0?a-1:0;if(this.t>0)if(b==0)c=this[0]%a;else for(var d=this.t-1;d>=0;--d)c=(b*c+this[d])%a;return c}function zc(a){var b=a.isEven();if(this.isEven()&&b||a.signum()==0)return z.ZERO;var c=a.clone(),d=this.clone(),e=N(1),f=N(0),g=N(0),h=N(1);while(c.signum()!=0){while(c.isEven()){c.rShiftTo(1,c);if(b){if(!e.isEven()||!f.isEven())e.addTo(this,e),f.subTo(a,f);e.rShiftTo(1,e)}else f.isEven()||f.subTo(a,f);f.rShiftTo(1,f)}while(d.isEven()){d.rShiftTo(1,d);if(b){if(!g.isEven()||!h.isEven())g.addTo(this,g),h.subTo(a,h);g.rShiftTo(1,g)}else h.isEven()||h.subTo(a,h);h.rShiftTo(1,h)}c.compareTo(d)>=0?(c.subTo(d,c),b&&e.subTo(g,e),f.subTo(h,f)):(d.subTo(c,d),b&&g.subTo(e,g),h.subTo(f,h))}return d.compareTo(z.ONE)!=0?z.ZERO:h.compareTo(a)>=0?h.subtract(a):h.signum()<0?(h.addTo(a,h),h.signum()<0?h.add(a):h):h}function Cc(a){var b,c=this.abs();if(c.t==1&&c[0]<=Ac[Ac.length-1]){for(b=0;b<Ac.length;++b)if(c[0]==Ac[b])return!0;return!1}if(c.isEven())return!1;b=1;while(b<Ac.length){var d=Ac[b],e=b+1;while(e<Ac.length&&d<Bc)d*=Ac[e++];d=c.modInt(d);while(b<e)if(d%Ac[b++]==0)return!1}return c.millerRabin(a)}function Dc(a){var b=this.subtract(z.ONE),c=b.getLowestSetBit();if(c<=0)return!1;var d=b.shiftRight(c);a=a+1>>1,a>Ac.length&&(a=Ac.length);var e=A();for(var f=0;f<a;++f){e.fromInt(Ac[Math.floor(Math.random()*Ac.length)]);var g=e.modPow(d,this);if(g.compareTo(z.ONE)!=0&&g.compareTo(b)!=0){var h=1;while(h++<c&&g.compareTo(b)!=0){g=g.modPowInt(2,this);if(g.compareTo(z.ONE)==0)return!1}if(g.compareTo(b)!=0)return!1}}return!0}function Ec(){this.i=0,this.j=0,this.S=new Array}function Fc(a){var b,c,d;for(b=0;b<256;++b)this.S[b]=b;c=0;for(b=0;b<256;++b)c=c+this.S[b]+a[b%a.length]&255,d=this.S[b],this.S[b]=this.S[c],this.S[c]=d;this.i=0,this.j=0}function Gc(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}function Hc(){return new Ec}function Mc(a){Kc[Lc++]^=a&255,Kc[Lc++]^=a>>8&255,Kc[Lc++]^=a>>16&255,Kc[Lc++]^=a>>24&255,Lc>=Ic&&(Lc-=Ic)}function Nc(){Mc((new Date).getTime())}function Qc(){if(Jc==null){Nc(),Jc=Hc(),Jc.init(Kc);for(Lc=0;Lc<Kc.length;++Lc)Kc[Lc]=0;Lc=0}return Jc.next()}function Rc(a){var b;for(b=0;b<a.length;++b)a[b]=Qc()}function Sc(){}function Vc(a){var b,c,d="";for(b=0;b+3<=a.length;b+=3)c=parseInt(a.substring(b,b+3),16),d+=Tc.charAt(c>>6)+Tc.charAt(c&63);b+1==a.length?(c=parseInt(a.substring(b,b+1),16),d+=Tc.charAt(c<<2)):b+2==a.length&&(c=parseInt(a.substring(b,b+2),16),d+=Tc.charAt(c>>2)+Tc.charAt((c&3)<<4));while((d.length&3)>0)d+=Uc;return d}function Wc(a){var b="",c,d=0,e;for(c=0;c<a.length;++c){if(a.charAt(c)==Uc)break;v=Tc.indexOf(a.charAt(c));if(v<0)continue;d==0?(b+=J(v>>2),e=v&3,d=1):d==1?(b+=J(e<<2|v>>4),e=v&15,d=2):d==2?(b+=J(e),b+=J(v>>2),e=v&3,d=3):(b+=J(e<<2|v>>4),b+=J(v&15),d=0)}return d==1&&(b+=J(e<<2)),b}function Xc(a){var b=Wc(a),c,d=new Array;for(c=0;2*c<b.length;++c)d[c]=parseInt(b.substring(2*c,2*c+2),16);return d}function Yc(a,b){return new z(a,b)}function Zc(a){return a<16?"0"+a.toString(16):a.toString(16)}function $c(a,b){if(b<a.length+11)return null;var c=new Array,d=a.length-1;while(d>=0&&b>0){var e=a.charCodeAt(d--);e<128?c[--b]=e:e>127&&e<2048?(c[--b]=e&63|128,c[--b]=e>>6|192):(c[--b]=e&63|128,c[--b]=e>>6&63|128,c[--b]=e>>12|224)}c[--b]=0;var f=new Sc,g=new Array;while(b>2){g[0]=0;while(g[0]==0)f.nextBytes(g);c[--b]=g[0]}return c[--b]=2,c[--b]=0,new z(c)}function _c(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function ad(a,b){this.n=Yc(a,16),this.e=parseInt(b,16)}function bd(a){return a.modPowInt(this.e,this.n)}function cd(a){var b=$c(a,this.n.bitLength()+7>>3);if(b==null)return null;var c=this.doPrivate(b);if(c==null)return null;var d=c.toString(16);return(d.length&1)==0?d:"0"+d}function dd(a,b){var c=a.toByteArray(),d=0;while(d<c.length&&c[d]==0)++d;if(c.length-d!=b-1||c[d]!=2)return null;++d;while(c[d]!=0)if(++d>=c.length)return null;var e="";while(++d<c.length){var f=c[d]&255;f<128?e+=String.fromCharCode(f):f>191&&f<224?(e+=String.fromCharCode((f&31)<<6|c[d+1]&63),++d):(e+=String.fromCharCode((f&15)<<12|(c[d+1]&63)<<6|c[d+2]&63),d+=2)}return e}function ed(a,b,c){this.n=Yc(a,16),this.e=parseInt(b,16),this.d=Yc(c,16)}function fd(a,b,c,d,e,f,g,h){this.n=Yc(a,16),this.e=parseInt(b,16),this.d=Yc(c,16),this.p=Yc(d,16),this.q=Yc(e,16),this.dmp1=Yc(f,16),this.dmq1=Yc(g,16),this.coeff=Yc(h,16)}function gd(a){if(this.p==null||this.q==null)return a.modPow(this.d,this.n);var b=a.mod(this.p).modPow(this.dmp1,this.p),c=a.mod(this.q).modPow(this.dmq1,this.q);while(b.compareTo(c)<0)b=b.add(this.p);return b.subtract(c).multiply(this.coeff).mod(this.p).multiply(this.q).add(c)}function hd(a){var b=Yc(a,16),c=this.doPublic(b);return c==null?null:dd(c,this.n.bitLength()+7>>3)}function Sd(a,b,c){var d=0,e=0,f=b.split("\n"),g=a.measureText("e").width*2;return f.forEach(function(b){if(c){var f=b.split(" "),h=f.length,i="",j,k,l,m,n;for(l=0;l<h;l++){j=f[l]+(l===h-1?"":" "),k=i+j,m=a.measureText(k).width;if(m<c)i=k;else if(m==c)i="",e+=g;else{for(n=0;n<j.length;n++){k=i+j.substr(0,n+1);if(a.measureText(k).width>c){i=j.substring(n,j.length),e+=g;break}}while(i.length>0&&a.measureText(i).width>c)for(n=0;n<i.length;n++){k=i.substr(0,n+1);if(a.measureText(k).width>c){i=i.substring(n,i.length),e+=g;break}}}}}else m=a.measureText(b).width,d=m>d?m:d;e+=g}),d=c?c:d,{w:d,h:e}}function ke(a,b,c,d){var e=a.animate,f=d._now,g=d._shapeDataIndex,h,i=c._animates;i||(i=c._animates={});if(g.length)for(var j=0;j<g.length;j++){h=g[j];var k=i[h];k||(k=i[h]={}),i=k}else h=g;var l=i[h];l||(l=i[h]={},e.forEach(function(e){var g=e.attr,h=l[g],i;e={attr:g,to:e.to,type:e.type||"number",delay:e.delay||0,dur:e.dur||1e3,interval:e.interval||0,finish:e.finish,repeat:e.repeat||1,reverse:e.reverse==null?!0:e.reverse,onDone:e.onDone,easing:e.easing,trigger:e.to==null,start:f,time:0,total:0,count:0,started:!1,stopped:!1,current:null},Array.isArray(e.dur)&&(e.groupDur=e.dur.slice(0,e.dur.length-1),e.dur=e.dur[e.dur.length-1],e.groupDurTotal=e.groupDur.reduce(function(a,b,c){return e.groupDur[c]=a+b},0),e.groupIndex=0,e.groupTime=0,e.groupStart=f),e.finish==null&&(e.finish=e.delay+e.dur+e.interval),h?Array.isArray(h)?(h.push(e),h=h[h.length-2]):l[g]=[h,e]:(i=$d(c,b,a,g,d),l[g]=e),h&&(i=h.to,h.type==="group_set"&&(i=i[i.length-1])),e.from=i,e.trigger||(e.started=!0,ue(e),ve(e))})),e=l,Object.keys(e).forEach(function(g){var h=e[g];if(Array.isArray(h)){var i=h[h.length-1];i.count+1===i.repeat?h.forEach(function(e){le(e,a,b,c,d,!0)}):i.count+1<i.repeat&&(i.total>=i.finish&&h.forEach(function(a){a.trigger||(a.started=!0),a.stopped=!1,a.time=0,a.start=f,a.total=0,a.type==="group_set"&&(a.groupIndex=0,a.groupTime=0,a.groupStart=f)}),h.forEach(function(e){le(e,a,b,c,d,!1)}))}else le(h,a,b,c,d,!0)})}function le(a,b,c,d,e,f){if(a.trigger){var g=$d(d,c,b,a.attr,e,null,!1);if(!a.started){if(g===a.from)return;a.started=!0,a.start=e._now,a.to=g,ue(a),ve(a)}a.started&&g!==a.to&&(a.start=e._now,a.from=a.current,a.to=g,a.time=0,a.total=0,a.count=0,ue(a),ve(a))}if(a.started&&!a.stopped){var h=e._now,i=h-a.start;if(i>=a.delay){a.total=i,i-=a.delay,a.time=i>a.dur?a.dur:i,a.type==="group_set"&&(a.groupTime=h-a.groupStart,a.groupStart===a.start&&(a.groupTime-=a.delay),a.groupTime>=a.groupDur[a.groupIndex]&&a.groupIndex++,a.groupTime>=a.groupDurTotal&&(a.groupIndex=0,a.groupTime=a.groupTime-a.groupDurTotal,a.groupStart=h));if(a.total>=a.finish){a.count++,a.type!=="group_set";if(a.count>=a.repeat)a.time=a.dur,a.stopped=!0,a.trigger&&(a.from=a.to,a.to=null,a.start=null,a.time=0,a.total=0,a.count=0,a.started=!1,a.stopped=!1),a.onDone&&a.onDone.call(c,d,e);else if(f){a.time=0,a.start=h,a.total=0;if(a.reverse){var j=a.from;a.from=a.to,a.to=j,ve(a)}}}}e&&!e._invalidate&&(e._invalidate=!0)}}function ne(a){if(!xe[a.id]){ze=!0,xe[a.id]=a;if(a.from==null&&a.attr&&a.source){var b;(b=a.attr.match(/^S[:@](.*)/i))?a.from=a.source.getStyle(b[1]):(b=a.attr.match(/^C[:@](.*)/i))?a.from=a.source.getClient(b[1]):a.from=c.Util.getValue(a.source,a.attr)}ue(a),ve(a)}return a.resume(),a}function oe(a,b){return xe[a.id]&&(b==null&&(b=!0),b&&te(a,a.to),a.onStop&&a.onStop(),a.time=0,a.total=0,a.start=null,a.count=0,a.started=!1,a.stopped=!1,a.paused=!1,a.pausedTime=null,a.pausedTotal=0,a._oldSpeed=null,a._speedTotal=0,a._speedTime=null,a._percent=0,a._percentSet=null,a._percentDiff=0,delete xe[a.id]),a}function pe(a){a==null&&(a=!0),Object.keys(xe).forEach(function(b){var c=xe[b];if(!c)return;a&&te(c,c.to),c.onStop&&c.onStop()}),xe={}}function qe(){Object.keys(xe).forEach(function(a){var b=xe[a];if(!b)return;b.pause()})}function re(){Object.keys(xe).forEach(function(a){var b=xe[a];if(!b)return;b.resume()})}function se(a){Object.keys(xe).forEach(function(b){var c=xe[b];if(!c)return;c.start==null&&(c._speedTime=c.start=a),c._percentSet!=null&&(c._percentDiff+=(c._percentSet-c._percent)*c.finish);if(c.paused){c.pausedTime||(c.pausedTime=a);if(c._percentSet==null)return}c._percentSet==null&&c.pausedTime&&(c.pausedTotal+=(a-c.pausedTime)*(c._oldSpeed||c._speed),c.pausedTime=null),c._oldSpeed&&!c.pausedTime&&(c._speedTotal=(a-c._speedTime)*c._oldSpeed-c.pausedTotal+c._percentDiff+c._speedTotal,c._percentDiff=0,c.pausedTotal=0,c._speedTime=a,c._oldSpeed=null),c.total=(a-c._speedTime)*c._speed-c.pausedTotal+c._percentDiff+c._speedTotal,c._percentSet!=null&&c.pausedTime&&(c.total-=(a-c.pausedTime)*(c._oldSpeed||c._speed)),c._percent=c.total>=c.finish?1:c.total/c.finish;if(c.total>c.delay){c.time=c.total-c.delay;var d=!1;c.time>=c.dur&&(c.time=c.dur,d=!0),!c.stopped&&te(c,we(c)),c.stopped=d;if(c.total>=c.finish){c.count++;if(c.count>=c.repeat)oe(c,!1),c.onDone&&c.onDone();else{c.time=0,c.total=0,c.start=null,c.stopped=!1;if(c.reverse){var e=c.from;c.from=c.to,c.to=e,ve(c)}}}}c.paused||!ze&&(ze=!0),c._percentSet!=null&&(c._percentSet=null)})}function te(a,b){a.started||(a.started=!0,a.onPlay&&a.onPlay()),a.filter&&(b=a.filter(b));if(a.attr&&a.source){var d;(d=a.attr.match(/^S[:@](.*)/i))?a.source.setStyle(d[1],b):(d=a.attr.match(/^C[:@](.*)/i))?a.source.setClient(d[1],b):c.Util.setValue(a.source,a.attr,b)}a.onUpdate&&a.onUpdate(b)}function ue(a){var b=a.type,c=a.from,d=a.to;b==="number"?(a.from=c||0,a.to=d||0):b==="point"?(c?c.length&&(a.from={x:c[0],y:c[1]}):a.from=a.attr==="scale"?{x:1,y:1}:{x:0,y:0},d?d.length&&(a.to={x:d[0],y:d[1]}):a.to=a.attr==="scale"?{x:1,y:1}:{x:0,y:0}):b==="rect"?(c?c.length&&(a.from={x:c[0],y:c[1],w:c[2],h:c[3]}):a.from={x:0,y:0,w:0,h:0},d?d.length&&(a.to={x:d[0],y:d[1],w:d[2],h:d[3]}):a.to={x:0,y:0,w:0,h:0}):b==="color"?(a.from=He(c),a.to=He(d)):b!=="set"&&b!=="group_set",a.current=a.from}function ve(a){var b=a.type,c=a.from,d=a.to;b==="number"?a.delta=d-c:b==="point"?a.delta={x:d.x-c.x,y:d.y-c.y}:b==="rect"?a.delta={x:d.x-c.x,y:d.y-c.y,w:d.w-c.w,h:d.h-c.h}:b==="color"?a.delta={r:d.r-c.r,g:d.g-c.g,b:d.b-c.b,a:d.a-c.a}:b!=="set"&&b!=="group_set"}function we(a,b){var c=a.type,d=a.delta,e=a.from,f=a.time,g=a.dur,h=Ae[a.easing||"easeNone"];return h||(h=Ae.easeNone),c==="number"?b=h(f,e,d,g):c==="point"?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g)}:c==="rect"?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g),w:h(f,e.w,d.w,g),h:h(f,e.h,d.h,g)}:c==="color"?b="rgba("+Math.floor(h(f,e.r,d.r,g))+","+Math.floor(h(f,e.g,d.g,g))+","+Math.floor(h(f,e.b,d.b,g))+","+Math.floor(h(f,e.a,d.a,g))+")":c==="set"?a.time&&(b=a.to):c==="group_set"&&(b=a.to[a.groupIndex]),a.current=b,b}var c={};c._isInitializing=!1;var d={isDeserializing:!1,isCalculatingBus:!1,images:{},registerImage:function(a,b,e,f,g){d.images[a]=new c.ImageAsset(a,b,e,f,g),Ne(a)},getRegisteredImageNames:function(){return Object.keys(d.images)},unregisterImage:function(a){delete d.images[a]},getImageAsset:function(a){return d.images[a]},showVersion:function(a){d.isCtrlDown(a)&&a.shiftKey&&a.keyCode==76&&alert("TWaver HTML5 "+c.Util.getVersion()+"\n"+f)},callLater:function(a,b,c,d){return setTimeout(function(){a.apply(b,c)},d||Se.CALL_LATER_DELAY)},isEmptyObject:function(a){for(var b in a)return!1;return!0},xml:function(b){if(a.DOMParser)return(new DOMParser).parseFromString(b,"text/xml");var c=new ActiveXObject("Microsoft.XmlDOM");return c.async=!1,c.loadXml(b),c},num:function(a){return typeof a=="number"&&!isNaN(a)&&isFinite(a)},getter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1),c=/ble$/.test(a)||/ed$/.test(a)?"is":"get";return c+b},setter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);return"set"+b},_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(){var a=[];for(var b=0;b<32;b++)a[b]=this._id[Math.floor(Math.random()*16)];return a[12]="4",a[16]=this._id[a[16]&3|8],a.join("")},keys:function(a){var b=new Ce;for(var c in a)b.add(c);return b},es:["toString","toLocaleString","valueOf"],ip:function(a,b){var c="_"+b;a[d.getter(b)]=function(){return this[c]},a[d.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},validateLicense:function(a){f=a,id()},ibool:function(a,b){var c="_"+b,e=b.charAt(0).toUpperCase()+b.slice(1);a["is"+e]=function(){return this[c]},a[d.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},getValue:function(a,b,c){var d=b.charAt(0).toUpperCase()+b.slice(1),e="get"+d,f="is"+d;return c?c==="boolean"?a[f]():a[e]():a[e]?a[e]():a[f]?a[f]():a[b]},setValue:function(a,b,c){a["set"+b.charAt(0).toUpperCase()+b.slice(1)](c)},clone:function(a){if(!a)return null;var b={};for(var c in a)b[c]=a[c];return b},cloneRect:function(a){return a?{x:a.x,y:a.y,width:a.width,height:a.height}:null},classCache:{},getClass:function(b){var c=d.classCache[b];if(!c){var e=b.split("."),f=e.length;c=a;for(var g=0;g<f;g++)c=c[e[g]];d.classCache[b]=c}return c},newInstance:function(a){var b=d.getClass(a);if(!b)return null;var c=arguments.length,e=arguments;if(c===1)return new b;if(c===2)return new b(e[1]);if(c===3)return new b(e[1],e[2]);if(c===4)return new b(e[1],e[2],e[3]);if(c===5)return new b(e[1],e[2],e[3],e[4]);if(c===6)return new b(e[1],e[2],e[3],e[4],e[5]);if(c===7)return new b(e[1],e[2],e[3],e[4],e[5],e[6]);if(c===8)return new b(e[1],e[2],e[3],e[4],e[5],e[6],e[7]);throw"don't support args more than 7"},addMethod:function(a,b){var c=a.prototype;for(var d in b)c[d]=b[d]},ext:function(a,b,c){var e;typeof a=="string"&&(e=a,a=d.getClass(a));if(b){var f=function(){};f.prototype=b.prototype,a.prototype=new f,a.prototype.constructor=a,a.superClass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}e&&(a.prototype.getClassName=function(){return e});if(c){var g=a.prototype;for(var h in c)n.ext(h,g,c);var i=d.es.length;for(var j=0;j<i;j++)h=d.es[j],c.hasOwnProperty(h)&&!c.propertyIsEnumerable(h)&&(g[h]=c[h])}},setViewBounds:function(a,b){if(!a)return;if(a.adjustBounds)a.adjustBounds(b);else{var c=a.style;!c&&a.getView()&&(c=a.getView().style),c&&(c.position="absolute",c.left=b.x+"px",c.top=b.y+"px",c.width=b.width+"px",c.height=b.height+"px")}},getImageSrc:function(a){var b=d.getImageAsset(a);return b?b.getSrc()?b.getSrc():b.getImage().getAttribute("src"):a},nextColorCount:0,nextColor:function(){return d.nextColorCount>=Se.COLORS.length&&(d.nextColorCount=0),Se.COLORS[d.nextColorCount++]},isCtrlDown:function(a){return a.ctrlKey||a.metaKey},isShiftDown:function(a){return a.shiftKey},isAltDown:function(a){return a.altKey},setText:function(a,b,c){c?m.isFirefox?a.textContent=b:a.innerText=b:a.innerHTML=b},fillDescendant:function(a,b){b.add(a),a.hasChildren()&&a.getChildren().forEach(function(a){d.fillDescendant(a,b)})}},e=Date,f="l=1.0\ntype=1\ngis=1\n3d=0\nstart=2015-06-18\nend=2015-09-30\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=6782f69cf67f9512e92ab90e828962165c6dad65d60972ac1020dbafed642e10edaece0eea6c016fa746933655907710efaf579dd155d7974d636d916c1ee10bdd59ac9236d34e705903cb6cab88db194db82d5c740a30a7df6de85d4ef7cf9b10c2ecc09656aa0c2ce12892b77c4d8c66bcc5f24859602866be924b45aa9f660223a1b42556f9451832f1448884666ef1567143ecc43ef2561f238b0104a12cd4e224d333cd42c9f92c1d0366160c2d5ec1cee50565a4563c89d2aae25d3ab1260bf7d82afe2bf80bab3ce76548469da4c941dc9ab87a60fa5cb0ea9536d8e5e3654001c0956ed4fe5c292c7477cafd2dc3ec8586417e92ca4900f0933ff54d4d02e2858991a9caea661ce53d1bf641340f3d5b99e78b34f7656f7fdc4ad45b4cd2acca092b12106df513ba499ac80836d9a306dd2df7f586b505a371d984a672d158993c3a1c8b589187e3660f2c43f67eb703f962136773a579086792d59a73bd82472048d5af80261c9bc6e4339d5a4e5d474239f00e2d3d5b600350d6214a2fcc79eefa3c6127d8a15a0b14834e808db8673fa7e8c61086675fb2e8a3463e646a994a444d44aa059b3b04ae172992c03ca204f07f663820cea77fe1c0c231a8681a03aacb98ca917676e1c3c946fc6f7e215e5154f89c21ba8da703ec741016421813aadb24e450cc70db5895e1544c36712e5ac9a6140cb4d1666092d5698c37c5f9e9aec46288d9ef43be5e3932712dc9f9ae4b2f4f833cac11c2df6879702cedabb92592a6009721b10c3df59f22fc00fdcde58654353103a8c35c0c1a9e2a4aaccb16bd546760bd880fd0c90c66b543e9c6e8d491fd38c3853733e8c39b39961f713e320e56022fa936dcb36b02c7d41d348d777eb0fa1c68d581fb";a.twaver=c,a._twaver=d,c.animate={},c.network={},c.network.interaction={},c.controls={},c.charts={},c.layout={};var g,h,j=a.navigator,k=a.document,l=a.Image;a.document||(h=!0,g=require("canvas"),l=g.Image,j={userAgent:""},k={});var m=function(){var a={},b=j.userAgent.toLowerCase();return a.isOpera=/opera/.test(b),a.isIE=/msie/.test(b)||/trident/.test(b),a.isFirefox=/firefox/i.test(b),a.isChrome=/chrome/i.test(b),a.isSafari=!a.isChrome&&/safari/i.test(b),a.isIPhone=/iphone/.test(b),a.isIPod=/ipod/.test(b),a.isIPad=/ipad/.test(b),a.isAndroid=/android/i.test(b),a.isWebOS=/webos/i.test(b),a.isMSToucheable=j.msMaxTouchPoints&&j.msMaxTouchPoints>1,a.isTouchable="ontouchend"in k||a.isMSToucheable,a}();d.ua=m;var n={__accessor:function(a,b){var c=b.__accessor,e=c.length;for(var f=0;f<e;f++)d.ip(a,c[f])},__bool:function(a,b){var c=b.__bool,e=c.length;for(var f=0;f<e;f++)d.ibool(a,c[f])},__client:function(a,b){a.getClient=function(a){return this._clientMap[a]},a.setClient=function(a,b){var c=this._clientMap[a];return b==null?delete this._clientMap[a]:this._clientMap[a]=b,this.firePropertyChange("C:"+a,c,b)&&this.onClientChanged(a,c,b),this},a.getClientProperties=function(){return d.keys(this._clientMap)},a.onClientChanged=function(a,b,c){}},__style:function(a,e){a.getStyle=function(a,d){var e=this._styleMap[a];return d===b&&(d=!0),e==null&&d?c.Styles.getStyle(a):e},a.setStyle=function(a,b){var c=this._styleMap[a];return b==null?delete this._styleMap[a]:this._styleMap[a]=b,this.firePropertyChange("S:"+a,c,b)&&this.onStyleChanged(a,c,b),this},a.getStyleProperties=function(){return d.keys(this._styleMap)},a.onStyleChanged=function(a,b,c){}},__new:function(a,b){a.newInstance=function(){var a=d.getClass(this.getClassName());if(!a)return null;var b=arguments.length,c=arguments;if(b===0)return new a;if(b===1)return new a(c[0]);if(b===2)return new a(c[0],c[1]);if(b===3)return new a(c[0],c[1],c[2]);if(
b===4)return new a(c[0],c[1],c[2],c[3]);if(b===5)return new a(c[0],c[1],c[2],c[3],c[4]);if(b===6)return new a(c[0],c[1],c[2],c[3],c[4],c[5]);if(b===7)return new a(c[0],c[1],c[2],c[3],c[4],c[5],c[6]);throw"don't support args more than 7"}},__property:function(a,b){a.getValue=function(a,b){return this._propertyType==="accessor"?d.getValue(a,this._propertyName):this._propertyType==="style"&&a.getStyle?a.getStyle(this._propertyName):this._propertyType==="client"&&a.getClient?a.getClient(this._propertyName):this._propertyType==="field"?a[this._propertyName]:null},a.setValue=function(a,b,c){if(this._propertyType==="accessor")a[d.setter(this._propertyName)](b);else{if(this._propertyType==="style"&&a.setStyle)return a.setStyle(this._propertyName,b);if(this._propertyType==="client"&&a.setClient)return a.setClient(this._propertyName,b);this._propertyType==="field"&&(a[this._propertyName]=b)}}},map:{__accessor:1,__bool:1,__client:1,__style:1,__new:1,__tree:1,__property:1},ext:function(a,b,c){n.map[a]===1?n[a](b,c):b[a]=c[a]}};d.extend=n;var o=function(a,b,c,d,e,f){this.setMatrix(a,b,c,d,e,f)};o.identity=function(){return new o(1,0,0,1,0,0)},o.prototype.setMatrix=function(a,b,c,d,e,f){this._m11=a,this._m12=b,this._m21=c,this._m22=d,this._offsetX=e,this._offsetY=f,this._type=4;if(this._m21!=0||this._m12!=0)this._type=4;else{if(this._m11!=1||this._m22!=1)this._type=2;if(this._offsetX!=0||this._offsetY!=0)this._type|=1;(this._type&(2|1))==0&&(this._type=0)}},o.prototype.transform=function(){var a;arguments.length===2?a={x:arguments[0],y:arguments[1]}:a=arguments[0];if(!a||!d.num(a.x)||!d.num(a.y))throw"arguments should contain x, y";switch(this._type){case 0:return{x:a.x,y:a.y};case 1:return{x:this._offsetX+a.x,y:this._offsetY+a.y};case 2:return{x:a.x*this._m11,y:a.y*this._m22};case 3:return{x:a.x*this._m11+this._offsetX,y:a.y*this._m22+this._offsetY}}return{x:this._m11*a.x+a.y*this._m21+this._offsetX,y:this._m22*a.y+a.x*this._m12+this._offsetY}},o.prototype.translate=function(a,b){this.multiply(new o(1,0,0,1,a,b))},o.prototype.scale=function(a,b){this.multiply(new o(a,0,0,b,0,0))},o.prototype.rotate=function(a,b,c){a=a*Math.PI/180;var d=Math.sin(a),e=Math.cos(a),f=b*(1-e)+c*d,g=c*(1-e)-b*d;this.multiply(new o(e,d,-d,e,f,g))},o.prototype.skew=function(a,b){this.multiply(new o(1,Math.tan(b*Math.PI/180),Math.tan(a*Math.PI/180),1,0,0))},o.prototype.multiply=function(a){var b=this,c=a,d=b._type,e=c._type;if(e!=0)if(d==0)b.setMatrix(c._m11,c._m12,c._m21,c._m22,c._offsetX,c._offsetY);else if(e==1)b._offsetX+=c._offsetX,b._offsetY+=c._offsetY,d!=4&&(b._type|=1);else if(d==1){var f=b._offsetX,g=b._offsetY;b.setMatrix(c._m11,c._m12,c._m21,c._m22,c._offsetX,c._offsetY),b._offsetX=f*c._m11+g*c._m21+c._offsetX,b._offsetY=f*c._m12+g*c._m22+c._offsetY,e==4?b._type=4:b._type=3}else switch(d<<4|e){case 34:b._m11*=c._m11,b._m22*=c._m22;return;case 35:b._m11*=c._m11,b._m22*=c._m22,b._offsetX=c._offsetX,b._offsetY=c._offsetY,b._type=3;return;case 36:case 52:case 66:case 67:case 68:b.setMatrix(b._m11*c._m11+b._m12*c._m21,b._m11*c._m12+b._m12*c._m22,b._m21*c._m11+b._m22*c._m21,b._m21*c._m12+b._m22*c._m22,b._offsetX*c._m11+b._offsetY*c._m21+c._offsetX,b._offsetX*c._m12+b._offsetY*c._m22+c._offsetY);return;case 50:b._m11*=c._m11,b._m22*=c._m22,b._offsetX*=c._m11,b._offsetY*=c._m22;return;case 51:b._m11*=c._m11,b._m22*=c._m22,b._offsetX=c._m11*b._offsetX+c._offsetX,b._offsetY=c._m22*b._offsetY+c._offsetY;return}};var p={getDistance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},getCenterPoint:function(a,b){if(a&&b)return{x:(a.x+b.x)/2,y:(a.y+b.y)/2};if(b==null&&a.width)return{x:a.x+a.width/2,y:a.y+a.height/2}},isPointInPolygon:function(a,b){a=a._as;var c=0,d=0,e=!1,f=a.length;for(c=0,d=f-1;c<f;d=c++){var g=a[c],h=a[d];g.y>b.y!=h.y>b.y&&b.x<(h.x-g.x)*(b.y-g.y)/(h.y-g.y)+g.x&&(e=!e)}return e},unionRect:function(a,b){if(a&&!b)return d.cloneRect(a);if(!a&&b)return d.cloneRect(b);if(a&&b){var c={};return c.x=Math.min(a.x,b.x),c.y=Math.min(a.y,b.y),c.width=Math.max(a.x+a.width,b.x+b.width)-c.x,c.height=Math.max(a.y+a.height,b.y+b.height)-c.y,c}return null},intersects:function(a,b){if(!a||!b)return!1;var c=b.width,d=b.height,e=a.width,f=a.height;if(e<=0||f<=0||c<=0||d<=0)return!1;var g=b.x,h=b.y,i=a.x,j=a.y;return e+=i,f+=j,c+=g,d+=h,(e<i||e>g)&&(f<j||f>h)&&(c<g||c>i)&&(d<h||d>j)},intersection:function(a,b){if(!a||!b)return!1;var c=b.x,d=b.y,e=a.x,f=a.y,g=c;g+=b.width;var h=d;h+=b.height;var i=e;i+=a.width;var j=f;return j+=a.height,c<e&&(c=e),d<f&&(d=f),g>i&&(g=i),h>j&&(h=j),g-=c,h-=d,g===0||h===0?null:{x:c,y:d,width:g,height:h}},contains:function(a,b){var c=b.x,d=b.y,e=b.width,f=b.height,g=a.width,h=a.height;if((g|h|e|f)<0)return!1;var i=a.x,j=a.y;if(c<i||d<j)return!1;g+=i,e+=c;if(e<=c){if(g>=i||e>g)return!1}else if(g>=i&&e>g)return!1;h+=j,f+=d;if(f<=d){if(h>=j||f>h)return!1}else if(h>=j&&f>h)return!1;return!0},getLinePoints:function(a){if(!a)return null;var b=new Ce;return a.forEach(function(a){b.addAll(a)}),b},getLineRect:function(a){var b=p.getLinePoints(a);return p.getRect(b)},getRect:function(a,b){if(!a)return null;a._as&&(a=a._as);var c=a.length;if(c<=0)return null;var d=a[0];b=b||{x:null,y:null,width:0,height:0};for(var e=0;e<c;e++){d=a[e];if(d instanceof Ce)p.getRect(d,b);else{b.x==null&&(b.x=d.x,b.y=d.y);var f=Math.min(b.x,d.x),g=Math.min(b.y,d.y),h=Math.max(b.x+b.width,d.x),i=Math.max(b.y+b.height,d.y);b.x=f,b.y=g,b.width=h-f,b.height=i-g}}return b},addPadding:function(a,b,c,d){d=d||-1;var e=b.getStyle(c)*d;e!=0&&p.grow(a,e,e),e=b.getStyle(c+".left")*d,e!=0&&(a.x-=e,a.width+=e),e=b.getStyle(c+".right")*d,e!=0&&(a.width+=e),e=b.getStyle(c+".top")*d,e!=0&&(a.y-=e,a.height+=e),e=b.getStyle(c+".bottom")*d,e!=0&&(a.height+=e),a.width<0&&(a.width=-a.width,a.x-=a.width),a.height<0&&(a.height=-a.height,a.y-=a.height)},grow:function(a,b,c){if(a==null)return null;c==null&&(c=b);var d=a.width+b+b;if(d<0)return;var e=a.height+c+c;if(e<0)return;return a.x-=b,a.y-=c,a.width=d,a.height=e,a},containsPoint:function(a,b,c){return arguments.length<3&&(c=b.y,b=b.x),!a||b<a.x||c<a.y||b>a.x+a.width||c>a.y+a.height?!1:!0},getHotSpot:function(a,b,c,d,e){if(e==="oval"){var f=.35;return{x:a+c*.5+c*f,y:b+d/2-Math.sqrt(.25-f*f)*d}}if(e==="circle"){var g=a+c/2,h=b+d/2,i=Math.min(c,d)/2;a=g-i,b=h-i,c=i*2,d=i*2;var j=c/2,k=d/2,l=j*k/Math.sqrt(j*j+k*k);return{x:a+c/2+l,y:b+d/2-l}}var m={x:a+c,y:b};return c>3&&(m.x-=3),d>3&&(m.y+=3),m},getCircleRect:function(a){var b=Math.min(a.width,a.height)/2;return{x:a.x+a.width/2-b,y:a.y+a.height/2-b,width:b*2,height:b*2}},getEllipsePoint:function(a,b){if(!a||!b)return null;var c=a.x+a.width/2,d=a.y+a.height/2,e=b.x-c,f=b.y-d,g=a.width/2,h=a.height/2,i=Math.sqrt(1/(1/g/g+f*f/e/e/h/h));e<0&&(i=-i);var j;return e==0?f>0?j=h:j=-h:j=i*f/e,{x:c+i,y:d+j}},createMatrix:function(a,b,c){var d=Math.sin(a),e=Math.cos(a),f=b*(1-e)+c*d,g=c*(1-e)-b*d;return new o(e,d,-d,e,f,g)},calculatePointInfoAlongLineBySegments:function(a,b,c,d,e){return p.calculatePointInfoAlongLine(p.getPointObject(a,b),c,d,e)},calculatePointInfoAlongLine:function(a,c,d,e){c=c===b?!0:c,d=d||0,e=e||0;if(!a||a.size()<2)throw"must more than two points";if(!c){var f=p.reversePath(a);return p.calculatePointInfoAlongLine(f,!0,d,e)}a._as&&(a=a._as);var g,h,i=0,j=0,k,l,m=a.length,n;for(l=0;l<m;l++){n=a[l];if(l==0){h=n;continue}if(d<=0){k=p.calculatePointInfoOnStraightLine(p._getPoint(h),p._getControlPoint(n),d,e),g=k;break}j=p._getLength(n,h);if(i+j>d){k=p.getPathInfo(n,h,d-i,e,j),g=k;break}i+=j,h=n}if(g==null){var o,q;h=a[m-1],q=p._getPoint(h),h instanceof Ce&&(h=h._as),o=h instanceof Array?p._getControlPoint(h):p._getPoint(a[m-2]);var r=Math.atan2(q.y-o.y,q.x-o.x);k=p.transformPoint(q,r,d-i,e),k.angle=r,g=k}return g},reversePath:function(a){var b=new Ce,c=null,d;a._as&&(a=a._as);for(var e=a.length-1;e>=0;e--)d=a[e],b.add(p._getReversePath(d,c)),c=d;return b},_getPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-1]:a},_getControlPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-2]:a},_getReversePath:function(a,b){var c=p._getPoint(a);return b&&b._as&&(b=b._as),b!=null&&b instanceof Array?b.length==2?new Ce([b[0],c]):new Ce([b[1],b[0],c]):c},_getLength:function(a,b){var c=p._getPoint(b),d=p._getPoint(a);a instanceof Ce&&(a=a._as);if(a instanceof Array)return p.calculateCurveLength(c,a,1);var e=d.y-c.y,f=d.x-c.x;return Math.sqrt(f*f+e*e)},getPathInfo:function(a,b,c,d,e){var f=p._getPoint(b),g=p._getPoint(a),h;a instanceof Ce&&(a=a._as);if(a instanceof Array){e<0&&(e=p._getLength(a,b));var i=c/e,j=p.calculatePointInfoOnCurveLine(f,a,i);f=j.point,h=j.angle,c=0}else h=Math.atan2(g.y-f.y,g.x-f.x);return p.transformPoint(f,h,c,d)},transformPoint:function(a,b,c,d){var e={x:c,y:d},f=p.createMatrix(b,0,0);return e=f.transform(e),e.x+=a.x,e.y+=a.y,{point:e,angle:b}},calculatePointInfoOnStraightLine:function(a,b,c,d){var e=Math.atan2(b.y-a.y,b.x-a.x);return p.transformPoint(a,e,c,d)},calculatePointInfoOnCurveLine:function(a,b,c){if(c<0||c>1)throw"Illegal arguments";return b._as&&(b=b._as),b.length==2?p._calculatePointInfoOnCurveLine2(a,b[0],b[1],c):p._calculatePointInfoOnCurveLine3(a,b[0],b[1],b[2],c)},_calculatePointInfoOnCurveLine2:function(a,b,c,d){var e=2*(a.x+c.x-2*b.x)*d+2*b.x-2*a.x,f=2*(a.y+c.y-2*b.y)*d+2*b.y-2*a.y,g=Math.atan2(f,e),h=(a.x+c.x-2*b.x)*d*d+(2*b.x-2*a.x)*d+a.x,i=(a.y+c.y-2*b.y)*d*d+(2*b.y-2*a.y)*d+a.y;return{point:{x:h,y:i},angle:g}},_calculatePointInfoOnCurveLine3:function(a,b,c,d,e){var f,g,h;f=1-e,g=f*f*f,h=e*e*e;var i=g*a.x+3*e*f*f*b.x+3*e*e*f*c.x+h*d.x,j=g*a.y+3*e*f*f*b.y+3*e*e*f*c.y+h*d.y;return{point:{x:i,y:j},angle:Math.atan2(p._bezeSpeedY(a,b,c,d,e),p._bezeSpeedX(a,b,c,d,e))}},calculateCurveLength:function(a,b,c){return b._as&&(b=b._as),b.length==2?p._calculateCurveLength(a,b[0],b[1],c):p._calculateBezierCurveLength(a,b[0],b[1],b[2],c)},_calculateCurveLength:function(a,b,c,d){if(d<=0||d>1)return 0;var e=Math.floor(d*(Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))+Math.sqrt((c.x-b.x)*(c.x-b.x)+(c.y-b.y)*(c.y-b.y)))/2),f=0;e<=0&&(e=1);var g=d/e,h,i,j=0;for(var k=0;k<e;k++)j=g*k,h=2*(a.x+c.x-2*b.x)*j+2*b.x-2*a.x,i=2*(a.y+c.y-2*b.y)*j+2*b.y-2*a.y,h*=g,i*=g,f+=Math.sqrt(h*h+i*i);return f},_calculateBezierCurveLength:function(a,b,c,d,e){if(e<=0||e>1)return 0;var f=1e4,g=Math.floor(f*e);(g&1)==1&&g++;if(g==0)return 0;var h=Math.floor(g/2),i=0,j=0,k=e/g,l;for(l=0;l<h;l++)i+=p._bezeSpeed(a,b,c,d,(2*l+1)*k);for(l=1;l<h;l++)j+=p._bezeSpeed(a,b,c,d,2*l*k);return(p._bezeSpeed(a,b,c,d,0)+p._bezeSpeed(a,b,c,d,1)+2*j+4*i)*k/3},_bezeSpeedX:function(a,b,c,d,e){var f=1-e;return-3*a.x*f*f+3*b.x*f*f-6*b.x*f*e+6*c.x*f*e-3*c.x*e*e+3*d.x*e*e},_bezeSpeedY:function(a,b,c,d,e){var f=1-e;return-3*a.y*f*f+3*b.y*f*f-6*b.y*f*e+6*c.y*f*e-3*c.y*e*e+3*d.y*e*e},_bezeSpeed:function(a,b,c,d,e){var f=p._bezeSpeedX(a,b,c,d,e),g=p._bezeSpeedY(a,b,c,d,e);return Math.sqrt(f*f+g*g)},getPointObject:function(a,b){if(!b||b.size()==0)return a;var c=new Ce;b=b._as,a=a._as;var d=0,e,f,g=b.length,h=a.length;for(e=0;e<g;e++){f=b[e];if(d==h)break;"cubicto"===f?d<h-2&&c.add([a[d++],a[d++],a[d++]]):"quadto"===f?d<h-1&&c.add([a[d++],a[d++]]):d<h&&c.add(a[d++])}for(;d<h;d++)c.add(a[d]);return c},calculateLineLength:function(a,b){if(!a||a.size()<2)return 0;if(b)return p.calculateLineLength(p.getPointObject(a,b));a=a._as;var c,d=a.length,e,f,g,h,i,j,k=0;for(c=0;c<d;c++){g=a[c];if(c==0){e=g;continue}f=g,f instanceof Ce&&(f=f._as),f instanceof Array?(h=p.calculateCurveLength(e,f,1),e=f[f.length-1]):(j=g.y-e.y,i=g.x-e.x,h=Math.sqrt(i*i+j*j),e=f),k+=h}return k},toDegrees:function(a){return a*180/Math.PI},toRadians:function(a){return a/180*Math.PI},getRadiansBetweenLines:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},getAngle:function(a,b){return a.x===b.x?b.y===a.y?0:b.y>a.y?Math.PI/2:-Math.PI/2:Math.atan((b.y-a.y)/(b.x-a.x))}};d.math=p;var q={getPoints:function(a){var b=new Ce;return a.forEach(function(a){b.add({x:a.x,y:a.y}),b.add({x:a.x+a.width,y:a.y+a.height}),b.add({x:a.x+a.width,y:a.y}),b.add({x:a.x,y:a.y+a.height})}),b},rectangle:function(a){var b;return a.forEach(function(a){b=p.unionRect(b,a)}),b},oval:function(a){var b=q.rectangle(a),c=0,d=b.height/b.width,e=d*d,f=b.x+b.width/2,g=b.y+b.height/2,h=q.getPoints(a);h.forEach(function(a){var b=a.x-f,d=a.y-g,h=b*b+d*d/e;h>c&&(c=h)}),c=Math.sqrt(c);var i=d*c;return{x:f-c,y:g-i,width:c*2,height:i*2}},circle:function(a){var b=q.rectangle(a),c=0,d=b.x+b.width/2,e=b.y+b.height/2,f=q.getPoints(a);return f.forEach(function(a){var b=a.x-d,f=a.y-e,g=b*b+f*f;g>c&&(c=g)}),c=Math.sqrt(c),{x:d-c,y:e-c,width:c*2,height:c*2}},roundrect:function(a){var b=q.rectangle(a),c=Math.min(b.width,b.height)/16;return p.grow(b,c,c),b},star:function(a){var b=q.rectangle(a);return p.grow(b,b.width,b.height),b},triangle:function(a){var b=q.rectangle(a);return b.x-=b.width/2,b.width*=2,b.y-=b.height,b.height*=2,b},hexagon:function(a){var b=q.rectangle(a);return b.x-=b.width/2,b.width*=2,b},pentagon:function(a){var b=q.rectangle(a);return b.x-=b.width/6,b.width+=b.width/3,b.y-=b.height/4,b.height+=b.height/4,b},diamond:function(a){var b=q.rectangle(a);return b.x-=b.width/2,b.width+=b.width,b.y-=b.height/2,b.height+=b.height,b}};d.group=q;var r={"topleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y-b.height}},"topleft.topright":function(a,b){return{x:a.x,y:a.y-b.height}},"top.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y-b.height}},"topright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y-b.height}},"topright.topright":function(a,b){return{x:a.x+a.width,y:a.y-b.height}},topleft:function(a,b){return{x:a.x-b.width/2,y:a.y-b.height/2}},top:function(a,b){return{x:a.x-b.width/2+a.width/2,y:a.y-b.height/2}},topright:function(a,b){return{x:a.x-b.width/2+a.width,y:a.y-b.height/2}},"topleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y}},"topleft.bottomright":function(a,b){return{x:a.x,y:a.y}},"top.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y}},"topright.bottomleft":function(a,b){return{x:a.x-b.width+a.width,y:a.y}},"topright.bottomright":function(a,b){return{x:a.x+a.width,y:a.y}},"left.left":function(a,b){return{x:a.x-b.width,y:a.y+a.height/2-b.height/2}},left:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height/2-b.height/2}},"left.right":function(a,b){return{x:a.x,y:a.y+a.height/2-b.height/2}},center:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height/2-b.height/2}},"right.left":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height/2-b.height/2}},right:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height/2-b.height/2}},"right.right":function(a,b){return{x:a.x+a.width,y:a.y+a.height/2-b.height/2}},"bottomleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height-b.height}},"bottomleft.topright":function(a,b){return{x:a.x,y:a.y+a.height-b.height}},"bottom.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height}},"bottomright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height-b.height}},"bottomright.topright":function(a,b){return{x:a.x+a.width,y:a.y+a.height-b.height}},bottomleft:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height-b.height/2}},bottom:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height/2}},bottomright:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height-b.height/2}},"bottomleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height}},"bottomleft.bottomright":function(a,b){return{x:a.x,y:a.y+a.height}},"bottom.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height}},"bottomright.bottomleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height}},"bottomright.bottomright":function(a,b){return{x:a.x+a.width,y:a.y+a.height}},get:function(a,b,c){if(!b)throw"refRect can not be null";c||(c={width:0,height:0});var d=r[a];if(d)return d(b,c);throw"Can not resolve '"+a+"' position"}};d.position=r;var s={preventDefault:function(a){if(Se.KEEP_DEFAULT_FUNCTION(a))return;a.preventDefault?a.preventDefault():a.preventManipulation?a.preventManipulation():a.returnValue=!1},insertAfter:function(a,b){return b?b.parentNode.insertBefore(a,b.nextSibling):a.parentNode.insertBefore(a,a.parentNode.firstChild),a},forEach:function(a,b,c){if(!s.isVisible(a))return;var d=a.childNodes.length;for(var e=0;e<d;e++)s.forEach(a.childNodes[e],b,c);c?b.call(c,a):b(a)},setVisible:function(a,b){a.style.display=b?"block":"none"},isVisible:function(a){return"style"in a&&a.style.display!=="none"},release:function(a){var b=a.childNodes.length;for(var c=0;c<b;c++)s.release(a.childNodes[c]);b>0&&s.clear(a),a._pool&&a._pool.release(a)},clear:function(a){while(a.firstChild)a.removeChild(a.firstChild)},setZoom:function(a,b){var c=a.style;if(c.setProperty)if(m.isFirefox)c.setProperty("-moz-transform","scale("+b+")",null),c.setProperty("-moz-transform-origin","0 0",null);else if(m.isOpera)c.setProperty("-o-transform","scale("+b+")",null),c.setProperty("-o-transform-origin","0 0",null);else if(m.isChrome||m.isSafari){c.setProperty("-webkit-transform","scale("+b+")",null),c.setProperty("-webkit-transform-origin","0 0",null);var d=null;a._webkitInvaildateDiv?d=a._webkitInvaildateDiv:(d=k.createElement("div"),a._webkitInvaildateDiv=d),!d.parentNode||d.parentNode!=a?a.appendChild(d):a.removeChild(d)}else m.isIE?(c.setProperty("-ms-transform","scale("+b+")",null),c.setProperty("-ms-transform-origin","0 0",null)):(c.setProperty("transform","scale("+b+")",null),c.setProperty("transform-origin","0 0",null))},setCSSStyle:function(a,b,c){a.style.setProperty(b,c,null)},removeCSSStyle:function(a,b){a.style.removeProperty(b)},getCSSStyle:function(a,b){return a.style.getPropertyValue(b)},setBorderRaidus:function(a,b){m.isFirefox?a.style.MozBorderRadius=b:a.style.borderRadius=b},createSelect:function(a,b){var c=k.createElement("select"),d,e,f;if(Array.isArray(a))for(d=0;d<a.length;d++)e=a[d],f=k.createElement("option"),f.innerHTML=e,f.setAttribute("value",e),e===b&&f.setAttribute("selected","true"),c.appendChild(f);else for(d=0;d<a.values.length;d++)e=a.values[d],f=k.createElement("option"),f.innerHTML=a.map[e],f.setAttribute("value",e),e===b&&f.setAttribute("selected","true"),c.appendChild(f);return c},createImg:function(a){var b=k.createElement("img");return b.style.position="absolute",typeof a=="string"&&b.setAttribute("src",a),b},createView:function(a,b){var c=k.createElement("div");return c.style.position=Se.VIEW_POSITION,c.style.fontSize=Se.VIEW_FONT_SIZE,c.style.fontFamily=Se.VIEW_FONT_FAMILY,c.style.cursor="default",c.style.outline="none",c.style.textAlign="left",c.style.msTouchAction="none",c.tabIndex=0,b||(c.onmousedown=s.preventDefault),c.style.setProperty&&(c.style.setProperty("-khtml-user-select","none",null),c.style.setProperty("-webkit-user-select","none",null),c.style.setProperty("-moz-user-select","none",null),c.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),a&&(c.style.overflow=a),c},createDiv:function(){var a=k.createElement("div");return a.style.position="absolute",a.style.msTouchAction="none",a},createCanvas:function(a,b){a=a||0,b=b||0;if(h){var c=require("canvas");return new c(a,b)}var d=k.createElement("canvas");return d.style.position="absolute",d.style.msTouchAction="none",d.width=a,d.height=b,d},setCanvas:function(a,b,c,d,e){arguments.length===2&&(c=b.y,d=b.width,e=b.height,b=b.x),a.style.left=b+"px",a.style.top=c+"px",a.setAttribute("width",d),a.setAttribute("height",e),a._viewRect={x:b,y:c,width:d,height:e};var f=a.getContext("2d");return f.shadowBlur!==0&&(f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=0,f.shadowColor="rgba(0,0,0,0.0)"),f.clearRect(0,0,d,e),f.translate(-b,-c),f},setImg:function(a,b,c){a.setAttribute("src",b),a.style.left=c.x+"px",a.style.top=c.y+"px",a.style.width=c.width+"px",a.style.height=c.height+"px",a._viewRect=d.clone(c)},setDiv:function(a,b,c,e,f){e=d.num(e)?e:0,a.style.left=b.x-e+"px",a.style.top=b.y-e+"px",a.style.width=b.width+"px",a.style.height=b.height+"px",a._viewRect=d.clone(b),c?a.style.backgroundColor=c:a.style.backgroundColor="",e>0?a.style.border=e+"px "+f+" solid":a.style.border=""},addEventListener:function(a,b,c,d){var e="_"+a+"_";if(d[e])return;var f=function(a){f.instance[f.method](a)};f.method=b,f.instance=d,d[e]=f,c.addEventListener(a,f,!1)},removeEventListener:function(a,b,c){var d="_"+a+"_",e=c[d];e&&(b.removeEventListener(a,e,!1),delete c[d])},isValidEvent:function(a,b){if(!b)return!1;if(b.target===a)if(m.isFirefox){if(a.clientHeight<a.scrollHeight&&b.layerX<25)return!1;if(a.clientWidth<a.scrollWidth&&b.layerY<25)return!1}else if(b.offsetX>a.clientWidth||b.offsetY>a.clientHeight)return!1;return!0},getLogicalPoint:function(a,b,c,d){c=c?c:1;var e,f=a.getBoundingClientRect();if(m.isTouchable&&b.changedTouches&&b.changedTouches.length>0){var g=b.changedTouches[0],h=m.isAndroid?0:Ad.scrollLeft(),i=m.isAndroid?0:Ad.scrollTop();e={x:(g.clientX+a.scrollLeft-f.left-h)/c,y:(g.clientY+a.scrollTop-f.top-i)/c}}else{if(!s.isValidEvent(a,b))return null;e={x:(b.clientX-f.left+a.scrollLeft)/c,y:(b.clientY-f.top+a.scrollTop)/c}}return e},handle_mousedown:function(b,c){s.target&&s.handle_mouseup(c),a.addEventListener("mousemove",s.handle_mousemove,!1),a.addEventListener("mouseup",s.handle_mouseup,!1),s.target=b},handle_mousemove:function(a){s.target.handle_mousemove&&s.target.handle_mousemove(a),s.target.handleMouseMove&&s.target.handleMouseMove(a)},handle_mouseup:function(b){s.target.handle_mouseup&&s.target.handle_mouseup(b),s.target.handleMouseUp&&s.target.handleMouseUp(b),a.removeEventListener("mousemove",s.handle_mousemove,!1),a.removeEventListener("mouseup",s.handle_mouseup,!1),delete s.target},getClientPoint:function(a){return{x:a.clientX,y:a.clientY}},windowWidth:function(){return typeof a.innerWidth=="number"?a.innerWidth:k.documentElement&&k.documentElement.clientWidth?k.documentElement.clientWidth:k.body&&k.body.clientWidth?k.body.clientWidth:0},windowHeight:function(){return typeof a.innerHeight=="number"?a.innerHeight:k.documentElement&&k.documentElement.clientHeight?k.documentElement.clientHeight:k.body&&k.body.clientHeight?k.body.clientHeight:0}};d.html=s;var t={cache:{},g:s.createCanvas().getContext("2d"),getTextSize:function(a,b){t.g.font=a?a:Se.FONT;var c=t.cache[t.g.font];c||(c=t.g.measureText("e").width*2+4,t.cache[t.g.font]=c),b=b||"",b=String(b);var d=b.split("\n"),e=d.length,f=0,g;for(var h=e-1;h>=0;h--)g=t.g.measureText(d[h]).width,g>f&&(f=g);return{width:f+4,height:c*e}},drawText:function(a,c,d,e,f,g){c=c||"",c=String(c),e||(e=Se.FONT);var h="center";g&&(h=g),a.font=e,a.fillStyle=f,a.textAlign=h,a.textBaseline="middle";var i=c.split("\n"),j=i.length,k=0,l,n;d?d.width===b?(l=d.x,n=d.y):(k=d.height/j,h=="left"?l=d.x:h=="center"&&(l=d.x+d.width/2),n=d.y+k/2):(l=0,n=0),m.isOpera&&(n-=2);for(var o=0;o<j;o++)h=="right"&&(a.textAlign="left",l=d.x+d.width-t.getTextSize(e,i[o]).width),a.fillText(i[o],l,n),n+=k},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;Math.abs(e)>2*Math.PI&&(e=2*Math.PI),m=Math.ceil(Math.abs(e)/(Math.PI/4)),i=e/m,j=-i,k=-d;if(m>0){n=b+Math.cos(d)*f,o=c+Math.sin(-d)*g,h?a.lineTo(n,o):a.moveTo(n,o);for(var t=0;t<m;t++)k+=j,l=k-j/2,p=b+Math.cos(k)*f,q=c+Math.sin(k)*g,r=b+Math.cos(l)*(f/Math.cos(j/2)),s=c+Math.sin(l)*(g/Math.cos(j/2)),a.quadraticCurveTo(r,s,p,q)}},dashedLine:function(a,b,c,d,e,f,g){var h=f-d,i=g-e,j=Math.sqrt(h*h+i*i);if(j==0)return;h/=j,i/=j;var k=j,l=-c.offset,m=c.drawing,n=c.patternIndex;while(l<k)l+=b[n],l>=k&&(c.offset=b[n]-(l-k),c.patternIndex=n,c.drawing=m,l=k),m?a.lineTo(d+l*h,e+l*i):a.moveTo(d+l*h,e+l*i),m=!m,n=(n+1)%b.length},drawLinePoints:function(a,b,c,d,e){var f=0,g,h,i,j,k,l=0,m,n=b.size();c&&c.length>0?m=new vd(a,c[0],c.length>1?c[1]:c[0]):m=a;if(d)for(l=0,k=d.size();l<k;l++){g=d.get(l);if("moveto"===g&&f<n)h=b.get(f++),m.moveTo(h.x,h.y);else if("lineto"===g&&f<n)h=b.get(f++),m.lineTo(h.x,h.y);else if("cubicto"===g&&f<n-2)h=b.get(f++),i=b.get(f++),j=b.get(f++),m.bezierCurveTo(h.x,h.y,i.x,i.y,j.x,j.y);else{if(!("quadto"===g&&f<n-1))throw"Can not resolve segment '"+g+"'";h=b.get(f++),i=b.get(f++),m.quadraticCurveTo(h.x,h.y,i.x,i.y)}}else this._drawLine(b,m);e&&m.closePath()},_drawLine:function(a,b){var c=0,d,e,f,g,h,i=a.size();d=a.get(0),b.moveTo(d.x,d.y);for(c=1;c<i;c++)h=a.get(c),h.size?(g=h.size(),g===2?(d=h.get(0),e=h.get(1),b.quadraticCurveTo(d.x,d.y,e.x,e.y)):g===3&&(d=h.get(0),e=h.get(1),f=h.get(2),b.bezierCurveTo(d.x,d.y,e.x,e.y,f.x,f.y))):b.lineTo(h.x,h.y)},drawRoundRect:function(a,b,c,d,e,f,g,h,i){arguments.length===6&&(g=f,h=f,i=f);var j=b+d,k=c+e,l=d<e?d*2:e*2;f=f<l?f:l,g=g<l?g:l,h=h<l?h:l,i=i<l?i:l;var m=i*.292893218813453,n=i*.585786437626905;a.moveTo(j,k-i),a.quadraticCurveTo(j,k-n,j-m,k-m),a.quadraticCurveTo(j-n,k,j-i,k),m=h*.292893218813453,n=h*.585786437626905,a.lineTo(b+h,k),a.quadraticCurveTo(b+n,k,b+m,k-m),a.quadraticCurveTo(b,k-n,b,k-h),m=f*.292893218813453,n=f*.585786437626905,a.lineTo(b,c+f),a.quadraticCurveTo(b,c+n,b+m,c+m),a.quadraticCurveTo(b+n,c,b+f,c),m=g*.292893218813453,n=g*.585786437626905,a.lineTo(j-g,c),a.quadraticCurveTo(j-n,c,j-m,c+m),a.quadraticCurveTo(j,c+n,j,c+g),a.lineTo(j,k-i)},drawVector:function(a,b,c,d,e,f,g){arguments.length===4&&(e=d.y,f=d.width,g=d.height,d=d.x);var h=t["_"+b];h&&(a.beginPath(),c&&c.length>0&&(a=new vd(a,c[0],c.length>1?c[1]:c[0])),h(a,d,e,f,g))},_rectangle:function(a,b,c,d,e){a.rect(b,c,d,e)},_circle:function(a,b,c,d,e){var f=b+d/2,g=c+e/2,h=Math.min(d,e)/2;a instanceof vd?t.drawArc(a,f,g,0,Math.PI*2,h,h,!1):a.arc(f,g,h,0,Math.PI*2,!0)},_oval:function(a,b,c,d,e){if(a instanceof vd)t.drawArc(a,b+d/2,c+e/2,0,Math.PI*2,d/2,e/2,!1);else{var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l)}},_roundrect:function(a,b,c,d,e){t.drawRoundRect(a,b,c,d,e,Math.min(Math.min(d,e)/4,10))},_star:function(a,b,c,d,e){var f=d*2,g=e*2,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(b+d*.306,c+e*.579),a.lineTo(h-f/6,i+g/4),a.lineTo(b+d/2,c+e*.733),a.lineTo(h+f/6,i+g/4),a.lineTo(b+d*.693,c+e*.579),a.lineTo(h+f/4,i-g/12),a.lineTo(b+d*.611,c+e*.332),a.lineTo(h+0,i-g/4),a.lineTo(b+d*.388,c+e*.332),a.closePath()},_triangle:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b+d,c+e),a.lineTo(b,c+e),a.closePath()},_hexagon:function(a,b,c,d,e){a.moveTo(b,c+e/2),a.lineTo(b+d/4,c+e),a.lineTo(b+d*3/4,+c+e),a.lineTo(b+d,c+e/2),a.lineTo(b+d*3/4,c),a.lineTo(b+d/4,c),a.closePath()},_pentagon:function(a,b,c,d,e){var f=d*2,g=e*2,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(h-f/6,i+g/4),a.lineTo(h+f/6,i+g/4),a.lineTo(h+f/4,i-g/12),a.lineTo(h+0,i-g/4),a.closePath()},_diamond:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b,c+e/2),a.lineTo(b+d/2,c+e),a.lineTo(b+d,c+e/2),a.closePath()},fill:function(a,b,c,d,e,f,g,h){var i=u[c];i?arguments.length===5?a.fillStyle=i(a,b,d,e.x,e.y,e.width,e.height):a.fillStyle=i(a,b,d,e,f,g,h):a.fillStyle=b},createRadialGradient:function(a,b,c,d,e,f,g,h,i){var j=a.createRadialGradient(d+f*h,e+g*i,Math.min(f,g)/24,d+f/2,e+g/2,Math.max(f,g)/2);return j.addColorStop(0,c),j.addColorStop(1,b),j},drawPath:function(a,b,e,f,g,h,i,j){var k=a._element,l=a.getBodyRect();f&&p.addPadding(l,k,e+".padding",1);var m=d.clone(l),n=k.getStyle(e+".outline.width");n>0&&p.grow(m,n/2,n/2);var o=a.setShadow(a,b,m);k.getAngle()!=0&&(k instanceof _e||(l=k.getOriginalRect()),c.Util.rotateCanvas(o,l,k.getAngle()));var q=k.getStyle(e+".fill"),r;if(q){a._innerColor&&!wd.hasDefault(a._element)?r=a._innerColor:r=k.getStyle(e+".fill.color");var s=k.getStyle(e+".gradient");s?t.fill(o,r,s,k.getStyle(e+".gradient.color"),l):o.fillStyle=r}var u=k.getStyle(e+".shape");return q&&(o.beginPath(),h?t.drawLinePoints(o,h,null,i,j):t.drawVector(o,u,null,l),o.fill()),n>0&&(o.lineWidth=n,o.lineCap=k.getStyle(e+".cap"),o.lineJoin=k.getStyle(e+".join"),o.strokeStyle=k.getStyle(e+".outline.color"),o.beginPath(),h?t.drawLinePoints(o,h,g,i,j):t.drawVector(o,u,g,l),o.stroke()),m},draw3DRect:function(a,b,c,d,e,f,g){if(c===0)return;arguments.length<=4&&(g=d.height,f=d.width,e=d.y,d=d.x);var h=c>0;c=Math.abs(c);var i,j;a.lineWidth=1,a.lineCap="square";if(c===1)i=t.brighter(b),j=t.darker(b),a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke();else{var k=c*2,l=50/k;for(var m=0;m<k;m++)i=t.brighter(b,50-m*l),j=t.darker(b,50-m*l),d+=.5,e+=.5,f-=1,g-=1,a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke()}},brighter:function(a,b){return b||(b=50),t.adjustBrightness2(a,b)},darker:function(a,b){return b||(b=50),t.adjustBrightness2(a,-b)},adjustBrightness2:function(a,b){var c,d,e;if(b===0)return a;var f=He(a);return b<0?(b=(100+b)/100,c=Math.ceil(f.r*b),d=Math.ceil(f.g*b),e=Math.ceil(f.b*b)):(b/=100,c=f.r,d=f.g,e=f.b,c+=(255-c)*b,d+=(255-d)*b,e+=(255-e)*b,c=Math.min(Math.ceil(c),255),d=Math.min(Math.ceil(d),255),e=Math.min(Math.ceil(e),255)),"rgba("+c+","+d+","+e+",1)"},getColorArray:function(a){return Ge.clearRect(0,0,1,1),Ge.fillStyle=a,Ge.fillRect(0,0,1,1),Ge.getImageData(0,0,1,1).data},hit:function(a,b,c,d){if(!a)return!1;var e=a._viewRect;if(!e)return!1;b-=e.x,c-=e.y;if(b<0||c<0||b>=e.width||c>=e.height)return!1;try{var f=a.getContext("2d").getImageData(b,c,1,1),g=f.data;for(var h=0,i=g.length;h<i;h+=4)if(g[h+3]!==0)return!0}catch(j){return!0}return!1},intersects:function(a,b){if(!a)return!1;b=p.intersection(b,a._viewRect);if(!b)return!1;b.x-=a._viewRect.x,b.y-=a._viewRect.y;try{var c=a.getContext("2d").getImageData(b.x,b.y,b.width,b.height),d=c.data;for(var e=0,f=d.length;e<f;e+=4)if(d[e+3]!==0)return!0}catch(g){}return!1}};d.g=t;var u={"linear.southwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e+g,d+f,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.southeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.northwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.northeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.west":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.east":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,b),h.addColorStop(1,c),h},"radial.center":function(a,b,c,d,e,f,g){return t.createRadialGradient(a,b,c,d,e,f,g,.5,.5)},"radial.southwest":function(a,b,c,d,e,f,g){return t.createRadialGradient(a,b,c,d,e,f,g,.25,.75)},"radial.southeast":function(a,b,c,d,e,f,g){return t.createRadialGradient(a,b,c,d,e,f,g,.75,.75)},"radial.northwest":function(a,b,c,d,e,f,g){return t.createRadialGradient(a,b,c,d,e,f,g,.25,.25)},"radial.northeast":function(a,b,c,d,e,f,g){return t.createRadialGradient(a,b,c,d,e,f,g,.75,.25)},"radial.north":function(a,b,c,d,e,f,g){return t.createRadialGradient(a,b,c,d,e,f,g,.5,.25)},"radial.south":function(a,b,c,d,e,f,g){return t.createRadialGradient(a,b,c,d,e,f,g,.5,.75)},"radial.west":function(a,b,c,d,e,f,g){return t.createRadialGradient(a,b,c,d,e,f,g,.25,.5)},"radial.east":function(a,b,c,d,e,f,g){return t.createRadialGradient(a,b,c,d,e,f,g,.75,.5)},"spread.horizontal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.vertical":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.diagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.antidiagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,b),h.addColorStop(1/3,c),h.addColorStop(2/3,b),h.addColorStop(1,c),h},"spread.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,c),h.addColorStop(1/3,b),h.addColorStop(2/3,c),h.addColorStop(1,b),h},"spread.west":function(
a,b,c,d,e,f,g){var h=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return h.addColorStop(0,b),h.addColorStop(1/3,c),h.addColorStop(2/3,b),h.addColorStop(1,c),h},"spread.east":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return h.addColorStop(0,c),h.addColorStop(1/3,b),h.addColorStop(2/3,c),h.addColorStop(1,b),h}},w,x=0xdeadbeefcafe,y=(x&16777215)==15715070;y&&j.appName=="Microsoft Internet Explorer"?(z.prototype.am=C,w=30):y&&j.appName!="Netscape"?(z.prototype.am=B,w=26):(z.prototype.am=D,w=28),z.prototype.DB=w,z.prototype.DM=(1<<w)-1,z.prototype.DV=1<<w;var E=52;z.prototype.FV=Math.pow(2,E),z.prototype.F1=E-w,z.prototype.F2=2*w-E;var F="0123456789abcdefghijklmnopqrstuvwxyz",G=new Array,H,I;H="0".charCodeAt(0);for(I=0;I<=9;++I)G[H++]=I;H="a".charCodeAt(0);for(I=10;I<36;++I)G[H++]=I;H="A".charCodeAt(0);for(I=10;I<36;++I)G[H++]=I;db.prototype.convert=eb,db.prototype.revert=fb,db.prototype.reduce=gb,db.prototype.mulTo=hb,db.prototype.sqrTo=ib,kb.prototype.convert=lb,kb.prototype.revert=mb,kb.prototype.reduce=nb,kb.prototype.mulTo=pb,kb.prototype.sqrTo=ob,z.prototype.copyTo=L,z.prototype.fromInt=M,z.prototype.fromString=O,z.prototype.clamp=P,z.prototype.dlShiftTo=W,z.prototype.drShiftTo=X,z.prototype.lShiftTo=Y,z.prototype.rShiftTo=Z,z.prototype.subTo=$,z.prototype.multiplyTo=_,z.prototype.squareTo=ab,z.prototype.divRemTo=bb,z.prototype.invDigit=jb,z.prototype.isEven=qb,z.prototype.exp=rb,z.prototype.toString=Q,z.prototype.negate=R,z.prototype.abs=S,z.prototype.compareTo=T,z.prototype.bitLength=V,z.prototype.mod=cb,z.prototype.modPowInt=sb,z.ZERO=N(0),z.ONE=N(1),jc.prototype.convert=kc,jc.prototype.revert=kc,jc.prototype.mulTo=lc,jc.prototype.sqrTo=mc,qc.prototype.convert=rc,qc.prototype.revert=sc,qc.prototype.reduce=tc,qc.prototype.mulTo=vc,qc.prototype.sqrTo=uc;var Ac=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Bc=(1<<26)/Ac[Ac.length-1];z.prototype.chunkSize=xb,z.prototype.toRadix=zb,z.prototype.fromRadix=Ab,z.prototype.fromNumber=Bb,z.prototype.bitwiseTo=Gb,z.prototype.changeBit=Xb,z.prototype.addTo=_b,z.prototype.dMultiply=hc,z.prototype.dAddOffset=ic,z.prototype.multiplyLowerTo=oc,z.prototype.multiplyUpperTo=pc,z.prototype.modInt=yc,z.prototype.millerRabin=Dc,z.prototype.clone=tb,z.prototype.intValue=ub,z.prototype.byteValue=vb,z.prototype.shortValue=wb,z.prototype.signum=yb,z.prototype.toByteArray=Cb,z.prototype.equals=Db,z.prototype.min=Eb,z.prototype.max=Fb,z.prototype.and=Ib,z.prototype.or=Kb,z.prototype.xor=Mb,z.prototype.andNot=Ob,z.prototype.not=Pb,z.prototype.shiftLeft=Qb,z.prototype.shiftRight=Rb,z.prototype.getLowestSetBit=Tb,z.prototype.bitCount=Vb,z.prototype.testBit=Wb,z.prototype.setBit=Yb,z.prototype.clearBit=Zb,z.prototype.flipBit=$b,z.prototype.add=ac,z.prototype.subtract=bc,z.prototype.multiply=cc,z.prototype.divide=ec,z.prototype.remainder=fc,z.prototype.divideAndRemainder=gc,z.prototype.modPow=wc,z.prototype.modInverse=zc,z.prototype.pow=nc,z.prototype.gcd=xc,z.prototype.isProbablePrime=Cc,z.prototype.square=dc,Ec.prototype.init=Fc,Ec.prototype.next=Gc;var Ic=256,Jc,Kc,Lc;if(Kc==null){Kc=new Array,Lc=0;var Oc;if(j.appName=="Netscape"&&j.appVersion<"5"&&a.crypto){var Pc=a.crypto.random(32);for(Oc=0;Oc<Pc.length;++Oc)Kc[Lc++]=Pc.charCodeAt(Oc)&255}while(Lc<Ic)Oc=Math.floor(65536*Math.random()),Kc[Lc++]=Oc>>>8,Kc[Lc++]=Oc&255;Lc=0,Nc()}Sc.prototype.nextBytes=Rc;var Tc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Uc="=";_c.prototype.doPublic=bd,_c.prototype.setPublic=ad,_c.prototype.encrypt=cd,_c.prototype.doPrivate=gd,_c.prototype.setPrivate=ed,_c.prototype.setPrivateEx=fd,_c.prototype.decrypt=hd;var id=function(){jd.v(f)},jd={},kd="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",ld="10001",e="61a921483dfa8f24e26204ace4d990b965d11e5bef5d8a5e768ebc5853a6bdd94b02369a3165207460fb91001d3fd83fbe69c6e51b8e40c8ae8a4e30a7c539dca98b44858bdc0b76f25af6803d4d13dacd9fa1a28f66cf561fa36309d4239a2cf50fe20ef0e99e01fc8701090f0685a524f411e00ca91f877d3b49d2d0052f9",md="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047",nd="9360ab3d6b678727748ea004e85120f1823ec94e6116dc5fcd7b1c9ea231d38e5d7d2d23c00607912e1645835756b71290c6c3cc2bc656e93d9a4f6b0d55619f",od="3e61c2259d15b26693c8bac2eac4e0a44e1c6aa0adae2af2578aea54e796293a5fee9759293c98aab65b5d27063e43fe514e9f6b68fd581f54ab52f868bc6ad5",pd="4dac2913d9c35a6be4f63647dfd8c23006a0e89fb273c5f987e656931490861b0612aef3a48489006ef5b5f51ed6c8edb3f7cdc191609af59a4df5854a25b1a9",qd="acd9837a1472711ff2b63ba0de667fa4a4a56a8b0f4cbb0a555f73d1bc529e9ecf865b709fd8235c3db05bcf1539de1e594d3a8275fe0784a9f5241d8895b328";jd.cross=function(a){if(a){var b="";for(var c=0;c<a.length;)c+1<a.length?(b+=a[c+1],b+=a[c]):b+=a[c],c+=2;return b}return null},jd.reverse=function(a){if(a){var b="";for(var c=a.length;c>0;c--)b+=a[c-1];return b}return null},jd.v=function(a){if(a){var b=jd;b.start=null,b.beginDate=null,b.end=null,b.endDate=null,b.gis=null,b["3D"]=null,b["3d"]=null,b.l=null,b.__li__=null;if(a.indexOf("signature=")>0){var c=a.split("signature="),d=c[0],e=c[1],f=new _c;f.setPublic(kd,ld);var g=e,h=g.length,i=256,j=0,k="",l="";while(j<h)k=g.substr(j,i),l+=f.decrypt(k),j+=i;if(l===d)return b.i(a),!0}}return!1},jd.i=function(a){var c=jd;c.__li__=a;var d=a.split("\n"),e,f,g,h,i;for(e=d.length-1;e>=0;e--)f=d[e],i=f.split("="),g=i[0],h=i[1],c[g]=h;c.start!=b&&(c.beginDate=new Date(Date.parse(c.start.replace(/-/g,"/")))),c.end!=b&&(c.endDate=new Date(Date.parse(c.end.replace(/-/g,"/"))));var j=c.gis;j!=b&&(j=parseInt(j)),j&&(c._isPermissionGIS=!0);var k=c["3D"]||c["3d"];k!=b&&(k=parseInt(k)),k&&(c._isPermission3D=!0),c["3D"]&&(c._isPermission3D=!0),c.l!=b&&(c.version=c.l)};var rd=function(a){return a.__li__!==b&&!a._isPermission3D},sd=function(a){if(!rd(a))return!0;var b=new Date;return a.beginDate!=null&&a.beginDate.getTime()-b.getTime()>=0||a.endDate!=null&&a.endDate.getTime()-b.getTime()<=0},td=function(a){return a.type===2?!0:!1},ud=function(){return sd(jd)?!1:jd._isPermissionGIS};jd.$z=function(a){var b=new _c;b.setPublic(kd,ld);var c=a,d=c.length,e=256,f=0,g="",h="";while(f<d)g=c.substr(f,e),h+=b.decrypt(g),f+=e;return h},jd.twm=function(a){var c=jd,d=c.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),e=this.type,f=this.markText,g=c.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");a[g]=c.__li__;if(e==="3"&&!sd(jd)&&f===b)return;a.__liLabel==b&&(a.__liLabel=k.createElement("div")),c.startDate===b&&(c.startDate=new Date);var h=(new Date).getTime()-c.startDate.getTime();if(h<3e5)return;var i=sd(c)&&h>3e5,j=f;i?j=c.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):e!="2"||j!==b&&j!=""?e=="1"&&!f&&(j=d):j=c.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc");if(j===b)return;var l=a,m=l.__liLabel;m.innerHTML=j;if(l._rootCanvas)m.type=e,m.mark=f,m.expired=i,l._xyz=m;else{var n=0,o=0;m.style.position="absolute";var p=l.getView().style;f!=b&&f!=null&&f!=""||e=="2"?(n=10-l.getView().scrollLeft,o=10-l.getView().scrollTop):(n=p.width.replace("px","")/2-50-l.getView().scrollLeft,o=p.height.replace("px","")/2-l.getView().scrollTop),m.style.right=n+"px",m.style.bottom=o+"px",m.style.fontSize="120%",i&&(l.getView().style.opacity=.1,m.style.color="red",m.style.fontSize="150%"),l.getView().appendChild(m)}},d.validateLicense(f);var vd=function(a,b,c){this.g=a,this.onLength=b,this.offLength=c,this.isLine=!0,this.overflow=0,this.dashLength=b+c,this.pen={x:0,y:0}};d.ext(vd,Object,{_curveaccuracy:6,moveTo:function(a,b){this.pen={x:a,y:b},this.g.moveTo(a,b),this.start||(this.start={x:a,y:b})},lineTo:function(a,b){var c=a-this.pen.x,d=b-this.pen.y,e=Math.atan2(d,c),f=Math.cos(e),g=Math.sin(e),h=this.lineLength(this.pen.x,this.pen.y,a,b);if(this.overflow){if(this.overflow>h){this.isLine?this._lineTo(a,b):this.moveTo(a,b),this.overflow-=h;return}this.isLine?this._lineTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow):this.moveTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow),h-=this.overflow,this.overflow=0,this.isLine=!this.isLine;if(!h)return}var i=Math.floor(h/this.dashLength);if(i){var j=f*this.onLength,k=g*this.onLength,l=f*this.offLength,m=g*this.offLength;for(var n=0;n<i;n++)this.isLine?(this._lineTo(this.pen.x+j,this.pen.y+k),this.moveTo(this.pen.x+l,this.pen.y+m)):(this.moveTo(this.pen.x+l,this.pen.y+m),this._lineTo(this.pen.x+j,this.pen.y+k));h-=this.dashLength*i}this.isLine?h>this.onLength?(this._lineTo(this.pen.x+f*this.onLength,this.pen.y+g*this.onLength),this.moveTo(a,b),this.overflow=this.offLength-(h-this.onLength),this.isLine=!1):(this._lineTo(a,b),h==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-h,this.moveTo(a,b))):h>this.offLength?(this.moveTo(this.pen.x+f*this.offLength,this.pen.y+g*this.offLength),this._lineTo(a,b),this.overflow=this.onLength-(h-this.offLength),this.isLine=!0):(this.moveTo(a,b),h==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-h)},quadraticCurveTo:function(a,b,c,d){var e=this.pen.x,f=this.pen.y,g=this.curveLength(e,f,a,b,c,d),h=0,i=0,j;if(this.overflow){if(this.overflow>g){this.isLine?this._curveTo(a,b,c,d):this.moveTo(c,d),this.overflow-=g;return}h=this.overflow/g,j=this.curveSliceUpTo(e,f,a,b,c,d,h),this.isLine?this._curveTo(j[2],j[3],j[4],j[5]):this.moveTo(j[4],j[5]),this.overflow=0,this.isLine=!this.isLine;if(!g)return}var k=g-g*h,l=Math.floor(k/this.dashLength),m=this.onLength/g,n=this.offLength/g;if(l)for(var o=0;o<l;o++)this.isLine?(i=h+m,j=this.curveSlice(e,f,a,b,c,d,h,i),this._curveTo(j[2],j[3],j[4],j[5]),h=i,i=h+n,j=this.curveSlice(e,f,a,b,c,d,h,i),this.moveTo(j[4],j[5])):(i=h+n,j=this.curveSlice(e,f,a,b,c,d,h,i),this.moveTo(j[4],j[5]),h=i,i=h+m,j=this.curveSlice(e,f,a,b,c,d,h,i),this._curveTo(j[2],j[3],j[4],j[5])),h=i;k=g-g*h,this.isLine?k>this.onLength?(i=h+m,j=this.curveSlice(e,f,a,b,c,d,h,i),this._curveTo(j[2],j[3],j[4],j[5]),this.moveTo(c,d),this.overflow=this.offLength-(k-this.onLength),this.isLine=!1):(j=this.curveSliceFrom(e,f,a,b,c,d,h),this._curveTo(j[2],j[3],j[4],j[5]),g==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-k,this.moveTo(c,d))):k>this.offLength?(i=h+n,j=this.curveSlice(e,f,a,b,c,d,h,i),this.moveTo(j[4],j[5]),j=this.curveSliceFrom(e,f,a,b,c,d,i),this._curveTo(j[2],j[3],j[4],j[5]),this.overflow=this.onLength-(k-this.offLength),this.isLine=!0):(this.moveTo(c,d),k==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-k)},bezierCurveTo:function(a,b,c,d,e,f){this.pen={x:e,y:f};var g=[this.onLength,this.offLength];this.g.setLineDash&&this.g.setLineDash(g),this.g.lineDash=g,this.g.bezierCurveTo(a,b,c,d,e,f)},rect:function(a,b,c,d){this.pen={x:a,y:b},this.moveTo(a,b),this.lineTo(a,b+d),this.lineTo(a+c,b+d),this.lineTo(a+c,b),this.lineTo(a,b)},closePath:function(){this.lineTo(this.start.x,this.start.y)},lineLength:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},curveLength:function(a,b,c,d,e,f,g){var h=0,i=a,j=b,k,l,m,n,o,p,q,r=g>0?g:this._curveaccuracy;for(var s=1;s<=r;s++)m=s/r,n=1-m,o=n*n,p=2*m*n,q=m*m,k=o*a+p*c+q*e,l=o*b+p*d+q*f,h+=this.lineLength(i,j,k,l),i=k,j=l;return h},curveSlice:function(a,b,c,d,e,f,g,h){if(g==0)return this.curveSliceUpTo(a,b,c,d,e,f,h);if(h==1)return this.curveSliceFrom(a,b,c,d,e,f,g);var i=this.curveSliceUpTo(a,b,c,d,e,f,h);return i.push(g/h),this.curveSliceFrom.apply(this,i)},curveSliceUpTo:function(a,b,c,d,e,f,g){if(g!=1){var h=c+(e-c)*g,i=d+(f-d)*g;c=a+(c-a)*g,d=b+(d-b)*g,e=c+(h-c)*g,f=d+(i-d)*g}return[a,b,c,d,e,f]},curveSliceFrom:function(a,b,c,d,e,f,g){if(g!=1){var h=a+(c-a)*g,i=b+(d-b)*g;c+=(e-c)*g,d+=(f-d)*g,a=h+(c-h)*g,b=i+(d-i)*g}return[a,b,c,d,e,f]},_lineTo:function(a,b){if(a==this.pen.x&&b==this.pen.y)return;this.pen={x:a,y:b},this.g.lineTo(a,b)},_curveTo:function(a,b,c,d){if(a==c&&b==d&&c==this.pen.x&&d==this.pen.y)return;this.pen={x:c,y:d},this.g.quadraticCurveTo(a,b,c,d)}}),d.DashedLine=vd;var wd={DEFAULTS:{"default":1,"default.vector":1,"vector.default":1},VECTORS:{vector:1,"default.vector":1,"vector.default":1},hasDefault:function(a){if(a instanceof Ze){var b=a.getStyle("body.type");return wd.DEFAULTS[b]===1}return!0},hasVector:function(a){if(a instanceof Ze){var b=a.getStyle("body.type");return wd.VECTORS[b]===1}return!1},hasAgentLinks:function(a){var b=a.getChildrenSize();for(var c=0;c<b;c++){var d=a.getChildAt(c);if(d instanceof Ze&&wd.hasAgentLinks(d))return!0}return a.hasAgentLinks()},getParents:function(a,b,c){c||(c=!0);var d=new Ce,e=a._parent;while(e!=null&&e!==b)d.add(e,0),e=e._parent;return c&&e!=null&&e===b&&d.add(e,0),d},getSubNetwork:function(a){if(!a)return null;if(a instanceof c.Link){var b=a._fromAgent,d=a._toAgent;if(!b||!d)return null;var e=wd.getSubNetwork(b),f=wd.getSubNetwork(d);return e===f?e:null}var g=a._parent;if(!g)return null;while(g instanceof c.Link&&!(g instanceof c.SubNetwork))g=g._parent;return g instanceof c.SubNetwork?g:wd.getSubNetwork(g)},figureSameSubNetworkAgent:function(a){if(!a)return null;var b=a._parent;while(b instanceof _e){if(!(b._parent instanceof _e))return b.isExpanded()?a:b;b.isExpanded()||(a=b),b=b._parent}return a},figureSpanSubNetworkAgent:function(a,b){if(!a||!b)return null;var c=wd.getSubNetwork(a),d=wd.getSubNetwork(b);if(c!=d){while(d!=null&&c!=d)d=wd.getSubNetwork(d);if(c===d)return a;var e=new Ce;e.add(a,0);var f=a._parent;while(f instanceof Ze){if(!!b.isDescendantOf(f))break;e.add(f,0),f=f._parent}var g=e.size();for(var h=0;h<g;h++){var i=e.get(h);if(i instanceof _e&&!i.isExpanded())return i;if(i.ISubNetwork)return i}return a}return a},figureFromAgent:function(a){if(a.isLooped())return a.getFromNode();var b=wd.figureSameSubNetworkAgent(a.getFromNode()),c=wd.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getFromNode():wd.figureSpanSubNetworkAgent(b,c)},figureToAgent:function(a){if(a.isLooped())return a.getToNode();var b=wd.figureSameSubNetworkAgent(a.getFromNode()),c=wd.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getToNode():wd.figureSpanSubNetworkAgent(c,b)},getBundleLinks:function(a,b){if(!a||!b)return null;var c,d,e,f;if(a===b){f=a.getLoopedLinks();if(!f)return null;f=new Ce(f)}else{var g=a.getAgentLinks(),h=b.getAgentLinks();if(!g||!h)return null;d=g.size();for(c=0;c<d;c++)e=g.get(c),h.contains(e)&&(f||(f=new Ce),f.add(e))}if(f!=null)for(c=0;c<f.size();c++)e=f.get(c),e.getStyle("link.bundle.enable")||(e._setBundleLinks(null),f.removeAt(c),c--);return f},resetBundleLinks:function(a,b){var d=wd.getBundleLinks(a,b);if(!d||d.size()===0)return;var e=null;if(d.size()===1){e=d.get(0),e._setBundleLinks(null);return}var f,g,h=new Ce;for(f=0;f<d.size();f++)e=d.get(f),g=e.getStyle("link.bundle.id"),h.indexOf(g)<0&&h.add(g);h.sort();var i,j=new Ce,k;for(k=0;k<h.size();k++){g=h.get(k);var l=new Ce;for(f=0;f<d.size();f++)e=d.get(f),g===e.getStyle("link.bundle.id")&&l.add(e);i=new c.BundleLinks(l,j),j.add(i)}for(k=0;k<j.size();k++){i=j.get(k);for(f=0;f<i.getLinks().size();f++)e=i.getLinks().get(f),e._setBundleLinks(i)}},moveElements:function(a,b,c,d){var e=wd.filterMovingElements(a,d),f=e.size();for(var g=0;g<f;g++)e.get(g).translate(b,c)},filterMovingElements:function(a,b){var d=new Ce,e=a.size();for(var f=0;f<e;f++){var g=a.get(f);if(!(g instanceof Ze))continue;if(b&&!b(g))continue;var h=!0,i=d.toArray();for(var j=0;j<i.length;j++){var k=i[j];h&&k instanceof c.Follower&&g instanceof c.Follower&&g.isLoopedHostOn(k)?h=!1:k instanceof c.Follower&&k.isHostOn(g)?d.remove(k):h&&g instanceof c.Follower&&k instanceof Ze&&g.isHostOn(k)?h=!1:wd.isDescendantOfGroup(k,g)?d.remove(k):h&&wd.isDescendantOfGroup(g,k)&&(h=!1)}h&&d.add(g)}return d},isDescendantOfGroup:function(a,b){if(!!a&&b instanceof _e){if(!b.hasChildren())return!1;a=a._parent;while(a instanceof _e){if(a===b)return!0;a=a._parent}return!1}return!1}};d.element=wd;var xd={between:function(a,b,c){return c>=a&&c<=b?!0:c>=b&&c<=a?!0:!1},considerEast:function(a,b,c){return b?xd.between(b.x,c.x,a.x)?c.x>b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerWest:function(a,b,c){return b?xd.between(b.x,c.x,a.x)?c.x<b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerNorth:function(a,b,c){return b?xd.between(b.y,c.y,a.y)?c.y<b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},considerSouth:function(a,b,c){return b?xd.between(b.y,c.y,a.y)?c.y>b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},getHorizontalPoint:function(a,b,c){return xd.between(b.x,c.x,a.x)?{x:a.x,y:b.y}:Math.abs(a.x-b.x)<Math.abs(a.x-c.x)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getVerticalPoint:function(a,b,c){return xd.between(b.y,c.y,a.y)?{x:b.x,y:a.y}:Math.abs(a.y-b.y)<Math.abs(a.y-c.y)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getPoint:function(a,b,c,d,e){var f=Math.abs(d.x-c.x)>Math.abs(d.y-c.y);if("south"===e)return f&&xd.considerSouth(b,a,c)?xd.getHorizontalPoint(b,c,d):null;if("north"===e)return f&&xd.considerNorth(b,a,c)?xd.getHorizontalPoint(b,c,d):null;if("west"===e)return!f&&xd.considerWest(b,a,c)?xd.getVerticalPoint(b,c,d):null;if("east"===e)return!f&&xd.considerEast(b,a,c)?xd.getVerticalPoint(b,c,d):null;if("nearby"===e){var g;return f?g=xd.getHorizontalPoint(b,c,d):g=xd.getVerticalPoint(b,c,d),!a||p.getDistance(a,b)>p.getDistance(g,b)?g:null}return null},getBusPoint:function(a,b,c){var d,e=a.size();if(e>0){var f=a.get(0);for(var g=1;g<e;g++){var h=a.get(g),i=xd.getPoint(d,b,f,h,c);i&&(d=i),f=h}d||(d={x:f.x,y:f.y})}return d}};d.bus=xd;var yd={createFromPoint:function(a,b){var e=a._element;if(!e.getFromAgent())return{x:0,y:0};var f=e.getStyle("link.from.position"),g=e.getStyle("link.from.xoffset"),h=e.getStyle("link.from.yoffset"),i;if(a._network._edgeDetect){var j=e.getFromAgent(),k=e.getToAgent(),l=j.getImage(),m=d.images[l],n=j.getCenterLocation(),o=k.getCenterLocation(),q=this._getPointAngleDegree(o.x,o.y,n.x,n.y),r={x:0,y:0};if(m){var s=m._image;if(s&&ee(s)||s&&c.Util.getImageAsset(l)._cache)return ee(s)?m._edgeData||(m._edgeData=m._createEdgeData(s)):typeof s=="object"&&(m._edgeData||(m._edgeData=m._createEdgeData(c.Util.getImageAsset(l)._cache))),r.x=m._edgeData[q].x+j.getRect().x,r.y=m._edgeData[q].y+j.getRect().y,r}}if(!d.isCalculatingBus){d.isCalculatingBus=!0;if(e.getFromAgent()instanceof c.Bus){var t=e.getFromAgent();if(wd.hasVector(t)){var u=b?b._getElementZoomRect(a,t.getRect()):t.getRect(),v=t.getStyle("vector.shape");if(v==="oval")i=p.getEllipsePoint(u,yd.createToPoint(a));else if(v==="circle")i=p.getEllipsePoint(p.getCircleRect(u),yd.createToPoint(a));else if(v==="rectangle"||v==="roundrect"){var w=new Ce;w.add({x:t.x,y:t.y}),w.add({x:t.x+t.width,y:t.y}),w.add({x:t.x+t.width,y:t.y+t.height}),w.add({x:t.x,y:t.y+t.height}),w.add({x:t.x,y:t.y}),w=b?b._getShapeNodeZoomPoints(a,w):w,i=xd.getBusPoint(w,yd.createToPoint(a),t.getStyle("bus.style"))}}else{var w=b?b._getShapeNodeZoomPoints(a,t.getPoints()):t.getPoints();i=xd.getBusPoint(w,yd.createToPoint(a),t.getStyle("bus.style"))}}d.isCalculatingBus=!1}return i?(i.x+=g,i.y+=h):i=a._network.getPosition(f,e.getFromAgent(),null,g,h,!0),i},createToPoint:function(a,b){var e=a._element;if(!e.getToAgent())return{x:0,y:0};var f=e.getStyle("link.to.position"),g=e.getStyle("link.to.xoffset"),h=e.getStyle("link.to.yoffset"),i;if(a._network._edgeDetect){var j=e.getFromAgent(),k=e.getToAgent(),l=k.getImage(),m=d.images[l],n=j.getLocation(),o=k.getCenterLocation(),q=this._getPointAngleDegree(n.x,n.y,o.x,o.y),r={x:0,y:0};if(m){var s=m._image;if(s&&ee(s)||s&&c.Util.getImageAsset(l)._cache)return ee(s)?m._edgeData||(m._edgeData=m._createEdgeData(s)):typeof s=="object"&&(m._edgeData||(m._edgeData=m._createEdgeData(c.Util.getImageAsset(l)._cache))),r.x=m._edgeData[q].x+k.getRect().x,r.y=m._edgeData[q].y+k.getRect().y,r}}if(!d.isCalculatingBus){d.isCalculatingBus=!0;if(e.getToAgent()instanceof c.Bus){var t=e.getToAgent();if(wd.hasVector(t)){var u=b?b._getElementZoomRect(a,t.getRect()):t.getRect(),v=t.getStyle("vector.shape");if(v==="oval")i=p.getEllipsePoint(u,yd.createFromPoint(a));else if(v==="circle")i=p.getEllipsePoint(p.getCircleRect(u),yd.createFromPoint(a));else if(v==="rectangle"||v==="roundrect"){var w=new Ce;w.add({x:t.x,y:t.y}),w.add({x:t.x+t.width,y:t.y}),w.add({x:t.x+t.width,y:t.y+t.height}),w.add({x:t.x,y:t.y+t.height}),w.add({x:t.x,y:t.y}),w=b?b._getShapeNodeZoomPoints(a,w):w,i=xd.getBusPoint(w,yd.createFromPoint(a),t.getStyle("bus.style"))}}else{var w=b?b._getShapeNodeZoomPoints(a,t.getPoints()):t.getPoints();i=xd.getBusPoint(w,yd.createFromPoint(a),t.getStyle("bus.style"))}}d.isCalculatingBus=!1}return i?(i.x+=g,i.y+=h):i=a._network.getPosition(f,e.getToAgent(),null,g,h,!0),i},fillLoopedPoints:function(a,b,c){var d,e=yd.getBundleGap(a,!0),f=e,g=a.getStyle("link.looped.type"),h=a.getStyle("link.looped.direction");if(h==="north")return g==="arc"?yd.drawArc(b.x+b.width/2,b.y,0,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y},c.add({x:d.x+f,y:d.y}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width/2,y:b.y-e};if(h==="northeast")return g==="arc"?yd.drawArc(b.x+b.width,b.y,Math.PI*1.5,Math.PI*1.5,e,e,!1,c):(d={x:b.x+b.width,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x+f,y:d.y+f}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+e*.707,y:b.y-e*.707};if(h==="east")return g==="arc"?yd.drawArc(b.x+b.width,b.y+b.height/2,Math.PI*1.5,Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+e,y:d.y-f}),c.add({x:d.x+e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x+b.width+e,y:b.y+b.height/2};if(h==="southeast")return g==="arc"?yd.drawArc(b.x+b.width,b.y+b.height,Math.PI,Math.PI*1.5,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+f,y:d.y-f}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+e*.707,y:b.y+b.height+e*.707};if(h==="south")return g==="arc"?yd.drawArc(b.x+b.width/2,b.y+b.height,Math.PI,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y+b.height},c.add({x:d.x-f,y:d.y}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x+b.width/2,y:b.y+b.height+e};if(h==="southwest")return g==="arc"?yd.drawArc(b.x,b.y+b.height,Math.PI*.5,Math.PI*1.5,e,e,!1,c):(d={x:b.x,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-f,y:d.y-f}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x-e*.707,y:b.y+b.height+e*.707};if(h==="west")return g==="arc"?yd.drawArc(b.x,b.y+b.height/2,Math.PI*.5,Math.PI,e,e,!1,c):(d={x:b.x,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-e,y:d.y-f}),c.add({x:d.x-e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x-e,y:b.y+b.height/2};if(h==="northwest")return g==="arc"?yd.drawArc(b.x,b.y,0,Math.PI*1.5,e,e,!1,c):(d={x:b.x,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x-f,y:d.y+f}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x+f,y:d.y})),{x:b.x-e*.707,y:b.y-e*.707};throw"Can not resolve link looped direction '"+h+"'"},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;Math.abs(d)>2*Math.PI&&(d=2*Math.PI),m=Math.ceil(Math.abs(d)/(Math.PI/4)),i=d/m,j=-i,k=-c;if(m>0){n=a+Math.cos(c)*e,o=b+Math.sin(-c)*f,h.add({x:n,y:o});for(var t=0;t<m;t++){k+=j,l=k-j/2,p=a+Math.cos(k)*e,q=b+Math.sin(k)*f,r=a+Math.cos(l)*(e/Math.cos(j/2)),s=b+Math.sin(l)*(f/Math.cos(j/2));var u=new Ce;u.add({x:r,y:s}),u.add({x:p,y:q}),h.add(u)}}},fillBundlePoints:function(a,c,d,e,f,g){var h=a._element.getBundleCount(),i=a._element.getBundleIndex(),j=a.getStyle("link.bundle.expanded"),k;if(c!=="parallel"&&(k=yd.getBundleGap(a,!1))===0)return f.add(d),f.add(e),p.getCenterPoint(d,e);k===b&&(k=yd.getBundleGap(a,!1));var l=yd.getBundleOffset(a),m=p.getDistance(d,e);if(g){var n=g.getSizeZoom();l*=n,k*=n}(c==="arc"||c==="triangle")&&f.add({x:0,y:0}),c==="arc"&&f.add({x:0,y:k}),f.add({x:l,y:k}),f.add({x:m-l,y:k}),c==="arc"&&f.add({x:m,y:k}),(c==="arc"||c==="triangle")&&f.add({x:m,y:0});var o=Math.atan2(e.y-d.y,e.x-d.x),q=p.createMatrix(o,0,0);for(var r=0,s=f.size();r<s;r++){var t=f.get(r);t=q.transform(t),t.x+=d.x,t.y+=d.y,f.set(r,t)}if(c==="arc"){var u=p.getCenterPoint(f.get(2),f.get(3)),v=new Ce;return v.add(f.get(1)),v.add(f.get(2)),f.set(1,v),v=new Ce,v.add(f.get(4)),v.add(f.get(5)),f.set(4,v),f.removeAt(5),f.removeAt(2),u}return yd.calculateCenterPoint(f)},calculateCenterPoint:function(a){var b=a.size();if(a==null||b<1)return{x:0,y:0};if(b%2===0){var c=b/2,d=a.get(c-1),e=a.get(c);return{x:(d.x+e.x)/2,y:(d.y+e.y)/2}}return a.get((b-1)/2)},getBundleOffset:function(a){var b=p.getDistance(a.getFromPoint(),a.getToPoint()),c=a.getStyle("link.bundle.offset");return b>c*2?c:b/2},getBundleGap:function(a,b){var c=a._element;if(!c.getBundleLinks())return b?c.getStyle("link.looped.gap"):0;var d=b?"link.looped.gap":"link.bundle.gap",e=null,f=0,g=0,h=c.getBundleLinks().getSiblings(),i=0,j=c.getStyle("link.bundle.independent"),k=c.getStyle("link.bundle.group.gap");for(var l=0,m=h.size();l<m;l++){var n=h.get(l);if(j&&n!==c.getBundleLinks())continue;for(var o=0,p=n.getLinks().size();o<p;o++){var q=n.getLinks().get(o);if(j!==q.getStyle("link.bundle.independent"))continue;if(a._network.isVisible(q)){if(e==null)e=q,i=q.getStyle(d);else{var r=q.getStyle(d);g+=i/2+r/2,i=r}q===c&&(f=g+k/2)}}g+=k}if(b)return g-f+i;var s=f-g/2;return e!=null&&c.getFromAgent()!==e.getFromAgent()&&(s=-s),s},isTargetPriority:function(a,b,c){if(a){if(b.height<c.height)return b.height+c.height<Math.max(b.y+b.height,c.y+c.height)-Math.min(b.y,c.y)+b.height/2}else if(b.width<c.width)return b.width+c.width<Math.max(b.x+b.width,c.x+c.width)-Math.min(b.x,c.x)+b.width/2;return!0},calculateOrthogonalAndFlexionalLinkPoints:function(a,b,c,d){var e=yd.isHorizontal(a,b,c,d),f=new Ce;if(yd.isFlexionalTypeLink(a))yd.flexional(e,b,c,f,d.getStyle("link.extend"));else{yd.orthogonal(a,b,c,f,e,d);var g=yd.isSplitByPercent(a,d),h=g?yd.calculateSplitValueByPercent(a,e,b,c,d.getStyle("link.split.percent")):d.getStyle("link.split.value");h===0&&(e=!e)}var i;f.size()===0?yd.isTargetPriority(e,b,c)?(i={x:c.x+c.width/2,y:c.y+c.height/2},f.add(yd.rectanglePerimeter(b,!0,i)),f.add(yd.rectanglePerimeter(c,!1,f.get(f.size()-1)))):(i={x:b.x+b.width/2,y:b.y+b.height/2},i=yd.rectanglePerimeter(c,!1,i),f.add(yd.rectanglePerimeter(b,!0,i)),f.add(i)):(i=f.get(0),f.add(yd.rectanglePerimeter(b,!0,i),0),f.add(yd.rectanglePerimeter(c,!1,f.get(f.size()-1))));var j=f.size();if(j<2)return f;var k=f.get(0);for(var l=1;l<j-1;l++){var m=f.get(l);m.x===k.x&&m.y===k.y&&(f.remove(m),j--,l--),k=m}return f},isHorizontal:function(a,b,c,d){if(a){if(a==="flexional.horizontal"||a==="orthogonal.horizontal"||a==="orthogonal.H.V"||a==="extend.left"||a==="extend.right")return!0;if(a==="flexional.vertical"||a==="orthogonal.vertical"||a==="orthogonal.V.H"||a==="extend.top"||a==="extend.bottom")return!1}var e=yd.calculateXGap(b,c),f=yd.calculateYGap(b,c);return e>=f},flexional:function(a,b,c,d,e){a?yd.flexionalHorizontal(b,c,d,e):yd.flexionalVertical(b,c,d,e)},isSplitByPercent:function(a,b){return b.getStyle("link.split.by.percent")},isExtendTypeLink:function(a){return a&&(a==="extend.top"||a==="extend.left"||a==="extend.bottom"||a==="extend.right")},isFlexionalTypeLink:function(a){return a&&(a==="flexional"||a==="flexional.horizontal"||a==="flexional.vertical")},calculateControlPoint:function(a,b,c,d,e){if(a==="orthogonal.H.V"||a==="orthogonal.V.H")return{x:d.x+d.width/2,y:d.y+d.height/2};var f;if(yd.isExtendTypeLink(a)){var g=Math.min(c.y,d.y),h=Math.min(c.x,d.x),i=Math.max(c.y+c.height,d.y+d.height),j=Math.max(c.x+c.width,d.x+d.width);f=e.getStyle("link.extend");if(a==="extend.top")return{x:(h+j)/2,y:g-f};if(a==="extend.left")return{x:h-f,y:(g+i)/2};if(a==="extend.bottom")return{x:(h+j)/2,y:i+f};if(a==="extend.right")return{x:j+f,y:(g+i)/2}}var k=yd.isSplitByPercent(a,e);f=k?yd.calculateSplitValueByPercent(a,b,c,d,e.getStyle("link.split.percent")):e.getStyle("link.split.value");if(f===Number.NEGATIVE_INFINITY||f===Number.POSITIVE_INFINITY)return{x:d.x+d.width/2,y:d.y+d.height/2};if(f===0)return{x:c.x+c.width/2,y:c.y+c.height/2};if(b){var l=c.x+c.x+c.width<d.x+d.x+d.width;return{x:yd.calculateSplitLocation(l,f,c.x,c.width),y:c.y+c.height/2}}var m=c.y+c.y+c.height<d.y+d.y+d.height;return{x:c.x+c.width/2,y:yd.calculateSplitLocation(m,f,c.y,c.height)}},calculateGap:function(a,b,c,d){var e=Math.max(b,d)-Math.min(a,c);return e-(b-a+d-c)},calculateXGap:function(a,b){var c=Math.max(a.x+a.width,b.x+b.width)-Math.min(a.x,b.x);return c-a.width-b.width},calculateYGap:function(a,b){var c=Math.max(a.y+a.height,b.y+b.height)-Math.min(a.y,b.y);return c-a.height-b.height},calculateSplitValueByPercent:function(a,b,c,d,e){var f=yd.calculateSplitGapByPercent(e,b,c,d);return f*e},calculateSplitGapByPercent:function(a,b,c,d,e){return b?yd._calculateSplitGapByPercent(a,c.x,c.x+c.width,d.x,d.x+d.width):yd._calculateSplitGapByPercent(a,c.y,c.y+c.height,d.y,d.y+d.height)},_calculateSplitGapByPercent:function(a,b,c,d,e){var f=yd.calculateGap(b,c,d,e),g=b+c<d+e;if(f>0){if(a===1)return f+(e-d)/2;if(a>=0&&a<1)return f;if(a<0)return g?d-b:c-e}return g&&a>0||!g&&a<0?Math.abs(c-e):Math.abs(b-d)},calculateSplitPercentByControlPoint:function(a,b,c,d){return b?yd.calculateSplitPercent(a.x,c.x,c.x+c.width,d.x,d.x+d.width):yd.calculateSplitPercent(a.y,c.y,c.y+c.height,d.y,d.y+d.height)},calculateSplitPercent:function(a,b,c,d,e){if(a>=b&&a<=c)return 0;var f=yd.calculateGap(b,c,d,e);if(f>0&&a>=d&&a<=e)return 1;var g=b+c<d+e;if(f>0){if(a>Math.min(c,e)&&a<Math.max(b,d))return Math.abs(a-(g?c:b))/f;if(g){if(a<b)return(a-b)/(d-b)}else if(a>c)return(c-a)/(c-e)}return a>c?(g?a-c:c-a)/Math.abs(c-e):(g?a-b:b-a)/Math.abs(b-d)},calculateSplitLocation:function(a,b,c,d){return a===b>0?c+d+Math.abs(b):c-Math.abs(b)},calculateAngle:function(a,b){if(a!==0&&b!==0)return Math.atan2(a,b);if(a===0){if(b>0)return 0;if(b<0)return Math.PI}return a>0?Math.PI/2:-Math.PI/2},drawCorner:function(a,b){var c=a.size();if(c<3)return;var d=b.getStyle("link.corner");if(d==="none")return;var e=b.getStyle("link.xradius"),f=b.getStyle("link.yradius"),g,h,i=a.get(0),j=a.get(1),k,l;for(var m=2;m<c;m++){var n=a.get(m),o=j.x-i.x,p=j.y-i.y,q=n.x-j.x,r=n.y-j.y,s=p===0;if(o===0&&r===0||p===0&&q===0){s?(g=Math.min(m===2?Math.abs(o):Math.abs(o)/2,e),h=Math.min(m===c-1?Math.abs(r):Math.abs(r)/2,f),k={x:j.x-(o>0?g:-g),y:j.y},l={x:j.x,y:j.y+(r>0?h:-h)}):(g=Math.min(m===c-1?Math.abs(q):Math.abs(q)/2,e),h=Math.min(m===2?Math.abs(p):Math.abs(p)/2,f),k={x:j.x,y:j.y-(p>0?h:-h)},l={x:j.x+(q>0?g:-g),y:j.y}),a.remove(j),m--,c--;if(k.x!==i.x||k.y!==i.y)a.add(k,m),m++,c++;if(d==="bevel")a.add(l,m),m++,c++;else if(d==="round"){var t=new Ce;t.add(j),t.add(l),a.add(t,m),m++,c++}}i=j,j=n}l&&l.x===j.x&&l.y===j.y&&a.remove(j)},orthogonal:function(a,b,c,d,e,f){var g=f.getStyle("link.control.point"),h=g==null;if(g){var i=p.unionRect(b,c);p.containsPoint(i,g)||(e=yd.calculateIsHorizontalByControlPoint(g.x,g.y,i.y,i.x,i.y+i.height,i.x+i.width))}else g=yd.calculateControlPoint(a,e,b,c,f);e?yd.sideToSide(b,c,g,d,h):yd.topToBottom(b,c,g,d,h)},calculateIsHorizontalByControlPoint:function(a,b,c,d,e,f){return b<c&&c-b>d-a&&c-b>a-f||b>e&&b-e>d-a&&b-e>a-f?!1:!0},contains:function(a,b,c){return b>=a.x&&b<=a.x+a.width&&c>=a.y&&c<=a.y+a.height},topToBottom:function(a,b,c,d,e){var f=Math.max(a.y,b.y),g=Math.min(a.y+a.height,b.y+b.
height),h=c?c.y:g+(f-g)/2,i=a.x+a.width/2,j=b.x+b.width/2;!e&&c&&(c.x>=a.x&&c.x<=a.x+a.width&&(i=c.x),c.x>=b.x&&c.x<=b.x+b.width&&(j=c.x)),!yd.contains(b,i,h)&&!yd.contains(a,i,h)&&d.add({x:i,y:h}),!yd.contains(b,j,h)&&!yd.contains(a,j,h)&&d.add({x:j,y:h});if(d.size()===0)if(c)!yd.contains(b,c.x,h)&&!yd.contains(a,c.x,h)&&d.add({x:c.x,y:h});else{var k=Math.max(a.x,b.x),l=Math.min(a.x+a.width,b.x+b.width);d.add({x:k+(l-k)/2,y:h})}},sideToSide:function(a,b,c,d,e){var f=Math.max(a.x,b.x),g=Math.min(a.x+a.width,b.x+b.width),h=c?c.x:g+(f-g)/2,i=a.y+a.height/2,j=b.y+b.height/2;!e&&c&&(c.y>=a.y&&c.y<=a.y+a.height&&(i=c.y),c.y>=b.y&&c.y<=b.y+b.height&&(j=c.y)),!yd.contains(b,h,i)&&!yd.contains(a,h,i)&&d.add({x:h,y:i}),!yd.contains(b,h,j)&&!yd.contains(a,h,j)&&d.add({x:h,y:j});if(d.size()===0)if(c)!yd.contains(b,h,c.y)&&!yd.contains(a,h,c.y)&&d.add({x:h,y:c.y});else{var k=Math.max(a.y,b.y),l=Math.min(a.y+a.height,b.y+b.height);d.add({x:h,y:k+(l-k)/2})}},flexionalHorizontal:function(a,b,c,d){var e=b.x+b.width<a.x,f=a.x+a.width<b.x,g=e?a.x:a.x+a.width,h=a.y+a.height/2,i=f?b.x:b.x+b.width,j=b.y+b.height/2,k=d,l=e?-k:k,m={x:g+l,y:h};l=f?-k:k;var n={x:i+l,y:j};if(e===f){var o=e?Math.min(g,i)-d:Math.max(g,i)+d;c.add({x:o,y:h}),c.add({x:o,y:j})}else if(m.x<n.x===e){var p=h+(j-h)/2;c.add(m),c.add({x:m.x,y:p}),c.add({x:n.x,y:p}),c.add(n)}else c.add(m),c.add(n)},flexionalVertical:function(a,b,c,d){var e=b.y+b.height<a.y,f=a.y+a.height<b.y,g=a.x+a.width/2,h=e?a.y:a.y+a.height,i=b.x+b.width/2,j=f?b.y:b.y+b.height,k=d,l=e?-k:k,m={x:g,y:h+l};l=f?-k:k;var n={x:i,y:j+l};if(e===f){var o=e?Math.min(h,j)-d:Math.max(h,j)+d;c.add({x:g,y:o}),c.add({x:i,y:o})}else if(m.y<n.y===e){var p=g+(i-g)/2;c.add(m),c.add({x:p,y:m.y}),c.add({x:p,y:n.y}),c.add(n)}else c.add(m),c.add(n)},rectanglePerimeter:function(a,b,c){var d=a.x+a.width/2,e=a.y+a.height/2,f=c.x-d,g=c.y-e,h=Math.atan2(g,f),i={x:0,y:0},j=Math.PI,k=Math.PI/2,l=k-h,m=Math.atan2(a.height,a.width);return h<-j+m||h>j-m?(i.x=a.x,i.y=e-a.width*Math.tan(h)/2):h<-m?(i.y=a.y,i.x=d-a.height*Math.tan(l)/2):h<m?(i.x=a.x+a.width,i.y=e+a.width*Math.tan(h)/2):(i.y=a.y+a.height,i.x=d+a.height*Math.tan(l)/2),c.x>=a.x&&c.x<=a.x+a.width?i.x=c.x:c.y>=a.y&&c.y<=a.y+a.height&&(i.y=c.y),c.x<a.x?i.x=a.x:c.x>a.x+a.width&&(i.x=a.x+a.width),c.y<a.y?i.y=a.y:c.y>a.y+a.height&&(i.y=a.y+a.height),i},isSplitTypeLink:function(a){return a&&(a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.vertical")},isOrthogonalOrFlexionalLink:function(a){if(a instanceof c.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return yd.isOrthogonalOrFlexionalType(b)},isOrthogonalLink:function(a){if(a instanceof c.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return yd.isOrthogonalType(b)},isOrthogonalOrFlexionalType:function(a){return a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.H.V"||a==="orthogonal.vertical"||a==="orthogonal.V.H"||a==="extend.top"||a==="extend.left"||a==="extend.bottom"||a==="extend.right"||a==="flexional"||a==="flexional.horizontal"||a==="flexional.vertical"},isOrthogonalType:function(a){return a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.H.V"||a==="orthogonal.vertical"||a==="orthogonal.V.H"||a==="extend.top"||a==="extend.left"||a==="extend.bottom"||a==="extend.right"},hasControlPoint:function(a){return a==="orthogonal"||a==="orthogonal.horizontal"||a==="orthogonal.vertical"||a==="extend.bottom"||a==="extend.left"||a==="extend.right"||a==="extend.top"},getControlPoint:function(a,b,c){if(!a)throw"link can't be null";var d=a.getStyle("link.type");if(!yd.hasControlPoint(d))return null;var e=a.getStyle("link.control.point");if(e)return e;var f,g;b==null?(f=a.getFromAgent().getRect(),g=a.getToAgent().getRect()):(f=yd.getLinkSourceBounds(b,c),g=yd.getLinkTargetBounds(b,c));if(f==null||g==null)return null;var h=yd.isHorizontal(d,f,g,a);return yd.calculateControlPoint(a.getStyle("link.type"),h,f,g,a)},getSplitValueByControlPoint:function(a,b,c,d,e){if(b==="extend.top")return Math.min(c.y,d.y)-a.y;if(b==="extend.left")return Math.min(c.x,d.x)-a.x;if(b==="extend.bottom")return a.y-Math.max(c.y+c.height,d.y+d.height);if(b==="extend.right")return a.x-Math.max(c.x+c.width,d.x+d.width);var f;if(e){var g=c.x+c.x+c.width<d.x+d.x+d.width;return f=g?a.x-c.x+c.width:c.x-a.x,f>0?f:f>-c.width?0:f+c.width}var h=c.y+c.y+c.height<d.y+d.y+d.height;return f=h?a.y-c.y-c.height:c.y-a.y,f>0?f:f>-c.height?0:f+c.height},isHorizontalByControlPoint:function(a,b,c,d,e){var f=p.unionRect(c,d);return p.containsPoint(f,a)?yd.isHorizontal(b,c,d,e):yd.calculateIsHorizontalByControlPoint(a.x,a.y,f.y,f.x,f.y+f.height,f.x+f.width)},setParamsByControlPoint:function(a,b,c,d,e){var f=yd.isHorizontalByControlPoint(a,d,b,c,e),g=e.getStyle("link.control.point");(g||d==="orthogonal"||d==="orthogonal.horizontal"||d==="orthogonal.vertical")&&e.setStyle("link.type",f?"orthogonal.horizontal":"orthogonal.vertical");if(g){e.setStyle("link.control.point",a);return}var h=yd.getSplitValueByControlPoint(a,d,b,c,f);if(yd.isExtendTypeLink(d)){e.setStyle("link.extend",h);return}var i=yd.isSplitByPercent(d,e);if(!i){e.setStyle("link.split.value",h);return}if(h===0){e.setStyle("link.split.percent",0);return}e.setStyle("link.split.percent",yd.calculateSplitPercentByControlPoint(a,f,b,c))},getLinkNodeBounds:function(a,b,c,d,e,f){if(f)var g=f.getLocationZoom(),h=f.getSizeZoom(a);if(a==null)return null;var i;if(!d){var j=a.getNetwork().getPosition(e,a,null,b,c);f?i={x:j.x*g,y:j.y*g,width:1,height:1}:i={x:j.x,y:j.y,width:1,height:1}}else f?(i=a.getZoomBodyRect(),i.x+=b,i.y+=c):(i=a.getBodyRect(),i.x+=b,i.y+=c);return i},getLinkSourceBounds:function(a,b){var c=a._element,d=a.getNetwork().getElementUI(c.getFromAgent());if(d==null)return null;var e=c.getStyle("link.from.position"),f=c.getStyle("link.from.xoffset"),g=c.getStyle("link.from.yoffset"),h=c.getStyle("link.from.at.edge");return yd.getLinkNodeBounds(d,f,g,h,e,b)},getLinkTargetBounds:function(a,b){var c=a._element,d=a.getNetwork().getElementUI(c.getToAgent());if(d==null)return null;var e=c.getStyle("link.to.position"),f=c.getStyle("link.to.xoffset"),g=c.getStyle("link.to.yoffset"),h=c.getStyle("link.to.at.edge");return yd.getLinkNodeBounds(d,f,g,h,e,b)},orthogonalAndFlexional:function(a,b,c){var d=yd.getLinkSourceBounds(a,c);if(d==null)return null;var e=yd.getLinkTargetBounds(a,c);if(e==null)return null;var f=yd.calculateOrthogonalAndFlexionalLinkPoints(b,d,e,a._element);return yd.offsetLink(a,f),a.setHotSpot(yd.calculateCenterPoint(f)),b!=="flexional"&&yd.drawCorner(f,a._element),f},offsetLink:function(a,b){var c=a._element,e=c.isBundleAgent();if(e)return;var f=yd.getBundleGap(a,!1);if(f===0)return;var g,h,i=!1,j=!1,k=b.get(0),l=d.clone(k);for(var m=1,n=b.size();m<n;m++){var o=b.get(m),p=o.x-l.x,q=o.y-l.y;l=d.clone(o),h=yd.calculateAngle(p,q);if(p===0)(h-g)%Math.PI===0&&(h-g)%(2*Math.PI)!==0&&(i=!i,i&&(q=-q)),(h-g)%Math.PI!==0&&(k.x+=q<0?f:-f),o.x+=q<0?f:-f;else if(q===0){(h-g)%Math.PI===0&&(h-g)%(2*Math.PI)!==0&&(j=!j,j&&(p=-p));if(!g||(h-g)%Math.PI!==0)k.y-=p<0?f:-f;o.y-=p<0?f:-f}g=h,k=o}},_getPointAngleDegree:function(a,b,c,d){var e=c-a,f=d-b,g=Math.atan2(f,e);return g=g/Math.PI*180,g=parseInt(g)+180,g%=360,g}};d.link=yd;var zd={findMoveToBottomDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),zd.findMoveToBottomDatas(a,b,e.getChildren())},findMoveToTopDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(c.size()-1-d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),zd.findMoveToTopDatas(a,b,e.getChildren())},findMoveUpDatas:function(a,b,c){var d=!1;for(var e=0;e<c.size();e++){var f=c.get(e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),zd.findMoveUpDatas(a,b,f.getChildren())},findMoveDownDatas:function(a,b,c){var d=!1;for(var e=0;e<c.size();e++){var f=c.get(c.size()-1-e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),zd.findMoveDownDatas(a,b,f.getChildren())},doLayout:function(a,b){b=b||{},b.type=b.type||"round",b.animate=b.animate||!0,b.elements=b.elements||new c.List,b.repulsion=b.repulsion||1,b.expandGroup=b.expandGroup||!1;var d=new c.layout.AutoLayouter(a.getElementBox());d.getElements=function(){}}};d.box=zd;var Ad={scrollLeft:function(){return Ad._filterResults(a.pageXOffset?a.pageXOffset:0,k.documentElement?k.documentElement.scrollLeft:0,k.body?k.body.scrollLeft:0)},scrollTop:function(){return Ad._filterResults(a.pageYOffset?a.pageYOffset:0,k.documentElement?k.documentElement.scrollTop:0,k.body?k.body.scrollTop:0)},_filterResults:function(a,b,c){var d=a?a:0;return b&&(!d||d>b)&&(d=b),c&&(!d||d>c)?c:d},isSingleTouch:function(a){return a.touches&&a.touches.length==1},isMultiTouch:function(a){return a.touches&&a.touches.length>1},getDistance:function(a){if(!Ad.isMultiTouch(a))return 0;var b=a.touches[0],c=a.touches[1];return Math.sqrt(Math.pow(b.clientX-c.clientX,2)+Math.pow(b.clientY-c.clientY,2))}};d.touch=Ad;var Bd={_string:function(a,b,c,e){var f=c._stringPool.get();f.style.whiteSpace="nowrap",f.style.verticalAlign="middle",f.style.padding="0px 2px",d.setText(f,a,e),f.setAttribute("title",a),b.appendChild(f)},_boolean:function(a,b,c){var d=c._booleanPool.get();b._editInfo?(d._editInfo=b._editInfo,delete b._editInfo,d.disabled=!1):d.disabled=!0,d.keepDefault=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d.checked=a,b.appendChild(d),b.style.textAlign===""&&(b.style.textAlign="center")},_color:function(a,b,c){var d=c._colorPool.get();d.style.width="100%",d.style.height="100%",d.style.backgroundColor=a,d.setAttribute("title",a),b.appendChild(d)},render:function(a,b,c,d,e){if(b==null)return;var f=Bd["_"+a];f?f(b,c,d,e):typeof b=="boolean"?Bd._boolean(b,c,d,e):Bd._string(b,c,d,e)}};d.render=Bd;var Cd={toolTipDiv:null,getToolTipDiv:function(){if(!Cd.toolTipDiv){Cd.toolTipDiv=k.createElement("div");var a=Se,b=Cd.toolTipDiv.style;b.position="absolute",b.color=a.TOOLTIP_COLOR,b.background=a.TOOLTIP_BACKGROUND,b.fontSize=a.TOOLTIP_FONT_SIZE,b.padding=a.TOOLTIP_PADDING,b.border=a.TOOLTIP_BORDER,b.borderRadius=a.TOOLTIP_BORDER_RADIUS,b.boxShadow=a.TOOLTIP_BOX_SHADOW,b.zIndex=a.TOOLTIP_ZINDEX,b.setProperty&&b.setProperty("-webkit-box-shadow",a.TOOLTIP_BOX_SHADOW,null)}return Cd.toolTipDiv},isToolTipVisible:function(){return Cd.getToolTipDiv().parentNode?!0:!1},hideToolTip:function(){Cd._clearTimeout(),Cd._clearDismiss();if(!Cd.isToolTipVisible())return;var a=Cd.getToolTipDiv();a.parentNode&&a.parentNode.removeChild(a)},showToolTip:function(a,b){if(!a||!b){Cd.hideToolTip();return}Cd.isToolTipVisible()||Cd._reshow_timeout?Cd._showToolTip(a,b):(Cd._clearTimeout(),Cd._show_timeout=setTimeout(function(){Cd._showToolTip(a,b)},Se.TOOLTIP_INITIAL_DELAY))},_showToolTip:function(a,b){var c,d,e;a.target?(c=a.clientX,d=a.clientY):(c=a.x,d=a.y),e=Cd.getToolTipDiv(),s.clear(e),b instanceof Element?e.appendChild(b):e.innerHTML=b,e.style.left=c+Se.TOOLTIP_XOFFSET+"px",e.style.top=d+Se.TOOLTIP_YOFFSET+"px",e.parentNode||k.body.appendChild(e),Cd._clearDismiss(),Cd._dismiss_timeout=setTimeout(Cd.hideToolTip,Se.TOOLTIP_DISMISS_DELAY),Cd._clearReshow(),Cd._reshow_timeout=setTimeout(Cd._clearReshow,Se.TOOLTIP_RESHOW_DELAY)},_clearDismiss:function(){Cd._dismiss_timeout&&(clearTimeout(Cd._dismiss_timeout),Cd._dismiss_timeout=null)},_clearReshow:function(){Cd._reshow_timeout&&(clearTimeout(Cd._reshow_timeout),Cd._reshow_timeout=null)},_clearTimeout:function(){Cd._show_timeout&&(clearTimeout(Cd._show_timeout),Cd._show_timeout=null)},resetToolTip:function(){Cd.hideToolTip(),Cd.toolTipDiv=null}};d.popup=Cd;var Dd={handleClicked:function(a,b,c){if(!m.isTouchable&&b.button!==0)return;if(c){var d=Ed(c);d&&d.onClick&&d.onClick(c,a),a.onClickElement(c,b),a.fireInteractionEvent({kind:"clickElement",event:b,element:c})}else a.onClickBackground(b),a.fireInteractionEvent({kind:"clickBackground",event:b})},handleDoubleClicked:function(a,b,e){if(!m.isTouchable&&b.button!==0)return;if(a.isEditingElement())return;if(e){var f=Ed(e);f&&f.onDoubleClick&&f.onDoubleClick(e,a),a.onDoubleClickElement(e,b),a.fireInteractionEvent({kind:"doubleClickElement",event:b,element:e})}else a.onDoubleClickBackground(b),a.fireInteractionEvent({kind:"doubleClickBackground",event:b});e?e instanceof c.Link&&a.isDoubleClickToLinkBundle()?e.ISubNetwork&&a.isDoubleClickToSubNetwork()&&!d.isCtrlDown(b)?(a.isDoubleClickToEmptySubNetwork()||e.getChildrenSize()>0)&&a.setCurrentSubNetwork(e,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:e})}):e.reverseBundleExpanded()&&a.fireInteractionEvent({kind:"bundleLink",event:b,element:e}):e.ISubNetwork&&a.isDoubleClickToSubNetwork()?(a.isDoubleClickToEmptySubNetwork()||e.getChildrenSize()>0)&&a.setCurrentSubNetwork(e,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:e})}):e instanceof _e&&a.isDoubleClickToGroupExpand()&&(e.reverseExpanded(),a.fireInteractionEvent({kind:"expandGroup",event:b,element:e})):a.isDoubleClickToUpSubNetwork()&&a.upSubNetwork(a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"upSubNetwork",event:b})})},handleKeyDown:function(a,b){d.isCtrlDown(b)&&b.keyCode==65?(a.isKeyboardSelectEnabled()&&a.selectAll().size()>0&&a.fireInteractionEvent({kind:"selectAll"}),s.preventDefault(b)):b.keyCode==46?(a.isKeyboardRemoveEnabled()&&a.removeSelection()&&a.fireInteractionEvent({kind:"removeElement"}),s.preventDefault(b)):d.showVersion(b)},handleLongClicked:function(a,b,c){if(!m.isTouchable&&b.button!==0)return;if(c){var d=Ed(c);d&&d.onLongClick&&d.onLongClick(c,a),a.onLongClickElement(c,b),a.fireInteractionEvent({kind:"longClickElement",event:b,element:c})}else a.onLongClickBackground(b),a.fireInteractionEvent({kind:"longClickBackground",event:b})}},Ed=function(a){if(a&&a._image){if(typeof a._image=="object")return a._image;var b=d.getImageAsset(a._image);if(b)return b._image}return null};d.interaction=Dd;var Fd=function(a){return a.trim()[0].match(/[mlhvcsqta]/i)?Ld(a):Hd(a)},Gd={},Hd=function(a){var b=Gd[a];return b?b:(Gd[a]=b=[],a.trim().split(" ").forEach(function(a){a=a.split(","),a.length===2?b.push({x:parseFloat(a[0]),y:parseFloat(a[1])}):b.push(a[0])}),b)},Id={},Jd=/[mlhvcsqtaz][\d.,\-\s]*/gi,Kd=/-?(\d)+(\.(\d)+)?/g,Ld=function(a){var b=Id[a],c;return b?b:(c=a.trim().match(Jd),Id[a]=b=[],c&&c.forEach(function(a){var c=a[0],d=a.match(Kd),e=d&&d.length,f;b.push(a={c:c});if(e){d.forEach(function(a,b){d[b]=parseFloat(a)});switch(c){case"M":case"m":case"L":case"l":for(f=0;f<e;f+=2)f!==0&&b.push(a={c:c==="M"||c==="L"?"L":"l"}),a.x=d[f],a.y=d[f+1];break;case"H":case"h":for(f=0;f<e;f++)f!==0&&b.push(a={c:c}),a.x=d[f];break;case"V":case"v":for(f=0;f<e;f++)f!==0&&b.push(a={c:c}),a.y=d[f];break;case"C":case"c":for(f=0;f<e;f+=6)f!==0&&b.push(a={c:c}),a.x1=d[f],a.y1=d[f+1],a.x2=d[f+2],a.y2=d[f+3],a.x=d[f+4],a.y=d[f+5];break;case"S":case"s":for(f=0;f<e;f+=4)f!==0&&b.push(a={c:c}),a.x2=d[f],a.y2=d[f+1],a.x=d[f+2],a.y=d[f+3];break;case"Q":case"q":for(f=0;f<e;f+=4)f!==0&&b.push(a={c:c}),a.x1=d[f],a.y1=d[f+1],a.x=d[f+2],a.y=d[f+3];break;case"T":case"t":for(f=0;f<e;f+=2)f!==0&&b.push(a={c:c}),a.x=d[f],a.y=d[f+1]}}}),b)},Md=function(a,b){var c=a.transform&&Nd(a.transform),d,e,f,g,h,i,j,k,l,m,n,p;return c&&c.length&&(d=o.identity(),c.forEach(function(a){var b=a[0];b==="matrix"?d.multiply(new o(a[1],a[2],a[3],a[4],a[5],a[6])):b==="translate"?d.translate(a[1]||0,a[2]||0):b==="scale"?d.scale(a[1]||1,a[2]||a[1]||1):b==="rotate"?d.rotate(a[1]||0,a[2]||0,a[3]||0):b==="skewX"?d.skew(a[1]||0,0):b==="skewY"&&d.skew(0,a[1]||0)})),a.type==="linear"?(g=a.x1||0,h=a.y1||0,i=a.x2||0,j=a.y2||0,d&&(e=d.transform(g,h),g=e.x,h=e.y,e=d.transform(i,j),i=e.x,j=e.y),f=b.createLinearGradient(g,h,i,j)):a.type==="radial"&&(k=a.fx||0,l=a.fy||0,m=a.cx||0,n=a.cy||0,p=a.r||0,a.fx==null&&(k=m),a.fy==null&&(l=n),f=b.createRadialGradient(k,l,0,m,n,p)),f&&a.stop&&a.stop.length&&a.stop.forEach(function(a){f.addColorStop(parseFloat(a.offset),Ie(a.color,b._color))}),f},Nd=function(a){return a.replace(/[\s\r\t\n]+/gm," ").trim().replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/).map(function(a){return a.replace(")","").trim().split(/\s*\(\s*|\s+,?\s*|,\s*/).map(function(a,b){return b===0?a:parseFloat(a)})})},Od=function(a,b,c,e,f,g,h){var i,j,k,l,m=1;typeof b!="object"&&(j=b,i=d.images[b],b=i&&i.getImage()),ee(b)?a.drawImage(i?i.getImage(c):b,Math.round(e.x),Math.round(e.y),e.width,e.height):b&&typeof b=="object"&&(a._data=f,a._view=g,j?(k=e.width/(b.w&&$d(f,b,b,"w")||f.getWidth()),l=e.height/(b.h&&$d(f,b,b,"h")||f.getHeight()),g&&(g.getSizeZoom?m=g.getSizeZoom()*g.getGraphicsZoom():m=g.getZoom()),!i._cache||Math.max(k*m,l*m)>1?Pd(a,b,c,e,f,g,h):a.drawImage(c?i.getImage(c):i._cache,Math.round(e.x),Math.round(e.y),e.width,e.height)):Pd(a,b,c,e,f,g,h),a._data=null,a._view=null)},Pd=function(a,b,c,d,e,f,g){var h=e&&e.getStyle("image.state"),i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;q=a._vector,x=a._color,r=a._fill,s=a._pattern,t=a._lineWidth,u=a._alpha,v=a._sx,w=a._sy,n=b;if($d(e,n,n,"visible",f)===!1)return;a._color=c,i=$d(e,n,n,"v",f),j=i&&i.length,z=n.w&&$d(e,n,n,"w")||e.getWidth(),A=n.h&&$d(e,n,n,"h")||e.getHeight(),o=d.width/z,p=d.height/A,g===!0?(a._fill=null,a._pattern=null,a._lineWidth=null,a._alpha=null):(a._sx=o,a._sy=p),a.save(),a.translate(d.x+d.width/2,d.y+d.height/2),(o!==1||p!==1)&&a.scale(o,p),n.origin&&a.translate((n.origin.x-.5)*z,(n.origin.y-.5)*A),a._vector=n,n.clip&&(a.beginPath(),n.clip===!0?a.rect(-(n.origin?n.origin.x:.5)*z,-(n.origin?n.origin.y:.5)*A,z,A):n.clip.length?n.clip.forEach(function(b){a.drawShape(b)}):a.drawShape(n.clip),a.clip()),Vd(e,n,n,a,f);for(k=0,j=i.length;k<j;k++)m=i[k],a._shapeData=m,f&&(f._shapeDataIndex=k,m.animate&&ke(m,n,e,f)),y=$d(e,n,m,"state",f),$d(e,n,m,"visible",f)!==!1&&(!y||(Array.isArray(y)?y.indexOf(h)>=0:y===h))&&(l=Rd[m.shape],l&&(a.save(),m.shape==="vector"||m.shape==="g"?l(a,m,e,f):Vd(e,n,m,a,f,function(){l(a,m,e,f)}),a.restore())),f&&(f._shapeDataIndex=null),a._shapeData=null;a.restore(),a._vector=q,a._shapeData=null,a._color=x,a._fill=r,a._pattern=s,a._lineWidth=t,a._alpha=u,a._sx=v,a._sy=w},Qd=function(b,c,e,f,g){var h,i,j,k,l,m,n,o,p,q=b._vector,r=q.origin,s=q.w&&$d(f,q,q,"w")||f.getWidth(),t=q.h&&$d(f,q,q,"h")||f.getHeight();typeof c=="string"?(p=d.images[c],p&&(j=p.getWidth(),k=p.getHeight())):(j=c.w&&$d(f,c,c,"w"),k=c.h&&$d(f,c,c,"h"));if(!j||!k||!e)return;l=e.w/j*b._sx,m=e.h/k*b._sy,h=e.x-s/2*(b._sx-1),i=e.y-t/2*(b._sy-1),r&&(h-=(r.x-.5)*s*(b._sx-1),i-=(r.y-.5)*t*(b._sy-1));if(b._sx!==1||b._sy!==1)b.scale(1/b._sx,1/b._sy),h+=((r?r.x:.5)*s+e.x)*(b._sx-1),i+=((r?r.x:.5)*t+e.y)*(b._sy-1);e={x:0,y:0,width:j,height:k};for(n=0;n<l;n++)for(o=0;o<m;o++)e.x=n*j+h,e.y=o*k+i,Od(b,c,null,e,f,g,!0)},Rd={line:function(a,b,c,d){var e=$d(c,a._vector,b,"p1",d),f=$d(c,a._vector,b,"p2",d),g,h,i,j;e?(g=_d(e.length?e[0]:e.x,a),h=ae(e.length?e[1]:e.y,a)):(g=$d(c,a._vector,b,"x1",d,!0),h=$d(c,a._vector,b,"y1",d,!1)),f?(i=_d(f.length?f[0]:f.x,a),j=ae(f.length?f[1]:f.y,a)):(i=$d(c,a._vector,b,"x2",d,!0),j=$d(c,a._vector,b,"y2",d,!1)),a.moveTo(g,h),a.lineTo(i,j)},rect:function(a,b,c,d){var e=$d(c,a._vector,b,"rect",d),f=$d(c,a._vector,b,"r",d),g,h,i,j;e?(Array.isArray(e)?(g=e[0],h=e[1],i=e[2],j=e[3]):(g=e.x,h=e.y,i=e.w,j=e.h),g=_d(g,a),h=ae(h,a),i=_d(i,a),j=ae(j,a)):(g=$d(c,a._vector,b,"x",d,!0),h=$d(c,a._vector,b,"y",d,!1),i=$d(c,a._vector,b,"w",d,!0),j=$d(c,a._vector,b,"h",d,!1)),a.drawRoundRect(g,h,i,j,f);if(a._gradientFunc||a._pattern)a._rect={x:g,y:h,w:i,h:j}},circle:function(a,b,c,d){var e=$d(c,a._vector,b,"cx",d,!0),f=$d(c,a._vector,b,"cy",d,!1),g=a._vector.w&&$d(c,a._vector,a._vector,"w")||c.getWidth(),h=a._vector.h&&$d(c,a._vector,a._vector,"h")||c.getHeight(),i=be($d(c,a._vector,b,"r",d),Math.min(g,h),b,a._vector),j=$d(c,a._vector,b,"startAngle",d),k=$d(c,a._vector,b,"endAngle",d),l=$d(c,a._vector,b,"anticlockwise",d),m=$d(c,a._vector,b,"close",d);j==null&&(j=0),k==null&&(k=360),l==null&&(l=!1),m&&a.moveTo(e,f),a.arc(e,f,i,j/180*Math.PI,k/180*Math.PI,l),m&&a.closePath();if(a._gradientFunc||a._pattern)a._rect={x:e-i,y:f-i,w:i*2,h:i*2}},ellipse:function(a,b,c,d){var e=$d(c,a._vector,b,"cx",d,!0),f=$d(c,a._vector,b,"cy",d,!1),g=$d(c,a._vector,b,"rx",d,!0),h=$d(c,a._vector,b,"ry",d,!1),i=$d(c,a._vector,b,"startAngle",d),j=$d(c,a._vector,b,"endAngle",d),k=$d(c,a._vector,b,"anticlockwise",d),l=$d(c,a._vector,b,"close",d);i==null&&(i=0),j==null&&(j=360),k==null&&(k=!1),l&&a.moveTo(e,f),a.ellipse(e,f,g,h,0,i/180*Math.PI,j/180*Math.PI,k),l&&a.closePath();if(a._gradientFunc||a._pattern)a._rect={x:e-g,y:f-h,w:g*2,h:h*2}},path:function(a,b,c,d){var e=$d(c,a._vector,b,"data",d);a.drawPath(e)},text:function(a,b,c,d){var e=$d(c,a._vector,b,"text",d),f=$d(c,a._vector,b,"x",d,!0),g=$d(c,a._vector,b,"y",d,!1),h=$d(c,a._vector,b,"w",d,!0);if(e==null)return;e=String(e);var i=e.split("\n"),j=a.measureText("e").width*2,k=Sd(a,e,h);g-=(k.h/j-1)/2*j,i.forEach(function(b){if(h){var c=b.split(" "),d=c.length,e="",i,k,l,m,n;for(l=0;l<d;l++){i=c[l]+(l===d-1?"":" "),k=e+i,m=a.measureText(k).width;if(m<h)e=k;else if(m==h)a.fillText(e,f,g),e="",g+=j;else{for(n=0;n<i.length;n++){k=e+i.substr(0,n+1);if(a.measureText(k).width>h){a.fillText(k.substring(0,k.length-1),f,g),e=i.substring(n,i.length),g+=j;break}}while(e.length>0&&a.measureText(e).width>h)for(n=0;n<e.length;n++){k=e.substr(0,n+1);if(a.measureText(k).width>h){a.fillText(e.substr(0,n),f,g),e=e.substring(n,e.length),g+=j;break}}}}a.fillText(e,f,g)}else a.fillText(b,f,g);g+=j})},draw:function(a,b,c,d){var e=b.draw,f,g;typeof e=="string"&&((f=e.match(Yd))?(g="with(data) { "+f[1]+" }",e=new Function("g","data","view",g)):e=fe[e]),typeof e=="function"&&e.call(a._vector,a,c,d)},vector:function(a,b,c,e){var f=a._vector,g=$d(c,f,b,"name",e),h=$d(c,f,b,"x",e,!0),i=$d(c,f,b,"y",e,!1),j=$d(c,f,b,"w",e),k=$d(c,f,b,"h",e),l,m,n,o,p,q,r,s,t,u,v,w,x;typeof g=="string"?(s=d.images[g],r=s&&s._image):r=g;if(r)if(ee(r))j!=null&&k!=null?a.drawImage(r,h,i,_d(j,a),ae(k,a)):a.drawImage(r,h,i);else{t=$d(c,r,r,"v",e),u=t&&t.length,v=r.w&&$d(c,r,r,"w"),w=r.h&&$d(c,r,r,"h"),j!=null&&k!=null?(j=_d(j,a),k=ae(k,a)):(j=v,k=w),a.save(),o=a._lineWidth,p=a._fill,q=a._alpha,Vd(c,r,r,a,e),Vd(c,f,b,a,e),a.translate(h,i),a.scale(j/v,k/w),r.origin&&a.translate((r.origin.x-.5)*v,(r.origin.y-.5)*w),r.clip&&(a.beginPath(),r.clip===!0?a.rect(-(r.origin?r.origin.x:.5)*v,-(r.origin?r.origin.y:.5)*w,v,w):r.clip.length?r.clip.forEach(function(b){a.drawShape(b)}):a.drawShape(r.clip),a.clip()),x=a._shapeData,a._vector=r;for(l=0;l<u;l++)m=t[l],a._shapeData=m,e&&(e._shapeDataIndex.length?e._shapeDataIndex.push(l):e._shapeDataIndex=[e._shapeDataIndex,l],m.animate&&ke(m,f,c,e)),$d(c,r,m,"visible",e)!==!1&&(n=Rd[m.shape],n&&(a.save(),m.shape==="vector"||m.shape==="g"?n(a,m,c,e):Vd(c,r,m,a,e,function(){n(a,m,c,e)}),a.restore())),e&&e._shapeDataIndex.pop();a._vector=f,a._shapeData=x,a._lineWidth=o,a._fill=p,a._alpha=q,a.restore()}},g:function(a,b,c,d){var e=$d(c,a._vector,b,"v",d),f,g,h,i,j;e&&e.length&&(a.save(),g=a._lineWidth,h=a._fill,i=a._alpha,j=a._shapeData,Vd(c,a._vector,b,a,d),e.forEach(function(b){$d(c,a._vector,b,"visible",d)!==!1&&(f=Rd[b.shape],f&&(a.save(),a._shapeData=b,b.shape==="vector"||b.shape==="g"?f(a,b,c,d):Vd(c,a._vector,b,a,d,function(){f(a,b,c,d)}),a.restore()))}),a._lineWidth=g,a._fill=h,a._alpha=i,a._shapeData=j,a.restore())}};Rd.image=Rd.vector;var Td=Object.keys(Rd),Ud={M:function(a,b){return a.moveTo(b.x,b.y),a._path_start=b,a._rect&&de(a._rect,b.x,b.y),b},m:function(a,b,c){return c&&(b={x:c.x+b.x,y:c.y+b.y}),a.moveTo(b.x,b.y),a._path_start=b,a._rect&&de(a._rect,b.x,b.y),b},Z:function(a){return a.closePath(),a._path_start},z:function(a){return a.closePath(),a._path_start},L:function(a,b){return a.lineTo(b.x,b.y),a._rect&&de(a._rect,b.x,b.y),b},l:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y};return a.lineTo(d.x,d.y),a._rect&&de(a._rect,d.x,d.y),d},H:function(a,b,c){var d={x:b.x,y:c.y};return a.lineTo(d.x,d.y),a._rect&&de(a._rect,d.x,d.y),d},h:function(a,b,c){var d={x:c.x+b.x,y:c.y};return a.lineTo(d.x,d.y),a._rect&&de(a._rect,d.x,d.y),d},V:function(a,b,c){var d={x:c.x,y:b.y};return a.lineTo(d.x,d.y),a._rect&&de(a._rect,d.x,d.y),d},v:function(a,b,c){var d={x:c.x,y:c.y+b.y};return a.lineTo(d.x,d.y),a._rect&&de(a._rect,d.x,d.y),d},Q:function(a,b){return a._preQ_x=b.x1,a._preQ_y=b.y1,a.quadraticCurveTo(b.x1,b.y1,b.x,b.y),a._rect&&(de(a._rect,b.x1,b.y1),de(a._rect,b.x,b.y)),b},q:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=a._preQ_x=c.x+b.x1,f=a._preQ_y=c.y+b.y1;return a.quadraticCurveTo(e,f,d.x,d.y),a._rect&&(de(a._rect,e,f),de(a._rect,d.x,d.y)),d},T:function(a,b,c){var d=a._preQ_x=2*c.x-a._preQ_x,e=a._preQ_y=2*c.y-a._preQ_y;return a.quadraticCurveTo(d,e,b.x,b.y),a._rect&&(de(a._rect,d,e),de(a._rect,b.x,b.y)),b},t:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=a._preQ_x=2*c.x-a._preQ_x,f=a._preQ_y=2*c.y-a._preQ_y;return a.quadraticCurveTo(e,f,d.x,d.y),a._rect&&(de(a._rect,e,f),de(a._rect,d.x,d.y)),d},C:function(a,b){return a._preC_x=b.x2,a._preC_y=b.y2,a.bezierCurveTo(b.x1,b.y1,b.x2,b.y2,b.x,b.y),a._rect&&(de(a._rect,b.x1,b.y1),de(a._rect,b.x2,b.y2),de(a._rect,b.x,b.y)),b},c:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=c.x+b.x1,f=c.y+b.y1,g=a._preC_x=c.x+b.x2,h=a._preC_y=c.y+b.y2;return a.bezierCurveTo(e,f,g,h,d.x,d.y),a._rect&&(de(a._rect,e,f),de(a._rect,g,h),de(a._rect,d.x,d.y)),d},S:function(a,b,c){var d=2*c.x-a._preC_x,e=2*c.y-a._preC_y;return a._preC_x=b.x2,a._preC_y=b.y2,a.bezierCurveTo(d,e,b.x2,b.y2,b.x,b.y),a._rect&&(de(a._rect,d,e),de(a._rect,b.x2,b.y2),de(a._rect,b.x,b.y)),b},s:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=2*c.x-a._preC_x,f=2*c.y-a._preC_y,g=a._preC_x=c.x+b.x2,h=a._preC_y=c.y+b.y2;return a.bezierCurveTo(e,f,g,h,d.x,d.y),a._rect&&(de(a._rect,e,f),de(a._rect,g,h),de(a._rect,d.x,d.y)),d}},Vd=function(a,b,c,d,e,f){var g=$d(a,b,c,"line",e),h=$d(a,b,c,"fill",e),i=$d(a,b,c,"fillRule",e)||"nonzero",j=$d(a,b,c,"gradient",e),k=$d(a,b,c,"gradientColor",e),l=$d(a,b,c,"pattern",e),m=$d(a,b,c,"font",e),n=$d(a,b,c,"textAlign",e)||"center",o=$d(a,b,c,"textBaseline",e)||"middle",p=$d(a,b,c,"translate",e),q=$d(a,b,c,"rotate",e),r=$d(a,b,c,"rotateOrigin",e),s=$d(a,b,c,"scale",e),t=$d(a,b,c,"transform",e),v=$d(a,b,c,"alpha",e),w=d._lineWidth,x=d._fill,y=d._pattern,z=d._alpha,A=d._gradientFunc,B,C,D,E,F,G,H,I,J,K,L,M,N;g?(B=g.color,C=g.width,D=g.cap,E=g.join,F=g.miterLimit,G=g.dash,H=g.dashOffset):(B=$d(a,b,c,"lineColor",e),C=$d(a,b,c,"lineWidth",e),D=$d(a,b,c,"lineCap",e),E=$d(a,b,c,"lineJoin",e),F=$d(a,b,c,"miterLimit",e),G=$d(a,b,c,"lineDash",e),H=$d(a,b,c,"lineDashOffset",e)),B!=null&&(d.strokeStyle=Ie(B,d._color)),C!=null&&(d.lineWidth=d._lineWidth=e&&e.getSizeZoom?C/e.getSizeZoom():C),D!=null&&(d.lineCap=D),E!=null&&(d.lineJoin=E),F!=null&&(d.miterLimit=F),G!=null&&(d.lineDash=G,d.setLineDash(G)),H!=null&&(d.lineDashOffset=H),l?d._pattern=l:(h&&(d.fillStyle=d._fill=Ie(h,d._color)),j&&(typeof j=="string"?J=u[j]:(J=u[j.type],j.color&&(k=j.color),J||(j=Md(j,d))),d._gradientFunc=J)),m!=null&&(d.font=m),n!=null&&(d.textAlign=n),o!=null&&(d.textBaseline=o),Wd(a,b,c,d,e);if(t!=null)typeof t=="string"&&(t=Nd(t)),t.length&&t.forEach(function(a){var b=a[0];b==="matrix"?d.transform(a[1],a[2],a[3],a[4],a[5],a[6]):b==="translate"?d.translate(a[1]||0,a[2]||0):b==="scale"?d.scale(a[1]||1,a[2]||a[1]||1):b==="rotate"?a.length>2?(d.translate(a[2],a[3]),d.rotate(a[1]),d.translate(-a[2],-a[3])):d.rotate(a[1]):b==="skewX"?d.transform(1,0,Math.tan(a[1]*Math.PI/180),1,0,0):b==="skewY"&&d.transform(1,Math.tan(a[1]*Math.PI/180),0,1,0,0)});else{p!=null&&(Array.isArray(p)?(M=p[0],N=p[1]):typeof p=="object"?(M=p.x,N=p.y):(M=p,N=0),M=_d(M,d),N=ae(N,d),(M!==0||N!==0)&&d.translate(M,N));if(q!=null&&q%360!==0){var O,P;r&&(Array.isArray(r)?(O=r[0],P=r[1]):typeof r=="object"?(O=r.x,P=r.y):O=P=r,O=_d(O,d),P=ae(P,d),(O!==0||P!==0)&&d.translate(O,P)),d.rotate(q*Math.PI/180),r&&(O!==0||P!==0)&&d.translate(-O,-P)}s!=null&&(Array.isArray(s)?(K=s[0],L=s[1]):typeof s=="object"?(K=s.x,L=s.y):K=L=s,(K!==1||L!==1)&&d.scale(K,L))}v!=null&&(d.globalAlpha=d._alpha=z!=null?z*v:v),f&&(d.beginPath(),f(),I=d._rect||c.rect,d._pattern?(d._lineWidth>0&&d.stroke(),d.clip(),Qd(d,d._pattern,I,a,e)):(J&&I&&(j=J(d,Ie(h||"#000000",d._color),Ie(k||"#FFFFFF",d._color),I.x,I.y,I.w,I.h)),j&&(d.fillStyle=d._fill=j),d._fill&&d.fill(i),d._lineWidth>0&&d.stroke()),d._lineWidth=w,d._fill=x,d._pattern=y,d._alpha=z,d._gradientFunc=A,d._rect=null)},Wd=function(a,b,c,d,e){var f=$d(a,b,c,"shadow",e),g,h,i,j;f?(g=f.offsetX,h=f.offsetY,i=f.blur,j=f.color):(g=$d(a,b,c,"shadowOffsetX",e),h=$d(a,b,c,"shadowOffsetY",e),i=$d(a,b,c,"shadowBlur",e),j=$d(a,b,c,"shadowColor",e)),g!=null&&(d.shadowOffsetX=g),h!=null&&(d.shadowOffsetY=h),i!=null&&(d.shadowBlur=i),j!=null&&(d.shadowColor=j)},Xd=/<%=([\s\S]+?)%>/,Yd=/<%([\s\S]+?)%>/,Zd=new RegExp([Xd.source,Yd.source].join("|")),$d=function(a,c,d,e,f,g,h){var i=d[e],j=typeof i,k,l,m,n,o;j==="string"&&(k=i.match(Zd))?(l="with(data) { "+(k[1]?"return "+k[1]:k[2])+" }",m=new Function("data","view",l),i=m.call(c,a,f)):j==="function"&&(i=i.call(c,a,f)),g===!0?(n=c.w&&$d(a,c,c,"w")||a.getWidth(),(d.rel===!0||d.rel===b&&c.rel)&&i<=1&&i>=-1?i*=n:typeof i=="string"&&(i=parseInt(i)/100*n),i=i||0):g===!1&&(o=c.h&&$d(a,c,c,"h")||a.getHeight(),(d.rel===!0||d.rel===b&&c.rel)&&i<=1&&i>=-1?i*=o:typeof i=="string"&&(i=parseInt(i)/100*o),i=i||0);if(h!==!1&&f&&a&&d.animate&&a._animates){var p=a._animates,q=f._shapeDataIndex,r;if(q.length)for(var s=0;s<q.length;s++)r=q[s],p=p[r];else r=q;var t=p[r],u=t[e];if(u)if(Array.isArray(u))for(var s=u.length-1;s>=0;s--){var v=u[s];if(v.stopped||v.time>0)if(v.started)return we(v,i)}else if(u.started)return we(u,i)}return i},_d=function(a,c){if(!a)return 0;var d=c._vector.w&&$d(c._data,c._vector,c._vector,"w")||c._data.getWidth();return(c._shapeData&&c._shapeData.rel===!0||(!c._shapeData||c._shapeData.rel===b)&&c._vector.rel)&&a<=1&&a>=-1?a*d:typeof a=="string"?parseInt(a)/100*d:a},ae=function(a,c){if(!a)return 0;var d=c._vector.h&&$d(c._data,c._vector,c._vector,"h")||c._data.getHeight();return(c._shapeData&&c._shapeData.rel===!0||(!c._shapeData||c._shapeData.rel===b)&&c._vector.rel)&&a<=1&&a>=-1?a*d:typeof a=="string"?parseInt(a)/100*d:a},be=function(a,c,d,e){return a?(d.rel===!0||d.rel===b&&e.rel)&&a<=1&&a>=-1?a*c:typeof a=="string"?parseInt(a)/100*c:a:0},ce=(a.CanvasRenderingContext2D||g.Context2d).prototype;ce.drawShape=function(a){var b=this,c=b._vector,d=b._shapeData,e=b._data,f=b._view,g=Rd[a.shape];g&&(b.save(),b._shapeData=a,a.shape==="vector"||a.shape==="g"?g(b,a,e,f):Vd(e,c,a,b,f,function(){g(b,a,e,f)}),b._shapeData=d,b.restore())},ce.drawPath=function(a){var b=this,c,d,e,f,g,h,i,j,k,l,m,n;typeof a=="string"&&(a=Fd(a)),k=a?a.length:0;if(k<=1)return;if(b._gradientFunc||b._pattern)b._rect=l={x:0,y:0,w:0,h:0};c=a&&a[0]&&a[0].c,c||(d=a&&a[0]&&a[0].x!=null,e=a[k-1]==="z"||a[k-1]==="Z",e&&k--);if(c){for(f=0;f<k;f++)h=a[f],i=Ud[h.c],i&&(g=i(b,h,g));b._path_start=null,b._preC_x=null,b._preC_y=null,b._preQ_x=null,b._preQ_y=null}else if(d){j=a[0],m=_d(j.x,b),n=ae(j.y,b),b.moveTo(m,n),l&&de(l,m,n);for(f=1;f<k;f++)j=a[f],m=_d(j.x,b),n=ae(j.y,b),b.lineTo(m,n),l&&de(l,m,n);e&&b.closePath()}else{m=_d(a[0],b),n=ae(a[1],b),b.moveTo(m,n),l&&de(l,m,n);for(f=2;f<k;f+=2)m=_d(a[f],b),n=ae(a[f+1],b),b.lineTo(m,n),l&&de(l,m,n);e&&b.closePath()}return a};var de=function(a,b,c){var d=Math.min(a.x,b),e=Math.max(a.x+a.w,b),f=Math.min(a.y,c),g=Math.max(a.y+a.h,c);a.x=d,a.y=f,a.w=e-d,a.h=g-f};ce._fillPath=function(a,b){var c=this;c.beginPath(),c.fillStyle=a,c.drawPath(b),c.fill()},ce._fillRect=function(a,b,c,d,e){var f=this;f.beginPath(),f.fillStyle=a,f.rect(b,c,d,e),f.fill()},ce.ellipse||(ce.ellipse=function(a,b,c,d){var e=this,f=.5522848,g=c*f,h=d*f,i=a+c,j=b+d,k=a-c,l=b-d;e.moveTo(k,b),e.bezierCurveTo(k,b-h,a-g,l,a,l),e.bezierCurveTo(a+g,l,i,b-h,i,b),e.bezierCurveTo(i,b+h,a+g,j,a,j),e.bezierCurveTo(a-g,j,k,b+h,k,b)}),ce.drawRoundRect=function(a,b,c,d,e){var f=this;if(!e){f.rect(a,b,c,d);return}var g,h,i,j;if(Array.isArray(e))if(e.length===1)g=h=i=j=e[0];else if(e.length===2)g=h=e[0],i=j=e[1];else{if(e.length!==4){f.rect(a,b,c,d);return}g=e[0],h=e[1],i=e[2],j=e[3]}else g=h=i=j=e;var k=a+c,l=b+d,m=c<d?c*2:d*2;g=g<m?g:m,h=h<m?h:m,i=i<m?i:m,j=j<m?j:m;var n=j*.292893218813453,o=j*.585786437626905;f.moveTo(k,l-j),f.quadraticCurveTo(k,l-o,k-n,l-n),f.quadraticCurveTo(k-o,l,k-j,l),n=i*.292893218813453,o=i*.585786437626905,f.lineTo(a+i,l),f.quadraticCurveTo(a+o,l,a+n,l-n),f.quadraticCurveTo(a,l-o,a,l-i),n=g*.292893218813453,o=g*.585786437626905,f.lineTo(a,b+g),f.quadraticCurveTo(a,b+o,a+n,b+n),f.quadraticCurveTo(a+o,b,a+g,b),n=h*.292893218813453,o=h*.585786437626905,f.lineTo(k-h,b),f.quadraticCurveTo(k-o,b,k-n,b+n),f.quadraticCurveTo(k,b+o,k,b+h),f.lineTo
(k,l-j)};var ee=function(a){return g?a instanceof g||a instanceof l:a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement},fe={},ge=function(a){return fe[a]},he=function(a,b){typeof b=="function"&&(fe[a]=b)},ie=function(a){return Rd[a]},je=function(a,b){typeof b=="function"&&Td.indexOf(a)<0&&(Rd[a]=b)};(function(){var b=["webkit","moz"];for(var c=0;c<b.length&&!a.requestAnimationFrame;++c){var d=b[c];a.requestAnimationFrame=a[d+"RequestAnimationFrame"],a.cancelAnimationFrame=a[d+"CancelAnimationFrame"]||a[d+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(a.navigator.userAgent)||!a.requestAnimationFrame||!a.cancelAnimationFrame){var e=0;a.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(e+16,b);return setTimeout(function(){a(e=c)},c-b)},a.cancelAnimationFrame=clearTimeout}})();var me=c.Animate=function(a){var b=this;b.type=a.type==null?"number":a.type,b.delay=a.delay==null?0:a.delay,b.dur=a.dur==null?1e3:a.dur,b.interval=a.interval==null?0:a.interval,b.finish=a.finish==null?b.delay+b.dur+b.interval:a.finish,a.finish==null?b.finish=b.delay+b.dur+b.interval:(b.finish=a.finish,b.interval=b.finish-b.delay-b.dur),b.repeat=a.repeat==null?1:a.repeat,b.reverse=a.reverse==null?!0:a.reverse,b.easing=a.easing==null?"easeNone":a.easing,b.onUpdate=a.onUpdate,b.onDone=a.onDone,b.onStop=a.onStop,b.onPlay=a.onPlay,b.attr=a.attr,b.source=a.source,b.filter=a.filter,b.from=a.from,b.to=a.to,b.start=null,b.time=0,b.total=0,b.count=0,b.started=!1,b.stopped=!1,b.paused=!1,b.pausedTime=null,b.pausedTotal=0,b._speed=1,b._oldSpeed=null,b._speedTotal=0,b._speedTime=null,b._percent=0,b._percentSet=null,b._percentDiff=0,b.id=ye++};d.ext("twaver.Animate",Object,{play:function(){return ne(this)},stop:function(a){return oe(this,a)},pause:function(){this.stopped||(this.paused=!0)},resume:function(){this.paused&&(this.paused=!1,ze=!0)},isPaused:function(){return this.paused},percent:function(a){return a==null?this._percentSet||this._percent:(this._percentSet=a<0?0:a>100?100:a,this.paused&&(ze=!0),this.started||(this.play(),this.pause()),this)},speed:function(a){return a==null?this._speed:(a=a<0?1:a,a!==this.speed&&(this.stopped||(this._oldSpeed=this._speed),this._speed=a),this)},clone:function(){return new me(this)},chain:function(a){var b=this,c;return b.next=a,a.pre=b,b.onDone?(c=b.onDone,b.onDone=function(){c.call(b),a.play()}):b.onDone=function(){a.play()},b}});var xe={},ye=1,ze=!1;(function Wg(a){requestAnimationFrame(Wg),ze&&(ze=!1,se(a))})(0);var Ae={easeNone:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeBoth:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInStrong:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutStrong:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeBothStrong:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},elasticIn:function(a,b,c,d,e,f){var g;return a===0?b:(a/=d)===1?b+c:(f||(f=d*.3),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f))+b)},elasticOut:function(a,b,c,d,e,f){var g;return a===0?b:(a/=d)===1?b+c:(f||(f=d*.3),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin((a*d-g)*2*Math.PI/f)+c+b)},elasticBoth:function(a,b,c,d,e,f){var g;return a===0?b:(a/=d/2)===2?b+c:(f||(f=d*.3*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),a<1?-0.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)*.5+c+b)},backIn:function(a,c,d,e,f){return f===b&&(f=1.70158),a===e&&(a-=.001),d*(a/=e)*a*((f+1)*a-f)+c},backOut:function(a,b,c,d,e){return typeof e=="undefined"&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backBoth:function(a,b,c,d,e){return typeof e=="undefined"&&(e=5.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},bounceIn:function(a,b,c,d){return c-Ae.bounceOut(d-a,0,c,d)+b},bounceOut:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceBoth:function(a,b,c,d){return a<d/2?Ae.bounceIn(a*2,0,c,d)*.5+b:Ae.bounceOut(a*2-d,0,c,d)*.5+c*.5+b}},Be={draw:function(a,b){var c=b.getCurrentSubNetwork()==null?b.getElementBox():b.getCurrentSubNetwork(),d=c.getStyle("background.type");d!="none",d=="image"?this.drawImage(a,c,b):d=="vector"?this.drawVector(a,c):d=="image.vector"?(this.drawImage(a,c,b),this.drawVector(a,c)):d=="vector.image"&&(this.drawVector(a,c),this.drawImage(a,c,b))},drawImage:function(a,b,c){var e=b.getStyle("background.image"),f=d.getImageAsset(e);if(f==null)return;var g={x:0,y:0,width:a.canvas.width,height:a.canvas.height};b.getStyle("background.image.stretch")=="none"&&(g.width=f.getWidth(),g.height=f.getHeight());var h=b.getStyle("background.image.padding");h&&p.grow(g,h,h);if(b.getStyle("background.image.stretch")=="tile"){if(ee(f.getImage()))for(var i=0;i<g.width;i+=f.getWidth())for(var j=0;j<g.height;j+=f.getHeight())a.drawImage(f.getImage(),i,j)}else(b.getStyle("background.image.stretch")=="fill"||b.getStyle("background.image.stretch")=="none")&&Od(a,f.getImage(),null,g,b,c)},drawVector:function(a,b){var c={x:0,y:0,width:a.canvas.width,height:a.canvas.height},d=b.getStyle("background.outline.width"),e=b.getStyle("background.outline.color"),f=b.getStyle("background.vector.fill"),g=b.getStyle("background.vector.fill.color"),h=b.getStyle("background.vector.padding"),i=b.getStyle("background.vector.shape"),j=b.getStyle("background.vector.pattern");h&&p.grow(c,h,h);var k=b.getStyle("background.vector.gradient");f&&(k?t.fill(a,g,k,b.getStyle("background.vector.gradient.color"),c):a.fillStyle=g,t.drawVector(a,i,j,c),a.fill()),d>0&&(a.lineWidth=d,a.strokeStyle=b.getStyle("background.outline.color"),t.drawVector(a,i,j,c),a.stroke())}};c.Pool=function(a,b){typeof a=="string"?this.func=function(){return k.createElement(a)}:this.func=a,this.tagName=a,b!=null&&(this.redundancy=b)},d.ext("twaver.Pool",Object,{redundancy:2,currentIndex:-1,get:function(){this.currentIndex++;if(this.currentIndex===this.size()){var a=this.func();return a._pool=this,a.style.margin="0px",a.style.padding="0px",this.list||(this.list=new Ce),this.list.add(a),a}return this.list.get(this.currentIndex)},release:function(a){this.list&&this.list.remove(a)>=0&&(delete a._selectData,delete a._expandData,delete a._checkData,delete a._editInfo,delete a.keepDefault,a.style.margin="0px",a.style.padding="0px",a.style.backgroundColor="",a.removeAttribute("title"),this.tagName==="img"&&a.removeAttribute&&(a.removeAttribute("width"),a.removeAttribute("height"),a.removeAttribute("src")),this.list.add(a),this.currentIndex--)},reset:function(){this.currentIndex=-1},clear:function(){if(this.list)while(this.redundancy+this.currentIndex<this.list.size()-1)delete this.list.removeAt(this.list.size()-1)._pool},size:function(){return this.list?this.list.size():0}}),c.Util={getVersion:function(){return"5.1.13"},registerImage:function(a,b,c,e,f){d.registerImage(a,b,c,e,f)},getRegisteredImageNames:function(){return d.getRegisteredImageNames()},unregisterImage:function(a){d.unregisterImage(a)},getImageAsset:function(a){return d.getImageAsset(a)},validateLicense:function(a){d.validateLicense(a)},getLicense:function(){return f},isPermissionGIS:function(){return ud()},moveElements:function(a,b,d,e,f){if(b===0&&d===0)return;if(!a||a.isEmpty())return;var g=c.animate.AnimateManager,h,i;g.endAnimate(),a=wd.filterMovingElements(a),e&&(h=new Ce,i=new Ce),a.forEach(function(a){a instanceof Ze&&(e?(h.add(a),i.add({x:a.getX()+b,y:a.getY()+d})):a.translate(b,d))}),e?g.start(new c.animate.AnimateLocation(h,i,f)):f&&f()},isTypeOf:function(a,b){if(a===b)return!0;var c=a.superClass;while(c){if(c===b.prototype)return!0;c=c.constructor.superClass}return!1},setFocus:function(a){if(k.activeElement===a)return;var b,c,d=k.documentElement,e=k.body,f;d&&(m.isIE||m.isOpera||d.scrollLeft||d.scrollTop)?(b=d.scrollLeft,c=d.scrollTop,f=d):e&&(b=e.scrollLeft,c=e.scrollTop,f=e),a.focus(),f&&(f.scrollLeft=b,f.scrollTop=c)},isOpera:m.isOpera,isIE:m.isIE,isFirefox:m.isFirefox,isChrome:m.isChrome,isSafari:m.isSafari,isIPhone:m.isIPhone,isIPod:m.isIPod,isIPad:m.isIPad,isAndroid:m.isAndroid,isWebOS:m.isWebOS,isTouchable:m.isTouchable,ext:function(a,b,c){d.ext(a,b,c)},getValue:function(a,b,c){return d.getValue(a,b,c)},setValue:function(a,b,c){d.setValue(a,b,c)},grow:function(a,b,c){p.grow(a,b,c)},containsPoint:function(a,b,c){return p.containsPoint.apply(null,arguments)},intersects:function(a,b){return p.intersects(a,b)},getRect:function(a){return p.getRect(a)},unionRect:function(a,b){return p.unionRect(a,b)},createDiv:function(){return s.createDiv()},createCanvas:function(){return s.createCanvas()},setCanvas:function(a,b,c,d,e){return s.setCanvas.apply(null,arguments)},drawVector:function(a,b,c,d,e,f,g){t.drawVector.apply(null,arguments)},fill:function(a,b,c,d,e,f,g,h){t.fill.apply(null,arguments)},getClass:function(a){return d.getClass(a)},getAllClassNames:function(){var a=[],b;for(b in d.classCache)a.push(b);return a},newInstance:function(a){return d.newInstance.apply(null,arguments)},isDeserializing:function(){return d.isDeserializing},addEventListener:function(a,b,c,d){s.addEventListener(a,b,c,d)},removeEventListener:function(a,b,c){s.removeEventListener(a,b,c)},drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l){De.drawArrow.apply(null,arguments)},calculatePointAngleAlongLine:function(a,b,c,d,e){return p.calculatePointInfoAlongLineBySegments(a,b,c,d,e)},getSubNetwork:function(a){return wd.getSubNetwork(a)},transformPoint:function(a,b,c,d){return p.transformPoint(a,b,c,d)},getToolTipDiv:function(){return Cd.getToolTipDiv()},showToolTip:function(a,b){Cd.showToolTip(a,b)},hideToolTip:function(){Cd.hideToolTip()},resetToolTip:function(){Cd.resetToolTip()},setCSSStyle:function(a,b,c){s.setCSSStyle(a,b,c)},removeCSSStyle:function(a,b){s.removeCSSStyle(a,b)},getCSSStyle:function(a,b){return s.getCSSStyle(a,b)},toDegrees:function(a){return p.toDegrees(a)},toRadians:function(a){return p.toDegrees(a)},getRadiansBetweenLines:function(a,b){return p.getRadiansBetweenLines(a,b)},getElementsBounds:function(a,b){var d=null;return a.forEach(function(a){if(a.getRect){var e,f;b&&(f=b.getElementUI(a),f&&(e=f.getViewRect())),e||(e=a.getRect()),d?d=c.Util.unionRect(d,e):d=e}}),d},getPointIndex:function(a,b,c){c||(c=10);if(a)for(var d=a.size();d--;d>=0)if(p.getDistance(a.get(d),b)<=c)return d;return-1},registerVectorShape:function(a,b){d.g["_"+a]=b},rotateCanvas:function(a,b,c){a.translate(b.x+b.width/2,b.y+b.height/2),a.rotate(c*Math.PI/180),a.translate(-(b.x+b.width/2),-(b.y+b.height/2))},registerShape:function(a,b){je(a,b)},registerDraw:function(a,b){he(a,b)},getFilterColor:function(a,b){return Ie(a,b)},registerGifImage:function(a,b){var d=arguments,e=new XMLHttpRequest;e.overrideMimeType("text/plain; charset=x-user-defined"),e.onload=function(b){var f=new Ue(e.response),g=new Ve(f);g.doParse();var h=setInterval(function(){if(g.loaded){clearInterval(h),c.Util.registerImage(a,g);for(var b=2;b<d.length;b++){var e=d[b];e.invalidateElementUIs&&e.invalidateElementUIs(),e.invalidateDisplay&&e.invalidateDisplay()}}},10)},e.open("POST",b,!0),e.send()},parseVectorData:function(a){return Fd(a)},getSharedLinks:function(a,b){var c=a.getLinks(),d=b.getLinks();if(c&&c.size()!=0&&d&&d.size()!=0){var e=c.size()>d.size()?c:d;return e.toList(function(c){return c.getFromNode()==a&&c.getToNode()==b||c.getFromNode()==b&&c.getToNode()==a})}return null},isSharedLinks:function(a,b){var c=!1,d=a.getLinks(),e=b.getLinks();if(d&&d.size()!=0&&e&&e.size()!=0){var f=d.size()>e.size()?d:e;f.forEach(function(d){return d.getFromNode()==a&&d.getToNode()==b||d.getFromNode()==b&&d.getToNode()==a?(c=!0,!1):!0})}return c},playAnimate:function(a){return ne(a)},pauseAnimate:function(a){a.pause()},resumeAnimate:function(a){a.resume()},stopAnimate:function(a,b){oe(a,b)},pauseAllAnimates:function(){qe()},resumeAllAnimates:function(){re()},stopAllAnimates:function(a){pe(a)},randomColor:function(){return"#"+("00000"+(Math.random()*16777216<<0).toString(16)).substr(-6)},getHSVColor:function(a,c,d){var e,f,g,h,i,j,k,l;a&&c===b&&d===b&&(c=a.s,d=a.v,a=a.h),h=Math.floor(a*6),i=a*6-h,j=d*(1-c),k=d*(1-i*c),l=d*(1-(1-i)*c);switch(h%6){case 0:e=d,f=l,g=j;break;case 1:e=k,f=d,g=j;break;case 2:e=j,f=d,g=l;break;case 3:e=j,f=k,g=d;break;case 4:e=l,f=j,g=d;break;case 5:e=d,f=j,g=k}var m="#"+toHex(e*255)+toHex(f*255)+toHex(g*255);return m},toHex:function(a){var b=parseInt(a).toString(16);return b.length==1&&(b="0"+b),b},makeHighRes:function(b){var c=b.getContext("2d"),d=a.devicePixelRatio||1,e=c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1,f=d/e;if(d!==e){var g=b.width,h=b.height;b.width=Math.round(g*f),b.height=Math.round(h*f),b.style.width=g+"px",b.style.height=h+"px",c.scale(f,f)}}},d.ext("twaver.Util",Object,{});var Ce=function(){this._as=[];if(arguments.length===1){var a=arguments[0];a instanceof Ce&&(a=a._as);if(a instanceof Array){var b=a.length;for(var c=0;c<b;c++)this._as.push(a[c])}else a!=null&&this._as.push(a)}else if(arguments.length>1){b=arguments.length;for(c=0;c<b;c++)this._as.push(arguments[c])}};c.List=Ce,d.ext("twaver.List",Object,{size:function(){return this._as.length},isEmpty:function(){return this._as.length===0},add:function(a,c){return c===b?this._as.push(a):this._as.splice(c,0,a)},addAll:function(a){a instanceof Ce&&(a=a._as);if(a instanceof Array){var b=a.length;for(var c=0;c<b;c++)this._as.push(a[c])}else this._as.push(a)},get:function(a){return this._as[a]},remove:function(a){var b=this._as.indexOf(a);return b>=0&&b<this._as.length&&this.removeAt(b),b},removeAt:function(a){return this._as.splice(a,1)[0]},set:function(a,b){return this._as[a]=b},clear:function(){return this._as.splice(0,this._as.length)},contains:function(a){return this.indexOf(a)>=0},indexOf:function(a){return this._as.indexOf(a)},forEach:function(a,b){var c=this._as.length;for(var d=0;d<c;d++){var e=this._as[d];b?a.call(b,e):a(e)}},forEachReverse:function(a,b){var c=this._as.length;for(var d=c-1;d>=0;d--){var e=this._as[d];b?a.call(b,e):a(e)}},toArray:function(a,b){if(a){var c=[],d=this._as.length;for(var e=0;e<d;e++){var f=this._as[e];b?a.call(b,f)&&c.push(f):a(f)&&c.push(f)}return c}return this._as.concat()},toList:function(a,b){if(a){var c=new Ce,d=this._as.length;for(var e=0;e<d;e++){var f=this._as[e];b?a.call(b,f)&&c.add(f):a(f)&&c.add(f)}return c}return new Ce(this)},sort:function(a){return a?this._as.sort(a):this._as.sort(),this},toString:function(){return this._as.toString()}});var De={shapeMap:{},init:function(){De.register("arrow.standard",De.createStandardArrow()),De.register("arrow.delta",De.createDeltaArrow()),De.register("arrow.diamond",De.createDiamondArrow()),De.register("arrow.short",De.createShortArrow()),De.register("arrow.slant",De.createSlantArrow())},createStandardArrow:function(){var a=new Ce;return a.add({x:-1,y:-5/9}),a.add({x:-0.75,y:0}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},createDeltaArrow:function(){var a=new Ce;return a.add({x:-1,y:-5/9}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},createDiamondArrow:function(){var a=new Ce;return a.add({x:-7/12,y:5/9}),a.add({x:-14/12,y:0}),a.add({x:-7/12,y:-5/9}),a.add({x:0,y:0}),a.add({x:-7/12,y:5/9}),a},createShortArrow:function(){var a=new Ce;return a.add({x:-8/12,y:6/9}),a.add({x:-5/12,y:0}),a.add({x:-8/12,y:-6/9}),a.add({x:0,y:0}),a.add({x:-8/12,y:6/9}),a},createSlantArrow:function(){var a=new Ce;return a.add({x:-1,y:-5/9}),a.add({x:-6.5/12,y:0}),a.add({x:-0.75,y:4/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),a},register:function(a,b){De.shapeMap[a]=b},getShape:function(a){if(a)return De.shapeMap[a];throw"shape type can't be null"},getArrowRect:function(a,b,c,d,e,f,g,h){var i=De.getShape(c);if(!i||i.size()<=0)return null;h&&(f*=h.getLocationZoom(),g*=h.getLocationZoom());var j=p.calculatePointInfoAlongLine(a,b,f,g),k=j.point,l=j.angle,m=i._as,n,q=m.length,r=new Ce,s,t;t=new o(d,0,0,e,k.x,k.y);for(n=0;n<q;n++)r.add(t.transform(m[n]));t=p.createMatrix(l+Math.PI,k.x,k.y);for(n=0;n<q;n++)s=r.get(n),s instanceof Ce&&(s=s._as),s instanceof Array?(s[0]=t.transform(s[0]),s[1]=t.transform(s[1])):r.set(n,t.transform(s));return p.getLineRect(r)},drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l){i=i||0,j=j||0,k=k||0;var m=k>=0&&l;if(!g&&!m)return;var n=De.getShape(f);if(!n||n.size()<=0)return;var o=p.calculatePointInfoAlongLine(d,e,i,j),q=o.point,r=o.angle;g&&(a.fillStyle=h),a.beginPath(),m&&(a.lineWidth=k,a.strokeStyle=l),De._drawArrow(a,n,r,q,b,c),g&&a.fill(),m&&a.stroke()},_drawArrow:function(a,b,c,d,e,f){b=b._as;var g,h=b.length,i=new Ce,j,k;k=new o(e,0,0,f,d.x,d.y);for(g=0;g<h;g++)i.add(k.transform(b[g]));i=i._as,k=p.createMatrix(c+Math.PI,d.x,d.y);var l=i[0];l=k.transform(l),a.moveTo(l.x,l.y);for(g=1;g<h;g++)j=i[g],j instanceof Ce&&(j=j._as),j instanceof Array?(j[0]=k.transform(j[0]),j[1]=k.transform(j[1]),a.quadraticCurveTo(j[0].x,j[0].y,j[1].x,j[1].y)):(j=k.transform(j),a.lineTo(j.x,j.y))},drawLinkArrow:function(a,b,c,d){if(c.size()<2)return;a._element.getStyle("arrow.from")&&De._drawFromArrow(a,b,c,d),a._element.getStyle("arrow.to")&&De._drawToArrow(a,b,c,d)},_drawFromArrow:function(a,b,c,d){var e=a._element,f=e.getStyle("arrow.from.fill"),g=e.getStyle("arrow.from.outline.width");if(f||g>=0){var h=e.getStyle("arrow.from.width"),i=e.getStyle("arrow.from.height"),j=e.getStyle("arrow.from.xoffset");if(j>0&&j<1){var k;a.getLineLength?k=a.getLineLength():k=a._element.getLineLength(),j*=k}else a.getLineLength&&(j+=De.calculateArrowXOffsetAtEdge(c,a,!0,d));var l=e.getStyle("arrow.from.yoffset"),m=e.getStyle("arrow.from.shape");j=a._network._edgeDetect?0:j,l=a._network._edgeDetect?0:l,d&&(j*=d.getLocationZoom(),l*=d.getLocationZoom()),De.drawArrow(b,h,i,c,!0,m,f,e.getStyle("arrow.from.color"),j,l,g,e.getStyle("arrow.from.outline.color"))}},_drawToArrow:function(a,b,c,d){var e=a._element,f=e.getStyle("arrow.to.fill"),g=e.getStyle("arrow.to.outline.width");if(f||g>=0){var h=e.getStyle("arrow.to.width"),i=e.getStyle("arrow.to.height"),j=e.getStyle("arrow.to.xoffset");if(j>0&&j<1){var k;a.getLineLength?k=a.getLineLength():k=a._element.getLineLength(),j*=k}else a.getLineLength&&(j+=De.calculateArrowXOffsetAtEdge(c,a,!1));var l=e.getStyle("arrow.to.yoffset"),m=e.getStyle("arrow.to.shape");d&&(j*=d.getLocationZoom(),l*=d.getLocationZoom()),j=a._network._edgeDetect?0:j,l=a._network._edgeDetect?0:l,De.drawArrow(b,h,i,c,!1,m,f,e.getStyle("arrow.to.color"),j,l,g,e.getStyle("arrow.to.outline.color"))}},calculateArrowXOffsetAtEdge:function(a,b,c,d){if(a==null||a.size()<2)return 0;var e=b._element,f=c?e.getStyle("arrow.from.at.edge"):e.getStyle("arrow.to.at.edge");if(!f)return 0;var g=c?b._network.getElementUI(e.getFromAgent()):b._network.getElementUI(e.getToAgent());if(!g)return 0;if(d)var h=g.getZoomBodyRect();else var h=g._bodyRect;if(h==null)return 0;var i=p._getPoint(a.get(c?0:a.size()-1)),j=0,k=b.getLineLength();while(De._containsByInt(h,Math.floor(i.x),Math.floor(i.y),!1)&&j<k)i=p.calculatePointInfoAlongLine(a,c,j++).point;return j},_containsByInt:function(a,c,d,e){return e=e===b?!0:e,e?c>=Math.floor(a.x)&&c<=Math.floor(a.x+a.width)&&d>=Math.floor(a.y)&&d<=Math.floor(a.y+a.height):c>Math.floor(a.x)&&c<Math.floor(a.x+a.width)&&d>Math.floor(a.y)&&d<Math.floor(a.y+a.height)}};De.init(),d.arrow=De,c.EventDispatcher=function(){},d.ext("twaver.EventDispatcher",null,{contains:function(a,b){if(this._ls)for(var c=0,d=this._ls.size(),e;c<d;c++){e=this._ls.get(c);if(a===e.l&&b===e.s)return!0}return!1},add:function(a,b,c){var d={l:a,s:b,a:c};this._ls||(this._ls=new Ce),this._f?(this._addPendings||(this._addPendings=new Ce),this._addPendings.add(d)):d.a?this._ls.add(d,0):this._ls.add(d)},remove:function(a,b){this._ls&&(this._f?(this._removePendings||(this._removePendings=new Ce),this._removePendings.add({l:a,s:b})):this._remove(a,b))},_remove:function(a,b){for(var c=0,d=this._ls.size(),e;c<d;c++){e=this._ls.get(c);if(e.l===a&&e.s===b){this._ls.removeAt(c);return}}},fire:function(a){if(this._ls){var b,c=this._ls.size(),d;this._f=!0;for(b=0;b<c;b++)d=this._ls.get(b),d.s?d.l.call(d.s,a):d.l(a);this._f=!1;if(this._removePendings){c=this._removePendings.size();for(b=0;b<c;b++)d=this._removePendings.get(b),this._remove(d.l,d.s);delete this._removePendings}if(this._addPendings){c=this._addPendings.size();for(b=0;b<c;b++)d=this._addPendings.get(b),d.a?this._ls.add(d,0):this._ls.add(d);delete this._addPendings}}}}),c.ImageAsset=function(a,b,c,d,e){this._name=a,this._width=c,this._height=d,this._svg=e,this._edgeData,typeof b=="string"?this._src=b:typeof b=="function"?this._func=b:ee(b)?this._image=b:typeof b=="object"&&(this._image=b,this._width=b.w||b.width,this._height=b.h||b.height,b.cache!==!1&&Oe(b)&&(Me(a,b),this._cache=Re(b)))},d.ext("twaver.ImageAsset",Object,{getName:function(){return this._name},getSrc:function(){return this._src},isSvg:function(){return this._svg},getImage:function(a,b,c){if(!a||!this._image)return this._image;this._map||(this._map={});var d;this._svg&&arguments.length===3?d=a+","+b+","+c:d=a;var e=this._map[d];return e?e:(e=Je(this._cache||this._image,He(a),this._svg?b:this.getWidth(),this._svg?c:this.getHeight()),this._map[d]=e,e)},getWidth:function(){return this._width},getHeight:function(){return this._height},getFunction:function(){return this._func},_createEdgeData:function(a){var b=300,c=b/a.width;a.height<a.width&&(c=b/a.height);var d=Math.floor(a.width*c),e=Math.floor(a.height*c);this.tempCanvas||(this.tempCanvas=k.createElement("canvas"),this.ctx=this.tempCanvas.getContext("2d")),this.tempCanvas.width=d,this.tempCanvas.height=e,this.ctx.clearRect(0,0,d,e),this.ctx.drawImage(a,0,0,d,e);var f=this.ctx.getImageData(0,0,d,e),g=!0,h=[];for(var i=0,j=d,l=e;i<l;i++)for(var m=0;m<j;m++){var n=(i*j+m)*4,o=this._isTransparentPoint(f.data,n),p=g!=o||!o&&(m==0||m==j-1);if(p){var q=o?1:0;h.push({x:m-q,y:i})}g=o}g=!0;for(var m=0,j=d,l=e;m<j;m++)for(var i=0;i<l;i++){var n=(i*j+m)*4,o=this._isTransparentPoint(f.data,n),p=g!=o||!o&&(i==0||i==l-1);if(p){var q=o?1:0;h.push({x:m,y:i-q})}g=o}var r=j/2,s=l/2,t=[];for(var u=0;u<360;u++)t.push({x:r,y:s,dist:0});for(var u=0,v=h.length;u<v;u++){var w=h[u],x=this._getPointAngleDegree(w.x,w.y,r,s),y=this._getPointDist(w.x,w.y,r,s);t[x].dist<y&&(t[x]={x:w.x,y:w.y,dist:y})}for(var u=0,v=t.length;u<v;u++){var p=t[u];p.x=p.x/c,p.y=p.y/c,delete p.dist}return t},_isTransparentPoint:function(a,b){return a[b]+a[b+1]+a[b+2]+a[b+3]==0},_getPointAngleDegree:function(a,b,c,d){var e=c-a,f=d-b,g=Math.atan2(f,e);return g=g/Math.PI*180,g=parseInt(g)+180,g%=360,g},_getPointDist:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)}});var Ee={},Fe=s.createCanvas();Fe.width=1,Fe.height=1;var Ge=Fe.getContext("2d"),He=function(a){a=a||"black";var b=Ee[a],c;return b||(Ge.clearRect(0,0,1,1),Ge.fillStyle=a,Ge.fillRect(0,0,1,1),c=Ge.getImageData(0,0,1,1).data,b=Ee[a]={r:c[0],g:c[1],b:c[2],a:c[3]}),b},Ie=function(a,b){if(!b)return a;b=He(b),a=He(a);var c=a.r*.3+a.g*.59+a.b*.11;return"rgba("+Math.floor(b.r*c/255)+","+Math.floor(b.g*c/255)+","+Math.floor(b.b*c/255)+","+a.a+")"},Je=function(a,b,c,d){var e=s.createCanvas(c,d),f=e.getContext("2d");f.drawImage(a,0,0,c,d);try{var g=f.getImageData(0,0,c,d),h=g.data;for(var i=0,j=h.length;i<j;i+=4){var k=h[i+0]*.3+h[i+1]*.59+h[i+2]*.11;h[i+0]=Math.floor(b.r*k/255),h[i+1]=Math.floor(b.g*k/255),h[i+2]=Math.floor(b.b*k/255)}f.putImageData(g,0,0)}catch(l){return a}return e},Ke={},Le=function(a,b){if(a){var c=typeof a;c==="string"&&(a.match(Zd)||d.images[a]||(Ke[a]||(Ke[a]=[])).push(b))}},Me=function(a,b){b.pattern&&Le(b.pattern,a),b.v&&b.v.forEach(function(b){b.pattern&&Le(b.pattern,a)})},Ne=function(a){var b=Ke[a];b&&(b.forEach(function(a){var b=d.images[a];b._cache=Re(b._image)}),delete Ke[a])},Oe=function(a){return!a.w||!a.h?!1:Pe(a)},Pe=function(a){return!Object.keys(a).some(function(b){if(/^on/.test(b))return!1;var c=a[b],e=Qe(c);return!e&&b==="v"&&(e=c.some(function(a){if(a.shape==="draw")return!0;if(a.shape==="vector"){var b=d.images[a.name];if(b&&!b._cache)return!0}var c=Object.keys(a).some(function(b){return b==="state"||b==="animate"?!0:Qe(a[b])});return c?!0:a.shape==="g"&&a.v&&a.v.length?!Pe(a):!1})),e})},Qe=function(a){var b=typeof a;return b==="string"&&a.match(Zd)||b==="function"},Re=function(a){var b=s.createCanvas(a.w,a.h),c=b.getContext("2d");return Pd(c,a,null,{x:0,y:0,width:a.w,height:a.h}),b},Se={COLORS:["#6495ED","#FFFF00","#00FFFF","#FF0000","#7FFF00","#E0A580","#5FC0CB","#FA00F0","#A1BC50","#FFD700","#4169E1","#E5A5F5","#1E90FF","#696969","#FF6347","#00BFEF","#FFD700","#80E090","#5F9EA0","#A000FF","#7FAF00","#228BA2","#FF00FF","#7FFFD4","#800000","#0000CD","#20B2AA","#D2691E","#6495BD","#DC143C","#F0A8AF","#008B8B","#800080","#B8860B","#4B0082","#00FF00","#FFA500","#FF4500","#FFFF00","#9ACD32","#00008B","#FF1493","#ADFF2F","#4682B4","#00C0B1"],CALL_LATER_DELAY:17,SCROLL_BAR_WIDTH:17,SELECT_COLOR:"#C2CFF1",FOCUS_ON_CLICK:!0,VIEW_POSITION:"absolute",VIEW_FONT_SIZE:"12px",VIEW_FONT_FAMILY:"arial, tahoma, helvetica, sans-serif",TOOLTIP_BACKGROUND:"lightyellow",TOOLTIP_FONT_SIZE:"12px",TOOLTIP_COLOR:"black",TOOLTIP_PADDING:"4px 8px",TOOLTIP_BORDER:"1px solid gray",TOOLTIP_BORDER_RADIUS:"6px",TOOLTIP_XOFFSET:12,TOOLTIP_YOFFSET:12,TOOLTIP_BOX_SHADOW:"0px 0px 3px #AAA",TOOLTIP_ZINDEX:1e5,TOOLTIP_INITIAL_DELAY:750,TOOLTIP_RESHOW_DELAY:500,TOOLTIP_DISMISS_DELAY:4e3,ZOOM_MAX:5,ZOOM_MIN:.1,ZOOM_INCREMENT:1.3,ZOOM_ANIMATE:!0,COLUMN_INNER_TEXT:!0,COLUMN_WIDTH:80,COLUMN_HORIZONTAL_ALIGN:"",COLUMN_PROPERTY_TYPE:"accessor",COLUMN_VALUE_TYPE:"string",COLUMN_EDITABLE:!1,COLUMN_SORTABLE:!0,COLUMN_VISIBLE:!0,COLUMN_RESIZABLE:!0,COLUMN_MOVABLE:!0,COLUMN_RENDER_CELL:null,COLUMN_RENDER_HEADER:null,PROPERTY_INNER_TEXT:!0,PROPERTY_HORIZONTAL_ALIGN:"",PROPERTY_PROPERTY_TYPE:"accessor",PROPERTY_VALUE_TYPE:"string",PROPERTY_EDITABLE:!1,PROPERTY_CATEGORY_NAME:null,PROPERTY_RENDER_NAME:null,PROPERTY_RENDER_VALUE:null,PROPERTY_RENDER_EDITOR:null,TAB_WIDTH:100,TAB_CLOSABLE:!1,TAB_RESIZABLE:!0,TAB_MOVABLE:!0,TAB_DISABLED:!1,TAB_VISIBLE:!0,ACCORDION_EXPAND_ICON:"expand_icon",ACCORDION_COLLAPSE_ICON:"collapse_icon",ACCORDION_TITLE_HEIGHT:20,ACCORDION_TITLE_BACKGROUND:"#EBEBEB",ACCORDION_BORDER_BOTTOM_COLOR:"lightgray",ACCORDION_ICON_POSITION:"left",TITLEPANE_TITLE_HEIGHT:20,TITLEPANE_TITLE_BACKGROUND:"#DDD",TITLEPANE_TITLE_HORIZONTAL_ALIGN:"left",BORDERPANE_HGAP:0,BORDERPANE_VGAP:0,CHARTPANE_TITLE_HEIGHT:20,CHARTPANE_TITLE_HORIZONTAL_ALIGN:"center",CHARTPANE_LEGEND_ORIENTATION:"bottom",CHARTPANE_LEGEND_WIDTH:80,LEGENDPANE_ICON_WIDTH:10,LEGENDPANE_ICON_HEIGHT:10,LEGENDPANE_ICON_RADIUS:0,LEGENDPANE_ROW_HEIGHT:20,LEGENDPANE_ORIENTATION:"horizontal",LEGENDPANE_HIDDEN_COLOR:"#BABBBC",LEGENDPANE_SELECT_BACKGROUND_COLOR:"#00007D",LEGENDPANE_SELECT_FOREGROUND_COLOR:"#FFFFFF",CHART_TOOLTIP_ENABLED:!0,CHART_SELECT_TOLERANCE:0,CHART_XGAP:6,CHART_YGAP:6,CHART_XZOOM_ENABLED:!0,CHART_YZOOM_ENABLED:!0,CHART_XTRANSLATE_ENABLED:!0,CHART_YTRANSLATE_ENABLED:!0,CHART_DOUBLE_CLICK_TO_RESET:!0,CHART_VALUE_VISIBLE:!0,CHART_VALUE_FONT:null,CHART_BACKGROUND_VISIBLE:!1,CHART_BACKGROUND_FILL:!0,CHART_BACKGROUND_FILL_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_OUTLINE_WIDTH:1,CHART_BACKGROUND_OUTLINE_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_GRADIENT:"linear.north",CHART_BACKGROUND_GRADIENT_COLOR:"#FFFFFF",PIECHART_TYPE:"oval",PIECHART_START_ANGLE:0,PIECHART_SELECT_OFFSET:5,PIECHART_SHADOW_OFFSET:1,PIECHART_SHADOW_COLOR:"#C2CFF1",PIECHART_LINE_RATE:.5,PIECHART_DONUT_RATE:.5,PIECHART_VALUE_POSITION:.5,BARCHART_TYPE:"default",BARCHART_UPPER_LIMIT:null,BARCHART_LOWER_LIMIT:0,BARCHART_XAXIS_LINE_COLOR:"#808080",BARCHART_XAXIS_LINE_WIDTH:1,BARCHART_XAXIS_TEXT_COLOR:"#000000",BARCHART_XAXIS_TEXT_FONT:null,BARCHART_YAXIS_LINE_COLOR:"#808080",BARCHART_YAXIS_LINE_WIDTH:1,BARCHART_YAXIS_TEXT_COLOR:"#000000",BARCHART_YAXIS_TEXT_FONT:null,BARCHART_XSCALE_TEXT_FONT:null,BARCHART_XSCALE_TEXT_COLOR:"#000000",BARCHART_XSCALE_TEXT_ORIENTATION:"horizontal",BARCHART_YSCALE_TEXT_VISIBLE:!0,BARCHART_YSCALE_TEXT_COLOR:"#000000",BARCHART_YSCALE_TEXT_FONT:null,BARCHART_YSCALE_LINE_COLOR:"#808080",BARCHART_YSCALE_LINE_WIDTH:.3,BARCHART_YSCALE_VALUE_GAP:0,BARCHART_YSCALE_PIXEL_GAP:20,BARCHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_INTERRUPTABLE:!0,LINECHART_UPPER_LIMIT:null,LINECHART_LOWER_LIMIT:null,LINECHART_XAXIS_LINE_COLOR:"#808080",LINECHART_XAXIS_LINE_WIDTH:1,LINECHART_XAXIS_TEXT_COLOR:"#000000",LINECHART_XAXIS_TEXT_FONT:null,LINECHART_YAXIS_LINE_COLOR:"#808080",LINECHART_YAXIS_LINE_WIDTH:1,LINECHART_YAXIS_TEXT_COLOR:"#000000",LINECHART_YAXIS_TEXT_FONT:null,LINECHART_XSCALE_TEXT_FONT:null,LINECHART_XSCALE_TEXT_COLOR:"#000000",LINECHART_XSCALE_TEXT_ORIENTATION:"horizontal",LINECHART_XSCALE_LINE_COLOR:"#808080",LINECHART_XSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_TEXT_VISIBLE:!0,LINECHART_YSCALE_TEXT_COLOR:"#000000",LINECHART_YSCALE_TEXT_FONT:null,LINECHART_YSCALE_LINE_COLOR:"#808080",LINECHART_YSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_VALUE_GAP:0,LINECHART_YSCALE_PIXEL_GAP:20,LINECHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_VALUESPANCOUNT:1,BUBBLECHART_UPPER_LIMIT:null,BUBBLECHART_LOWER_LIMIT:null,BUBBLECHART_XAXIS_UPPER_LIMIT:null,BUBBLECHART_XAXIS_LOWER_LIMIT:null,BUBBLECHART_XAXIS_LINE_COLOR:"#808080",BUBBLECHART_XAXIS_LINE_WIDTH:1,BUBBLECHART_XAXIS_TEXT_COLOR:"#000000",BUBBLECHART_XAXIS_TEXT_FONT:null,BUBBLECHART_YAXIS_LINE_COLOR:"#808080",BUBBLECHART_YAXIS_LINE_WIDTH:1,BUBBLECHART_YAXIS_TEXT_COLOR:"#000000",BUBBLECHART_YAXIS_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_COLOR:"#000000",BUBBLECHART_XSCALE_TEXT_ORIENTATION:"horizontal",BUBBLECHART_XSCALE_LINE_COLOR:"#808080",BUBBLECHART_XSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_TEXT_VISIBLE:!0,BUBBLECHART_YSCALE_TEXT_COLOR:"#000000",BUBBLECHART_YSCALE_TEXT_FONT:null,BUBBLECHART_YSCALE_LINE_COLOR:"#808080",BUBBLECHART_YSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_VALUE_GAP:0,BUBBLECHART_YSCALE_PIXEL_GAP:20,BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_SELECT_SHADOW_COLOR:"#000000",BUBBLECHART_SELECT_SHADOW_OFFSET:3,RADARCHART_AXIS_TEXT_FONT:null,RADARCHART_AXIS_TEXT_COLOR:"#000000",RADARCHART_AXIS_TEXT_VISIBLE:!0,RADARCHART_SCALE_TEXT_FONT:null,RADARCHART_SCALE_TEXT_COLOR:"#000000",RADARCHART_SCALE_TEXT_VISIBLE:!0,RADARCHART_AXIS_VISIBLE:!0,RADARCHART_AXIS_LINE_COLOR:"#808080",RADARCHART_AXIS_LINE_WIDTH:3,RADARCHART_AXIS_START_ANGLE:0,RADARCHART_RING_VISIBLE:!0,RADARCHART_RING_TYPE:"line",RADARCHART_RING_LINE_COLOR:"#808080",RADARCHART_RING_LINE_WIDTH:1,RADARCHART_SCALE_COUNT:5,RADARCHART_SCALE_MAXVALUE:1,RADARCHART_SCALE_MINVALUE:0,RADARCHART_ANCHOR_VISIBLE:!0,RADARCHART_AREA_FILL:!0,RADARCHART_AREA_FILL_ALPHA:.2,RADARCHART_AREA_SELECT_FILL_ALPHA:.5,DIALCHART_UPPER_LIMIT:100,DIALCHART_LOWER_LIMIT:0,DIALCHART_START_ANGLE:0,DIALCHART_END_ANGLE:360,DIALCHART_INNER_RADIUS:.8,DIALCHART_COLOR_RANGE_FILL_COLOR:"#808080",DIALCHART_OUTLINE_WIDTH:0,DIALCHART_OUTLINE_COLOR:"#808080",DIALCHART_SCALE_INSIDE:!0,DIALCHART_MAJOR_SCALE_COUNT:11,DIALCHART_MAJOR_SCALE_LINE_WIDTH:2,DIALCHART_MAJOR_SCALE_LINE_LENGTH:8,DIALCHART_MAJOR_SCALE_LINE_COLOR:"#000000",DIALCHART_MINOR_SCALE_COUNT:4,DIALCHART_MINOR_SCALE_LINE_WIDTH:1,DIALCHART_MINOR_SCALE_LINE_LENGTH:4,DIALCHART_MINOR_SCALE_LINE_COLOR:"#000000",DIALCHART_SCALE_TEXT_VISIBLE:!0,DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_TEXT_FONT:null,DIALCHART_SCALE_TEXT_COLOR:"#000000",DIALCHART_PIVOT_RADIUS:10,DIALCHART_PIVOT_FILL:!0,DIALCHART_PIVOT_FILL_COLOR:"#808080",DIALCHART_PIVOT_OUTLINE_WIDTH:0,DIALCHART_PIVOT_OUTLINE_COLOR:"#808080",DIALCHART_VALUE_POSITION:.5,DIALCHART_INNER_DARKER_RADIUS:10,DIALCHART_OUTER_BRIGHTER_RADIUS:10,DIALCHART_SELECT_SHADOW_COLOR:"#000000",DIALCHART_SELECT_SHADOW_OFFSET:3,TABPANE_TAB_GAP:1,TABPANE_TAB_RADIUS:0,TABPANE_TAB_HEIGHT:24,TABPANE_TAB_ORIENTATION:"top",TABPANE_RESIZE_TOLERANCE:3,TABPANE_TAB_BACKGROUND:"#EBEBEB",TABPANE_DISABLED_COLOR:"#BABBBC",TABPANE_SELECT_BACKGROUND:"white",TABPANE_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABPANE_INSERT_BACKGROUND:"orange",TABPANE_HORIZONTAL_ALIGN:"center",TABPANE_CLOSE_ICON:"close_icon",TABPANE_SELECT_NEXT_ON_CLOSE:!0,TABPANE_SELECT_NEXT_ON_INVISIBLE:!0,LISTBASE_INNER_TEXT:!0,LIST_ROW_HEIGHT:19,LIST_INDENT:2,LIST_ROW_LINE_WIDTH:0,LIST_ROW_LINE_COLOR:"#DDD",LIST_MAKE_VISIBLE_ON_SELECTED:!0,LIST_KEYBOARD_REMOVE_ENABLED:!0,LIST_KEYBOARD_SELECT_ENABLED:!0,TREE_ROW_HEIGHT:19,TREE_INDENT:16,TREE_ROW_LINE_WIDTH:0,TREE_ROW_LINE_COLOR:"#DDD",TREE_MAKE_VISIBLE_ON_SELECTED:!0,TREE_KEYBOARD_REMOVE_ENABLED
:!0,TREE_KEYBOARD_SELECT_ENABLED:!0,TREE_EXPAND_ICON:"expand_icon",TREE_COLLAPSE_ICON:"collapse_icon",TREE_LINE_TYPE:"none",TREE_LINE_THICKNESS:2,TREE_LINE_COLOR:"#000000",TREE_LINE_ALPHA:1,TREE_LINE_DASH:[4,2],TREE_TOOLTIP_ENABLED:!0,TABLE_ROW_HEIGHT:19,TABLE_ROW_LINE_WIDTH:1,TABLE_ROW_LINE_COLOR:"#DDD",TABLE_COLUMN_LINE_WIDTH:1,TABLE_COLUMN_LINE_COLOR:"#DDD",TABLE_MAKE_VISIBLE_ON_SELECTED:!0,TABLE_KEYBOARD_REMOVE_ENABLED:!0,TABLE_KEYBOARD_SELECT_ENABLED:!0,TABLE_EDITABLE:!1,TABLEHEADER_HEIGHT:24,TABLEHEADER_RESIZE_TOLERANCE:3,TABLEHEADER_BACKGROUND:"#EBEBEB",TABLEHEADER_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABLEHEADER_INSERT_BACKGROUND:"orange",TABLEHEADER_COLUMN_LINE_COLOR:"#DDD",TABLEHEADER_SORT_DESC_ICON:"sort_desc",TABLEHEADER_SORT_ASC_ICON:"sort_asc",TABLEHEADER_SORT_ICON_POSITION:"98% 50%",TREETABLE_ROW_HEIGHT:19,TREETABLE_INDENT:16,TREETABLE_ROW_LINE_WIDTH:1,TREETABLE_ROW_LINE_COLOR:"#DDD",TREETABLE_COLUMN_LINE_WIDTH:1,TREETABLE_COLUMN_LINE_COLOR:"#DDD",TREETABLE_MAKE_VISIBLE_ON_SELECTED:!0,TREETABLE_KEYBOARD_REMOVE_ENABLED:!0,TREETABLE_KEYBOARD_SELECT_ENABLED:!0,TREETABLE_EXPAND_ICON:"expand_icon",TREETABLE_COLLAPSE_ICON:"collapse_icon",TREETABLE_EDITABLE:!1,PROPERTYSHEET_AUTO_ADJUSTABLE:!0,PROPERTYSHEET_INDENT:16,PROPERTYSHEET_ROW_HEIGHT:19,PROPERTYSHEET_ROW_LINE_WIDTH:1,PROPERTYSHEET_COLUMN_LINE_WIDTH:1,PROPERTYSHEET_BORDER_COLOR:"#EBEBEB",PROPERTYSHEET_EXPAND_ICON:"expand_icon",PROPERTYSHEET_COLLAPSE_ICON:"collapse_icon",PROPERTYSHEET_PROPERTY_NAME_WIDTH:100,PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN:"",PROPERTYSHEET_SUM_WIDTH:200,PROPERTYSHEET_RESIZE_TOLERANCE:3,PROPERTYSHEET_EDITABLE:!1,PROPERTYSHEET_CATEGORIZABLE:!0,PROPERTYSHEET_EXPAND_CATEGORY:!0,POPUPMENU_SUBNENU_ENABLE_ICON:"submenu_enable_icon",POPUPMENU_SUBNENU_DISABLE_ICON:"submenu_disable_icon",POPUPMENU_CHECKBOX_SELECTED_ICON:"checkbox_selected_icon",POPUPMENU_CHECKBOX_UNSELECTED_ICON:"checkbox_unselected_icon",POPUPMENU_RADIOBUTTON_SELECTED_ICON:"radiobutton_selected_icon",POPUPMENU_RADIOBUTTON_UNSELECTED_ICON:"radiobutton_unselected_icon",SPLITPANE_ORIENTATION:"horizontal",SPLITPANE_POSITION:.5,SPLITPANE_DIVIDER_WIDTH:6,SPLITPANE_DIVIDER_BACKGROUND:"#CCCCFF",SPLITPANE_DIVIDER_OPACITY:.5,SPLITPANE_MASK_BACKGROUND:"",NODE_WIDTH:50,NODE_HEIGHT:50,IMAGE_NODE:"node_image",IMAGE_GROUP:"group_image",IMAGE_SUBNETWORK:"subnetwork_image",ICON_DATABOX:"databox_icon",ICON_DATA:"data_icon",ICON_NODE:"node_icon",ICON_LINK:"link_icon",ICON_GROUP:"group_icon",ICON_SUBNETWORK:"subnetwork_icon",ICON_GRID:"grid_icon",ICON_BUS:"bus_icon",ICON_SHAPENODE:"shapenode_icon",ICON_SHAPELINK:"shapelink_icon",ICON_LINKSUBNETWORK:"linksubnetwork_icon",ICON_SHAPESUBNETWORK:"shapesubnetwork_icon",LAYER_DEFAULT_ID:"default",LAYER_DEFAULT_NAME:"default",ATTACHMENT_POINTER_LENGTH:10,ATTACHMENT_POINTER_WIDTH:8,ATTACHMENT_CORNER_RADIUS:5,ATTACHMENT_CONTENT_WIDTH:30,ATTACHMENT_CONTENT_HEIGHT:20,ATTACHMENT_POSITION:"topright.topright",ATTACHMENT_XOFFSET:0,ATTACHMENT_YOFFSET:0,ATTACHMENT_PADDING:0,ATTACHMENT_PADDING_LEFT:0,ATTACHMENT_PADDING_RIGHT:0,ATTACHMENT_PADDING_TOP:0,ATTACHMENT_PADDING_BOTTOM:0,ATTACHMENT_DIRECTION:"right",ATTACHMENT_FILL:!1,ATTACHMENT_FILL_COLOR:"#000000",ATTACHMENT_GRADIENT:null,ATTACHMENT_GRADIENT_COLOR:"#FFFFFF",ATTACHMENT_OUTLINE_WIDTH:-1,ATTACHMENT_OUTLINE_COLOR:"#000000",ATTACHMENT_CAP:"butt",ATTACHMENT_JOIN:"miter",ATTACHMENT_SHADOWABLE:!0,NETWORK_TOOLTIP_ENABLED:!0,NETWORK_SELECT_MODE:"mix",NETWORK_MAKE_VISIBLE_ON_SELECTED:!0,NETWORK_NO_AGENT_LINK_VISIBLE:!1,NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE:!1,NETWORK_SUBNETWORK_ANIMATE:!0,NETWORK_SENDTOTOP_ON_SELECTED:!0,NETWORK_KEYBOARD_REMOVE_ENABLED:!0,NETWORK_KEYBOARD_SELECT_ENABLED:!0,NETWORK_RECT_SELECT_ENABLED:!0,NETWORK_DOUBLECLICK_TO_SUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_UPSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_LINKBUNDLE:!0,NETWORK_DOUBLECLICK_TO_GROUPEXPAND:!0,NETWORK_SELECT_OUTLINE_COLOR:"#2877A8",NETWORK_SELECT_OUTLINE_WIDTH:1,NETWORK_SELECT_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_OUTLINE_COLOR:"#2877A8",NETWORK_LAZYMOVE_OUTLINE_WIDTH:1,NETWORK_LAZYMOVE_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_FILL:!0,NETWORK_LAZYMOVE_ANIMATE:!0,NETWORK_RESIZE_POINT_SIZE:3,NETWORK_RESIZE_POINT_FILL_COLOR:"#FFFFFF",NETWORK_RESIZE_POINT_OUTLINE_COLOR:"#000000",NETWORK_RESIZE_POINT_OUTLINE_WIDTH:1,NETWORK_RESIZE_LINE_COLOR:"#000000",NETWORK_RESIZE_LINE_WIDTH:1,NETWORK_RESIZE_ANIMATE:!0,NETWORK_EDIT_POINT_SIZE:3,NETWORK_EDIT_POINT_FILL_COLOR:"#FFFF00",NETWORK_EDIT_POINT_OUTLINE_COLOR:"#000000",NETWORK_EDIT_POINT_OUTLINE_WIDTH:1,NETWORK_EDIT_LINE_COLOR:"rgba(184,211,240,0.7)",NETWORK_EDIT_LINE_WIDTH:2,NETWORK_ROTATE_POINT_SIZE:5,NETWORK_ROTATE_POINT_FILL_COLOR:"#FFFF00",NETWORK_ROTATE_POINT_OFFSET:15,NETWORK_ROTATE_POINT_OUTLINE_WIDTH:1,NETWORK_ROTATE_POINT_OUTLINE_COLOR:"rgba(0,0,0,1)",NETWORK_ROTATE_SCALE_FILL_COLOR:"rgb(227,166,103)",NETWORK_ROTATE_SCALE_FONT_COLOR:"#FFFFFF",NETWORK_ROTATE_SCALE_WIDTH:30,NETWORK_ROTATE_SCALE_HEIGHT:20,NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION:!0,NETWORK_LINK_FLOW_STEPPING:3,NETWORK_LINK_FLOW_COLOR:"#FF0000",NETWORK_LINK_FLOW_INTERVAL:600,NETWORK_SELECTION_TOLERANCE:2,NETWORK_TRANSPARENT_SELECTION_ENABLE:!1,SHOW_ALARM_IN_ATTACHMENT_DIV:!0,SHOW_LABEL_IN_ATTACHMENT_DIV:!1,SHOW_LABEL2_IN_ATTACHMENT_DIV:!1,SHOW_ICON_IN_ATTACHMENT_DIV:!1,SHOW_EDIT_IN_ATTACHMENT_DIV:!1,OVERVIEW_FILL_COLOR:"rgba(184,211,240,0.4)",OVERVIEW_OUTLINE_COLOR:"#B8D3F0",OVERVIEW_OUTLINE_WIDTH:1,OVERVIEW_SELECT_COLOR:"#0000FF",OVERVIEW_SELECT_WIDTH:1,OVERVIEW_PADDING:1,OVERVIEW_ANIMATE:!0,OVERVIEW_MAX_PACKING_WIDTH:-1,OVERVIEW_MAX_PACKING_HEIGHT:-1,TOUCH_MOVE_THRESHOLD:5,TOUCH_RECT_SELECT_THRESHOLD:20,TOUCH_ZOOM_THRESHOLD:30,LINK_BUNDLE_AGENT_FUNCTION:null,IS_LINK_ADJUSTED_TO_BOTTOM:!1,ELEMENTUI_FUNCTION:function(a,b){var c=b.getElementUIClass();return c?new c(a,b):null},CANVASUI_FUNCTION:function(a,b){var c=b.getCanvasUIClass();return c?new c(a,b):null},VECTORUI_FUNCTION:function(a,b){var c=b.getVectorUIClass();return c?new c(a,b):null},KEEP_DEFAULT_FUNCTION:function(a){return a.target.keepDefault||a.target.getAttribute("keepDefault")?!0:a.target.parentNode&&(a.target.parentNode.keepDefault||a.target.parentNode.getAttribute("keepDefault"))?!0:a.shiftKey?!0:!1},SORT_FUNCTION:function(a,c){if(a===c)return 0;if(a==null&&c!=null)return 1;if(a!=null&&c==null)return-1;if(a==null&&c==null)return 0;var d=typeof a,e=typeof c,f;return d==="string"&&e==="string"&&(f=a.localeCompare(c)),d==="number"&&e==="number"&&(f=a-c),f===b&&(f=(""+a).localeCompare(""+c)),f>0?1:f<0?-1:0},CENTER_LOCATION:!1};(function(){var b=Se;if(a.OverrideTWaverDefaults)for(var c in OverrideTWaverDefaults)b[c]=OverrideTWaverDefaults[c];b.VIEW_FONT_SIZE&&b.VIEW_FONT_FAMILY?b.FONT=b.VIEW_FONT_SIZE+" "+b.VIEW_FONT_FAMILY:b.FONT=k.createElement("canvas").getContext("2d").font,b.CHART_VALUE_FONT||(b.CHART_VALUE_FONT="10px "+b.VIEW_FONT_FAMILY),b.BARCHART_XSCALE_TEXT_FONT||(b.BARCHART_XSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.BARCHART_YSCALE_TEXT_FONT||(b.BARCHART_YSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.BARCHART_XAXIS_TEXT_FONT||(b.BARCHART_XAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BARCHART_YAXIS_TEXT_FONT||(b.BARCHART_YAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.LINECHART_XSCALE_TEXT_FONT||(b.LINECHART_XSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.LINECHART_YSCALE_TEXT_FONT||(b.LINECHART_YSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.LINECHART_XAXIS_TEXT_FONT||(b.LINECHART_XAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.LINECHART_YAXIS_TEXT_FONT||(b.LINECHART_YAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_XAXIS_TEXT_FONT||(b.BUBBLECHART_XAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_YAXIS_TEXT_FONT||(b.BUBBLECHART_YAXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_XSCALE_TEXT_FONT||(b.BUBBLECHART_XSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.BUBBLECHART_YSCALE_TEXT_FONT||(b.BUBBLECHART_YSCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.RADARCHART_AXIS_TEXT_FONT||(b.RADARCHART_AXIS_TEXT_FONT="12px "+b.VIEW_FONT_FAMILY),b.RADARCHART_SCALE_TEXT_FONT||(b.RADARCHART_SCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY),b.DIALCHART_SCALE_TEXT_FONT||(b.DIALCHART_SCALE_TEXT_FONT="10px "+b.VIEW_FONT_FAMILY)})(),c.Defaults=Se,d.ext("twaver.Defaults",Object,{}),c.Colors={orange:"#EC6C00",orange_light:"#EF8200",orange_dark:"#EA5404",gray_light:"#666666",gray_dark:"#242424",green_light:"#57AB9A",green_dark:"#238475",blue_light:"#61B6D8",blue_dark:"#0089C1"},c.SerializationSettings=function(){var a=c.SerializationSettings;this.isDataBoxSerializable=a.isDataBoxSerializable,this.isLayerBoxSerializable=a.isLayerBoxSerializable,this.isStyleSerializable=a.isStyleSerializable,this.isClientSerializable=a.isClientSerializable,this.isImageSerializable=a.isImageSerializable,this._pm=d.clone(a._pm),this._sm=d.clone(a._sm),this._cm=d.clone(a._cm)},function(){var a=c.SerializationSettings;a.isDataBoxSerializable=!0,a.isLayerBoxSerializable=!0,a.isStyleSerializable=!0,a.isClientSerializable=!0,a.isImageSerializable=!0,a._pm={},a._sm={},a._cm={},a.setPropertyType=function(b,c){a._pm[b]=c},a.getPropertyType=function(b){return a._pm[b]},a.setStyleType=function(b,c){a._sm[b]=c},a.getStyleType=function(b){return a._sm[b]},a.setClientType=function(b,c){a._cm[b]=c},a.getClientType=function(b){return a._cm[b]}}(),d.ext("twaver.SerializationSettings",Object,{setPropertyType:function(a,b){this._pm[a]=b},getPropertyType:function(a){return this._pm[a]},setStyleType:function(a,b){this._sm[a]=b},getStyleType:function(a){return this._sm[a]},setClientType:function(a,b){this._cm[a]=b},getClientType:function(a){return this._cm[a]}}),c.Styles={_m:{},setStyle:function(a,b){b==null?delete c.Styles._m[a]:c.Styles._m[a]=b},getStyle:function(a){return c.Styles._m[a]},getStyleProperties:function(){return d.keys(c.Styles._m)}},function(){var a=function(a,b){c.SerializationSettings.setPropertyType(a,b)};a("name","cdata"),a("name2","cdata"),a("icon","string"),a("toolTip","cdata"),a("parent","data"),a("layerId","string"),a("alarmState","alarmstate"),a("image","string"),a("location","point"),a("width","number"),a("height","number"),a("expanded","boolean"),a("host","data"),a("fromNode","data"),a("toNode","data"),a("points","list.point"),a("segments","list.string"),a("angle","number"),a("visible","boolean"),a=function(a,b,d){d==null&&(b!=null?d=typeof b:d="string"),c.Styles.setStyle(a,b),c.SerializationSettings.setStyleType(a,d)},a("chart.color",null),a("chart.value",0),a("chart.values",null,"list.number"),a("chart.value.color","#000000"),a("chart.value.font",null),a("chart.line.width",2),a("chart.marker.size",6),a("chart.marker.shape","circle"),a("chart.bubble.shape","circle"),a("chart.names",null,"list.string"),a("chart.xaxis.values",null,"list.number"),a("chart.yaxis.values",null,"list.number"),a("dialchart.rear.extension",0),a("dialchart.base.width",5),a("dialchart.top.width",0),a("dialchart.radius",.8),a("inner.color",null),a("outer.shape","rectangle"),a("outer.color",null),a("outer.width",2),a("outer.padding",1),a("outer.padding.left",0),a("outer.padding.right",0),a("outer.padding.top",0),a("outer.padding.bottom",0),a("outer.cap","butt"),a("outer.join","miter"),a("shadow.color",null),a("shadow.xoffset",3),a("shadow.yoffset",3),a("shadow.blur",6),a("select.style","shadow"),a("select.color","rgba(0, 0, 0, 0.7)"),a("select.shape","rectangle"),a("select.width",2),a("select.padding",2),a("select.padding.left",0),a("select.padding.right",0),a("select.padding.top",0),a("select.padding.bottom",0),a("select.cap","butt"),a("select.join","miter"),a("whole.alpha",1),a("body.type","default"),a("network.label",null,"cdata"),a("image.padding",0),a("image.padding.left",0),a("image.padding.right",0),a("image.padding.top",0),a("image.padding.bottom",0),a("image.state",null),a("vector.shape","rectangle"),a("vector.fill",!0),a("vector.fill.color","#CCCCFF"),a("vector.outline.width",-1),a("vector.outline.pattern",null,"array.number"),a("vector.outline.color","#5B5B5B"),a("vector.gradient","none"),a("vector.gradient.color","#FFFFFF"),a("vector.padding",0),a("vector.padding.left",0),a("vector.padding.right",0),a("vector.padding.top",0),a("vector.padding.bottom",0),a("vector.cap","butt"),a("vector.join","miter"),a("vector.deep",0),a("group.shape","rectangle"),a("group.fill",!0),a("group.fill.color","#CCCCFF"),a("group.outline.width",-1),a("group.outline.color","#5B5B5B"),a("group.gradient","none"),a("group.gradient.color","#FFFFFF"),a("group.padding",5),a("group.padding.left",0),a("group.padding.right",0),a("group.padding.top",0),a("group.padding.bottom",0),a("group.cap","butt"),a("group.join","miter"),a("group.deep",1),a("label.alpha",1),a("label.color","#000000"),a("label.font",null),a("label.position","bottom.bottom"),a("label.direction","below"),a("label.corner.radius",0),a("label.pointer.length",0),a("label.pointer.width",8),a("label.xoffset",0),a("label.yoffset",2),a("label.padding",0),a("label.padding.left",0),a("label.padding.right",0),a("label.padding.top",0),a("label.padding.bottom",0),a("label.fill",!1),a("label.fill.color","#C0C0C0"),a("label.gradient","none"),a("label.gradient.color","#FFFFFF"),a("label.outline.width",-1),a("label.outline.color","#000000"),a("label.cap","butt"),a("label.join","miter"),a("label.shadowable",!0),a("label.align","center"),a("link.label.rotatable",!1),a("label2.alpha",1),a("label2.color","#000000"),a("label2.font",null),a("label2.position","top.top"),a("label2.direction","below"),a("label2.corner.radius",0),a("label2.pointer.length",0),a("label2.pointer.width",8),a("label2.xoffset",0),a("label2.yoffset",-2),a("label2.padding",0),a("label2.padding.left",0),a("label2.padding.right",0),a("label2.padding.top",0),a("label2.padding.bottom",0),a("label2.fill",!1),a("label2.fill.color","#C0C0C0"),a("label2.gradient","none"),a("label2.gradient.color","#FFFFFF"),a("label2.outline.width",-1),a("label2.outline.color","#000000"),a("label2.cap","butt"),a("label2.join","miter"),a("label2.shadowable",!0),a("link.label2.rotatable",!1),a("icons.names",null,"array.string"),a("icons.colors",null,"array.string"),a("icons.position",null,"array.string"),a("icons.orientation",null,"array.string"),a("icons.xoffset",[0],"array.number"),a("icons.yoffset",[0],"array.number"),a("icons.xgap",[1],"array.number"),a("icons.ygap",[1],"array.number"),a("alarm.alpha",1),a("alarm.color","#000000"),a("alarm.font",null),a("alarm.position","hotspot"),a("alarm.direction","aboveright"),a("alarm.corner.radius",5),a("alarm.pointer.length",10),a("alarm.pointer.width",8),a("alarm.xoffset",0),a("alarm.yoffset",0),a("alarm.padding",0),a("alarm.padding.left",0),a("alarm.padding.right",0),a("alarm.padding.top",0),a("alarm.padding.bottom",0),a("alarm.gradient","none"),a("alarm.gradient.color","#FFFFFF"),a("alarm.outline.width",-1),a("alarm.outline.color","#000000"),a("alarm.cap","butt"),a("alarm.join","miter"),a("alarm.shadowable",!0),a("link.color","#658DC1"),a("link.width",3),a("link.cap","butt"),a("link.join","miter"),a("link.type","arc"),a("link.pattern",null,"array.number"),a("link.extend",20),a("link.control.point",null,"point"),a("link.bundle.id",0),a("link.bundle.enable",!0),a("link.bundle.expanded",!0),a("link.bundle.independent",!1),a("link.bundle.offset",20),a("link.bundle.gap",12),a("link.bundle.group.gap",0),a("link.looped.gap",6),a("link.looped.direction","northwest"),a("link.looped.type","arc"),a("link.from.position","center"),a("link.from.xoffset",0),a("link.from.yoffset",0),a("link.from.at.edge",!0),a("link.to.position","center"),a("link.to.xoffset",0),a("link.to.yoffset",0),a("link.to.at.edge",!0),a("link.split.by.percent",!0),a("link.split.percent",.5),a("link.split.value",20),a("link.corner","round"),a("link.xradius",8),a("link.yradius",8),a("link.flow",!1),a("link.flow.converse",!1),a("link.handler.alpha",1),a("link.handler.color","#000000"),a("link.handler.font",null),a("link.handler.position","topleft.topleft"),a("link.handler.direction","below"),a("link.handler.corner.radius",0),a("link.handler.pointer.length",0),a("link.handler.pointer.width",8),a("link.handler.xoffset",0),a("link.handler.yoffset",0),a("link.handler.padding",0),a("link.handler.padding.left",0),a("link.handler.padding.right",0),a("link.handler.padding.top",0),a("link.handler.padding.bottom",0),a("link.handler.fill",!1),a("link.handler.fill.color","#C0C0C0"),a("link.handler.gradient","none"),a("link.handler.gradient.color","#FFFFFF"),a("link.handler.outline.width",-1),a("link.handler.outline.color","#000000"),a("link.handler.cap","butt"),a("link.handler.join","miter"),a("link.handler.shadowable",!0),a("follower.row.index",0),a("follower.column.index",0),a("follower.row.span",1),a("follower.column.span",1),a("follower.padding",0),a("follower.padding.left",0),a("follower.padding.right",0),a("follower.padding.top",0),a("follower.padding.bottom",0),a("follower.fill.cell",!0),a("follower.cell.position","center"),a("grid.row.count",1),a("grid.column.count",1),a("grid.row.percents",null,"array.number"),a("grid.column.percents",null,"array.number"),a("grid.border",1),a("grid.border.left",0),a("grid.border.right",0),a("grid.border.top",0),a("grid.border.bottom",0),a("grid.padding",1),a("grid.padding.left",0),a("grid.padding.right",0),a("grid.padding.top",0),a("grid.padding.bottom",0),a("grid.fill",!0),a("grid.fill.color","#C0C0C0"),a("grid.deep",1),a("grid.cell.deep",-1),a("shapelink.type","lineto"),a("shapenode.closed",!1),a("shapenode.pattern",null,"array.number"),a("bus.style","nearby"),a("arrow.from",!1),a("arrow.from.fill",!0),a("arrow.from.shape","arrow.standard"),a("arrow.from.color","#000000"),a("arrow.from.xoffset",0),a("arrow.from.yoffset",0),a("arrow.from.width",12),a("arrow.from.height",9),a("arrow.from.outline.color","#000000"),a("arrow.from.outline.width",-1),a("arrow.from.at.edge",!0),a("arrow.to",!1),a("arrow.to.fill",!0),a("arrow.to.shape","arrow.standard"),a("arrow.to.color","#000000"),a("arrow.to.xoffset",0),a("arrow.to.yoffset",0),a("arrow.to.width",12),a("arrow.to.height",9),a("arrow.to.outline.color","#000000"),a("arrow.to.outline.width",-1),a("arrow.to.at.edge",!0),a("background.image",null),a("background.type","none"),a("background.outline.width",-1),a("background.outline.color",null),a("background.vector.padding",0),a("background.image.padding",0),a("background.image.stretch","fill"),a("background.vector.fill",null),a("background.vector.fill.color",null),a("background.vector.gradient",!1),a("background.vector.gradient.color",null),a("background.vector.shape","rectangle"),a("background.outline.pattern",null,"array.number"),a("attachment.label.style","html"),a("attachment.alarm.style","html")}(),d.ext("twaver.Styles",Object,{}),c.PropertyChangeDispatcher=function(){this._dispatcher=new c.EventDispatcher},d.ext("twaver.PropertyChangeDispatcher",Object,{addPropertyChangeListener:function(a,b,c){this._dispatcher.add(a,b,c)},removePropertyChangeListener:function(a,b){this._dispatcher.remove(a,b)},firePropertyChange:function(a,b,c){if(b==c)return!1;var d={property:a,oldValue:b,newValue:c,source:this};return this._dispatcher.fire(d),this.onPropertyChanged(d),!0},onPropertyChanged:function(a){}}),c.animate.Animate=function(){},d.ext("twaver.animate.Animate",Object,{current:0,step:8,delay:4,finishFunction:null,shouldBeFinished:!1,getCurrentDelay:function(){return this.delay*this.current+1},action:function(a){}}),c.animate.AnimateProperty=function(a,b,c){this.objects=a,this.newValues=b,this.finishFunction=c,this.oldValues=new Ce;var d=this.objects.size();for(var e=0;e<d;e++){var f=this.objects.get(e);this.oldValues.add(this.getPropertyValue(f))}},d.ext("twaver.animate.AnimateProperty",c.animate.Animate,{action:function(a){var b=this.objects.size();for(var c=0;c<b;c++){var d=this.objects.get(c),e=this.oldValues.get(c),f=this.newValues.get(c);this.currentAction(d,e,f,a)}},getPropertyValue:function(a){},currentAction:function(a,b,c,d){}}),c.animate.AnimateBounds=function(a,b,c){this.node=a,this.newBounds=b,this.oldBounds=a.getRect(),this.finishFunction=c},d.ext("twaver.animate.AnimateBounds",c.animate.Animate,{shouldBeFinished:!0,action:function(a){var b=this.oldBounds,c=this.newBounds;this.node.setLocation(b.x+(c.x-b.x)*a,b.y+(c.y-b.y)*a),this.node.setSize(b.width+(c.width-b.width)*a,b.height+(c.height-b.height)*a)}}),c.animate.AnimateCenterLocation=function(a,b,d){c.animate.AnimateCenterLocation.superClass.constructor.call(this,a,b,d)},d.ext("twaver.animate.AnimateCenterLocation",c.animate.AnimateProperty,{getPropertyValue:function(a){return a.getCenterLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setCenterLocation(e,f)}}),c.animate.AnimateLocation=function(a,b,d){c.animate.AnimateLocation.superClass.constructor.call(this,a,b,d)},d.ext("twaver.animate.AnimateLocation",c.animate.AnimateProperty,{getPropertyValue:function(a){return a.getLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setLocation(e,f)}}),c.animate.AnimateScrollPosition=function(a,b,c){this.view=a,this.oldHorizontalOffset=a.scrollLeft,this.oldVerticalOffset=a.scrollTop,this.newHorizontalOffset=b,this.newVerticalOffset=c},d.ext("twaver.animate.AnimateScrollPosition",c.animate.Animate,{action:function(a){this.view.scrollLeft=this.oldHorizontalOffset+(this.newHorizontalOffset-this.oldHorizontalOffset)*a,this.view.scrollTop=this.oldVerticalOffset+(this.newVerticalOffset-this.oldVerticalOffset)*a}}),c.animate.AnimateZoom=function(a,b,c){this.view=a,this.oldZoom=a.getZoom(),this.newZoom=b,this.finishFunction=c},d.ext("twaver.animate.AnimateZoom",c.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setZoom(this.oldZoom+(this.newZoom-this.oldZoom)*a,!1)}}),c.animate.AnimateXZoom=function(a,b,c){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.finishFunction=c},d.ext("twaver.animate.AnimateXZoom",c.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1)}}),c.animate.AnimateYZoom=function(a,b,c){this.view=a,this.oldYZoom=a.getYZoom(),this.newYZoom=b,this.finishFunction=c},d.ext("twaver.animate.AnimateYZoom",c.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),c.animate.AnimateXYZoom=function(a,b,c,d){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.oldYZoom=a.getYZoom(),this.newYZoom=c,this.finishFunction=d},d.ext("twaver.animate.AnimateXYZoom",c.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1),this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),c.animate.AnimateSubNetwork=function(a,b,c){this.network=a,this.subNetwork=b,this.finishFunction=c},d.ext("twaver.animate.AnimateSubNetwork",c.animate.Animate,{shouldBeFinished:!0,action:function(a){a>.5?(this.network.getView().style.opacity=a*2-1,this.network._setCurrentSubNetwork(this.subNetwork)):this.network.getView().style.opacity=1-a*2}}),c.animate.AnimateManager={timer:null,animate:null,start:function(a,b){var e=c.animate.AnimateManager;a.current<0&&(a.current=0),b?d.callLater(e.startImpl,null,[a],b):e.startImpl(a)},startImpl:function(a){var b=c.animate.AnimateManager;b.animate&&b.endAnimate(),b.animate=a,b.timer=setTimeout(b.tick,a.getCurrentDelay())},tick:function(){var a=c.animate.AnimateManager,b=a.animate;if(!b)return;if(b.current<0){b.current++;return}b.current<b.step&&(b.current++,b.action(b.current/b.step),a.timer=setTimeout(a.tick,b.getCurrentDelay())),b.current>=b.step&&a.endAnimate()},endAnimate:function(){var a=c.animate.AnimateManager;if(a.animate){a.animate.shouldBeFinished&&a.animate.current<a.animate.step&&(a.animate.current=a.animate.step,a.animate.action(a.animate.current/a.animate.step));var b=a.animate.finishFunction;a.animate=null,a.timer&&(clearTimeout(a.timer),a.timer=null),b&&b()}else a.timer&&(clearTimeout(a.timer),a.timer=null)}},c.DataBox=function(a){c.DataBox.superClass.constructor.apply(this,arguments),arguments.length===1&&(this._name=a),this._dataList=new Ce,this._dataMap={},this._rootList=new Ce,this._rootMap={},this._clientMap={},this._dataBoxChangeDispatcher=new c.EventDispatcher,this._dataPropertyChangeDispatcher=new c.EventDispatcher,this._hierarchyChangeDispatcher=new c.EventDispatcher,this._selectionModel=new c.SelectionModel(this)},d.ext("twaver.DataBox",c.PropertyChangeDispatcher,{IClient:!0,__client:1,__new:1,_limit:-1,_name:"DataBox",_icon:Se.ICON_DATABOX,__accessor:["name","icon","toolTip"],getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(a){var b=this._limit;this._limit=a,this.firePropertyChange("limit",b,a),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(a){arguments.length===0&&(a=1);while(a>0&&this._dataList.size()>0){var b=this._dataList.get(0);this.remove(b),a--}},getSiblings:function(a){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var b=a.getParent();return b?b.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(a){return a.getParent()?a.getParent().getChildren().indexOf(a):this._rootList.indexOf(a)},getDatas:function(){return this._dataList},getDataAt:function(a){return this._dataList.get(a)},toDatas:function(a,b){return this._dataList.toList(a,b)},forEach:function(a,b){this._dataList.forEach(a,b)},forEachReverse:function(a,b){this._dataList.forEachReverse(a,b)},forEachByDepthFirst:function(a,b,c){if(b)this._depthFirst(a,b,c);else{var d=this._rootList.size();for(var e=0;e<d;e++){var f=this._rootList.get(e);if(this._depthFirst(a,f,c)===!1)return}}},_depthFirst:function(a,b,c){var d=b.getChildrenSize();for(var e=0;e<d;e++){var f=b.getChildAt(e);if(this._depthFirst(a,f,c)===!1)return!1}if(c){if(a.call(c,b)===!1)return!1}else if(a(b)===!1)return!1},forEachByBreadthFirst:function(a,b,c){var d=new Ce;b?d.add(b):this._rootList.forEach(d.add,d);while(d.size()>0){b=d.removeAt(0),b.getChildren().forEach(d.add,d);if(c){if(a.call(c,b)===!1)return}else if(a(b)===!1)return}},add:function(a,b){if(!a)return;arguments.length===1&&(b=-1);var c=a.getId();if(this._dataMap.hasOwnProperty(c))throw"Data with ID '"+c+"' already exists";this._dataMap[c]=a,this._dataList.add(a),a.getParent()||(this._rootMap[c]=a,b>=0?this._rootList.add(a,b):this._rootList.add(a)),a.addPropertyChangeListener(this.handleDataPropertyChange,this,!0),this._dataBoxChangeDispatcher.fire({kind:"add",data:a}),this._checkLimit()},remove:function(a){this.removeById(a.getId())},removeSelection:function(){this._selectionModel.toSelection().forEach(function(a){this.remove(a)},this)},removeById:function(a){var b=this.getDataById(a);if(!b)return;b instanceof c.Link&&(b.setFromNode(null),b.setToNode(null)),b instanceof Ze&&b.getLinks()&&b.getLinks().toList().forEach(function(a){this.remove(a)},this),b instanceof Ze&&b.getFollowers()&&b.getFollowers().toList().forEach(function(a){a.setHost(null)}),b instanceof c.Follower&&b.getHost()&&b.setHost(null),b.toChildren().forEach(function(a){this.remove(a)},this),b.getParent()&&b.getParent().removeChild(b),this._dataList.remove(b),delete this._dataMap[a],this._rootMap[a]&&(delete this._rootMap[a],this._rootList.remove(b)),this._dataBoxChangeDispatcher.fire({kind:"remove",data:b}),b.removePropertyChangeListener(this.handleDataPropertyChange,this)},clear:function(){if(this._dataList.size()>0){this._dataList.forEach(function(a){a.removePropertyChangeListener(this.handleDataPropertyChange,this)},this);var a=this._dataList.toList();this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:a})}},getDataById:function(a){return this._dataMap[a]},containsById:function(a){return this._dataMap.hasOwnProperty(a)},contains:function(a){return a?this._dataMap[a._id]===a:!1},moveTo:function(a,b){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var c=this.getSiblings(a),d=c.indexOf(a);if(d===b||d<0)return;b>=0&&b<=c.size()&&(c.remove(a),b>c.size()&&b--,c.add(a,b),this._hierarchyChangeDispatcher.fire({data:a,oldIndex:d,newIndex:b}))},moveUp:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)-1)},moveDown:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)+1)},moveToTop:function(a){this.moveTo(a,0)},moveToBottom:function(a){var b=this.getSiblings(a);this.moveTo(a,b.size())},moveSelectionUp:function(a){a||(a=this._selectionModel);var b=new Ce;zd.findMoveUpDatas(a,b,this._rootList),b.forEach(this.moveUp,this)},moveSelectionDown:function(a){a||(a=this._selectionModel);var b=new Ce;zd.findMoveDownDatas(a,b,this._rootList),b.forEach(this.moveDown,this)},moveSelectionToTop:function(a){a||(a=this._selectionModel);var b=new Ce;zd.findMoveToTopDatas(a,b,this._rootList),b.forEach(this.moveToTop,this)},moveSelectionToBottom:function(a){a||(a=this._selectionModel);var b=new Ce;zd.findMoveToBottomDatas(a,b,this._rootList),b.forEach(this.moveToBottom,this)},handleDataPropertyChange:function(a){var b=a.source;if(a.property==="parent"){var c=b.getId();b.getParent()?this._rootMap[c]&&(delete this._rootMap[c],this._rootList.remove(b)):this._rootMap[c]||(this._rootMap[c]=b,this._rootList.add(b))}this.onDataPropertyChanged(b,a),this._dataPropertyChangeDispatcher.fire(a)},onDataPropertyChanged:function(a,b){},addDataBoxChangeListener:function(a,b,c){this._dataBoxChangeDispatcher.add(a,b,c)},removeDataBoxChangeListener:function(a,b){this._dataBoxChangeDispatcher.remove(a,b)},addDataPropertyChangeListener:function(a,b,c){this._dataPropertyChangeDispatcher.add(a,b,c)},removeDataPropertyChangeListener:function(a,b){this._dataPropertyChangeDispatcher.remove(a,b)},addHierarchyChangeListener:function(a,b,c){this._hierarchyChangeDispatcher.add(a,b,c)},removeHierarchyChangeListener:function(a,b){this._hierarchyChangeDispatcher.remove(a,b)},getRandomData:function(a){if(a){var b=new c.List;for(var d=0;d<this._dataList.size()-1;d++){var e=this._dataList.get(d);e instanceof a&&b.add(e)}if(b.size()==0)return null}var f=a?b.get(parseInt(Math.random()*b.size())):this._dataList.get(parseInt(Math.random()*this._dataList.size()));return f}}),c.ElementBox=function(a){c.ElementBox.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new c.AlarmBox(this),this._layerBox=new c.LayerBox(this),this._alarmStatePropagator=new c.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0),this._indexChangeDispatcher=new c.EventDispatcher},c.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},d.ext("twaver.ElementBox",c.DataBox,{IStyle:!0,__style:1,_name:"ElementBox",add:function(a,b){if(!a)return;if(!a.IElement)throw"Only IElement can be added into ElementBox";c.ElementBox.superClass.add.apply(this,arguments),this.adjustElementIndex(a)},onDataPropertyChanged:function(a,b){c.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[b.property]&&this.adjustElementIndex(a),c.ElementBox.superClass.onDataPropertyChanged.apply(this,arguments)},addIndexChangeListener:function(a,b,c){this._indexChangeDispatcher.add(a,b,c)},removeIndexChangeListener:function(a,b){this._indexChangeDispatcher.remove(a,b)},sendToTop:function(a){if(!this.contains(a))return;if(a!==this.getDatas().get(this.size()-1)){var b=this.getDatas().indexOf(a);this.getDatas().removeAt(b),this.getDatas().add(a),this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:this.size()-1})}a instanceof c.Link&&(a.getFromAgent()&&!a.getFromAgent().isAdjustedToBottom()&&this.sendToTop(a.getFromAgent()),a.getToAgent()&&!a.getToAgent().isAdjustedToBottom()&&this.sendToTop(a.getToAgent())),a instanceof Ze&&a.getFollowers()&&a.getFollowers().forEach(function(b){if(b.isRelatedTo(a))return;if(a instanceof c.Follower&&b.isLoopedHostOn(a))return;this.sendToTop(b)},this);if(a.ISubNetwork)return;if(a instanceof _e&&!a.isExpanded())return;a.getChildren().forEach(function(a){a instanceof c.Link||this.sendToTop(a)},this)},sendToBottom:function(a,b){if(a===b)return;if(!this.contains(a))return;if(b&&!this.contains(b))return;var d=this.getDatas().remove(a),e=0;b&&(e=this.getDatas().indexOf(b)),this.getDatas().add(a,e),d!=e&&(this._indexChangeDispatcher.fire({element:a,oldIndex:d,newIndex:e}),a.getParent()&&!a.getParent().ISubNetwork&&!(a.getParent()instanceof c.Link)&&this.sendToBottom(a.getParent(),a))},fireIndexChange:function(a,b,c){this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:c})},adjustElementIndex:function(a){if(!this.contains(a))return;a.isAdjustedToBottom()?(this.sendToBottom
(a),a.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(a)},forEachByLayer:function(a,b,c){var d=this.size(),e=this.getDatas();if(!b)this._layerBox.forEachByDepthFirst(function(b){for(var f=0;f<d;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}},null,this);else for(var f=0;f<d;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}},forEachByLayerReverse:function(a,b,c){var d=new Ce;this.forEachByLayer(function(a){d.add(a,0)},b),d.forEach(a,c)},getLayerBox:function(){return this._layerBox},getAlarmBox:function(){return this._alarmBox},getAlarmStatePropagator:function(){return this._alarmStatePropagator},startBatch:function(a,b){c._isInitializing=!0,c._bundleLinks={},c._links={},a.call(b);var d,e;for(var f in c._links)d=c._links[f],d._checkAgentNodeImpl();for(var f in c._bundleLinks)e=c._bundleLinks[f],wd.resetBundleLinks(e[0],e[1]);c._bundleLinks=null,c._links=null,c._isInitializing=!1}}),c.SelectionModel=function(a){c.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new Ce,this._selectionChangeDispatcher=new c.EventDispatcher,this._selectionMap={},this._setDataBox(a)},d.ext("twaver.SelectionModel",c.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(a){if(this._selectionMode===a)return;if(a!=="noneSelection"&&a!=="singleSelection"&&a!=="multipleSelection")return;this.clearSelection();var b=this._selectionMode;this._selectionMode=a,this.firePropertyChange("selectionMode",b,this._selectionMode)},getDataBox:function(){return this._dataBox},_setDataBox:function(a){if(!a)throw"dataBox can not be null";if(this._dataBox===a)return;this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var b=this._dataBox;this._dataBox=a,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",b,this._dataBox)},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(a){if(a.kind==="remove"){var b=a.data;this.contains(b)&&(this._selectionList.remove(b),delete this._selectionMap[b.getId()],this.fireSelectionChange("remove",new Ce(b)))}else a.kind==="clear"&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(a){if(this._filterFunction===a)return;this.clearSelection();var b=this._filterFunction;this._filterFunction=a,this.firePropertyChange("filterFunction",b,this._filterFunction)},fireSelectionChange:function(a,b,c){c&&(this._selectionList.forEach(function(a){c.contains(a)?c.remove(a):c.add(a)}),b=c.toList()),this._selectionChangeDispatcher.fire({kind:a,datas:new Ce(b)})},addSelectionChangeListener:function(a,b,c){this._selectionChangeDispatcher.add(a,b,c)},removeSelectionChangeListener:function(a,b){this._selectionChangeDispatcher.remove(a,b)},_filterList:function(a,b){var c=new Ce(a);for(var d=0;d<c.size();d++){var e=c.get(d);if(this._filterFunction&&!this._filterFunction(e)||b&&this.contains(e)||!b&&!this.contains(e)||!this._dataBox.contains(e))c.removeAt(d),d--}return c},appendSelection:function(a){if(this._selectionMode==="noneSelection")return;var b=this._filterList(a,!0);if(b.isEmpty())return;var c=null;this._selectionMode==="singleSelection"&&(c=new Ce(this._selectionList),this._selectionList.clear(),this._selectionMap={},b=new Ce(b.get(b.size()-1)));for(var d=0;d<b.size();d++){var e=b.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("append",b,c)},removeSelection:function(a){var b=this._filterList(a);if(b.size()===0)return;for(var c=0;c<b.size();c++){var d=b.get(c);this._selectionList.remove(d),delete this._selectionMap[d.getId()]}this.fireSelectionChange("remove",b)},toSelection:function(a,b){return this._selectionList.toList(a,b)},getSelection:function(){return this._selectionList},setSelection:function(a){if(this._selectionMode==="noneSelection")return;if(this._selectionList.size()===0&&a==null)return;var b=new Ce(this._selectionList);this._selectionList.clear(),this._selectionMap={};var c=this._filterList(a,!0);this._selectionMode==="singleSelection"&&c.size()>1&&(c=new Ce(c.get(c.size()-1)));for(var d=0;d<c.size();d++){var e=c.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("set",null,b)},clearSelection:function(){if(this._selectionList.size()>0){var a=this._selectionList.toList();this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",a)}},selectAll:function(){if(this._selectionMode==="noneSelection")return;var a=this._dataBox.toDatas(),b=0,c=null;if(this._filterFunction)for(b=0;b<a.size();b++)c=a.get(b),this._filterFunction(c)||(a.removeAt(b),b--);var d=new Ce(this._selectionList);this._selectionList.clear(),this._selectionMap={},this._selectionMode==="singleSelection"&&a.size()>1&&(a=new Ce(a.get(a.size()-1)));for(b=0;b<a.size();b++)c=a.get(b),this._selectionList.add(c),this._selectionMap[c.getId()]=c;this.fireSelectionChange("all",null,d)},size:function(){return this._selectionList.size()},contains:function(a){return a?this._selectionMap[a.getId()]!=null:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(a){return a?this._selectionMode==="noneSelection"?!1:this._filterFunction&&!this._filterFunction(a)?!1:!0:!1}}),c.QuickFinder=function(a,b,c,e,f){this._map={};if(!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor",this._propertyType==="accessor"&&(this._getter=d.getter(b)),this._valueFunction=e||this.getValue,this._filterFunction=f||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},d.ext("twaver.QuickFinder",Object,{_NULL_:"twaver-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(a){a.kind==="add"?this._addData(a.data):a.kind==="remove"?this._removeData(a.data):a.kind==="clear"&&(this._map={})},handleDataPropertyChange:function(a){if(!this._filterFunction.call(this,a.source))return;if(this._propertyType!=="accessor"||this._propertyName!==a.property)if(this._propertyType!=="style"||!a.source.IStyle||"S:"+this._propertyName!==a.property)if(this._propertyType!=="client"||"C:"+this._propertyName!==a.property)return;var b=this._getMap(a.oldValue);b&&b.remove(a.source),this._addData(a.source)},_getMap:function(a){return a=a==null?this._NULL_:a,this._map[a]},find:function(a){var b=this._getMap(a);return b?b.toList():new Ce},findFirst:function(a){var b=this._getMap(a);return!b||b.isEmpty()?null:b.get(0)},_addData:function(a){if(!this._filterFunction.call(this,a))return;var b=this._valueFunction.call(this,a),c=this._getMap(b);c||(c=new Ce,b=b==null?this._NULL_:b,this._map[b]=c),c.add(a)},_removeData:function(a){if(!this._filterFunction.call(this,a))return;var b=this._valueFunction.call(this,a),c=this._getMap(b);c&&(c.remove(a),c.isEmpty()&&(b=b==null?this._NULL_:b,delete this._map[b]))},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(a){return this._propertyType==="style"&&!a.IStyle?!1:this._propertyType==="accessor"&&this._valueFunction===this.getValue&&!a[this._getter]?!1:!0},getValue:function(a){return this._propertyType==="accessor"?a[this._getter]():this._propertyType==="style"&&a.getStyle?a.getStyle(this._propertyName):this._propertyType==="client"&&a.getClient?a.getClient(this._propertyName):null}}),c.PropertyPropagator=function(a,b,c){if(!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor",this._propertyType==="accessor"&&(this._getter=d.getter(b),this._setter=d.setter(b)),this._enable=!1,this._isPropagating=!1},d.ext("twaver.PropertyPropagator",Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(a){if(this._enable===a)return;this._enable=a,this._enable?(this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.forEach(function(a){this.propagate(a)},this)):(this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this))},handleDataBoxChange:function(a){a.data&&this.propagate(a.data)},handleDataPropertyChange:function(a){if(this.isInterestedProperty(a))this.propagate(a.source);else if(a.property==="parent"){var b=a.oldValue;b&&this.propagate(b),this.propagate(a.source)}},isInterestedProperty:function(a){return this._propertyType==="accessor"&&this._propertyName===a.property?!0:this._propertyType==="style"&&a.IElement&&"S:"+this._propertyName===a.property?!0:this._propertyType==="client"&&"C:"+this._propertyName===a.property?!0:!1},propagate:function(a){if(!a||this._isPropagating)return;this._isPropagating=!0,this.propagateToTop(a),this._isPropagating=!1},propagateToTop:function(a){this.propagateToParent(null,a);while(a&&a.getParent())this.propagateToParent(a,a.getParent()),a=a.getParent()},propagateToParent:function(a,b){}}),c.AlarmStatePropagator=function(a){c.AlarmStatePropagator.superClass.constructor.call(this,a,"alarmState")},d.ext("twaver.AlarmStatePropagator",c.PropertyPropagator,{handleDataPropertyChange:function(a){a.property==="enablePropagation"?this.propagate(a.source):c.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,a)},propagateToParent:function(a,b){var d=null;b.getChildren().forEach(function(a){var b=a.getAlarmState().getHighestOverallAlarmSeverity();c.AlarmSeverity.compare(b,d)>0&&(d=b)}),b.getAlarmState().setPropagateSeverity(d)}}),c.AlarmSeverity=function(a,b,c,d,e){this.value=a,this.name=b,this.nickName=c,this.color=d,this.displayName=e},d.ext("twaver.AlarmSeverity",Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var a=c.AlarmSeverity;a.severities=new Ce,a._vm={},a._nm={},a._cp=function(a,b){if(a&&b){var c=a.value-b.value;return c>0?1:c<0?-1:0}return a&&!b?1:!a&&b?-1:0},a.forEach=function(b,c){a.severities.forEach(b,c)},a.getSortFunction=function(){return a._cp},a.setSortFunction=function(b){a._cp=b,a.severities.sort(b)},a.add=function(b,c,d,e,f){var g=new a(b,c,d,e,f);return a._vm[b]=g,a._nm[c]=g,a.severities.add(g),a.severities.sort(a._cp),g},a.remove=function(b){var c=a._nm[b];return c&&(delete a._nm[b],delete a._vm[c.value],a.severities.remove(c)),c},a.CRITICAL=a.add(500,"Critical","C","#FF0000"),a.MAJOR=a.add(400,"Major","M","#FFA000"),a.MINOR=a.add(300,"Minor","m","#FFFF00"),a.WARNING=a.add(200,"Warning","W","#00FFFF"),a.INDETERMINATE=a.add(100,"Indeterminate","N","#C800FF"),a.CLEARED=a.add(0,"Cleared","R","#00FF00"),a.isClearedAlarmSeverity=function(a){return a?a.value===0:!1},a.getByName=function(b){return a._nm[b]},a.getByValue=function(b){return a._vm[b]},a.clear=function(){a.severities.clear(),a._vm={},a._nm={}},a.compare=function(b,c){return a._cp(b,c)}}(),c.AlarmState=function(a){this._e=a,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},d.ext("twaver.AlarmState",Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var a=null;for(var b in this._am){b=c.AlarmSeverity.getByName(b);if(c.AlarmSeverity.isClearedAlarmSeverity(b))continue;if(this.getAcknowledgedAlarmCount(b)===0)continue;a?a=c.AlarmSeverity.compare(a,b)>0?a:b:a=b}this._haa=a},_c2:function(){var a=null;for(var b in this._nm){b=c.AlarmSeverity.getByName(b);if(c.AlarmSeverity.isClearedAlarmSeverity(b))continue;if(this.getNewAlarmCount(b)===0)continue;a?a=c.AlarmSeverity.compare(a,b)>0?a:b:a=b}this._hna=a},_c3:function(){if(!this._hna){this._hls=!1;return}for(var a in this._nm){a=c.AlarmSeverity.getByName(a);if(c.AlarmSeverity.isClearedAlarmSeverity(a))continue;if(this.getNewAlarmCount(a)===0)continue;if(c.AlarmSeverity.compare(this._hna,a)>0){this._hls=!0;return}}this._hls=!1},_c4:function(){var a=this._haa,b=this._hna,d=this._ps;this._hoa=a,c.AlarmSeverity.compare(b,this._hoa)>0&&(this._hoa=b),c.AlarmSeverity.compare(d,this._hoa)>0&&(this._hoa=d)},_c5:function(){var a=this._haa,b=this._hna;this._hta=a,c.AlarmSeverity.compare(b,this._hta)>0&&(this._hta=b)},increaseAcknowledgedAlarm:function(a,b){b==null&&(b=1);if(b===0)return;var c=this._am[a.name];c==null&&(c=0),c+=b,this._am[a.name]=c,this._f()},increaseNewAlarm:function(a,b){b==null&&(b=1);if(b===0)return;var c=this._nm[a.name];c==null&&(c=0),c+=b,this._nm[a.name]=c,this._f()},decreaseAcknowledgedAlarm:function(a,b){b==null&&(b=1);if(b===0)return;var c=this._am[a.name];c==null&&(c=0),c-=b;if(c<0)throw"Alarm count can not be negative";this._am[a.name]=c,this._f()},decreaseNewAlarm:function(a,b){b==null&&(b=1);if(b===0)return;var c=this._nm[a.name];c==null&&(c=0),c-=b;if(c<0)throw"Alarm count can not be negative";this._nm[a.name]=c,this._f()},acknowledgeAlarm:function(a){this.decreaseNewAlarm(a,1),this.increaseAcknowledgedAlarm(a,1)},acknowledgeAllAlarms:function(a){if(a){var b=this.getNewAlarmCount(a);this.decreaseNewAlarm(a,b),this.increaseAcknowledgedAlarm(a,b)}else for(var d in this._nm)this.acknowledgeAllAlarms(c.AlarmSeverity.getByName(d))},_c6:function(){this._aac=0;for(var a in this._am)a=c.AlarmSeverity.getByName(a),this._aac+=this.getAcknowledgedAlarmCount(a)},getAcknowledgedAlarmCount:function(a){if(a){var b=this._am[a.name];return b==null?0:b}return this._aac},getAlarmCount:function(a){return this.getAcknowledgedAlarmCount(a)+this.getNewAlarmCount(a)},_c7:function(){this._nac=0;for(var a in this._nm)a=c.AlarmSeverity.getByName(a),this._nac+=this.getNewAlarmCount(a)},getNewAlarmCount:function(a){if(a){var b=this._nm[a.name];return b==null?0:b}return this._nac},setNewAlarmCount:function(a,b){this._nm[a.name]=b,this._f()},removeAllNewAlarms:function(a){a?delete this._nm[a]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(a,b){this._am[a.name]=b,this._f()},removeAllAcknowledgedAlarms:function(a){a?delete this._am[a.name]:this._am={},this._f()},isEmpty:function(){return this._hoa==null},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(a){this._ep||(a=null);if(this._ps===a)return;var b=this._ps;this._ps=a,this._f(),this._e.firePropertyChange("propagateSeverity",b,a)},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(a){var b=this._ep;this._ep=a,this._e.firePropertyChange("enablePropagation",b,a)&&(a||this.setPropagateSeverity(null))}}),c.AlarmBox=function(a){if(!a)throw"elementBox can not be null.";c.AlarmBox.superClass.constructor.call(this),this._elementBox=a,this._alarmElementMapping=new c.AlarmElementMapping(this,a),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},d.ext("twaver.AlarmBox",c.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(a){var b=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=a,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",b,a),a&&this.toDatas(function(a){return a.isCleared()}).forEach(this.remove,this)},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(a){if(!a)throw"alarmElementMapping can not be null";if(this._alarmElementMapping===a)return;var b=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=a,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",b,a)},handleElementBoxChange:function(a){a.kind==="add"?this.handleElementAdded(a.data):a.kind==="remove"?(this.handleElementRemoved(a.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(a.data)):a.kind==="clear"&&(a.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(a){a.kind==="add"?this._increaseAlarmState(a.data):a.kind==="remove"?this._decreaseAlarmState(a.data):a.kind==="clear"&&a.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(a){var b=a.source;b.isCleared()||(a.property==="alarmSeverity"?this.handleAlarmSeverityChange(b,a):a.property==="acked"&&this.handleAckedChange(b,a)),a.property==="cleared"&&(b.isCleared()?(this._decreaseAlarmState(b,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(b)):this._increaseAlarmState(b,!0))},handleAckedChange:function(a,b){if(!a.getAlarmSeverity())return;var c=this.getCorrespondingElements(a);if(c)for(var d=0;d<c.size();d++){var e=c.get(d);b.oldValue?e.getAlarmState().decreaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(a.getAlarmSeverity()),b.newValue?e.getAlarmState().increaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().increaseNewAlarm(a.getAlarmSeverity())}},handleAlarmSeverityChange:function(a,b){var c=b.oldValue,d=b.newValue,e=this.getCorrespondingElements(a);if(e)for(var f=0;f<e.size();f++){var g=e.get(f);c&&(a.isAcked()?g.getAlarmState().decreaseAcknowledgedAlarm(c):g.getAlarmState().decreaseNewAlarm(c)),d&&(a.isAcked()?g.getAlarmState().increaseAcknowledgedAlarm(d):g.getAlarmState().increaseNewAlarm(d))}},getCorrespondingAlarms:function(a){return this._alarmElementMapping.getCorrespondingAlarms(a)},getCorrespondingElements:function(a){return this._alarmElementMapping.getCorrespondingElements(a)},handleElementAdded:function(a){var b=this.getCorrespondingAlarms(a);if(b)for(var c=0;c<b.size();c++){var d=b.get(c);if(d.isCleared())continue;var e=d.getAlarmSeverity();e&&(d.isAcked()?a.getAlarmState().increaseAcknowledgedAlarm(e):a.getAlarmState().increaseNewAlarm(e))}},_increaseAlarmState:function(a,b){if(a.isCleared()&&!b)return;var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().increaseAcknowledgedAlarm(c):f.getAlarmState().increaseNewAlarm(c)}}},_decreaseAlarmState:function(a,b){if(a.isCleared()&&!b)return;var c=a.getAlarmSeverity();if(!c)return;var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().decreaseAcknowledgedAlarm(c):f.getAlarmState().decreaseNewAlarm(c)}},handleElementRemoved:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(function(b){!b.isCleared()&&b.getAlarmSeverity()&&(b.isAcked()?a.getAlarmState().decreaseAcknowledgedAlarm(b.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(b.getAlarmSeverity()))})},removeAlarmsByElement:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(this.remove,this)},add:function(a,b){if(!a.IAlarm)throw"Only IAlarm can be added into AlarmBox";if(this._removeAlarmWhenAlarmIsCleared&&a.isCleared())return;c.AlarmBox.superClass.add.apply(this,arguments)}}),c.AlarmElementMapping=function(a,b){if(!b)throw"ElementBox can not be null";if(!a)throw"AlarmBox can not be null";this._elementBox=b,this._alarmBox=a,this._alarmsFinder=new c.QuickFinder(a,"elementId")},d.ext("twaver.AlarmElementMapping",Object,{getCorrespondingAlarms:function(a){return this._alarmsFinder.find(a.getId())},getCorrespondingElements:function(a){var b=this._elementBox.getDataById(a.getElementId());return new Ce(b)},dispose:function(){this._alarmsFinder.dispose(),delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),c.AlarmStateStatistics=function(a){c.AlarmStateStatistics.superClass.constructor.apply(this,arguments),this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.elementMap={},this.setElementBox(a)},d.ext("twaver.AlarmStateStatistics",c.PropertyChangeDispatcher,{getElementBox:function(){return this._elementBox},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._elementBox===a)return;var b=this._elementBox;b&&(b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removeDataBoxChangeListener(this.handleElementBoxChange,this),this.severtiyMap={},this.elementMap={}),this._elementBox=a,this.reset(),a.addDataPropertyChangeListener(this.handleElementPropertyChange,this),a.addDataBoxChangeListener(this.handleElementBoxChange,this),this.firePropertyChange("elementBox",b,a)},dispose:function(){this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange,this),delete this._elementBox},handleElementPropertyChange:function(a){a.property==="alarmState"&&(this.increase(a.source),this.fireAlarmStateChange())},handleElementBoxChange:function(a){a.kind==="add"?(this.increase(a.data),this.fireAlarmStateChange()):a.kind==="remove"?(this.decrease(a.data),this.fireAlarmStateChange()):a.kind==="clear"&&(this.severtiyMap={},this.elementMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,c.AlarmSeverity.forEach(function(a){var b=this.getSumInfo(a);this.sumAcked+=b.ackedCount,this.sumNew+=b.newCount,this.sumTotal+=b.totalCount},this),this.firePropertyChange("alarmState",!1,!0)},getNewAlarmCount:function(a){if(!a)return this.sumNew;var b=this.getSumInfo(a);return b.newCount},getAcknowledgedAlarmCount:function(a){if(!a)return this.sumAcked;var b=this.getSumInfo(a);return b.ackedCount},getTotalAlarmCount:function(a){if(!a)return this.sumTotal;var b=this.getSumInfo(a);return b.totalCount},getSumInfo:function(a){var b=this.severtiyMap[a.name];return b||(b={},b.newCount=0,b.ackedCount=0,b.totalCount=0,this.severtiyMap[a.name]=b),b},decrease:function(a){var b=this.elementMap[a.getId()];b&&(delete this.elementMap[a.getId()],c.AlarmSeverity.forEach(function(a){var c=b[a.name],d=this.getSumInfo(a);d.newCount=d.newCount-c.newCount,d.ackedCount=d.ackedCount-c.ackedCount,d.totalCount=d.totalCount-c.totalCount},this))},increase:function(a){this.decrease(a);if(this._filterFunction&&!this._filterFunction(a))return;var b={};this.elementMap[a.getId()]=b,c.AlarmSeverity.forEach(function(c){var d={};d.newCount=a.getAlarmState().getNewAlarmCount(c),d.ackedCount=a.getAlarmState().getAcknowledgedAlarmCount(c),d.totalCount=a.getAlarmState().getAlarmCount(c),b[c.name]=d;var e=this.getSumInfo(c);e.newCount=e.newCount+d.newCount,e.ackedCount=e.ackedCount+d.ackedCount,e.totalCount=e.totalCount+d.totalCount},this)},reset:function(){this.severtiyMap={},this.elementMap={},this._elementBox.forEach(this.increase,this),this.fireAlarmStateChange()},setFilterFunction:function(a){var b=this._filterFunction;this._filterFunction=a,this.reset(),this.firePropertyChange("filterFunction",b,a)},getFilterFunction:function(){return _filterFunction}}),c.LayerBox=function(a){c.LayerBox.superClass.constructor.call(this),this._elementBox=a,this._defaultLayer=new c.Layer(Se.LAYER_DEFAULT_ID,Se.LAYER_DEFAULT_NAME),this.add(this._defaultLayer)},d.ext("twaver.LayerBox",c.DataBox,{_name:"LayerBox",getElementBox:function(){return this._elementBox},getDefaultLayer:function(){return this._defaultLayer},add:function(a,b){if(!a.ILayer)throw"Only ILayer can be added into LayerBox";c.LayerBox.superClass.add.apply(this,arguments)},removeById:function(a){if(a===this._defaultLayer.getId())throw"Cannot remove default layer";c.LayerBox.superClass.removeById.call(this,a)},getLayerByElement:function(a){if(!a)return null;if(a._layerId===Se.LAYER_DEFAULT_ID)return this._defaultLayer;var b=this.getDataById(a.getLayerId());return b?b:this._defaultLayer},clear:function(){this.toDatas().forEach(function(a){a!=this._defaultLayer&&this.removeById(a.getId())},this)}}),c.BundleLinks=function(a,b){this._links=a,this._siblings=b;var d,e,f=c.Styles.getStyle("link.bundle.expanded");for(d=0;d<a.size();d++){e=a.get(d);var g=e.getStyle("link.bundle.expanded",!1);if(g!=null){f=g;break}}f==null&&(f=!0);if(Se.LINK_BUNDLE_AGENT_FUNCTION){var h=Se.LINK_BUNDLE_AGENT_FUNCTION(a);h==null?h=a.get(0):h!=a.get(0)&&(a.remove(h),a.add(h,0))}for(d=0;d<a.size();d++)a.get(d).setStyle("link.bundle.expanded",f)},d.ext("twaver.BundleLinks",Object,{getLinks:function(){return this._links},getSiblings:function(){return this._siblings},forEachSiblingLink:function(a,b){this._siblings.forEach(function(c){c.getLinks().forEach(a,b)})}});var Te={bitsToNum:function(a){return a.reduce(function(a,b){return a*2+b},0)},byteToBitArr:function(a){var b=[];for(var c=7;c>=0;c--)b.push(!!(a&1<<c));return b},lzwDecode:function(a,b){var c=0,d=function(a){var d=0;for(var e=0;e<a;e++)b.charCodeAt(c>>3)&1<<(c&7)&&(d|=1<<e),c++;return d},e=[],f=1<<a,g=f+1,h=a+1,i=[],j=function(){i=[],h=a+1;for(var b=0;b<f;b++)i[b]=[b];i[f]=[],i[g]=null},k,l;for(;;){l=k,k=d(h);if(k===f){j();continue}if(k===g)break;if(k<i.length)l!==f&&i.push(i[l].concat(i[k][0]));else{if(k!==i.length)throw new Error("Invalid LZW code.");i.push(i[l].concat(i[l][0]))}e.push.apply(e,i[k]),i.length===1<<h&&h<12&&h++}return e}},Ue=function(a){this.data=a,this.len=this.data.length,this.pos=0};d.ext(Ue,Object,{readByte:function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return this.data.charCodeAt(this.pos++)&255},readBytes:function(a){var b=[];for(var c=0;c<a;c++)b.push(this.readByte());return b},read:function(a){var b="";for(var c=0;c<a;c++)b+=String.fromCharCode(this.readByte());return b},readUnsigned:function(){var a=this.readBytes(2);return(a[1]<<8)+a[0]}});var Ve=function(a){var b,c=a,d=null,e=null,f=null,g=0,h=null,i=null,j=null,l=!0,m=!0;this.frames=[],this.size={};var n=this,o=null,p=k.createElement("canvas");this.loaded=!1;var q=function(){d=null,e=null,h=f,f=null,i=null};this.doParse=function(){We(c,x)};var r=function(a){b=a,n.size.width=b.width,n.size.height=b.height},s=function(a){t(),q(),d=a.transparencyGiven?a.transparencyIndex:null,e=a.delayTime,f=a.disposalMethod},t=function(){if(!i)return;n.frames.push({data:i.getImageData(0,0,b.width,b.height),delay:e})},u=function(a){i||(i=p.getContext("2d"));var c=n.frames.length,e=a.lctFlag?a.lct:b.gct;c>0&&(h===3?i.putImageData(n.frames[g].data,0,0):g=c-1,h===2&&(j||i.clearRect(j.leftPos,j.topPos,j.width,j.height)));var f=i.getImageData(a.leftPos,a.topPos,a.width,a.height);a.pixels.forEach(function(a,b){a!==d&&(f.data[b*4+0]=e[a][0],f.data[b*4+1]=e[a][1],f.data[b*4+2]=e[a][2],f.data[b*4+3]=255)}),i.putImageData(f,a.leftPos,a.topPos),j=a},v=function(){},w=function(a){return function(b){a(b)}},x={hdr:w(r),gce:w(s),com:w(v),app:{NETSCAPE:w(v)},img:w(u),eof:function(a){t(),n.loaded=!0}}},We=function(a,b){b||(b={});var c=function(b){var c=[];for(var d=0;d<b;d++)c.push(a.readBytes(3));return c},d=function(){var b,c;c="";do b=a.readByte(),c+=a.read(b);while(b!==0);return c},e=function(){var d={};d.sig=a.read(3),d.ver=a.read(3);if(d.sig!=="GIF")throw new Error("Not a GIF file.");d.width=a.readUnsigned(),d.height=a.readUnsigned();var e=Te.byteToBitArr(a.readByte());d.gctFlag=e.shift(),d.colorRes=Te.bitsToNum(e.splice(0,3)),d.sorted=e.shift(),d.gctSize=Te.bitsToNum(e.splice(0,3)),d.bgColor=a.readByte(),d.pixelAspectRatio=a.readByte(),d.gctFlag&&(d.gct=c(1<<d.gctSize+1)),b.hdr&&b.hdr(d)},f=function(c){var e=function(c){var d=a.readByte(),e=Te.byteToBitArr(a.readByte());c.reserved=e.splice(0,3),c.disposalMethod=Te.bitsToNum(e.splice(0,3)),c.userInput=e.shift(),c.transparencyGiven=e.shift(),c.delayTime=a.readUnsigned(),c.transparencyIndex=a.readByte(),c.terminator=a.readByte(),b.gce&&b.gce(c)},f=function(a){a.comment=d(),b.com&&b.com(a)},g=function(c){var e=a.readByte();c.ptHeader=a.readBytes(12),c.ptData=d(),b.pte&&b.pte(c)},h=function(c){var e=function(c){var d=a.readByte();c.unknown=a.readByte(),c.iterations=a.readUnsigned(),c.terminator=a.readByte(),b.app&&b.app.NETSCAPE&&b.app.NETSCAPE(c)},f=function(a){a.appData=d(),b.app&&b.app[a.identifier]&&b.app[a.identifier](a)},g=a.readByte();c.identifier=a.read(8),c.authCode=a.read(3);switch(c.identifier){case"NETSCAPE":e(c);break;default:f(c)}},i=function(a){a.data=d(),b.unknown&&b.unknown(a)};c.label=a.readByte();switch(c.label){case 249:c.extType="gce",e(c);break;case 254:c.extType="com",f(c);break;case 1:c.extType="pte",g(c);break;case 255:c.extType="app",h(c);break;default:c.extType="unknown",i(c)}},g=function(e){var f=function(a,b){var c=new Array(a.length),d=a.length/b,e=function(d,e){var f=a.slice(e*b,(e+1)*b);c.splice.apply(c,[d*b,b].concat(f))},f=[0,4,2,1],g=[8,8,4,2],h=0;for(var i=0;i<4;i++)for(var j=f[i];j<d;j+=g[i])e(j,h),h++;return c};e.leftPos=a.readUnsigned(),e.topPos=a.readUnsigned(),e.width=a.readUnsigned(),e.height=a.readUnsigned();var g=Te.byteToBitArr(a.readByte());e.lctFlag=g.shift(),e.interlaced=g.shift(),e.sorted=g.shift(),e.reserved=g.splice(0,2),e.lctSize=Te.bitsToNum(g.splice(0,3)),e.lctFlag&&(e.lct=c(1<<e.lctSize+1)),e.lzwMinCodeSize=a.readByte();var h=d();e.pixels=Te.lzwDecode(e.lzwMinCodeSize,h),e.interlaced&&(e.pixels=f(e.pixels,e.width)),b.img&&b.img(e)},h=function(){var c={};c.sentinel=a.readByte();switch(String.fromCharCode(c.sentinel)){case"!":c.type="ext",f(c);break;case",":c.type="img",g(c);break;case";":c.type="eof",b.eof&&b.eof(c);break;default:throw new Error("Unknown block: 0x"+c.sentinel.toString(16))}c.type!=="eof"&&setTimeout(h,0)},i=function(){e(),setTimeout(h,0)};i()},Xe=function(a,b,c){var d=k.createElement("canvas");return Ye(d,b.width,b.height),d.getContext("2d").clearRect(0,0,b.width,b.height),d.getContext("2d").putImageData(a[c].data,0,0),d},Ye=function(a,b,c){a.width=b,a.height=c,a.style.width=b+"px",a.style.height=c+"px"};c.Data=function(a){c.Data.superClass.constructor.apply(this,arguments),this._childList=new Ce,this._childMap={},this._clientMap={};if(a===b||a===null)this._id=d.id();else if(typeof a=="string"||typeof a=="number"||typeof a=="boolean")this._id=a;else{for(var e in a)if(e==="clients")for(var f in a.clients)this._clientMap[f]=a.clients[f];else if(e==="styles")for(var g in a.styles)this._styleMap[g]=a.styles[g];else a[e]!=null&&(this["_"+e]=a[e]);this._id==null&&(this._id=d.id())}},d.ext("twaver.Data",c.PropertyChangeDispatcher,{IData:!0,IClient:!0,__client:1,__new:1,_parent:null,__accessor:["name","name2","icon","toolTip"],_icon:Se.ICON_DATA,getId:function(){return this._id},getChildren:function(){return this._childList},getChildrenSize:function(){return this._childList.size()},toChildren:function(a,b){return this._childList.toList(a,b)},addChild:function(a,c){c===b&&(c=this._childList.size());if(!a||a===this)return!1;if(this._childMap[a.getId()])return!1;if(this.isDescendantOf(a))return!1;a.getParent()&&a.getParent().removeChild(a);if(c<0||c>this._childList.size())c=this._childList.size();return this._childList.add(a,c),this._childMap[a._id]=a,a.setParent(this),this.firePropertyChange("children",null,a),this.onChildAdded(a,c),!0},onChildAdded:function(a,b){},removeChild:function(a){if(!a)return!1;if(!this._childMap[a._id])return!1;var b=this._childList.remove(a);return delete this._childMap[a._id],this.firePropertyChange("children",a,null),a.setParent(null),this.onChildRemoved(a,b),!0},onChildRemoved:function(a,b){},getChildAt:function(
a){return this._childList.get(a)},clearChildren:function(){if(this._childList.size()===0)return!1;var a=this._childList.toArray(),b=a.length;for(var c=0;c<b;c++)this.removeChild(a[c]);return this.onChildrenCleared(a),!0},onChildrenCleared:function(a){},getParent:function(){return this._parent},setParent:function(a){if(this._isUpdatingParent||this._parent===a||this===a)return;if(a&&a.isDescendantOf(this))return;var b=this._parent;this._parent=a,this._isUpdatingParent=!0,b&&b.removeChild(this),a&&a.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",b,a),this.onParentChanged(b,a)},onParentChanged:function(a,b){},hasChildren:function(){return this._childList.size()>0},isRelatedTo:function(a){return a?this.isDescendantOf(a)||a.isDescendantOf(this):!1},isParentOf:function(a){return a?this._childMap[a._id]!=null:!1},isDescendantOf:function(a){if(!a)return!1;if(!a.hasChildren())return!1;var b=this._parent;while(b){if(a===b)return!0;b=b.getParent()}return!1},toString:function(){return this.getName()?this.getName():this._id}}),c.Alarm=function(a,b,d,e,f){c.Alarm.superClass.constructor.call(this,a),this._elementId=b,this._alarmSeverity=d,this._acked=e||!1,this._cleared=f||!1},d.ext("twaver.Alarm",c.Data,{IAlarm:!0,getElementId:function(){return this._elementId},__accessor:["acked","cleared","alarmSeverity"]}),c.Layer=function(a){c.Layer.superClass.constructor.call(this,a)},d.ext("twaver.Layer",c.Data,{ILayer:!0,__accessor:["visible","movable","editable","rotatable"],_visible:!0,_movable:!0,_editable:!0,_rotatable:!0,_name:"Default"}),c.Element=function(a){this._styleMap=this._styleMap||{},this._alarmState=new c.AlarmState(this),c.Element.superClass.constructor.call(this,a)},d.ext("twaver.Element",c.Data,{IElement:!0,IStyle:!0,__accessor:["layerId"],__bool:["visible"],__style:1,_layerId:Se.LAYER_DEFAULT_ID,_visible:!0,getAlarmState:function(){return this._alarmState},isAdjustedToBottom:function(){return!1},getElementUIClass:function(){return null},getCanvasUIClass:function(){return null},getVectorUIClass:function(){return null},s:function(a,c){return c===b?this.getStyle(a):(this.setStyle(a,c),this)}}),c.Dummy=function(a){c.Dummy.superClass.constructor.call(this,a)},d.ext("twaver.Dummy",c.Element,{IDummy:!0});var Ze=function(a){this._location={x:0,y:0},Ze.superClass.constructor.call(this,a)};c.Node=Ze,Ze.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},d.ext("twaver.Node",c.Element,{_icon:Se.ICON_NODE,_image:Se.IMAGE_NODE,_angle:0,getLoopedLinks:function(){return this._loopedLinks},getLinks:function(){return this._links},getAgentLinks:function(){return this._agentLinks},getFollowers:function(){return this._followers},_addFollower:function(a){this._followers||(this._followers=new Ce),this._followers.add(a)},_removeFollower:function(a){this._followers.remove(a),this._followers.isEmpty()&&delete this._followers},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(a){this._allLinks||(this._allLinks=new Ce),this._fromLinks||(this._fromLinks=new Ce),this._allLinks.add(a),this._fromLinks.add(a),this._resetLinkSet()},_addToLink:function(a){this._allLinks||(this._allLinks=new Ce),this._toLinks||(this._toLinks=new Ce),this._allLinks.add(a),this._toLinks.add(a),this._resetLinkSet()},_removeFromLink:function(a){this._allLinks.remove(a),this._fromLinks.remove(a),this._allLinks.size()===0&&delete this._allLinks,this._fromLinks.size()===0&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(a){this._allLinks.remove(a),this._toLinks.remove(a),this._allLinks.size()===0&&delete this._allLinks,this._toLinks.size()===0&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){delete this._loopedLinks;if(!this._allLinks||this._allLinks.size()===0){delete this._links;return}var a;this._allLinks.forEach(function(b){b.isLooped()&&(a||(a={}),a[b._id]||(this._loopedLinks||(this._loopedLinks=new Ce),this._loopedLinks.add(b),a[b._id]=b))},this),a?(this._links=new Ce,this._allLinks.forEach(function(b){a[b._id]?a[b._id]!==!1&&(a[b._id]=!1,this._links.add(b)):this._links.add(b)},this)):this._links=this._allLinks},hasAgentLinks:function(){return this._agentLinks!=null&&!this._agentLinks.isEmpty()},getFromAgentLinks:function(){return this._fromAgentLinks},getToAgentLinks:function(){return this._toAgentLinks},_addFromAgentLink:function(a){this._fromAgentLinks||(this._fromAgentLinks=new Ce),this._allAgentLinks||(this._allAgentLinks=new Ce),this._fromAgentLinks.add(a),this._allAgentLinks.add(a),this._resetAgentLinkSet()},_addToAgentLink:function(a){this._toAgentLinks||(this._toAgentLinks=new Ce),this._allAgentLinks||(this._allAgentLinks=new Ce),this._toAgentLinks.add(a),this._allAgentLinks.add(a),this._resetAgentLinkSet()},_removeFromAgentLink:function(a){this._fromAgentLinks.remove(a),this._allAgentLinks.remove(a),this._fromAgentLinks.size()===0&&delete this._fromAgentLinks,this._allAgentLinks.size()===0&&delete this._allAgentLinks,this._resetAgentLinkSet()},_removeToAgentLink:function(a){this._toAgentLinks.remove(a),this._allAgentLinks.remove(a),this._toAgentLinks.size()===0&&delete this._toAgentLinks,this._allAgentLinks.size()===0&&delete this._allAgentLinks,this._resetAgentLinkSet()},_resetAgentLinkSet:function(){delete this._agentLinks;if(!this._allAgentLinks||this._allAgentLinks.size()===0)return;var a={};this._allAgentLinks.forEach(function(b){a[b._id]?this._agentLinks||(this._agentLinks=new Ce):a[b._id]=b},this),this._agentLinks?this._allAgentLinks.forEach(function(b){a[b._id]&&(this._agentLinks.add(b),delete a[b._id])},this):this._agentLinks=this._allAgentLinks},getImage:function(){return this._image},setImage:function(a){var b=this._image,c=this.getWidth(),d=this.getHeight();this._image=a,this.firePropertyChange("image",b,a),this.firePropertyChange("width",c,this.getWidth()),this.firePropertyChange("height",d,this.getHeight())},getX:function(){return this._location.x},getY:function(){return this._location.y},setX:function(a){this.setLocation(a,this._location.y)},setY:function(a){this.setLocation(this._location.x,a)},getLocation:function(){return this._location},setLocation:function(a,b){var c;arguments.length===2?c={x:arguments[0],y:arguments[1]}:c=arguments[0];if(!d.num(c.x)||!d.num(c.y))return;if(c.x===this._location.x&&c.y===this._location.y)return;var e=this._location;this._location=c,this.firePropertyChange("location",e,c)},getCenterLocation:function(){return Se.CENTER_LOCATION?this._location:{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},setCenterLocation:function(a,b){var c;arguments.length===2?c={x:arguments[0],y:arguments[1]}:c=d.clone(arguments[0]);if(!d.num(c.x)||!d.num(c.y))return;Se.CENTER_LOCATION||(c.x-=this.getWidth()/2,c.y-=this.getHeight()/2),this.setLocation(c)},translate:function(a,b){this.setLocation(this.getX()+a,this.getY()+b)},getWidth:function(){if(d.num(this._width)&&this._width>=0)return this._width;if(typeof this._image!="object"){var a=d.getImageAsset(this._image);if(a){var b=a.getWidth();return d.num(b)&&b>=0?b:(a=a._image,$d(this,a,a,"w"))}}else if(this._image)return this._image.w;return Se.NODE_WIDTH},setWidth:function(a){var b=this._width;this._width=a,this.firePropertyChange("width",b,a)},getHeight:function(){if(d.num(this._height)&&this._height>=0)return this._height;if(typeof this._image!="object"){var a=d.getImageAsset(this._image);if(a){var b=a.getHeight();return d.num(b)&&b>=0?b:(a=a._image,$d(this,a,a,"h"))}}else if(this._image)return this._image.h;return Se.NODE_HEIGHT},setHeight:function(a){var b=this._height;this._height=a,this.firePropertyChange("height",b,a)},setSize:function(){arguments.length===2?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getRect:function(){var a=this.getOriginalRect();if(this._angle===0)return a;var b=p.createMatrix(this._angle*Math.PI/180,a.x+a.width/2,a.y+a.height/2),c=[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}];for(var d=0,e=c.length;d<e;d++)c[d]=b.transform(c[d]);var f=p.getRect(c);return f},getOriginalRect:function(){var a=this,b=a.getWidth(),c=a.getHeight();return Se.CENTER_LOCATION?{x:a._location.x-b/2,y:a._location.y-c/2,width:b,height:c}:{x:a.getX(),y:a.getY(),width:b,height:c}},getAngle:function(){return this._angle},setAngle:function(a){var b=this._angle;this._angle=a%360,this.firePropertyChange("angle",b,this._angle)},onParentChanged:function(a,b){Ze.superClass.onParentChanged.call(this,a,b),this._checkLinkAgent()},_checkLinkAgent:function(){if(c._isInitializing){if(this._links){var a=this._links.size();for(var b=0;b<a;b++)this._links.get(b)._checkAgentNode()}}else c.ElementBox.prototype.startBatch(function(){if(this._links){var a=this._links.size();for(var b=0;b<a;b++)this._links.get(b)._checkAgentNode()}},this)},onPropertyChanged:function(a){Ze.superClass.onPropertyChanged.call(this,a);if(this._followers){var b=this._followers.size();for(var c=0;c<b;c++)this._followers.get(c).handleHostPropertyChange(a)}this.getParent()instanceof _e&&Ze.IS_INTERESTED_NODE_PROPERTY[a.property]&&this.getParent().updateLocationFromChildren()},getElementUIClass:function(){return c.network.NodeUI},getCanvasUIClass:function(){return c.canvas.NodeUI},getVectorUIClass:function(){return c.vector.NodeUI}});var $e=function(a){$e.superClass.constructor.call(this,a)};c.HTMLNode=$e,d.ext("twaver.HTMLNode",c.Node,{getElementUIClass:function(){return c.network.HTMLNodeUI},getCanvasUIClass:function(){return c.canvas.HTMLNodeUI},getVectorUIClass:function(){return c.vector.HTMLNodeUI}}),c.Link=function(a,b,d){c.Link.superClass.constructor.call(this,a instanceof Ze?null:a),a instanceof Ze&&(d=b,b=a),this.setFromNode(b),this.setToNode(d)},c.Link.IS_INTERESTED_BUNDLE_STYLE={"link.bundle.enable":1,"link.bundle.id":1,"link.bundle.independent":1},d.ext("twaver.Link",c.Element,{_fromNode:null,_toNode:null,_fromAgent:null,_toAgent:null,_icon:Se.ICON_LINK,getFromNode:function(){return this._fromNode},getToNode:function(){return this._toNode},getFromAgent:function(){return this._fromAgent},getToAgent:function(){return this._toAgent},setFromNode:function(a){if(this._fromNode===a)return;var b=this._fromNode;this._fromNode=a,b&&b._removeFromLink(this),this._fromNode&&this._fromNode._addFromLink(this),this._checkAgentNode(),this.firePropertyChange("fromNode",b,a)},setToNode:function(a){if(this._toNode===a)return;var b=this._toNode;this._toNode=a,b&&b._removeToLink(this),this._toNode&&this._toNode._addToLink(this),this._checkAgentNode(),this.firePropertyChange("toNode",b,a)},isLooped:function(){return this._fromNode===this._toNode&&this._fromNode!=null&&this._toNode!=null},_checkAgentNode:function(){c._isInitializing?c._links[this._id]||(c._links[this._id]=this):this._checkAgentNodeImpl()},_checkAgentNodeImpl:function(){var a=wd.figureFromAgent(this),b,d=this,e;this._fromAgent!=a&&(b=this._fromAgent,this._fromAgent&&this._fromAgent._removeFromAgentLink(this),this._fromAgent=a,this._fromAgent&&this._fromAgent._addFromAgentLink(this),this.firePropertyChange("fromAgent",b,this._fromAgent),c._isInitializing?(b&&this._toAgent&&(e=b._id+":"+this._toAgent._id,c._bundleLinks[e]||(c._bundleLinks[e]=[b,this._toAgent])),this._fromAgent&&this._toAgent&&(e=this._fromAgent._id+":"+this._toAgent._id,c._bundleLinks[e]||(c._bundleLinks[e]=[this._fromAgent,this._toAgent]))):(wd.resetBundleLinks(b,d._toAgent),wd.resetBundleLinks(d._fromAgent,d._toAgent)));var f=wd.figureToAgent(this);this._toAgent!=f&&(b=this._toAgent,this._toAgent&&this._toAgent._removeToAgentLink(this),this._toAgent=f,this._toAgent&&this._toAgent._addToAgentLink(this),this.firePropertyChange("toAgent",b,this._toAgent),c._isInitializing?(b&&this._fromAgent&&(e=b._id+":"+this._fromAgent._id,c._bundleLinks[e]||(c._bundleLinks[e]=[b,this._fromAgent])),this._toAgent&&this._fromAgent&&(e=this._toAgent._id+":"+this._fromAgent._id,c._bundleLinks[e]||(c._bundleLinks[e]=[this._toAgent,this._fromAgent]))):(wd.resetBundleLinks(b,d._fromAgent),wd.resetBundleLinks(d._toAgent,d._fromAgent)))},_setBundleLinks:function(a){this._bundleLinks=a,this.firePropertyChange("bundleLinks",!0,!1)},getBundleLinks:function(){return this._bundleLinks},getBundleCount:function(){return this._bundleLinks?this._bundleLinks.getLinks().size():1},getBundleIndex:function(){return this._bundleLinks?this._bundleLinks.getLinks().indexOf(this):0},reverseBundleExpanded:function(){if(this._bundleLinks&&this._bundleLinks.getLinks().size()>0){var a,b,c=this._bundleLinks.getLinks(),d=!this.getStyle("link.bundle.expanded");for(a=0;a<c.size();a++)b=c.get(a),b.setStyle("link.bundle.expanded",d);var e=this._bundleLinks.getSiblings();for(a=0;a<e.size();a++){var f=e.get(a);if(f!=this._bundleLinks){c=f.getLinks();for(var g=0;g<c.size();g++)b=c.get(g),b.firePropertyChange("bundleLinks",null,f)}}return!0}return!1},isBundleAgent:function(){return this._bundleLinks!=null&&this._bundleLinks.getLinks().size()>1&&this===this._bundleLinks.getLinks().get(0)&&!this.getStyle("link.bundle.expanded")},onStyleChanged:function(a,b,d){c.Link.superClass.onStyleChanged.call(this,a,b,d),c.Link.IS_INTERESTED_BUNDLE_STYLE[a]&&wd.resetBundleLinks(this._toAgent,this._fromAgent)},getElementUIClass:function(){return c.network.LinkUI},getCanvasUIClass:function(){return c.canvas.LinkUI},getVectorUIClass:function(){return c.vector.LinkUI},isAdjustedToBottom:function(){return Se.IS_LINK_ADJUSTED_TO_BOTTOM}}),c.HTMLLink=function(a,b,d){c.HTMLLink.superClass.constructor.call(this,a,b,d)},c.Util.ext("twaver.HTMLLink",c.Link,{getElementUIClass:function(){return c.network.HTMLLinkUI},getCanvasUIClass:function(){return c.canvas.HTMLLinkUI},getVectorUIClass:function(){return c.vector.HTMLLinkUI}}),c.Follower=function(a){this._isUpdatingFollower=!1,this._isUpdatingLocation=!1,c.Follower.superClass.constructor.call(this,a)},c.Follower.IS_INTERESTED_HOST_GRID_PROPERTY={location:1,width:1,height:1,"S:grid.row.count":1,"S:grid.column.count":1,"S:grid.row.percents":1,"S:grid.column.percents":1,"S:grid.border":1,"S:grid.border.left":1,"S:grid.border.right":1,"S:grid.border.top":1,"S:grid.border.bottom":1,"S:grid.padding":1,"S:grid.padding.left":1,"S:grid.padding.right":1,"S:grid.padding.top":1,"S:grid.padding.bottom":1},c.Follower.IS_INTERESTED_FOLLOWER_STYLE={"follower.row.index":1,"follower.column.index":1,"follower.row.span":1,"follower.column.span":1,"follower.padding":1,"follower.padding.left":1,"follower.padding.right":1,"follower.padding.top":1,"follower.padding.bottom":1},d.ext("twaver.Follower",Ze,{_host:null,getHost:function(){return this._host},setHost:function(a){if(this===a||this._host===a)return;var b=this._host;b&&b._removeFollower(this),this._host=a,this._host&&this._host._addFollower(this),this.firePropertyChange("host",b,a),this.onHostChanged(b,a)},onStyleChanged:function(a,b,d){c.Follower.superClass.onStyleChanged.call(this,a,b,d),c.Follower.IS_INTERESTED_FOLLOWER_STYLE[a]&&this.updateFollower(null)},setLocation:function(){if(this._isUpdatingLocation)return;this._isUpdatingLocation=!0,c.Follower.superClass.setLocation.apply(this,arguments),this._isUpdatingLocation=!1},onHostChanged:function(a,b){this.updateFollower(null)},handleHostPropertyChange:function(a){this.updateFollower(a)},updateFollower:function(a){if(this._isUpdatingFollower||d.isDeserializing)return;this._isUpdatingFollower=!0,this.updateFollowerImpl(a),this._isUpdatingFollower=!1},updateFollowerImpl:function(a){var b=this.getHost();if(b instanceof c.Grid){if(!a||c.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[a.property]){var d=this.getStyle("follower.row.index"),e=this.getStyle("follower.column.index"),f=b.getCellRect(d,e);if(!f)return;var g=this.getStyle("follower.row.span"),h=this.getStyle("follower.column.span");if(g!=1||h!=1){var i=b.getCellRect(d+g-1,e+h-1);i&&(f=p.unionRect(f,i))}p.addPadding(f,this,"follower.padding");if(this.getStyle("follower.fill.cell"))this.setLocation(f.x,f.y),this.setWidth(f.width),this.setHeight(f.height);else{var j=this.getStyle("follower.cell.position");f=r.get(j,f,this.getRect()),this.setLocation(f.x,f.y)}}}else if(a!=null&&a.property==="location"){var k=a.oldValue,l=a.newValue,m=this.getLocation();this.setLocation(m.x+(l.x-k.x),m.y+(l.y-k.y))}},isHostOn:function(a){if(!a)return!1;var b={},d=this._host;while(d&&d!=this&&!b[d.getId()]){if(d===a)return!0;b[d.getId()]=d,d instanceof c.Follower?d=d.getHost():d=null}return!1},isLoopedHostOn:function(a){return this.isHostOn(a)&&a.isHostOn(this)}});var _e=function(a){this._isUpdatingLocationFromChildren=!1,this._isAdjusting=!1,this._expanded=!1,_e.superClass.constructor.call(this,a)};c.Group=_e,d.ext("twaver.Group",c.Follower,{_image:Se.IMAGE_GROUP,_icon:Se.ICON_GROUP,isAdjustedToBottom:function(){return this.isExpanded()&&wd.hasAgentLinks(this)},onChildAdded:function(a,b){_e.superClass.onChildAdded.apply(this,arguments),this.updateLocationFromChildren()},onChildRemoved:function(a,b){_e.superClass.onChildRemoved.apply(this,arguments),this.updateLocationFromChildren()},updateLocationFromChildren:function(){if(this._isAdjusting||d.isDeserializing)return;var a,b=0,c=this.getChildrenSize(),e;for(;b<c;b++)e=this.getChildAt(b),e instanceof Ze&&(a=p.unionRect(a,this.getChildRect(e)));a&&(this._isUpdatingLocationFromChildren=!0,this.setLocation(a.x+a.width/2-this.getWidth()/2,a.y+a.height/2-this.getHeight()/2),this._isUpdatingLocationFromChildren=!1)},getChildRect:function(a){var b;return a instanceof Ze&&(a instanceof _e?(a.isExpanded()&&a.getChildren().forEach(function(c){b=p.unionRect(b,a.getChildRect(c))}),b||(b=a.getRect())):b=a.getRect()),b},setLocation:function(){if(this._isAdjusting)return;var a;arguments.length===2?a={x:arguments[0],y:arguments[1]}:a=arguments[0];if(!d.isDeserializing&&!this._isUpdatingLocationFromChildren){this._isAdjusting=!0;var b=a.x-this.getX(),c=a.y-this.getY();wd.moveElements(this.getChildren(),b,c),this._isAdjusting=!1}_e.superClass.setLocation.call(this,a)},reverseExpanded:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._expanded},setExpanded:function(a){if(this._expanded===a)return;var b=this._expanded;this._expanded=a,this.firePropertyChange("expanded",b,this._expanded),this._checkLinkAgent()},_checkLinkAgent:function(){_e.superClass._checkLinkAgent.call(this);var a=this.getChildrenSize();for(var b=0;b<a;b++){var c=this.getChildAt(b);c instanceof Ze&&c._checkLinkAgent()}},getElementUIClass:function(){return c.network.GroupUI},getCanvasUIClass:function(){return c.canvas.GroupUI},getVectorUIClass:function(){return c.vector.GroupUI}}),c.SubNetwork=function(a){c.SubNetwork.superClass.constructor.call(this,a)},d.ext("twaver.SubNetwork",c.Follower,{ISubNetwork:!0,_image:Se.IMAGE_SUBNETWORK,_icon:Se.ICON_SUBNETWORK,_checkLinkAgent:function(){c.SubNetwork.superClass._checkLinkAgent.call(this);var a=this.getChildrenSize();for(var b=0;b<a;b++){var d=this.getChildAt(b);d instanceof Ze&&d._checkLinkAgent()}}}),c.Grid=function(a){c.Grid.superClass.constructor.call(this,a)},d.ext("twaver.Grid",c.Follower,{_icon:Se.ICON_GRID,_image:null,getCellObject:function(a,b){arguments.length===1&&(b=a.y,a=a.x);var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count");for(var e=0;e<c;e++)for(var f=0;f<d;f++){var g=this.getCellRect(e,f);if(p.containsPoint(g,a,b))return{rowIndex:e,columnIndex:f,rect:g}}return null},getCellRect:function(a,b){var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count");if(c<=0||d<=0)return null;if(a<0||a>=c)return null;if(b<0||b>=d)return null;var e=this.getRect();p.addPadding(e,this,"grid.border");var f=0,g=this.getStyle("grid.row.percents"),h=this.getStyle("grid.column.percents");if(g&&g.length===c){var i=0;for(f=0;f<a;f++)i+=e.height*g[f];e.y+=i,e.height=e.height*g[a]}else e.height=e.height/c,e.y+=e.height*a;if(h&&h.length===d){var j=0;for(f=0;f<b;f++)j+=e.width*h[f];e.x+=j,e.width=e.width*h[b]}else e.width=e.width/d,e.x+=e.width*b;return p.addPadding(e,this,"grid.padding"),e},getElementUIClass:function(){return c.network.GridUI},getCanvasUIClass:function(){return c.canvas.GridUI},getVectorUIClass:function(){return c.vector.GridUI}}),c.ShapeNode=function(a){this._isUpdatingShapeNode=!1,this._points=new Ce,c.ShapeNode.superClass.constructor.call(this,a)},d.ext("twaver.ShapeNode",c.Follower,{_icon:Se.ICON_SHAPENODE,__accessor:["segments"],getElementUIClass:function(){return c.network.ShapeNodeUI},getCanvasUIClass:function(){return c.canvas.ShapeNodeUI},getVectorUIClass:function(){return c.vector.ShapeNodeUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new Ce),this._points=a,this.firePointsChange()},getSegments:function(){return this._segments},setSegments:function(a){a||(a=new Ce),this._segments=a,this._reCalculateLineLength(),this.firePointsChange()},addPoint:function(a,b){this._points.add(a,b),this.firePointsChange()},setPoint:function(a,b){this._points.set(a,b),this.firePointsChange()},removePoint:function(a){this._points.remove(a),this.firePointsChange()},removeAt:function(a){this._points.removeAt(a),this.firePointsChange()},setWidth:function(a){a<1&&(a=1);if(!this._isUpdatingShapeNode&&!d.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=0;b<this._points.size();b++){var e=this._points.get(b);e.x=(e.x-this.getX())*a/this.getWidth()+this.getX()}this.firePointsChange(),this._isUpdatingShapeNode=!1}c.ShapeNode.superClass.setWidth.apply(this,arguments)},setHeight:function(a){a<1&&(a=1);if(!this._isUpdatingShapeNode&&!d.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=0;b<this._points.size();b++){var e=this._points.get(b);e.y=(e.y-this.getY())*a/this.getHeight()+this.getY()}this.firePointsChange(),this._isUpdatingShapeNode=!1}c.ShapeNode.superClass.setHeight.apply(this,arguments)},setLocation:function(){if(!this._isUpdatingShapeNode&&!d.isDeserializing){var a;arguments.length===2?a={x:arguments[0],y:arguments[1]}:a=arguments[0];if(!d.num(a.x)||!d.num(a.y))return;var b=a.x-this.getX(),e=a.y-this.getY();if(b===0&&e===0)return;this._isUpdatingShapeNode=!0;for(var f=0;f<this._points.size();f++){var g=this._points.get(f);g.x+=b,g.y+=e}this.firePointsChange(),this._isUpdatingShapeNode=!1}c.ShapeNode.superClass.setLocation.apply(this,arguments)},firePointsChange:function(){if(!this._isUpdatingShapeNode&&!d.isDeserializing){var a=p.getRect(this._points);a?(this._isUpdatingShapeNode=!0,Se.CENTER_LOCATION?this.setLocation(a.x+a.width/2,a.y+a.height/2):this.setLocation(a.x,a.y),this.setWidth(a.width),this.setHeight(a.height),this._isUpdatingShapeNode=!1):(this._isUpdatingShapeNode=!0,this.setWidth(0),this.setHeight(0),this._isUpdatingShapeNode=!1)}this._reCalculateLineLength(),this.firePropertyChange("points",null,this._points)},_reCalculateLineLength:function(){this._points!=null&&this._points.size()>0?this._lineLength=p.calculateLineLength(this._points,this._segments):this._lineLength=0},getLineLength:function(){return this._lineLength}}),c.Bus=function(a){this._styleMap={},this._styleMap["vector.fill"]=!1,this._styleMap["shapenode.closed"]=!1,c.Bus.superClass.constructor.call(this,a)},d.ext("twaver.Bus",c.ShapeNode,{_icon:Se.ICON_BUS,firePointsChange:function(){var a=this._points.size();if(!d.isDeserializing&&a>=2){var b=this._points.get(0);for(var e=1;e<a;e++){var f=this._points.get(e);Math.abs(f.x-b.x)>Math.abs(f.y-b.y)?f.y=b.y:f.x=b.x,b=f}}c.Bus.superClass.firePointsChange.apply(this,arguments)}}),c.ShapeLink=function(a,b,d){this._points=new Ce,this._styleMap={},this._styleMap["link.bundle.enable"]=!1,c.ShapeLink.superClass.constructor.call(this,a,b,d)},d.ext("twaver.ShapeLink",c.Link,{_icon:Se.ICON_SHAPELINK,getElementUIClass:function(){return c.network.ShapeLinkUI},getCanvasUIClass:function(){return c.canvas.ShapeLinkUI},getVectorUIClass:function(){return c.vector.ShapeLinkUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new Ce),this._points=a,this.firePointsChange()},addPoint:function(a,b){this._points.add(a,b),this.firePointsChange()},setPoint:function(a,b){this._points.set(a,b),this.firePointsChange()},removePoint:function(a){this._points.remove(a),this.firePointsChange()},removeAt:function(a){this._points.removeAt(a),this.firePointsChange()},firePointsChange:function(){this.firePropertyChange("points",null,this._points)}}),c.ShapeSubNetwork=function(a){c.ShapeSubNetwork.superClass.constructor.call(this,a)},d.ext("twaver.ShapeSubNetwork",c.ShapeNode,{ISubNetwork:!0,_icon:Se.ICON_SHAPESUBNETWORK,_checkLinkAgent:function(){c.ShapeSubNetwork.superClass._checkLinkAgent.call(this);var a=this.getChildrenSize();for(var b=0;b<a;b++){var d=this.getChildAt(b);d instanceof Ze&&d._checkLinkAgent()}}}),c.LinkSubNetwork=function(){c.LinkSubNetwork.superClass.constructor.apply(this,arguments)},d.ext("twaver.LinkSubNetwork",c.Link,{ISubNetwork:!0,_icon:Se.ICON_LINKSUBNETWORK}),c.RotatableNode=function(a){c.RotatableNode.superClass.constructor.call(this,a)},d.ext("twaver.RotatableNode",c.Follower,{getWidth:function(){return this._angle==0?this._getOrignalWidth():this._getRotateRect().width},setWidth:function(a){},getHeight:function(){return this._angle==0?this._getOrignalHeight():this._getRotateRect().height},setHeight:function(a){},getElementUIClass:function(){return c.network.RotatableNodeUI},getCanvasUIClass:function(){return c.canvas.RotatableNodeUI},getVectorUIClass:function(){return c.vector.RotatableNodeUI},_getRotateRect:function(){var a=this._getOrignalWidth(),b=this._getOrignalHeight(),c=p.createMatrix(this._angle*Math.PI/180,a/2,b/2),d=[{x:0,y:0},{x:a,y:0},{x:a,y:b},{x:0,y:b}];for(var e=0,f=d.length;e<f;e++)d[e]=c.transform(d[e]);return p.getRect(d)},_getOrignalWidth:function(){return c.RotatableNode.superClass.getWidth.call(this)},_getOrignalHeight:function(){return c.RotatableNode.superClass.getHeight.call(this)}}),c.controls.ControlBase=function(){c.controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new Ce},d.ext("twaver.controls.ControlBase",c.PropertyChangeDispatcher,{addPool:function(a){this._pools.contains(a)||this._pools.add(a)},removePool:function(a){this._pools.remove(a)},adjustBounds:function(a){var b=this._view.style;b.position="absolute",b.left=a.x+"px",b.top=a.y+"px",b.width=a.width+"px",b.height=a.height+"px",this.invalidate&&this.invalidate()},getView:function(){return this._view},invalidate:function(a){this._invalidate||(this._invalidate=!0,d.callLater(this.validate,this,null,a))},validate:function(){if(!this._invalidate)return;this._invalidate=!1,this._view.offsetWidth===0&&this._view.offsetHeight===0&&this._reinvalidateCount!==null?(this._reinvalidateCount===b&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl()},validateImpl:function(){}}),c.controls.ViewBase=function(){c.controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new c.EventDispatcher,this._viewDispatcher=new c.EventDispatcher},d.ext("twaver.controls.ViewBase",c.controls.ControlBase,{__bool:["focusOnClick"],_focusOnClick:Se.FOCUS_ON_CLICK,getSelectionModel:function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},isShareSelectionModel:function(){return this._selectionModel==null},setShareSelectionModel:function(a){var b=this._selectionModel==null;if(b===a)return;a?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new c.SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",b,a)},removeSelection:function(){if(this.getSelectionModel().size()===0)return null;var a=this.getSelectionModel().toSelection();return a.forEach(function(a){this._box.remove(a)},this),a},selectAll:function(){var a=new Ce;return this._box.forEach(function(b){this.isVisible(b)&&a.add(b)},this),this.getSelectionModel().setSelection(a),a},isSelected:function(a){return this.getSelectionModel().contains(a)},isSelectable:function(a){return this.getSelectionModel().isSelectable(a)},getLabel:function(a){return a.getName()},getToolTip:function(a){return a.getToolTip()},getIcon:function(a){return a.getIcon()},getSelectColor:function(a){return Se.SELECT_COLOR},addViewListener:function(a,b,c){this._viewDispatcher.add(a,b,c)},removeViewListener:function(a,b){this._viewDispatcher.remove(a,b)},fireViewEvent:function(a){this._viewDispatcher.fire(a)},addInteractionListener:function(a,b,c){this._interactionDispatcher.add(a,b,c)},removeInteractionListener:function(a,b){this._interactionDispatcher.remove(a,b)},fireInteractionEvent:function(a){this._interactionDispatcher.fire(a)},invalidate:function(a){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),d.callLater(this.validate,this,null,a))},validate:function(){if(!this._invalidate)return;this._invalidate=!1,!h&&this._view.offsetWidth===0&&this._view.offsetHeight===0&&this._reinvalidateCount!==null?(this._reinvalidateCount===b&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):(this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating)}}),c.controls.View=function(){c.controls.View.superClass.constructor.apply(this,arguments)},d.ext("twaver.controls.View",c.controls.ViewBase,{_zoom:1,_maxZoom:Se.ZOOM_MAX,_minZoom:Se.ZOOM_MIN,getRootDiv:function(){return this._rootDiv},isValidEvent:function(a){return s.isValidEvent(this._view,a)},getAlarmFillColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b)return b.color}return null},getInnerColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:a.getStyle("inner.color")}return null},getOuterColor:function(a){if(a.IElement){var b=a.getAlarmState().getPropagateSeverity();return b?b.color:a.getStyle("outer.color")}return null},zoomOverview:function(a){var b=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(b,a)},getLogicalPoint:function(a){return s.getLogicalPoint(this._view,a,this.getZoom(),this._rootDiv)},centerByLogicalPoint:function(a,b,d){d&&c.animate.AnimateManager.endAnimate();var e=this._view.scrollWidth-this._view.clientWidth,f=this._view.scrollHeight-this._view.clientHeight,g=(a-this._view.clientWidth/this._zoom/2)*this._zoom,h=(b-this._view.clientHeight/this._zoom/2)*this._zoom;g<0&&(g=0),h<0&&(h=0),g>e&&(g=e),h>f&&(h=f),d?c.animate.AnimateManager.start(new c.animate.AnimateScrollPosition(this._view,g,h)):(this._view.scrollLeft=g,this._view.scrollTop=h)},panByOffset:function(a,b){a*=this.getZoom(),b*=this.getZoom();var c=this._view.scrollLeft+a,d=this._view.scrollTop+b,e=this._view.scrollWidth-this._view.clientWidth,f=this._view.scrollHeight-this._view.clientHeight;c<0&&(c=0),c>e&&(c=e),d<0&&(d=0),d>f&&(d=f);var g={x:(c-this._view.scrollLeft)/this.getZoom(),y:(d-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=c,this._view.scrollTop=d,g},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(a<0)return;var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getZoom()>a&&this.setZoom(a)},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(a<0)return;var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getZoom()<a&&this.setZoom(a,!1)},getZoom:function(){return this._zoom},onZoomChanged:function(a,b){},zoomIn:function(a){this.setZoom(this._zoom*Se.ZOOM_INCREMENT,a)},zoomOut:function(a){this.setZoom(this._zoom/Se.ZOOM_INCREMENT,a)},zoomReset:function(a){this.setZoom(1,a)},checkZoom:function(a){return a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a},setZoom:function(a,b){if(!d.num(a)||a<=0)return;a=this.checkZoom(a);if(a===this._zoom)return;b==null&&(b=Se.ZOOM_ANIMATE);if(b)c.animate.AnimateManager.start(new c.animate.AnimateZoom(this,a));else{var e=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,f=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,g=this._zoom;this._zoom=a,s.setZoom(this._rootDiv,a),this.firePropertyChange("zoom",g,a),this.onZoomChanged(g,a),this.centerByLogicalPoint(e,f,!1)}
},setTouchZoom:function(a){this.setZoom(a,!1)}}),function(){var a=function(a,b,d,e){var f=new l;f.src=e,c.Util.registerImage(a,f,b,d)};a("subnetwork_image",64,46,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC"),a("bus_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC"),a("data_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=="),a("databox_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII="),a("grid_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=="),a("group_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=="),a("group_image",32,29,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC"),a("link_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=="),a("linksubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII="),a("node_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=="),a("node_image",30,32,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAgCAYAAAAFQMh/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAO0SURBVHjavJZJaF1lGIaffzzn3pvbxAyYJulgNKJIF7WkuhEHFCy40LpRBLdFcFi4ciOCC9dmU910WbduBEEoRhFEarJw2UaLJXFImya5ubln+AcX5+YG3ZjCaT44cDb/+5zv/Ybzi7npo7Mhhi+886c5hFBaLUshX9dKq8tW2bPjExOHweXW+vpZ7/1lrZWanz52jK+//f5QwC8+8xSrN2/Oa2OM10pJgKwoWd/cRQpRKyzEyMRIk9QatFIYY7xOEou1BoD1zS6ff/kTqbW1grtZyVsvz3N8cgRrDUli0dZabB+kpGSkYdHWUGfOSkT6prLH04m1GFOBBaAkKBkQsU5wACpBYyyJtfSt1hVYVGDZf68rpNjXs1b3rU72rZaAlhFJRMj6wJUm+1bv1diYqrmEFCgJQtaf8Z6gMaaqcbPRpJGmgxprCYhYK1iL/YwbaUqz0UTneUFeusG8uRARNYPLEAn95spLR54X6K+uLDI1NQ3A7e0ey3+UtBJDnfO004vc6WRMjg3zzeIPrK2toje3O6StLWII7GYFt7qOPNS7uTo9x25WEENgY2uLze0Oem9xhOBwwZM5j3WyVnDmPC54QnAoWWlrgBgj3nuc9+yWHq3rBe+Wlbb3nhjjPhiowM7TdQ7t6rW66xzOVeBBpw/AzlM4z3bpkTVnvF1W2t79B1xZXVI4x3bpUfcE7PC+/LfVUgic80giY6lhJDG1gmUESawY/QWhG0aLxBh2dnoMqcBrpyawNWdcuMCQCuzs9EiMoWG00GPDR2QrMVxdWqIsch5L1cCOukJowerKn/x9M6GVGMaGj0hx+uEHrypjzzwwN0cI4Z7et6SU/HbtGr4sftbNVvN9a5NP1m78elpK6a0x9wRalCUhBNUeai0Xhf5ASykXh4fbbxo9+nin2y2v3/i9B3jq29YRUA+dPN5ot1qmdOXS7dvldfHIiRky5wBJt9djfePONHA/4Or6KwJ/TYzet9pqNIBAqjVianSEtY1NgCeBd4FTQBuoq+AS6AC/AAvAj1OjIzAzPoqS8pyAFQHx/x4gzs7OxosXP4ufLizEkydORA5wrv+sKCnPzYyPooFHh5vppQiTB/n8PMt47523Of/qebIsY7fT4eOPPiRJkoMcnxVwCXhOH2kPXWi3WpMH7s48J5Ql1tpq3p3j6Pj44MJ4gJgUUlwQzz5xpgMMHbhFYyRNU55+/gWC93x35Qp5niHu7q60I9545aUeoO5qPkJAqupICOFuoQD+nwEAIKWd899qAZAAAAAASUVORK5CYII="),a("shapelink_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII="),a("shapenode_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC"),a("shapesubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII="),a("subnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII="),a=function(a,b,d,e){c.Util.registerImage(a,e,b,d)},a("expand_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=="),a("collapse_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7"),a("close_icon",11,11,"data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs="),a("sort_desc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs="),a("sort_asc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs="),a("submenu_enable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAA7SURBVHjafI9BDgAgDMKqH3c/ryd1iTqOpARARQUYJG0/AWboB2yoAgTG8jtvtXvMSUdVEdXIeN2cAwDPLmAjfDYS7AAAAABJRU5ErkJggg=="),a("submenu_disable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABKSURBVHjafM9BDoAgDETRD1cTz0W9luDZxhUBCjpJkzZ9m0ESkrhLzW0fJ9JjpT4Zl+juBXmwoB0ACH/gOtNhX2B6AjDUtF3NdwAU6zx4LEQe5AAAAABJRU5ErkJggg=="),a("checkbox_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAflJREFUeNqkk09oE1EQxn+7btyIYBRCbayFtlhEtLeAin+KouDNo548eJHCQkFQC1K0Bw8VqT1EVIqo0IMUvejNg6AIIglSsdSCiA0WolaIOWi3+2fGw242CRFBHPjg8d7MfPO+mTEcxzkNDAF5/s1KwE0cxylWKhX1fV89r44gget6bVhd9bRcLqvjOEULyGezWTwvAMAwjIRCRAnD8I/0nZ05gLwZOTYeVBXQOIGgqgk+flrk3MUxVBWRyMeMw5oCG2eREFVBVZibf8+x4ydZLH9GVRISq5W5uXwhDKPSvnz9xolTZ/A29GNZFiJ1kjhBnVFVEw0a7MrQ8HlqbMZwXeYXlpL7ti/Usbz8Hd8PEBGmHzxk9kMVfI+BrWt4PHM/0abtC67r8vTZC4qlWY4c2s/Azh2MTxQwpIPduzZx99Z1bNtu1yBiFp6/fMXr4ht+/NzI+MQNBg/sxdccPbmAqcI1UqkUEresTQMR5ejhQbb19XJ25BJzC8Lbd3dIp22mCtPY9tokuDmB2VyBqtDb082VyxdYv26JXysrTF4dY0uuI3lvoKWCaOoMA1SF7q4u7t2eZObREw7u25MMTbPF8VGCqHNRB4IgQFXY3t/H6MhwLFirGYZBfeItoFSr1fKZTAbVaPbT6fRf19A0TarVKkDJ+N91/j0A8Y5o3Yt7KRAAAAAASUVORK5CYII="),a("checkbox_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAiUlEQVR42qXM3QYFIRiF4d3dJpIhI5FKJCOSSHe7f9gn4ztZo3Wwzt6HvTbHfhdCeD8Nvw27Ad57OI4xUsA5BwMpJQpYa2Eg50wBYwwMlFIocJ4nDFzXRQGtNQzUWilwHAcMtNYooJSCgd47BaSUMDDGoIAQAgbmnBTgnMPAWosCcP3fDdjZNvABvRhVEQglsV8AAAAASUVORK5CYII="),a("radiobutton_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXFJREFUeNrUUz9rwkAUv0syBVxMm01L2lIdilOg4BcQ7eKcIV/AqZAxo1/B2a/QoSSTH6AQCoFMJUSig5C0EiPEv8G+Z604eJNTHxz37vf73Y977+7obrcjlwRHLoyLDYTThWmav6AgKDA9wrg6UF8wvO12O8RFt9s9bwACwvP8U6lUajWbzbYsy/eIR1Hk27b9GgSBlef5O7OEzWZzC5ufNU17gc01gEQcmCOGHGqYJaxWq1qj0WhzHFfwfZ84jrPHVVUliqIUkPM87wOg4KzBcrm8liTpbr1ek8FgQNI03eOz2Yzouk6QQw3zBFmWUewDxnQ6JUmSHHsDRz9qmD0A8ns8HgcortfrRxxzxJBDDfMEi8XC7ff7b4Zh3FSr1UKlUtnjlFI0mCOHGqZBHMd+GIbWZDIROp1OCxqH74HA9Q17vZ7luq4liqJ/uoee/oVyufxX/wPctwqpfKAieB9OsVj8xMVoNDpv8D8/048AAwDskrF8QGeJUgAAAABJRU5ErkJggg=="),a("radiobutton_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATVJREFUeNrUU71qhEAQ9q8S0mhip3C5kCpcFcgjiJfmal/BKr2lr2DtK1wR9BkCaYRUQTzUQtDE5sB/MTOJAQs3jVUGhp2Z75vPnV2XHseRWmMMtdJWC3DzxDTNnyLHbWC5A7+coA/wt77vT5hYlrUsAASKZdkHWZb3mqYdJEm6wXqWZYHneccwDN1hGF6II3Rddw3Nj7quP0HzDko8OsZYQww5RIGmaXaqqh4YhrnA3cwda4ghh3gGdV1fiaK4bdt28cAQQw5RoCxLGr/2lyGHOAKAn0mShDAnteSIIYcoUFWV7zjOM5DPuJPfxik+I4Yc4gh5ngdRFLlpmnKGYew3YFiH6zvZtu36vu/yPB/Me+j5W1AU5XstiuIW7vseQmmCMvg/XgVBeMckjuNlgf/5mL4EGAAhHbltcqEYDQAAAABJRU5ErkJggg==")}(),n.__tree=function(a,b){a._rootVisible=!0,a._initTree=function(a){this._rootData=null,this._expandMap={},this._levelMap={}},a.validateModel=function(){this._rowDatas.clear(),this._levelMap={},this._dataRowMap={},this._currentLevel=0,this._rootData?this._rootVisible?this.isVisible(this._rootData)&&this._buildData(this._rootData):this._buildChildren(this._rootData):this._buildChildren(),delete this._currentLevel},a._buildData=function(a){this._dataRowMap[a.getId()]=this._rowDatas.size(),this._rowDatas.add(a),this._levelMap
[a.getId()]=this._currentLevel,this.isExpanded(a)&&(this._currentLevel++,this._buildChildren(a),this._currentLevel--)},a._buildChildren=function(a){var b=a?a.getChildren():this._box.getRoots(),c=this.getCurrentSortFunction();c&&this.isChildrenSortable(a)?b.toList(this.isVisible,this).sort(c).forEach(function(a){this._buildData(a)},this):b.forEach(function(a){this.isVisible(a)&&this._buildData(a)},this)},a.getLevel=function(a){return this._levelMap[a.getId()]},a.getToggleImage=function(a){return a.getChildrenSize()>0?this.isExpanded(a)?this._expandIcon:this._collapseIcon:null},a.isCheckable=function(a){return this.isCheckMode()},a.isCheckMode=function(){return n.__tree._checkMap[this._checkMode]===1},a.isChildrenSortable=function(a){return!0},a.handleDataBoxChange=function(a){a.kind==="remove"?delete this._expandMap[a.data.getId()]:a.kind==="clear"&&(this._expandMap={}),this.invalidateModel()},a.isExpanded=function(a){return this._expandMap[a.getId()]===1},a.expand=function(a){if(this.isExpanded(a))return;var b=a.getParent();while(b!=null&&b!==this._rootData)this._expandMap[b.getId()]=1,b=b.getParent();this._expandMap[a.getId()]=1,this.invalidateModel()},a.collapse=function(a){if(!this.isExpanded(a))return;delete this._expandMap[a.getId()],this.invalidateModel()},a.expandAll=function(){this._box.forEach(function(a){this._expandMap[a.getId()]=1},this),this.invalidateModel()},a.collapseAll=function(){this._expandMap={},this.invalidateModel()},a._handleClick=function(a){this.isFocusOnClick()&&c.Util.setFocus(this._view);if(this._isValidating)return;var b;if(a.target._expandData)b=a.target._expandData,this.isExpanded(b)?(this.collapse(b),this.fireInteractionEvent({kind:"collapse",data:b})):(this.expand(b),this.fireInteractionEvent({kind:"expand",data:b}));else if(a.target._selectData||a.target.parentNode._selectData){this._handlePressSelection(a.target._selectData||a.target.parentNode._selectData,a);if(this.isCheckMode()){var d=this.getRowIndexAt(a);d>=0&&this.__handleClick(a)}}else this._treeColumn?(b=this.getDataAt(a),b&&(this.isCheckMode()?a.target._checkData||this.__handleClick(a):this._handlePressSelection(b,a))):this.isCheckMode()&&!a.target._checkData&&this.__handleClick(a);this._currentEditor&&!this._isCommitting&&(this._isCommitting=!0,this.commitEditValue(this._currentEditor._editInfo,this._currentEditor));if(this.updateCurrentEditor){var e=this;setTimeout(function(){e.updateCurrentEditor(a)},0)}},a.__handleClick=function(a){var b=this.getDataAt(a),c=this.getRowIndexByData(b);if(this._focusedRow!==c){var d=this._rowDatas.get(this._focusedRow);this._focusedRow=c,d&&this.invalidateData(d),this.invalidateData(b)}},a.handleChange=function(a){if(this._isCommitting||this._isCanceling||this._isValidating)return;var b=a.target._checkData;if(b){var c=this.isSelected(b),e=this.getSelectionModel(),f;if(this._checkMode==="default")c?e.removeSelection(b):e.appendSelection(b);else if(this._checkMode==="children")f=new Ce(b),f.addAll(b.getChildren());else if(this._checkMode==="descendant")f=new Ce,d.fillDescendant(b,f);else if(this._checkMode==="descendantAncestor"){f=new Ce,d.fillDescendant(b,f);if(!c){var g=b.getParent();while(g)f.add(g),g=g.getParent()}}c?e.removeSelection(f):e.appendSelection(f)}a.target._editInfo&&this.commitEditValue&&(this._isCommitting=!0,this.commitEditValue(a.target._editInfo,a.target))},a.onLabelRendered=function(a,b,c,d,e,f){},a._renderTree=function(a,b,c,e){var f=this._levelMap[b.getId()],g=this.getToggleImage(b),h=this.getLineType(),i=this._indent,j=this.__spanPool.get();g?j.style.width=this._indent*f+"px":j.style.width=this._indent*(f+1)+"px",j.style.display="inline-block",j.style.position="relative",j.style.verticalAlign="top",j.style.margin="0px 1px 0px 1px",j.style.width=(f+1)*i+"px",a.appendChild(j);var k=b,l=k.getParent(),m=0;if(h==="dotted"||h==="solid"){if(l==null){var n=this.getIcon(b);this._addLine(j,b,n,!0)}while(l!==null){var o=l.getChildren(),p=k===o.get(o.size()-1),n=this.getIcon(k);k.setClient("isLast",p),m==0&&this._addLine(j,b,n,p),m++,k=l,l=l.getParent()}}if(g){var q=this.__imagePool.get();q.setAttribute("src",d.getImageSrc(g)),q.style.verticalAlign="middle",q._expandData=b,q.style.position="absolute",q.style.right="0px",q.style.top=this.getRowHeight()/2-q.height/2+"px",j.appendChild(q)}var r=this.isCheckable(b),s=this.getUncheckableStyle()==="disabled";if(r||s){var t=this._addCheckBox(a,b,e);t.disabled=!r}var n=this.getIcon(b);if(n){var u=this.isCheckMode()||this._treeColumn?null:b;this._addIcon(a,b,n,u)}var v=this.getLabel(b);v&&(j=this.__textPool.get(),j.style.whiteSpace="nowrap",j.style.verticalAlign="middle",j.style.padding="1px 2px 1px 2px",d.setText(j,v,this._treeColumn?this._treeColumn.isInnerText():this._innerText),!this.isCheckMode()&&!this._treeColumn?(j._selectData=b,j.style.backgroundColor=e?this.getSelectColor(b):""):this._focusedRow===c&&(j.style.backgroundColor=this.getSelectColor(b)),this.onLabelRendered(j,b,v,c,f,e),a.appendChild(j))}},n.__tree._checkMap={"default":1,children:1,descendant:1,descendantAncestor:1},c.Column=function(a){c.Column.superClass.constructor.call(this,a)},d.ext("twaver.Column",c.Data,{IColumn:!0,__property:1,__accessor:["width","horizontalAlign","valueType","propertyType","propertyName","editable","visible","sortable","resizable","movable","sortDirection","sortFunction","enumInfo"],__bool:["innerText"],_innerText:Se.COLUMN_INNER_TEXT,_width:Se.COLUMN_WIDTH,_horizontalAlign:Se.COLUMN_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Se.COLUMN_PROPERTY_TYPE,_valueType:Se.COLUMN_VALUE_TYPE,_editable:Se.COLUMN_EDITABLE,_sortable:Se.COLUMN_SORTABLE,_visible:Se.COLUMN_VISIBLE,_resizable:Se.COLUMN_RESIZABLE,_movable:Se.COLUMN_MOVABLE,_sortDirection:"asc",_sortFunction:Se.SORT_FUNCTION,_enumInfo:null,renderCell:Se.COLUMN_RENDER_CELL,renderHeader:Se.COLUMN_RENDER_HEADER,setParent:function(a){throw"parent not supported"}}),c.ColumnBox=function(a){c.ColumnBox.superClass.constructor.apply(this,arguments)},d.ext("twaver.ColumnBox",c.DataBox,{_name:"ColumnBox",add:function(a,b){if(!a.IColumn)throw"Only IColumn can be added into ColumnBox";c.ColumnBox.superClass.add.apply(this,arguments)}}),c.Property=function(a){c.Property.superClass.constructor.call(this,a)},d.ext("twaver.Property",c.Data,{IProperty:!0,__property:1,__accessor:["horizontalAlign","valueType","editable","propertyType","propertyName","categoryName","enumInfo"],__bool:["innerText"],_innerText:Se.PROPERTY_INNER_TEXT,_horizontalAlign:Se.PROPERTY_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Se.PROPERTY_PROPERTY_TYPE,_valueType:Se.PROPERTY_VALUE_TYPE,_editable:Se.PROPERTY_EDITABLE,_categoryName:Se.PROPERTY_CATEGORY_NAME,_enumInfo:null,renderName:Se.PROPERTY_RENDER_NAME,renderValue:Se.PROPERTY_RENDER_VALUE,isVisible:null,renderEditor:Se.PROPERTY_RENDER_EDITOR,setParent:function(a){throw"parent not supported"},setPropertyName:function(a){var b=this._propertyName;this._propertyName=a,this.firePropertyChange("propertyName",b,a)},setPropertyType:function(a){var b=this._propertyType;this._propertyType=a,this.firePropertyChange("propertyType",b,a)}}),c.PropertyBox=function(a){c.PropertyBox.superClass.constructor.apply(this,arguments)},d.ext("twaver.PropertyBox",c.DataBox,{_name:"PropertyBox",add:function(a,b){if(!a.IProperty)throw"Only IProperty can be added into PropertyBox";c.PropertyBox.superClass.add.apply(this,arguments)}}),c.Tab=function(a){c.Tab.superClass.constructor.call(this,a)},d.ext("twaver.Tab",c.Data,{ITab:!0,__accessor:["view","width","closable","resizable","movable","disabled","visible"],_icon:null,_width:Se.TAB_WIDTH,_closable:Se.TAB_CLOSABLE,_resizable:Se.TAB_RESIZABLE,_movable:Se.TAB_MOVABLE,_disabled:Se.TAB_DISABLED,_visible:Se.TAB_VISIBLE,setParent:function(a){throw"parent not supported"}}),c.TabBox=function(a){c.TabBox.superClass.constructor.apply(this,arguments),this.getSelectionModel().setSelectionMode("singleSelection")},d.ext("twaver.TabBox",c.DataBox,{_name:"TabBox",add:function(a,b){if(!a.ITab)throw"Only ITab can be added into TabBox";c.TabBox.superClass.add.apply(this,arguments)}}),c.controls.ListBase=function(a){c.controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new Ce,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new c.Pool("div",20),this.__imagePool=new c.Pool("img",20),this.__canvasPool=new c.Pool("canvas",20),this.__spanPool=new c.Pool("span",20),this.__textPool=new c.Pool("span",20),this.__checkBoxPool=new c.Pool("input",20),this.__linePool=new c.Pool("canvas",20),this._pools.add(this.__divPool),this._pools.add(this.__linePool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=s.createView("auto",!0),this._rootDiv=s.createDiv(),this._dataDiv=s.createDiv(),this._dataDiv.style.width="1px",this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new c.DataBox);var b=this;b.handleChange&&b._view.addEventListener("change",function(a){b.handleChange(a)},!1);var d;m.isMSToucheable?d=c.controls.ListBaseMSTouchInteraction:m.isTouchable?d=c.controls.ListBaseTouchInteraction:d=c.controls.ListBaseInteraction,d&&new d(this)},d.ext("twaver.controls.ListBase",c.controls.View,{__bool:["innerText"],_innerText:Se.LISTBASE_INNER_TEXT,getDataDiv:function(){return this._dataDiv},getStartRowIndex:function(){return this._startRowIndex},getEndRowIndex:function(){return this._endRowIndex},getRowDatas:function(){return this._rowDatas},getRowIndexByData:function(a){return this._dataRowMap[a.getId()]},getRowIndexById:function(a){return this._dataRowMap[a]},getRowSize:function(){return this._rowDatas.size()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)},onPropertyChanged:function(a){a.property==="zoom"?this.invalidate():this.invalidateModel()},invalidateModel:function(){if(this._invalidateModel)return;this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate()},invalidateDisplay:function(){if(this._invalidateDisplay)return;this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate()},invalidateData:function(a){if(this._invalidateDisplay)return;this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[a.getId()]=a,this.invalidate()},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},s.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var c;if(this._invalidateDatas){for(c in this._invalidateDatas){var e=this._renderMap[c];e&&(s.release(e),this._dataDiv.removeChild(e),delete this._renderMap[c])}this._invalidateDatas=null}var f=this._view.scrollTop/this._zoom,g=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(f/this._rowHeight)-2,this._endRowIndex=Math.ceil((f+g)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());var h=this._rowHeight-this._rowLineWidth-2+"px",i=this._rowLineWidth+"px";for(var j=this._startRowIndex;j<this._endRowIndex;j++){var k=this._rowDatas.get(j);c=k.getId();var l=this._renderMap[c];if(!l){l=this.__divPool.get();var m=l.style;m.position="absolute",m.whiteSpace="nowrap",m.lineHeight=h,m.top=j*this._rowHeight+"px",m.borderStyle="solid",m.borderWidth="0px",m.borderBottomWidth=i,m.borderBottomColor=this._rowLineColor,m.opacity=k.getStyle?k.getStyle("whole.alpha"):1,this._dataDiv.appendChild(l),this._renderMap[c]=l;var n=this.isSelected(k);this.renderData(l,k,j,n),this.onDataRendered(l,k,j,n)}}d.keys(this._renderMap).forEach(function(a){var b=this.getRowIndexById(a);if(b<this._startRowIndex||b>=this._endRowIndex){var c=this._renderMap[a];s.release(c),this._dataDiv.removeChild(c),delete this._renderMap[a]}},this),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b),this.adjustRowSize(),this.onValidated()},adjustRowSize:function(){var a,b,c=this._rowHeight-this._rowLineWidth+"px",d=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(a in this._renderMap)b=this._renderMap[a],b.style.height=c,b.style.width=d},onValidated:function(){},onDataRendered:function(a,b,c,d){},_addCheckBox:function(a,b,c){var d=this.__checkBoxPool.get();return d.keepDefault=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d._checkData=b,d.checked=c,d.disabled=!1,a.appendChild(d),d},_addIcon:function(a,b,c,e){var f=d.getImageAsset(c),g=this.getInnerColor(b),h=this.getOuterColor(b),i=this.getAlarmFillColor(b),j;if(f&&f.getImage()){var k=f.getWidth(),l=f.getHeight();j=this.__canvasPool.get(),j.style.verticalAlign="middle",j.setAttribute("width",k),j.setAttribute("height",l);var m=j.getContext("2d");m.clearRect(0,0,k,l);var n={x:0,y:0,width:k,height:l};Od(m,c,g,n,b,this),h&&(m.lineWidth=2,m.strokeStyle=h,m.beginPath(),m.rect(0,0,k,l),m.closePath(),m.stroke()),i&&(m.fillStyle=t.createRadialGradient(m,i,"white",1,l-9,8,8,.75,.25),m.beginPath(),m.arc(5,l-5,4,0,Math.PI*2,!0),m.closePath(),m.fill())}else j=this.__imagePool.get(),j.style.verticalAlign="middle",j.setAttribute("src",d.getImageSrc(c));j.style.margin="0px 1px 0px 1px",j._selectData=e,a.appendChild(j)},_addLine:function(a,b,c,e){var f=this.__linePool.get(),g=d.getImageAsset(c),h=this,i=this.getToggleImage(b),j=this._levelMap[b.getId()],k=this._indent,l,m,n=k,o=k,p=0,q=this.isCheckable(b),r=this.getUncheckableStyle()==="disabled";p=2,g&&(n=g.getWidth(),o=g.getHeight()),e?(l=(j+p-1)*k+n,m=this.getRowHeight()):(l=(j+p-1)*k+n,m=this.getRowHeight()),a.style.width=(j+p-1)*k+"px",a.style.height=m+"px";var s=this.getLineType(),t=this.getLineColor(),u=this.getLineAlpha(),v=this.getLineThickness(),w=this.getLineDash(),x=d.getImageSrc(i);f.style.verticalAlign="top",f.style.margin="0px 0px 0px 0px",f.style.zIndex=-1,f.setAttribute("width",l),f.setAttribute("height",m);var y=f.getContext("2d");y.lineWidth=v,y.strokeStyle=t,y.globalAlpha=u,s==="dotted"&&y.setLineDash(w);var z=(j+p)*2;if(e){var A=b,B=A.getParent();y.clearRect(0,0,l,m);var C={x:0,y:0,width:l,height:m};B===null&&b.getChildrenSize()!==0&&this.isExpanded(b)&&(y.moveTo((j+p+1)*l/z,m/2+o/2),y.lineTo((j+p+1)*l/z,m),y.stroke());for(var D=j*2-1;D>=1;D-=2){if(A.getClient("isLast")){A=B,B=A.getParent();if((D+1)/2!=j)continue}else A=B,B=A.getParent();D==j*2-1?(y.moveTo((D+p)*l/z,0),y.lineTo((D+p)*l/z,m/2),y.stroke(),y.moveTo((D+p)*l/z,m/2),y.lineTo((D+p+1)*l/z,m/2),y.stroke(),b.getChildrenSize()!==0&&this.isExpanded(b)&&(y.moveTo((D+p+2)*l/z,m/2+o/2),y.lineTo((D+p+2)*l/z,m),y.stroke())):(y.moveTo((D+p)*l/z,0),y.lineTo((D+p)*l/z,m),y.stroke())}}else{var A=b,B=A.getParent();y.clearRect(0,0,l,m);var C={x:0,y:0,width:l,height:m};for(var D=j*2-1;D>=1;D-=2){if(A.getClient("isLast")){A=B,B=A.getParent();if((D+1)/2!=j)continue}else A=B,B=A.getParent();y.moveTo((D+p)*l/z,0),y.lineTo((D+p)*l/z,m),y.stroke(),D==j*2-1&&(y.moveTo((D+p)*l/z,m/2),y.lineTo((D+p+1)*l/z,m/2),y.stroke(),b.getChildrenSize()!==0&&this.isExpanded(b)&&(y.moveTo((D+p+2)*l/z,m/2+o/2),y.lineTo((D+p+2)*l/z,m),y.stroke()))}}return a.appendChild(f),f},isVisible:function(a){return this._box.contains(a)?this._visibleFunction?this._visibleFunction(a):!0:!1},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){a.property==="parent"?this.invalidateModel():this.invalidateData(a.source)},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){a.datas.forEach(function(a){this.invalidateData(a)},this),this.onSelectionChanged(a)},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowDatas.size()?c:-1},getDataAt:function(a){var b=this.getRowIndexAt(a);return b>=0?this._rowDatas.get(b):null},getCurrentSortFunction:function(){return this._sortFunction},validateModel:function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var a=this.getCurrentSortFunction();a&&this._rowDatas.sort(a);var b=this._rowDatas.size();for(var c=0;c<b;c++)this._dataRowMap[this._rowDatas.get(c).getId()]=c},_buildChildren:function(a){a.forEach(function(a){this._rowDatas.add(a),this._buildChildren(a.getChildren())},this)},_handlePressSelection:function(a,b){var c=this.getSelectionModel();if(d.isCtrlDown(b))c.contains(a)?c.removeSelection(a):c.appendSelection(a);else if(b.shiftKey&&c.getLastData()){var e=c.getLastData(),f=this.getRowIndexByData(e),g=this.getRowIndexByData(a),h=new Ce;h.add(this.getRowDatas().get(f));while(f!==g)f+=g>f?1:-1,h.add(this.getRowDatas().get(f));c.setSelection(h)}else(c.size()!==1||!c.contains(a))&&c.setSelection(a);this.fireInteractionEvent({kind:b.detail===2?"doubleClick":"click",data:a})},_handleClick:function(a){this.isFocusOnClick()&&c.Util.setFocus(this._view);var b=this.getDataAt(a);if(b){if(this.isCheckMode()&&!a.target._checkData){var d=this.getRowIndexByData(b);if(this._focusedRow!==d){var e=this._rowDatas.get(this._focusedRow);this._focusedRow=d,e&&this.invalidateData(e),this.invalidateData(b)}}this.isCheckMode()||this._handlePressSelection(b,a)}this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor);if(this.updateCurrentEditor){var f=this;setTimeout(function(){f.updateCurrentEditor(a)},0)}},handleChange:function(a){if(this._isCanceling||this._isValidating)return;var b=a.target._checkData;if(b){var c=this.isSelected(b),d=this.getSelectionModel();c?d.removeSelection(b):d.appendSelection(b)}a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)},scrollToData:function(a){var b=this.getRowIndexById(a.getId());if(b<0)return;var c=b*this._rowHeight*this._zoom,d=c+this._rowHeight*this._zoom,e=this._view.scrollTop;this._view.scrollTop>c&&(e=c),this._view.scrollTop+this._view.clientHeight<d&&(e=d-this._view.clientHeight),this._view.scrollTop!=e&&(this._view.scrollTop=e,this.invalidate())},makeVisible:function(a){if(!this.isVisible(a))return;this.expand&&this.expand(a),d.callLater(this.scrollToData,this,[a],Se.CALL_LATER_DELAY*2)},onSelectionChanged:function(a){this._makeVisibleOnSelected&&(a.kind==="append"||a.kind==="set"||a.kind==="all")&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(a){a.getParent()&&this.expand(a.getParent())},this),d.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],Se.CALL_LATER_DELAY*2))},onShareSelectionModelChanged:function(){this.invalidateModel()}}),c.controls.TableBase=function(a){this._columnBox=new c.ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),c.controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new c.Pool("div",20),this._stringPool=new c.Pool("span",20),this._booleanPool=new c.Pool("input",20),this._colorPool=new c.Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool)},d.ext("twaver.controls.TableBase",c.controls.ListBase,{getColumnBox:function(){return this._columnBox},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){a.source!==this._sortColumn||a.property!=="sortDirection"&&a.property!=="sortFunction"&&a.property!=="sortable"?this.invalidateDisplay():this.invalidateModel()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},renderData:function(a,b,c,d){var e=this._columnBox.getRoots(),f=e.size(),g=0,h=this._rowHeight-this._rowLineWidth+"px",i;for(var j=0;j<f;j++){var k=e.get(j),l=k.getWidth();l<0&&(l=0);var m=Math.min(this._columnLineWidth,l);if(k.isVisible()){var n=this._cellPool.get();i=n.style,i.position="absolute",i.whiteSpace="nowrap",i.verticalAlign="middle",i.textAlign=k.getHorizontalAlign(),i.overflow="hidden",i.textOverflow="ellipsis",i.left=g+"px",i.width=l-m+"px",i.height=h,i.borderStyle="solid",i.borderWidth="0px",i.borderRightWidth=m+"px",i.borderRightColor=this._columnLineColor,j===0?(i.borderLeftWidth=m+"px",i.borderLeftColor=this._columnLineColor):i.borderLeftWidth="0px",a.appendChild(n);var o={data:b,value:this.getValue(b,k),div:n,view:this,column:k,rowIndex:c,selected:d};this.renderCell(o),this.onCellRendered(o),g+=l}}i=a.style,i.width=g+"px",i.height=h,i.backgroundColor=this.isCheckMode()&&this._focusedRow===c||!this.isCheckMode()&&d?this.getSelectColor(b):""},adjustRowSize:function(){},onCellRendered:function(a){},getCurrentSortFunction:function(){var a=this._sortColumn;if(a){var b=a.getSortFunction();if(b){var c=this,d="asc"===a.getSortDirection()?1:-1;return function(e,f){var g=c.getValue(e,a),h=c.getValue(f,a);return b.call(c,g,h,e,f)*d}}}return this._sortFunction},renderCell:function(a){var b=a.column;if(b.renderCell){b.renderCell(a);return}var c=a.value,d=b.getEnumInfo();d&&!Array.isArray(d)&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.div._editInfo=a),Bd.render(b.getValueType(),c,a.div,a.view,b.isInnerText())},getValue:function(a,b){return b.getValue(a,this)},setValue:function(a,b,c){b.setValue(a,c,this)},getColumnAt:function(a){var b=this.getLogicalPoint(a);if(!b)return null;var c=this._columnBox.getRoots();for(var d=0,e=c.size(),f=0;d<e;d++){var g=c.get(d),h=g.getWidth();h<0&&(h=0);if(b.x>f&&b.x<f+h)return g;f+=h}return null},isCellEditable:function(a,b){return this.isEditable()&&b.isEditable()},commitEditValue:function(a,b){if(this._isCanceling)return;var d;b.type==="checkbox"?d=b.checked:d=b.value;var e=a.column,f=e.getValueType();f==="int"&&typeof d=="string"?d=parseInt(d):f==="number"&&typeof d=="string"&&(d=parseFloat(d)),this.setValue(a.data,e,d);if(this._currentEditor){var g=this._currentEditor.parentNode,h=this._currentEditor;delete this._currentEditor,g&&g.removeChild(h),c.Util.setFocus(this._view)}delete this._isCommitting},cancelEditing:function(){if(this._currentEditor){this._isCanceling=!0;var a=this._currentEditor.parentNode,b=this._currentEditor;delete this._currentEditor,a&&a.removeChild(b),c.Util.setFocus(this._view),delete this._isCanceling}},renderEditor:function(a){},onEditorRendered:function(a){},updateCurrentEditor:function(a){var b=a.target;if(b===this._currentEditor||b.parentNode===this._currentEditor)return;var d;while(b&&b!==this._view&&!(d=b._editInfo))b=b.parentNode;if(d&&b===d.div){var e=this.renderEditor&&this.renderEditor(d);e?(this._currentEditor=e.view,d.value!=null&&(this._currentEditor.value=d.value)):d.enumInfo?this._currentEditor=s.createSelect(d.enumInfo,d.value):(this._currentEditor=k.createElement("input"),d.value!=null&&(this._currentEditor.value=d.value));var f=this;if(this._currentEditor){if(e&&e.onKeyDown){var g=e.onKeyDown;g&&Array.isArray(g)&&f._currentEditor.addEventListener("keydown",function(a){for(var b=0;b<g.length;b++)if(g[b].combKey){var c=null;switch(g[b].combKey){case"ctrlKey":c=a.ctrlKey;break;case"shiftKey":c=a.shiftKey;break;case"altKey":c=a.altKey}a.keyCode===g[b].keyCode&&c&&g[b].handlerEvent&&g[b].handlerEvent(a)}else a.keyCode===g[b].keyCode&&g[b].handlerEvent&&g[b].handlerEvent(a)})}else this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;if(a.keyCode===13&&a.shiftKey)return;a.keyCode===13?b.commitEditValue(a.target._editInfo,a.target):a.keyCode===27&&b.cancelEditing()},!1);this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;if(b._isCanceling)return;b.commitEditValue(a.target._editInfo,a.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=d;if(!this._currentEditor.parentNode){var h=this._currentEditor.style;h.position="absolute",h.margin="0px",h.border="0px",h.padding="0px",h.left=d.div.style.left,h.top=d.div.parentNode.style.top,h.width=d.div.style.width,h.height=d.div.style.height,this._rootDiv.appendChild(this._currentEditor)}c.Util.setFocus(this._currentEditor)}}},onColumnSorted:function(a){},getCurrentEditor:function(){return this._currentEditor}}),c.controls.List=function(a){c.controls.List.superClass.constructor.apply(this,arguments)},d.ext("twaver.controls.List",c.controls.ListBase,{__accessor:["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],__bool:["makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_rowHeight:Se.LIST_ROW_HEIGHT,_indent:Se.LIST_INDENT,_rowLineWidth:Se.LIST_ROW_LINE_WIDTH,_rowLineColor:Se.LIST_ROW_LINE_COLOR,_makeVisibleOnSelected:Se.LIST_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Se.LIST_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Se.LIST_KEYBOARD_SELECT_ENABLED,isCheckMode:function(){return this._checkMode},setCheckMode:function(a){delete this._focusedRow;var b=this._checkMode;this._checkMode=a,this.firePropertyChange("checkMode",b,a)},isCheckable:function(a){return this._checkMode===!0},renderData:function(a,b,c,e){var f;this._indent>0&&(f=this.__spanPool.get(),f.style.width=this._indent+"px",f.style.display="inline-block",a.appendChild(f));var g=this.isCheckable(b);g&&this._addCheckBox(a,b,e);var h=this.getIcon(b);h&&this._addIcon(a,b,h);var i=this.getLabel(b);if(i){f=this.__textPool.get();var j=f.style;j.whiteSpace="nowrap",j.verticalAlign="middle",j.padding="1px 2px 1px 2px",j.display="inline-block",d.setText(f,i,this._innerText),this.onLabelRendered(f,b,i,c,e),a.appendChild(f)}this.isCheckMode()?a.style.backgroundColor=this._focusedRow===c?this.getSelectColor(b):"":a.style.backgroundColor=e?this.getSelectColor(b):""},onLabelRendered:function(a,b,c,d,e){}}),c.controls.ListBaseInteraction=function(a){this.listBase=a,this.view=a._view;var b=this;this.view.addEventListener("scroll",function(a){b.handleScroll(a)},!1),this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("keydown",function(a){b.handleKeyDown(a)},!1)},d.ext("twaver.controls.ListBaseInteraction",Object,{handleMouseDown:function(a){var b=this.listBase;if(a.target===b._currentEditor||a.target.parentNode===b._currentEditor)return;b._handleClick(a)},handleKeyDown:function(a){var b=this.listBase;if(b._currentEditor)return;if(d.isCtrlDown(a)&&a.keyCode==65)b.isKeyboardSelectEnabled()&&b.selectAll().size()>0&&b.fireInteractionEvent({kind:"selectAll"}),s.preventDefault(a);else if(a.keyCode==46)b.isKeyboardRemoveEnabled()&&b.removeSelection()&&b.fireInteractionEvent({kind:"removeElement"}),s.preventDefault(a);else if(!!b.isCheckMode()||a.keyCode!==38&&a.keyCode!==40&&a.keyCode!==37&&a.keyCode!==39)d.showVersion(a);else{var c=b.getSelectionModel().getLastData();if(c)if(a.keyCode===38||a.keyCode===40){var e=b.getRowDatas(),f=b.getRowIndexByData(c);f>=0&&(a.keyCode===38?f!==0&&(c=e.get(f-1),b.getSelectionModel().setSelection(c)):f!==e.size()-1&&(c=e.get(f+1),b.getSelectionModel().setSelection(c)))}else b.expand&&(a.keyCode===37||a.keyCode===39)&&c.hasChildren()&&(a.keyCode===37?b.collapse(c):b.expand(c));else b.getRowDatas().size()>0&&(c=b.getRowDatas().get(0),b.getSelectionModel().setSelection(c))}},handleScroll:function(a){this.listBase.invalidate()}}),c.controls.ListBaseTouchInteraction=function(a){this.listBase=a,this.view=a._view,s.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.ListBaseTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a),this.lastPoint=this.listBase.getLogicalPoint(a),s.addEventListener("touchmove","handleTouchmove",this.view,this),s.addEventListener("touchend","handleTouchend",this.view,this),Ad.isMultiTouch(a)&&(this.distance=Ad.getDistance(a),this.zoom=this.listBase._zoom)},handleTouchmove:function(a){s.preventDefault(a),this.moved||(this.moved=!0);if(Ad.isSingleTouch(a)){if(this.lastPoint){var b=this.listBase.getLogicalPoint(a),c=this.lastPoint.x-b.x,d=this.lastPoint.y-b.y,e=this.listBase.panByOffset(c,d);this.listBase.invalidate(),this.lastPoint.x-=c-e.x,this.lastPoint.y-=d-e.y}}else if(this.distance){var f=Ad.getDistance(a)/this.distance;this.listBase.setZoom(this.zoom*f,!1)}},handleTouchend:function(a){s.preventDefault(a),!this.moved&&a.target!==this.listBase._currentEditor&&a.target.parentNode!==this.listBase._currentEditor&&this.listBase._handleClick(a),delete this.lastPoint,delete this.moved,delete this.distance,delete this.zoom,s.removeEventListener("touchmove",this.view,this),s.removeEventListener("touchend",this.view,this)}}),c.controls.ListBaseMSTouchInteraction=function(a){c.controls.ListBaseMSTouchInteraction.superClass.constructor.apply(this,arguments),this._pointerMap={},this._pointerIdArray=[];var b=this;this.view.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.view.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.view.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.view.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1),this.superHandleMouseDown=c.controls.ListBaseMSTouchInteraction.superClass.handleMouseDown},d.ext("twaver.controls.ListBaseMSTouchInteraction",c.controls.ListBaseInteraction,{handleMouseDown:function(a){},handleTouchstart:function(a){a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.listBase.getLogicalPoint(a)!=null&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),this._pointerIdArray.length==1&&a.pointerType==a.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(a),this._pointerIdArray.length==1?(this._startTouchPoint=this.listBase.getLogicalPoint(a),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.listBase.getZoom())},handleTouchmove:function(a){if(this._startTouchPoint==null||this._pointerIdArray.length==0||!this._pointerMap[a.pointerId]||p.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)return;this._pointerMap[a.pointerId]=a;if(this._pointerIdArray.length==2){var b=this._getDistance()/this._distance;this.listBase.setZoom(this._zoom*b,!1)}else if(this._pointerIdArray.length==1&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var c=this.listBase.getLogicalPoint(a);if(c==null)return;var d=this._startTouchPoint.x-c.x,e=this._startTouchPoint.y-c.y,f=this.listBase.panByOffset(d,e);this.listBase.invalidate(),this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}},handleTouchend:function(a){if(this._startTouchPoint&&this._pointerIdArray.length==1&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.listBase.getLogicalPoint(a);if(b){var c=new Date;c.getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,b)<=20&&this.superHandleMouseDown(a)}}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return p.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),c.controls.Tree=function(a){this._interactionDispatcher=new c.EventDispatcher,this._initTree(a),c.controls.Tree.superClass.constructor.apply(this,arguments),this.setToolTipEnabled(Se.TREE_TOOLTIP_ENABLED)},d.ext("twaver.controls.Tree",c.controls.ListBase,{__tree:1,__accessor:["rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon"
,"uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_indent:Se.TREE_INDENT,_rowHeight:Se.TREE_ROW_HEIGHT,_rowLineWidth:Se.TREE_ROW_LINE_WIDTH,_rowLineColor:Se.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected:Se.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Se.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Se.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon:Se.TREE_EXPAND_ICON,_collapseIcon:Se.TREE_COLLAPSE_ICON,_uncheckableStyle:"none",_lineType:Se.TREE_LINE_TYPE,_lineColor:Se.TREE_LINE_COLOR,_lineThickness:Se.TREE_LINE_THICKNESS,_lineAlpha:Se.TREE_LINE_ALPHA,_lineDash:Se.TREE_LINE_DASH,getCheckMode:function(){return this._checkMode},setCheckMode:function(a){delete this._focusedRow;var b=this._checkMode;this._checkMode=a,this.firePropertyChange("checkMode",b,a)},renderData:function(a,b,c,d){this._renderTree(a,b,c,d)},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){this._toolTipEnabled=a;if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){var c=b.getDataAt(a);if(!c){Cd.hideToolTip();return}if(b._preElement===c)return;b._preElement=c;if(c){var d=b.getToolTip(c);Cd.showToolTip(a,d);return}Cd.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Cd.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getToolTip:function(a){return a.getToolTip()}}),c.controls.Table=function(a){this._checkColumn=new c.Column,this._checkColumn.setName("check"),this._checkColumn.setEditable(!0),this._checkColumn.setWidth(40),this._checkColumn.setHorizontalAlign("center"),this._checkColumn.renderCell=this.renderCheckCell;var b=this;this._checkColumn.getValue=function(a,c){return b.isSelected(a)},c.controls.Table.superClass.constructor.apply(this,arguments)},d.ext("twaver.controls.Table",c.controls.TableBase,{__accessor:["rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","sortFunction","visibleFunction","sortColumn"],__bool:["editable","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Se.TABLE_EDITABLE,_rowHeight:Se.TABLE_ROW_HEIGHT,_rowLineWidth:Se.TABLE_ROW_LINE_WIDTH,_rowLineColor:Se.TABLE_ROW_LINE_COLOR,_columnLineWidth:Se.TABLE_COLUMN_LINE_WIDTH,_columnLineColor:Se.TABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Se.TABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Se.TABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Se.TABLE_KEYBOARD_SELECT_ENABLED,getCheckColumn:function(){return this._checkColumn},isCheckMode:function(){return this._columnBox.contains(this._checkColumn)},setCheckMode:function(a){if(a===this.isCheckMode())return;delete this._focusedRow,a?this._columnBox.add(this._checkColumn,0):this._columnBox.remove(this._checkColumn),this.firePropertyChange("checkMode",!a,a)},renderCheckCell:function(a){var b=a.view._booleanPool.get();b.disabled=!1,b.type="checkbox",b.style.margin="0px 2px",b.style.verticalAlign="middle",b.checked=a.selected;var c=a.div;c.appendChild(b),c.style.textAlign===""&&(c.style.textAlign="center"),b._checkData=a.data}}),c.controls.TableHeader=function(a){c.controls.TableHeader.superClass.constructor.apply(this,arguments),this._invalidateScroll=!1,this._invalidateDisplay=!1,this._divPool=new c.Pool("div"),this._imagePool=new c.Pool("img"),this._textPool=new c.Pool("span"),this._resizePool=new c.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._imagePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this._table=a,this._tableView=a.getView(),this._columnBox=a.getColumnBox(),this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this);var b=this;a.getView().addEventListener("scroll",function(a){b.invalidateScroll()},!1),a.addPropertyChangeListener(function(a){b.invalidateDisplay()},this),this._view=s.createView("hidden"),this._view.tabIndex=-1,this._view.style.background=Se.TABLEHEADER_BACKGROUND,this._rootDiv=s.createDiv(),this._view.appendChild(this._rootDiv),this.invalidateDisplay();var d;m.isTouchable&&!m.isMSToucheable?d=c.controls.TableHeaderTouchInteraction:d=c.controls.TableHeaderInteraction,d&&new d(this)},d.ext("twaver.controls.TableHeader",c.controls.ControlBase,{__accessor:["height","moveBackground","insertBackground","columnLineColor","resizeTolerance","sortDescIcon","sortAscIcon","sortIconPosition"],_height:Se.TABLEHEADER_HEIGHT,_moveBackground:Se.TABLEHEADER_MOVE_BACKGROUND,_insertBackground:Se.TABLEHEADER_INSERT_BACKGROUND,_columnLineColor:Se.TABLEHEADER_COLUMN_LINE_COLOR,_resizeTolerance:Se.TABLEHEADER_RESIZE_TOLERANCE,_sortDescIcon:Se.TABLEHEADER_SORT_DESC_ICON,_sortAscIcon:Se.TABLEHEADER_SORT_ASC_ICON,_sortIconPosition:Se.TABLEHEADER_SORT_ICON_POSITION,getRootDiv:function(){return this._rootDiv},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){this.invalidateDisplay()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},onPropertyChanged:function(a){this.invalidateDisplay()},invalidateScroll:function(){if(this._invalidateScroll)return;this._invalidateScroll=!0,this.invalidate()},invalidateDisplay:function(){if(this._invalidateDisplay)return;this._invalidateDisplay=!0,this._invalidateScroll=!0,this.invalidate()},validate:function(){if(!this._invalidate)return;this._invalidate=!1,this._invalidateDisplay&&(this._invalidateDisplay=!1,this.validateDisplay()),this._invalidateScroll&&(this._invalidateScroll=!1,this._rootDiv.style.left=-this._tableView.scrollLeft+"px")},validateDisplay:function(){s.release(this._rootDiv);var a=this._table.getZoom(),b=this.getHeight()+"px",c=this.getHeight()-2+"px",d=this._table.getColumnBox().getRoots(),e=d.size(),f=0,g=this._table._columnLineWidth*a;for(var h=0;h<e;h++){var i=d.get(h);if(i.isVisible()){var j=i.getWidth()*a;j<0&&(j=0);var k=Math.min(g,j),l=this._divPool.get();l._column=i;var m=l.style;m.position="absolute",m.whiteSpace="nowrap",m.lineHeight=c,m.overflow="hidden",m.textOverflow="ellipsis",m.backgroundPosition=this._sortIconPosition?this._sortIconPosition:"",m.backgroundRepeat="no-repeat",m.backgroundImage="",m.textAlign=i.getHorizontalAlign(),m.borderStyle="solid",m.borderWidth="0px",m.borderRightWidth=k+"px",m.borderRightColor=this._columnLineColor,h===0?(m.borderLeftWidth=k+"px",m.borderLeftColor=this._columnLineColor):m.borderLeftWidth="0px",m.left=f+"px",m.width=j-k+"px",m.height=b,l._x=f,l._width=j-k,this._rootDiv.insertBefore(l,this._rootDiv.firstChild),this.renderColumn(l,i),this.onColumnRendered(l,i),f+=j,i.isResizable()&&(l=this._resizePool.get(),l._resizeColumn=i,m=l.style,m.position="absolute",m.backgroundColor="white",m.opacity=0,m.left=f-k-this._resizeTolerance+"px",m.width=k+this._resizeTolerance*2+"px",m.height=b,this._rootDiv.appendChild(l))}}this._pools.forEach(function(a){a.clear()}),this._rootDiv.style.width=f+"px",this._rootDiv.style.height=b},renderColumn:function(a,b){if(b.renderHeader)b.renderHeader(a);else{var c=this._textPool.get();c.style.whiteSpace="nowrap",c.style.verticalAlign="middle",c.style.padding="1px 2px 1px 2px",c.innerHTML=b.getName()?b.getName():b.getPropertyName(),c.setAttribute("title",c.innerHTML),a.appendChild(c);if(m.isOpera){var e=a.cloneNode(!1);e.style.left="0px",e.style.top="0px",e.style.opacity=0,a.appendChild(e)}}if(this._table.getSortColumn()===b&&b.isSortable()){var f=b.getSortDirection()==="asc"?this._sortAscIcon:this._sortDescIcon,g=d.getImageSrc(f);if(!this._sortIconPosition||this._sortIconPosition===""){var h=this._imagePool.get();h.setAttribute("src",g),h.style.verticalAlign="middle",a.appendChild(h)}else a.style.backgroundImage="url("+g+")"}},onColumnRendered:function(a,b){}}),c.controls.TableHeaderInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view;var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},d.ext("twaver.controls.TableHeaderInteraction",Object,{handleMouseDown:function(a){if(a.button!==0)return;if(this.movableDiv){this.handleMouseUp(a);return}this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this._startClient=s.getClientPoint(a),this.lastX=this.getX(a),this._startLogicalX=this.lastX,s.handle_mousedown(this,a)},changeCursor:function(a){var b="";if(a.target._resizeColumn)b="ew-resize";else{var c=this.getColumnAt(a);c&&(c.isMovable()||c.isSortable())&&(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(this.lastX==null){this.changeCursor(a);return}if(s.target!==this)return;var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeColumn){if(this.stopX!=null){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();c<10&&(c=10,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=s.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}},handleMouseUp:function(a){if(a.button!==0)return;var b;if(!this.resizeColumn)if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else{b=this.getColumnAt(a);if(b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?(d==="desc"&&this.table.setSortColumn(null),b.setSortDirection(d==="asc"?"desc":"asc")):this.table.setSortColumn(b),this.table.onColumnSorted(this.table.getSortColumn())}}this.clear()},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX,delete this._startClient,delete this._startLogicalX},getColumnAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._column))a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._column))a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=s.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){var b=this._startLogicalX+a.clientX-this._startClient.x+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1;for(var h=0;h<d;h++){var i=c.get(h);i===this.movableDiv._column&&(g=!0);if(i.isVisible()){var j=i.getWidth()*e;if(j<=0)continue;if(b>=f&&b<=f+j){var k=b<f+j/2;g&&(i!==this.movableDiv._column||!k)&&h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),c.controls.TableHeaderTouchInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view,s.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.TableHeaderTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a);if(this.movableDiv){this.handleTouchend(a);return}this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),s.addEventListener("touchmove","handleTouchmove",this.view,this),s.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){s.preventDefault(a);if(this.lastX==null)return;var b;if(this.resizeColumn){b=this.getX(a);if(this.stopX!=null){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();c<0&&(c=0,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){b=this.getX(a);var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=s.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}},handleTouchend:function(a){s.preventDefault(a);var b;if(!this.resizeColumn)if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else{b=this.getColumnAt(a);if(b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?(d==="desc"&&this.table.setSortColumn(null),b.setSortDirection(d==="asc"?"desc":"asc")):this.table.setSortColumn(b)}}this.clear(),s.removeEventListener("touchmove",this.view,this),s.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX},getColumnAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._column))a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._column))a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=s.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){var b=this.getX(a)+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1;for(var h=0;h<d;h++){var i=c.get(h);i===this.movableDiv._column&&(g=!0);if(i.isVisible()){var j=i.getWidth()*e;if(j<=0)continue;if(b>=f&&b<=f+j){var k=b<f+j/2;g&&(i!==this.movableDiv._column||!k)&&h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),c.controls.TablePane=function(a,b){c.controls.TablePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._table=a,this._tableHeader=b?b:new c.controls.TableHeader(a),this._view=s.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._tableHeader.getView()),this._view.appendChild(this._table.getView());var d=this;this._tableHeader.addPropertyChangeListener(function(a){a.property==="height"&&d.invalidate()})},d.ext("twaver.controls.TablePane",c.controls.ControlBase,{onPropertyChanged:function(a){this.invalidate()},getTable:function(){return this._table},getTableHeader:function(){return this._tableHeader},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._tableHeader.getHeight();this._tableHeader.adjustBounds({x:0,y:0,width:a,height:c}),this._table.adjustBounds({x:0,y:c,width:a,height:Math.max(0,b-c)})}}),c.controls.TreeTable=function(a){this._treeColumn=new c.Column,this._treeColumn.setName("tree"),this._treeColumn.setWidth(120),this._treeColumn.renderCell=this.renderTreeCell,this._treeColumn.getValue=this.getTreeValue,this._treeColumn.setValue=this.setTreeValue,this._initTree(a),c.controls.TreeTable.superClass.constructor.apply(this,arguments),this._columnBox.add(this._treeColumn)},d.ext("twaver.controls.TreeTable",c.controls.TableBase,{__tree:1,__accessor:["sortFunction","visibleFunction","checkMode","rootData","sortColumn","indent","rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["editable","rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Se.TREETABLE_EDITABLE,_indent:Se.TREETABLE_INDENT,_rowHeight:Se.TREETABLE_ROW_HEIGHT,_rowLineWidth:Se.TREETABLE_ROW_LINE_WIDTH,_rowLineColor:Se.TREETABLE_ROW_LINE_COLOR,_columnLineWidth:Se.TREETABLE_COLUMN_LINE_WIDTH,_columnLineColor:Se.TREETABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Se.TREETABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Se.TREETABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Se.TREETABLE_KEYBOARD_SELECT_ENABLED,_expandIcon:Se.TREETABLE_EXPAND_ICON,_collapseIcon:Se.TREETABLE_COLLAPSE_ICON,_lineType:Se.TREE_LINE_TYPE,_lineColor:Se.TREE_LINE_COLOR,_lineThickness:Se.TREE_LINE_THICKNESS,_lineAlpha:Se.TREE_LINE_ALPHA,_lineDash:Se.TREE_LINE_DASH,getTreeColumn:function(){return this._treeColumn},renderTreeCell:function(a){a.view._renderTree(a.div,a.data,a.rowIndex,a.selected)},getTreeValue:function(a,b){return b.getLabel(a)},setTreeValue:function(a,b,c){a.setName(b)}}),c.controls.PropertySheet=function(a){c.controls.PropertySheet.superClass.constructor.apply(this,arguments),this._currentRowIndex=-1,this._currentEditor=null,this._currentData=null,this._invalidate=!1,this._resizeDiv=s.createDiv(),this._resizeDiv.style.backgroundColor="white",this._resizeDiv.style.opacity=0,this._resizeDiv.style.top="0px",this._categoryList=new Ce,this._categoryMap={},this._rowList=new Ce,this._propertyBox=new c.PropertyBox,this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox,this),this.__divPool=new c.Pool("div",2),this.__cellPool=new c.Pool("div",2),this.__imagePool=new c.Pool("img",2),this.__textPool=new c.Pool("span",2),this._stringPool=new c.Pool("span",2),this._booleanPool=new c.Pool("input",2),this._colorPool=new c.Pool("div",2),this._pools.add(this.__divPool),this._pools.add(this.__cellPool),this._pools.add(this.__imagePool),this._pools.add(this.__textPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this._view=s.createView("auto"),this._rootDiv=s.createDiv(),this._dataDiv=s.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new c.DataBox);var b=this;this._view.addEventListener("change",function(a){b.handleChange(a)},!1);var d;m.isMSToucheable?d=c.controls.PropertySheetMSTouchInteraction:m.isTouchable?d=c.controls.PropertySheetTouchInteraction:d=c.controls.PropertySheetInteraction,d&&new d(this)},d.ext("twaver.controls.PropertySheet",c.controls.View,{__accessor:["indent","rowHeight","sumWidth","propertyNameWidth","propertyNameHorizontalAlign","autoAdjustable","rowLineWidth","columnLineWidth","borderColor","categorizable","resizeTolerance","editable","selectColor","expandIcon","collapseIcon","sortFunction","visibleFunction"],_autoAdjustable:Se.PROPERTYSHEET_AUTO_ADJUSTABLE,_selectColor:Se.SELECT_COLOR,_categorizable:Se.PROPERTYSHEET_CATEGORIZABLE,_editable:Se.PROPERTYSHEET_EDITABLE,_propertyNameWidth:Se.PROPERTYSHEET_PROPERTY_NAME_WIDTH,_propertyNameHorizontalAlign:Se.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN,_sumWidth:Se.PROPERTYSHEET_SUM_WIDTH,_indent:Se.PROPERTYSHEET_INDENT,_rowHeight:Se.PROPERTYSHEET_ROW_HEIGHT,_rowLineWidth:Se.PROPERTYSHEET_ROW_LINE_WIDTH,_columnLineWidth:Se.PROPERTYSHEET_COLUMN_LINE_WIDTH,_borderColor:Se.PROPERTYSHEET_BORDER_COLOR,_expandIcon:Se.PROPERTYSHEET_EXPAND_ICON,_collapseIcon:Se.PROPERTYSHEET_COLLAPSE_ICON,_resizeTolerance:Se.PROPERTYSHEET_RESIZE_TOLERANCE,getPropertyBox:function(){return this._propertyBox},getCurrentData:function(){return this._currentData},getDataDiv:function(){return this._dataDiv},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidate(),this.firePropertyChange("dataBox",b,this._box)},invalidatePropertyBox:function(){this._isValidating||this.invalidate()},onPropertyChanged:function(a){a.property!=="zoom"&&this.invalidate()},isVisible:function(a){return a.isVisible&&!a.isVisible(this._currentData,this)?!1:this._visibleFunction?this._visibleFunction(a):!0},handlePropertyChange:function(a){this._currentData===a.source&&this.invalidate()},handleSelectionChange:function(a){this._currentData!==this.getSelectionModel().getLastData()&&(this._currentRowIndex=-1,this.invalidate())},isExpanded:function(a){if(!a)return!0;var b=this._categoryMap[a];return b?b.isExpanded:Se.PROPERTYSHEET_EXPAND_CATEGORY},expand:function(a){if(!a)return;var b=this._categoryMap[a];if(!b||b.isExpanded)return;b.isExpanded=!0,this.invalidate()},expandAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!0)}this.invalidate()},collapse:function(a){if(!a)return;var b=this._categoryMap[a];if(!b||!b.isExpanded)return;b.isExpanded=!1,this.invalidate()},collapseAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!1)}this.invalidate()},getCategoryName:function(a){if(!this.isCategorizable())return"null";var b=a.getCategoryName();return b?b:"null"},validateModel:function(){this._rowList.clear(),this._categoryList.clear();var a={},b=new Ce,c=this._currentData?this._propertyBox.getRoots():new Ce,d,e,f,g,h;g=c.size();for(d=0;d<g;d++)h=c.get(d),this.isVisible(h)&&(b.add(h),f=this.getCategoryName(h),a[f]||(this._categoryList.add(f),a[f]={isExpanded:this.isExpanded(f),properties:new Ce}));this._sortFunction&&b.sort(this._sortFunction),this._categoryMap=a,g=b.size();for(d=0;d<this._categoryList.size();d++){f=this._categoryList.get(d),f!=="null"&&this._rowList.add(f);var i=a[f];if(i.isExpanded)for(e=0;e<g;e++)h=b.get(e),this.getCategoryName(h)===f&&(i.properties.add(h),this._rowList.add({view:this,data:this._currentData,property:h,value:this._currentData?this.getValue(this._currentData,h):null}))}},adjustWidth:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight;if(a<=this._indent||b<=0)return;a-=this._indent;if(this._rowList.size()*this._rowHeight>b){a-=Se.SCROLL_BAR_WIDTH;if(a<=0)return}this._sumWidth===0||this._propertyNameWidth>this._sumWidth?this._propertyNameWidth=a/2:this._propertyNameWidth=a*(this._propertyNameWidth/this._sumWidth),this._sumWidth=a,this._view.style.overflowX="hidden",this._view.style.overflowY="auto"},validateDisplay:function(){var a=this._rowList.size(),b=this._borderColor,c=this._indent,e=this._rowHeight,f=this._propertyNameWidth,g=Math.max(0,this._sumWidth-f),h=this._rowLineWidth,i=this._columnLineWidth,j=e-h+"px",k=e-h-2+"px",l=c+"px",m=f-i+"px",n=g-i+"px",o=f+g+"px",p=h+"px",q=i+"px",r=f+"px",s=this._dataDiv,t=s.style;t.height=a*e+"px",t.width=c+f+g+"px";var u=this.__divPool.get();t=u.style,t.position="absolute",t.left="0px",t.top="0px",t.width=l,t.height=s.style.height,t.borderWidth="0px",t.backgroundColor=b,s.appendChild(u);for(var v=0;v<a;v++){var w=this._rowList.get(v),x=v*e+"px",y=this.__divPool.get();w.rowDiv=y,t=y.style,t.position="absolute",t.whiteSpace="nowrap",t.overflow="hidden",t.textOverflow="ellipsis",t.left=l,t.top=x,t.width=o,t.height=j,t.lineHeight=k,t.borderStyle="solid",t.borderWidth="0px",t.borderBottomWidth=p,t.borderBottomColor=b,s.appendChild(y);if(typeof w=="string"){t.backgroundColor=b,u=this.__divPool.get(),t=u.style,t.position="absolute",t.left="0px",t.top=x,t.width=l,t.height=j,t.lineHeight=k,t.borderWidth="0px",s.appendChild(u);var z=this.__imagePool.get(),A=this.isExpanded(w)?this._expandIcon:this._collapseIcon;z.setAttribute("src",d.getImageSrc(A)),t=z.style,t.verticalAlign="middle",z._expandData=w,u.appendChild(z),this.renderCategory(y,w),this.onCategoryRendered(y,w)}else{var B=w.property,C=this.__cellPool.get();w.nameRender=C,t=C.style,this._currentRowIndex===v&&(t.backgroundColor=this.getSelectColor()),t.position="absolute",t.verticalAlign="middle",t.textAlign=this._propertyNameHorizontalAlign,t.overflow="hidden",t.textOverflow="ellipsis",t.whiteSpace="nowrap",t.left="0px",t.top="0px",t.width=m,t.height=j,t.borderStyle="solid",t.borderWidth="0px",t.borderRightWidth=q,t.borderRightColor=b,y.appendChild(C),this.renderName(w),this.onNameRendered(w),C=this.__cellPool.get(),w.valueRender=C,t=C.style,t.position="absolute",t.verticalAlign="middle",t.textAlign=B.getHorizontalAlign(),t.whiteSpace="nowrap",t.overflow="hidden",t.textOverflow="ellipsis",t.left=r,t.top="0px",t.width=n,t.height=j,t.borderStyle="solid",t.borderWidth="0px",t.borderRightWidth=q,t.borderRightColor=b,y.appendChild(C),this.renderValue(w),this.onValueRendered(w)}}t=this._resizeDiv.style,t.left=c+f-i-this._resizeTolerance+"px",t.width=i+this._resizeTolerance*2+"px",t.height=s.style.height,s.appendChild(this._resizeDiv)},renderCategory:function(a,b){var c=this.__textPool.get(),d=c.style;d.fontWeight="bold",d.whiteSpace="nowrap",d.overflow="hidden",d.textOverflow="ellipsis",d.verticalAlign="middle",d.padding="1px 2px 1px 2px",c.innerHTML=b,c.setAttribute("title",b),a.appendChild(c)},onCategoryRendered:function(a,b){},renderName:function(a){if(a.property.renderName){a.property.renderName(a);return}var b=this.__textPool.get(),c=b.style;c.fontWeight="",c.whiteSpace="nowrap",c.verticalAlign="middle",c.padding="1px 2px 1px 2px";var d=a.property.getName();d||(d=a.property.getPropertyName()),b.innerHTML=d,b.setAttribute("title",d),a.nameRender.appendChild(b)},onNameRendered:function(a){},renderValue:function(a){var b=a.property;if(b.renderValue){b.renderValue(a);return}var c=a.value,d=b.getEnumInfo();d&&!Array.isArray(d)&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.valueRender._editInfo=a),Bd.render(b.getValueType(),c,a.valueRender,a.view,b.isInnerText())},onValueRendered:function(a){},renderEditor:function(a){},onEditorRendered:function(a){},updateCurrentData:function(){this._currentData=this.getSelectionModel().getLastData()},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;s.release(this._dataDiv),this.updateCurrentData(),this.validateModel(),this.isAutoAdjustable()&&this.adjustWidth(),this.validateDisplay(),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b)},getValue:function(a,b){return a?b.getValue(a,this):null},setValue:function(a,b,c){if(!a)return;b.setValue(a,c,this)},isCellEditable:function(a,b){return a?this.isEditable()&&b.isEditable():!1},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowList.size()?c:-1},handleChange:function(a){if(this._isCommitting||this._isCanceling||this._isValidating)return;a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)},commitEditValue:function(a,b){var d;b.type==="checkbox"?d=b.checked:d=b.value;var e=a.property,f=e.getValueType();if(f==="int"&&typeof d=="string")d=parseInt(d);else if(f==="number"&&typeof d=="string")d=parseFloat(d);else if(f==="array.string")d=d.split(",");else if(f==="array.number"){d=d.split(",");for(var g=0,h=d.length;g<h;g++)d[g]=parseFloat(d[g])}this.setValue(a.data,e,d),c.Util.setFocus(this._view);if(this._currentEditor){var i=this._currentEditor.parentNode;i&&i.removeChild(this._currentEditor),delete this._currentEditor}delete this._isCommitting},cancelEditing:function(){if(this._currentEditor){var a=this._currentEditor.parentNode;a&&a.removeChild(this._currentEditor),delete this._currentEditor,delete this._isCanceling}},updateCurrentRowIndex:function(a){var b=this._rowList.size();if(a<0||a>=b)a=-1;var d=this._currentRowIndex,e;a!==d&&(d>=0&&d<b&&(e=this._rowList.get(d),e.nameRender&&(e.nameRender.style.backgroundColor="")),this._currentRowIndex=a);if(a>=0){e=this._rowList.get(a);if(e.nameRender){e.nameRender.style.backgroundColor=this.getSelectColor();if(!this._currentEditor&&e.valueRender&&e.valueRender._editInfo){var f=e.valueRender._editInfo,g=this.renderEditor&&this.renderEditor(e);g?(this._currentEditor=g.view,f.value!=null&&(this._currentEditor.value=f.value)):f.enumInfo?this._currentEditor=s.createSelect(f.enumInfo,f.value):(this._currentEditor=k.createElement("input"),f.value!=null&&(this._currentEditor.value=f.value));var h=this;if(this._currentEditor){if(g&&g.onKeyDown){var i=g.onKeyDown;i&&Array.isArray(i)&&h._currentEditor.addEventListener("keydown",function(a){for(var b=0;b<i.length;b++)if(i[b].combKey){var c=null;switch(i[b].combKey){case"ctrlKey":c=a.ctrlKey;break;case"shiftKey":c=a.shiftKey;break;case"altKey":c=a.altKey}a.keyCode===i[b].keyCode&&c&&i[b].handlerEvent&&i[b].handlerEvent(a)}else a.keyCode===i[b].keyCode&&i[b].handlerEvent&&i[b].handlerEvent(a)})}else this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;if(a.keyCode===13&&a.shiftKey)return;if(a.keyCode===13){if(b._isCommitting)return;b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target)}else a.keyCode===27&&(b._isCanceling=!0,b.cancelEditing())},!1);this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;if(b._isCommitting||b._isCanceling)return;b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=f;if(!this._currentEditor.parentNode){var j=this._currentEditor.style;j.position="absolute",j.margin="0px",j.border="0px",j.padding="0px",j.left=this._indent+this._propertyNameWidth+"px",j.top=e.rowDiv.style.top,j.width=e.valueRender.style.width,j.height=e.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor)}c.Util.setFocus(this._currentEditor)}}}}}}),c.controls.PropertySheetInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv;var b=this;this.view.addEventListener("mousedown",function(a){a.button===0&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},d.ext("twaver.controls.PropertySheetInteraction",Object,{minGap:10,handleMouseDown:function(a){if(a.target===this.sheet._currentEditor||a.target.parentNode===this.sheet._currentEditor)return;this.sheet.isFocusOnClick()&&c.Util.setFocus(this.view);if(this.sheet._isValidating)return;if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target===this.resizeDiv)this.lastX=this.getX(a),s.handle_mousedown(this,a);else{this.sheet._currentEditor&&!this.sheet._isCommitting&&(this.sheet._isCommitting=!0,this.sheet.commitEditValue(this.sheet._currentEditor._editInfo,this.sheet._currentEditor));var d=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(d)}},handleMouseMove:function(a){if(this.lastX==null&&!s.target){this.changeCursor(a);return}if(s.target!==this||this.lastX==null)return;var b=this.getX(a);if(this.stopLeft!=null){if(b<this.stopLeft)return;delete this.stopLeft}if(this.stopRight!=null){if(b>this.stopRight)return;delete this.stopRight}var c=this.sheet.getPropertyNameWidth()+(b-this.lastX);c<this.minGap?(c=this.minGap,this.stopLeft=b):c>this.sheet.getSumWidth()-this.minGap&&(c=this.sheet.getSumWidth()-this.minGap,this.stopRight=b),this.sheet.setPropertyNameWidth(c),this.lastX=b},handleMouseUp:function(a){if(a.button!==0)return;this.view.style.cursor="default",delete this.stopLeft,delete this.stopRight,delete this.lastX},changeCursor:function(a){this.view.style.cursor=a.target===this.resizeDiv?"ew-resize":"default"},getX:function(a){return a.clientX/this.sheet.getZoom()}}),c.controls.PropertySheetTouchInteraction=
function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,s.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.PropertySheetTouchInteraction",Object,{minGap:10,handleTouchstart:function(a){s.preventDefault(a);if(a.target===this.sheet._currentEditor||a.target.parentNode===this.sheet._currentEditor)return;this.sheet.isFocusOnClick()&&c.Util.setFocus(this.view);if(this.sheet._isValidating)return;a.target===this.resizeDiv&&(this.lastX=this.getX(a)),this.lastPoint=this.sheet.getLogicalPoint(a),Ad.isMultiTouch(a)&&(this.distance=Ad.getDistance(a),this.zoom=this.sheet.getZoom()),s.addEventListener("touchmove","handleTouchmove",this.view,this),s.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){s.preventDefault(a),this.moved||(this.moved=!0);if(this.lastX==null){if(Ad.isSingleTouch(a)){if(this.lastPoint){var b=this.sheet.getLogicalPoint(a),c=this.lastPoint.x-b.x,d=this.lastPoint.y-b.y,e=this.sheet.panByOffset(c,d);this.lastPoint.x-=c-e.x,this.lastPoint.y-=d-e.y}}else if(this.distance){var f=Ad.getDistance(a)/this.distance;this.sheet.setZoom(this.zoom*f,!1)}return}var g=this.getX(a);if(this.stopLeft!=null){if(g<this.stopLeft)return;delete this.stopLeft}if(this.stopRight!=null){if(g>this.stopRight)return;delete this.stopRight}var h=this.sheet.getPropertyNameWidth()+(g-this.lastX);h<this.minGap?(h=this.minGap,this.stopLeft=g):h>this.sheet.getSumWidth()-this.minGap&&(h=this.sheet.getSumWidth()-this.minGap,this.stopRight=g),this.sheet.setPropertyNameWidth(h),this.lastX=g},handleTouchend:function(a){s.preventDefault(a);if(!this.moved)if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target!==this.resizeDiv){var c=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(c)}delete this.stopLeft,delete this.stopRight,delete this.lastX,delete this.lastPoint,delete this.distance,delete this.zoom,delete this.moved,s.removeEventListener("touchmove",this.view,this),s.removeEventListener("touchend",this.view,this)},getX:function(a){var b=a.changedTouches[0];return b.clientX}}),c.controls.PropertySheetMSTouchInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,this._pointerMap={},this._pointerIdArray=[];var b=this;this.view.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.view.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.view.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.view.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1),this.superHandleMouseDown=c.controls.PropertySheetMSTouchInteraction.superClass.handleMouseDown},d.ext("twaver.controls.PropertySheetMSTouchInteraction",c.controls.PropertySheetInteraction,{handleMouseDown:function(a){},handleTouchstart:function(a){a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.sheet.getLogicalPoint(a)!=null&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),this._pointerIdArray.length==1&&a.pointerType==a.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(a),this._pointerIdArray.length==1?(this._startTouchPoint=this.sheet.getLogicalPoint(a),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.sheet.getZoom())},handleTouchmove:function(a){if(this._pointerIdArray.length==0||!this._pointerMap[a.pointerId]||p.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)return;this._pointerMap[a.pointerId]=a;if(this._pointerIdArray.length==2){var b=this._getDistance()/this._distance;this.sheet.setZoom(this._zoom*b,!1)}else if(this._pointerIdArray.length==1&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var c=this.sheet.getLogicalPoint(a);if(c==null)return;var d=this._startTouchPoint.x-c.x,e=this._startTouchPoint.y-c.y,f=this.sheet.panByOffset(d,e);this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}},handleTouchend:function(a){if(this._pointerIdArray.length==1&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.sheet.getLogicalPoint(a),c=new Date;c.getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,b)<=20&&this.superHandleMouseDown(a)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return p.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),c.controls.SplitPane=function(a,b,d,e){c.controls.SplitPane.superClass.constructor.apply(this,arguments),this._view=s.createView("hidden",!0),this._view.tabIndex=-1,this._dividerDiv=s.createDiv(),this._dividerDiv.tabIndex=-1,this._view.appendChild(this._dividerDiv),a&&this.setFirstView(a),b&&this.setNextView(b),d&&this.setOrientation(d),e!=null&&this.setPosition(e),this.setDividerDraggable(!0),this.invalidate();var f;m.isTouchable&&!m.isMSToucheable?f=c.controls.SplitPaneTouchInteraction:f=c.controls.SplitPaneInteraction,f&&new f(this)},d.ext("twaver.controls.SplitPane",c.controls.ControlBase,{__accessor:["orientation","dividerWidth","dividerBackground","dividerOpacity","maskBackground"],__bool:["dividerDraggable"],_position:Se.SPLITPANE_POSITION,_orientation:Se.SPLITPANE_ORIENTATION,_dividerWidth:Se.SPLITPANE_DIVIDER_WIDTH,_dividerBackground:Se.SPLITPANE_DIVIDER_BACKGROUND,_dividerOpacity:Se.SPLITPANE_DIVIDER_OPACITY,_maskBackground:Se.SPLITPANE_MASK_BACKGROUND,onPropertyChanged:function(a){this.invalidate()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(a){a<0&&(a=0),a>1&&(a=1);if(a===this._position)return;var b=this._position;this._position=a,this.firePropertyChange("position",b,a)},setFirstView:function(a){if(this._firstView===a)return;var b=this._firstView;b&&(b.getView?this._view.removeChild(b.getView()):this._view.removeChild(b)),this._firstView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("firstView",b,a)},getFirstView:function(){return this._firstView},setNextView:function(a){if(this._nextView===a)return;var b=this._nextView;b&&(b.getView?this._view.removeChild(b.getView()):this._view.removeChild(b)),this._nextView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("nextView",b,a)},getNextView:function(){return this._nextView},validateImpl:function(){var a=this._position,b=this._view.offsetWidth,c=this._view.offsetHeight,e=this._dividerWidth;e>=8||e===0?this._coverDiv&&(this._dividerDiv.removeChild(this._coverDiv),delete this._coverDiv):this._coverDiv||(this._coverDiv=s.createDiv(),this._coverDiv.tabIndex=-1,this._dividerDiv.appendChild(this._coverDiv));if(this._orientation==="horizontal"){e>b&&(e=b);var f=(b-e)*a,g=b-e-f+1;d.setViewBounds(this._firstView,{x:0,y:0,width:f,height:c}),d.setViewBounds(this._nextView,{x:f+e,y:0,width:g,height:c}),d.setViewBounds(this._dividerDiv,{x:f,y:0,width:e,height:c}),this._dividerDiv.position=f,this._coverDiv&&d.setViewBounds(this._coverDiv,{x:e/2-4,y:0,width:8,height:c})}else{e>c&&(e=c);var h=(c-e)*a,i=c-e-h;d.setViewBounds(this._firstView,{x:0,y:0,width:b,height:h}),d.setViewBounds(this._nextView,{x:0,y:h+e,width:b,height:i}),d.setViewBounds(this._dividerDiv,{x:0,y:h,width:b,height:e}),this._dividerDiv.position=h,this._coverDiv&&d.setViewBounds(this._coverDiv,{x:0,y:e/2-4,width:b,height:8})}var j=this._dividerDiv.style;j.background=this._dividerBackground}}),c.controls.SplitPaneInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv;var b=this;this.view.addEventListener("mousedown",function(a){a.button===0&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},d.ext("twaver.controls.SplitPaneInteraction",Object,{handleMouseDown:function(a){if(!this.splitPane.isDividerDraggable())return;if(this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=s.createDiv();var b=this.resizeDiv.style;b.left=this.dividerDiv.style.left,b.top=this.dividerDiv.style.top,b.width=this.dividerDiv.style.width,b.height=this.dividerDiv.style.height,b.opacity=this.splitPane.getDividerOpacity(),b.background=this.splitPane.getDividerBackground(),this.resizeDiv.lastPosition=this.splitPane._orientation==="horizontal"?a.clientX:a.clientY,this.resizeDiv.maskDiv=s.createDiv(),b=this.resizeDiv.maskDiv.style,b.left="0px",b.top="0px",b.width=this.view.clientWidth+"px",b.height=this.view.clientHeight+"px",b.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv),s.handle_mousedown(this,a),a.preventDefault()}},handleMouseMove:function(a){if(!this.splitPane.isDividerDraggable())return;if(!this.resizeDiv&&!s.target){var b=this.splitPane._orientation==="horizontal"?"ew-resize":"ns-resize";this.view.style.cursor=a.target===this.dividerDiv||a.target===this.splitPane._coverDiv?b:"default"}else this.resizeDiv&&s.target===this&&(this.splitPane._orientation==="horizontal"?this.resizeDiv.style.left=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition+"px")},handleMouseUp:function(a){if(!this.splitPane.isDividerDraggable())return;a.button===0&&this.clear(a)},clear:function(a){if(this.resizeDiv){var b=this.splitPane._dividerWidth,c;if(this.splitPane._orientation==="horizontal"){var d=this.view.clientWidth;b>d&&(b=d),c=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition,this.splitPane.setPosition(c/(d-b))}else{var e=this.view.clientHeight;b>e&&(b=e),c=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition,this.splitPane.setPosition(c/(e-b))}this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),c.controls.SplitPaneTouchInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv,s.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.SplitPaneTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a);if(this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=s.createDiv();var b=this.resizeDiv.style;b.left=this.dividerDiv.style.left,b.top=this.dividerDiv.style.top,b.width=this.dividerDiv.style.width,b.height=this.dividerDiv.style.height,b.opacity=this.splitPane.getDividerOpacity(),b.background=this.splitPane.getDividerBackground();var c=a.changedTouches[0];this.resizeDiv.lastPosition=this.splitPane._orientation==="horizontal"?c.clientX:c.clientY,this.resizeDiv.maskDiv=s.createDiv();var b=this.resizeDiv.maskDiv.style;b.left="0px",b.top="0px",b.width=this.view.clientWidth+"px",b.height=this.view.clientHeight+"px",b.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv)}s.addEventListener("touchmove","handleTouchmove",this.view,this),s.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){s.preventDefault(a);if(!!this.resizeDiv){var b=a.changedTouches[0];this.splitPane._orientation==="horizontal"?this.resizeDiv.style.left=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition+"px"}},handleTouchend:function(a){s.removeEventListener("touchmove",this.view,this),s.removeEventListener("touchend",this.view,this),this.clear(a)},clear:function(a){var b=a.changedTouches[0];if(this.resizeDiv){var c=this.splitPane._dividerWidth;if(this.splitPane._orientation==="horizontal"){var d=this.view.clientWidth;c>d&&(c=d);var e=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition;this.splitPane.setPosition(e/(d-c))}else{var f=this.view.clientHeight;c>f&&(c=f);var e=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition;this.splitPane.setPosition(e/(f-c))}this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),c.controls.TabPane=function(){c.controls.TabPane.superClass.constructor.apply(this,arguments),this._tabBox=new c.TabBox,this._tabBox.addDataBoxChangeListener(this.handleTabChange,this),this._tabBox.addDataPropertyChangeListener(this.handleTabChange,this),this._tabBox.addHierarchyChangeListener(this.handleTabChange,this),this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange,this),this._view=s.createView("hidden",!0),this._tabDiv=s.createDiv(),this._tabDiv.onmousedown=s.preventDefault,this._tabDiv.onkeydown=s.preventDefault,this._contentDiv=s.createDiv(),this._view.appendChild(this._tabDiv),this._view.appendChild(this._contentDiv),this._divPool=new c.Pool("div"),this._iconPool=new c.Pool("img"),this._closePool=new c.Pool("img"),this._textPool=new c.Pool("span"),this._resizePool=new c.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._closePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this.invalidateTab();var a;m.isTouchable&&!m.isMSToucheable?a=c.controls.TabPaneTouchInteraction:a=c.controls.TabPaneInteraction,a&&new a(this)},d.ext("twaver.controls.TabPane",c.controls.ControlBase,{__accessor:["tabGap","tabRadius","tabHeight","horizontalAlign","tabOrientation","resizeTolerance","tabBackground","selectBackground","moveBackground","insertBackground","closeIcon","disabledColor"],__bool:["selectNextOnClose","selectNextOnInVisible"],_tabGap:Se.TABPANE_TAB_GAP,_tabRadius:Se.TABPANE_TAB_RADIUS,_tabHeight:Se.TABPANE_TAB_HEIGHT,_resizeTolerance:Se.TABPANE_RESIZE_TOLERANCE,_tabOrientation:Se.TABPANE_TAB_ORIENTATION,_tabBackground:Se.TABPANE_TAB_BACKGROUND,_disabledColor:Se.TABPANE_DISABLED_COLOR,_selectBackground:Se.TABPANE_SELECT_BACKGROUND,_moveBackground:Se.TABPANE_MOVE_BACKGROUND,_insertBackground:Se.TABPANE_INSERT_BACKGROUND,_horizontalAlign:Se.TABPANE_HORIZONTAL_ALIGN,_closeIcon:Se.TABPANE_CLOSE_ICON,_selectNextOnClose:Se.TABPANE_SELECT_NEXT_ON_CLOSE,_selectNextOnInVisible:Se.TABPANE_SELECT_NEXT_ON_INVISIBLE,onPropertyChanged:function(a){this.invalidateTab()},getTabBox:function(){return this._tabBox},getTabDiv:function(){return this._tabDiv},getContentDiv:function(){return this._contentDiv},handleTabChange:function(a){if(this._selectNextOnInVisible&&a.property==="visible"&&!a.newValue&&this._tabBox.getSelectionModel().contains(a.source)){var b=a.source,c=this._tabBox.getRoots().indexOf(b),d=this._tabBox.getRoots(),e=d.size(),f=c,g,h;while(f<e-1){g=d.get(++f);if(g.isVisible()&&!g.isDisabled()){h=g;break}}if(!h){f=c;while(f>0){g=d.get(--f);if(g.isVisible()&&!g.isDisabled()){h=g;break}}}this._tabBox.getSelectionModel().setSelection(h)}this.invalidateTab()},invalidateTab:function(a){this._invalidateTab||(this._invalidateTab=!0,this.invalidate(a))},validateImpl:function(){this._invalidateTab&&(this._invalidateTab=!1,this.validateTab());var a=this._view.offsetWidth,b=this._view.offsetHeight,c;this._tabOrientation==="top"?(this._tabDiv.style.top="0px",c={x:0,y:this._tabHeight,width:a,height:Math.max(0,b-this._tabHeight)}):(this._tabDiv.style.top=b-this._tabHeight+"px",c={x:0,y:0,width:a,height:Math.max(0,b-this._tabHeight)}),this._currentView&&d.setViewBounds(this._currentView,c)},getCurrentTab:function(){return this._currentTab},getCurrentView:function(){return this._currentView},onViewRemoved:function(a){},onViewAdded:function(a){},validateTab:function(){this._currentTab=this._tabBox.getSelectionModel().getLastData();var a=this._currentTab?this._currentTab.getView():null;if(a!==this._currentView){var b,c;this._currentView&&(b=this._currentView.getView?this._currentView.getView():this._currentView,b.style.visibility="hidden",this.onViewRemoved(this._currentView)),a&&(c=a.getView?a.getView():a,c.style.visibility="inherit",c.parentNode||this._contentDiv.appendChild(c),this.onViewAdded(a)),this._currentView=a}s.release(this._tabDiv);var d=this._tabBox.getRoots(),e=this._tabHeight+"px",f=this._tabHeight-2+"px",g=this._tabRadius+"px",h=d.size(),i=0;for(var j=0;j<h;j++){var k=d.get(j);if(k.isVisible()){var l=this._currentTab===k,m=k.getWidth();m<0&&(m=0);var n=Math.min(this._tabGap,m),o=this._divPool.get();o._tab=k;var p=o.style;p.position="absolute",p.whiteSpace="nowrap",p.lineHeight=f,p.overflow="hidden",p.textOverflow="ellipsis",p.background=l?this._selectBackground:this._tabBackground,p.textAlign=this._horizontalAlign,this._tabOrientation==="top"?(p.borderTopLeftRadius=g,p.borderTopRightRadius=g,p.borderBottomLeftRadius="0px",p.borderBottomRightRadius="0px"):(p.borderTopLeftRadius="0px",p.borderTopRightRadius="0px",p.borderBottomLeftRadius=g,p.borderBottomRightRadius=g),p.left=i+"px",p.width=m-n+"px",p.height=e,o._x=i,o._width=m-n,this.renderTab(o,k),this.onTabRendered(o,k),this._tabDiv.insertBefore(o,this._tabDiv.firstChild),i+=m,k.isResizable()&&(o=this._resizePool.get(),o._resizeTab=k,p=o.style,p.position="absolute",p.backgroundColor="white",p.opacity=0,p.left=i-n-this._resizeTolerance+"px",p.width=n+this._resizeTolerance*2+"px",p.height=e,this._tabDiv.appendChild(o))}}this._tabDiv.style.left="0px",this._tabDiv.style.width=i+"px",this._tabDiv.style.height=this._tabHeight+"px",this._pools.forEach(function(a){a.clear()})},renderTab:function(a,b){if(b.renderTab)b.renderTab(a);else{var c=b.getIcon();if(c){var e=this._iconPool.get();e.setAttribute("src",d.getImageSrc(c)),e.style.paddingLeft="4px",e.style.verticalAlign="middle",a.appendChild(e)}var f=b.getName();if(f){var g=this._textPool.get();g.style.whiteSpace="nowrap",g.style.verticalAlign="middle",g.style.padding="2px 4px",g.innerHTML=f,a.appendChild(g)}if(m.isOpera){var h=a.cloneNode(!1);h.style.left="0px",h.style.top="0px",h.style.opacity=0,a.appendChild(h)}}if(b.isClosable()){var i=this._tabRadius/4+2,e=this._closePool.get();e._closeTab=b,e.setAttribute("src",d.getImageSrc(this._closeIcon)),e.style.position="absolute",e.style.top=i+"px",e.style.right=i+"px",a.appendChild(e)}b.isDisabled()?a.style.color=this.getDisabledColor():a.style.color=""},onTabRendered:function(a,b){}}),c.controls.TabPaneInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv();var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},d.ext("twaver.controls.TabPaneInteraction",Object,{handleMouseDown:function(a){if(a.button!==0)return;if(this.movableDiv){this.handleMouseUp(a);return}this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this.lastX=this.getX(a),this._startClient=s.getClientPoint(a),this._startLogicalX=this.lastX,s.handle_mousedown(this,a)},changeCursor:function(a){var b="";if(a.target._resizeTab)b="ew-resize";else{var c=this.getTabAt(a);c&&(!c.isDisabled()||c.isMovable())&&(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(this.lastX==null){this.changeCursor(a);return}if(s.target!==this)return;var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeTab){if(this.stopX!=null){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);c<10&&(c=10,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=s.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleMouseUp:function(a){if(a.button!==0)return;if(!this.resizeTab)if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear()},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX,delete this._startLogicalX,delete this._startClient},getTabAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._tab))a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._tab))a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=s.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){var b=this._startLogicalX+a.clientX-this._startClient.x,c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1;for(var g=0;g<d;g++){var h=c.get(g);h===this.movableDiv._tab&&(f=!0);if(h.isVisible()){var i=h.getWidth();if(i<=0)continue;if(b>=e&&b<=e+i){var j=b<e+i/2;f&&(h!==this.movableDiv._tab||!j)&&g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),c.controls.TabPaneTouchInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv(),s.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.controls.TabPaneTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a);if(this.movableDiv){this.handleTouchend(a);return}this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),s.addEventListener("touchmove","handleTouchmove",this.view,this),s.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(this.lastX==null)return;if(this.resizeTab){var b=this.getX(a);if(this.stopX!=null){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);c<0&&(c=0,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var b=this.getX(a),d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=s.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleTouchend:function(a){if(!this.resizeTab)if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear(),s.removeEventListener("touchmove",this.view,this),s.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX},getTabAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._tab))a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;var b;while(a&&a!==this.view&&!(b=a._tab))a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=s.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){var b=this.getX(a),c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1;for(var g=0;g<d;g++){var h=c.get(g);h===this.movableDiv._tab&&(f=!0);if(h.isVisible()){var i=h.getWidth();if(i<=0)continue;if(b>=e&&b<=e+i){var j=b<e+i/2;f&&(h!==this.movableDiv._tab||!j)&&g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),c.controls.TitlePane=function(a,b,d){c.controls.TitlePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._titleDiv=s.createDiv(),this._titleDiv.tabIndex=-1,this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.fontWeight="bold",this._titleDiv.style.textOverflow="ellipsis",this._titleDiv.style.overflow="hidden",this._titleDiv.style.whiteSpace="nowrap",this._titleDiv.onmousedown=s.preventDefault,this._span=k.createElement("span"),this._span.style.verticalAlign="middle",this._span.style.paddingLeft="4px",this._span.style.paddingRight="4px",this._img=k.createElement("img"),this._img.style.verticalAlign="middle",this._img.style.paddingLeft="4px",this._view=s.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._titleDiv),b&&this.setTitle(b),a&&this.setContent(a),d&&this.setIcon(d)},d.ext("twaver.controls.TitlePane",c.controls.ControlBase,{__accessor:["icon","title","titleHeight","titleHorizontalAlign","titleBackground"],_titleHeight:Se.TITLEPANE_TITLE_HEIGHT,_titleBackground:Se.TITLEPANE_TITLE_BACKGROUND,_titleHorizontalAlign:Se.TITLEPANE_TITLE_HORIZONTAL_ALIGN,onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getContent:function(){return this._content},setContent:function(a){if(this._content===a)return;var b=this._content;b&&(b.getView?this._view.removeChild(b.getView()):this._view.removeChild(b)),this._content=a,a&&(a.getView?this._view.appendChild(a.getView()):this._view.appendChild(a)),this.firePropertyChange("content",b,a)},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._titleDiv.style;c.textAlign=this._titleHorizontalAlign,c.lineHeight=this._titleHeight-2+"px",c.background=this._titleBackground,s.clear(this._titleDiv),this._icon&&(this._img.setAttribute("src",d.getImageSrc(this._icon)),this._titleDiv.appendChild(this._img)),this._title&&(this._span.innerHTML=this._title,this._span.setAttribute("title",this._title),this._titleDiv.appendChild(this._span));var c=this._titleDiv.style;c.left="0px",c.top="0px",c.width=a+"px",c.height=this._titleHeight+"px",d.setViewBounds(this._content,{x:0,y:this._titleHeight,width:a,height:Math.max(b-this._titleHeight,0)})}}),c.controls.Accordion=function(){c.controls.Accordion.superClass.constructor.apply(this,arguments),this._titleMap={},this._titleList=new Ce,this._currentTitle=null,this._currentView=null,this._view=s.createView("hidden",!0),this.invalidate();var a=this;this._view.addEventListener("mousedown",function(b){a.handleMouseDown(b)},!1)},d.ext("twaver.controls.Accordion",c.controls.ControlBase,{__accessor:["expandIcon","collapseIcon","titleHeight","titleBackground","borderBottomColor","iconPosition"],_expandIcon:Se.ACCORDION_EXPAND_ICON,_collapseIcon:Se.ACCORDION_COLLAPSE_ICON,_titleHeight:Se.ACCORDION_TITLE_HEIGHT,_titleBackground:Se.ACCORDION_TITLE_BACKGROUND,_borderBottomColor:Se.ACCORDION_BORDER_BOTTOM_COLOR,_iconPosition:Se.ACCORDION_ICON_POSITION,onPropertyChanged:function(a){this.invalidate()},handleMouseDown:function(a){if(a.button!==0)return;var b=a.target._title;b||(b=a.target.parentNode._title),b&&(this._currentTitle===b?this.collapse():this.expand(b))},getTitles:function(){return this._titleList},getCurrentTitle:function(){return this._currentTitle},add:function(a,b){if(this._titleMap[a])throw"Title ' + title + ' already exists";var c=s.createDiv();c._title=a,c.onmousedown=s.preventDefault,c.style.cursor="pointer",c.style.textAlign="left",c.style.textOverflow="ellipsis",c.style.whiteSpace="nowrap",c.style.overflow="hidden",c.style.borderBottomWidth="1px",c.style.borderBottomStyle="solid";var d=k.createElement("img");d.style.verticalAlign="middle",d.style.paddingLeft="4px";var e=k.createElement("span");e.style.verticalAlign="middle",e.style.paddingLeft="4px",e.innerHTML=a,e.setAttribute("title",a),this._view.appendChild(c),c.appendChild(d),c.appendChild(e);if(this._iconPosition=="right"){var f=d.style,g=(this._titleHeight-8)/2;f.marginTop=g+"px",f.right="15px",f.position="absolute"}this._titleMap[a]={content:b,titleDiv:c,span:e,img:d},this._titleList.add(a),this.invalidate()},remove:function(a){var b=this._titleMap[a];b&&this._view.removeChild(b.titleDiv),delete this._titleMap[a],this._titleList.remove(a),this.invalidate()},clear:function(){var a=this;Object.keys(a._titleMap).forEach(function(b){a._view.removeChild(a._titleMap[b].titleDiv)}),a._titleMap={},a._titleList.clear(),a.invalidate()},expand:function(a){this._titleMap[a]&&this._currentTitle!==a&&(this._currentTitle=a,this.onExpanded(a),this.invalidate())},onExpanded:function(a){},collapse:function(){this._currentTitle&&(this.onCollapsed(this._currentTitle),this._currentTitle=null,this.invalidate())},onCollapsed:function(a){},validateImpl:function(){var a=this._currentView;this._currentView=null;var b=this._view.offsetWidth,c=this._view.offsetHeight,e=this._titleList.size(),f=0;for(var g=0;g<e;g++){var h=this._titleList.get(g),i=this._titleMap[h],j=i.titleDiv.style;j.lineHeight=this._titleHeight-3+"px",j.background=this._titleBackground,j.borderBottomColor=this._borderBottomColor,j.left="0px",j.top=f+"px",j.width=b+"px",j.height=this._titleHeight-1+"px";var k=this._currentTitle===h,l=k?this._expandIcon:this._collapseIcon;i.img.setAttribute("src",d.getImageSrc(l));if(k){var m=Math.max(0,c-e*this._titleHeight);i.content&&(this._currentView=i.content.getView?i.content.getView():i.content,d.setViewBounds(i.content,{x:0,y:f+this._titleHeight,width:b,height:m})),f+=this._titleHeight+m}else f+=this._titleHeight}this._currentView&&this._currentView!==a&&this._view.appendChild(this._currentView),a&&a!==this._currentView&&this._view.removeChild(a)}}),c.controls.BorderPane=function(a,b,d,e,f){c.controls.BorderPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._view=s.createView("hidden",!0),this._view.tabIndex=-1,a&&this.setCenter(a),b&&this.setTop(b),d&&this.setRight(d),e&&this.setBottom(e),f&&this.setLeft(f)},d.ext("twaver.controls.BorderPane",c.controls.ControlBase,{__accessor:["hGap","vGap","topHeight","bottomHeight","leftWidth","rightWidth"],_hGap:Se.BORDERPANE_HGAP,_vGap:Se.BORDERPANE_VGAP,_topHeight:0,_bottomHeight:0,_leftWidth:0,_rightWidth:0,onPropertyChanged:function(a){this.invalidate()},getCenter:function(){return this._center},setCenter:function(a){this._setContent("center",a)},getTop:function(){return this._top},setTop:function(a){this._setContent("top",a)},getRight:function(){return this._right},setRight:function(a){this._setContent("right",a)},getBottom:function(){return this._bottom},setBottom:function(a){this._setContent("bottom",a)},getLeft:function(){return this._left},setLeft:function(a){this._setContent("left",a)},_setContent:function(a,b){var c=this["_"+a];if(c===b)return;if(c){var d=c.getView?c.getView():c;this._view.contains(d)&&this._view.removeChild(d)}this["_"+a]=b,b&&(b.getView?this._view.appendChild(b.getView()):this._view.appendChild(b)),this.firePropertyChange(a,c,b)},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=0,e=0,f=a,g=b,h=0,i=0,j=0,k=0;this._top&&(h=this._topHeight||(this._top.getView?this._top.getView().offsetHeight:this._top.offsetHeight),e=h+this._vGap),this._bottom&&(i=this._bottomHeight||(this._bottom.getView?this._bottom.getView().offsetHeight:this._bottom.offsetHeight),g=b-i-this._vGap),this._left&&
(j=this._leftWidth||(this._left.getView?this._left.getView().offsetWidth:this._left.offsetWidth),c=j+this._hGap),this._right&&(k=this._rightWidth||(this._right.getView?this._right.getView().offsetWidth:this._right.offsetWidth),f=a-k-this._hGap);var l=Math.max(0,f-c),m=Math.max(0,g-e);this._top&&d.setViewBounds(this._top,{x:0,y:0,width:a,height:h}),this._bottom&&d.setViewBounds(this._bottom,{x:0,y:g,width:a,height:i}),this._left&&d.setViewBounds(this._left,{x:0,y:e,width:j,height:m}),this._right&&d.setViewBounds(this._right,{x:f,y:e,width:k,height:m}),this._center&&d.setViewBounds(this._center,{x:c,y:e,width:l,height:m})}}),c.controls.PopupMenu=function(a){this._view=s.createDiv(),this._view.style.zIndex=100001,this._items=[],this._itemsMap={},this.setContextView(a);var b=this._view,c=this;b.addEventListener("mouseover",function(a){c._mouseOver=!0},!1),b.addEventListener("mouseout",function(a){c._mouseOver=!1},!1),b.oncontextmenu=function(a){a.preventDefault()},s.addEventListener("mousedown","_handleClick",b,this)},d.ext("twaver.controls.PopupMenu",Object,{_width:200,_menuItemHeight:25,_background:"#F9F9F9",_border:"2px outset white",_disabledColor:"#BABBBC",_focusColor:"#C2CFF1",_subMenuEnableIcon:Se.POPUPMENU_SUBNENU_ENABLE_ICON,_subMenuDisableIcon:Se.POPUPMENU_SUBNENU_DISABLE_ICON,_checkboxSelectedIcon:Se.POPUPMENU_CHECKBOX_SELECTED_ICON,_checkboxUnselectedIcon:Se.POPUPMENU_CHECKBOX_UNSELECTED_ICON,_radiobuttonSelectedIcon:Se.POPUPMENU_RADIOBUTTON_SELECTED_ICON,_radiobuttonUnselectedIcon:Se.POPUPMENU_RADIOBUTTON_UNSELECTED_ICON,getView:function(){return this._view},getContextView:function(){return this._contextView},setContextView:function(a){this._removeContextmenuListener(),this._contextView=a;if(a){var b=a.getView?a.getView():a;m.isTouchable?(b.addEventListener("touchstart",this._getTouchStartListener(),!1),b.addEventListener("touchmove",this._getTouchMoveListener(),!1),b.addEventListener("touchend",this._getTouchEndListener(),!1)):s.addEventListener("contextmenu","_handleContextmenu",b,this)}},getMenuItems:function(){return this._items},setMenuItems:function(a){this._items=[],this._itemsMap={};if(a)for(var b=0,c=a.length;b<c;b++)this.addMenuItem(a[b])},addMenuItem:function(a){a.separator!==!0&&(this._itemsMap[a.id||a.label]=a),this._items.push(a)},getMenuItem:function(a){return this._itemsMap[a]},addSeparator:function(){this.addMenuItem({separator:!0})},getMenuItemById:function(a){return this._itemsMap[a]},isVisible:function(a){return a.visible!==!1},isEnabled:function(a){return a.enabled!==!1},show:function(a){this.hide();var b=this._view,c=this._view.style,d,e;m.isTouchable?(d=a.changedTouches[0].clientX,e=a.changedTouches[0].clientY):(d=a.clientX,e=a.clientY),s.clear(b),this.renderMenu(b,this._items);if(this._height===0)return;s.addEventListener(m.isTouchable?"touchstart":"mousedown","_handleBodyClicked",k.body,this);var f=s.windowWidth()-this._width-10,g=s.windowHeight()-this._height-10;d=d>f?f:d,e=e>g?g:e,d=d<0?0:d,e=e<0?0:e,c.left=d+Ad.scrollLeft()+"px",c.top=e+Ad.scrollTop()+"px",k.body.appendChild(b)},_showMenuItem:function(a,b){this._hideMenuItem(b);var c=k.createElement("div");b.menuItem.childrenDiv=c;var d=c.style;d.color="#000000",d.position="absolute";var e=this._width,f=b.offsetTop,g=b.menuItem.items;this._itemsShow=!0,b.appendChild(c),s.clear(c),this.renderMenu(c,g);if(this._height===0)return;var h=s.windowWidth()-this._width-10,i=s.windowHeight()-10,j=this._getPosition(this._view);e=j.left+this._width>h?-this._width:e,f=j.top+f+g.length*this._menuItemHeight>i?f-(g.length-1)*this._menuItemHeight:f,d.left=e+"px",d.top=f+"px",b.appendChild(c)},hide:function(){k.body.contains(this._view)&&k.body.removeChild(this._view),delete this._mouseOver,delete this._itemsShow,s.removeEventListener(m.isTouchable?"touchstart":"mousedown",k.body,this)},_hideMenuItem:function(a){var b=a.menuItem.childrenDiv;b&&a.contains(b)&&a.removeChild(b),this._itemsShow=!1},dispose:function(){this._removeContextmenuListener(),this.hide()},onMenuShowing:function(a){return!0},onAction:function(a){},renderMenu:function(a,b){var c=a.style;c.background=this._background,c.border=this._border,c.width=this._width+"px",this._height=0,delete this._separator;for(var d=0,e=b.length,f;d<e;d++){f=b[d];if(this.isVisible(f))if(f.separator===!0)this._separator=!0;else{var g=k.createElement("div");this.isEnabled(f)&&this._addMouseoverListener(g,f),g.menuItem=f,a.appendChild(g),this.renderMenuItem(g,f),this.onMenuItemRendered(g,f),this._separator=!1,this._height+=this._menuItemHeight}}},renderMenuItem:function(a,b){var c=a.style;c.height=this._menuItemHeight+"px",this._separator&&(c.borderTop="1px solid gray"),this.isEnabled(b)||(c.color=this._disabledColor);var e=k.createElement("span");c=e.style,c.position="absolute",c.width="25px",c.height=this._menuItemHeight+"px",c.lineHeight=this._menuItemHeight+"px",c.textAlign="center",a.appendChild(e);var f;b.type==="check"?f=b.selected?this._checkboxSelectedIcon:this._checkboxUnselectedIcon:b.type==="radio"?f=b.selected?this._radiobuttonSelectedIcon:this._radiobuttonUnselectedIcon:b.icon&&(f=b.icon);if(f){var g=new l;g.src=d.getImageSrc(f),g.style.verticalAlign="middle",e.appendChild(g)}var h=k.createElement("label");d.setText(h,b.label,!0),c=h.style,c.position="absolute",c.height=this._menuItemHeight+"px",c.lineHeight=this._menuItemHeight+"px",c.left="25px",a.appendChild(h);if(b.items&&a.parentNode===this._view){var i=k.createElement("img");c=i.style,this.isEnabled(b)?i.setAttribute("src",d.getImageSrc(this._subMenuEnableIcon)):i.setAttribute("src",d.getImageSrc(this._subMenuDisableIcon));var j=(this._menuItemHeight-8)/2;c.marginTop=j+"px",c.right="5px",c.position="absolute",a.appendChild(i)}},onMenuItemRendered:function(a,b){},_addMouseoverListener:function(a,b){var c=this;a.addEventListener(m.isTouchable?"touchstart":"mouseover",function(d){a.style.background=c._focusColor,a.style.color="#FFFFFF",this!==d.relatedTarget&&!this.contains(d.relatedTarget)&&b.items&&!c._itemsShow&&a.parentNode==c._view&&c._showMenuItem(d,a)},!1),a.addEventListener(m.isTouchable?"touchend":"mouseout",function(d){a.style.background=c._background,a.style.color="#000000";if(this!==d.relatedTarget&&!this.contains(d.relatedTarget)&&b.items&&a.parentNode===c._view){var e=d.clientX,f=d.clientY,g=b.childrenDiv,h=c._getPosition(g);(e<h.left+2||e>h.left+g.offsetWidth-2||f<h.top+2||f>h.top+g.offsetHeight-2)&&c._hideMenuItem(a)}},!1)},_getPosition:function(a){var b=0,c=0;while(a)c+=a.offsetLeft,b+=a.offsetTop,a=a.offsetParent;return{left:c,top:b}},_removeContextmenuListener:function(){var a=this._contextView;a&&(a=a.getView?a.getView():a,m.isTouchable?(a.removeEventListener("touchstart",this._getTouchStartListener(),!1),a.removeEventListener("touchmove",this._getTouchMoveListener(),!1),a.removeEventListener("touchend",this._getTouchEndListener(),!1)):s.removeEventListener("contextmenu",a,this))},_handleContextmenu:function(a){this.onMenuShowing(a)===!0&&this.show(a),a.preventDefault()},_handleBodyClicked:function(a){if(m.isTouchable){var b=a.target;while(b&&b!==this._view)b=b.parentElement;b!==this._view&&this.hide()}else this._mouseOver||this.hide()},_handleClick:function(a){if(a.button!==0)return;var b=a.target;while(!b.menuItem&&b.parentElement)b=b.parentElement;var c=b?b.menuItem:null;c&&this.isEnabled(c)&&(c.type==="check"&&(c.selected=!c.selected),c.type==="radio"&&(c.groupName?(c.selected=!0,this._items.forEach(function(a){c!==a&&a.groupName===c.groupName&&(a.selected=!1),a.items&&a.items.forEach(function(a){c!==a&&a.groupName===c.groupName&&(a.selected=!1)})})):c.selected=!c.selected),c.action&&c.action(c),this.onAction(c),c.items&&c.items.length>0||this.hide())},_getTouchStartListener:function(){if(!this._touchStartListener){var a=this;this._touchStartListener=function(b){a._touchMoved=!1,a._lastTouch=new Date}}return this._touchStartListener},_getTouchMoveListener:function(){if(!this._touchMoveListener){var a=this;this._touchMoveListener=function(b){a._touchMoved=!0}}return this._touchMoveListener},_getTouchEndListener:function(){if(!this._touchEndListener){var a=this;this._touchEndListener=function(b){!a._touchMoved&&(new Date).getTime()-a._lastTouch.getTime()>1e3&&a._handleContextmenu(b)}}return this._touchEndListener},getWidth:function(){return this._width},setWidth:function(a){this._width=a},getMenuItemHeight:function(){return this._menuItemHeight},setMenuItemHeight:function(a){this._menuItemHeight=a},getBackground:function(){return this._background},setBackground:function(a){this._background=a},getBorder:function(){return this._border},setBorder:function(a){this._border=a},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(a){this._disabledColor=a},getFocusColor:function(){return this._focusColor},setFocusColor:function(a){this._focusColor=a},getSubMenuEnableIcon:function(){return this._subMenuEnableIcon},setSubMenuEnableIcon:function(a){this._subMenuEnableIcon=a},getSubMenuDisableIcon:function(){return this._subMenuDisableIcon},setSubMenuDisableIcon:function(a){this._subMenuDisableIcon=a},getCheckboxSelectedIcon:function(){return this._checkboxSelectedIcon},setCheckboxSelectedIcon:function(a){this._checkboxSelectedIcon=a},getCheckboxUnselectedIcon:function(){return this._checkboxUnselectedIcon},setCheckboxUnselectedIcon:function(a){this._checkboxUnselectedIcon=a},getRadiobuttonSelectedIcon:function(){return this._radiobuttonSelectedIcon},setRadiobuttonSelectedIcon:function(a){this._radiobuttonSelectedIcon=a},getRadiobuttonUnselectedIcon:function(){return this._radiobuttonUnselectedIcon},setRadiobuttonUnselectedIcon:function(a){this._radiobuttonUnselectedIcon=a}}),c.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},c.charts.ChartBase=function(a){c.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new Ce,this._view=s.createView("hidden"),this._canvas=s.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(a?a:new c.ElementBox),this.invalidate();var b;m.isMSToucheable?b=c.charts.ChartMSTouchInteraction:m.isTouchable?b=c.charts.ChartTouchInteraction:b=c.charts.ChartInteraction,b&&new b(this),this.setToolTipEnabled(Se.CHART_TOOLTIP_ENABLED)},d.ext("twaver.charts.ChartBase",c.controls.ViewBase,{__accessor:["xGap","yGap","xTranslate","yTranslate","valueVisible","sortFunction","visibleFunction","xTranslateEnabled","yTranslateEnabled","xZoomEnabled","yZoomEnabled","selectTolerance","backgroundVisible","backgroundFill","backgroundFillColor","backgroundOutlineWidth","backgroundOutlineColor","backgroundGradient","backgroundGradientColor","outerZoom"],__bool:["doubleClickToReset","focusOnClick"],_backgroundVisible:Se.CHART_BACKGROUND_VISIBLE,_backgroundFill:Se.CHART_BACKGROUND_FILL,_backgroundFillColor:Se.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:Se.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:Se.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:Se.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:Se.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:Se.CHART_SELECT_TOLERANCE,_doubleClickToReset:Se.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:Se.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_outerZoomL:1,_xGap:Se.CHART_XGAP,_yGap:Se.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:Se.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:Se.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:Se.ZOOM_MAX,_minZoom:Se.ZOOM_MIN,_xZoomEnabled:Se.CHART_XZOOM_ENABLED,_yZoomEnabled:Se.CHART_YZOOM_ENABLED,_valueVisible:Se.CHART_VALUE_VISIBLE,_valueFont:Se.CHART_VALUE_FONT,isToolTipEnabled:function(){return this._toolTipListener?!0:!1},setToolTipEnabled:function(a){if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){Cd.showToolTip(a,b.getToolTip(a))},this._canvas.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Cd.hideToolTip(),this._canvas.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getToolTip:function(a){if(this._toolTipInfos){var b=this.getLogicalPoint(a);b.x-=this._xTranslate,b.y-=this._yTranslate;var c=this._toolTipInfos.size();for(var d=c-1;d>=0;d--){var e=this._toolTipInfos.get(d);if(e.rect&&p.containsPoint(e.rect,b))return this.getToolTipByData(e.data,e)}}else{var f=this.tryGetDataAt(a);if(f)return this.getToolTipByData(f,{value:this.getValue(f)})}return null},getToolTipByData:function(a,c){return c.value!==b?this.formatValueText(c.value,a):null},addToolTipInfo:function(a,b,c,d,e,f,g){this._toolTipInfos&&this._toolTipInfos.add({data:f,rect:{x:a,y:b,width:c,height:d},value:e,index:g})},getLogicalPoint:function(a){return s.getLogicalPoint(this._canvas,a,this._outerZoom)},getTextSize:function(a,b){var c=t.getTextSize(a,b);return c.width&&(c.width+=4),c},getUniqueColor:function(a,c){if(a==null)return null;var d;if(!c){d=this._nonDataColors[a];if(d)return d}var e=t.getColorArray(a);if(!c)return e[3]!=255?d=a:d="rgba("+e[0]+","+e[1]+","+e[2]+",0.99)",this._nonDataColors[a]=d,d;var f="rgb("+e[0]+","+e[1]+","+e[2]+")";if(this._uniqueColors[f]!==b&&this._uniqueColors[f]!==c){var g=1,h=-1,i=1;m.isOpera&&(e=[e[0],e[1],e[2]]);for(;;){e[0]+=g,e[0]>=255?(e[0]=255,g=-1):e[0]<=0&&(e[0]=0,g=1),f="rgb("+e[0]+","+e[1]+","+e[2]+")";if(this._uniqueColors[f]===b||this._uniqueColors[f]===c)break;e[1]+=h,e[1]>=255?(e[1]=255,h=-1):e[1]<=0&&(e[1]=0,h=1),f="rgb("+e[0]+","+e[1]+","+e[2]+")";if(this._uniqueColors[f]===b||this._uniqueColors[f]===c)break;e[2]+=i,e[2]>=255?(e[2]=255,i=-1):e[2]<=0&&(e[2]=0,i=1),f="rgb("+e[0]+","+e[1]+","+e[2]+")";if(this._uniqueColors[f]===b||this._uniqueColors[f]===c)break}}return this._uniqueColors[f]=c,f},tryGetDataAt:function(a,b){if(b==null||b<0)b=this._selectTolerance;a.target&&(a=s.getLogicalPoint(this._canvas,arguments[0],this._outerZoom));if(!a)return null;var c=a.x-b,d=a.y-b,e=b*2+1,f=b*2+1;try{var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data;for(var h=0,i=g.length;h<i;h+=4)if(g[h+3]===255){var j="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",k=this._uniqueColors[j];if(k)return k}}catch(l){}return null},_getPoint:function(){var a,b;if(arguments.length===2)a=arguments[0],b=arguments[1];else if(arguments[0].target){var c=s.getLogicalPoint(this._canvas,arguments[0],this._outerZoom);if(!c)return null;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;return{x:a,y:b}},getDataAt:function(){var a=this._getPoint.apply(this,arguments),b=a.x,c=a.y;if(b<0||c<0||b>this._canvasWidth||c>this._canvasHeight)return null;try{var d=this._canvas.getContext("2d").getImageData(b,c,1,1).data;if(d[3]===255){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(a,b){this._backgroundRect=d.clone(b),b!=null&&b.width>0&&b.height>0&&this._backgroundVisible&&(this._backgroundFill&&t.fill(a,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),b),this._backgroundOutlineWidth>0&&(a.lineWidth=this._backgroundOutlineWidth,a.strokeStyle=this._backgroundOutlineColor),a.beginPath(),a.rect(b.x,b.y,b.width,b.height),a.closePath(),this._backgroundFill&&a.fill(),this._backgroundOutlineWidth>0&&a.stroke())},getName:function(a){return a.getName()},getColor:function(a){return a.getStyle?a.getStyle("chart.color"):a.getClient("chart.color")},getValue:function(a){return a.getStyle?a.getStyle("chart.value"):0},getValueColor:function(a){return a.getStyle?a.getStyle("chart.value.color"):c.Styles.getStyle("chart.value.color")},setValueFont:function(a){if(a===this._valueFont)return;var b=a;this._valueFont=a,this.firePropertyChange("valueFont",b,a)},getValueFont:function(a){if(a){var b=a.getStyle?a.getStyle("chart.value.font"):c.Styles.getStyle("chart.value.font");if(b)return b}return this._valueFont},formatValueText:function(a,b){return a},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(a){return this._internalVisibleFunction&&!this._internalVisibleFunction(a)?!1:this._visibleFunction?this._visibleFunction(a):!0},onPropertyChanged:function(a){c.charts.IS_INVALIDATE_PROPERTY[a.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){this.invalidateModel()},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new Ce,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(a,b){a.forEach(function(a){b.add(a),this._buildChildren(a.getChildren(),b)},this)},invalidateModel:function(){if(this._invalidateModel)return;this._invalidateModel=!0,this.invalidate()},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(a){a.IStyle?a.getStyle("chart.color")||a.setStyle("chart.color",d.nextColor()):a.getClient("chart.color")||a.setClient("chart.color",d.nextColor())}),this.validateModel());var a=this._canvas.getContext("2d");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute("width",this._canvasWidth),this._canvas.setAttribute("height",this._canvasHeight),a.clearRect(0,0,this._canvasWidth,this._canvasHeight),this._canvasWidth>0&&this._canvasHeight>0&&(a.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new Ce:null,this.validateDisplay(a,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,a.translate(-this._xTranslate,-this._yTranslate))},validateModel:function(){},validateDisplay:function(a,b,c){},drawLine:function(a,b,c,d,e,f,g){c>0&&(a.lineWidth=c,a.strokeStyle=this.getUniqueColor(b),a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke())},drawValueTexts:function(a){this._valueTexts&&this._valueTexts.forEach(function(b){t.drawText(a,b.text,b,b.font,b.color)})},drawVerticalText:function(a,b,c,d,e){e=this.getUniqueColor(e),a.translate(c.x,c.y),a.rotate(-Math.PI/2),t.drawText(a,b,null,d,e),a.rotate(Math.PI/2),a.translate(-c.x,-c.y)},_getValueTextInfo:function(a,b){if(this._valueTexts){var c=this.formatValueText(b,a);if(c&&c!==""){var d=this.getValueColor(a),e={text:c,font:this.getValueFont(a),color:this.getUniqueColor(d,a)};return this._valueTexts.add(e),e}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(a<0)return;var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getXZoom()>a&&this.setXZoom(a,!1),this.getYZoom()>a&&this.setYZoom(a,!1)},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(a<0)return;var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getXZoom()<a&&this.setXZoom(a),this.getYZoom()<a&&this.setYZoom(a)},zoomIn:function(a){a==null&&(a=Se.ZOOM_ANIMATE),a?c.animate.AnimateManager.start(new c.animate.AnimateXYZoom(this,this._xZoom*Se.ZOOM_INCREMENT,this._yZoom*Se.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(a){a==null&&(a=Se.ZOOM_ANIMATE),a?c.animate.AnimateManager.start(new c.animate.AnimateXYZoom(this,this._xZoom/Se.ZOOM_INCREMENT,this._yZoom/Se.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(a){a==null&&(a=Se.ZOOM_ANIMATE),a?c.animate.AnimateManager.start(new c.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(a,b){},xZoomIn:function(a){this.setXZoom(this._xZoom*Se.ZOOM_INCREMENT,a)},xZoomOut:function(a){this.setXZoom(this._xZoom/Se.ZOOM_INCREMENT,a)},xZoomReset:function(a){this.setXZoom(1,a)},setXZoom:function(a,b){if(!d.num(a)||a<=0)return;a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom);if(a===this.xZoom)return;b==null&&(b=Se.ZOOM_ANIMATE);if(b)c.animate.AnimateManager.start(new c.animate.AnimateXZoom(this,a));else{var e=this._xZoom,f=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/e*(a-e);this._xZoom=a,this.firePropertyChange("xZoom",e,a),this.onXZoomChanged(e,a),this.setXTranslate(f)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(a,b){},yZoomIn:function(a){this.setYZoom(this._yZoom*Se.ZOOM_INCREMENT,a)},yZoomOut:function(a){this.setYZoom(this._yZoom/Se.ZOOM_INCREMENT,a)},yZoomReset:function(a){this.setYZoom(1,a)},setYZoom:function(a,b){if(!d.num(a)||a<=0)return;a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom);if(a===this.YZoom)return;b==null&&(b=Se.ZOOM_ANIMATE);if(b)c.animate.AnimateManager.start(new c.animate.AnimateYZoom(this,a));else{var e=this._yZoom,f=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/e*(a-e);this._yZoom=a,this.firePropertyChange("yZoom",e,a),this.onYZoomChanged(e,a),this.setYTranslate(f)}}}),c.charts.ScaleChart=function(a){c.charts.ScaleChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.ScaleChart",c.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","xAxisText","xAxisLineColor","xAxisLineWidth","xAxisTextColor","xAxisTextFont","yAxisText","yAxisLineColor","yAxisLineWidth","yAxisTextColor","yAxisTextFont","xScaleTexts","xScaleTextFont","xScaleTextColor","xScaleTextOrientation","yScaleTextVisible","yScaleTextColor","yScaleTextFont","yScaleLineColor","yScaleLineWidth","yScaleValueGap","yScalePixelGap","yScaleMinTextVisible","valueSpanCount"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,this._upperLimit!=null&&(this._max=this._upperLimit),this._lowerLimit!=null&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},formatYScaleText:function(a){return a.toFixed(2)},_initRange:function(){this._lowerLimit==null&&(this._min>=this._max&&(this._min=this._max-Math.abs(this._max)*.1),this._min=this._min-(this._max-this._min)*.1),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.values.forEach(function(a){a==null?b.proportions.add(null):b.proportions.add(this._range==0?0:a/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new Ce(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new Ce,color:this.getUniqueColor(this.getColor(a),a)};this._initInfo&&this._initInfo(a,c),this._map[a.getId()]=c,(this._upperLimit==null||this._lowerLimit==null)&&b.forEach(function(a){a!=null&&(this._upperLimit==null&&a>this._max&&(this._max=a),this._lowerLimit==null&&a<this._min&&(this._min=a))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(a,b,c){var d=0;this._xAxisText&&(d=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var e=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(a){var b=this.getTextSize(this._xScaleTextFont,a),c=this._xScaleTextOrientation==="vertical"?b.width:b.height;c>e&&(e=c)},this);var f=c-this._yGap-d-e,g=f-this._yGap,h=this._upperLimit==null?g*.9:g,i=0;this._yAxisText&&(i=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var j,k;this._yScaleValueGap>0?(j=Math.max(this._yScaleValueGap/this._range*h,1),k=this._yScaleValueGap):(j=Math.max(this._yScalePixelGap,1),k=this._range*(j/h));var l=0,m=new Ce,n,o;if(this._yScaleTextVisible){n=this._yScaleMinTextVisible?0:j;var p=this._min+(this._yScaleMinTextVisible?0:k);while(n<=g+1){o=this.formatYScaleText(p);if(o){var q=this.getTextSize(this._yScaleTextFont,o);q.width>l&&(l=q.width),m.add({text:o,size:q,cursor:n})}n+=j,p+=k}}var r={x:this._xGap+i+l,y:this._yGap,width:b-this._xGap-i-l-this._xGap,height:c-this._yGap-e-d-this._yGap};this.drawBackground(a,r),this._columnCount>0?this._columnWidth=r.width/(this._columnCount*3+1)*2:this._columnWidth=r.width/2,this._columnWidth===0&&(this._columnWidth=1);if(this._yScaleLineWidth>0){n=0;while(n<=g+1)this.drawLine(a,this._yScaleLineColor,this._yScaleLineWidth,r.x,f-n,r.x+r.width,f-n),n+=j}this._xAxisText&&t.drawText(a,this._xAxisText,{x:r.x+r.width/2,y:f+e+d/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(a,this._yAxisText,{x:this._xGap+i/2,y:g/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(a,this._yAxisLineColor,this._yAxisLineWidth,r.x,r.y+r.height,r.x,r.y);var s=this.getUniqueColor(this._yScaleTextColor);m.forEach(function(b){var c={x:this._xGap+i+l-b.size.width/2,y:f-b.cursor};t.drawText(a,b.text,c,this._yScaleTextFont,s)},this);var u=r.y+r.height+e/2;s=this.getUniqueColor(this._xScaleTextColor);var v=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null;for(var w=0;w<this._columnCount;w++){var x=r.x+this._columnWidth*(1+w*1.5);if(this._xScaleTexts&&w<this._xScaleTexts.size()){o=this._xScaleTexts.get(w);if(o){var y={x:x,y:u};this._xScaleTextOrientation==="vertical"?this.drawVerticalText(a,o,y,this._yScaleTextFont,s):this._valueSpanCount?w%this._valueSpanCount==0&&t.drawText(a,o,y,this._xScaleTextFont,s):t.drawText(a,o,y,this._xScaleTextFont,s)}}this._type!=="default"&&v&&(this._valueSpanCount?w%this._valueSpanCount==0&&this.drawLine(a,v,this._xScaleLineWidth,x,r.y+r.height,x,r.y):this.drawLine(a,v,this._xScaleLineWidth,x,r.y+r.height,x,r.y))}var z=f+this._min/k*j;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(a,r,h,z),this.drawLine(a,this._xAxisLineColor,this._xAxisLineWidth,r.x,r.y+r.height,r.x+r.width,r.y+r.height)}}),c.charts.PieChart=function(a){this._sum=0,this._map={},c.charts.PieChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.PieChart",c.charts.ChartBase,{__accessor:["type","selectOffset","startAngle","shadowColor","shadowOffset","lineRate","donutRate","valuePosition"],_type:Se.PIECHART_TYPE,_lineRate:Se.PIECHART_LINE_RATE,_donutRate:Se.PIECHART_DONUT_RATE,_startAngle:Se.PIECHART_START_ANGLE,_shadowColor:Se.PIECHART_SHADOW_COLOR,_shadowOffset:Se.PIECHART_SHADOW_OFFSET,_selectOffset:Se.PIECHART_SELECT_OFFSET,_valuePosition:Se.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)},this._sum+=b},this);var a=this._startAngle;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.proportion=this._sum===0?0:c.value/this._sum,this._type!=="line"&&(c.startAngle=a,c.arc=c.proportion*Math.PI*2,a+=c.arc)},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-this._xGap*2,height:c-this._yGap*2};this.drawBackground(a,d),p.grow(d,-4,-4);if(d.width<=0||d.height<=0)return;var e=this._shadowOffset;e>0&&(a.shadowOffsetX=e,a.shadowOffsetY=e,a.shadowBlur=e*1.5,a.shadowColor=this._shadowColor);if(this._type==="oval"||this._type==="circle"){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;this._type==="circle"&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(c.arc===0)return;var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}a.fillStyle=c.color,a.beginPath(),a.moveTo(f+d,g-e),t.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.closePath(),a.fill();var k=this._getValueTextInfo(b,c.value);if(k){var j=c.startAngle+c.arc/2;k.x=f+d+Math.cos(j)*h*this._valuePosition,k.y=g-e-Math.sin(j)*i*this._valuePosition}},this)}else if(this._type==="donut"||this._type==="ovalDonut"){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;this._type==="donut"&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(c.arc===0)return;var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}var k=f+Math.cos(c.startAngle)*h*this._donutRate,l=g-Math.sin(c.startAngle)*i*this._donutRate,m=f+Math.cos(c.startAngle+c.arc)*h*this._donutRate,n=g-Math.sin(c.startAngle+c.arc)*i*this._donutRate;a.fillStyle=c.color,a.beginPath(),a.moveTo(k+d,l-e),t.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.lineTo(m+d,n-e),t.drawArc(a,f+d,g-e,c.startAngle+c.arc,-c.arc,h*this._donutRate,i*this._donutRate,!0),a.closePath(),a.fill();var o=this._getValueTextInfo(b,c.value);if(o){var j=c.startAngle+c.arc/2,p=this._donutRate+(1-this._donutRate)*this._valuePosition;o.x=f+d+Math.cos(j)*h*p,o.y=g-e-Math.sin(j)*i*p}},this)}else if(this._type==="line"){var j=d.height*this._lineRate;d.y=d.y+d.height/2-j/2,d.height=j;var k=d.x;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],e=d.width*c.proportion;if(e===0)return;a.beginPath(),a.fillStyle=c.color;var f=this.isSelected(b)?-this._selectOffset:0;a.rect(k,d.y+f,e,d.height),a.closePath(),a.fill();var g=this._getValueTextInfo(b,c.value);g&&(g.x=k+e/2,g.y=d.y+d.height+f-d.height*this._valuePosition),k+=e},this)}this._shadowOffset>0&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0),this.drawValueTexts(a)}}),c.charts.BarChart=function(a){c.charts.BarChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.BarChart",c.charts.ScaleChart,{__accessor:["type"],_upperLimit:Se.BARCHART_UPPER_LIMIT,_lowerLimit:Se.BARCHART_LOWER_LIMIT,_type:Se.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:Se.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Se.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:Se.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Se.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Se.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Se.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:Se.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Se.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Se.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:Se.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Se.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:Se.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Se.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Se.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:Se.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Se.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Se.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:Se.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Se.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var a=this._type+"ValidateModel";this[a]&&(this._reset(),this[a]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._upperLimit==null&&b>this._max&&(this._max=b),this._lowerLimit==null&&b<this._min&&(this._min=b),this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)}},this),this._initRange(),this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.proportion=this._range==0?0:b.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel
()},stackValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new Ce(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new Ce,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this);if(this._upperLimit==null||this._lowerLimit==null)for(var a=0;a<this._columnCount;a++){var b=0,c=0;this._publishedDatas.forEach(function(d){var e=this._map[d.getId()];if(e.values.size()>a){var f=e.values.get(a);f!=null&&(f>=0?b+=f:c+=f)}},this),this._upperLimit==null&&b>this._max&&(this._max=b),this._lowerLimit==null&&c<this._min&&(this._min=c)}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new Ce(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new Ce,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this);var a=new Ce;for(var b=0;b<this._columnCount;b++){var c=0;this._publishedDatas.forEach(function(a){var d=this._map[a.getId()];if(d.values.size()>b){var e=d.values.get(b);e!=null&&(c+=e)}},this),a.add(c)}for(var b=0;b<this._columnCount;b++)this._publishedDatas.forEach(function(c){var d=this._map[c.getId()],e=a.get(b);if(e!==0&&d.values.size()>b){var f=d.values.get(b);if(f!=null){d.proportions.add(f/e);return}}d.proportions.add(null)},this);this._min=0,this._max=1,this._range=1},drawRect:function(a,b,c,d,e,f,g){a.fillStyle=b,c&&this._selectInfos.add({x:d,y:e,w:f,h:g,color:this.getUniqueColor(t.darker(b))}),a.beginPath(),a.rect(d,e,f,g),a.closePath(),a.fill()},drawContent:function(a,b,c,d){this._selectInfos=new Ce,this._toolTipInfos=this.isToolTipEnabled()?new Ce:null,this._type==="default"?this.drawDefaultContent(a,b,c,d):this._type==="group"?this.drawGroupContent(a,b,c,d):this._type==="percent"?this.drawPercentContent(a,b,c,d):this._type==="stack"?this.drawStackContent(a,b,c,d):this._type==="layer"&&this.drawLayerContent(a,b,c,d),this.drawValueTexts(a),this._selectInfos.forEach(function(b){a.lineWidth=2,a.strokeStyle=b.color,a.beginPath(),a.rect(b.x,b.y,b.w,b.h),a.closePath(),a.stroke()},this),delete this._selectInfos},drawDefaultContent:function(a,b,c,d){var e=this._publishedDatas.size(),f=this._columnWidth;for(var g=0;g<e;g++){var h=this._publishedDatas.get(g),i=this._map[h.getId()],j=b.x+f*(.5+g*1.5),k=Math.abs(c*i.proportion),l=i.proportion>0?d-k:d;this.drawRect(a,i.color,this.isSelected(h),j,l,f,k),this.addToolTipInfo(j,l,f,k,i.value,h);var m=this._getValueTextInfo(h,i.value);if(m){var n=this.getTextSize(m.font,m.text);m.x=j+f/2,m.y=l-n.height/2+1}}},drawPercentContent:function(a,b,c,d){this.drawStackContent(a,b,c,d)},drawStackContent:function(a,b,c,d){var e=this._columnCount,f=this._columnWidth;for(var g=0;g<e;g++){var h=d,i=b.x+f*(.5+g*1.5);this._publishedDatas.forEach(function(b){var d=this._map[b.getId()];if(g<d.proportions.size()){var e=d.proportions.get(g);if(e!=null){var j=c*e;h-=j,this.drawRect(a,d.color,this.isSelected(b),i,h,f,j),this.addToolTipInfo(i,h,f,j,d.values.get(g),b);var k=this._getValueTextInfo(b,d.values.get(g));k&&(k.x=i+f/2,k.y=h+j/2)}}},this)}},drawLayerContent:function(a,b,c,d){var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=g*3/8/e;for(var i=0;i<f;i++){var j=b.x+g*(.5+i*1.5),k=0;this._publishedDatas.forEach(function(b){var f=this._map[b.getId()];if(i<f.proportions.size()){var l=f.proportions.get(i);if(l!=null){var m=c*l,n=d-m,o=j+g/2-g/8-h*(e-k),p=(g/8+h*(e-k))*2;this.drawRect(a,f.color,this.isSelected(b),o,n,p,m),this.addToolTipInfo(o,n,p,m,f.values.get(i),b);var q=this._getValueTextInfo(b,f.values.get(i));if(q){var r=this.getTextSize(q.font,q.text);q.x=o+p/2,q.y=n-r.height/2+1}}}k++},this)}},drawGroupContent:function(a,b,c,d){var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=g/e;for(var i=0;i<f;i++){var j=b.x+g*(.5+i*1.5),k=0;this._publishedDatas.forEach(function(b){var e=this._map[b.getId()];if(i<e.proportions.size()){var f=e.proportions.get(i);if(f!=null){var g=c*f,l=d-g;this.drawRect(a,e.color,this.isSelected(b),j+h*k,l,h,g),this.addToolTipInfo(j+h*k,l,h,g,e.values.get(i),b);var m=this._getValueTextInfo(b,e.values.get(i));if(m){var n=this.getTextSize(m.font,m.text);m.x=j+h*k+h/2,m.y=l-n.height/2+1}}}k++},this)}}}),c.charts.LineChart=function(a){c.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},d.ext("twaver.charts.LineChart",c.charts.ScaleChart,{__accessor:["xScaleLineColor","xScaleLineWidth","interruptable"],_interruptable:Se.LINECHART_INTERRUPTABLE,_upperLimit:Se.LINECHART_UPPER_LIMIT,_lowerLimit:Se.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Se.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Se.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Se.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Se.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Se.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Se.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Se.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Se.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Se.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Se.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Se.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Se.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Se.LINECHART_XSCALE_LINE_WIDTH,_valueSpanCount:Se.LINECHART_VALUESPANCOUNT,_yScaleTextVisible:Se.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Se.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Se.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Se.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Se.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Se.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Se.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Se.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):c.Styles.getStyle("chart.line.width")},getMarkerShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):c.Styles.getStyle("chart.marker.shape")},getMarkerSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):c.Styles.getStyle("chart.marker.size")},_initInfo:function(a,b){b.markerShape=this.getMarkerShape(a),b.markerSize=this.getMarkerSize(a),b.lineWidth=this.getLineWidth(a),this.isSelected(a)&&(b.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var a=this._getPoint.apply(this,arguments),b=this.tryGetDataAt(a);if(!b)return-1;var c=this._map[b.getId()],d=c.points,e=c.markerSize;for(var f=0,g=d.size(),h;f<g;f++){h=d.get(f);if(h&&p.getDistance(a,h)<=e)return f}return-1},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new Ce:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.markerSize>0?new Ce:null;a.strokeStyle=f.color,a.lineWidth=f.lineWidth,a.beginPath();var h=f.proportions,i=null,j=h.size(),k=new Ce;f.points=k;for(var l=0;l<j;l++){var m=h.get(l);if(m!=null){var n={x:b.x+this._columnWidth*(1+l*1.5),y:d-c*m};k.add(n),i==null?a.moveTo(n.x,n.y):a.lineTo(n.x,n.y);var o=f.values.get(l),p=this._getValueTextInfo(e,o);if(p){var q=this.getTextSize(p.font,p.text);p.x=n.x,p.y=n.y-q.height/2+2}g&&g.add({point:n,value:o,data:e,index:l}),i=n}else this._interruptable&&(i=null,k.add(null))}a.stroke();if(g){var r=f.markerSize/2;g.forEach(function(b){a.fillStyle=f.color;var c=b.point.x-r,d=b.point.y-r,e=f.markerSize,g=f.markerSize;t.drawVector(a,f.markerShape,null,c,d,e,g),a.fill(),this.addToolTipInfo(c,d,e,g,b.value,b.data,b.index)},this)}},this),this.drawValueTexts(a)}}),c.charts.BubbleChart=function(a){c.charts.BubbleChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.BubbleChart",c.charts.ScaleChart,{__accessor:["xAxisUpperLimit","xAxisLowerLimit","xScaleLineColor","xScaleLineWidth","selectShadowColor","selectShadowOffset"],_upperLimit:Se.BUBBLECHART_UPPER_LIMIT,_lowerLimit:Se.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:Se.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:Se.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Se.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Se.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Se.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Se.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Se.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Se.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Se.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Se.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Se.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Se.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Se.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Se.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Se.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:Se.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Se.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Se.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Se.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Se.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Se.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Se.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Se.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:Se.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Se.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,this._xAxisUpperLimit!=null&&(this._xMax=this._xAxisUpperLimit),this._xAxisLowerLimit!=null&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(a){return a.getStyle?a.getStyle("chart.bubble.shape"):c.Styles.getStyle("chart.bubble.shape")},getSize:function(a,b){return b},getNames:function(a){return a.getStyle?a.getStyle("chart.names"):c.Styles.getStyle("chart.names")},getXAxisValues:function(a){return a.getStyle?a.getStyle("chart.xaxis.values"):c.Styles.getStyle("chart.xaxis.values")},getYAxisValues:function(a){return a.getStyle?a.getStyle("chart.yaxis.values"):c.Styles.getStyle("chart.yaxis.values")},_initXRange:function(){this._xAxisLowerLimit==null&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-Math.abs(this._xMax)*.1),this._xMin=this._xMin-(this._xMax-this._xMin)*.1),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.xAxisValues.forEach(function(a){a==null?b.xAxisProportions.add(null):b.xAxisProportions.add(this._xRange==0?0:a/this._xRange)},this),b.yAxisValues.forEach(function(a){a==null?b.yAxisProportions.add(null):b.yAxisProportions.add(this._range==0?0:a/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=this._xScaleTexts==null?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(a){var b=new Ce(this.getYAxisValues(a)),c=new Ce(this.getXAxisValues(a)),d=new Ce(this.getValues(a));d.size()>this._columnCount&&(this._columnCount=d.size());var e={data:a,values:d,yAxisValues:b,xAxisValues:c,yAxisProportions:new Ce,xAxisProportions:new Ce,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getShape(a)};this._map[a.getId()]=e,(this._upperLimit==null||this._lowerLimit==null)&&b.forEach(function(a){a!=null&&(this._upperLimit==null&&a>this._max&&(this._max=a),this._lowerLimit==null&&a<this._min&&(this._min=a))},this),(this._upperLimit==null||this._lowerLimit==null)&&c.forEach(function(a){a!=null&&(this._xAxisUpperLimit==null&&a>this._xMax&&(this._xMax=a),this._xAxisLowerLimit==null&&a<this._xMin&&(this._xMin=a))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new Ce:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.yAxisProportions,h=f.xAxisProportions,i=f.values,j=f.yAxisProportions.size(),k=this._selectShadowOffset;this.isSelected(e)&&k>0?(a.shadowOffsetX=k,a.shadowOffsetY=k,a.shadowBlur=k*2,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=f.color),a.fillStyle=f.color;for(var l=0;l<j;l++){var m=g.get(l),n=h.get(l);if(m!=null){var o={x:b.x+b.width*n,y:d-c*m},p=i.get(l),q=this.getSize(e,p),k=q/2,r=o.x-k,s=o.y-k,u=q,v=q;t.drawVector(a,f.anchorShape,null,r,s,u,v),a.fill(),this.addToolTipInfo(r,s,u,v,p,e,l);var w=this._getValueTextInfo(e,p);if(w){var q=this.getTextSize(w.font,w.text);w.x=o.x,w.y=o.y}}}},this),this.drawValueTexts(a)}}),c.charts.DialChart=function(a){c.charts.DialChart.superClass.constructor.apply(this,arguments)},d.ext("twaver.charts.DialChart",c.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","startAngle","endAngle","innerRadius","colorRangeFillColor","outlineWidth","outlineColor","majorScaleCount","majorScaleLineWidth","majorScaleLineLength","majorScaleLineColor","minorScaleCount","minorScaleLineWidth","minorScaleLineLength","minorScaleLineColor","scaleTextVisible","scaleUpperLimitTextVisible","scaleLowerLimitTextVisible","scaleTextFont","scaleTextColor","pivotRadius","pivotFillColor","pivotOutlineWidth","pivotOutlineColor","pivotGradient","pivotGradientColor","valuePosition","colorRangeList","innerDarkerRadius","outerBrighterRadius","selectShadowColor","selectShadowOffset"],__bool:["scaleInside","pivotFill"],_upperLimit:Se.DIALCHART_UPPER_LIMIT,_lowerLimit:Se.DIALCHART_LOWER_LIMIT,_startAngle:Se.DIALCHART_START_ANGLE,_endAngle:Se.DIALCHART_END_ANGLE,_innerRadius:Se.DIALCHART_INNER_RADIUS,_colorRangeFillColor:Se.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:Se.DIALCHART_OUTLINE_WIDTH,_outlineColor:Se.DIALCHART_OUTLINE_COLOR,_scaleInside:Se.DIALCHART_SCALE_INSIDE,_majorScaleCount:Se.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:Se.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:Se.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:Se.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:Se.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:Se.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:Se.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:Se.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:Se.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:Se.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:Se.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:Se.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:Se.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:Se.DIALCHART_PIVOT_RADIUS,_pivotFill:Se.DIALCHART_PIVOT_FILL,_pivotFillColor:Se.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:Se.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:Se.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:Se.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:Se.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:Se.DIALCHART_VALUE_POSITION,_innerDarkerRadius:Se.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:Se.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:Se.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Se.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(a){return a.toFixed(2)},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var a=this._startAngle;a!=0&&(a=(a%360+360)%360,a==0&&(a=360)),this._positiveStartAngle=a;var b=this._endAngle;b!=0&&(b=(b%360+360)%360,b==0&&(b=360)),this._positiveEndAngle=b,this._whole=Math.abs(a-b)==360,this._startAngleByRadian=a*Math.PI/180,this._endAngleByRadian=b*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a),angle:this._startAngleByRadian+(this._clockwise?-1:1)*b/this._valueRange*this._angleRange}},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-this._xGap*2,height:c-this._yGap*2};this.drawBackground(a,d);if(this._startAngleByRadian==this._endAngleByRadian)return;var e,f=this._lowerLimit,g=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,h=0,i=0,j,k=null,l=null;if(this._scaleTextVisible){k=new Ce;for(e=0;e<this._majorScaleCount;e++)e==0&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(j=null,k.add({text:"",size:{width:0,height:0}})):(l=this.formatScaleText(f),j=this.getTextSize(this._scaleTextFont,l),k.add({text:l,size:j})),!this._scaleInside&&j!=null&&(j.width>h&&(h=j.width),j.height>i&&(i=j.height)),f+=g}this._angleRange<=Math.PI&&(h=Math.max(h,this._pivotRadius),i=Math.max(i,this._pivotRadius)),p.grow(d,-h,-i),this._calcluateCenterAndRadius(d),a.lineWidth=0;if(this._colorRangeList==null||this._colorRangeList.size()==0)this._drawArcGroup(a,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(a,this._startAngleByRadian,this._endAngleByRadian,!0,!0);else{var m=this._angleRange/this._colorRangeList.size(),n=this._startAngleByRadian;for(e=0;e<this._colorRangeList.size();e++){var o=this.getUniqueColor(this._colorRangeList.get(e)),q=n+(this._clockwise?-1:1)*m;this._drawArcGroup(a,n,q,o),this._drawArcOutLine(a,n,n+(this._clockwise?-1:1)*m,e==0,e==this._colorRangeList.size()-1),n+=(this._clockwise?-1:1)*m}}var r=this._startAngleByRadian,s=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0,u,v,w,x,y,z,A,B;z=this._scaleInside?this._innerRadiusByPixel:this._outerRadius,A=z+this._majorScaleLineLength*(this._scaleInside?1:-1),B=z+this._minorScaleLineLength*(this._scaleInside?1:-1);for(e=0;e<this._majorScaleCount;e++){v=this._center.x+Math.cos(r)*z,w=this._center.y+Math.sin(-r)*z,x=this._center.x+Math.cos(r)*A,y=this._center.y+Math.sin(-r)*A,a.lineWidth=this._majorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),a.beginPath(),a.moveTo(v,w),a.lineTo(x,y),a.closePath(),a.stroke();if(this._scaleTextVisible&&!(e==0&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible)){var C=k.get(e);if(C){var D=this.getScaleTextPosition(r/Math.PI*180,v,w,C.size.width,C.size.height);C.x=D.x,C.y=D.y}}if(this._whole||!this._whole&&e<this._majorScaleCount-1){var E=r,F=this._minorScaleCount>0?s/(this._minorScaleCount+1):0;for(u=0;u<this._minorScaleCount;u++)E+=(this._clockwise?-1:1)*F,v=this._center.x+Math.cos(E)*z,w=this._center.y+Math.sin(-E)*z,x=this._center.x+Math.cos(E)*B,y=this._center.y+Math.sin(-E)*B,a.lineWidth=this._minorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),a.beginPath(),a.moveTo(v,w),a.lineTo(x,y),a.closePath(),a.stroke()}r+=(this._clockwise?-1:1)*s}this._pivotFill&&t.fill(a,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,this._pivotRadius*2,this._pivotRadius*2),a.lineWidth=this._pivotOutlineWidth,a.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),a.beginPath(),a.arc(this._center.x,this._center.y,this._pivotRadius,0,Math.PI*2,!0),a.closePath(),this._pivotFill&&a.fill(),k&&k.forEach(function(b){b&&t.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=this._getDataStyle("dialchart.rear.extension",b),e=this._getDataStyle("dialchart.base.width",b),f=this._getDataStyle("dialchart.top.width",b),g=this._getDataStyle("dialchart.radius",b);g>=-1&&g<=1&&(g*=this._innerRadiusByPixel),a.fillStyle=c.color,a.lineWidth=0;var h=p.createMatrix(-c.angle,this._center.x,this._center.y),i=h.transform(this._center.x+g,this._center.y+f/2),j=h.transform(this._center.x+g,this._center.y-f/2),k=h.transform(this._center.x-d,this._center.y-e/2),l=h.transform(this._center.x-d,this._center.y+e/2),m=this._selectShadowOffset;this.isSelected(b)&&m>0?(a.shadowOffsetX=m,a.shadowOffsetY=m,a.shadowBlur=m*2,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=c.color),a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(j.x,j.y),a.lineTo(k.x,k.y),a.lineTo(l.x,l.y),a.lineTo(i.x,i.y),a.closePath(),a.fill();var n=this._getValueTextInfo(b,c.value);if(n){var o=h.transform(this._center.x+g*this._valuePosition,this._center.y);n.x=o.x,n.y=o.y}},this),this.drawValueTexts(a)},_getDataStyle:function(a,b){return b.getStyle?b.getStyle(a):b.getClient(a)},_calcluateCenterAndRadius:function(a){var b=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,c=this._clockwise?this._positiveStartAngle:this._positiveEndAngle,d=Math.abs(this._positiveEndAngle-this._positiveStartAngle);0<=b&&b<90?0<=c&&c<=90?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):90<c&&c<=180?(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height+this._outerRadius)/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):90<=b&&b<180?90<=c&&c<=180?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):180<c&&c<=270?(this._outerRadius=Math.min(a.width,a.height/2),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+a.height/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):180<=b&&b<270?180<=c&&c<=270?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height-this._outerRadius)/2}):(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height-this._outerRadius)/2}):(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(a,b,c,d,e){if(this._outlineWidth<=0)return;var f=Math.abs(b-c),g=this._center.x+Math.cos(b)*this._innerRadiusByPixel,h=this._center.y+Math.sin(-b)*this._innerRadiusByPixel,i=this._center.x+Math.cos(b)*this._outerRadius,j=this._center.y+Math.sin(-b)*this._outerRadius,k=this._center.x+Math.cos(c)*this._innerRadiusByPixel,l=this._center.y+Math.sin(-c)*this._innerRadiusByPixel,m=this._center.x+Math.cos(c)*this._outerRadius,n=this._center.y+Math.sin(-c)*this._outerRadius;this._clockwise?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),t.drawArc(a,this._center.x,this._center.y,c,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(g,h),a.stroke(),a.beginPath(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.moveTo(this._center.x,this._center.y),t.drawArc(a,this._center.x,this._center.y,b,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(m,n),a.stroke()):(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),t.drawArc(a,this._center.x,this._center.y,b,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(k,l),a.stroke(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),t.drawArc(a,this._center.x,this._center.y,c,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(i,j),a.stroke())},_drawArcGroup:function(a,b,c,d){this._outerBrighterRadiusByPixel!=0&&this._drawArc(a,b,c,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,t.brighter(d)),this._drawArc(a,b,c,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,d),this._innerDarkerRadiusByPixel!=0&&this._drawArc(a,b,c,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,t.darker(d,20))},_drawArc:function(a,b,c,d,e,f){var g=Math.abs(b-c);a.lineWidth=0,a.fillStyle=f;var h=this._center.x+Math.cos(b)*d,i=this._center.y+Math.sin(-b)*d,j=this._center.x+Math.cos(b)*e,k=this._center.y+Math.sin(-b)*e,l=this._center.x+Math.cos(c)*d,m=this._center.y+Math.sin(-c)*d,n=this._center.x+Math.cos(c)*e,o=this._center.y+Math.sin(-c)*e;a.beginPath(),this._clockwise?(a.moveTo(l,m),t.drawArc(a,this._center.x,this._center.y,c,g,e,e,!0),a.lineTo(h,i),t.drawArc(a,this._center.x,this._center.y,b,-g,d,d,!0),a.closePath()):(a.moveTo(h,i),t.drawArc(a,this._center.x,this._center.y,b,g,e,e,!0),a.lineTo(l,m),t.drawArc(a,this._center.x,this._center.y,c,-g,d,d,!0),a.closePath()),a.fill()},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return a==0&&(f=this._scaleInside?{x:b-d/2,y:c}:{x:b+d/2,y:c}),a==180&&(f=this._scaleInside?{x:b+d/2,y:c}:{x:b-d/2,y:c}),a==90&&(f=this._scaleInside?{x:b,y:c+e/2}:{x:b,y:c-e/2}),a==270&&(f=this._scaleInside?{x:b,y:c-e/2}:{x:b,y:c+e/2}),a>270&&a<360&&(f=this._scaleInside?{x:b-d/2,y:c-e/2}:{x:b+d/2,y:c+e/2}),a>180&&a<270&&(f=this._scaleInside?{x:b+d/2,y:c-e/2}:{x:b-d/2,y:c+e/2}),a>90&&a<180&&(f=this._scaleInside?{x:b+d/2,y:c+e/2}:{x:b-d/2,y:c-e/2}),a>0&&a<90&&(f=this._scaleInside?{x:b-d/2,y:c+e/2}:{x:b+d/2,y:c-e/2}),f}}),c.charts.RadarChart=function(a){c.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},d.ext("twaver.charts.RadarChart",c.charts.ChartBase,{__accessor:["axisTextVisible","axisTextFont","axisTextColor","scaleTextVisible","scaleTextFont","scaleTextColor","axisVisible","axisLineColor","axisLineWidth","axisStartAngle","ringVisible","ringType","ringLineColor","ringLineWidth","scaleCount","scaleMaxValue","scaleMinValue","anchorVisible","areaFillAlpha","areaSelectFillAlpha","axisList"],__bool:["areaFill"],_axisTextVisible:Se.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:Se.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:Se.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:Se.RADARCHART_SCALE_TEXT_VISIBLE,_scaleTextFont:Se.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:Se.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:Se.RADARCHART_AXIS_VISIBLE,_axisLineColor:Se.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:Se.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:Se.RADARCHART_AXIS_START_ANGLE,_ringVisible:Se.RADARCHART_RING_VISIBLE,_ringType:Se.RADARCHART_RING_TYPE,_ringLineColor:Se.RADARCHART_RING_LINE_COLOR,_ringLineWidth:Se.RADARCHART_RING_LINE_WIDTH,_scaleCount:Se.RADARCHART_SCALE_COUNT,_scaleMaxValue:Se.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:Se.RADARCHART_SCALE_MINVALUE,_anchorVisible:Se.RADARCHART_ANCHOR_VISIBLE,_areaFill:Se.RADARCHART_AREA_FILL,_areaFillAlpha:Se.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:Se.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(a,b){return a.toFixed(2)},getAnchorSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):c.Styles.getStyle("chart.marker.size")},getAnchorShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):c.Styles.getStyle("chart.marker.shape")},getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):c.Styles.getStyle("chart.line.width")},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},tryGetDataAt:function(a,b){if(b==null||b<0)b=this._selectTolerance;a.target&&(a=s.getLogicalPoint(this._canvas,arguments[0],1));if(!a)return null;if(!this._areaFill){var c=a.x-b,d=a.y-b,e=b*2+1,f=b*2+1;try{var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data;for(var h=0,i=g.length;h<i;h+=4)if(g[h+3]===255){var j="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",k=this._uniqueColors[j];if(k)return k}}catch(l){}return null}if(!this._center)return null;a={x:a.x-this._xTranslate,y:a.y-this._yTranslate};for(var h=this._publishedDatas.size()-1;h>=0;h--){var k=this._publishedDatas.get(h),m=this._map[k.getId()],n=p.isPointInPolygon(m.points,a);if(n)return k}return null},getDataAt:function(){var a,b;if(arguments.length===2)a=arguments[0],b=arguments[1];else if(arguments[0].target){var c=s.getLogicalPoint(this._canvas,arguments[0],1);if(!c)return;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;if(a<0||b<0||a>this._canvasWidth||b>this._canvasHeight)return null;if(!this._areaFill){try{var d=this._canvas.getContext("2d").getImageData(a,b,1,1).data;if(d[3]===255){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null}for(var h=this._publishedDatas.size()-1;h>=0;h--){var f=this._publishedDatas.get(h),i=this._map[f.getId()],j=p.isPointInPolygon(i.points,{x:a-this._xTranslate,y:b-this._yTranslate});if(j)return f}return null},validateModel:function(){this._map={},this._axisTexts=new Ce,this._axisMaxValues=new Ce,this._axisMinValues=new Ce,this._axisRangeValues=new Ce,this._axisCount=this._axisList==null?0:this._axisList.size();if(this._axisCount==0)return;this._averageAngleByRadian=Math.PI*2/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(a){if(typeof a=="string")this._axisTexts.add(a),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue);else{this._axisTexts.add(a.text);var b=isNaN(a.max)?this._scaleMaxValue:a.max,c=isNaN(a.min)?this._scaleMinValue:a.min;this._axisMaxValues.add(b),this._axisMinValues.add(c),this._axisRangeValues.add(b-c)}},this),this._publishedDatas.forEach(function(a){var b=new Ce(this.getValues(a)),c={data:a,values:b,proportions:new Ce,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getAnchorShape(a),anchorSize:this.getAnchorSize(a),lineWidth:this.getLineWidth(a),points:new Ce};this.isSelected(a)&&(c.lineWidth+=2),this._map[a.getId()]=c},this);for(var a=0;a<this._axisCount;a++)this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=0;if(c.values.size()>a){var e=c.values.get(a),f=this._axisMinValues.get(a),g=this._axisRangeValues.get(a);g>0&&(d=(e-f)/g)}c.proportions.add(d)},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-this._xGap*2,height:c-this._yGap*2};this.drawBackground(a,d);if(d.width<=0||d.height<=0||this._axisCount<3)return;var e=0,f=0,g=0,h=null,i=null,j=null,k=null;if(this._axisTextVisible){k=new Ce;for(g=0;g<this._axisCount;g++)j=this._axisTexts.get(g),h=this.getTextSize(this._axisTextFont,j),k.add({text:j,size:h}),h.width>e&&(e=h.width),h.height>f&&(f=h.height)}var l=d.width/2-e>d.height/2-f?d.height/2-f*2:d.width/2-e,m={x:d.x+d.width/2,y:d.y+d.height/2};this._center={x:m.x+this._xTranslate,y:m.y+this._yTranslate};var n=null;this._scaleTextVisible&&(n=new Ce);var o=this._axisStartAngle/180*Math.PI;for(g=0;g<this._axisCount;g++){var p=o*180/Math.PI,q=m.x+Math.cos(o)*l,r=m.y+Math.sin(-o)*l,s=null;n&&(s=new Ce,n.add(s)),this._ringVisible&&this._ringLineWidth>0&&(a.lineWidth=this._ringLineWidth,a.strokeStyle=this._ringLineColor);for(var u=1;u<=this._scaleCount;u++){var v=u/this._scaleCount,w=l*v,x=m.x+Math.cos(o)*w,y=m.y+Math.sin(-o)*w;if(this._ringVisible&&this._ringLineWidth>0){var z=m.x+Math.cos(o+this._averageAngleByRadian)*w,A=m.y+Math.sin(-o-this._averageAngleByRadian)*w;this._ringType=="line"?this.drawLine(a,this._ringLineColor,this._ringLineWidth,x,y,z,A):this._ringType=="arc"&&(a.beginPath(),a.moveTo(m.x,m.y),t.drawArc(a,m.x,m.y,o,this._averageAngleByRadian,w,w,!0),a.closePath(),a.stroke())}s&&(j=this.formatScaleText(this._axisMinValues.get(g)+this._axisRangeValues.get(g)*v,g),h=this.getTextSize(this._scaleTextFont,j),i=this.getScaleTextPosition(p,x,y,h.width,h.height),s.add({text:j,x:i.x,y:i.y}))}this._axisVisible&&this.drawLine(a,this._axisLineColor,this._axisLineWidth,m.x,m.y,q,r);if(k){var B=k.get(g);i=this.getAxisTextPosition(p,q,r,B.size.width,B.size.height),B.x=i.x,B.y=i.y}o+=this._averageAngleByRadian}this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.points.clear();var d=c.anchorSize>0?new Ce:null,e=c.proportions;a.lineWidth=0,a.globalAlpha=this.isSelected(b)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(a.fillStyle=c.color),this._drawItem(a,e,m,l,d,c),this._areaFill&&a.fill(),a.lineWidth=c.lineWidth
,a.strokeStyle=c.color,a.globalAlpha=1,this._drawItem(a,e,m,l),a.lineWidth=0;if(d!=null&&d.size()>0){var f=c.anchorSize/2;d.forEach(function(b){a.fillStyle=c.color,t.drawVector(a,c.anchorShape,null,b.x-f,b.y-f,c.anchorSize,c.anchorSize),a.fill()})}},this),n&&n.forEach(function(b){b.forEach(function(b){t.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this)},this),k&&k.forEach(function(b){t.drawText(a,b.text,b,this._axisTextFont,this._axisTextColor)},this)},_drawItem:function(a,b,c,d,e,f){var g=this._axisStartAngle/180*Math.PI,h=null;a.beginPath();for(var i=0;i<this._axisCount;i++){var j=b.get(i),k={x:c.x+Math.cos(g)*d*j,y:c.y+Math.sin(-g)*d*j};h==null?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),e!=null&&this._anchorVisible&&e.add(k),f&&f.points.add(k),i==0&&(h=k),g+=this._averageAngleByRadian}h!=null&&a.lineTo(h.x,h.y),a.closePath(),a.stroke()},getAxisTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return a==0&&(f={x:b+d/2,y:c}),a==180&&(f={x:b-d/2,y:c}),a==90&&(f={x:b,y:c-e/2}),a==270&&(f={x:b,y:c+e/2}),a>270&&a<360&&(f={x:b+d/2,y:c+e/2}),a>180&&a<270&&(f={x:b-d/2,y:c+e/2}),a>90&&a<180&&(f={x:b-d/2,y:c-e/2}),a>0&&a<90&&(f={x:b+d/2,y:c-e/2}),f},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return a==0&&(f={x:b,y:c+e/2}),a==180&&(f={x:b-d/2,y:c+e/2}),a==90&&(f={x:b+d/2,y:c}),a==270&&(f={x:b+d/2,y:c}),a>270&&a<360&&(f={x:b+d/2,y:c-e/2}),a>180&&a<270&&(f={x:b-d/2,y:c-e/2}),a>90&&a<180&&(f={x:b-d/2,y:c+e/2}),a>0&&a<90&&(f={x:b+d/2,y:c+e/2}),f}}),c.charts.LegendPane=function(a){c.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new c.Pool("div"),this._iconPool=new c.Pool("div"),this._textPool=new c.Pool("span"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=a,this._chart.addViewListener(this.handleViewChange,this),this._view=s.createView("hidden"),this._view.style.verticalAlign="middle",this._legendDiv=s.createDiv(),this._legendDiv.style.whiteSpace="nowrap",this._legendDiv.style.verticalAlign="middle",this._legendDiv.style.position="",this._view.appendChild(this._legendDiv),this._hiddenMap={};var b=this;this._chart._internalVisibleFunction=function(a){return!b.isHidden(a)};var d;m.isTouchable&&!m.isMSToucheable?d=c.charts.LegendPaneTouchInteraction:d=c.charts.LegendPaneInteraction,d&&new d(this)},d.ext("twaver.charts.LegendPane",c.controls.ControlBase,{__accessor:["iconWidth","iconHeight","iconRadius","rowHeight","orientation","hiddenColor","selectBackgroundColor","selectForegroundColor"],_iconWidth:Se.LEGENDPANE_ICON_WIDTH,_iconHeight:Se.LEGENDPANE_ICON_HEIGHT,_iconRadius:Se.LEGENDPANE_ICON_RADIUS,_rowHeight:Se.LEGENDPANE_ROW_HEIGHT,_orientation:Se.LEGENDPANE_ORIENTATION,_hiddenColor:Se.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:Se.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:Se.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(a){this.invalidate()},getChart:function(){return this._chart},isHidden:function(a){return this._hiddenMap[a.getId()]!=null},handleViewChange:function(a){a.kind==="validateEnd"&&(this._invalidate=!0,this.validate())},validate:function(){if(!this._invalidate)return;this._invalidate=!1,s.release(this._legendDiv),d.keys(this._hiddenMap).forEach(function(a){this._chart.getDataBox().containsById(a)||delete this._hiddenMap[a]},this);var a=new Ce(this._chart.getUnfilteredDatas());for(var b=0;b<a.size();b++){var c=a.get(b);!this._chart.isVisible(c)&&!this.isHidden(c)&&(a.removeAt(b),b--)}var e=a.size(),f=this._view.style,g=this._orientation==="horizontal";g?(f.textAlign="center",f.height=this._rowHeight+"px"):(f.textAlign="",f.height=this._rowHeight*e+"px"),f.lineHeight=this._rowHeight-2+"px";for(b=0;b<e;b++){var c=a.get(b),h=this._divPool.get();h._data=c,h.style.cursor="pointer",h.style.height=this._rowHeight+"px",g?h.style.display="inline-block":h.style.display="block",this._legendDiv.appendChild(h),this.renderLegend(h,c),this.onLegendRendered(h,c)}this._pools.forEach(function(a){a.clear()})},renderLegend:function(a,b){var c=!this.isHidden(b),d=this._chart.isSelected(b),e=this._iconPool.get(),f=e.style;f.display="inline-block",f.verticalAlign="middle",f.marginLeft="4px",f.width=this.getIconWidth()+"px",f.height=this.getIconHeight()+"px",c?f.backgroundColor=this._chart.getColor(b):f.backgroundColor=this.getHiddenColor(),a.appendChild(e);var g=this._textPool.get();f=g.style,f.paddingLeft="2px",f.paddingRight="4px",f.display="inline-block",f.verticalAlign="middle",c?f.color=d?this._selectForegroundColor:"":f.color=this.getHiddenColor(),g.innerHTML=this._chart.getName(b),a.appendChild(g),c&&d?a.style.backgroundColor=this._selectBackgroundColor:a.style.backgroundColor=""},onLegendRendered:function(a,b){}}),c.charts.ChartPane=function(a,b,d,e){c.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=a,this._legendPane=new c.charts.LegendPane(a),this._titleDiv=s.createDiv(),this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.whiteSpace="nowrap",this._view=s.createView("hidden"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var f=this;this._legendPane.addPropertyChangeListener(function(a){(a.property==="rowHeight"||a.porperty==="orientation")&&f.invalidate()}),arguments.length>1&&this.setTitle(b),arguments.length>2&&this.setLegendOrientation(d),arguments.length>3&&this.setLegendWidth(e)},d.ext("twaver.charts.ChartPane",c.controls.ControlBase,{__accessor:["title","titleHorizontalAlign","titleHeight","legendWidth"],_title:null,_titleHeight:Se.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:Se.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:Se.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:Se.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(a){if(this._legendOrientation===a)return;var b=this._legendOrientation;this._legendOrientation=a,this.firePropertyChange("orientation",b,a),this._adjustLegendOrientation()},_adjustLegendOrientation:function(){this._legendOrientation==="left"||this._legendOrientation==="right"?this._legendPane.setOrientation("vertical"):this._legendPane.setOrientation("horizontal")},onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._legendPane.getRowHeight(),d;this._title&&this._title!==""?(d=this._titleHeight,this._titleDiv.innerHTML=this._title):(d=0,this._titleDiv.innerHTML=""),this._titleDiv.innerHTML=this._title?this._title:"",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+"px";var e=this._titleDiv.style;e.left="0px",e.top="0px",e.width=a+"px",e.height=d+"px";var f,g;this._legendOrientation==="bottom"?(f={x:0,y:d,width:a,height:Math.max(b-d-c,0)},g={x:0,y:Math.max(b-c,0),width:a,height:c}):this._legendOrientation==="right"?(f={x:0,y:d,width:Math.max(a-this._legendWidth,0),height:Math.max(b-d,0)},g={x:Math.max(a-this._legendWidth,0),y:d,width:this._legendWidth,height:Math.max(b-d,0)}):this._legendOrientation==="top"?(f={x:0,y:d+c,width:a,height:Math.max(b-d-c,0)},g={x:0,y:d,width:a,height:c}):this._legendOrientation==="left"&&(f={x:this._legendWidth,y:d,width:Math.max(a-this._legendWidth,0),height:Math.max(b-d,0)},g={x:0,y:d,width:this._legendWidth,height:Math.max(b-d,0)}),f&&this._chart.adjustBounds(f),g&&this._legendPane.adjustBounds(g)}}),c.charts.ChartInteraction=function(a){this.chart=a,this.canvas=a._canvas;var b=this;this.canvas.addEventListener("mousedown",function(a){a.button===0&&b.handleMouseDown(a),a.preventDefault()},!1);var c=m.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(c,function(a){b.handleMouseWheel(a)},!1)},d.ext("twaver.charts.ChartInteraction",Object,{handleMouseDown:function(a){this.chart.isFocusOnClick()&&c.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(a);var b=this.chart.tryGetDataAt(a);a.detail===2&&b==null?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=s.getClientPoint(a),s.handle_mousedown(this,a))},handleMouseMove:function(a){if(this.lastPoint){var b={x:this._startLogical.x+a.clientX-this._startClient.x,y:this._startLogical.y+a.clientY-this._startClient.y};!this.startPan&&p.getDistance(this.lastPoint,b)>3&&(this.startPan=!0,this.lastPoint=b),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.lastPoint.y),this.lastPoint=b)}},handleMouseUp:function(a){if(!this.startPan&&a.detail===1){var b=this.chart.tryGetDataAt(a),c=this.chart.getSelectionModel();b?d.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):d.isCtrlDown(a)||c.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(a){s.preventDefault(a);var b=m.isFirefox?-a.detail:a.wheelDelta;b>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()*1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()*1.1,!1)):b<0&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),c.charts.ChartTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,s.addEventListener("touchstart","handleTouchstart",this.canvas,this)},d.ext("twaver.charts.ChartTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a),this.chart.isFocusOnClick()&&c.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(a),Ad.isMultiTouch(a)&&(this.distance=Ad.getDistance(a),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),s.addEventListener("touchmove","handleTouchmove",this.canvas,this),s.addEventListener("touchend","handleTouchend",this.canvas,this)},handleTouchmove:function(a){s.preventDefault(a);if(!this.endPoint)return;var b=this.chart.getLogicalPoint(a);!this.moved&&p.getDistance(this.endPoint,b)>10&&(this.moved=!0,this.lastPoint=b);if(!this.moved)return;if(Ad.isSingleTouch(a))this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.endPoint.y),this.endPoint=b);else if(this.distance){var c=Ad.getDistance(a)/this.distance,d=this.xZoom*c,e=this.yZoom*c;this.chart.isXZoomEnabled()&&this.chart.setXZoom(d,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(e,!1)}},handleTouchend:function(a){s.preventDefault(a);if(!this.moved){this.endPoint=this.chart.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var c=this.chart.tryGetDataAt(a);if(b&&c==null)this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0));else{var d=this.chart.getSelectionModel();c?d.contains(c)||d.setSelection(c):d.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,s.removeEventListener("touchmove",this.canvas,this),s.removeEventListener("touchend",this.canvas,this)}}),c.charts.ChartMSTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,this._pointerMap={},this._pointerIdArray=[];var b=this;this.canvas.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.canvas.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.canvas.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.canvas.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1);var c=m.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(c,function(a){b.handleMouseWheel(a)},!1)},d.ext("twaver.charts.ChartMSTouchInteraction",Object,{handleTouchstart:function(a){this.chart.isFocusOnClick()&&c.Util.setFocus(this.canvas);var b=this.chart.getLogicalPoint(a);a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&b&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a);var d=this.chart.tryGetDataAt(a);if(this._pointerIdArray.length==1&&b){var e=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,b)<=10;e&&d==null?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0),this._startTouchPoint=null,this._startTouchTime=null,this._startClientPoint=null):(this._startTouchPoint=b,this._startTouchTime=new Date,this._startClientPoint={x:a.clientX,y:a.clientY},s.handle_mousedown(this,a))}else this._pointerIdArray.length==2&&(this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom(),this._distance=this._getDistance())},handleTouchmove:function(a){if(this._pointerIdArray.length==0||!this._pointerMap[a.pointerId]||p.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=3)return;this._pointerMap[a.pointerId]=a;if(this._pointerIdArray.length==2){var b=this._getDistance()/this._distance,c=this.xZoom*b,d=this.yZoom*b;this.chart.isXZoomEnabled()&&this.chart.setXZoom(c,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(d,!1)}},handleTouchend:function(a){var b=this.chart.getLogicalPoint(a);if(this._pointerIdArray.length==1&&b&&!this.moved){var c=this.chart.tryGetDataAt(a),e=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,b)<=10,f=this.chart.getSelectionModel();c&&e?d.isCtrlDown(a)?f.contains(c)?f.removeSelection(c):f.appendSelection(c):f.contains(c)||f.setSelection(c):d.isCtrlDown(a)||f.clearSelection()}this.moved=!1,this._pointerMap={},this._pointerIdArray=[]},handleMouseWheel:function(a){s.preventDefault(a);var b=m.isFirefox?-a.detail:a.wheelDelta;b>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()*1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()*1.1,!1)):b<0&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))},handle_mousemove:function(a){if(this._pointerIdArray.length==1&&this._startTouchPoint&&this._startClientPoint){var b={x:this._startTouchPoint.x+(a.clientX-this._startClientPoint.x)/this.chart.getXZoom(),y:this._startTouchPoint.y+(a.clientY-this._startClientPoint.y)/this.chart.getYZoom()};p.getDistance(this._startTouchPoint,b)>3&&(this.moved=!0,this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this._startTouchPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this._startTouchPoint.y),this._startClientPoint.x=a.clientX,this._startClientPoint.y=a.clientY)}},handle_mouseup:function(a){this.handleTouchend(a)},_getDistance:function(){return p.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),c.charts.LegendPaneInteraction=function(a){this.legendPane=a;var b=this;this.legendPane._legendDiv.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1)},d.ext("twaver.charts.LegendPaneInteraction",Object,{handleMouseDown:function(a){if(a.button!==0)return;var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}),c.charts.LegendPaneTouchInteraction=function(a){this.legendPane=a,s.addEventListener("touchstart","handleTouchstart",this.legendPane._legendDiv,this)},d.ext("twaver.charts.LegendPaneTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a);var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}),c.network.Network=function(a){c.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new Ce,this._view=s.createView("auto"),this._rootDiv=s.createDiv(),this._topDiv=s.createDiv(),this._attachmentDiv=s.createDiv(),this._layersDiv=s.createDiv(),this._bottomDiv=s.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(a?a:new c.ElementBox),m.isMSToucheable?this.setMSTouchInteractions():m.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1);var b=this;this._flowLink=function(){if(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)return;b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new c.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a);var c=b.getElementUI(a);c.drawBody()})},this.setToolTipEnabled(Se.NETWORK_TOOLTIP_ENABLED),this._view.addEventListener("scroll",function(a){jd.twm(b)}),this.addPropertyChangeListener(function(a){a.property==="zoom"&&jd.twm(b)})},d.ext("twaver.network.Network",c.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:Se.NETWORK_SELECT_MODE,_noAgentLinkVisible:Se.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:Se.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Se.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Se.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Se.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:Se.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:Se.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:Se.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:Se.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:Se.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Se.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Se.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Se.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Se.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:Se.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:Se.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Se.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Se.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:Se.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Se.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Se.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Se.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Se.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:Se.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Se.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Se.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Se.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Se.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Se.NETWORK_EDIT_LINE_WIDTH,_resizePointSize:Se.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Se.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Se.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Se.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Se.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Se.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Se.NETWORK_RESIZE_ANIMATE,_rotatePointSize:Se.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Se.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Se.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Se.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Se.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Se.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Se.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Se.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Se.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Se.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Se.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Se.NETWORK_SELECTION_TOLERANCE,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:c.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,getLabel:function(a){return a.getStyle("network.label")||a.getName()},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){this._toolTipEnabled=a;if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){var c=b.getElementAt(a);if(b._preElement===c)return;b._preElement=c;if(c){var d=b.getToolTip(c);Cd.showToolTip({x:a.pageX,y:a.pageY},d);var e=Cd.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(k.documentElement.scrollLeft||k.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(k.documentElement.scrollTop||k.body.scrollTop)+"px")}}else Cd.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Cd.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){jd.twm(this);if(!this.__lics__)return;var a=0,b=null,c=null,d=null,e=this._invalidateElementVisibility;this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(e){e.validate();var f=e.getElement();e.setVisible(this.isVisible(f));if(this._removeElementUIOnInvisible){b=this.getLayerDivByElement(f);if(e.isVisible()){if(e.getView().parentNode!==b){b.appendChild(e.getView()),c=e.getAttachments();for(a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())}}else if(e.getView().parentNode===b){b.removeChild(e.getView()),c=e.getAttachments();for(a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(d.getView())}}else if(!e.getView().parentNode){b=this.getLayerDivByElement(f),b.appendChild(e.getView()),c=e.getAttachments();for(a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())}},null,this));if(this._invalidateElementIndex){this._invalidateElementIndex=!1;var f,g=this;this._box.getLayerBox().forEachByDepthFirst(function(a){var b=g._layerMap[a.getId()],c;g._box.forEachByLayer(function(a){var d=g._elementUIMap[a.getId()];if(d&&d.getView().parentNode===b){c=s.insertAfter(d.getView(),c);var e=d.getAttachments();for(var h=0;h<e.size();h++){var i=e.get(h);i.getView().parentNode===g._attachmentDiv&&(f=s.insertAfter(i.getView(),f))}}},a)})}if(e&&!this._invalidateElementVisibility){var h;for(var i in this._elementUIMap){var j=this._elementUIMap[i];j.isVisible()&&(h=p.unionRect(h,j.getViewRect()))}h?h={x:0,y:0,width:h.x+h.width,height:h.y+h.height}:h={x:0,y:0,width:0,height:0};if(h.x!==this._viewRect.x||h.y!==this._viewRect.y||h.width!==this._viewRect.width||h.height!==this._viewRect.height){var k=this._viewRect;this._viewRect=h,this._rootDiv.style.left="0px",this._rootDiv.style.top="0px",this._rootDiv.style.width=h.width+"px",this._rootDiv.style.height=h.height+"px",this.firePropertyChange("viewRect",k,h)}}},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(wd.getSubNetwork(this._currentSubNetwork),a,b)},sendToTop:function(a){if(!this.isVisible(a))return;var b=a;while(this.isVisible(b.getParent())){b=b.getParent();if(!b)break}b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){s.clear(this._layersDiv),s.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var a=this;this._box.getLayerBox().forEachByDepthFirst(function(b){var c=s.createDiv();s.setVisible(c,b.isVisible()),a._layerMap[b.getId()]=c,a._layersDiv.appendChild(c),a._layerList.add(b)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,d){var e=c.animate.AnimateManager;e.endAnimate();if(b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";e.start(new c.animate.AnimateSubNetwork(this,a,d))}else this._setCurrentSubNetwork(a),d&&d()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility()},isVisible:function(a){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(this._visibleFunction&&!this._visibleFunction(a))return!1;if(!this._box.getLayerBox().getLayerByElement(a).isVisible())return!1;if(wd.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof c.Link){if(!this.isNoAgentLinkVisible()){if(!a.getFromAgent()||!a.getToAgent())return!1;if(!this.isVisible(a.getFromAgent())||!this.isVisible(a.getToAgent()))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else{var b=a.getParent();while(b&&!b.ISubNetwork){if(b instanceof _e)if(!b.isExpanded()||!this.isVisible(b))return!1;b=b.getParent()}}return a.IDummy?!1:!0},isMovable:function(a){return this._box.contains(a)?a instanceof c.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isMovable():!1},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isEditable():!1},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a){return this._linkableFunction==null||this._linkableFunction(a)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new c.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange("elementBox",b,this._box)},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection
().forEach(function(b){this.invalidateElementUI(b,a)},this)},getElementUI:function(a){return a?this._elementUIMap[a.getId()]:null},getLayerDivByElement:function(a){var b=this._box.getLayerBox().getLayerByElement(a);return b?this._layerMap[b.getId()]:null},createElementUI:function(a){var b=this._elementUIMap[a.getId()];b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b));if(b){var c=this.getLayerDivByElement(a);b.getView().parentNode!==c&&(c.appendChild(b.getView()),b.getAttachments().forEach(function(a){a.isShowInAttachmentDiv()&&a.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(a.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(a){if(a instanceof c.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},handleLayerBoxChange:function(a){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){var b=a.source;if(a.property==="visible"){var c=this._layerMap[b.getId()];s.setVisible(c,b.isVisible())}else a.property==="editable"&&this.invalidateSelectedElementUIs(!0);this.invalidateElementVisibility()},handleLayerHierarchyChange:function(a){var b=0,c;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(a){var b=this._layerMap[a.getId()];c=s.insertAfter(b,c),this._layerList.add(a)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this),this.invalidateElementVisibility();var b=this.getSelectionModel().getLastData();b&&(a.kind==="append"||a.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b))},makeVisible:function(a){var b=this.getElementUI(a);if(!b)return;var c=wd.getSubNetwork(a);if(c!==this._currentSubNetwork){var e=this;this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){d.callLater(e.makeVisible,e,[a])});return}var f=a;while((f=f.getParent())&&f!==c)f instanceof _e&&f.setExpanded(!0);var g=b.getUnionBodyBounds();if(!g)return;var h={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};p.intersects(h,g)||this.isVisible(a)&&d.callLater(this.centerByLogicalPoint,this,[g.x+g.width/2,g.y+g.height/2])},handleElementBoxChange:function(a){var b=a.data;if(a.kind==="add")this.createElementUI(b),this.invalidateBundleLink(b);else if(a.kind==="remove"){var c=this.getElementUI(b);if(c){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode===e&&e.removeChild(c.getView()),c.dispose(),delete this._elementUIMap[b.getId()]}b===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null)}else a.kind==="clear"&&(this.forEachElementUI(function(a){a.dispose()}),this._elementUIMap={},this.updateLayers(),this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);if(c){c.handlePropertyChange(a);if(a.property==="layerId"){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode!==e&&(e.appendChild(c.getView()),this.invalidateElementIndex())}}this.invalidateBundleLink(b),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(a){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction===a)return;var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||this.updateLayers()},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},getSelectColor:function(a){return a.getStyle("select.color")},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&a.getStyle("select.style")==="shadow"?a.getStyle("select.color"):b},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(a){var b=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=a,this.firePropertyChange("removeElementUIOnInvisible",b,a),this.invalidateElementVisibility()},setDefaultInteractions:function(a,b){var d=[new c.network.interaction.SelectInteraction(this),new c.network.interaction.MoveInteraction(this,a),new c.network.interaction.DefaultInteraction(this)];b&&d.push(new c.network.interaction.MoveLinkInteraction(this,a)),this.setInteractions(d)},setPanInteractions:function(){this.setInteractions([new c.network.interaction.PanInteraction(this),new c.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(a,b){var d=[new c.network.interaction.SelectInteraction(this),new c.network.interaction.EditInteraction(this,a),new c.network.interaction.MoveInteraction(this,a),new c.network.interaction.DefaultInteraction(this)];b&&d.push(new c.network.interaction.MoveLinkInteraction(this,a)),this.setInteractions(d)},setCreateElementInteractions:function(a){this.setInteractions([new c.network.interaction.CreateElementInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new c.network.interaction.CreateLinkInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new c.network.interaction.CreateShapeLinkInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new c.network.interaction.CreateShapeNodeInteraction(this,a),new c.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new c.network.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new c.network.interaction.MSTouchInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new c.network.interaction.SelectInteraction(this),new c.network.interaction.MoveInteraction(this),new c.network.interaction.DefaultInteraction(this),new c.network.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},moveSelectedElements:function(a,b,d,e){if(a===0&&b===0)return;var f=this.getMovableSelectedElementsRect();if(f==null)return;this._limitElementInPositiveLocation&&(f.x+a<0&&(a=-f.x),f.y+b<0&&(b=-f.y)),c.Util.moveElements(this.getMovableSelectedElements(),a,b,d,e,this)},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},hasMovableSelectedElements:function(){var a=this.getSelectionModel().getSelection();for(var b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(a.size()===0)return null;var b=null;for(var c=0,d=a.size();c<d;c++){var e=a.get(c);if(e instanceof Ze){var f=this.getElementUI(e);f&&(b=p.unionRect(b,f.getViewRect()))}}return b},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getPosition:function(a,b,d,e,f){var g,h=b instanceof c.network.ElementUI?b:this.getElementUI(b);if(h)if(a==="from"||a==="to"){if(h.getFromPosition){g=a==="from"?h.getFromPosition(e,f):h.getToPosition(e,f);if(g)return{x:g.x-d.width/2,y:g.y-d.height/2}}}else a==="hotspot"?g=h.getHotSpot():g=r.get(a,h.getBodyRect(),d);!g&&b.getRect&&(g=r.get(a,b.getRect(),d));if(g)return{x:g.x+e,y:g.y+f};throw"position '"+a+"' object '"+b+"'"},getViewRect:function(){return this._viewRect?d.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(a,b,c){b?this._box.forEachReverse(function(d){if(this.getLayerByElement(d)===b){var e=this.getElementUI(d);e&&(c?a.call(c,e):a(e))}},this):this._layerList.forEachReverse(function(b){this.forEachElementUI(a,b,c)},this)},findFirstElement:function(a,b){var c=this._layerList.size()-1,d=this._box.size()-1;for(var e=c;e>=0;e--){var f=this._layerList.get(e);for(var g=d;g>=0;g--){var h=this._box.getDataAt(g);if(this.getLayerByElement(h)===f)if(b){if(a.call(b,h)===!0)return h}else if(a(h)===!0)return h}}return null},getElementAt:function(a,b){arguments.length===1&&(b=!0);if(!this.isValidEvent(a))return null;a=this._getPoint(a),a||console.log("null");var c=a.x,d=a.y,e=this._selectionTolerance;if(e&&e>0){var f={x:c,y:d,width:0,height:0};p.grow(f,e,e)}return this.findFirstElement(function(a){if(b&&!this.isSelectable(a))return!1;var e=this.getElementUI(a);return e?f?!!e.intersectsTest(f):!!e.hitTest(c,d):!1},this)},_getPoint:function(a){return a?a.target?this.getLogicalPoint(a):a:null},getElementsAtRect:function(a,c,d,e){var f=new Ce;return e=e===b?!0:e,this.forEachElementUI(function(b){b.isVisible()&&(!d||d(b._element))&&(e&&this.isSelectable(b._element)||!e)&&(c?b.intersectsTest(a)&&f.add(b._element):p.contains(a,b.getViewRect())&&f.add(b._element))},null,this),f},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);return c?(a=this._getPoint(a),c.hitTest(a.x,a.y)):null},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Se.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c){c||(c=s.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var d=c.getContext("2d");d.clearRect(0,0,a,b);if(this._view.clientWidth===0||this._view.clientHeight===0)return c;var e=a/this._view.scrollWidth*this._zoom,f=b/this._view.scrollHeight*this._zoom;return d.scale(e,f),s.forEach(this._view,function(a){if((a.tagName==="CANVAS"||a.tagName==="IMG")&&!a._isIgnored){var b=a._viewRect;if(b)try{d.drawImage(a,b.x,b.y,b.width,b.height)}catch(a){}}}),c},toCanvasByRegion:function(a,b,c){c||(c=s.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e);var f=c.getContext("2d");return f.clearRect(0,0,d,e),this._view.clientWidth===0||this._view.clientHeight===0?c:(f.save(),f.scale(b,b),s.forEach(this._view,function(b){if((b.tagName==="CANVAS"||b.tagName==="IMG")&&!b._isIgnored){var c=b._viewRect;if(c&&p.intersects(c,a))try{f.drawImage(b,c.x-a.x,c.y-a.y,c.width,c.height)}catch(b){}}}),f.restore(),c)},getGroupChildrenRects:function(a){var b=new Ce;return a.getChildren().forEach(function(a){if(a instanceof Ze){var c=this.getElementUI(a);if(c){var d=c.getViewRect();d&&b.add(d)}}},this),b},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},onClickElement:function(a,b){},onClickBackground:function(a){},onDoubleClickElement:function(a,b){},onDoubleClickBackground:function(a){},onLongClickElement:function(a,b){},onLongClickBackground:function(a){},onMouseMove:function(a,b){},onMouseEnter:function(a,b){},onMouseLeave:function(a,b){}}),c.network.Overview=function(a){c.network.Overview.superClass.constructor.apply(this,arguments),this._view=s.createView(),this._rootDiv=s.createDiv(),this._imageCanvas=s.createCanvas(),this._imageDiv=s.createDiv(),this._maskCanvas=s.createCanvas(),this._selectDiv=s.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,s.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(a);var b;m.isMSToucheable?b=c.network.OverviewMSTouchInteraction:m.isTouchable?b=c.network.OverviewTouchInteraction:b=c.network.OverviewInteraction,b&&new b(this)},d.ext("twaver.network.Overview",c.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Se.OVERVIEW_FILL_COLOR,_outlineColor:Se.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Se.OVERVIEW_OUTLINE_WIDTH,_selectColor:Se.OVERVIEW_SELECT_COLOR,_selectWidth:Se.OVERVIEW_SELECT_WIDTH,_padding:Se.OVERVIEW_PADDING,_animate:Se.OVERVIEW_ANIMATE,_maxPackingWidth:Se.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Se.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){if(a===this._network)return;this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),s.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),s.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate()},_handleNetworkPropertyChange:function(a){(a.property==="zoom"||a.property==="currentSubNetwork"||a.property==="elementBox"||a.property==="dataBox")&&this.invalidate()},_handleNetworkViewChange:function(a){a.kind==="validateEnd"&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){if(!this._isNetworkDirty||!this._isMaskDirty)this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),d.callLater(this.validate,this,null,a)},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,d.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&this._network._view.clientWidth!==0&&this._network._view.clientHeight!==0){var a=this._maxPackingWidth>0&&this._maxPackingHeight>0,b;a?b={x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:b={x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},p.grow(b,-this._padding,-this._padding);var c=Math.min(b.width/this._network._view.scrollWidth,b.height/this._network._view.scrollHeight);a&&(s.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),b.width=this._imageDiv._viewRect.width,b.height=this._imageDiv._viewRect.height);var d=this._network._view.scrollWidth*c,e=this._network._view.scrollHeight*c,f=b.x+(b.width-d)/2,g=b.y+(b.height-e)/2;if(this._isNetworkDirty){var h={x:f,y:g,width:d,height:e};this._network.toCanvas(h.width,h.height,this._imageCanvas),s.setDiv(this._imageDiv,h,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var i={x:this._network._view.scrollLeft*c,y:this._network._view.scrollTop*c,width:d*this._network._view.clientWidth/this._network._view.scrollWidth,height:e*this._network._view.clientHeight/this._network._view.scrollHeight},j=s.setCanvas(this._maskCanvas,f,g,d,e);j.lineWidth=0,j.fillStyle=this._fillColor,j.beginPath(),t.drawVector(j,"rectangle",null,f,g,d,e),j.fill(),j.clearRect(f+i.x,g+i.y,i.width,i.height);var k=this._outlineWidth<0?0:this._outlineWidth;j.lineWidth=k,j.strokeStyle=this._outlineColor,j.beginPath(),t.drawVector(j,"rectangle",null,f+i.x+k,g+i.y+k,i.width-k*2,i.height-k*2),k>=0&&j.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return s.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;p.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network._view.scrollWidth/this._network.getZoom(),(a.y-c.y)/c.height*this._network._view.scrollHeight/this._network.getZoom(),b),this._invalidateMask())}}),c.network.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,s.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.network.OverviewTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Ad.isMultiTouch(a)&&(this.distance=Ad.getDistance(a),this.zoom=this.network.getZoom()),s.addEventListener("touchmove","handleTouchmove",this.view,this),s.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){s.preventDefault(a),this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a);if(Ad.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=Ad.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?d.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,s.removeEventListener("touchmove",this.view,this),s.removeEventListener("touchend",this.view,this)),this.moved=!1}}),c.network.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,s.addEventListener("mousedown","handleMousedown",this.view,this)},d.ext("twaver.network.OverviewInteraction",Object,{handleMousedown:function(a){if(a.button!==0)return;this.clear(),this.endPoint=this.overview.getLogicalPoint(a),d.isCtrlDown(a)&&(this.startPoint=this.endPoint,s.setVisible(this.overview._selectDiv,!0)),s.addEventListener("mousemove","handleMousemove",this.view,this),s.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(a){this.endPoint=this.overview.getLogicalPoint(a);if("detail"in a&&a.detail===2)d.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(s.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,e=this.overview._selectDiv._viewRect.y,f=b.width/this.overview._selectDiv._viewRect.width,g=b.height/this.overview._selectDiv._viewRect.height,h=Math.min(f,g),i=this.network._view.scrollWidth/this.network.getZoom()*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),j=this.network._view.scrollHeight/this.network.getZoom()*((e-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);this.network.setZoom(h*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),d.callLater(this.network.centerByLogicalPoint,this.network,[i,j,this.overview._animate]),s.setVisible(this.overview._selectDiv,!1),s.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);this.endPoint=b;if(s.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),s.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,s.removeEventListener("mousemove",this.view,this),s.removeEventListener("mouseup",this.view,this))}}),c.network.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[];var b=this;this.view.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.view.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.view.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.view.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1)},d.ext("twaver.network.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),this._pointerIdArray.length==1?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(this._pointerIdArray.length==0||!this._pointerMap[a.pointerId]||p.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)return;this._pointerMap[a.pointerId]=a;if(this._pointerIdArray.length==2){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(this._pointerIdArray.length==1&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(c==null)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(this._pointerIdArray.length==1&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&p.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?d.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return p.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),c.network.ElementUI=function(a,b){this._view=s.createDiv(),this._bodyView=s.createDiv(),this._view.appendChild(this._bodyView),this._network=a,this._element=b,this._attachments=new Ce,this._bodyBounds=new Ce,this.invalidate(!0)},d.ext("twaver.network.ElementUI",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:Se.FONT},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?d.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},getUnionBodyBounds:function(){return d.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),d.clone(this._bodyRect)},invalidate:function(a){a===b&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag)return;this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility()},updateMeasure:function(){},validate:function(){if(!this._invalidateFlag)return;this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),s.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this.updateMeasure();var a=this._element.getStyle("whole.alpha");this._view.style.opacity=a,this._attachments.forEach(function(b){b.updateMeasure();var c=b.getAlpha();b.isShowInAttachmentDiv()?b._view.style.opacity=c*a:b._view.style.opacity=c});var b;this._bodyBounds.forEach(function(a){b=p.unionRect(b,a)}),this._unionBodyBounds=d.clone(b),this._attachments.forEach(function(a){b=p.unionRect(b,a.getViewRect())}),this._viewRect=b},cleanUp:function(a){var b=a.length;for(var c=0;c<b;c++){var d=a[c],e=this[d];e&&!e.parentNode&&(this[d]=null)}},setVisible:function(a){if(this.isVisible()===a)return;s.setVisible(this._view,a),this._attachments.forEach(function(b){b.isShowInAttachmentDiv()&&s.setVisible(b._view,a)}),this.invalidate(!0)},isVisible:function(){return s.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);a!=null&&a!==""?this._labelAttachment||(this._labelAttachment=new c.network.LabelAttachment(this,Se.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);a!=null&&a!==""?this._alarmAttachment||(this._alarmAttachment=new c.network.AlarmAttachment(this,Se.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new c.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new c.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return!0},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(a){a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose()}),this._attachments.clear()},addAttachment:function(a){this._attachments.add(a),a.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(a.getView()):this._view.appendChild(a.getView()),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose(),this.invalidate(!1)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},addComponent:function(a){this._bodyView.appendChild(a)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return d.clone(this._viewRect)},setShadow:function(a,b,c){var d=a.isShadowable()&&this._shadowColor&&!this._editAttachment;d&&(this._shadowXOffset>0?c.width+=this._shadowXOffset:(c.x+=this._shadowXOffset,c.width+=-this._shadowXOffset),this._shadowYOffset>0?c.height+=this._shadowYOffset:(c.y+=this._shadowYOffset,c.height+=-this._shadowYOffset),p.grow(c,this._shadowBlur,this._shadowBlur));var e=s.setCanvas(b,c);return d&&(e.shadowOffsetX=this._shadowXOffset,e.shadowOffsetY=this._shadowYOffset,e.shadowBlur=this._shadowBlur,e.shadowColor=this._shadowColor),e},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},hit:function(a,b){return!1},hitCanvas:function(a,b,c){var d=c.length;for(var e=0;e<d;e++){var f=c[e],g=this[f];if(t.hit(g,a,b,this._network.getSelectionTolerance()))return!0}return!1},hitComponent:function(a,b,c){var d=c.length;for(var e=0;e<d;e++){var f=c[e],g=this[f];if(g&&p.containsPoint(g._viewRect,a,b))return!0}return!1},hitTest:function(a,b){if(!this.isVisible()||!p.containsPoint(this._viewRect,a,b))return null;var c,d=this._attachments.size(),e;for(c=d-1;c>=0;c--){e=this._attachments.get(c);if(e.isShowInAttachmentDiv()&&e.hit(a,b))return e}for(c=d-1;c>=0;c--){e=this._attachments.get(c);if(!e.isShowInAttachmentDiv()&&e.hit(a,b))return e}return p.containsPoint(this._unionBodyBounds,a,b)&&this.hit(a,b)?this:null},intersects:function(a){return!1},intersectsComponent:function(a,b){var c=b.length;for(var d=0;d<c;d++){var e=b[d],f=this[e];if(f&&p.intersects(f._viewRect,a))return!0}return!1},intersectsCanvas:function(a,b){var c=b.length;for(var d=0;d<c;d++){var e=b[d],f=this[e];if(t.intersects(f,a))return!0}return!1},intersectsTest:function(a){if(!this.isVisible()||!p.intersects(this._viewRect,a))return null;var b=this._attachments.size(),c,d;for(c=b-1;c>=0;c--){d=this._attachments.get(c);if(d.isShowInAttachmentDiv()&&d.intersects(a))return d}for(c=b-1;c>=0;c--){d=this._attachments.get(c);if(!d.isShowInAttachmentDiv()&&d.intersects(a))return d}return p.intersects(this._unionBodyBounds,a)&&this.intersects(a)?this:null}}),c.network.Attachment=function(a,b){this._view=s.createDiv(),this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._isShowInAttachmentDiv=b===!0,this._isShowInAttachmentDiv&&s.setVisible(this._view,a.isVisible())},d.ext("twaver.network.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return d.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(a,b){return p.containsPoint(this._viewRect,a,b)},intersects:function(a){return p.intersects(this._viewRect,a)}}),c.network.BasicAttachment=function(a,b){c.network.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=s.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},d.ext("twaver.network.BasicAttachment",c.network.Attachment,{calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth
(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+c*2,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);var l;if(k==="aboveleft")i.y=j.y-d-i.height,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if(k==="aboveright")i.y=j.y-d-i.height,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if(k==="belowleft")i.y=j.y+d,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if(k==="belowright")i.y=j.y+d,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if(k==="leftabove")i.y=j.y+c-i.height,i.x=j.x-d-i.width,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if(k==="leftbelow")i.y=j.y-c,i.x=j.x-d-i.width,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if(k==="rightabove")i.y=j.y+c-i.height,i.x=j.x+d,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if(k==="rightbelow")i.y=j.y-c,i.x=j.x+d,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if(k==="above")i.y=j.y-d-i.height,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y-d},{x:j.x+l,y:j.y-d}];else if(k==="below")i.y=j.y+d,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y+d},{x:j.x+l,y:j.y+d}];else if(k==="left")i.y=j.y-i.height/2,i.x=j.x-d-i.width,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+l},{x:j.x-d,y:j.y-l}];else{if(k!=="right")throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+l},{x:j.x+d,y:j.y-l}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var m=this.getPadding();m!=0&&p.grow(i,m,m),m=this.getPaddingLeft(),m!=0&&(i.x-=m,i.width+=m),m=this.getPaddingRight(),m!=0&&(i.width+=m),m=this.getPaddingTop(),m!=0&&(i.y-=m,i.height+=m),m=this.getPaddingBottom(),m!=0&&(i.height+=m),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},updateMeasure:function(){c.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var a=this.isFill(),b=this.getOutlineWidth();this._viewRect=p.getRect(this._pointers),this._viewRect=p.unionRect(this._viewRect,this._roundRect),b>0&&p.grow(this._viewRect,b/2,b/2);var d=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if(b>0||a){d.beginPath(),t.drawRoundRect(d,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(d.moveTo(this._pointers[0].x,this._pointers[0].y),d.lineTo(this._pointers[1].x,this._pointers[1].y),d.lineTo(this._pointers[2].x,this._pointers[2].y)),d.closePath(),b>0&&(d.lineWidth=b,d.strokeStyle=this.getOutlineColor(),d.lineCap=this.getCap(),d.lineJoin=this.getJoin(),d.stroke());if(a){var e=this.getFillColor(),f=this.getGradient();f?t.fill(d,e,f,this.getGradientColor(),this._viewRect):d.fillStyle=e,d.fill()}}return d},getRoundRect:function(){return d.clone(this._roundRect)},getContentRect:function(){return d.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(a){if(this._content===a)return;this._content&&this._view.removeChild(this._content),this._content=a,a&&this._view.appendChild(a)},getContentWidth:function(){return Se.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Se.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Se.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Se.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Se.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Se.ATTACHMENT_POSITION},getXOffset:function(){return Se.ATTACHMENT_XOFFSET},getYOffset:function(){return Se.ATTACHMENT_YOFFSET},getPadding:function(){return Se.ATTACHMENT_PADDING},getPaddingLeft:function(){return Se.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Se.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Se.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Se.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Se.ATTACHMENT_DIRECTION},isFill:function(){return Se.ATTACHMENT_FILL},getFillColor:function(){return Se.ATTACHMENT_FILL_COLOR},getGradient:function(){return Se.ATTACHMENT_GRADIENT},getGradientColor:function(){return Se.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Se.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Se.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Se.ATTACHMENT_CAP},getJoin:function(){return Se.ATTACHMENT_JOIN},isShadowable:function(){return Se.ATTACHMENT_SHADOWABLE},hit:function(a,b){return p.containsPoint(this._viewRect,a,b)?p.containsPoint(this._contentRect,a,b)?!0:t.hit(this._attachmentCanvas,a,b):!1},intersects:function(a){return p.intersects(this._viewRect,a)?p.intersects(this._contentRect,a)?!0:t.intersects(this._attachmentCanvas,a):!1}}),c.network.LabelAttachment=function(a,b){c.network.LabelAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.network.LabelAttachment",c.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("label.font"),b=this.getLabel();this._textSize=t.getTextSize(a,b);var d=c.network.LabelAttachment.superClass.updateMeasure.call(this),e=this._element.getStyle("label.align");t.drawText(d,b,this._contentRect,a,this.getStyle("label.color"),e)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),c.network.AlarmAttachment=function(a,b){c.network.AlarmAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.network.AlarmAttachment",c.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("alarm.font"),b=this._network.getAlarmLabel(this._element);this._textSize=t.getTextSize(a,b),this._fillColor=this._network.getAlarmFillColor(this._element);var d=c.network.AlarmAttachment.superClass.updateMeasure.call(this);t.drawText(d,b,this._contentRect,a,this.getStyle("alarm.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),c.network.LinkHandlerAttachment=function(a,b){c.network.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.network.LinkHandlerAttachment",c.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("link.handler.font"),b=this._network.getLinkHandlerLabel(this._element);this._textSize=t.getTextSize(a,b);var d=c.network.LabelAttachment.superClass.updateMeasure.call(this);t.drawText(d,b,this._contentRect,a,this.getStyle("link.handler.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),c.network.EditAttachment=function(a,b){c.network.EditAttachment.superClass.constructor.call(this,a,b),this._attachmentDiv=s.createDiv(),this._view.appendChild(this._attachmentDiv)},d.ext("twaver.network.EditAttachment",c.network.Attachment,{updateMeasure:function(){c.network.EditAttachment.superClass.updateMeasure.call(this),this._viewRect=null,this._element instanceof Ze&&this._addResizingPoint(this._element),this._network.isRotatable(this._element)&&this._element instanceof Ze&&!(this._element instanceof c.ShapeNode)&&!(this._element instanceof c.Grid)&&!(this._element instanceof c.Group)&&this._addRotatePoint(this._element),this._element instanceof c.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof c.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof c.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addRotatePoint:function(a){var b=this._network.getRotatePointSize();if(b<=0)return;var c=a.getOriginalRect();if(!this._rotateDiv){var d=s.createDiv();this._attachmentDiv.appendChild(d),this._rotateDiv=d}var e=this._network.getRotatePointOutlineWidth(),f=this._network.getRotatePointOutlineColor(),g=this._network.getRotatePointFillColor(),b=this._network.getRotatePointSize(),h=b+e,i=b*2,j={x:c.x+c.width/2-b,y:c.y-this._network.getRotatePointOffset()-i,width:i,height:i},k;a.angle==0?k=j:k=this._getRotateRect(j,a.getAngle(),{x:c.x+c.width/2,y:c.y+c.height/2});var l=p.unionRect(a.getRect(),k);this._viewRect=p.unionRect(l,this._viewRect),s.setDiv(this._rotateDiv,j,g,e,f),this._rotateDiv._viewRect=k,s.setBorderRaidus(this._rotateDiv,i+"px"),this._rotateAttachments(this._rotateDiv,i/2,e)},_addResizingPoint:function(a){var b=this._network.getResizePointSize();if(b<=0)return;var c=a.getOriginalRect(),d=new Ce([{x:c.x,y:c.y},{x:c.x+c.width/2,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x,y:c.y+c.height/2},{x:c.x+c.width,y:c.y+c.height/2},{x:c.x,y:c.y+c.height},{x:c.x+c.width/2,y:c.y+c.height},{x:c.x+c.width,y:c.y+c.height}]);if(!this._resizeDivs){this._resizeDivs=new Array;for(var e=0;e<8;e++){var f=s.createDiv();this._attachmentDiv.appendChild(f),this._resizeDivs[e]=f}}if(this._resizeDivs){this._resizeRects=new Array;for(var e=0;e<8;e++){var g=d.get(e),h={x:g.x-b,y:g.y-b,width:b*2,height:b*2},i;a.getAngle()==0?i=h:i=this._getRotateRect(h,a.getAngle(),{x:c.x+c.width/2,y:c.y+c.height/2}),this._resizeRects[e]=i}}var j=this._network.getResizePointOutlineWidth(),k=this._network.getResizePointOutlineColor(),l=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,j,k,l,!0)},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(g<=0)return;var h=g+c;p.grow(a,h,h),this._viewRect=p.unionRect(a,this._viewRect);var i=g*2,j=new Ce,k,l,m,n;for(k=0,l=b.size();k<l;k++)m=b.get(k),n={x:m.x-g,y:m.y-g,width:i,height:i},j.add(n);var o;if(f)o=this._resizeDivs;else{this._controlDivs||(this._controlDivs=new Array);if(this._controlDivs.length<l)for(k=this._controlDivs.length;k<l;k++){var q=s.createDiv();this._attachmentDiv.appendChild(q),this._controlDivs[k]=q}else if(this._controlDivs.length>l){for(k=l;k<this._controlDivs.length;k++)this._attachmentDiv.removeChild(this._controlDivs[k]);this._controlDivs.splice(l)}o=this._controlDivs}for(k=0,l=j.size();k<l;k++)n=j.get(k),s.setDiv(o[k],n,e,c,d),s.setBorderRaidus(o[k],(f?"0":i)+"px"),this._rotateAttachments(o[k],i/2,c,b.get(k))},_rotateAttachments:function(a,b,c,d){if(this._element instanceof Ze){var e=this._element.getAngle();if(e==0)return;var f=this._element.getOriginalRect(),g=a.style.left.split("px")[0],h=a.style.top.split("px")[0],i=f.x+f.width/2,j=f.y+f.height/2;d||(d={x:parseFloat(g)+b+c,y:parseFloat(h)+b+c});var k=p.createMatrix(e*Math.PI/180,f.x+f.width/2,f.y+f.height/2),l=k.transform(d);a.style.webkitTransform="rotate("+e+"deg)",a.style.mozTransform="rotate("+e+"deg)",a.style.OTransform="rotate("+e+"deg)",a.style.msTransform="rotate("+e+"deg)",a.style.transform="rotate("+e+"deg)",a.style.left=l.x-b-c+"px",a.style.top=l.y-b-c+"px"}},_addShapeLinkPoints:function(a){this._addEditPoints(a._element.getPoints())},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(yd.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var c=new Ce;c.add(b),this._addEditPoints(c)}}},_addEditPoints:function(a){var b=p.getRect(a);if(!b)return;var c=this._network.getEditPointOutlineWidth(),d=this._network.getEditPointOutlineColor(),e=this._network.getEditPointFillColor();this._addPoints(b,a,c,d,e,!1)},hit:function(a,b){if(!p.containsPoint(this._viewRect,a,b))return!1;var c;if(this._resizeDivs)for(c=this._resizeDivs.length-1;c>=0;c--)if(p.containsPoint(this._resizeRects[c],a,b))return!0;if(this._rotateDiv&&p.containsPoint(this._rotateDiv._viewRect,a,b))return!0;if(this._controlDivs)for(c=this._controlDivs.length-1;c>=0;c--)if(p.containsPoint(this._controlDivs[c]._viewRect,a,b))return!0;return!1},intersects:function(a){if(!p.intersects(this._viewRect,a))return!1;var b;if(this._resizeDivs)for(b=this._resizeDivs.length-1;b>=0;b--)if(p.intersects(this._resizeRects[b],a))return!0;if(this._rotateDiv&&p.containsPoint(this._rotateDiv._viewRect,a))return!0;if(this._controlDivs)for(b=this._controlDivs.length-1;b>=0;b--)if(p.intersects(this._controlDivs[b]._viewRect,a))return!0;return p.intersects(this._viewRect,a)?!1:!1},_getRotateRect:function(a,b,d){var e=p.createMatrix(b*Math.PI/180,d.x,d.y),f={x:a.x+a.width/2,y:a.y+a.height/2},g=e.transform(f),h=new c.List([{x:g.x-a.width/2,y:g.y-a.height/2},{x:g.x+a.width/2,y:g.y-a.height/2},{x:g.x+a.width/2,y:g.y+a.height/2},{x:g.x-a.width/2,y:g.y+a.height/2}]);return p.getRect(h)}}),c.network.IconsAttachment=function(a,b){c.network.IconsAttachment.superClass.constructor.call(this,a,b),this._iconsCanvas=null},d.ext("twaver.network.IconsAttachment",c.network.Attachment,{isShadowable:function(){return Se.ATTACHMENT_SHADOWABLE},updateMeasure:function(){c.network.IconsAttachment.superClass.updateMeasure.call(this);var a=this._network.getIconsNames(this._element);if(!a||a.length==0)return;var b=this._network.getIconsColors(this._element),e=this._element.getStyle("icons.orientation"),f=this._element.getStyle("icons.position"),g=this._element.getStyle("icons.xoffset");g=g instanceof Array?g[0]:g;var h=this._element.getStyle("icons.yoffset");h=h instanceof Array?h[0]:h;var i=this._element.getStyle("icons.xgap");i=i instanceof Array?i[0]:i;var j=this._element.getStyle("icons.ygap");j=j instanceof Array?j[0]:j;var k=this._getIconsSize(a,e,i,j);if(!k)return;var l=this._network.getPosition(f,this._ui,k,g,h);this._viewRect={x:l.x,y:l.y,width:k.width,height:k.height},e==="top"?l.y+=k.height:e==="left"&&(l.x+=k.width),this._iconsCanvas||(this._iconsCanvas=s.createCanvas(),this._view.appendChild(this._iconsCanvas));var m=this._ui.setShadow(this,this._iconsCanvas,d.clone(this._viewRect)),n=l.x,o=l.y,p=0;for(var q in a){var r=null,t=null;b&&b.length>p&&(t=b[p++]);var u=d.getImageAsset(a[q]);if(u==null)continue;if(e==="right")r={x:n,y:o,width:u.getWidth(),height:u.getHeight()},n+=r.width+i;else if(e==="left")r={x:n-u.getWidth(),y:o,width:u.getWidth(),height:u.getHeight()},n-=r.width+i;else if(e==="top")r={x:n,y:o-u.getHeight(),width:u.getWidth(),height:u.getHeight()},o-=r.height+j;else{if(e!=="bottom")throw"Can not resolve '"+e+"' orientation";r={x:n,y:o,width:u.getWidth(),height:u.getHeight()},o+=r.height+j}Od(m,u.getImage(t,r.width,r.height),t,r,this._element,this._network)}},_getIconsSize:function(a,b,c,e){var f=0,g=0,h=null,i=null,j=null;for(var k in a){i=d.getImageAsset(a[k]);if(!i)continue;if(b==="right")h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},f+=h.width+c;else if(b==="left")h={x:f-i.getWidth(),y:g,width:i.getWidth(),height:i.getHeight()},f-=h.width+c;else if(b==="top")h={x:f,y:g-i.getHeight(),width:i.getWidth(),height:i.getHeight()},g-=h.height+e;else{if(b!=="bottom")throw"Can not resolve '"+b+"' orientation";h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},g+=h.height+e}j==null?j=d.clone(h):j=p.unionRect(j,h)}return j?{width:Math.abs(j.width),height:Math.abs(j.height)}:null}}),c.network.HTMLBasicAttachment=function(a,b){function e(a,b,d,e,f,g,h){d||(d=this._origin.x),e||(e=this._origin.y),f||(f=this._location.x),g||(g=this._location.y),a=a-d-f,b=b-e-g;var i=c.Util.transformPoint({x:d+f,y:e+g},h?this._radian:-this._radian,a,b).point;return i}c.network.HTMLBasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._triangleDiv=c.Util.createDiv(),this._roundDiv=c.Util.createDiv(),this._contentDiv=c.Util.createDiv(),c.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),c.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var d=this;this.hit=function(a,b){if(this._radian&&this._origin){var f=e.call(d,a,b);a=f.x,b=f.y}return c.Util.containsPoint(this._roundRect,a,b)||c.Util.containsPoint(this._pointerRect,a,b)},this.intersects=function(a){var b={x:a.x,y:a.y},f={x:a.x+a.width,y:a.y},g={x:a.x,y:a.y+a.height},h={x:a.x+a.width,y:a.y+a.height};if(this._radian&&this._origin){if(a.width*a.height>50)return!1;b=e.call(d,b.x,b.y),f=e.call(d,f.x,f.y),g=e.call(d,g.x,g.y),h=e.call(d,h.x,h.y)}return a=c.Util.getRect([b,f,g,h]),c.Util.intersects(this._roundRect,a)||c.Util.intersects(this._pointerRect,a)},this.getContentWidth=function(){return this._contentDiv.scrollWidth||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},this.getContentHeight=function(){return this._contentDiv.scrollHeight||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},this._view.appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},c.Util.ext("twaver.network.HTMLBasicAttachment",c.network.BasicAttachment,{calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=Math.min(this.getCornerRadius(),b/2),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset();this._contentRect.width=a,this._contentRect.height=b,this._contentRect.x=c;var i=this._roundRect;i.width=a+c*2,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);var l;if(k==="aboveleft"){i.y=j.y-d-i.height,i.x=j.x-(i.width-c),this._pointers=[j,{x:j.x,y:j.y-d},{x:j.x-Math.min(e,a),y:j.y-d}];var m=d/2,n=Math.min(e,a)/2,o=this.getFillColor();this._triangleBorderWidthStyle=m+"px "+n+"px "+m+"px "+n+"px",this._triangleBorderColorStyle=o+" "+o+" transparent transparent",this._triangleDivLocation=this._pointers[2]}else if(k==="aboveright"){i.y=j.y-d-i.height,i.x=j.x-c,this._pointers=[j,{x:j.x,y:j.y-d},{x:j.x+Math.min(e,a),y:j.y-d}];var m=d/2,n=Math.min(e,a)/2,o=this.getFillColor();this._triangleBorderWidthStyle=m+"px "+n+"px "+m+"px "+n+"px",this._triangleBorderColorStyle=o+" transparent transparent "+o,this._triangleDivLocation=this._pointers[1]}else if(k==="belowleft"){i.y=j.y+d,i.x=j.x-(i.width-c),this._pointers=[j,{x:j.x,y:j.y+d},{x:j.x-Math.min(e,a),y:j.y+d}];var m=d/2,n=Math.min(e,a)/2,o=this.getFillColor();this._triangleBorderWidthStyle=m+"px "+n+"px "+m+"px "+n+"px",this._triangleBorderColorStyle=" transparent "+o+" "+o+" transparent",this._triangleDivLocation={x:this._pointers[2].x,y:j.y}}else if(k==="belowright"){i.y=j.y+d,i.x=j.x-c,this._pointers=[j,{x:j.x,y:j.y+d},{x:j.x+Math.min(e,a),y:j.y+d}];var m=d/2,n=Math.min(e,a)/2,o=this.getFillColor();this._triangleBorderWidthStyle=m+"px "+n+"px "+m+"px "+n+"px",this._triangleBorderColorStyle="transparent transparent "+o+" "+o,this._triangleDivLocation=this._pointers[0]}else if(k==="above"){i.y=j.y-d-i.height,i.x=j.x-i.width/2,this._pointers=[j,{x:j.x-Math.min(e,a)/2,y:j.y-d},{x:j.x+Math.min(e,a)/2,y:j.y-d}];var m=d,n=Math.min(e,a)/2,o=this.getFillColor();this._triangleBorderWidthStyle=m+"px "+n+"px "+"0px "+n+"px",this._triangleBorderColorStyle=o+" transparent transparent transparent",this._triangleDivLocation=this._pointers[1]}else if(k==="below"){i.y=j.y+d,i.x=j.x-i.width/2,this._pointers=[j,{x:j.x-Math.min(e,a)/2,y:j.y+d},{x:j.x+Math.min(e,a)/2,y:j.y+d}];var m=d,n=Math.min(e,a)/2,o=this.getFillColor();this._triangleBorderWidthStyle="0px "+n+"px "+m+"px "+n+"px",this._triangleBorderColorStyle="transparent transparent "+o+" transparent ",this._triangleDivLocation={x:this._pointers[1].x,y:j.y}}else if(k==="left"){i.y=j.y-i.height/2,i.x=j.x-i.width-d,this._pointers=[j,{x:j.x-d,y:j.y-Math.min(e,b)/2},{x:j.x-d,y:j.y+Math.min(e,b)/2}];var m=Math.min(e,b)/2,n=d,o=this.getFillColor();this._triangleBorderWidthStyle=m+"px 0px "+m+"px "+n+"px",this._triangleBorderColorStyle="transparent transparent  transparent "+o,this._triangleDivLocation=this._pointers[1]}else{if(k!=="right")throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,this._pointers=[j,{x:j.x+d,y:j.y-Math.min(e,b)/2},{x:j.x+d,y:j.y+Math.min(e,b)/2}];var m=Math.min(e,b)/2,n=d,o=this.getFillColor();this._triangleBorderWidthStyle=m+"px "+n+"px "+m+"px "+"0px",this._triangleBorderColorStyle="transparent "+o+" transparent  transparent ",this._triangleDivLocation={x:j.x,y:this._pointers[1].y}}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._location=j},updateMeasure:function(){this.calculateMeasure(),this._ui.isShadowable()&&this.isShadowable()?c.Util.setCSSStyle(this._roundDiv,"text-shadow",this._ui._shadowXOffset+"px "+this._ui._shadowYOffset+"px "+this._ui._shadowBlur+"px "+this._ui._shadowColor):c.Util.removeCSSStyle(this._roundDiv,"text-shadow"),this._pointerRect=c.Util.getRect(this._pointers),this._viewRect=c.Util.unionRect(this._pointerRect,this._roundRect),c.Util.setCSSStyle(this._contentDiv,"left",this._contentRect.x+"px"),c.Util.setCSSStyle(this._contentDiv,"top",this._contentRect.y+"px"),c.Util.setCSSStyle(this._roundDiv,"left",this._roundRect.x+"px"),c.Util.setCSSStyle(this._roundDiv,"top",this._roundRect.y+"px"),c.Util.setCSSStyle(this._roundDiv,"width",this._roundRect.width+"px"),c.Util.setCSSStyle(this._roundDiv,"height",this._roundRect.height+"px"),c.Util.setCSSStyle(this._roundDiv,"background",this.isFill()?this.getFillColor():null),c.Util.setCSSStyle(this._roundDiv,"-webkit-border-radius",this.getCornerRadius()+"px"),c.Util.setCSSStyle(this._roundDiv,"-moz-border-radius",this.getCornerRadius()+"px"),c.Util.setCSSStyle(this._roundDiv,"border-radius",this.getCornerRadius()+"px"),this._pointers?(c.Util.setCSSStyle(this._triangleDiv,"left",this._triangleDivLocation.x+"px"),c.Util.setCSSStyle(this._triangleDiv,"top",this._triangleDivLocation.y+"px"),c.Util.setCSSStyle(this._triangleDiv,"border-width",this._triangleBorderWidthStyle),c.Util.setCSSStyle(this._triangleDiv,"border-color",this._triangleBorderColorStyle),this._view.appendChild(this._triangleDiv)):this._triangleDiv.parentNode==this._view&&this._view.removeChild(this._triangleDiv);if(this._element.getStyle("label.rotatable")&&this.label){var a=this._ui.getFromPoint(),b=this._ui.getToPoint(),d=this._ui.getLinkPoints();d.size()%2==0&&(a=d.get(d.size()/2-1),b=d.get(d.size()/2)),a.x>b.x?this._radian=c.Util.getRadiansBetweenLines(b,a):this._radian=c.Util.getRadiansBetweenLines(a,b),this._origin={x:this._contentRect.width/2,y:0};var e="rotate("+c.Util.toDegrees(this._radian)+"deg)",f=this._origin.x+"px "+this._origin.y+"px";c.Util.isChrome||c.Util.isSafari?(c.Util.setCSSStyle(this._roundDiv,"-webkit-transform",e),c.Util.setCSSStyle(this._roundDiv,"-webkit-transform-origin",f)):c.Util.isIE?(c.Util.setCSSStyle(this._roundDiv,"-ms-transform",e),c.Util.setCSSStyle(this._roundDiv,"-ms-transform-origin",f)):(c.Util.setCSSStyle(this._roundDiv,"transform",e),c.Util.setCSSStyle(this._roundDiv,"transform-origin",f))}else c.Util.removeCSSStyle(this._roundDiv,"-webkit-transform"),c.Util.removeCSSStyle(this._roundDiv,"-webkit-transform-origin"),c.Util.removeCSSStyle(this._roundDiv,"-ms-transform"),c.Util.removeCSSStyle(this._roundDiv,"-ms-transform-origin"),c.Util.removeCSSStyle(this._roundDiv,"transform"),c.Util.removeCSSStyle(this._roundDiv,"transform-origin"),delete this._origin,delete this._radian}}),c.network.HTMLLabelAttachment=function(a,b){c.network.HTMLBasicAttachment.call(this,a,b),this.label=!0},c.Util.ext("twaver.network.HTMLLabelAttachment",c.network.LabelAttachment,{updateMeasure:function(){var a=this.getFont("label.font"),b=this.getLabel();this._contentDiv.innerHTML=b,c.Util.setCSSStyle(this._contentDiv,"font",a),c.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),c.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:c.network.HTMLBasicAttachment.prototype.calculateMeasure}),c.network.HTMLAlarmAttachment=function(a,b){c.network.HTMLBasicAttachment.call(this,a,b),this.alarm=!0},c.Util.ext("twaver.network.HTMLAlarmAttachment",c.network.AlarmAttachment,{updateMeasure:function(){var a=this.getFont("alarm.font");this._contentDiv.innerHTML=this._network.getAlarmLabel(this._element),c.Util.setCSSStyle(this._contentDiv,"font",a),this._fillColor=this._network.getAlarmFillColor(this._element),c.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),c.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:c.network.HTMLBasicAttachment.prototype.calculateMeasure}),c.network.NodeUI=function(a,b){c.network.NodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.NodeUI",c.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(a){c.network.NodeUI.superClass.invalidate.call(this,a);var b=this._element.getAgentLinks();b&&b.forEach(function(a){this._network.invalidateElementUI(a,!1)},this)},updateMeasure:function(){c.network.NodeUI.superClass.updateMeasure.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=p.getHotSpot(b.x,b.y,b.width,b.height,a),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp(["_selectCanvas","_nodeCanvas","_nodeImage","_nodeComponent","_vectorCanvas","_outerCanvas"]);var d=this._element.getParent();d instanceof _e&&this._network.invalidateElementUI(d,!1)},drawBody:function(){var a=this.getStyle("body.type");a==="default"?this.drawDefaultBody():a==="vector"?this.drawVectorBody():a==="default.vector"?(this.drawVectorBody(),this.drawDefaultBody()):a==="vector.default"?(this.drawDefaultBody(),this.drawVectorBody()):this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0})},drawOuterBorder:function(){var a=this._element,b=a.getStyle("outer.width");if(b>0){var c=this.getBodyRect();p.addPadding(c,a,"outer.padding",1),this._outerCanvas||(this._outerCanvas=s.createCanvas());var e=d.clone(c);p.grow(e,b/2,b/2);var f=s.setCanvas(this._outerCanvas,e);f.lineWidth=b,f.lineCap=a.getStyle("outer.cap"),f.lineJoin=a.getStyle("outer.join"),f.strokeStyle=this._outerColor,t.drawVector(f,a.getStyle("outer.shape"),null,c),f.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(e)}},drawSelectBorder:function(){var a=this._element,b=a.getStyle("select.width");if(b>0){var c=this.getBodyRect();p.addPadding(c,a,"select.padding",1),this._selectCanvas||(this._selectCanvas=s.createCanvas());var e=d.clone(c);p.grow(e,b/2,b/2);var f=s.setCanvas(this._selectCanvas,e);f.lineWidth=b,f.lineCap=a.getStyle("select.cap"),f.lineJoin=a.getStyle("select.join"),f.strokeStyle=a.getStyle("select.color"),t.drawVector(f,a.getStyle("select.shape"),null,c),f.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(e)}},drawDefaultBody:function(){var a=this._element,b=d.getImageAsset(a.getImage()),e=this.getBodyRect();if(!b){this.addBodyBounds(e),this._currentImageAsset=null;return}p.addPadding(e,this._element,"image.padding",1);if(b.getImage()){this._nodeCanvas||(this._nodeCanvas=s.createCanvas());var f=d.clone(e),g=this.setShadow(this,this._nodeCanvas,f);a.getAngle()!=0&&(e=a.getOriginalRect(),c.Util.rotateCanvas(g,e,a.getAngle())),Od(g,a.getImage(),this.getInnerColor(),e,a,this._network),e=f,this.addComponent(this._nodeCanvas)}else if(b.getSrc())this._nodeImage||(this._nodeImage=s.createImg()),s.setImg(this._nodeImage,b.getSrc(),e),this.addComponent(this._nodeImage);else{if(!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this._currentImageAsset!==b?this._nodeComponent=b.getFunction()(this,e):this._nodeComponent=b.getFunction()(this,e,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=d.clone(e)}this.addBodyBounds(e),this._currentImageAsset=b},hit:function(a,b){if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(d.math.containsPoint(c,a,b))return!0}return this.hitCanvas(a,b,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.hitComponent(a,b,["_nodeImage","_nodeComponent"])},intersects:function(a){if(this._network._transparentSelectionEnable){var b=this.getBodyRect();if(d.math.intersects(b,a))return!0}return this.intersectsCanvas(a,["_nodeCanvas"
,"_outerCanvas","_vectorCanvas"])?!0:this.intersectsComponent(a,["_nodeImage","_nodeComponent"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=s.createCanvas());var a=t.drawPath(this,this._vectorCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("vector.deep"),d=this._vectorCanvas.getContext("2d"),e=this.getBodyRect(),f=this.getStyle("vector.fill.color");if(b!==0&&f){var g=this._element.getAngle();g!=0&&(e=this._element.getOriginalRect(),c.Util.rotateCanvas(d,e,-g),c.Util.rotateCanvas(d,e,g)),this.getStyle("vector.shape")==="rectangle"&&t.draw3DRect(d,f,b,e)}this.addBodyBounds(a),this.addComponent(this._vectorCanvas)}}),c.network.LinkUI=function(a,b){c.network.LinkUI.superClass.constructor.call(this,a,b),this._linkCanvas=s.createCanvas()},d.ext("twaver.network.LinkUI",c.network.ElementUI,{isEditable:function(){return yd.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},hit:function(a,b){return this.hitCanvas(a,b,["_linkCanvas"])},intersects:function(a){return this.intersectsCanvas(a,["_linkCanvas"])},checkAttachments:function(){c.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);a!=null&&a!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new c.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=p.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,c.network.LinkUI.superClass.invalidate.call(this,a)},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=yd.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=yd.createToPoint(this)),this._toPoint},updateMeasure:function(){c.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=this.getStyle("link.type"),d=new Ce;if(yd.isOrthogonalOrFlexionalLink(this._element))d=yd.orthogonalAndFlexional(this,c);else if(this._element.isLooped()){var e=this._network.getElementUI(this._element.getFromAgent());e!=null&&(this._hotSpot=yd.fillLoopedPoints(this,e.getBodyRect(),d))}else{if(c!=="arc"&&c!=="triangle"&&c!=="parallel")throw"Can not resolve link type '"+c+"'";this._hotSpot=yd.fillBundlePoints(this,c,a,b,d)}if(this._network._linkPathFunction){var f=this._network._linkPathFunction(this,d);f&&(d=f)}return d},drawLinePoints:function(a,b,c,d,e){a.lineWidth=c,a.strokeStyle=d;if(this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new vd(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset");this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),t._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var h=this._element.getStyle("link.flow.color");h=h?h:Se.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=h,t._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),t.drawLinePoints(a,b,e),a.stroke()},drawBody:function(){var a=this.getLinkPoints();if(!a||a.size()<2)return;var b=this._element,c=p.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=f*2}var g=!this._editAttachment&&b.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=h*2}p.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(c=p.unionRect(c,De.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(c=p.unionRect(c,De.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"))));var i=this.setShadow(this,this._linkCanvas,c);i.lineCap=b.getStyle("link.cap"),i.lineJoin=b.getStyle("link.join");var j=b.getStyle("link.pattern");g&&this.drawLinePoints(i,a,e,b.getStyle("select.color"),j),this._outerColor&&this.drawLinePoints(i,a,d+f*2,this._outerColor,j),this.drawLinePoints(i,a,d,this._innerColor||b.getStyle("link.color"),j),this.addBodyBounds(c),this.addComponent(this._linkCanvas),De.drawLinkArrow(this,i,a)},getControlPoint:function(){return yd.getControlPoint(this._element,this)},setControlPoint:function(a){if(!a)return;var b=this.getStyle("link.type");if(!yd.hasControlPoint(b))return;var c=yd.getLinkSourceBounds(this),d=yd.getLinkTargetBounds(this);yd.setParamsByControlPoint(a,c,d,b,this._element)},getLineLength:function(){return this._lineLength}}),c.network.HTMLLinkUI=function(a,b){c.network.HTMLLinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.HTMLLinkUI",c.network.LinkUI,{checkAttachments:function(){c.network.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&a==="none"){c.network.HTMLLinkUI.superClass.checkLabelAttachment.call(this);return}var b=this._network.getLabel(this._element);b!=null&&b!==""?this._labelAttachment||(this._labelAttachment=new c.network.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&a==="none"){c.network.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);return}var b=this._network.getAlarmLabel(this._element);b!=null&&b!==""?this._alarmAttachment||(this._alarmAttachment=new c.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),c.network.GroupUI=function(a,b){c.network.GroupUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.GroupUI",c.network.NodeUI,{isEditable:function(){return!this._element.isExpanded()},drawBody:function(){var a=this.getBodyRect();this._shapeRect?this.drawExpandedGroup():c.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=s.createCanvas());var a=t.drawPath(this,this._nodeCanvas,"group",!1,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");b!==0&&c&&this.getStyle("group.shape")==="rectangle"&&t.draw3DRect(this._nodeCanvas.getContext("2d"),c,b,this._bodyRect),this.addBodyBounds(a),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element;if(a.isExpanded()){var b=this.getChildrenRects();if(!b.isEmpty()){var d=a.getStyle("group.shape"),e=q[d];if(!e)throw"Can not resolve group shape '"+d+"'";this._shapeRect=e(b)}}return this._shapeRect?(p.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):c.network.GroupUI.superClass.createBodyRect.call(this)}}),c.network.GridUI=function(a,b){c.network.GridUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.GridUI",c.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?c.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var a=this.getStyle("grid.fill"),b=this.getStyle("grid.deep"),c=this.getStyle("grid.cell.deep");if(!a&&b===0&&c===0)return;var e=this.getBodyRect(),f=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=s.createCanvas());var g=d.clone(e),h=this.setShadow(this,this._nodeCanvas,g);h.rect(e.x,e.y,e.width,e.height),this.addComponent(this._nodeCanvas),a&&(h.fillStyle=f,h.fill()),b!=0&&t.draw3DRect(h,f,b,e.x,e.y,e.width,e.height);if(c!=0){var i=this.getStyle("grid.row.count"),j=this.getStyle("grid.column.count");for(var k=0;k<i;k++)for(var l=0;l<j;l++){var m=this._element.getCellRect(k,l);m!=null&&t.draw3DRect(h,f,c,m.x,m.y,m.width,m.height)}}this.addBodyBounds(g)}}),c.network.ShapeNodeUI=function(a,b){c.network.ShapeNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.ShapeNodeUI",c.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2){this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0});return}this._nodeCanvas||(this._nodeCanvas=s.createCanvas());var a=t.drawPath(this,this._nodeCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed"));this.addBodyBounds(a),this.addComponent(this._nodeCanvas),De.drawLinkArrow(this,this._nodeCanvas.getContext("2d"),p.getPointObject(this._element._points,this._element._segments))},drawSelectBorder:function(){var a=this._element,b=a.getStyle("select.width");if(b>0){var c=this.getBodyRect();p.addPadding(c,a,"select.padding",1);var e=a.getStyle("vector.outline.width");e>0&&p.grow(c,e/2,e/2),this._selectCanvas||(this._selectCanvas=s.createCanvas());var f=d.clone(c);p.grow(f,b/2,b/2);var g=s.setCanvas(this._selectCanvas,f);g.lineWidth=b,g.lineCap=a.getStyle("select.cap"),g.lineJoin=a.getStyle("select.join"),g.strokeStyle=a.getStyle("select.color"),t.drawVector(g,a.getStyle("select.shape"),null,c),g.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(f)}}}),c.network.ShapeLinkUI=function(a,b){c.network.ShapeLinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.ShapeLinkUI",c.network.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new Ce,e=this.getStyle("shapelink.type");c.add(a),this._element._points!=null&&c.addAll(this._element._points),c.add(b);var f=c.size(),g=Math.floor(f/2);if(f%2===0){var h=c.get(g),i=c.get(g-1);this._hotSpot={x:(h.x+i.x)/2,y:(h.y+i.y)/2}}else this._hotSpot=d.clone(c.get(g));var j,k,l;if(e!=="lineto")if(e==="quadto"){j=new Ce(c.get(0));for(k=1,f=c.size();k<f;k++)k<f-1?j.add(new Ce([c.get(k++),c.get(k)])):j.add(c.get(k));c=j}else if(e==="cubicto"){j=new Ce(c.get(0));for(k=1,f=c.size();k<f;k++)k<f-2?j.add(new Ce([c.get(k++),c.get(k++),c.get(k)])):k<f-1?j.add(new Ce([c.get(k++),c.get(k)])):j.add(c.get(k));c=j}else{if(e!=="orthogonalto")throw"Can not resolve shapelink type '"+e+"'";l=c.get(0),j=new Ce(l);for(k=1,f=c.size();k<f;k++)if(k<f-1){var m=d.clone(c.get(k)),n=m.x,o=m.y,p=n-l.x,q=o-l.y;Math.abs(p)>Math.abs(q)?(m.x=n,m.y=l.y):(m.x=l.x,m.y=o),l=m,j.add(l)}else j.add(c.get(k));c=j}return c}}),c.network.RotatableNodeUI=function(a,b){c.network.RotatableNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.network.RotatableNodeUI",c.network.NodeUI,{isEditable:function(){return!1},drawDefaultBody:function(){var a=this._element,b=d.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b){this.addBodyBounds(c),this._currentImageAsset=null;return}p.addPadding(c,this._element,"image.padding",1);if(b.getImage()){this._nodeCanvas||(this._nodeCanvas=s.createCanvas());var e=d.clone(c),f=this.setShadow(this,this._nodeCanvas,e),g=this._element._getOrignalWidth(),h=this._element._getOrignalHeight(),i=this._element._getRotateRect();f.save(),f.translate(c.x-i.x+g/2,c.y-i.y+h/2),f.rotate(this._element._angle*Math.PI/180);var c={x:-g/2,y:-h/2,width:g,height:h};Od(f,b.getImage(this._innerColor,c.width,c.height),this._innerColor,c,a,this._network),f.restore(),this.addComponent(this._nodeCanvas)}else if(!b.getSrc()&&!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this.addBodyBounds(c),this._currentImageAsset=b}}),c.network.HTMLNodeUI=function(a,b){c.network.HTMLNodeUI.superClass.constructor.call(this,a,b)},c.Util.ext("twaver.network.HTMLNodeUI",c.network.NodeUI,{checkAttachments:function(){c.network.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&a==="none"){c.network.HTMLNodeUI.superClass.checkLabelAttachment.call(this);return}var b=this._network.getLabel(this._element);b!=null&&b!==""?this._labelAttachment||(this._labelAttachment=new c.network.HTMLLabelAttachment(this,Se.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&a==="none"){c.network.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);return}var b=this._network.getAlarmLabel(this._element);b!=null&&b!==""?this._alarmAttachment||(this._alarmAttachment=new c.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),c.network.interaction.BaseInteraction=function(a){this.network=a},d.ext("twaver.network.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];s.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)s.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){if(a.button!==0)return;this._startLogical=this.network.getLogicalPoint(a),this._startClient=s.getClientPoint(a),this._startLogical&&s.handle_mousedown(this,a)},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),c.network.interaction.SelectInteraction=function(a){c.network.interaction.SelectInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.SelectInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(a){this._button=a.button;if(!this.network.isValidEvent(a)||this.network.isMovingElement()||this.network.isEditingElement())return;if(a.shiftKey)return;var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?d.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(d.isCtrlDown(a)||c.clearSelection(),this.end(a),this.network.getLogicalPoint(a)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(a))},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this._button!==0||this.network.isMovingElement()||this.network.isEditingElement()){this.end(a);return}this._handle_mousemove(a),this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=s.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}));var b=p.getRect([this._startLogical,this._endLogical]);s.setDiv(this.mark,b,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())},end:function(a){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}var e=this;setTimeout(function(){e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null)},0),this.network.setSelectingElement(!1)}this._handle_mouseup(a)}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y}}),c.network.interaction.MoveInteraction=function(a,b){this.lazyMode=b,this.xoffset=0,this.yoffset=0,c.network.interaction.MoveInteraction.superClass.constructor.call(this,a),this.currentKeyEvent=null},d.ext("twaver.network.interaction.MoveInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown")},tearDown:function(){this.removeListener("mousedown","keydown"),this.end()},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup")},handle_keyup:function(a){this.currentKeyEvent=null,this.removeListener("keyup")},isParenting:function(){return this._startLogical&&this.currentKeyEvent!=null&&this.currentKeyEvent.keyCode===80},parentProcess:function(a,b){var c=null;this.parent!=null&&(c=this.network.getElementUI(this.parent).getViewRect(),this.parent=null);var e=this;a=this.network.getLogicalPoint(a);if(!b&&this.isParenting()){var f={};f.x=a.x-1,f.y=a.y-1,f.width=2,f.height=2;var g=this.network.getElementsAtRect(f,!0);if(g&&g.size()>0){var h=g.size();for(var i=0;i<h;i++){var j=g.get(i);if(!e.network.getElementBox().getSelectionModel().contains(j)){e.parent=j;break}}}}this.parent!=null&&(c=this.network.getElementUI(this.parent).getViewRect()),c!=null&&!b?(this.parentMark||(this.parentMark=d.html.createDiv(),this.network.getTopDiv().appendChild(this.parentMark)),d.html.setDiv(this.parentMark,c,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor())):this.parentMark&&(this.network.getTopDiv().removeChild(this.parentMark),this.parentMark=null)},handle_mousedown:function(a){if(a.button!==0)return;if(this.network.isSelectingElement()||this.network.isEditingElement())return;var b=this.network.getElementAt(a);if(!this.network.isMovable(b))return;this.end(a),this._handle_mousedown(a)},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()||!this._startLogical){this.end(a);return}this._handle_mousemove(a),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y;if(this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a});else{this.mark=s.createDiv();var b;this.network.getMovableSelectedElements().forEach(function(a){var c=this.getElementUI(a);c&&(b=p.unionRect(b,c.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),s.setDiv(this.mark,b,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else this.network.moveSelectedElements(this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=s.getClientPoint(a),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}));this.parentProcess(a,!1)},end:function(a){if(this._startLogical){if(this.lazyMode){if(this.mark){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.mark&&(b.network.getTopDiv().removeChild(b.mark),b.mark=null,b.network.setMovingElement(!1))};this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){this.parent==null&&(this.parent=this.network.getCurrentSubNetwork());var b=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(b.parent)},this.network)}this.parentProcess(a,!0),this._handle_mouseup(a)}}}),c.network.interaction.DefaultInteraction=function(a){c.network.interaction.DefaultInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.DefaultInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;this.network.isFocusOnClick()&&c.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);a.detail===2?this.handleDoubleClicked(a,b):this.handleClicked(a,b)},handleClicked:function(a,b){Dd.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){Dd.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){Dd.handleKeyDown(this.network,a)},handle_mousemove:function(a){var b=this.network.getElementAt(a),c=this._preElement,d=Ed(c),e=Ed(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this.network),this.network.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this.network),this.network.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this.network),this.network.onMouseMove(b,a),this._preElement=b}}),c.network.interaction.PanInteraction=function(a){c.network.interaction.PanInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.PanInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){this._startLogical=this.network.getLogicalPoint(a),this._startLogical&&(this._handle_mousedown(a),this.network.getView().style.cursor="pointer")},handle_mouseup:function(a){this._clear()},handle_mousemove:function(a){if(!this._startLogical)return;this._handle_mousemove(a);var b=this._startLogical.x-this._endLogical.x,c=this._startLogical.y-this._endLogical.y,d=this.network.panByOffset(b,c);this._startLogical=this._endLogical,this._startClient=s.getClientPoint(a)},_clear:function(a){this._startLogical&&(this._handle_mouseup(a),this.network.getView().style.cursor=this._oldCursor)}}),c.network.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,this.editPointSize=a.getEditPointSize(),this.resizePointSize=a.getResizePointSize(),this.rotatePointSize=a.getRotatePointSize(),c.network.interaction.EditInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.EditInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null),this.rotateScale&&this.network.getTopDiv().contains(this.rotateScale)&&(this.network.getTopDiv().removeChild(this.rotateScale),this.rotateScale=null)},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(a.button!==0)return;if(d.isAltDown(a)&&!this.network.isEditingElement()){var b=this.network.getElementAt(a),e=this.network.getLogicalPoint(a);if(b instanceof c.ShapeNode){var f=this.getPointIndex(b.getPoints(),e,!0);f>0&&(this._handle_mousedown(a),this.pointIndex=f,this.shapeNode=b,b.addPoint(e,f),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:f}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:f}))}if(b instanceof c.ShapeLink){var g=new c.List(b.getPoints()),h=this.network.getElementUI(b);g.add(h.getFromPoint(),0),g.add(h.getToPoint());var f=this.getPointIndex(g,e)-1;f>0&&(this._handle_mousedown(a),this.pointIndex=f,this.shapeLink=b,b.addPoint(e,f),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:f}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:f}))}return}if(!this.network.isEditingElement()||this.isStart||this.isStartRotate)return;this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?d.isAltDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?d.isAltDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a))},handle_mouseup:function(a){if(this.isStart){var b=d.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var e=this,f=new c.animate.AnimateBounds(this.node,this.resizingRect,function(){e.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:e.node,resizeDirection:e.resizeDirection})});c.animate.AnimateManager.start(f)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&b){var g=this.shapeNode.getPoints().get(this.pointIndex);this.horizontal&&(b.y=g.y),this.vertical&&(b.x=g.x),this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&b){var g=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(b.y=g.y),this.vertical&&(b.x=g.x),this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.clear()},handle_mousemove:function(a){if(this.isStartRotate&&this.node){this._handleRotateElement(a,this.node),this.network.isShowRotateScale()&&this.showRotateScale();return}if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(a);return}if(this.shapeLink&&this.pointIndex>=0){this._handleMovingShapeLinkPoint(a);return}if(this.node&&this.resizeDirection){this._handleResizing(a);return}if(this.linkUI){this._handleMovingLinkControlPoint(a);return}return}if(!this.network.isValidEvent(a))return;if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var b=this.network.getElementAt(a),d=this.network.getElementUI(b);if(!d||!d.getEditAttachment()){this.clear();return}var e=this.network.getLogicalPoint(a);if(b instanceof Ze){this.node=b;if(this._isEditingShapeNode(e)||this._isResizingNode(e)){this.network.setEditingElement(!0);return}if(this._isRotatingElement(e)){this.network.setRotatingElement(!0),this.network.setEditingElement(!0);return}}else if(b instanceof c.ShapeLink){this.shapeLink=b;if(this._isEditingShapeLink(e)){this.network.setEditingElement(!0);return}}else if(d instanceof c.network.LinkUI&&yd.isOrthogonalLink(d._element)){this.linkUI=d;var f=this.linkUI.getControlPoint();f&&this._contains(e,f,this.editPointSize)&&(this._setCrossCursor(),this.network.setEditingElement(!0));return}this.clear()},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(b<=0)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle();return this._isRotating(a,"crosshair",c,d)},_isRotating:function(a,b,c,d){var e=this.network.getRotatePointSize(),f={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-e},g=this._rotatePoint(f,d,c),h={x:g.x-e,y:g.y-e,width:e*2,height:e*2};return p.containsPoint(h,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=b.getCenterLocation();return Math.round(Math.atan2(c.x-a.x,a.y-c.y)*180/Math.PI+180)},_handleMovingShapeNodePoint:function(a){this._handle_mousemove(a);if(!this.mouseMoved&&d.isCtrlDown(a)){var b=this._endLogical.x-this._startLogical.x,c=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal,this.mouseMoved=!0}var e=this.shapeNode.getPoints().get(this.pointIndex),f=d.clone(this._endLogical);this.horizontal&&(f.y=e.y),this.vertical&&(f.x=e.x),this.shapeNode.setPoint(this.pointIndex,f),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){this._handle_mousemove(a);if(!this.mouseMoved&&d.isCtrlDown(a)){var b=this._endLogical.x-this._startLogical.x,c=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal,this.mouseMoved=!0}var e=this.shapeLink.getPoints().get(this.pointIndex),f=d.clone(this._endLogical);this.horizontal&&(f.y=e.y),this.vertical&&(f.x=e.x),this.shapeLink.setPoint(this.pointIndex,f),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this._handle_mousemove(a),this.linkUI.setControlPoint(d.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0
};this.resizeDirection==="northwest"&&(this._transformPoint(i,f,b),g.x=this._endLogical.x,g.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y});if(this.resizeDirection==="north"){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),k.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}this.resizeDirection==="northeast"&&(this._transformPoint(h,f,b),j.x=this._endLogical.x,j.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y});if(this.resizeDirection==="west"){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),n.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if(this.resizeDirection==="east"){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),l.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}this.resizeDirection==="southwest"&&(this._transformPoint(j,f,b),h.x=this._endLogical.x,h.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y});if(this.resizeDirection==="south"){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),m.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}this.resizeDirection==="southeast"&&(this._transformPoint(g,f,b),i.x=this._endLogical.x,i.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),this.lazyMode?(this.mark||(this.mark=s.createDiv(),this.mark.style.webkitTransform="rotate("+b+"deg)",this.mark.style.mozTransform="rotate("+b+"deg)",this.mark.style.OTransform="rotate("+b+"deg)",this.mark.style.msTransform="rotate("+b+"deg)",this.mark.style.transform="rotate("+b+"deg)",this.network.getTopDiv().appendChild(this.mark)),s.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){if(this.node instanceof c.ShapeNode){this.shapeNode=this.node;var b=this.shapeNode.getPoints();for(var d=0,e=b.size();d<e;d++){var f=b.get(d);if(this._contains(a,f,this.editPointSize))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){var b=this.shapeLink.getPoints();for(var c=0,d=b.size();c<d;c++){var e=b.get(c);if(this._contains(a,e,this.editPointSize))return this._setCrossCursor(),this.pointIndex=c,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(b<=0)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle(),e={x:c.x,y:c.y},f=this._rotatePoint(e,d,c);return this._isResizing(a,f.x,f.y,"northwest","nwse-resize")?!0:(e={x:c.x+c.width/2,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"north","ns-resize")?!0:(e={x:c.x+c.width,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"northeast","nesw-resize")?!0:(e={x:c.x,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"west","ew-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"east","ew-resize")?!0:(e={x:c.x,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southwest","nesw-resize")?!0:(e={x:c.x+c.width/2,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"south","ns-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=p.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){return this._contains(a,{x:b,y:c},this.resizePointSize)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=a<c?a:c,f=b<d?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:c*2,height:c*2};return p.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;var d=a.get(0),e;for(var f=1;f<a.size();f++){e=a.get(f);if(this.isPointOnLine(b,d,e,6))return f;d=e}return d=a.get(0),c&&this.isPointOnLine(b,d,e,6)?a.size():0},showRotateScale:function(){this.rotateScale||(this.rotateScale=d.html.createCanvas());var a=new c.List,b=this.network.getRotateScaleWidth(),e=this.network.getRotateScaleHeight(),f=this.network.getRotatePointSize(),g=this.node.getAngle(),h=this.node.getOriginalRect(),i={x:h.x+h.width/2,y:h.y-this.network.getRotatePointOffset()-f},j=this._rotatePoint(i,g,h),k,l="13px Arial",m=g+"°",n,o,p,q;this.node.getAngle()>=0&&this.node.getAngle()<=180?(n={x:j.x+f,y:j.y},o={x:n.x+b,y:n.y},p={x:o.x,y:o.y-e},q={x:n.x,y:p.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(n={x:j.x-f,y:j.y},o={x:n.x-b,y:n.y},p={x:o.x,y:o.y-e},q={x:n.x,y:p.y});var r=new c.List([n,o,p,q]),k=d.math.getRect(r),s=d.html.setCanvas(this.rotateScale,k);s.fillStyle=this.network.getRotateScaleFillColor(),s.fillRect(k.x,k.y,k.width,k.height),s.fillStyle=this.network.getRotateScaleFontColor(),s.textBaseline="middle",s.textAlign="center",s.font=l,s.fillText(m,k.x+k.width/2,k.y+k.height/2),this.network.getTopDiv().appendChild(this.rotateScale)},isPointOnLine:function(a,b,c,d){d<0&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return e<=d&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}if(b>=360||b<=-360)b%=360;return b>22.5&&b<=67.5&&(c+=1),b<-22.5&&b>=-67.5&&(c-=1),b>67.5&&b<=112.5&&(c+=2),b<-67.5&&b>=-112.5&&(c-=2),b>112.5&&b<=157.5&&(c+=3),b<-112.5&&b>=-157.5&&(c-=3),b>157.5&&b<=202.5&&(c+=4),b<-157.5&&b>=-202.5&&(c-=4),b>202.5&&b<=247.5&&(c+=5),b<-202.5&&b>=-247.5&&(c-=5),b>247.5&&b<=292.5&&(c+=6),b<-247.5&&b>=-292.5&&(c-=6),b>292.5&&b<=337.5&&(c+=7),b<-292.5&&b>=-337.5&&(c-=7),c>8&&(c-=8),c<=0&&(c+=8),d[c]}}),c.network.interaction.CreateElementInteraction=function(a,b){b||(b=Ze),c.Util.isTypeOf(b,Ze)?this.elementFunction=function(a){var c=new b;return c instanceof Ze&&c.setCenterLocation(a),c}:this.elementFunction=b,c.network.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.CreateElementInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),c.network.interaction.CreateLinkInteraction=function(a,b){b||(b=c.Link),c.Util.isTypeOf(b,c.Link)?this.linkFunction=function(a,d){var e=new b;return e instanceof c.Link&&(e.setFromNode(a),e.setToNode(d)),e}:this.linkFunction=b,c.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.CreateLinkInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){var a=this;setTimeout(function(){a._fromRectangle&&(a.network.getTopDiv().removeChild(a._fromRectangle),a._fromRectangle=null),a._currentRectangle&&(a.network.getTopDiv().removeChild(a._currentRectangle),a._currentRectangle=null),a._line&&(a.network.getTopDiv().removeChild(a._line),a._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.updateMark()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.updateMark()))},getFromNode:function(a){return this.getNode(a)},getToNode:function(a){return this.getNode(a)},getNode:function(a){var b=this.network.getElementAt(a);return b instanceof Ze&&this.network.isLinkable(b)?b:null},updateMark:function(){var a;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(a=this.network.getElementUI(this.currentNode),this._currentRectangle=s.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),s.setDiv(this._currentRectangle,a._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var a=this.fromNode.getCenterLocation(),b=a.x,c=a.y,d=this.currentPoint.x,e=this.currentPoint.y;this._line||(this._line=s.createCanvas(),this.network.getTopDiv().appendChild(this._line));var f=s.setCanvas(this._line,Math.min(b,d),Math.min(c,e),Math.abs(b-d),Math.abs(c-e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),f.moveTo(b,c),f.lineTo(d,e),f.stroke()}else this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}),c.network.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=c.ShapeNode),c.Util.isTypeOf(b,c.ShapeNode)?this.shapeNodeFunction=function(a){var d=new b;return d instanceof c.ShapeNode&&a&&d.setPoints(a),d}:this.shapeNodeFunction=b,c.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.CreateShapeNodeInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.lastPoint=null,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(a.detail===2){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var e=this;setTimeout(function(){e.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Ce);if(this.points.size()>0){var f=this.points.get(this.points.size()-1);if(f.x===b.x&&f.y===b.y)return}this._handle_mousedown(a),this.points.size()>0&&d.isCtrlDown(a)&&(this.horizontal&&(b.y=f.y),this.vertical&&(b.x=f.x),this.horizontal=!1,this.vertical=!1),this.lastPoint=b,this.points.add(b),this.updateMark()}},handle_mousemove:function(a){if(this.points){this.currentPoint=this.network.getLogicalPoint(a);if(d.isCtrlDown(a)){var b=this.currentPoint.x-this.lastPoint.x,c=this.currentPoint.y-this.lastPoint.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal}else this.horizontal=!1,this.vertical=!1;this.horizontal&&(this.currentPoint.y=this.lastPoint.y),this.vertical&&(this.currentPoint.x=this.lastPoint.x),this.updateMark()}},updateMark:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=s.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var b=new Ce(this.points);b.add(this.currentPoint);var c=p.getRect(b),e=this.network.getEditLineWidth();d.math.grow(c,e,e);var f=s.setCanvas(this.mark,c);f.lineWidth=e,f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),t.drawLinePoints(f,b),f.stroke()}}}),c.network.interaction.CreateShapeLinkInteraction=function(a,b){c.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=c.ShapeLink),c.Util.isTypeOf(b,c.ShapeLink)?this.linkFunction=function(a,d,e){var f=new b;return f instanceof c.ShapeLink&&(f.setFromNode(a),f.setToNode(d),e&&f.setPoints(e)),f}:this.linkFunction=b},d.ext("twaver.network.interaction.CreateShapeLinkInteraction",c.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),c.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{this.points||(this.points=new Ce);if(this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b),this.updateMark()}}else this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=s.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()},updateLine:function(){if(this.currentPoint&&this.polyline){var a=new Ce(this.points);a.add(this.fromNode.getCenterLocation(),0),a.add(this.currentPoint);var b=p.getRect(a),c=s.setCanvas(this.polyline,b);c.lineWidth=this.network.getEditLineWidth(),c.strokeStyle=this.network.getEditLineColor(),c.beginPath(),t.drawLinePoints(c,a),c.stroke()}}}),c.network.interaction.CreateOrthogonalLinkInteraction=function(a,b,d,e,f,g){c.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,a,b),this.linkType=d||"orthogonal",this.isByControlPoint=e,this.splitPercent=f,this.isSplitByPercent=g,this.link=new c.Link,this.link.setStyle("link.type",this.linkType),this.link.setStyle("link.split.by.percent",this.isSplitByPercent),yd.isFlexionalTypeLink(this.linkType)||yd.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=c.Styles.getStyle("link.extend")),this.link.setStyle("link.extend",this.splitPercent)):yd.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=c.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?this.link.setStyle("link.split.percent",this.splitPercent):this.link.setStyle("link.split.value",this.splitPercent))},d.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction",c.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),c.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var a=c.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);a.setStyle("link.type",this.linkType),a.setStyle("link.split.by.percent",this.isSplitByPercent);if(this.isByControlPoint){var b=yd.getControlPoint(a);if(b)return a.SetStyle("link.control.point",b),a}else yd.isFlexionalTypeLink(this.linkType)||yd.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=c.Styles.getStyle("link.extend")),a.setStyle("link.extend",this.splitPercent)):yd.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=c.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?a.setStyle("link.split.percent",this.splitPercent):a.setStyle("link.split.value",this.splitPercent));return a},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode)return;var a,b=this.network.getElementUI(this.fromNode);if(!b)return;a=b.getBodyRect();if(a==null)return;var c;if(this.currentNode&&this.currentNode!==this.fromNode){var d=this.network.getElementUI(this.currentNode);if(!d)return;c=d.getBodyRect()}else c={x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1};if(!c)return;var e=yd.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,a,c,this.link);yd.drawCorner(e,this.link);if(e.size()<2)return;this.line||(this.line=s.createCanvas(),this.network.getTopDiv().appendChild(this.line));var f=s.setCanvas(this.line,p.getLineRect(e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),t.drawLinePoints(f,e),f.stroke()}else this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}),c.network.interaction.MagnifyInteraction=function(a,b,d,e,f){c.network.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.zoom=b||2,this.xRadius=d||100,this.yRadius=e||100,this.shape=f||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=s.createCanvas(),this.markCanvas._isIgnored=!0},d.ext("twaver.network.interaction.MagnifyInteraction",c.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove")},tearDown:function(){this.removeListener("mousemove"),this._clear()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;this.lastPoint||this.network.getView().appendChild(this.markCanvas),this.lastPoint=b,this.updateMark()},updateMark:function(){var a=this.network._zoom,b=this.zoom*a,c=this.lastPoint.x*a-this.xRadius,d=this.lastPoint.y*a-this.yRadius,e=this.xRadius*2,f=this.yRadius*2,g={x:this.lastPoint.x-this.xRadius/b,y:this.lastPoint.y-this.yRadius/b,width:e/b,height:f/b},h=this.borderWidth,i=s.createCanvas(),j;i.width=e,i.height=f,this.network.toCanvasByRegion(g,b,i),s.setCanvas(this.markCanvas,c,d,e,f),j=this.markCanvas.getContext("2d"),j.save(),j.beginPath(),t.drawVector(j,this.shape,null,c,d,e,f),j.clip(),j.fillStyle=this.backgroundColor,j.beginPath(),j.rect(c,d,e,f),j.fill(),j.drawImage(i,c,d),j.restore(),j.beginPath(),j.lineWidth=h,t.drawVector(j,this.shape,null,c+h/2,d+h/2,e-h,f-h),j.strokeStyle=this.borderColor,j.stroke()},_clear:function(a){this.lastPoint&&(this.network.getView().removeChild(this.markCanvas),this.lastPoint=null)},getZoom:function(){return this.zoom},setZoom:function(a){this.zoom=a,this.updateMark()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.updateMark()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.updateMark()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.updateMark()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.updateMark()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.updateMark()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.updateMark()}}),c.network.interaction.TouchInteraction=function(a){c.network.interaction.TouchInteraction.superClass.constructor.call(this,a)},d.ext("twaver.network.interaction.TouchInteraction",c.network.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();s.addEventListener("touchstart","handleTouchstart",a,this),s.addEventListener("touchmove","handleTouchmove",a,this),s.addEventListener("touchend","handleTouchend",a,this),s.addEventListener("touchcancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();s.removeEventListener("touchstart",a,this),s.removeEventListener("touchmove",a,this),s.removeEventListener("touchend",a,this),s.removeEventListener("touchcancel",a,this)},handleTouchstart:function(a){s.preventDefault(a);if(a.touches&&a.touches.length==1){var b=this.network.getLogicalPoint(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b;var d=this;c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Dd.handleLongClicked(d.network,a,c)},1e3)}else a.touches&&a.touches.length==2&&(this._distance=Ad.getDistance(a),this._zoom=this.network.getZoom(),this._startTouchPoint={x:a.touches[0].clientX,y:a.touches[0].clientY});this._touchCount=a.touches.length},handleTouchmove:function(a){s.preventDefault(a);if(this._touchCount==2&&a.touches&&a.touches.length==2){this.timer&&clearTimeout(this.timer);if(Math.abs(this._distance-Ad.getDistance(a))>=Se.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var b=Ad.getDistance(a)/this._distance;this.network.setTouchZoom(this._zoom*b,!1)}else{var c=a.touches[0],d=this._startTouchPoint.x-c.clientX,e=this._startTouchPoint.y-c.clientY,f=this.network.panByOffset(d,e);this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}}else if(this._touchCount==1&&a.touches&&a.touches.length==1)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var g=this.network.getLogicalPoint(a),h=this.network.getElementAt(g);if(this.network.isMovingElement()||this._startTouchElement!=null&&this._startTouchElement==h&&this.network.getMovableSelectedElements().contains(h)){var d=g.x-this._startTouchPoint.x,e=g.y-this._startTouchPoint.y;if(Math.abs(d)>=Se.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Se.TOUCH_MOVE_THRESHOLD)this._startTouchPoint=g,this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}),this.timer&&clearTimeout(this.timer))}else{var d=g.x-this._startTouchPoint.x,e=g.y-this._startTouchPoint.y;(Math.abs(d)>=Se.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Se.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer)}}else{this._moveTouchPoint=this.network.getLogicalPoint(a);var d=this._moveTouchPoint.x-this._startTouchPoint.x,e=this._moveTouchPoint.y-this._startTouchPoint.y;if(Math.abs(d)>=Se.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(e)>=Se.TOUCH_RECT_SELECT_THRESHOLD){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=s.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.timer&&clearTimeout(this.timer));var i=p.getRect([this._startTouchPoint,this._moveTouchPoint]);s.setDiv(this.mark,i,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}}},handleTouchend:function(a){s.preventDefault(a);if(this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1),this.timer&&clearTimeout(this.timer)}else if(this._startTouchPoint){this._zoomFlag=!1;var e=new Date,f=this.network.getLogicalPoint(a),g=this.network.getElementAt(this._startTouchPoint);this._startTouchPoint&&f&&e.getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,f)<=20&&(g?this.network.getSelectionModel().contains(g)||this.network.getSelectionModel().setSelection(g):this.network.getSelectionModel().clearSelection(),Dd.handleClicked(this.network,a,g),this.timer&&clearTimeout(this.timer),this._endTouchTime&&e.getTime()-this._endTouchTime.getTime()<=500&&p.getDistance(this._endTouchPoint,f)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Dd.handleDoubleClicked(this.network,a,g),this.timer&&clearTimeout(this.timer)):(this._endTouchTime=e,this._endTouchPoint=f))}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),c.network.interaction.MSTouchInteraction=function(a){c.network.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},d.ext("twaver.network.interaction.MSTouchInteraction",c.network.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();s.addEventListener("MSPointerDown","handleTouchstart",a,this),s.addEventListener("MSPointerMove","handleTouchmove",a,this),s.addEventListener("MSPointerUp","handleTouchend",a,this),s.addEventListener("MSPointerCancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();s.removeEventListener("MSPointerDown",a,this),s.removeEventListener("MSPointerMove",a,this),s.removeEventListener("MSPointerUp",a,this),s.removeEventListener("MSPointerCancel",a,this)},handleTouchstart:function(a){this.network.isFocusOnClick()&&c.Util.setFocus(this.network._view);if(this.network.isSelectingElement()&&a.pointerType==a.MSPOINTER_TYPE_MOUSE)return;var b=this.network.getLogicalPoint(a),e=new Date;a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a);if(this._pointerIdArray.length==1){var f=this.network.getElementAt(b);this._startTouchElement=f,this._startClientPoint={x:a.clientX,y:a.clientY},Dd.handleClicked(this.network,a,f),this._startTouchTime&&this._startTouchPoint&&e.getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,b)<=20?(Dd.handleDoubleClicked(this.network,a,f),this._doubleClick=!0):(s.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=e);var g=this.network.getSelectionModel();f?d.isCtrlDown(a)?g.contains(f)?g.removeSelection(f):g.appendSelection(f):g.contains(f)||g.setSelection(f):d.isCtrlDown(a)||g.clearSelection()}else this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(this._startTouchPoint==null||this._pointerIdArray.length==0||!this._pointerMap[a.pointerId]||p.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)return;this._pointerMap[a.pointerId]=a;if(this._pointerIdArray.length==2){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.network.isSelectingElement()){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1)}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);var e=-1;for(var f=0;f<this._pointerIdArray.length;f++)if(this._pointerIdArray[f]==a.pointerId){e=f;break}e>=0&&this._pointerIdArray.splice(e,1),delete this._pointerMap[a.pointerId]},_getDistance:function(){return p.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){if(this._startTouchPoint&&this._pointerIdArray.length==1){this._moveTouchPoint={x:this._startTouchPoint.x+(a.clientX-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(a.clientY-this._startClientPoint.y)/this.network.getZoom()};if(p.getDistance(this._startTouchPoint,this._moveTouchPoint)<3)return;if(this._startTouchElement==null&&this.network.isRectSelectEnabled()){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=s.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}));var b=p.getRect([this._startTouchPoint,this._moveTouchPoint]);s.setDiv(this.mark,b,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}else{var c=this.network.getElementAt(this._moveTouchPoint),d=this._moveTouchPoint.x-this._startTouchPoint.x,e=this._moveTouchPoint.y-this._startTouchPoint.y;if(this._startTouchElement==null&&!this.network.isRectSelectEnabled())var f=this.network.panByOffset(-d,-e);else if(this.network.isMovingElement()||this._startTouchElement!=null&&c==this._startTouchElement&&this.network.getMovableSelectedElements().contains(c))this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}));this._startClientPoint.x=a.clientX,this._startClientPoint.y=a.clientY}}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}}});var af={_hitCanvas:null,getHitCanvas:function(a,b){this._hitCanvas==null&&(this._hitCanvas=s.createCanvas()),arguments.length==0&&(a=2,b=2),this._hitCanvas.setAttribute("width",""+a-1),this._hitCanvas.setAttribute("height",""+b-1),this._hitCanvas.setAttribute("width",""+a),this._hitCanvas.setAttribute("height",""+b);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,a,b),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(a,c,d){c!=b&&(a.fillStyle=c,a.fill()),d!=b&&(a.strokeStyle=d,a.stroke())},text:function(a,b,c,d,e,f){a.textAlign="center",a.textBaseline="middle"
,e!=null&&(a.fillStyle=e,a.fillText(b,c,d)),f&&(a.strokeStyle=f,a.strokeText(b,c,d))},circle:function(a,b,c,d,e,f){a.arc(b,c,d,0,2*Math.PI,!0),a.closePath(),this.render(a,e,f)},rect:function(a,b,c,d,e,f,g){a.rect(b,c,d,e),a.closePath(),this.render(a,f,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(a,b,c,d,e,f){var g=0;return e<=0?g|=this.OUT_LEFT|this.OUT_RIGHT:a<c?g|=this.OUT_LEFT:a>c+e&&(g|=this.OUT_RIGHT),f<=0?g|=this.OUT_TOP|this.OUT_BOTTOM:b<d?g|=this.OUT_TOP:b>d+f&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(a,b,c,d,e,f,g,h){var i,j;if((j=this.outcode(c,d,e,f,g,h))==0)return!0;while((i=this.outcode(a,b,e,f,g,h))!=0){if((i&j)!=0)return!1;if((i&(this.OUT_LEFT|this.OUT_RIGHT))!=0){var k=e;(i&this.OUT_RIGHT)!=0&&(k+=g),b+=(k-a)*(d-b)/(c-a),a=k}else{var l=f;(i&this.OUT_BOTTOM)!=0&&(l+=h),a+=(l-b)*(c-a)/(d-b),b=l}}return!0}};c.canvas={},c.canvas.interaction={},c.canvas.Network=function(a){c.canvas.Network.superClass.constructor.apply(this,arguments),this._rootCanvas=s.createCanvas(),this._topCanvas=s.createCanvas(),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._visibleMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new c.List,this._topAttachmentList=new c.List,this.setElementBox(a?a:new c.ElementBox),h||(this._view=s.createView("hidden"),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),m.isMSToucheable?this.setMSTouchInteractions():m.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(c.Defaults.NETWORK_TOOLTIP_ENABLED));var b=this;this._flowLink=function(){if(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)return;b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new c.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a);var c=b.getElementUI(a);c.invalidate(!1)})}},d.ext("twaver.canvas.Network",c.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","paddingRight","paddingBottom"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","debug"],_currentSubNetwork:null,_subNetworkAnimate:c.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:c.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:c.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:c.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Se.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:c.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:c.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:c.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:c.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:c.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:c.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:c.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:c.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:c.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:c.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:c.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:c.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:c.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:c.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:c.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:c.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:c.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:c.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:c.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:c.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:c.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:c.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:c.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:c.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:c.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:c.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:c.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:c.Defaults.NETWORK_EDIT_LINE_WIDTH,_rotatePointSize:c.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:c.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:c.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:c.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:c.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Se.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Se.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Se.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Se.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Se.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Se.NETWORK_LINK_FLOW_INTERVAL,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_paddingRight:0,_paddingBottom:0,_transparentSelectionEnable:c.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_debug:!1,adjustBounds:function(a){if(h)this._rootCanvas=new g(a.width,a.height),this._topCanvas=new g(a.width,a.height),this.setViewRect(a.x,a.y,a.width,a.height);else{var b=!1,d=this._view.style;d.left==a.x+"px"&&d.top==a.y+"px"&&d.width==a.width+"px"&&d.height==a.height+"px"&&(b=!0),c.canvas.Network.superClass.adjustBounds.apply(this,arguments);if(b==1)return;var e=this._view.offsetWidth,f=this._view.offsetHeight;this._rootCanvas.setAttribute("width",e),this._rootCanvas.setAttribute("height",f),this._topCanvas.setAttribute("width",e),this._topCanvas.setAttribute("height",f),this.setViewRect(this.viewRect.x,this.viewRect.y,e,f)}typeof c.gis=="undefined"&&(c.Util.makeHighRes(this._rootCanvas),c.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getBackgroundImage:function(){return this._backgroundImage},setBackgroundImage:function(a){if(this._backgroundImage!=a){var b=this._backgroundImage;this._backgroundImage=a;var c=this._backgroundImage;if(c&&!c._viewRect)if(c.width>0)c._viewRect={x:0,y:0,width:c.width,height:c.height},this.validateCanvasSize(),this.firePropertyChange("backgroundImage",b,c);else{var d=this;c.onload=function(){c._viewRect={x:0,y:0,width:c.width,height:c.height},d.validateCanvasSize(),d.firePropertyChange("backgroundImage",b,c),c.onload=null}}else this.firePropertyChange("backgroundImage",b,c),this.validateCanvasSize()}},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){!h&&jd.twm(this);if(this._invalidateElementVisibility==1){this._invalidateElementVisibility=!1;var a=this.getElementBox().getDatas()._as,b=a.length,c={},d,e,f,g=this._visibleFunction,i=this._box._layerBox.size()===1?this._box._layerBox._defaultLayer:null;for(d=0;d<b;d++)e=a[d],c[e._id]=this.isVisible(e,g,i);if(this._visibleMap)for(d=0;d<b;d++)e=a[d],c[e._id]!==this._visibleMap[e._id]&&(f=this._elementUIMap[e._id],f&&f.invalidate());for(d=0;d<b;d++)e=a[d],f=this._elementUIMap[e._id],f&&f.validate();this._visibleMap=c,this.paintRoot()}this.validateCanvasSize(),this._repaintTopFlag==1&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new c.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",b,this._box)},handleElementBoxChange:function(a){var b=a.data;if(a.kind==="add")this.createElementUI(b),this.invalidateBundleLink(b);else if(a.kind==="remove"){var c=this.getElementUI(b);c&&(c.dispose(),delete this._elementUIMap[b.getId()]),b===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null)}else a.kind==="clear"&&(this._elementUIMap={},this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);c&&c.handlePropertyChange(a),this.invalidateBundleLink(b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){a.property==="editable"&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this);var b=this.getSelectionModel().getLastData();b&&(a.kind==="append"||a.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b)),this.invalidateElementVisibility()},sendToTop:function(a){if(!this._box.contains(a))return;var b=a;while(b._parent&&this.isVisible(b._parent)){b=b._parent;if(!b)break}b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)},getViewRect:function(){return this.viewRect?d.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(a,b){var c=this.viewRect.x,d=this.viewRect.y,e=this.viewRect.width,f=this.viewRect.height;this.setViewRect(c+a,d+b,e,f)},setViewRect:function(a,b,c,d){this.isLimitViewInCanvas()==1&&(a<0&&(a=0),c>this.realWidth?a=0:a+c>this.realWidth&&(a=this.realWidth-c),b<0&&(b=0),d>this.realHeight?b=0:b+d>this.realHeight&&(b=this.realHeight-d));var e=this.viewRect;if(this.viewRect!=null&&a==this.viewRect.x&&b==this.viewRect.y&&c==this.viewRect.width&&d==this.viewRect.height)return;this.viewRect={x:a,y:b,width:c,height:d},this.firePropertyChange("viewRect",e,this.viewRect),this.invalidateElementVisibility()},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},dispose:function(){for(var a in this._elementUIMap){var b=this._elementUIMap[a];b.curInterval&&clearTimeout(b.curInterval)}},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(a){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){if(this._invalidateCanvasSizeFlag==0)return;this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize()},_validateCanvasSize:function(){if(this.isMovingElement())return;if(this.isAutoValidateCanvasSize()==0){this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};return}var a=this.getElementBox().getDatas(),b=a.size();if(b>0){var c={x:0,y:0,width:0,height:0};for(var d=0;d<b;d++){var e=a.get(d);if(this._visibleMap[e._id]){var f=this._elementUIMap[e._id];f&&(c=p.unionRect(c,f._viewRect))}}var g=this.getBackgroundImage();g&&(c=p.unionRect(c,g._viewRect)),c.x<0&&(c.width+=c.x,c.x=0),c.y<0&&(c.height+=c.y,c.y=0);if(this.realWidth==(c.x+c.width)*this.getZoom()&&this.realHeight==(c.y+c.height)*this.getZoom())return;var h=this.getZoom();this.realWidth=(c.x+c.width)*h+this._paddingRight,this.realHeight=(c.y+c.height)*h+this._paddingBottom,this._unionBounds={x:c.x*h,y:c.y*h,width:c.width*h+this._paddingRight,height:c.height*h+this._paddingRight}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(a){return a==null?null:this._elementUIMap[a._id]},createElementUI:function(a){var b=this._elementUIMap[a.getId()];b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b))},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction===a)return;var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},invalidateBundleLink:function(a){if(a instanceof c.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},paintRoot:function(){var a=this._rootCanvas.getContext("2d");a.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new c.List,this._topAttachmentList=new c.List;if(this.getElementBox()==null)return;Be.draw(a,this);var e=this.getElementBox().getDatas()._as,f=e.length;a.save(),a.scale(this.getZoom(),this.getZoom()),a.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom()),this.paintBottom(a);var g={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},h=this.getBackgroundImage(),i=this.getBackgroundImageRect();h instanceof l&&(i?a.drawImage(h,i.x,i.y,i.width,i.height):a.drawImage(h,0,0,h.width,h.height),h._viewRect={x:0,y:0,width:h.width,height:h.height});if(typeof h=="string"){var j=d.getImageAsset(h),k={x:0,y:0,width:j.getWidth(),height:j.getHeight()};Od(a,h,null,k,null,this)}var m=this._box._layerBox,n,o,p,q;if(m.size()===1)for(n=0;n<f;n++)o=e[n],this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],p!=null&&this._isInView(p,g)?(p.paint(a),p.setAttachmentVisible&&p.setAttachmentVisible(!0),this.visibleList.add(o)):p.setAttachmentVisible&&p.setAttachmentVisible(!1));else m.forEachByDepthFirst(function(b){for(n=0;n<f;n++)o=e[n],m.getLayerByElement(o)===b&&this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],p!=null&&this._isInView(p,g)?(p.paint(a),p.setAttachmentVisible&&p.setAttachmentVisible(!0),this.visibleList.add(o)):p.setAttachmentVisible&&p.setAttachmentVisible(!1))},null,this);f=this._topAttachmentList.size();for(n=0;n<f;n++)q=this._topAttachmentList.get(n),q.getElementUI().paintAttachment(a,q);if(this._xyz){var r=this._xyz,s=r.markText,t=r.type,u=r.expired,v=r.innerHTML,w=0,x=0,f,y=1,z=this.viewRect;a.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),a.scale(1/this.getZoom(),1/this.getZoom());var A=this.getZoom();s!=b&&s!=null&&s!=""||t=="2"?(a.font="15px Arial sans-serif",f=d.g.getTextSize(a.font,v),a.fillStyle="red",w=z.width-f.width,x=z.height-20):(a.font="10px Arial sans-serif",f=d.g.getTextSize(a.font,v),w=z.width/2-f.width/2,x=z.height/2),a.fillText(v,w,x)}a.restore()},paintBottom:function(a){},_isInView:function(a,b){return p.intersects(b,a._viewRect)},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(a){var b=this.markerList.size();for(var c=0;c<b;c++){var d=this.markerList.get(c);d.paint(a)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint:function(a){var b;if(m.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=this._view.getBoundingClientRect(),d=a.changedTouches[0],e=m.isAndroid?0:Ad.scrollLeft(),f=m.isAndroid?0:Ad.scrollTop();return b={x:(d.clientX+this.viewRect.x-c.left-e)/this._zoom,y:(d.clientY+this.viewRect.y-c.top-f)/this._zoom},b}return m.isFirefox?b={x:(a.layerX+this.viewRect.x)/this.getZoom(),y:(a.layerY+this.viewRect.y)/this.getZoom()}:b={x:(a.offsetX+this.viewRect.x)/this.getZoom(),y:(a.offsetY+this.viewRect.y)/this.getZoom()},b},getElementAt:function(a,b){if(this.visibleList==null)return null;arguments.length===1&&(b=!0);var c,d;a.target?c=this.getLogicalPoint(a):a.event?a.event.target&&(c=this.getLogicalPoint(a.event)):c=a;if(this._topAttachmentList!=null){var e=this._topAttachmentList.size();for(var f=e-1;f>=0;f--){var g=this._topAttachmentList.get(f);d=g.getElement();if((!b||this.isSelectable(d))&&g.hit(c.x,c.y))return d}}if(this.visibleList!=null){var h=this.visibleList.size();for(var i=h-1;i>=0;i--){var j=this.visibleList.get(i),k=this.getElementUI(j);if((!b||this.isSelectable(j))&&k&&k.hit(c.x,c.y))return j}}return null},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);if(!c)return null;var d;return a.target?d=this.getLogicalPoint(a):d=a,c.hitTest(d.x,d.y)},getElementsAtRect:function(a,d,e,f){var g=new c.List;if(this.visibleList==null)return g;f=f===b?!0:f;var h=this.visibleList.size();for(var i=h-1;i>=0;i--){var j=this.visibleList.get(i),k=this.getElementUI(j);k&&(!e||e(k._element))&&(f&&this.isSelectable(k._element)||!f)&&(d?k.intersects(a)&&g.add(j):p.contains(a,k.getViewRect())&&g.add(j))}return g},getPosition:function(a,b,d,e,f){var g,h=b instanceof c.canvas.ElementUI?b:this.getElementUI(b);if(h)if(a==="from"||a==="to"){if(h.getFromPosition){g=a==="from"?h.getFromPosition(e,f):h.getToPosition(e,f);if(g)return{x:g.x-d.width/2,y:g.y-d.height/2}}}else a==="hotspot"?g=h.getHotSpot():g=r.get(a,h.getBodyRect(),d);!g&&b.getRect&&(g=r.get(a,b.getRect(),d));if(g)return{x:g.x+e,y:g.y+f};throw"position '"+a+"' object '"+b+"'"},isValidEvent:function(a){if(!a)return!1;var b,c;if(a.currentTarget===this._view){m.isFirefox?(b=a.layerX,c=a.layerY):(b=a.offsetX,c=a.offsetY);if(this.isHScrollBarVisible()==1&&c>=this.viewRect.height-this.getScrollBarWidth())return!1;if(this.isVScrollBarVisible()==1&&b>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)?a instanceof c.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){var a=this.getSelectionModel().getSelection();for(var b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(a,b,d,e){if(a===0&&b===0)return;var f=this.getMovableSelectedElementsRect();if(f==null)return;this._limitElementInPositiveLocation&&(f.x+a<0&&(a=-f.x),f.y+b<0&&(b=-f.y)),c.Util.moveElements(this.getMovableSelectedElements(),a,b,d,e,this)},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(a.size()===0)return null;var b=null;for(var c=0,d=a.size();c<d;c++){var e=a.get(c);if(e instanceof Ze){var f=this.getElementUI(e);f&&(b=p.unionRect(b,f.getViewRect()))}}return b},isVisible:function(a,b,d){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;arguments.length!==3&&(b=this._visibleFunction);if(b&&!b(a))return!1;if(!(d||this._box._layerBox.getLayerByElement(a))._visible)return!1;if(wd.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof c.Link){if(!this._noAgentLinkVisible){if(!a._fromAgent||!a._toAgent)return!1;if(!this.isVisible(a._fromAgent,b,d)||!this.isVisible(a._toAgent,b,d))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else{var e=a._parent;while(e&&!e.ISubNetwork){if(e instanceof c.Group)if(!e.isExpanded()||!this.isVisible(e,b,d))return!1;e=e._parent}}return a.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a){return this._linkableFunction==null||this._linkableFunction(a)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&a.getStyle("select.style")==="shadow"?a.getStyle("select.color"):b},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a){this.setInteractions([new c.canvas.interaction.DefaultInteraction(this),new c.canvas.interaction.SelectInteraction(this),new c.canvas.interaction.MoveInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this)])},setTouchInteractions:function(){this.setInteractions([new c.canvas.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new c.canvas.interaction.ScrollInteraction(this),new c.canvas.interaction.MSTouchInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new c.canvas.interaction.DefaultInteraction(this),new c.canvas.interaction.SelectInteraction(this),new c.canvas.interaction.EditInteraction(this,a),new c.canvas.interaction.MoveInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this)])},setCreateElementInteractions:function(a){this.setInteractions([new c.canvas.interaction.DefaultInteraction(this),new c.canvas.interaction.CreateElementInteraction(this,a)])},setCreateLinkInteractions:function(a){this.setInteractions([new c.canvas.interaction.DefaultInteraction(this),new c.canvas.interaction.CreateLinkInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new c.canvas.interaction.DefaultInteraction(this),new c.canvas.interaction.CreateShapeLinkInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new c.canvas.interaction.DefaultInteraction(this),new c.canvas.interaction.CreateShapeNodeInteraction(this,a),new c.canvas.interaction.ScrollInteraction(this)])},setPanInteractions:function(){this.setInteractions([new c.canvas.interaction.DefaultInteraction(this),new c.canvas.interaction.PanInteraction(this),new c.canvas.interaction.ScrollInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new c.canvas.interaction.DefaultInteraction(this),new c.canvas.interaction.SelectInteraction(this),new c.canvas.interaction.MoveInteraction(this),new c.canvas.interaction.ScrollInteraction(this),new c.canvas.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(a){if(a){var b=a.getToolTip();return b?b:a.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){this._toolTipEnabled=a;if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){if(b.isMovingElement()){Cd.hideToolTip();return}var c=b.getElementAt(a);if(b._preElement===c)return;b._preElement=c;if(c){var d=b.getToolTip(c);Cd.showToolTip({x:a.pageX,y:a.pageY},d);var e=Cd.getToolTipDiv(),e=Cd.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(k.documentElement.scrollLeft||k.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(k.documentElement.scrollTop||k.body.scrollTop)+"px")}return}Cd.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Cd.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(a){a=this.checkZoom(a);var b=this._zoom;if(this._zoom==a)return;var c={x:(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*a,y:(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*a};this._zoom=a,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(c.x-this.viewRect.width/2,c.y-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",b,this._zoom)},getZoom:function(){return this._zoom},setTouchZoom:function(a){this.setZoom(a,!1)},zoomOverview:function(a){if(this.realWidth<=0||this.realHeight<=0)return;var b=this.realWidth/this.getZoom(),c=this.realHeight/this.getZoom(),d=this.viewRect.width/b,e=this.viewRect.height/c,f=Math.min(d,e);this.setZoom(f)},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(this.getZoom()*1.2)},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(wd.getSubNetwork(this._currentSubNetwork),a,b)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,d){c.animate.AnimateManager.endAnimate();if(b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var e=new c.animate.AnimateSubNetwork(this,a,d);c.animate.AnimateManager.start(e)}else this._setCurrentSubNetwork(a),d&&d()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility(),this.invalidateCanvasSize()},makeVisible:function(a){var b=this.getElementUI(a);if(!b)return;var e=wd.getSubNetwork(a);if(e!==this._currentSubNetwork){var f=this;this.setCurrentSubNetwork(e,this.isSubNetworkAnimate(),function(){d.callLater(f.makeVisible,f,[a])});return}var g=a;while((g=g.getParent())&&g!==e)g instanceof c.Group&&g.setExpanded(!0);var h=b.getViewRect();if(!h)return;var i={x:h.x*this.getZoom(),y:h.y*this.getZoom(),width:h.width*this.getZoom(),height:h.height*this.getZoom()};p.intersects(this.viewRect,i)||this.isVisible(a)&&d.callLater(this.centerByLogicalPoint,this,[i.x+i.width/2,i.y+i.height/2])},centerByLogicalPoint:function(a,b,c){var d=a-this.viewRect.width/2,e=b-this.viewRect.height/2;this.setViewRect(d,e,this.viewRect.width,this.viewRect.height)},panByOffset:function(a,b){this.setViewOffSet(a,b)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Se.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0
),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,d){d||(d=s.createCanvas()),d.setAttribute("width",a),d.setAttribute("height",b),d._viewRect?(d._viewRect.width=a,d._viewRect.height=b):d._viewRect={x:0,y:0,width:a,height:b};var e=d.getContext("2d");e.clearRect(0,0,a,b),Be.draw(e,this);if(this._view.clientWidth===0||this._view.clientHeight===0)return d;var f=a/this.realWidth*this._zoom,g=b/this.realHeight*this._zoom;e.scale(f,g);var h=this.getBackgroundImage();if(h&&h._viewRect){var i=h._viewRect;try{e.drawImage(h,i.x,i.y,i.width,i.height)}catch(j){}}var k=this.getElementBox().getDatas()._as,l=k.length;this._topAttachmentList=new c.List;var m=this.getElementBox().getLayerBox(),n=m.getRoots(),o=n.size(),p,q,r,t,u,v;if(o===1)for(r=0;r<l;r++)t=k[r],this._visibleMap[t._id]&&(u=this._elementUIMap[t._id],u!=null&&u.paint(e));else for(p=0;p<o;p++){q=n.get(p);for(r=0;r<l;r++)t=k[r],m.getLayerByElement(t)===q&&this._visibleMap[t._id]&&(u=this._elementUIMap[t._id],u!=null&&u.paint(e))}l=this._topAttachmentList.size();for(r=0;r<l;r++)v=this._topAttachmentList.get(r),v.getElementUI().paintAttachment(e,v);return d},toCanvasByRegion:function(a,b,d){d||(d=s.createCanvas());var e=a.width*b,f=a.height*b;d.setAttribute("width",e),d.setAttribute("height",f),d._viewRect?(d._viewRect.width=e,d._viewRect.height=f):d._viewRect={x:0,y:0,width:e,height:f};var g=d.getContext("2d");g.clearRect(0,0,e,f),Be.draw(g,this);if(this._view.clientWidth===0||this._view.clientHeight===0)return d;g.save(),g.scale(b,b),g.beginPath(),g.translate(-a.x,-a.y);var h=this.getElementBox().getDatas()._as,i=h.length;this._topAttachmentList=new c.List;var j=this.getBackgroundImage();if(j&&j._viewRect&&p.intersects(a,j._viewRect)){var a=p.intersection(a,j._viewRect),k=j._viewRect;try{g.drawImage(j,k.x,k.y,k.width,k.height)}catch(l){}}var m=this.getElementBox().getLayerBox(),n=m.getRoots(),o=n.size(),q,r,t,u,v,w;if(o===1)for(t=0;t<i;t++)u=h[t],this._visibleMap[u._id]&&(v=this._elementUIMap[u._id],v!=null&&p.intersects(a,v._viewRect)&&v.paint(g));else for(q=0;q<o;q++){r=n.get(q);for(t=0;t<i;t++)u=h[t],m.getLayerByElement(u)===r&&this._visibleMap[u._id]&&(v=this._elementUIMap[u._id],v!=null&&p.intersects(a,v._viewRect)&&v.paint(g))}i=this._topAttachmentList.size();for(t=0;t<i;t++)w=this._topAttachmentList.get(t),w.getElementUI().paintAttachment(g,w);return g.restore(),d},getGroupChildrenRects:function(a){var b=new Ce;return a.getChildren().forEach(function(a){if(a instanceof Ze){var c=this.getElementUI(a);if(c){var d=c.getViewRect();d&&b.add(d)}}},this),b},getBackgroundImageRect:function(){return null},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},onClickElement:function(a,b){},onClickBackground:function(a){},onDoubleClickElement:function(a,b){},onDoubleClickBackground:function(a){},onLongClickElement:function(a,b){},onLongClickBackground:function(a){},onMouseMove:function(a,b){},onMouseEnter:function(a,b){},onMouseLeave:function(a,b){}}),c.canvas.Overview=function(a){c.canvas.Overview.superClass.constructor.apply(this,a),this._view=s.createView(),this._rootDiv=s.createDiv(),this._imageCanvas=s.createCanvas(),this._imageDiv=s.createDiv(),this._maskCanvas=s.createCanvas(),this._selectDiv=s.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,s.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(a);var b;m.isMSToucheable?b=c.canvas.OverviewMSTouchInteraction:m.isTouchable?b=c.canvas.OverviewTouchInteraction:b=c.canvas.OverviewInteraction,b&&new b(this)},d.ext("twaver.canvas.Overview",c.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Se.OVERVIEW_FILL_COLOR,_outlineColor:Se.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Se.OVERVIEW_OUTLINE_WIDTH,_selectColor:Se.OVERVIEW_SELECT_COLOR,_selectWidth:Se.OVERVIEW_SELECT_WIDTH,_padding:Se.OVERVIEW_PADDING,_animate:Se.OVERVIEW_ANIMATE,_maxPackingWidth:Se.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Se.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){if(a===this._network)return;this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),s.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),s.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate()},_handleNetworkPropertyChange:function(a){(a.property==="zoom"||a.property==="currentSubNetwork"||a.property==="elementBox"||a.property==="dataBox"||a.property==="canvasSizeChange")&&this.invalidate()},_handleNetworkViewChange:function(a){a.kind==="validateEnd"&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){if(!this._isNetworkDirty||!this._isMaskDirty)this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),d.callLater(this.validate,this,null,a)},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,d.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&this._network.getViewRect().width!==0&&this._network.getViewRect().height!==0&&!this._network._invalidate){var a=this._maxPackingWidth>0&&this._maxPackingHeight>0,b;a?b={x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:b={x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},p.grow(b,-this._padding,-this._padding);var c=Math.min(b.width/this._network.getCanvasSize().width,b.height/this._network.getCanvasSize().height);a&&(s.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),b.width=this._imageDiv._viewRect.width,b.height=this._imageDiv._viewRect.height);var d=this._network.getCanvasSize().width*c,e=this._network.getCanvasSize().height*c,f=b.x+(b.width-d)/2,g=b.y+(b.height-e)/2;if(this._isNetworkDirty){var h={x:f,y:g,width:d,height:e};this._network.toCanvas(h.width,h.height,this._imageCanvas),s.setDiv(this._imageDiv,h,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var i={x:this._network.getViewRect().x*c,y:this._network.getViewRect().y*c,width:d*this._network._view.clientWidth/this._network.getCanvasSize().width,height:e*this._network._view.clientHeight/this._network.getCanvasSize().height};i.x=i.x<0?0:i.x,i.y=i.y<0?0:i.y;var j=s.setCanvas(this._maskCanvas,f,g,d,e);j.lineWidth=0,j.fillStyle=this._fillColor,j.beginPath(),t.drawVector(j,"rectangle",null,f,g,d,e),j.fill(),j.clearRect(f+i.x,g+i.y,i.width,i.height);var k=this._outlineWidth<0?0:this._outlineWidth;j.lineWidth=k,j.strokeStyle=this._outlineColor;var l=i.width-k*2,m=i.height-k*2;l=Math.min(l,d-2-i.x-this._outlineWidth),m=Math.min(m,e-2-i.y-this._outlineWidth),j.beginPath(),t.drawVector(j,"rectangle",null,f+i.x+k,g+i.y+k,l,m),k>=0&&j.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return s.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;p.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network.getCanvasSize().width,(a.y-c.y)/c.height*this._network.getCanvasSize().height,b),this._invalidateMask())}}),c.canvas.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,s.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.canvas.OverviewTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Ad.isMultiTouch(a)&&(this.distance=Ad.getDistance(a),this.zoom=this.network.getZoom()),s.addEventListener("touchmove","handleTouchmove",this.view,this),s.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a);if(Ad.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=Ad.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?d.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,s.removeEventListener("touchmove",this.view,this),s.removeEventListener("touchend",this.view,this)),this.moved=!1}}),c.canvas.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[];var b=this;this.view.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.view.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.view.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.view.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1)},d.ext("twaver.canvas.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),this._pointerIdArray.length==1?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(this._pointerIdArray.length==0||!this._pointerMap[a.pointerId]||p.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)return;this._pointerMap[a.pointerId]=a;if(this._pointerIdArray.length==2){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(this._pointerIdArray.length==1&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(c==null)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(this._pointerIdArray.length==1&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&p.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?d.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return p.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),c.canvas.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,s.addEventListener("mousedown","handleMousedown",this.view,this)},d.ext("twaver.canvas.OverviewInteraction",Object,{handleMousedown:function(a){if(a.button!==0)return;this.clear(),this.endPoint=this.overview.getLogicalPoint(a),d.isCtrlDown(a)&&(this.startPoint=this.endPoint,s.setVisible(this.overview._selectDiv,!0)),s.addEventListener("mousemove","handleMousemove",this.view,this),s.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(a){this.endPoint=this.overview.getLogicalPoint(a);if("detail"in a&&a.detail===2)d.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(s.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,e=this.overview._selectDiv._viewRect.y,f=b.width/this.overview._selectDiv._viewRect.width,g=b.height/this.overview._selectDiv._viewRect.height,h=Math.min(f,g);this.network.setZoom(h*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var i=this.network.getCanvasSize().width*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),j=this.network.getCanvasSize().height*((e-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);d.callLater(this.network.centerByLogicalPoint,this.network,[i,j,this.overview._animate]),s.setVisible(this.overview._selectDiv,!1),s.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);this.endPoint=b;if(s.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),s.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,s.removeEventListener("mousemove",this.view,this),s.removeEventListener("mouseup",this.view,this))}}),c.canvas.ElementUI=function(a,b){this._network=a,this._element=b,this._attachments=new c.List,this._bodyBounds=new c.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},d.ext("twaver.canvas.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},invalidate:function(a){a===b&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag)return;this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility()},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){if(this._invalidateFlag==0)return;this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(a){a.validate()});var a;this._bodyBounds.forEach(function(b){a=p.unionRect(a,b)}),this._unionBodyBounds=d.clone(a),this._attachments.forEach(function(b){a=p.unionRect(a,b.getViewRect())}),this._viewRect=a},validateImpl:function(){},setShadow:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return b.shadowOffsetX===this._shadowXOffset&&b.shadowOffsetY===this._shadowYOffset&&b.shadowBlur===this._shadowBlur?b:(c&&(b.shadowOffsetX=this._shadowXOffset,b.shadowOffsetY=this._shadowYOffset,b.shadowBlur=this._shadowBlur,b.shadowColor=this._shadowColor),b)},clearShadow:function(a){if(a.shadowOffsetX!=0||a.shadowOffsetY!=0||a.shadowBlur!=0)a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return c&&(this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset),p.grow(b,this._shadowBlur,this._shadowBlur)),b},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},addAttachment:function(a){this._attachments.add(a)},removeAttachment:function(a){this._attachments.remove(a)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);a!=null&&a!==""?this._labelAttachment||(this._labelAttachment=new c.canvas.LabelAttachment(this,Se.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);a!=null&&a!==""?this._alarmAttachment||(this._alarmAttachment=new c.canvas.AlarmAttachment(this,Se.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new c.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new c.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:c.Defaults.FONT},paint:function(a){a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore()},paintBody:function(a){},paintAttachments:function(a){a.beginPath();var b=this._attachments.size();for(var c=0;c<b;c++){var d=this._attachments.get(c);this._hitTest==1&&d.isShowOnTop()==0&&this.paintAttachment(a,d),this._intersectTest==1&&this.paintAttachment(a,d),this._hitTest==0&&this._intersectTest==0&&(d.isShowOnTop()?this._network._topAttachmentList.add(d):this.paintAttachment(a,d))}},paintAttachment:function(a,b){a.beginPath(),b.paint(a),this.clearShadow(a)},getViewRect:function(){return d.clone(this._viewRect)},getUnionBodyBounds:function(){return d.clone(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),d.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?d.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(a,b){return!1},intersects:function(a){return p.contains(a,this.getViewRect())?!0:!1},hitCanvasRectAtBody:function(a){var b=af.getHitCanvas(a.width,a.height),c=af.getCtx(b);c.save(),c.translate(-a.x,-a.y);if(this._element.getImage){var e=d.getImageAsset(this._element.getImage());if(e&&e.getImage()instanceof Ve)return 1}this.paintBody(c);try{var f=c.getImageData(0,0,a.width,a.height),g=f.data;for(var h=0;h<f.width;h++)for(var i=0;i<f.height;i++){var j=4*(i*f.width+h),k=g[j+3];if(k!==0)return c.restore(),1}}catch(l){af.disposeHitCanvas();if(p.contains(this.getUnionBodyBounds(),a))return 0}return c.restore(),-1},hitCanvasRectAtAttachments:function(a){var b=af.getHitCanvas(a.width,a.height),c=af.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintAttachments(c);try{var d=c.getImageData(0,0,a.width,a.height),e=d.data;for(var f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(i!==0)return c.restore(),1}}catch(j){af.disposeHitCanvas()}return c.restore(),-1},hitCanvasRect:function(a){this._intersectTest=!0,this._hitTest==1&&(this._intersectTest=!1);var b=p.intersection(a,this._viewRect),c=this.hitCanvasRectAtBody(b);if(c==1)return this._intersectTest=!1,!0;var d=this.hitCanvasRectAtAttachments(b);return d==1?(this._intersectTest=!1,!0):(this._intersectTest=!1,c==0)},hitCanvasPoint:function(a,b){if(!p.containsPoint(this._viewRect,a,b))return!1;this._hitTest=!0;var c=this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2});return this._hitTest=!1,c},hitTest:function(a,b){if(!p.containsPoint(this._viewRect,a,b))return null;var c={x:a-1,y:b-1,width:2,height:2},d=p.intersection(c,this._viewRect),e=this.hitCanvasRectAtBody(d);if(e==1)return this;var f=this._attachments.size();for(var g=0;g<f;g++){var h=this._attachments.get(g);if(h.hit(a,b))return h}return e==0?this:null},dispose:function(){this._attachments.forEach(function(a){a.dispose()}),this._attachments.clear()}}),c.canvas.NodeUI=function(a,b){c.canvas.NodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.NodeUI",c.canvas.ElementUI,{invalidate:function(a){c.canvas.NodeUI.superClass.invalidate.call(this,a),this.curInterval&&clearInterval(this.curInterval);var b=this._element.getAgentLinks();b&&b.forEach(function(a){this._network.invalidateElementUI(a,!1)},this);var d=this._element.getParent();d instanceof c.Group&&this._network.invalidateElementUI(d,!1)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){c.canvas.NodeUI.superClass.validateImpl.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=p.getHotSpot(b.x,b.y,b.width,b.height,a),this.validateBodyBounds()},validate:function(){if(this._invalidateFlag==0)return;c.canvas.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var a=this.getStyle("body.type");a==="default"?this.addBodyBounds(this.getDefaultBodyRect()):a==="vector"?this.addBodyBounds(this.getVectorBody()):a==="default.vector"?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):a==="vector.default"&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var a=this._element,b=d.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return c;p.addPadding(c,this._element,"image.padding",1),this._defaultRect=c;var e=d.clone(c);return this.appendShadowBound(this,e),c=e,c},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(a){var b=this._element,c=b.getStyle(a+".width");if(c>0){var e=this.getBodyRect();p.addPadding(e,b,a+".padding",1);var f=d.clone(e);return p.grow(f,c/2,c/2),f}return null},getPathRect:function(a,b){var c=this._element,e=this.getBodyRect();b&&p.addPadding(e,c,a+".padding",1);var f=d.clone(e),g=c.getStyle(a+".outline.width");return g>0&&p.grow(f,g/2,g/2),this.appendShadowBound(this,f),f},paintBody:function(a){this.curInterval&&clearInterval(this.curInterval);var b=this.getStyle("body.type");b==="default"?this.drawDefaultBody(a):b==="vector"?this.drawVectorBody(a):b==="default.vector"?(this.drawVectorBody(a),this.drawDefaultBody(a)):b==="vector.default"&&(this.drawDefaultBody(a),this.drawVectorBody(a)),this._outerColor&&this.drawOuterBorder(a),this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(a)},drawOuterBorder:function(a){var b=this._element,c=b.getStyle("outer.width");if(c>0){var d=this.getBodyRect();p.addPadding(d,b,"outer.padding",1),a.lineWidth=c,a.lineCap=b.getStyle("outer.cap"),a.lineJoin=b.getStyle("outer.join"),a.strokeStyle=this._outerColor,t.drawVector(a,b.getStyle("outer.shape"),null,d),a.stroke()}},drawDefaultBody:function(a){var b=this._element,e=d.getImageAsset(b.getImage()),f=this._defaultRect;if(!e)return;if(e.getImage()){b.getAngle()!=0&&(a.save(),f=b.getOriginalRect(),c.Util.rotateCanvas(a,f,b.getAngle())),this.setShadow(this,a);var g=this;if(e.getImage()instanceof Ve){var h=e.getImage().frames,i=e.getImage().size,j=0,k;k=Xe(h,i,0),a.drawImage(k,f.x,f.y,f.width,f.height),this.curInterval=setInterval(function(){j=(j+h.length)%h.length,k=Xe(h,i,j),a.drawImage(k,f.x,f.y,f.width,f.height),j++},100)}else Od(a,b.getImage(),this.getInnerColor(),f,b,this._network);b.getAngle()!=0&&a.restore()}},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var e=this.getBodyRect();p.addPadding(e,b,"select.padding",1);var f=d.clone(e);p.grow(f,c/2,c/2),a.lineWidth=c,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),t.drawVector(a,b.getStyle("select.shape"),null,e),a.stroke()}},drawVectorBody:function(a){this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("vector.deep"),d=this.getStyle("vector.fill.color"),e=this.getBodyRect();if(b!==0&&d){var f=this._element.getAngle();f!=0&&(a.save(),e=this._element.getOriginalRect(),c.Util.rotateCanvas(a,e,f)),this.getStyle("vector.shape")==="rectangle"&&t.draw3DRect(a,d,b,e),f!=0&&a.restore()}},drawPath:function(a,b,d,e,f,g,h){var i=this._element,j=this.getBodyRect();d&&p.addPadding(j,i,b+".padding",1);var k=i.getStyle(b+".outline.width");this.setShadow(this,a),i.getAngle()!=0&&(i instanceof _e||(j=i.getOriginalRect()),a.save(),c.Util.rotateCanvas(a,j,i.getAngle()));var l=i.getStyle(b+".fill"),m;if(l){this._innerColor&&!wd.hasDefault(this._element)?m=this._innerColor:m=i.getStyle(b+".fill.color");var n=i.getStyle(b+".gradient");n?t.fill(a,m,n,i.getStyle(b+".gradient.color"),j):a.fillStyle=m}var o=i.getStyle(b+".shape");l&&(a.beginPath(),f?t.drawLinePoints(a,f,null,g,h):t.drawVector(a,o,null,j),a.fill()),k>0&&(a.lineWidth=k,a.lineCap=i.getStyle(b+".cap"),a.lineJoin=i.getStyle(b+".join"),a.strokeStyle=i.getStyle(b+".outline.color"),a.beginPath(),f?t.drawLinePoints(a,f,e,g,h):t.drawVector(a,o,e,j),a.stroke()),i.getAngle()!=0&&a.restore()},hit:function(a,b){if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(d.math.containsPoint(c,a,b))return!0}return p.containsPoint(this.getViewRect(),a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=c.canvas.NodeUI.superClass.intersects.apply(this,arguments);if(b==1)return!0;if(this._network._transparentSelectionEnable){var e=this.getBodyRect();if(d.math.intersects(e,a))return!0}return p.intersects(a,this.getViewRect())?this.hitCanvasRect(a):!1}}),c.canvas.LinkUI=function(a,b){c.canvas.LinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.LinkUI",c.canvas.ElementUI,{isEditable:function(){return yd.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,c.canvas.LinkUI.superClass.invalidate.call(this,a)},validateImpl:function(){this.validateBodyBounds(),c.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var a=this.getLinkPoints();if(!a||a.size()<2)return;var b=this._element,c=p.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=f*2}var g=!this._editAttachment&&b.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=h*2}p.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(c=p.unionRect(c,De.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(c=p.unionRect(c,De.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset")))),this.appendShadowBound(this,c),this.addBodyBounds(c)},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(a){var b=this._linkPoints;if(!b||b.size()<2)return;var c=this._element,d=c.getStyle("link.width"),e=d;if(this._outerColor){var f=c.getStyle("outer.width");e+=f*2}var g=!this._editAttachment&&c.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(g){var h=c.getStyle("select.width");e+=h*2}this.setShadow(this,a),a.lineCap=c.getStyle("link.cap"),a.lineJoin=c.getStyle("link.join");var i=c.getStyle("link.pattern");g&&this.drawLinePoints(a,b,e,c.getStyle("select.color"),i),this._outerColor&&this.drawLinePoints(a,b,d+f*2,this._outerColor,i),this.drawLinePoints(a,b,d,this._innerColor||c.getStyle("link.color"),i),De.drawLinkArrow(this,a,b)},drawLinePoints:function(a,b,c,d,e){a.lineWidth=c,a.strokeStyle=d;if(this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new vd(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset"),h=Math.floor(g/(e[0]+e[1]));h>2&&(g-=(e[0]+e[1])*h),this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),t._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var i=this._element.getStyle("link.flow.color");i=i?i:Se.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=i,t._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),t.drawLinePoints(a,b,e),a.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=p.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=yd.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=yd.createToPoint(this)),this._toPoint},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),d=this.getStyle("link.type"),e=new c.List;if(yd.isOrthogonalOrFlexionalLink(this._element))e=yd.orthogonalAndFlexional(this,d);else if(this._element.isLooped()){var f=this._network.getElementUI(this._element.getFromAgent());f!=null&&(this._hotSpot=yd.fillLoopedPoints(this,f.getBodyRect(),e))}else{if(d!=="arc"&&d!=="triangle"&&d!=="parallel")throw"Can not resolve link type '"+d+"'";this._hotSpot=yd.fillBundlePoints(this,d,a,b,e)}if(
this._network._linkPathFunction){var g=this._network._linkPathFunction(this,e);g&&(e=g)}return e},checkAttachments:function(){c.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);a!=null&&a!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new c.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return yd.getControlPoint(this._element,this)},setControlPoint:function(a){if(!a)return;var b=this.getStyle("link.type");if(!yd.hasControlPoint(b))return;var c=yd.getLinkSourceBounds(this),d=yd.getLinkTargetBounds(this);yd.setParamsByControlPoint(a,c,d,b,this._element)},getLineLength:function(){return this._lineLength},hit:function(a,b){return p.containsPoint(this.getViewRect(),a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=c.canvas.LinkUI.superClass.intersects.apply(this,arguments);if(b==1)return!0;if(p.intersects(a,this.getViewRect())==0)return!1;var d=this.getLinkPoints(),e=d.size();if(e==2)for(var f=0;f<e;f+=2){var g=d.get(f);if(f+1<e){var h=d.get(f+1);if(af.intersectsLine(g.x,g.y,h.x,h.y,a.x,a.y,a.width,a.height))return!0}}return this.hitCanvasRect(a)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=p.getAngle(this._fromPoint,this._toPoint)),this._angle||0}}),c.canvas.GroupUI=function(a,b){c.canvas.GroupUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.GroupUI",c.canvas.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(a){this._shapeRect?this.drawExpandedGroup(a):c.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect("group",!1)):c.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(a){this.drawPath(a,"group",!1,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");b!==0&&c&&this.getStyle("group.shape")==="rectangle"&&t.draw3DRect(a,c,b,this._bodyRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element,b=this._network;if(a.isExpanded()){a.getChildren().forEach(function(a){var c=b.getElementUI(a);c&&c.validate()});var d=this.getChildrenRects();if(!d.isEmpty()){var e=a.getStyle("group.shape"),f=q[e];if(!f)throw"Can not resolve group shape '"+e+"'";this._shapeRect=f(d)}}return this._shapeRect?(p.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):c.canvas.GroupUI.superClass.createBodyRect.call(this)}}),c.canvas.ShapeNodeUI=function(a,b){c.canvas.ShapeNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.ShapeNodeUI",c.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect("vector",!0)},drawDefaultBody:function(a){if(this._element._points.size()<2)return;this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed")),De.drawLinkArrow(this,a,p.getPointObject(this._element._points,this._element._segments))},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getBodyRect();p.addPadding(d,b,"select.padding",1),p.grow(d,c/2,c/2);var e=b.getStyle("vector.outline.width");e>0&&p.grow(d,e/2,e/2),a.lineWidth=c,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),t.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}}}),c.canvas.ShapeLinkUI=function(a,b){c.canvas.ShapeLinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.ShapeLinkUI",c.canvas.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),e=new c.List,f=this.getStyle("shapelink.type");e.add(a),this._element._points!=null&&e.addAll(this._element._points),e.add(b);var g=e.size(),h=Math.floor(g/2);if(g%2===0){var i=e.get(h),j=e.get(h-1);this._hotSpot={x:(i.x+j.x)/2,y:(i.y+j.y)/2}}else this._hotSpot=d.clone(e.get(h));var k,l,m;if(f!=="lineto")if(f==="quadto"){k=new c.List(e.get(0));for(l=1,g=e.size();l<g;l++)l<g-1?k.add(new c.List([e.get(l++),e.get(l)])):k.add(e.get(l));e=k}else if(f==="cubicto"){k=new c.List(e.get(0));for(l=1,g=e.size();l<g;l++)l<g-2?k.add(new c.List([e.get(l++),e.get(l++),e.get(l)])):l<g-1?k.add(new c.List([e.get(l++),e.get(l)])):k.add(e.get(l));e=k}else{if(f!=="orthogonalto")throw"Can not resolve shapelink type '"+f+"'";m=e.get(0),k=new c.List(m);for(l=1,g=e.size();l<g;l++)if(l<g-1){var n=d.clone(e.get(l)),o=n.x,p=n.y,q=o-m.x,r=p-m.y;Math.abs(q)>Math.abs(r)?(n.x=o,n.y=m.y):(n.x=m.x,n.y=p),m=n,k.add(m)}else k.add(e.get(l));e=k}return e}}),c.canvas.GridUI=function(a,b){c.canvas.GridUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.GridUI",c.canvas.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?c.canvas.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage())c.canvas.GridUI.superClass.validateBodyBounds.call(this);else{var a=this.getBodyRect(),b=d.clone(a);this.appendShadowBound(this,b),this.addBodyBounds(b)}},drawGridBody:function(a){var b=this.getStyle("grid.fill"),c=this.getStyle("grid.deep"),d=this.getStyle("grid.cell.deep");if(!b&&c===0&&d===0)return;a.beginPath();var e=this._element.getRect(),f=this.getDyeColor("grid.fill.color");this.setShadow(this,a),b&&(a.fillStyle=f,a.rect(e.x,e.y,e.width,e.height),a.fill()),a.closePath(),this.clearShadow(a),a.beginPath(),c!=0&&t.draw3DRect(a,f,c,e.x,e.y,e.width,e.height),a.closePath();if(d!=0){var g=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count");for(var i=0;i<g;i++)for(var j=0;j<h;j++){var k=this._element.getCellRect(i,j);k!=null&&(a.beginPath(),t.draw3DRect(a,f,d,k.x,k.y,k.width,k.height),a.closePath())}}}}),c.canvas.RotatableNodeUI=function(a,b){c.canvas.RotatableNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.RotatableNodeUI",c.canvas.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var a=this._element,b=d.getImageAsset(a.getImage()),c=this.getBodyRect();return b?(p.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(a){var b=this._element,c=d.getImageAsset(b.getImage()),e=this.getBodyRect();p.addPadding(e,this._element,"image.padding",1);if(c.getImage()){var f=this._element._getOrignalWidth(),g=this._element._getOrignalHeight(),h=this._element._getRotateRect();a.save(),a.translate(e.x-h.x+f/2,e.y-h.y+g/2),a.rotate(this._element._angle*Math.PI/180);var e={x:-f/2,y:-g/2,width:f,height:g};Od(a,c.getImage(this._innerColor,e.width,e.height),this._innerColor,e,b,this._network),a.restore()}else if(!c.getSrc()&&!c.getFunction())throw"ImageAsset '"+b.getImage()+" ' is empty"}}),c.canvas.HTMLNodeUI=function(a,b){c.canvas.HTMLNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.HTMLNodeUI",c.canvas.NodeUI,{checkAttachments:function(){c.canvas.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&a==="none"){c.canvas.HTMLNodeUI.superClass.checkLabelAttachment.call(this);return}var b=this._network.getLabel(this._element);b!=null&&b!==""?this._labelAttachment||(this._labelAttachment=new c.canvas.HTMLLabelAttachment(this,Se.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&a==="none"){c.canvas.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);return}var b=this._network.getAlarmLabel(this._element);b!=null&&b!==""?this._alarmAttachment||(this._alarmAttachment=new c.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(a){a?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),c.canvas.HTMLLinkUI=function(a,b){c.canvas.HTMLLinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.HTMLLinkUI",c.canvas.LinkUI,{checkAttachments:function(){c.canvas.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&a==="none"){c.canvas.HTMLLinkUI.superClass.checkLabelAttachment.call(this);return}var b=this._network.getLabel(this._element);b!=null&&b!==""?this._labelAttachment||(this._labelAttachment=new c.canvas.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&a==="none"){c.canvas.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);return}var b=this._network.getAlarmLabel(this._element);b!=null&&b!==""?this._alarmAttachment||(this._alarmAttachment=new c.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),c.canvas.Attachment=function(a,b){this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._showOnTop=b},d.ext("twaver.canvas.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return d.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(a){},hit:function(a,b){return p.containsPoint(this._viewRect,a,b)?this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2}):!1},hitCanvasRect:function(a){var b=af.getHitCanvas(a.width,a.height),c=af.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paint(c);try{var d=c.getImageData(0,0,a.width,a.height),e=d.data;for(var f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(i!==0)return c.restore(),!0}}catch(j){af.disposeHitCanvas()}return c.restore(),!1}}),c.canvas.BasicAttachment=function(a,b){c.canvas.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},d.ext("twaver.canvas.BasicAttachment",c.canvas.Attachment,{paint:function(a){c.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),d=this.getOutlineWidth();this.getElementUI().setShadow(this,a);if(d>0||b){t.drawRoundRect(a,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(a.moveTo(this._pointers[0].x,this._pointers[0].y),a.lineTo(this._pointers[1].x,this._pointers[1].y),a.lineTo(this._pointers[2].x,this._pointers[2].y)),a.closePath(),d>0&&(a.lineWidth=d,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke());if(b){var e=this.getFillColor(),f=this.getGradient();f?t.fill(a,e,f,this.getGradientColor(),this._viewRect):a.fillStyle=e,a.fill()}}},validate:function(){c.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();this._viewRect=p.getRect(this._pointers),this._viewRect=p.unionRect(this._viewRect,this._roundRect),a>0&&p.grow(this._viewRect,a/2,a/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+c*2,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);var l;if(k==="aboveleft")i.y=j.y-d-i.height,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if(k==="aboveright")i.y=j.y-d-i.height,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if(k==="belowleft")i.y=j.y+d,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if(k==="belowright")i.y=j.y+d,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if(k==="leftabove")i.y=j.y+c-i.height,i.x=j.x-d-i.width,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if(k==="leftbelow")i.y=j.y-c,i.x=j.x-d-i.width,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if(k==="rightabove")i.y=j.y+c-i.height,i.x=j.x+d,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if(k==="rightbelow")i.y=j.y-c,i.x=j.x+d,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if(k==="above")i.y=j.y-d-i.height,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y-d},{x:j.x+l,y:j.y-d}];else if(k==="below")i.y=j.y+d,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y+d},{x:j.x+l,y:j.y+d}];else if(k==="left")i.y=j.y-i.height/2,i.x=j.x-d-i.width,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+l},{x:j.x-d,y:j.y-l}];else{if(k!=="right")throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+l},{x:j.x+d,y:j.y-l}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var m=this.getPadding();m!=0&&p.grow(i,m,m),m=this.getPaddingLeft(),m!=0&&(i.x-=m,i.width+=m),m=this.getPaddingRight(),m!=0&&(i.width+=m),m=this.getPaddingTop(),m!=0&&(i.y-=m,i.height+=m),m=this.getPaddingBottom(),m!=0&&(i.height+=m),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},getContentWidth:function(){return c.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return c.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return c.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return c.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return c.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return c.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return c.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return c.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return c.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return c.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return c.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return c.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return c.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return c.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return c.Defaults.ATTACHMENT_FILL},getFillColor:function(){return c.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return c.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return c.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return c.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return c.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return c.Defaults.ATTACHMENT_CAP},getJoin:function(){return c.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return c.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return d.clone(this._roundRect)},getContentRect:function(){return d.clone(this._contentRect)}}),c.canvas.LabelAttachment=function(a,b){c.canvas.LabelAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.LabelAttachment",c.canvas.BasicAttachment,{paint:function(a){var b=this._element instanceof c.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var d=this._viewRect.x+this._viewRect.width/2,e=this._viewRect.y+this._viewRect.height/2;a.translate(d,e),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-d,-e)}c.canvas.LabelAttachment.superClass.paint.apply(this,arguments);var f=this._element.getStyle("label.align");t.drawText(a,this.text,this._contentRect,this.font,this.getStyle("label.color"),f),b&&a.restore()},validate:function(){this.font=this.getFont("label.font"),this.text=this.getLabel(),this._textSize=t.getTextSize(this.font,this.text),c.canvas.LabelAttachment.superClass.validate.call(this)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),c.canvas.AlarmAttachment=function(a,b){c.canvas.AlarmAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.AlarmAttachment",c.canvas.BasicAttachment,{paint:function(a){c.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),t.drawText(a,this.text,this._contentRect,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=t.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),c.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),c.canvas.LinkHandlerAttachment=function(a,b){c.canvas.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.LinkHandlerAttachment",c.canvas.BasicAttachment,{paint:function(a){c.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),t.drawText(a,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=t.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),c.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),c.canvas.IconsAttachment=function(a,b){c.canvas.IconsAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.IconsAttachment",c.canvas.Attachment,{isShadowable:function(){return c.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){c.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element);if(!this.iconsNames||this.iconsNames.length==0)return;var a=this._makeGroup(this.iconsNames),b=this._makeGroup(this._network.getIconsColors(this._element));len=a.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[];var d,e;for(i=0;i<len;i++){var f=a[i],g=this.iconsOrientation[i]||"right",h=this.iconsPosition[i]||"topleft.bottomright",j=this.iconsXgap[i]||1,k=this.iconsYgap[i]||1,l=this.iconsXoffset[i]||0,m=this.iconsYoffset[i]||0;e=null,d=this._getIconsSize(f,g,j,k),d&&(e=this._network.getPosition(h,this._ui,d,l,m),g==="top"?e.y+=d.height:g==="left"&&(e.x+=d.width)),this.locations.push(e),this.iconsSizes.push(d)}var n=null;for(i=0;i<this.locations.length;i++){e=this.locations[i],d=this.iconsSizes[i];if(e==null)continue;n==null?n={x:e.x,y:e.y,width:d.width,height:d.height}:n=p.unionRect(n,{x:e.x,y:e.y,width:d.width,height:d.height})}this._viewRect=n||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=a,this.colorGroups=b},_makeGroup:function(a){if(!Array.isArray(a))return[[a]];var b=[],c=!1,d,e=a.length,f,g;for(d=0;d<e;d++)f=a[d],Array.isArray(f)?(c=!0,b.push(f)):(g=[f],b.push(g));return c||(b.length=0,b.push(a)),b},_makeArray:function(a,b,c){if(Array.isArray(a))return a;var d=[];for(var e=0;e<b;e++)d.push(a||c);return d},paint:function(a){c.canvas.IconsAttachment.superClass.paint.apply(this,arguments);if(!this.iconsNames||this.iconsNames.length==0||!this.locations)return;var b,e,f,g,h,i,j,k,l,m;for(b=0;b<this.iconsGroups.length;b++){e=this.locations[b];if(!e)continue;h=e.x,i=e.y,g=this.iconsGroups[b],j=this.colorGroups[b],k=this.iconsOrientation[b],l=this.iconsXgap[b]||1,m=this.iconsYgap[b]||1,f=0;for(var n in g){var o=null,p=null;j&&j.length>f&&(p=j[f++]);var q=d.getImageAsset(g[n]);if(q==null)continue;if(k==="right")o={x:h,y:i,width:q.getWidth(),height:q.getHeight()},h+=o.width+l;else if(k==="left")o={x:h-q.getWidth(),y:i,width:q.getWidth(),height:q.getHeight()},h-=o.width+l;else if(k==="top")o={x:h,y:i-q.getHeight(),width:q.getWidth(),height:q.getHeight()},i-=o.height+m;else{if(k!=="bottom")throw"Can not resolve '"+k+"' orientation";o={x:h,y:i,width:q.getWidth(),height:q.getHeight()},i+=o.height+m}Od(a,q.getImage(p,o.width,o.height),p,o,this._element,this._network)}}},_getIconsSize:function(a,b,c,e){var f=0,g=0,h=null,i=null,j=null;for(var k in a){i=d.getImageAsset(a[k]);if(!i)continue;if(b==="right")h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},f+=h.width+c;else if(b==="left")h={x:f-i.getWidth(),y:g,width:i.getWidth(),height:i.getHeight()},f-=h.width+c;else if(b==="top")h={x:f,y:g-i.getHeight(),width:i.getWidth(),height:i.getHeight()},g-=h.height+e;else{if(b!=="bottom")throw"Can not resolve '"+b+"' orientation";h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},g+=h.height+e}j==null?j=d.clone(h):j=p.unionRect(j,h)}return j?{width:Math.abs(j.width),height:Math.abs(j.height)}:null}}),c.canvas.EditAttachment=function(a,b){c.canvas.EditAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.canvas.EditAttachment",c.canvas.Attachment,{paint:function(a){c.canvas.EditAttachment.superClass.paint.apply(this,arguments),this._viewRect=null,this.paintResizingPoints(a),this.paintEditPoints(a),this.paintRotatePoints(a)},paintResizingPoints:function(a){var b=this.resizingPoints.size();if(b<=0)return;var d=this.resizePointSize*2,e=this.resizePointSize*2,f=this._network.getResizePointFillColor(),g=this._network.getResizePointOutlineWidth(),h=this._network.getResizePointOutlineColor(),i=this._element.getAngle(),j=this._element.getOriginalRect();a.lineWidth=g;for(var k=0;k<b;k++){var l=this.resizingPoints.get(k),m={x:l.x-this.resizePointSize,y:l.y-this.resizePointSize,width:this.resizePointSize*2,height:this.resizePointSize*2},n=this._getRotateRect(m,i,{x:j.x+j.width/2,y:j.y+j.height/2});a.save(),c.Util.rotateCanvas(a,n,i),af.rect(a,n.x,n.y,d,e),a.restore()}a.fillStyle=f,a.strokeStyle=h,a.fill(),a.stroke()},paintEditPoints:function(a){var b=this.editPoints.size();if(b<=0)return;var c=this._network.getEditPointOutlineColor(),d=this._network.getEditPointFillColor(),e=this._network.getEditPointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=0;f<b;f++){var g=this.editPoints.get(f);a.beginPath(),af.circle(a,g.x,g.y,this.editPointSize,d,c),a.closePath()}},paintRotatePoints:function(a){var b=this.rotatePoints.size();if(b<=0)return;var c=this._network.getRotatePointOutlineColor(),d=this._network.getRotatePointFillColor(),e=this._network.getRotatePointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=0;f<b;f++){var g=this.rotatePoints.get(f);a.beginPath(),af.circle(a,g.x,g.y,this.rotatePointSize,d,c),a.closePath()}},validate:function(){c.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new c.List,this.editPoints=new c.List,this.rotatePoints=new c.List,this._element instanceof c.Node&&this._addResizingPoint(this._element),this._network.isRotatable(this._element)&&this._element instanceof Ze&&!(this._element instanceof c.ShapeNode)&&!(this._element instanceof c.Grid)&&!(this._element instanceof c.Group)&&this._addRotatePoint(this._element),this._element instanceof c.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof c.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof c.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(a){var b=a.getOriginalRect();if(!b)return;var c=this._network.getResizePointSize();if(c<=0)return;var d=new Ce([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),e=this._network.getResizePointOutlineWidth(),f=this._network.getResizePointOutlineColor(),g=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,e,f,g,!0)},_addRotatePoint:function(a){var b=a.getOriginalRect();if(!b)return;var d=this._network.getRotatePointSize();if(d<=0)return;var e=d*2,f=new c.List([{x:b.x+b.width/2,y:b.y-this._network.getRotatePointOffset()-e/2}]),g=a.getAngle();g!=0&&(f=this._rotatePointList(f,g,a.getOriginalRect()));var h=f.get(0),i={x:h.x-e/2,y:h.y-e/2,width:e,height:e},j=this._network.getRotatePointOutlineWidth(),k=this.rotatePointSize+j;p.grow(b,k,k);var l=p.unionRect(a.getRect(),i);this._viewRect=p.unionRect(l,this._viewRect),this.rotatePoints=f},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addShapeLinkPoints:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(yd.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var d=new c.List;d.add(b),this._addEditPoints(d)}}},_addEditPoints:function(a){var b=p.getRect(a);if(!b)return;var c=this._network.getEditPointSize();if(c<=0)return;var d=this._network.getEditPointOutlineWidth();this._addPoints(b,a,d,!1)},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(g<0)return;var h=g+c;p.grow(a,h,h),this._viewRect=p.unionRect(a,this._viewRect),f==1?this.resizingPoints=b:this.editPoints=b},_rotatePoint:function(a,b,c){var d=p.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,d){var e=this,f=new c.List;return a.forEach(function(a){f.add(e._rotatePoint(a,b,d))}),f},_getRotateRect:function(a,b,d){var e=p.createMatrix(b*Math.PI/180,d.x,d.y),f={x:a.x+a.width/2,y:a.y+a.height/2},g=e.transform(f),h=new c.List([{x:g.x-a.width/2,y:g.y-a.height/2},{x:g.x+a.width/2,y:g.y-a.height/2},{x:g.x+a.width/2,y:g.y+a.height/2},{x:g.x-a.width/2,y:g.y+a.height/2}]);return p.getRect(h)}}),c.canvas.HTMLLabelAttachment=function(a,b){c.canvas.HTMLLabelAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=c.Util.createDiv(),this._roundDiv=c.Util.createDiv(),this._contentDiv=c.Util.createDiv(),c.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),c.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),c.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),c.Util.setCSSStyle(this._contentDiv,"pointer-events"
,"none");var d=this;this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},d.ext("twaver.canvas.HTMLLabelAttachment",c.canvas.LabelAttachment,{validate:function(){var a=this.getFont("label.font"),b=this.getLabel();this._contentDiv.innerHTML=b,this._contentDiv.style.visibility="hidden",c.canvas.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;this.getElementUI().setShadow(this,a);if(c>0||b){t.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius());if(this._pointers){var e=this._pointers;a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke());if(b){var f=this.getFillColor(),g=this.getGradient();g?t.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=this.getFont("label.font"),i=this.getLabel(),j=this._network.getViewRect().x,k=this._network.getViewRect().y,l=this._network.getZoom(),m={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},n=m.x*l-j-this._contentDiv.offsetWidth/2*l+"px",o=m.y*l-k-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=n,this._contentDiv.style.top=o,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null);if(this._network._debug){var p=this._contentRect;a.beginPath(),a.strokeStyle="blue",a.lineWidth=5,a.strokeRect(p.x,p.y,p.width,p.height),a.stroke()}},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),c.canvas.HTMLAlarmAttachment=function(a,b){c.canvas.HTMLAlarmAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=c.Util.createDiv(),this._roundDiv=c.Util.createDiv(),this._contentDiv=c.Util.createDiv(),c.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),c.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),c.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),c.Util.setCSSStyle(this._contentDiv,"pointer-events","none");var d=this;this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},d.ext("twaver.canvas.HTMLAlarmAttachment",c.canvas.AlarmAttachment,{validate:function(){var a=this.getFont("alarm.font"),b=this._network.getAlarmLabel(this._element);this._contentDiv.innerHTML=b,this._contentDiv.style.visibility="hidden",c.canvas.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),d=this.getOutlineWidth(),e=this._contentRect;this.getElementUI().setShadow(this,a);if(d>0||b){t.drawRoundRect(a,e.x,e.y,e.width,e.height,this.getCornerRadius());if(this._pointers){var f=this._pointers;a.moveTo(f[0].x,f[0].y),a.lineTo(f[1].x,f[1].y),a.lineTo(f[2].x,f[2].y)}a.closePath(),d>0&&(a.lineWidth=d,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke());if(b){var g=this.getFillColor(),h=this.getGradient();h?t.fill(a,g,h,this.getGradientColor(),this._viewRect):a.fillStyle=g,a.fill()}}var i=this.getFont("alarm.font"),j=this._network.getAlarmLabel(this._element),k=this._network.getViewRect().x,l=this._network.getViewRect().y,m=this._network.getZoom(),n={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},o=n.x*m-k-this._contentDiv.offsetWidth/2*m+"px",p=n.y*m-l-this._contentDiv.offsetHeight/2*m+"px";this._contentDiv.style.left=o,this._contentDiv.style.top=p,this._contentDiv.style.setProperty("-webkit-transform","scale("+m+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null);if(this._network._debug){var q=this._contentRect;a.beginPath(),a.strokeStyle="blue",a.lineWidth=5,a.strokeRect(q.x,q.y,q.width,q.height),a.stroke()}c.canvas.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),c.canvas.interaction.BaseInteraction=function(a){this.network=a},d.ext("twaver.canvas.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(a){var b=a.x*this.network.getZoom()-this.network.getViewRect().x,c=a.y*this.network.getZoom()-this.network.getViewRect().y;return{x:b,y:c}},convertFromUIToMarkerRect:function(a,b,c){var d=this.network.getZoom();return{x:a.x*d-this.network.getViewRect().x+b*d,y:a.y*d-this.network.getViewRect().y+c*d,width:a.width*d,height:a.height*d}},getMarkerPoint:function(a){var b;if(m.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=a.changedTouches[0];return b={x:c.clientX,y:c.clientY},b}return m.isFirefox?b={x:a.layerX,y:a.layerY}:b={x:a.offsetX,y:a.offsetY},b},paint:function(a){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];s.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)s.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){if(a.button!==0)return;this._startLogical=this.network.getLogicalPoint(a),this._startClient=s.getClientPoint(a),this._startLogical&&s.handle_mousedown(this,a)},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),c.canvas.interaction.SelectInteraction=function(a){c.canvas.interaction.SelectInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.SelectInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(a){if(this.startPoint==null||this.endPoint==null)return;var b=this.convertPointFromView(this.startPoint),c=this.convertPointFromView(this.endPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=p.getRect([{x:d,y:e},{x:f,y:g}]);if(h!=null){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,af.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}},handle_mousedown:function(a){if(!this.network.isValidEvent(a)||this.network.isMovingElement()||this.network.isEditingElement())return;if(a.shiftKey)return;var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?d.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(d.isCtrlDown(a)||c.clearSelection(),this.end(a),this.startPoint=this.network.getLogicalPoint(a),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener("mousemove"))},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isMovingElement()||this.network.isEditingElement()){this.end(a);return}var b=this.network.getLogicalPoint(a);if(!b)return;this.network.setSelectingElement(!0),this.endPoint==null?this.network.fireInteractionEvent({kind:"selectStart",event:a}):this.network.fireInteractionEvent({kind:"selectBetween",event:a}),this.endPoint=b,this.repaint()},end:function(a){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var b=p.getRect([this.startPoint,this.endPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}this.network.setSelectingElement(!1),this.removeListener("mousemove"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y}}),c.canvas.interaction.MoveInteraction=function(a,b){this.lazyMode=b,c.canvas.interaction.MoveInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.MoveInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","keydown","mouseout"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","keydown","mouseout"),this.end(),this.network.removeMarker(this)},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup")},handle_keyup:function(a){this.currentKeyEvent=null,this.removeListener("keyup")},isParenting:function(){return this.pressPoint&&this.currentKeyEvent!=null&&this.currentKeyEvent.keyCode===80},parentProcess:function(a,b){var c=null;this.parent=null;var d=this;if(!b&&this.isParenting()){var e={},f=this.network.getLogicalPoint(a);e.x=f.x-1,e.y=f.y-1,e.width=2,e.height=2;var g=this.network.getElementsAtRect(e,!0);if(g&&g.size()>0){var h=g.size();for(var i=0;i<h;i++){var j=g.get(i);if(!d.network.getElementBox().getSelectionModel().contains(j)){d.parent=j;break}}}}else this.parent=null;this.parent!=null&&(c=this.network.getElementUI(this.parent).getViewRect()),c!=null&&!b?this.parentRect=c:this.parentRect=null},paint:function(a){if(this.lazyMode){if(this.pressPoint==null||this.dragPoint==null)return;a.beginPath();var b=this.dragPoint.x-this.pressPoint.x,c=this.dragPoint.y-this.pressPoint.y,d=this.network.getMovableSelectedElements(),e=d.size(),f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,g=this.network.getLazyMoveOutlineWidth(),h=this.network.getLazyMoveOutlineColor();a.strokeStyle=h,a.lineWidth=g,a.fillStyle=f;for(var i=0;i<e;i++){var j=d.get(i),k=this.network.getElementUI(j);if(k){var l=this.convertFromUIToMarkerRect(k.getViewRect(),b,c);af.rect(a,l.x,l.y,l.width,l.height)}}a.fill(),a.stroke()}if(this.parentRect){a.beginPath();var f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,g=this.network.getLazyMoveOutlineWidth(),h=this.network.getLazyMoveOutlineColor();a.strokeStyle=h,a.lineWidth=g,a.fillStyle=f;var l=this.parentRect;af.rect(a,l.x,l.y,l.width,l.height),a.fill(),a.stroke()}},handle_mousedown:function(a){if(a.button!==0)return;if(!this.network.isValidEvent(a)||this.network.isSelectingElement()||this.network.isEditingElement())return;var b=this.network.getElementAt(a);if(!this.network.isMovable(b))return;this.end(a),this.lastPoint=this.network.getLogicalPoint(a),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener("mousemove")},handle_mouseup:function(a){this.end(a)},handle_mouseout:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()){this.end(a);return}var b=this.network.getLogicalPoint(a);if(!b)return;if(!this.lastPoint)return;this.xoffset=b.x-this.lastPoint.x,this.yoffset=b.y-this.lastPoint.y;if(Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?this.dragPoint==null?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a}):(this.network.moveSelectedElements(this.xoffset,this.yoffset),this.lastPoint=b,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))),this.parentProcess(a,!1),this.lazyMode&&(this.dragPoint=b),(this.lazyMode||this.isParenting())&&this.repaint()},end:function(a){if(this.lazyMode){if(this.dragPoint!=null&&this.pressPoint!=null){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.network.setMovingElement(!1)},d=this.dragPoint.x-this.pressPoint.x,e=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(d,e,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){this.parent==null&&(this.parent=this.network.getCurrentSubNetwork());var b=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(b.parent)},this.network)}this.parentProcess(a,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.removeListener("mousemove"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),c.canvas.interaction.ScrollInteraction=function(a){c.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,a),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},d.ext("twaver.canvas.interaction.ScrollInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout"),m.isFirefox?s.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):s.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),s.addEventListener("mouseup","handleMouseUp",a,this),s.addEventListener("mousemove","handleMouseMove",a,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout"),m.isFirefox?s.removeEventListener("DOMMouseScroll",this.network.getView(),this):s.removeEventListener("mousewheel",this.network.getView(),this),s.removeEventListener("mouseup",a,this),s.removeEventListener("mousemove",a,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.network.removeMarker(this)},handleViewRectChange:function(a){(a.property=="viewRect"||a.property=="canvasSizeChange")&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){this.hThumbRect=null,this.vThumbRect=null;if(this.network.isScrollBarVisible()==0){this.repaint();return}var a=this.network.getViewRect().height,b=this.network.getViewRect().width,c=this.network.getViewRect().x,d=this.network.getViewRect().y,e=this.network.getCanvasSize(),f=e.width,g=e.height;if(f>b)if(c<0||c+b>f){this.repaint();return}if(g>a)if(d<0||d+a>g){this.repaint();return}var h=0,i=a<g,j=b<f,k=this.getScrollBarWidth();if(a<g){j?h=a*(a-k)/g:h=a*a/g;var l=d/(g-a)*(a-h-k);this.vThumbRect={x:b-k,y:l,width:k,height:h}}var m=0;if(b<f){i?m=b*(b-k)/f:m=b*b/f;var n=c/(f-b)*(b-m-k);this.hThumbRect={x:n,y:a-k,width:m,height:k}}this.network.setHScrollBarVisible(this.hThumbRect!=null),this.network.setVScrollBarVisible(this.vThumbRect!=null),this.repaint()},scrollXOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d+f,e,c,b)},scrollYOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d,e+f,c,b)},handle_mousedown:function(a){if(this.network.isValidEvent(a)==1)return;var b=this.getMarkerPoint(a);this.hBarDownPoint=null,this.vBarDownPoint=null,this.vThumbRect!=null&&p.containsPoint(this.vThumbRect,b.x,b.y)&&(this.vBarDownPoint={x:a.screenX,y:a.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),this.hThumbRect!=null&&p.containsPoint(this.hThumbRect,b.x,b.y)&&(this.hBarDownPoint={x:a.screenX,y:a.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)},handle_mouseover:function(a){if(this.scrollBarVisible==1)return;this.scrollBarVisible=!0,this.repaint()},handle_mouseout:function(a){if(this.scrollBarVisible==0)return;this.scrollBarVisible=!1,this.repaint()},handleMouseUp:function(a){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(a){var b={x:a.screenX,y:a.screenY},c=this.network.getCanvasSize(),d=this.network.getViewRect().height,e=this.network.getViewRect().width,f=this.getScrollBarWidth();if(this.hBarDownPoint!=null){var g=b.x-this.hBarDownPoint.x;this.hBarDownPoint=b,this.network.setViewOffSet(g*c.width/(e-f),0);return}if(this.vBarDownPoint!=null){var h=b.y-this.vBarDownPoint.y;this.vBarDownPoint=b,this.network.setViewOffSet(0,h*c.height/(d-f));return}},handleMouseWheel:function(a){var b=!1,c=!1;a.wheelDelta!==a.wheelDeltaX?(a.wheelDelta?a.wheelDelta>0&&(b=!0):a.detail<0&&(b=!0),this.scrollYOffset(b)):(a.wheelDelta?a.wheelDelta>0&&(b=!0):a.detail<0&&(b=!0),this.scrollYOffset(b))},paintRoundRect:function(a,b,c,d,e,f,g,h){a.beginPath(),a.globalAlpha=c,a.fillStyle=b,t.drawRoundRect(a,d,e,f,g,h),a.fill()},paint:function(a){if(this.network.isScrollBarVisible()==0)return;if(this.scrollBarVisible==0&&this.hBarDownPoint==null&&this.vBarDownPoint==null)return;var b=this.getScrollBarWidth(),c=this.network.getViewRect().height,d=this.network.getViewRect().width;a.save();var e,f=this.getScrollBarColor();this.hThumbRect!=null&&(e=a.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,0,c-b,d-b,b,b/2),this.paintRoundRect(a,e,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),this.vThumbRect!=null&&(e=a.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,d-b,0,b,c-b,b/2),this.paintRoundRect(a,e,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),a.restore()}}),c.canvas.interaction.DefaultInteraction=function(a){c.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.DefaultInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;this.network.isFocusOnClick()&&c.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);a.detail===2?this.handleDoubleClicked(a,b):this.handleClicked(a,b)},handleClicked:function(a,b){Dd.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){Dd.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){Dd.handleKeyDown(this.network,a)},handle_mousemove:function(a){var b=this.network.getElementAt(a),c=this._preElement,d=Ed(c),e=Ed(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this.network),this.network.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this.network),this.network.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this.network),this.network.onMouseMove(b,a),this._preElement=b}}),c.canvas.interaction.PanInteraction=function(a){c.canvas.interaction.PanInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.PanInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown","mouseup")},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;this.lastPoint=this.getMarkerPoint(a),this.lastPoint&&(this.addListener("mousemove"),this.network.getView().style.cursor="pointer")},handle_mouseup:function(a){this._clear()},handle_mousemove:function(a){if(!this.lastPoint)return;var b=this.getMarkerPoint(a);if(!b)return;var c=b.x-this.lastPoint.x,d=b.y-this.lastPoint.y;this.network.panByOffset(-c,-d),this.lastPoint=b},_clear:function(a){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener("mousemove"))}}),c.canvas.interaction.CreateElementInteraction=function(a,b){b||(b=c.Node),c.Util.isTypeOf(b,c.Node)?this.elementFunction=function(a){var d=new b;return d instanceof c.Node&&d.setCenterLocation(a),d}:this.elementFunction=b,c.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.CreateElementInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),c.canvas.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,this.editPointSize=a.getEditPointSize(),this.resizePointSize=a.getResizePointSize(),this.rotatePointSize=a.getRotatePointSize(),c.canvas.interaction.EditInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.EditInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(a){if(this.lazyMode==1&&this.resizingRect!=null){a.lineWidth=this.network.getResizeLineWidth();var b=this.convertFromUIToMarkerRect(this.resizingRect,0,0);a.save(),c.Util.rotateCanvas(a,b,this.node.getAngle()),a.beginPath(),af.rect(a,b.x,b.y,b.width,b.height,null,this.network.getResizeLineColor()),a.restore()}this.isStartRotate&&this.showRotateScale(a)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(a.button!==0)return;if(d.isAltDown(a)&&!this.network.isEditingElement()){var b=this.network.getElementAt(a),e=this.network.getLogicalPoint(a);if(b instanceof c.ShapeNode){var f=this.getPointIndex(b.getPoints(),e,!0);f>0&&(this._handle_mousedown(a),this.pointIndex=f,this.shapeNode=b,b.addPoint(e,f),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:f}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:f}))}if(b instanceof c.ShapeLink){var g=new c.List(b.getPoints()),h=this.network.getElementUI(b);g.add(h.getFromPoint(),0),g.add(h.getToPoint());var f=this.getPointIndex(g,e)-1;f>0&&(this._handle_mousedown(a),this.pointIndex=f,this.shapeLink=b,b.addPoint(e,f),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:f}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:f}))}return}if(!this.network.isEditingElement()||this.isStart||this.isStartRotate)return;this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?d.isAltDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?d.isAltDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a))},handle_mouseup:function(a){if(this.isStart){var b=this.network.getLogicalPoint(a);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var d=this,e=new c.animate.AnimateBounds(this.node,this.resizingRect,function(){d.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:d.node,resizeDirection:d.resizeDirection})});c.animate.AnimateManager.start(e)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&b?(this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.clear()},handle_mousemove:function(a){if(!this.network.isValidEvent(a))return;if(this.isStartRotate&&this.node){this._handleRotateElement(a,this.node),this.network.isShowRotateScale()&&this.repaint();return}if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(a);return}if(this.shapeLink&&this.pointIndex>=0){this._handleMovingShapeLinkPoint(a);return}if(this.node&&this.resizeDirection){this._handleResizing(a);return}if(this.linkUI){this._handleMovingLinkControlPoint(a);return}}if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var b=this.network.getElementAt(a),d=this.network.getElementUI(b);if(!d||!d.getEditAttachment()){this.clear();return}var e=this.network.getLogicalPoint(a);if(b instanceof c.Node){this.node=b;if(this._isEditingShapeNode(e)||this._isResizingNode(e)){this.network.setEditingElement(!0);return}if(this._isRotatingElement(e)){this.network.setRotatingElement(!0),this.network.setEditingElement(!0);return}}else if(b instanceof c.ShapeLink){this.shapeLink=b;if(this._isEditingShapeLink(e)){this.network.setEditingElement(!0);return}}else if(d instanceof c.canvas.LinkUI&&yd.isOrthogonalLink(d._element)){this.linkUI=d;var f=this.linkUI.getControlPoint();f&&this._contains(e,f,this.editPointSize)&&(this._setCrossCursor(),this.network.setEditingElement(!0));return}this.clear()},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(b<=0)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle();return this._isRotating(a,"crosshair",c,d)},_isRotating:function(a,b,c,d){var e=this.network.getRotatePointSize(),f={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-e},g=this._rotatePoint(f,d,c),h={x:g.x-e,y:g.y-e,width:e*2,height:e*2};return p.containsPoint(h,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=b.getCenterLocation();return Math.round(Math.atan2(c.x-a.x,a.y-c.y)*180/Math.PI+180)},_handleMovingShapeNodePoint:function(a){var b=this.network.getLogicalPoint(a);this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){var b=this.network.getLogicalPoint(a);this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this.linkUI.setControlPoint(this.network.getLogicalPoint(a)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0};this.resizeDirection==="northwest"&&(this._transformPoint(i,f,b),g.x=this._endLogical.x,g.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y});if(this.resizeDirection==="north"){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),k.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}this.resizeDirection==="northeast"&&(this._transformPoint(h,f,b),j.x=this._endLogical.x,j.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y});if(this.resizeDirection==="west"){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),n.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if(this.resizeDirection==="east"){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),l.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}this.resizeDirection==="southwest"&&(this._transformPoint(j,f,b),h.x=this._endLogical.x,h.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y});if(this.resizeDirection==="south"){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),m.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}this.resizeDirection==="southeast"&&
(this._transformPoint(g,f,b),i.x=this._endLogical.x,i.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){if(this.node instanceof c.ShapeNode){this.shapeNode=this.node;var b=this.shapeNode.getPoints();for(var d=0,e=b.size();d<e;d++){var f=b.get(d);if(this._contains(a,f,this.editPointSize))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){var b=this.shapeLink.getPoints();for(var c=0,d=b.size();c<d;c++){var e=b.get(c);if(this._contains(a,e,this.editPointSize))return this._setCrossCursor(),this.pointIndex=c,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(b<=0)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle(),e={x:c.x,y:c.y},f=this._rotatePoint(e,d,c);return this._isResizing(a,f.x,f.y,"northwest","nwse-resize")?!0:(e={x:c.x+c.width/2,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"north","ns-resize")?!0:(e={x:c.x+c.width,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"northeast","nesw-resize")?!0:(e={x:c.x,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"west","ew-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"east","ew-resize")?!0:(e={x:c.x,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southwest","nesw-resize")?!0:(e={x:c.x+c.width/2,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"south","ns-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=p.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){return this._contains(a,{x:b,y:c},this.resizePointSize)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=a<c?a:c,f=b<d?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:c*2,height:c*2};return p.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;var d=a.get(0),e;for(var f=1;f<a.size();f++){e=a.get(f);if(this.isPointOnLine(b,d,e,6))return f;d=e}return d=a.get(0),c&&this.isPointOnLine(b,d,e,6)?a.size():0},showRotateScale:function(a){var b=new c.List,e=this.network.getRotateScaleWidth(),f=this.network.getRotateScaleHeight(),g=this.network.getRotatePointSize(),h=this.node.getAngle(),i=this.node.getOriginalRect(),j={x:i.x+i.width/2,y:i.y-this.network.getRotatePointOffset()-g},k=this._rotatePoint(j,h,i),l,m="13px Arial",n=h+"°",o,p,q,r;this.node.getAngle()>=0&&this.node.getAngle()<=180?(o={x:k.x+g,y:k.y},p={x:o.x+e,y:o.y},q={x:p.x,y:p.y-f},r={x:o.x,y:q.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(o={x:k.x-g,y:k.y},p={x:o.x-e,y:o.y},q={x:p.x,y:p.y-f},r={x:o.x,y:q.y});var s=new c.List([o,p,q,r]),l=d.math.getRect(s);a.fillStyle=this.network.getRotateScaleFillColor(),a.fillRect(l.x,l.y,l.width,l.height),a.fillStyle=this.network.getRotateScaleFontColor(),a.textBaseline="middle",a.textAlign="center",a.font=m,a.fillText(n,l.x+l.width/2,l.y+l.height/2)},isPointOnLine:function(a,b,c,d){d<0&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return e<=d&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}if(b>=360||b<=-360)b%=360;return b>22.5&&b<=67.5&&(c+=1),b<-22.5&&b>=-67.5&&(c-=1),b>67.5&&b<=112.5&&(c+=2),b<-67.5&&b>=-112.5&&(c-=2),b>112.5&&b<=157.5&&(c+=3),b<-112.5&&b>=-157.5&&(c-=3),b>157.5&&b<=202.5&&(c+=4),b<-157.5&&b>=-202.5&&(c-=4),b>202.5&&b<=247.5&&(c+=5),b<-202.5&&b>=-247.5&&(c-=5),b>247.5&&b<=292.5&&(c+=6),b<-247.5&&b>=-292.5&&(c-=6),b>292.5&&b<=337.5&&(c+=7),b<-292.5&&b>=-337.5&&(c-=7),c>8&&(c-=8),c<=0&&(c+=8),d[c]}}),c.canvas.interaction.CreateLinkInteraction=function(a,b){b||(b=c.Link),c.Util.isTypeOf(b,c.Link)?this.linkFunction=function(a,d){var e=new b;return e instanceof c.Link&&(e.setFromNode(a),e.setToNode(d)),e}:this.linkFunction=b,c.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.CreateLinkInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(a){a.beginPath();var b,c;a.lineWidth=this.network.getEditLineWidth();var d=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(b=this.network.getElementUI(this.currentNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),af.rect(a,c.x,c.y,c.width,c.height,null,d)),this.fromNode&&(b=this.network.getElementUI(this.fromNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),af.rect(a,c.x,c.y,c.width,c.height,null,d)),this.currentPoint&&this.paintLine(a),a.closePath()},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.convertPointFromView(this.fromNode.getCenterLocation()),d=c.x,e=c.y,f=this.currentPoint.x,g=this.currentPoint.y;a.strokeStyle=b,a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(!b)return;if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.repaint()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.repaint()))},getFromNode:function(a){return this.getNode(a)},getToNode:function(a){return this.getNode(a)},getNode:function(a){var b=this.network.getElementAt(a);return b instanceof Ze&&this.network.isLinkable(b)?b:null}}),c.canvas.interaction.CreateShapeLinkInteraction=function(a,b){c.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=c.ShapeLink),c.Util.isTypeOf(b,c.ShapeLink)?this.linkFunction=function(a,d,e){var f=new b;return f instanceof c.ShapeLink&&(f.setFromNode(a),f.setToNode(d),e&&f.setPoints(e)),f}:this.linkFunction=b},d.ext("twaver.canvas.interaction.CreateShapeLinkInteraction",c.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,c.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var d=this.createLink();d&&this.network.addElementByInteraction(d),this.clear()}else{this.points||(this.points=new c.List);if(this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()},paintLine:function(a){if(this.currentPoint){var b=new c.List,d;d=this.convertPointFromView(this.fromNode.getCenterLocation()),b.add(d,0);if(this.points&&this.points.size()>0){var e=this.points.size();for(var f=0;f<e;f++)d=this.convertPointFromView(this.points.get(f)),b.add(d)}d=this.currentPoint,b.add(d),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),t.drawLinePoints(a,b),a.stroke()}}}),c.canvas.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=c.ShapeNode),c.Util.isTypeOf(b,c.ShapeNode)?this.shapeNodeFunction=function(a){var d=new b;return d instanceof c.ShapeNode&&a&&d.setPoints(a),d}:this.shapeNodeFunction=b,c.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.CreateShapeNodeInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){var b=new c.List,d=this.points.size(),e;for(var f=0;f<d;f++)e=this.convertPointFromView(this.points.get(f)),b.add(e);e=this.convertPointFromView(this.currentPoint),b.add(e),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),t.drawLinePoints(a,b),a.stroke()}},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(!b)return;if(a.detail===2){if(this.points){var d=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(d),this.clear();var e=this;setTimeout(function(){e.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new c.List);if(this.points.size()>0){var f=this.points.get(this.points.size()-1);if(f.x===b.x&&f.y===b.y)return}this.points.add(b)}this.repaint()},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint(a),this.repaint())}}),c.canvas.interaction.MagnifyInteraction=function(a,b,d,e,f){c.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.zoom=b||2,this.xRadius=d||100,this.yRadius=e||100,this.shape=f||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=s.createCanvas()},d.ext("twaver.canvas.interaction.MagnifyInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.network.removeMarker(this)},paint:function(a){if(!this.point)return;var b=this.network._zoom,c=this.zoom*b,d=this.point.x*b-this.network.viewRect.x-this.xRadius,e=this.point.y*b-this.network.viewRect.y-this.yRadius,f=this.xRadius*2,g=this.yRadius*2,h={x:this.point.x-this.xRadius/c,y:this.point.y-this.yRadius/c,width:f/c,height:g/c},i=this.borderWidth,j=s.createCanvas();j.width=f,j.height=g,this.network.toCanvasByRegion(h,c,j),a.save(),a.beginPath(),t.drawVector(a,this.shape,null,d,e,f,g),a.clip(),a.fillStyle=this.backgroundColor,a.beginPath(),a.rect(d,e,f,g),a.fill(),a.drawImage(j,d,e),a.restore(),a.beginPath(),a.lineWidth=i,t.drawVector(a,this.shape,null,d+i/2,e+i/2,f-i,g-i),a.strokeStyle=this.borderColor,a.stroke()},handle_mousemove:function(a){this.point=this.network.getLogicalPoint(a);if(!this.point)return;this.repaint()},getZoom:function(){return this.zoom},setZoom:function(a){this.zoom=a,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.network.repaintTopCanvas()}}),c.canvas.interaction.TouchInteraction=function(a){c.canvas.interaction.TouchInteraction.superClass.constructor.call(this,a)},d.ext("twaver.canvas.interaction.TouchInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();s.addEventListener("touchstart","handleTouchstart",a,this),s.addEventListener("touchmove","handleTouchmove",a,this),s.addEventListener("touchend","handleTouchend",a,this),s.addEventListener("touchcancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();s.removeEventListener("touchstart",this.network.getView(),this),s.removeEventListener("touchmove",a,this),s.removeEventListener("touchend",a,this),s.removeEventListener("touchcancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){s.preventDefault(a);if(a.touches&&a.touches.length==1){var b=this.network.getLogicalPoint(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b,this._startTouchClient=this.getMarkerPoint(a),c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Dd.handleLongClicked(self.network,a,c)},1e3)}else a.touches&&a.touches.length==2&&(this._distance=Ad.getDistance(a),this._zoom=this.network.getZoom());this._touchCount=a.touches.length},handleTouchmove:function(a){s.preventDefault(a);if(this._touchCount==2&&a.touches&&a.touches.length==2){this.timer&&clearTimeout(this.timer);if(Math.abs(this._distance-Ad.getDistance(a))>=Se.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var b=Ad.getDistance(a)/this._distance;this.network.setTouchZoom(this._zoom*b,!1)}else{var c=this.getMarkerPoint(a),d=this._startTouchClient.x-c.x,e=this._startTouchClient.y-c.y;this.network.panByOffset(d,e),this._startTouchClient=c}}else if(this._touchCount==1&&a.touches&&a.touches.length==1)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var f=this.network.getLogicalPoint(a),g=this.network.getElementAt(f);if(this.network.isMovingElement()||this._startTouchElement!=null&&this._startTouchElement==g&&this.network.getMovableSelectedElements().contains(g)){var d=f.x-this._startTouchPoint.x,e=f.y-this._startTouchPoint.y;if(Math.abs(d)>=Se.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Se.TOUCH_MOVE_THRESHOLD)this._startTouchPoint=f,this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}),this.timer&&clearTimeout(this.timer))}else{var d=f.x-this._startTouchPoint.x,e=f.y-this._startTouchPoint.y;(Math.abs(d)>=Se.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Se.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer);var c=this.getMarkerPoint(a),d=this._startTouchClient.x-c.x,e=this._startTouchClient.y-c.y;this.network.panByOffset(d,e),this._startTouchClient=c}}else{var h=this.network.getLogicalPoint(a);if(!h)return;var d=h.x-this._startTouchPoint.x,e=h.y-this._startTouchPoint.y;Math.abs(d)>=Se.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(e)>=Se.TOUCH_RECT_SELECT_THRESHOLD&&(this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.timer&&clearTimeout(this.timer)),this._moveTouchPoint=h,this.repaint())}},handleTouchend:function(a){s.preventDefault(a);if(this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=p.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){this._zoomFlag=!1;var f=new Date,g=this.network.getLogicalPoint(a),h=this.network.getElementAt(this._startTouchPoint);g&&f.getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,g)<=20&&(h?this.network.getSelectionModel().contains(h)||this.network.getSelectionModel().setSelection(h):this.network.getSelectionModel().clearSelection(),Dd.handleClicked(this.network,a,h),this.timer&&clearTimeout(this.timer),this._endTouchTime&&f.getTime()-this._endTouchTime.getTime()<=500&&p.getDistance(this._endTouchPoint,g)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Dd.handleDoubleClicked(this.network,a,h)):(this._endTouchTime=f,this._endTouchPoint=g))}},paint:function(a){if(!this._startTouchPoint||!this._moveTouchPoint)return;var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=p.getRect([{x:d,y:e},{x:f,y:g}]);if(h!=null){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,af.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),c.canvas.interaction.MSTouchInteraction=function(a){c.canvas.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},d.ext("twaver.canvas.interaction.MSTouchInteraction",c.canvas.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();s.addEventListener("MSPointerDown","handleTouchstart",a,this),s.addEventListener("MSPointerMove","handleTouchmove",a,this),s.addEventListener("MSPointerUp","handleTouchend",a,this),s.addEventListener("MSPointerCancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();s.removeEventListener("MSPointerDown",a,this),s.removeEventListener("MSPointerMove",a,this),s.removeEventListener("MSPointerUp",a,this),s.removeEventListener("MSPointerCancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){this.network.isFocusOnClick()&&c.Util.setFocus(this.network._view);if(this.network.isSelectingElement()&&a.pointerType==a.MSPOINTER_TYPE_MOUSE)return;var b=this.network.getLogicalPoint(a),e=new Date;a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a);if(this._pointerIdArray.length==1){var f=this.network.getElementAt(b);this._startTouchElement=f,this._startClientPoint={x:a.clientX,y:a.clientY},Dd.handleClicked(this.network,a,f),this._startTouchTime&&this._startTouchPoint&&e.getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,b)<=20?(Dd.handleDoubleClicked(this.network,a,f),this._doubleClick=!0):(s.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=e);var g=this.network.getSelectionModel();f?d.isCtrlDown(a)?g.contains(f)?g.removeSelection(f):g.appendSelection(f):g.contains(f)||g.setSelection(f):d.isCtrlDown(a)||g.clearSelection()}else this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(this._startTouchPoint==null||this._pointerIdArray.length==0||!this._pointerMap[a.pointerId]||p.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)return;this._pointerMap[a.pointerId]=a;if(this._pointerIdArray.length==2){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.network.isSelectingElement()){var b=p.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);var f=-1;for(var g=0;g<this._pointerIdArray.length;g++)if(this._pointerIdArray[g]==a.pointerId){f=g;break}f>=0&&this._pointerIdArray.splice(f,1),delete this._pointerMap[a.pointerId],this._startTouchPoint=null,this._moveTouchPoint=null},_getDistance:function(){return p.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){var b={x:a.clientX,y:a.clientY};if(p.getDistance(this._startClientPoint,b)<3)return;if(this._startTouchPoint&&this._pointerIdArray.length==1){this._moveTouchPoint={x:this._startTouchPoint.x+(b.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(b.y-this._startClientPoint.y)/this.network.getZoom()};if(this._startTouchElement==null&&this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint(a);if(!c)return;this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.repaint()}else{var d=this.network.getElementAt(this._moveTouchPoint);if(this._startTouchElement==null&&!this.network.isRectSelectEnabled()){var e=this._startClientPoint.x-b.x,f=this._startClientPoint.y-b.y;this.network.panByOffset(e,f)}else if(this.network.isMovingElement()||this._startTouchElement!=null&&d==this._startTouchElement&&this.network.getMovableSelectedElements().contains(d)){var e=this._moveTouchPoint.x-this._startTouchPoint.x,f=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}this._startClientPoint=b}}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}},paint:function(a){if(!this._startTouchPoint||!this._moveTouchPoint||this._startTouchElement||!this.network.isRectSelectEnabled())return;var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=p.getRect([{x:d,y:e},{x:f,y:g}]);if(h!=null){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,af.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}});var bf=function(a,b){d.registerImage(a,b),cf[a]=1},cf={};bf("node_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,23.5c0,0.276-0.224,0.5-0.5,0.5h-31C0.224,24,0,23.776,0,23.5v-2C0,21.224,0.224,21,0.5,21h31  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"15.9995",y1:"21",x2:"15.9995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,22.3c0-0.165-0.134-0.3-0.3-0.3H3.3C3.134,22,3,22.135,3,22.3V24h12V22.3z",gradient:{id:"SVGID_2_",type:"linear",x1:"9",y1:"22",x2:"9",y2:"25",stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"}]}},{shape:"path",data:"M31,20H1V1c0-0.553,0.448-1,1-1h28c0.553,0,1,0.447,1,1V20z",gradient:{id:"SVGID_3_",type:"linear",x1:"15.9995",y1:"-0.1221",x2:"15.9995",y2:"19.9471",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:1,w:28,h:18,fill:"#FFFFFF"},{shape:"rect",x:3,y:2,w:26,h:16,gradient:{id:"SVGID_4_",type:"linear",x1:"15.9995",y1:"2.0654",x2:"15.9995",y2:"17.3835",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"9.649,17.034 6.815,17.034 9.935,2.966 12.768,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"12.065,17.034 10.815,17.034 13.935,2.966 15.185,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"14.065,17.034 13.315,17.034 16.435,2.966 17.185,2.966 z",fill:"#FFFFFF"}]}),bf("group_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,16.5c0,0.276-0.224,0.5-0.5,0.5h-24C7.224,17,7,16.776,7,16.5v-1C7,15.224,7.224,15,7.5,15h24   c0.276,0,0.5,0.224,0.5,0.5V16.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"19.5",y1:"15",x2:"19.5",y2:"17",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M19,16.5c0-0.277-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.223-0.5,0.5V17h9V16.5z",gradient:{id:"SVGID_2_",type:"linear",x1:"14.4995",y1:"15.9209",x2:"14.4995",y2:"17.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,14H8V1c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V14z",gradient:{id:"SVGID_3_",type:"linear",x1:"19.5",y1:"0",x2:"19.5",y2:"14.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:1,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:10,y:2,w:19,h:10,gradient:{id:"SVGID_4_",type:"linear",x1:"19.5",y1:"1.9619",x2:"19.5",y2:"11.9744",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M25,23.5c0,0.276-0.224,0.5-0.5,0.5h-24C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h24   c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:"12.4995",y1:"22",x2:"12.4995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,23.5c0-0.277-0.224-0.5-0.5-0.5h-8C3.224,23,3,23.223,3,23.5V24h9V23.5z",gradient:{id:"SVGID_6_",type:"linear",x1:"7.5",y1:"22.9209",x2:"7.5",y2:"24.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M24,21H1V8c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V21z",gradient:{id:"SVGID_7_",type:"linear",x1:"12.4995",y1:"7",x2:"12.4995",y2:"21.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:8,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:3,y:9,w:19,h:10,gradient:{id:"SVGID_8_",type:"linear",x1:"12.4995",y1:"8.9619",x2:"12.4995",y2:"18.9749",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}}]}),bf("subnetwork_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,14.499c0,0.276-0.224,0.5-0.5,0.5h-20c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h20c0.276,0,0.5,0.224,0.5,0.5V14.499z",gradient:{id:"SVGID_1_",type:"linear",x1:21.5,y1:12.999,x2:21.5,y2:14.9995,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M22,14.499c0-0.277-0.224-0.5-0.5-0.5h-7c-0.276,0-0.5,0.223-0.5,0.5v0.5h8V14.499z",gradient:{id:"SVGID_2_",type:"linear",x1:18,y1:13.9199,x2:18,y2:15.0449,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,11.499c0,0.276-0.224,0.5-0.5,0.5h-18c-0.276,0-0.5-0.224-0.5-0.5v-11c0-0.276,0.224-0.5,0.5-0.5  h18c0.276,0,0.5,0.224,0.5,0.5V11.499z",gradient:{id:"SVGID_3_",type:"linear",x1:21.5,y1:-0.9502,x2:21.5,y2:12.5498,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:13,y:.999,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:14,y:1.999,w:15,h:8,gradient:{id:"SVGID_4_",type:"linear",x1:21.5,y1:1.9312,x2:21.5,y2:9.6537,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M21,23.5c0,0.276-0.224,0.5-0.5,0.5h-20C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h20  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:10.4995,y1:22,x2:10.4995,y2:24,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:22,y:20.5,w:3,h:1.999,gradient:{id:"SVGID_6_",type:"linear",x1:-464.9424,y1:-722.2754,x2:-462.9424,y2:-722.2754,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:28,y:16,w:2,h:3,gradient:{id:"SVGID_7_",type:"linear",x1:29,y1:16,x2:29,y2:19,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M11,23.5c0-0.277-0.224-0.5-0.5-0.5h-7C3.224,23,3,23.223,3,23.5V24h8V23.5z",gradient:{id:"SVGID_8_",type:"linear",x1:7,y1:22.9209,x2:7,y2:24.0459,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M20,20.5c0,0.276-0.224,0.5-0.5,0.5h-18C1.224,21,1,20.776,1,20.5v-11C1,9.224,1.224,9,1.5,9h18  C19.776,9,20,9.224,20,9.5V20.5z",gradient:{id:"SVGID_9_",type:"linear",x1:10.4995,y1:8.0508,x2:10.4995,y2:21.5513,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:10,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:3,y:11,w:15,h:8,gradient:{id:"SVGID_10_",type:"linear",x1:10.4995,y1:10.9321,x2:10.4995,y2:18.6551,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"M32,22.7c0,0.165-0.135,0.3-0.301,0.3h-5.4C26.134,23,26,22.865,26,22.7v-2.4  c0-0.165,0.134-0.3,0.299-0.3h5.4C31.865,20,32,20.135,32,20.3V22.7z",gradient:{id:"SVGID_11_",type:"linear",x1:29,y1:20,x2:29,y2:23,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),bf("bus_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:4,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M7,4c0,0.552-0.448,1-1,1H3C2.448,5,2,4.552,2,4V3c0-0.552,0.448-1,1-1h3c0.552,0,1,0.448,1,1V4z",gradient:{id:"SVGID_1_",type:"linear",x1:4.5,y1:2,x2:4.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M6,5.5C6,5.776,5.776,6,5.5,6h-2C3.224,6,3,5.776,3,5.5l0,0C3,5.224,3.224,5,3.5,5h2  C5.776,5,6,5.224,6,5.5L6,5.5z",gradient:{id:"SVGID_2_",type:"linear",x1:4.5,y1:6,x2:4.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:12,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M15,4c0,0.552-0.447,1-1,1h-3c-0.553,0-1-0.448-1-1V3c0-0.552,0.447-1,1-1h3c0.553,0,1,0.448,1,1V4z",gradient:{id:"SVGID_3_",type:"linear",x1:12.5,y1:2,x2:12.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M14,5.5C14,5.776,13.777,6,13.5,6h-2C11.225,6,11,5.776,11,5.5l0,0C11,5.224,11.225,5,11.5,5h2  C13.777,5,14,5.224,14,5.5L14,5.5z",gradient:{id:"SVGID_4_",type:"linear",x1:12.5,y1:6,x2:12.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:10,w:1,h:1,fill:"#232424"},{shape:"path",data:"M6,13c0-0.553,0.448-1,1-1h3c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V13z",gradient:{id:"SVGID_5_",type:"linear",x1:-1428.3853,y1:-571.5747,
x2:-1428.3853,y2:-568.5747,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#232424"},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M7,11.5C7,11.223,7.224,11,7.5,11h2c0.277,0,0.5,0.223,0.5,0.5l0,0c0,0.275-0.223,0.5-0.5,0.5h-2  C7.224,12,7,11.775,7,11.5L7,11.5z",gradient:{id:"SVGID_6_",type:"linear",x1:-1428.3862,y1:-567.5737,x2:-1428.3862,y2:-568.5737,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,7.5C15,7.776,14.777,8,14.5,8h-12C2.224,8,2,7.776,2,7.5l0,0C2,7.224,2.224,7,2.5,7h12  C14.777,7,15,7.224,15,7.5L15,7.5z",gradient:{id:"SVGID_7_",type:"linear",x1:8.4995,y1:6.1152,x2:8.4995,y2:7.5558,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,9.5c0,0.275-0.223,0.5-0.5,0.5h-12C2.224,10,2,9.775,2,9.5l0,0C2,9.223,2.224,9,2.5,9h12  C14.777,9,15,9.223,15,9.5L15,9.5z",gradient:{id:"SVGID_8_",type:"linear",x1:8.4995,y1:8.1147,x2:8.4995,y2:9.556,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),bf("data_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,12c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12   z",gradient:{id:"SVGID_1_",type:"linear",x1:10.5,y1:6.959,x2:10.5,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:8,y:9,w:5,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:10.5,y1:8.6997,x2:10.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,14.5c0,0.275-0.225,0.5-0.5,0.5h-8C6.224,15,6,14.775,6,14.5l0,0C6,14.223,6.224,14,6.5,14h8   C14.775,14,15,14.223,15,14.5L15,14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:10.5,y1:13.125,x2:10.5,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:14,w:1,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:14.0049,x2:8.4995,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,4H6c0,0-0.152-0.275-0.5-1C5.021,2,5.021,2,4,2C3.057,2,2,2,2,2C1.448,2,1,2.448,1,3v8  c0,0.553,0.448,1,1,1h3v-1H2V3h2.387l1.024,1.998L12,5v1h1V5C13,4.448,12.553,4,12,4z",gradient:{id:"SVGID_5_",type:"linear",x1:6.9995,y1:2.0527,x2:6.9995,y2:11.4757,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,5L5.411,4.998L4.387,3H2v8h3v-0.645V7.254V7c0-0.552,0.448-1,1-1h0.324h3.032H12V5z",gradient:{id:"SVGID_6_",type:"linear",x1:6.9995,y1:2.9902,x2:6.9995,y2:11.0032,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),bf("grid_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,14c0,0.553-0.447,1-1,1H3c-0.552,0-1-0.447-1-1V3c0-0.552,0.448-1,1-1h11c0.553,0,1,0.448,1,1V14  z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:2.1255,x2:8.4995,y2:14.909,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:11,h:11,fill:"#FFFFFF"},{shape:"rect",x:3,y:5,w:11,h:1,gradient:{id:"SVGID_2_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:8,w:11,h:1,gradient:{id:"SVGID_3_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:11,w:11,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:3.2095,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:11,y:3,w:1,h:11,gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:3.209,x2:11.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:3,w:1,h:11,gradient:{id:"SVGID_6_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:5,y:3,w:1,h:11,gradient:{id:"SVGID_7_",type:"linear",x1:5.5,y1:3.209,x2:5.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),bf("databox_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,6h-12H2v0.5v7C2,13.776,2.224,14,2.5,14h12c0.276,0,0.5-0.224,0.5-0.5v-7V6H14.5z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:6.0625,x2:8.4995,y2:14.063,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M14.776,5.553l-1.553-3.105C13.101,2.201,12.775,2,12.5,2h-8C4.225,2,3.899,2.201,3.776,2.447  L2.224,5.553L2,6h0.5h12H15L14.776,5.553z",gradient:{id:"SVGID_2_",type:"linear",x1:8.5005,y1:3.104,x2:8.5005,y2:-5.6467,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"12,2 9.5,2 7.5,2 5,2 3,6 7.5,6 9.5,6 14,6 z",gradient:{id:"SVGID_3_",type:"linear",x1:8.5005,y1:9.2295,x2:8.5005,y2:5.4586,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M11.5,9c0,0.276-0.224,0.5-0.5,0.5H6C5.724,9.5,5.5,9.276,5.5,9l0,0c0-0.276,0.224-0.5,0.5-0.5h5  C11.276,8.5,11.5,8.724,11.5,9L11.5,9z",fill:"#FFFFFF"}]}),bf("group_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,8.5C15,8.776,14.776,9,14.5,9h-10C4.224,9,4,8.776,4,8.5v-7C4,1.224,4.224,1,4.5,1h10    C14.776,1,15,1.224,15,1.5V8.5z",gradient:{id:"SVGID_1_",type:"linear",x1:9.5,y1:.9512,x2:9.5,y2:8.9787,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:5,y:2,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:6,y:3,w:7,h:4,gradient:{id:"SVGID_2_",type:"linear",x1:9.5,y1:3.02,x2:9.5,y2:6.9606,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,10.5c0,0.276-0.224,0.5-0.5,0.5h-12C3.224,11,3,10.776,3,10.5l0,0C3,10.224,3.224,10,3.5,10h12    C15.776,10,16,10.224,16,10.5L16,10.5z",gradient:{id:"SVGID_3_",type:"linear",x1:9.5,y1:9.9941,x2:9.5,y2:10.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:6,y:10.001,w:2,h:.999,gradient:{id:"SVGID_4_",type:"linear",x1:7,y1:10.0059,x2:7,y2:10.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,12.5c0,0.276-0.224,0.5-0.5,0.5h-10C1.224,13,1,12.776,1,12.5v-7C1,5.224,1.224,5,1.5,5h10    C11.776,5,12,5.224,12,5.5V12.5z",gradient:{id:"SVGID_5_",type:"linear",x1:6.4995,y1:4.9512,x2:6.4995,y2:12.9792,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:6,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:3,y:7,w:7,h:4,gradient:{id:"SVGID_6_",type:"linear",x1:6.4995,y1:7.02,x2:6.4995,y2:10.9611,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M13,14.5c0,0.276-0.224,0.5-0.5,0.5h-12C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h12    C12.776,14,13,14.224,13,14.5L13,14.5z",gradient:{id:"SVGID_7_",type:"linear",x1:6.4995,y1:13.9941,x2:6.4995,y2:14.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:14.001,w:2,h:.999,gradient:{id:"SVGID_8_",type:"linear",x1:4,y1:14.0059,x2:4,y2:14.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),bf("link_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:2.5,y:2.5},p2:{x:13.5,y:13.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:11.5371,y1:11.5371,x2:14.2155,y2:14.2155,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:3,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:1.4956,y1:1.4956,x2:4.1473,y2:4.1473,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:3,cy:3,rx:1,ry:1,fill:"#FFFFFF"}]}),bf("linksubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,7.661c0-1.202-0.642-2.247-1.596-2.835C12.848,3.188,11.314,2,9.486,2  c-1.587,0-2.95,0.902-3.649,2.211C4.573,4.22,3.548,5.194,3.438,6.432C3.389,6.429,3.342,6.417,3.292,6.417  C2.026,6.417,1,7.443,1,8.708C1,9.975,2.026,11,3.292,11h8.371l0,0C13.506,11,15,9.506,15,7.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.959,x2:7.9995,y2:11.0921,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,10C2.58,10,2,9.42,2,8.708c0-0.712,0.58-1.292,1.292-1.292C3.286,7.422,3.332,7.427,3.379,7.43  l0.969,0.058L4.435,6.52C4.5,5.779,5.106,5.216,5.844,5.211l0.595-0.004l0.28-0.524C7.273,3.645,8.334,3,9.486,3  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,6.11,14,6.851,14,7.661C14,8.951,12.951,10,11.661,10H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.292,10h8.37c1.11,0,2.04-0.781,2.276-1.821c-0.131-0.615-0.5-1.158-1.058-1.501l-0.307-0.189  l-0.116-0.341C12.021,4.863,10.828,4,9.486,4C8.334,4,7.273,4.645,6.719,5.682l-0.28,0.524L5.844,6.211  C5.106,6.216,4.5,6.779,4.435,7.52L4.349,8.487L3.379,8.43C3.332,8.427,3.286,8.422,3.292,8.417c-0.535,0-0.994,0.328-1.19,0.792  C2.297,9.672,2.757,10,3.292,10z",gradient:{id:"SVGID_2_",type:"linear",x1:8.019,y1:4.084,x2:8.019,y2:9.8062,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"line",p1:{x:8.01,y:8.01},p2:{x:13.186,y:13.186},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:8,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:6.7881,y1:6.7881,x2:9.9924,y2:9.9924,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:8,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:11.5791,y1:11.5791,x2:14.3132,y2:14.3132,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),bf("node_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,11.5c0,0.276-0.224,0.5-0.5,0.5h-13C1.224,12,1,11.776,1,11.5v-9C1,2.224,1.224,2,1.5,2h13  C14.776,2,15,2.224,15,2.5V11.5z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.939,x2:7.9995,y2:11.9739,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:3,w:12,h:8,fill:"#FFFFFF"},{shape:"rect",x:3,y:4,w:10,h:6,gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:4.0513,x2:7.9995,y2:9.865,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.5c0,0.276-0.224,0.5-0.5,0.5h-15C0.224,15,0,14.776,0,14.5v-1C0,13.224,0.224,13,0.5,13h15  c0.276,0,0.5,0.224,0.5,0.5V14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:7.9995,y1:13.0508,x2:7.9995,y2:14.9258,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M9,14.5C9,14.224,8.776,14,8.5,14h-5C3.224,14,3,14.224,3,14.5V15h6V14.5z",gradient:{id:"SVGID_4_",type:"linear",x1:5.9995,y1:14.0508,x2:5.9995,y2:15.9258,stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"},{offset:"0.4637",color:"#449981"},{offset:"0.7764",color:"#2C8E73"},{offset:"1",color:"#218A6E"}]}}]}),bf("shapelink_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:7.5,y:2.5},p2:{x:2.5,y:7.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"line",p1:{x:2.5,y:7.5},p2:{x:8.5,y:13.5},lineColor:"url(#SVGID_2_)",lineWidth:1},{shape:"line",p1:{x:9,y:13.186},p2:{x:13.5,y:6.5},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:7,cy:3,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:5.5864,y1:1.5864,x2:8.4149,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:7,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5864,y1:6.5864,x2:3.4142,y2:9.4142,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:8,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:6.5869,y1:11.5869,x2:9.4147,y2:14.4147,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:8,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:7,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:11.5859,y1:5.5859,x2:14.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:7,rx:1,ry:1,fill:"#FFFFFF"}]}),bf("shapenode_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,3h-9l-4,4v7h13L9,8.5L14.5,3z M12.086,13H2.5V7.414L5.914,4h6.172l-4.5,4.5L12.086,13z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:3.209,x2:7.9995,y2:13.6621,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:6,cy:3,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:4.5859,y1:1.5859,x2:7.4151,y2:4.4151,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:6,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:11.5869,y1:1.5864,x2:14.4153,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:9,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:7.5864,y1:6.5864,x2:10.4149,y2:9.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:9,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:7,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5859,y1:5.5859,x2:3.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:7,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12.825,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:11.4111,y1:11.5869,x2:14.2396,y2:14.4153,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:12.825,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),bf("shapesubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,6.661c0-1.202-0.642-2.247-1.596-2.835C12.848,2.188,11.314,1,9.486,1  c-1.587,0-2.95,0.902-3.649,2.211C4.573,3.22,3.548,4.194,3.438,5.432C3.389,5.429,3.342,5.417,3.292,5.417  C2.026,5.417,1,6.443,1,7.708S2.026,10,3.292,10h8.371l0,0C13.506,10,15,8.505,15,6.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.3755,x2:7.9995,y2:9.733,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,9C2.58,9,2,8.42,2,7.708s0.58-1.292,1.292-1.292C3.286,6.422,3.332,6.427,3.379,6.43l0.969,0.058  L4.435,5.52C4.5,4.779,5.106,4.216,5.844,4.211l0.595-0.004l0.28-0.524C7.273,2.645,8.334,2,9.486,2  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,5.11,14,5.851,14,6.661C14,7.951,12.951,9,11.661,9H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.272,9h8.37c1.11,0,2.039-0.689,2.275-1.729c-0.131-0.615-0.499-1.249-1.057-1.593l-0.307-0.189  l-0.116-0.341C12.002,3.863,10.809,3,9.468,3C8.314,3,7.254,3.645,6.7,4.682L6.42,5.207L5.825,5.211  C5.087,5.216,4.481,5.779,4.416,6.52L4.33,7.487L3.36,7.43C3.313,7.427,3.267,7.422,3.272,7.417c-0.535,0-0.994,0.327-1.19,0.792  C2.278,8.672,2.738,9,3.272,9z",gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:3.459,x2:7.9995,y2:8.4597,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M11.516,7.102h-8l2.469,6h8.5L11.516,7.102z M5.024,8.123h5.905l1.938,3.979H6.662L5.024,8.123z",gradient:{id:"SVGID_3_",type:"linear",x1:7.4443,y1:7.1724,x2:10.1111,y2:12.8383,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"5,8.112 10.904,8.112 12.842,12.092 6.638,12.092 z",fill:"#FFFFFF"},{shape:"ellipse",cx:5,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:3,y1:8,x2:7,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:5,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:10,y1:8,x2:14,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:12,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:7,cy:12,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:5,y1:12,x2:9,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:7,cy:12,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:14,cy:12,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:12,y1:12,x2:16,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:14,cy:12,rx:1,ry:1,fill:"#FFFFFF"}]}),bf("subnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:10,y:14.001,w:2,h:1,gradient:{id:"SVGID_1_",type:"linear",x1:11,y1:14.0059,x2:11,y2:14.9481,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:14,y:10.001,w:1,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:14.5,y1:10.0117,x2:14.5,y2:11.8962,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,6.001c0,0.552-0.447,1-1,1H8c-0.552,0-1-0.448-1-1v-4c0-0.552,0.448-1,1-1h7   c0.553,0,1,0.448,1,1V6.001z",gradient:{id:"SVGID_3_",type:"linear",x1:11.5,y1:.96,x2:11.5,y2:6.2265,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:2.001,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:9,y:3.001,w:5,h:2,gradient:{id:"SVGID_4_",type:"linear",x1:11.5,y1:2.7007,x2:11.5,y2:5.0337,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,8.501c0,0.276-0.225,0.5-0.5,0.5h-8c-0.276,0-0.5-0.224-0.5-0.5l0,0c0-0.276,0.224-0.5,0.5-0.5   h8C15.775,8.001,16,8.225,16,8.501L16,8.501z",gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:7.126,x2:11.5,y2:8.5535,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:8.001,w:1,h:.999,gradient:{id:"SVGID_6_",type:"linear",x1:9.5,y1:8.0063,x2:9.5,y2:8.9477,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M9,12c0,0.553-0.447,1-1,1H1c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12z   ",gradient:{id:"SVGID_7_",type:"linear",x1:4.4995,y1:6.959,x2:4.4995,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:1,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:2,y:9,w:5,h:2,gradient:{id:"SVGID_8_",type:"linear",x1:4.5,y1:8.6997,x2:4.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M9,14.5C9,14.776,8.775,15,8.5,15h-8C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h8   C8.775,14,9,14.224,9,14.5L9,14.5z",gradient:{id:"SVGID_9_",type:"linear",x1:4.4995,y1:13.125,x2:4.4995,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:14,w:1,h:1,gradient:{id:"SVGID_10_",type:"linear",x1:2.5,y1:14.0049,x2:2.5,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.501c0,0.276-0.224,0.5-0.5,0.5h-2c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h2c0.276,0,0.5,0.224,0.5,0.5V14.501z",gradient:{id:"SVGID_11_",type:"linear",x1:14.5,y1:13.0117,x2:14.5,y2:14.8962,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]});var af={_hitCanvas:null,getHitCanvas:function(a,b){this._hitCanvas==null&&(this._hitCanvas=s.createCanvas()),arguments.length==0&&(a=2,b=2),this._hitCanvas.setAttribute("width",""+a-1),this._hitCanvas.setAttribute("height",""+b-1),this._hitCanvas.setAttribute("width",""+a),this._hitCanvas.setAttribute("height",""+b);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,a,b),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(a,c,d){c!=b&&(a.fillStyle=c,a.fill()),d!=b&&(a.strokeStyle=d,a.stroke())},text:function(a,b,c,d,e,f){a.textAlign="center",a.textBaseline="middle",e!=null&&(a.fillStyle=e,a.fillText(b,c,d)),f&&(a.strokeStyle=f,a.strokeText(b,c,d))},circle:function(a,b,c,d,e,f){a.arc(b,c,d,0,2*Math.PI,!0),a.closePath(),this.render(a,e,f)},rect:function(a,b,c,d,e,f,g){a.rect(b,c,d,e),a.closePath(),this.render(a,f,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(a,b,c,d,e,f){var g=0;return e<=0?g|=this.OUT_LEFT|this.OUT_RIGHT:a<c?g|=this.OUT_LEFT:a>c+e&&(g|=this.OUT_RIGHT),f<=0?g|=this.OUT_TOP|this.OUT_BOTTOM:b<d?g|=this.OUT_TOP:b>d+f&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(a,b,c,d,e,f,g,h){var i,j;if((j=this.outcode(c,d,e,f,g,h))==0)return!0;while((i=this.outcode(a,b,e,f,g,h))!=0){if((i&j)!=0)return!1;if((i&(this.OUT_LEFT|this.OUT_RIGHT))!=0){var k=e;(i&this.OUT_RIGHT)!=0&&(k+=g),b+=(k-a)*(d-b)/(c-a),a=k}else{var l=f;(i&this.OUT_BOTTOM)!=0&&(l+=h),a+=(l-b)*(c-a)/(d-b),b=l}}return!0}};c.vector={},c.vector.interaction={},c.vector.Network=function(a){c.vector.Network.superClass.constructor.apply(this,arguments),this.zoomManager=new c.vector.PhysicalZoomManager(this),this._view=s.createView("hidden"),this._rootCanvas=s.createCanvas(),this._topCanvas=s.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._zoomMap={},this._viewRectMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new c.List,this._topAttachmentList=new c.List,this.setElementBox(a?a:new c.ElementBox),m.isMSToucheable?this.setMSTouchInteractions():m.isTouchable?this.setTouchInteractions():this.setDefaultInteractions(!1);var b=this;this._flowLink=function(){if(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)return;b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new c.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a),b.invalidateElementUI(a)})},this.setToolTipEnabled(c.Defaults.NETWORK_TOOLTIP_ENABLED),this._paintAll=!0,this._dirtyRects=new Ce,this._invalidateMap={},this._invalidateAll=!0,b._count=0,b._invalidate=!0,function d(a){requestAnimationFrame(d),b._invalidate&&(b._count++,b._now=a,b.validate())}(0)},d.ext("twaver.vector.Network",c.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","edgeDetect","dragToPan","wheelToZoom","asyncZoomAndViewRect","debug","zoomDivVisible"],_currentSubNetwork:null,_subNetworkAnimate:c.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!1,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:c.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:c.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:c.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Se.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:c.Defaults.VECTORUI_FUNCTION,_doubleClickToUpSubNetwork:c.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:c.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:c.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:c.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:c.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:c.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:c.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:c.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:c.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:c.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:c.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:c.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:c.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:c.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:c.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:c.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:c.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:c.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:c.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:c.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:c.Defaults.NETWORK_RESIZE_ANIMATE,_rotatePointSize:c.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:c.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:c.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:c.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:c.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Se.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Se.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Se.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Se.NETWORK_ROTATE_SCALE_FONT_COLOR,_editPointSize:c.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:c.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:c.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:c.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:c.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:c.Defaults.NETWORK_EDIT_LINE_WIDTH,_limitElementInPositiveLocation:!1,_linkFlowInterval:Se.NETWORK_LINK_FLOW_INTERVAL,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:c.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_edgeDetect:!1,_dragToPan:!0,_wheelToZoom:!0,_asyncZoomAndViewRect:!1,_debug:!1,_zoomDivVisible:!0,adjustBounds:function(a){var b=!1,d=this._view.style;d.left==a.x+"px"&&d.top==a.y+"px"&&d.width==a.width+"px"&&d.height==a.height+"px"&&(b=!0),c.vector.Network.superClass.adjustBounds.apply(this,arguments);if(b==1)return;var e=this._view.offsetWidth,f=this._view.offsetHeight;this._rootCanvas.setAttribute("width",e),this._rootCanvas.setAttribute("height",f),this._topCanvas.setAttribute("width",e),this._topCanvas.setAttribute("height",f),this.setViewRect(this.viewRect.x,this.viewRect.y,e,f),typeof c.gis=="undefined"&&(c.Util.makeHighRes(this._rootCanvas),c.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getLabel2:function(a){return a.getStyle("network.label")||a.getName2()},setZoomManager:function(a){var b=this.zoomManager;if(b==a)return;this.zoomManager=a,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.invalidateElementUIs(),this.firePropertyChange("zoomManager",b,a)},getZoomManager:function(){return this.zoomManager},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){jd.twm(this);var a=this.getElementBox().getDatas()._as,b=a.length,c={},e,f,g,h,i=this._visibleFunction,j=this._box._layerBox.size()===1?this._box._layerBox._defaultLayer:null;for(e=0;e<b;e++)g=a[e],c[g._id]=this.isVisible(g,i,j);var k=this.getGraphicsZoom(),l=null,m={x:this.viewRect.x/k,y:this.viewRect.y/k,width:this.viewRect.width/k,height:this.viewRect.height/k};if(this._invalidateAll){if(this._visibleMap)for(e=0;e<b;e++)g=a[e],c[g._id]!==this._visibleMap[g._id]&&(h=this._elementUIMap[g._id],h&&h.invalidate());for(e=0;e<b;e++)g=a[e],h=this._elementUIMap[g._id],h&&h.validate();this._paintAll=!0}else if(this._paintAll){for(f in this._invalidateMap)h=this._elementUIMap[f],h&&h.invalidate();for(f in this._invalidateMap)h=this._elementUIMap[f],h&&h.validate()}else{for(f in this._invalidateMap)h=this._elementUIMap[f],h&&(this._dirtyRects.add(h.getZoomViewRect(!1)),h.invalidate());for(f in this._invalidateMap)h=this._elementUIMap[f],h&&(h.validate(),this._dirtyRects.add(h.getZoomViewRect(!0)))}this._paintAll?l=m:(this._dirtyRects.forEach(function(a){l==null?l=d.cloneRect(a):l=p.unionRect(l,a)}),l?(p.grow(l,2,2),l=p.intersection(l,m)):l=m),this._visibleMap=c,l&&this.paintRoot(l),this.validateCanvasSize(),this._repaintTopFlag==1&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box===a)return;var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new c.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",b,this._box)},handleElementBoxChange:function(a){var b=a.data;if(a.kind==="add")this.createElementUI(b),this.invalidateBundleLink(b);else if(a.kind==="remove"){var c=this.getElementUI(b);c&&(this._dirtyRects.add(c.getZoomViewRect()),c.dispose(),delete this._elementUIMap[b.getId()]),b===this._currentSubNetwork&&this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null),delete this._invalidateMap[b._id]}else a.kind==="clear"&&(this._elementUIMap={},this._currentSubNetwork!=null&&this._setCurrentSubNetwork(null),this._paintAll=!0);this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);c&&(this.invalidateElementUI(b),c.handlePropertyChange(a)),this.invalidateBundleLink(b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){a.property==="editable"&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(a){var b=this.getSelectionModel().getLastData();b&&(a.kind==="append"||a
.kind==="set")&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b)),a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a),this.invalidateElementUI(b)},this),this.invalidateElementVisibility()},sendToTop:function(a){if(!this._box.contains(a))return;var b=a;while(b._parent&&this.isVisible(b._parent)){b=b._parent;if(!b)break}b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)},getViewRect:function(){return this.viewRect?d.cloneRect(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(a,b){var c=this.viewRect.x,d=this.viewRect.y,e=this.viewRect.width,f=this.viewRect.height;this.setViewRect(c+a,d+b,e,f)},setViewRect:function(a,b,c,d){this.isLimitViewInCanvas()==1&&(a<0&&(a=0),c>this.realWidth?a=0:a+c>this.realWidth&&(a=this.realWidth-c),b<0&&(b=0),d>this.realHeight?b=0:b+d>this.realHeight&&(b=this.realHeight-d));var e=this.viewRect;if(this.viewRect!=null&&a==this.viewRect.x&&b==this.viewRect.y&&c==this.viewRect.width&&d==this.viewRect.height)return;this.viewRect={x:a,y:b,width:c,height:d},this.firePropertyChange("viewRect",e,this.viewRect),this.invalidateElementVisibility(),this._paintAll=!0},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},setZoomVisibilityThresholds:function(a){var b=this._visibilityThresholds;this._zoomVisibilityThresholds=a,this.firePropertyChange("zoomVisibilityThresholds",b,a),this.invalidateElementVisibility()},getZoomVisibilityThresholds:function(){return this._zoomVisibilityThresholds||{}},invalidateElementVisibility:function(){this.invalidate()},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(a){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){if(this._invalidateCanvasSizeFlag==0)return;this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize()},_validateCanvasSize:function(){if(this.isAutoValidateCanvasSize()==0){this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};return}var a=this.getElementBox().getDatas(),b=a.size(),c;if(b>0){for(var e=0;e<b;e++){var f=a.get(e);if(this._visibleMap[f._id]){var g=this._elementUIMap[f._id];g&&(c?c=p.unionRect(c,g.getZoomViewRect(!0)):c=d.cloneRect(g.getZoomViewRect(!0)))}}c==null&&(c={x:0,y:0,width:0,height:0});var h=this.getGraphicsZoom();if(this.realWidth==(c.x+c.width)*h&&this.realHeight==(c.y+c.height)*h)return;this.realWidth=(c.x+c.width)*h,this.realHeight=(c.y+c.height)*h,this._unionBounds={x:c.x*h,y:c.y*h,width:c.width*h,height:c.height*h}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(a){return a==null?null:this._elementUIMap[a._id]},getUnionBounds:function(){return this._unionBounds},getZoomBodyRect:function(a){var b=this.getElementUI(a);return b?b.getZoomBodyRect():null},getShapeNodeZoomPoints:function(a,b){if(a._points){var c=this.getElementUI(a);if(c)return c._getZoomPoints()}return null},createElementUI:function(a){var b=this._elementUIMap[a.getId()];if(!b){b=this._elementUIFunction(this,a);if(!b){var d=a.getClassName(),e=d.substr(d.indexOf(".")+1)+"UI",f=c.vector[e];f&&(b=new f(this,a))}b&&(this._elementUIMap[a.getId()]=b)}return this._invalidateMap&&(this._invalidateMap[a._id]=a),b},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction===a)return;var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())},invalidateElementUI:function(a,b){if(this._invalidateAll)return;this._invalidateMap[a._id]=a;var d=this.getElementUI(a);if(a instanceof Ze){var e=a.getAgentLinks();e!=null&&e.forEach(this.invalidateElementUI,this);var f=a.getParent();f instanceof c.Group&&this.invalidateElementUI(f)}this.invalidateElementVisibility()},invalidateElementUIs:function(a){this._invalidateAll=!0,this._invalidateMap={},this._visibleMap={},this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.invalidate()},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},invalidateBundleLink:function(a){if(a instanceof c.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},paintRoot:function(a){var e=this._rootCanvas.getContext("2d");e.save();var f=this.getGraphicsZoom();e.beginPath(),e.rect(a.x*f-this.viewRect.x,a.y*f-this.viewRect.y,a.width*f,a.height*f),e.clip(),e.clearRect(a.x*f-this.viewRect.x,a.y*f-this.viewRect.y,a.width*f,a.height*f),this.visibleList=new c.List,this._topAttachmentList=new c.List,Be.draw(e,this);var g=this.getElementBox().getDatas()._as,h=g.length,i=this.zoomManager;i._zoomGraphicsBegin(e),this.paintBottom(e,a);var j=this._box._layerBox,k,l,m,n,f=this.getGraphicsZoom(),o={x:this.viewRect.x/f,y:this.viewRect.y/f,width:this.viewRect.width/f,height:this.viewRect.height/f};if(j.size()===1)for(k=0;k<h;k++){l=g[k];if(this._visibleMap[l._id]){m=this._elementUIMap[l._id],m!=null&&this._isInView(m,a)&&(m.paint(e),m.setAttachmentVisible&&m.setAttachmentVisible(!0));if(this._debug){var q=a;e.beginPath(),e.strokeStyle="#CC3B76",e.lineWidth=1,e.strokeRect(q.x,q.y,q.width,q.height),e.stroke()}m!=null&&p.intersects(o,m.getZoomViewRect())?m.setAttachmentVisible&&m.setAttachmentVisible(!0):m.setAttachmentVisible&&m.setAttachmentVisible(!1),this.visibleList.add(l)}else m=this._elementUIMap[l._id],m.setAttachmentVisible&&m.setAttachmentVisible(!1)}else j.forEachByDepthFirst(function(b){for(k=0;k<h;k++)l=g[k],j.getLayerByElement(l)===b&&this._visibleMap[l._id]?(m=this._elementUIMap[l._id],m!=null&&this._isInView(m,a)&&(m.paint(e),m.setAttachmentVisible&&m.setAttachmentVisible(!0)),m!=null&&p.intersects(o,m.getZoomViewRect())?m.setAttachmentVisible&&m.setAttachmentVisible(!0):m.setAttachmentVisible&&m.setAttachmentVisible(!1),this.visibleList.add(l)):(m=this._elementUIMap[l._id],m.setAttachmentVisible&&m.setAttachmentVisible(!1))},null,this);h=this._topAttachmentList.size();for(k=0;k<h;k++)n=this._topAttachmentList.get(k),n.getElementUI().paintAttachment(e,n);this.paintTop(e,a);if(this._xyz!==b){var r=this._xyz,s=r.markText,t=r.type,u=r.expired,v=r.innerHTML,w=0,x=0,h,y=1,q=this.viewRect;e.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),e.scale(1/this.getZoom(),1/this.getZoom());var f=this.getZoom();s!=b&&s!=null&&s!=""||t=="2"?(e.font="15px Arial sans-serif",h=d.g.getTextSize(e.font,v),e.fillStyle="red",w=q.width-h.width,x=q.height-20):(e.font="10px Arial sans-serif",h=d.g.getTextSize(e.font,v),w=q.width/2-h.width/2,x=q.height/2),e.fillText(v,w,x)}e.restore(),this._invalidateMap={},this._invalidateAll=!1,this._paintAll=!1,this._dirtyRects=new Ce},paintBottom:function(a,b){},paintTop:function(a,b){},_isInView:function(a,b){return p.intersects(b,a.getZoomViewRect())},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(a){var b=this.markerList.size();for(var c=0;c<b;c++){var d=this.markerList.get(c);d.paint(a)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint2:function(a){return this.zoomManager._getLogicalPoint(a)},getLogicalPoint:function(a){return this.zoomManager._getLogicalPoint(a,!0)},getElementAt:function(a){if(this.visibleList==null)return null;var b;a.target?b=this.getLogicalPoint2(a):a.event?a.event.target&&(b=this.getLogicalPoint2(a.event)):b=a;if(this._topAttachmentList!=null){var c=this._topAttachmentList.size();for(var d=c-1;d>=0;d--){var e=this._topAttachmentList.get(d);if(e.hit(b.x,b.y))return e.getElement()}}if(this.visibleList!=null){var f=this.visibleList.size();for(var g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);if(i&&i.hit(b.x,b.y))return h}}return null},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);if(!c)return null;var d;return a.target?d=this.getLogicalPoint2(a):a.event?d=this.getLogicalPoint2(a.event):d=a,c.hitTest(d.x,d.y)},getElementsAtRect:function(a,d,e,f){var g=new c.List;if(this.visibleList==null)return g;f=f===b?!0:f;var h=this.visibleList.size();for(var i=h-1;i>=0;i--){var j=this.visibleList.get(i),k=this.getElementUI(j);k&&(!e||e(k._element))&&(f&&this.isSelectable(k._element)||!f)&&(d?k.intersects(a)&&g.add(j):p.contains(a,k.getZoomViewRect(Oc))&&g.add(j))}return g},getPosition:function(a,b,d,e,f,g){var h,i=b instanceof c.vector.ElementUI?b:this.getElementUI(b);if(i)if(a==="from"||a==="to"){if(i.getFromPosition){h=a==="from"?i.getFromPosition(e,f):i.getToPosition(e,f);if(h)return{x:h.x-d.width/2,y:h.y-d.height/2}}}else a==="hotspot"?h=g?i.getZoomHotSpot(this.zoomManager):i.getHotSpot():h=r.get(a,g?i.getZoomBodyRect():i.getBodyRect(),d);!h&&b.getRect&&(h=r.get(a,b.getRect(),d));if(h)return{x:h.x+e,y:h.y+f};throw"position '"+a+"' object '"+b+"'"},isValidEvent:function(a){if(!a)return!1;var b,c;if(a.currentTarget===this._view){m.isFirefox?(b=a.layerX,c=a.layerY):(b=a.offsetX,c=a.offsetY);if(this.isHScrollBarVisible()==1&&c>=this.viewRect.height-this.getScrollBarWidth())return!1;if(this.isVScrollBarVisible()==1&&b>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)?a instanceof c.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){var a=this.getSelectionModel().getSelection();for(var b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(a,b,d,e){if(a===0&&b===0)return;var f=this.getMovableSelectedElementsRect();if(f==null)return;this._limitElementInPositiveLocation&&(f.x+a<0&&(a=-f.x),f.y+b<0&&(b=-f.y)),c.Util.moveElements(this.getMovableSelectedElements(),a,b,d,e,this)},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(a.size()===0)return null;var b=null;for(var c=0,d=a.size();c<d;c++){var e=a.get(c);if(e instanceof Ze){var f=this.getElementUI(e);f&&(b=p.unionRect(b,f.getViewRect()))}}return b},isVisible:function(a,b,d){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;arguments.length!==3&&(b=this._visibleFunction);if(b&&!b(a))return!1;if(!(d||this._box._layerBox.getLayerByElement(a))._visible)return!1;if(wd.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(!this.zoomManager.isElementVisible(a))return!1;if(a instanceof c.Link){if(!this._noAgentLinkVisible){if(!a._fromAgent||!a._toAgent)return!1;if(!this.isVisible(a._fromAgent,b,d)||!this.isVisible(a._toAgent,b,d))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else{var e=a._parent;while(e&&!e.ISubNetwork){if(e instanceof c.Group)if(!e.isExpanded()||!this.isVisible(e,b,d))return!1;e=e._parent}}return a.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a,b){return this._linkableFunction==null||this._linkableFunction(a,b)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&a.getStyle("select.style")==="shadow"?a.getStyle("select.color"):b},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a){this.setInteractions([new c.vector.interaction.DefaultInteraction(this,a)])},setTouchInteractions:function(){this.setInteractions([new c.vector.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new c.vector.interaction.MSTouchInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new c.vector.interaction.EditInteraction(this,a),new c.vector.interaction.DefaultInteraction(this)])},setCreateElementInteractions:function(a){this.setInteractions([new c.vector.interaction.CreateElementInteraction(this,a),new c.vector.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new c.vector.interaction.CreateLinkInteraction(this,a),new c.vector.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new c.vector.interaction.CreateShapeLinkInteraction(this,a),new c.vector.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new c.vector.interaction.CreateShapeNodeInteraction(this,a),new c.vector.interaction.DefaultInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(a){if(a){var b=a.getToolTip();return b?b:a.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){this._toolTipEnabled=a;if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){if(b.isMovingElement()){Cd.hideToolTip();return}var c=b.getElementAt(a);if(b._preElement===c)return;b._preElement=c;if(c){var d=b.getToolTip(c);Cd.showToolTip({x:a.pageX,y:a.pageY},d);var e=Cd.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(k.documentElement.scrollLeft||k.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(k.documentElement.scrollTop||k.body.scrollTop)+"px")}return}Cd.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Cd.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(a,b){a=this.checkZoom(a);if(this.isAsyncZoomAndViewRect())var c=this._zoomMap[this._currentSubNetwork].zoom;else var c=this._zoom;if(a==c)return;var d=this.getViewRect();b||(b={x:d.width/2,y:d.height/2});var e=this.viewRect,f=b.x-(b.x+e.x)*a/c,g=b.y-(b.y+e.y)*a/c;this.isAsyncZoomAndViewRect()?this._zoomMap[this._currentSubNetwork].zoom=a:this._zoom=a,this._paintAll=!0,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.zoomManager._invalidateZoom(),this.setViewRect(-f,-g,this.viewRect.width,this.viewRect.height),this._asyncZoomAndViewRect?this.firePropertyChange("zoom",c,this._zoomMap[this._currentSubNetwork].zoom):this.firePropertyChange("zoom",c,this._zoom)},getZoom:function(){if(this.isAsyncZoomAndViewRect()){var a=this._zoomMap[this._currentSubNetwork];return a||(this._zoomMap[this._currentSubNetwork]={zoom:1}),this._zoomMap[this._currentSubNetwork].zoom}return this._zoom},getSizeZoom:function(a){return this.zoomManager.getSizeZoom(a)},getLocationZoom:function(){return this.zoomManager.getLocationZoom()},getGraphicsZoom:function(){return this.zoomManager.getGraphicsZoom()},zoomOverview:function(a){if(this._unionBounds.width<=0||this._unionBounds.width<=0)return;var b=this.getZoom(),c=this._unionBounds,d=c.width/b,e=c.height/b,f=this.viewRect.width/d,g=this.viewRect.height/e,h=Math.min(f,g);this.setZoom(h);var i=this.getZoom();this.setViewRect(this._unionBounds.x*i/b,this._unionBounds.y*i/b,this.viewRect.width,this.viewRect.height);if(this.getLocationZoom()!=1){var j=arguments[1]==null?5:arguments[1];if(j>0){j--;var k=this;setTimeout(function(){k.zoomOverview(a,j)},25)}}},zoomReset:function(a){this.setZoom(1,a)},zoomIn:function(a){this.setZoom(this.getZoom()*1.2,a)},zoomOut:function(a){this.setZoom(this.getZoom()/1.2,a)},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(wd.getSubNetwork(this._currentSubNetwork),a,b)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,d){c.animate.AnimateManager.endAnimate();if(b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var e=new c.animate.AnimateSubNetwork(this,a,d);c.animate.AnimateManager.start(e)}else this._setCurrentSubNetwork(a),d&&d()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";if(this.isAsyncZoomAndViewRect()){var b=this._viewRectMap[this._currentSubNetwork];b?this._viewRectMap[this._currentSubNetwork]=this.viewRect:this._viewRectMap[this._currentSubNetwork]=this.viewRect?this.viewRect:{x:0,y:0,width:this.viewRect.width,height:this.viewRect.height}}var c=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",c,a);if(this.isAsyncZoomAndViewRect()){this._viewRectMap[this._currentSubNetwork]||(this._viewRectMap[this._currentSubNetwork]={x:0,y:0,width:this.viewRect.width,height:this.viewRect.height});var b=this._viewRectMap[this._currentSubNetwork];this.setViewRect(b.x,b.y,b.width,b.height),this.invalidateElementUIs()}this.invalidateElementVisibility(),this.invalidateCanvasSize(),this._paintAll=!0},makeVisible:function(a){var b=this.getElementUI(a);if(!b)return;var e=wd.getSubNetwork(a);if(e!==this._currentSubNetwork){var f=this;this.setCurrentSubNetwork(e,this.isSubNetworkAnimate(),function(){d.callLater(f.makeVisible,f,[a])});return}var g=a;while((g=g.getParent())&&g!==e)g instanceof c.Group&&g.setExpanded(!0);var h=b.getViewRect();if(!h)return;var i=b.getZoomViewRect(this.zoomManager),j;h.x==i.x&&h.y==i.y&&h.width==i.width&&h.height==i.height?j={x:h.x*this.getGraphicsZoom(),y:h.y*this.getGraphicsZoom(),width:h.width*this.getGraphicsZoom(),height:h.height*this.getGraphicsZoom()}:j=i,p.intersects(this.viewRect,j)||this.isVisible(a)&&d.callLater(this.centerByLogicalPoint,this,[j.x+j.width/2,j.y+j.height/2])},centerByLogicalPoint:function(a,b,c){var d=a-this.viewRect.width/2,e=b-this.viewRect.height/2;this.setViewRect(d,e,this.viewRect.width,this.viewRect.height)},panByOffset:function(a,b){this.setViewOffSet(a,b)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Se.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,d,e,f,g){d||(d=s.createCanvas()),d.setAttribute("width",a),d.setAttribute("height",b),d._viewRect?(d._viewRect.width=a,d._viewRect.height=b):d._viewRect={x:0,y:0,width:a,height:b};var h=d.getContext("2d");h.translate(-f,-g),h.clearRect(0,0,a,b),Be.draw(h,this);if(this._view.clientWidth===0||this._view.clientHeight===0)return d;var i=a/this.realWidth*this.getGraphicsZoom(),j=b/this.realHeight*this.getGraphicsZoom();h.scale(e,e);var k=this.getElementBox().getDatas()._as,l=k.length;this._topAttachmentList=new c.List;var m=this.getElementBox().getLayerBox(),n=m.getRoots(),o=n.size(),p,q,r,t,u,v;if(o===1)for(r=0;r<l;r++)t=k[r],this._visibleMap[t._id]&&(u=this._elementUIMap[t._id],u!=null&&u.paint(h));else for(p=0;p<o;p++){q=n.get(p);for(r=0;r<l;r++)t=k[r],m.getLayerByElement(t)===q&&this._visibleMap[t._id]&&(u=this._elementUIMap[t._id],u!=null&&u.paint(h))}l=this._topAttachmentList.size();for(r=0;r<l;r++)v=this._topAttachmentList.get(r),v.getElementUI().paintAttachment(h,v);return d},toCanvasByRegion:function(a,b,d){d||(d=s.createCanvas());var e=a.width*b,f=a.height*b;d.setAttribute("width",e),d.setAttribute("height",f),d._viewRect?(d._viewRect.width=e,d._viewRect.height=f):d._viewRect={x:0,y:0,width:e,height:f};var g=d.getContext("2d");g.clearRect(0,0,e,f),Be.draw(g,this);if(this._view.clientWidth===0||this._view.clientHeight===0)return d;g.save(),g.scale(b,b),g.beginPath(),g.translate(-a.x,-a.y);var h=this.getElementBox().getDatas()._as,i=h.length;this._topAttachmentList=new c.List;var j=this.getElementBox().getLayerBox(),k=j.getRoots(),l=k.size(),m,n,o,q,r,t;if(l===1)for(o=0;o<i;o++)q=h[o],this._visibleMap[q._id]&&(r=this._elementUIMap[q._id],r!=null&&p.intersects(a,r.getZoomViewRect())&&r.paint(g));else for(m=0;m<l;m++){n=k.get(m);for(o=0;o<i;o++)q=h[o],j.getLayerByElement(q)===n&&this._visibleMap[q._id]&&(r=this._elementUIMap[q._id],r!=null&&p.intersects(a,r.getZoomViewRect())&&r.paint(g))}i=this._topAttachmentList.size();for(o=0;o<i;o++)t=this._topAttachmentList.get(o),t.getElementUI().paintAttachment(g,t);return g.restore(),d},getGroupChildrenRects:function(a){return this.zoomManager._getGroupChildrenRects(a)},convertPointFromView:function(a){return this.zoomManager._convertPointFromView(a)},getOffset:function(a,b){return this.zoomManager._getOffset(a,b)},panToCenter:function(){this.setViewRect((this.realWidth-this.viewRect.width)/2,(this.realHeight-this.viewRect.height)/2,this.viewRect.width,this.viewRect.height)},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},invalidate:function(){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}))},validate:function(){if(!this._invalidate)return;if(!h&&this._view.offsetWidth===0&&this._view.offsetHeight===0)return;this._invalidate=!1,this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),this._isValidating=!1},onClickElement:function(a,b){},onClickBackground:function(a){},onDoubleClickElement:function(a,b){},onDoubleClickBackground:function(a){},onLongClickElement:function(a,b){},onLongClickBackground:function(a){},onMouseMove:function(a,b){},onMouseEnter:function(a,b){},onMouseLeave:function(a,b){}}),c.vector.Overview=function(a){c.vector.Overview.superClass.constructor.apply(this,a),this._view=s.createView(),this._rootDiv=s.createDiv(),this._imageCanvas=s.createCanvas(),this._imageDiv=s.createDiv(),this._maskCanvas=s.createCanvas(),this._selectDiv=s.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,s.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=s.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(a);var b;m.isMSToucheable?b=c.vector.OverviewMSTouchInteraction:m.isTouchable?b=c.vector.OverviewTouchInteraction:b=c.vector.OverviewInteraction,b&&new b(this)},d.ext("twaver.vector.Overview",c.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Se.OVERVIEW_FILL_COLOR,_outlineColor:Se.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Se.OVERVIEW_OUTLINE_WIDTH,_selectColor:Se.OVERVIEW_SELECT_COLOR,_selectWidth:Se.OVERVIEW_SELECT_WIDTH,_padding:Se.OVERVIEW_PADDING,_animate:Se.OVERVIEW_ANIMATE,_maxPackingWidth:Se.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Se.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){if(a===this._network)return;this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),s.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),s.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate()},_handleNetworkPropertyChange:function(a){(a.property==="zoom"||a.property==="currentSubNetwork"||a.property==="elementBox"||a.property==="dataBox"||a.property==="canvasSizeChange")&&this.invalidate()},_handleNetworkViewChange:function(a){a.kind==="validateEnd"&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){if(!this._isNetworkDirty||!this._isMaskDirty)this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),d.callLater(this.validate,this,null,a)},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,d.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&this._network.getViewRect().width!==0&&this._network.getViewRect().height!==0&&!this._network._invalidate){var a=this._maxPackingWidth>0&&this._maxPackingHeight>0,b;a?b={x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:b={x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},p.grow(b,-this._padding,-this._padding),a&&(s.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),b.width=this._imageDiv._viewRect.width,b.height=this._imageDiv._viewRect.height);var c=this._network.getGraphicsZoom(),d=this._network._unionBounds;d=p.unionRect(d,{x:this._network.getViewRect().x,y:this._network.getViewRect().y,width:d.x,height:d.y}),d={x:d.x/c,y:d.y/c,width:d.width/c,height:d.height/c};var e={x:this._network.viewRect.x/c,y:this._network.viewRect.y/c,width:this._network.viewRect.width/c,height:this._network.viewRect.height/c},f=p.unionRect(d,e),g=Math.min(b.width/f.width,b.height/f.height),h=f.width*g,i=f.height*g,j=f.width*g,k=f.height*g,l=b.x+(b.width-j)/2,m=b.y+(b.height-k)/2;if(this._isNetworkDirty){var n={x:l,y:m,width:j,height:k};this._network.toCanvas(h,i,this._exportImageCanvas,g,f.x*g,f.y*g),this._imageCanvas.setAttribute("width",j),this._imageCanvas.setAttribute("height",k),this._imageCtx.drawImage(this._exportImageCanvas,(d.x-f.x)*g*c,(d.y-f.y)*g*c,h,i),s.setDiv(this._imageDiv,n,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var o={x:(e.x-f.x)*g,y:(e.y-f.y)*g,width:e.width*g,height:e.height*g},q=s.setCanvas(this._maskCanvas,l,m,j,k);q.lineWidth=0,q.fillStyle=this._fillColor,t.drawVector(q,"rectangle",null,l,m,j,k),q.closePath(),q.fill(),q.stroke(),q.clearRect(l+o.x,m+o.y,o.width,o.height),q.lineWidth=this._outlineWidth,q.strokeStyle=this._outlineColor;var r=o.width-this._outlineWidth*2,u=o.height-this._outlineWidth*2;r=Math.min(r,j-2-o.x-this._outlineWidth),u=Math.min(u,k-2-o.y-this._outlineWidth),t.drawVector(q,"rectangle",null,l+o.x+this._outlineWidth,m+o.y+this._outlineWidth,r,u),q.closePath(),q.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return s.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;p.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network.getCanvasSize().width,(a.y-c.y)/c.height*this._network.getCanvasSize().height,b),this._invalidateMask())}}),c.vector.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,s.addEventListener("touchstart","handleTouchstart",this.view,this)},d.ext("twaver.vector.OverviewTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Ad.isMultiTouch(a)&&(this.distance=Ad.getDistance(a),this.zoom=this.network.getZoom()),s.addEventListener("touchmove","handleTouchmove",this.view,this),s.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a);if(Ad.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=Ad.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?d.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,s.removeEventListener("touchmove",this.view,this),s.removeEventListener("touchend",this.view,this)),this.moved=!1}}),c.vector.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[];var b=this;this.view.addEventListener("MSPointerDown",function(a){b.handleTouchstart(a)},!1),this.view.addEventListener("MSPointerMove",function(a){b.handleTouchmove(a)},!1),this.view.addEventListener("MSPointerUp",function(a){b.handleTouchend(a)},!1),this.view.addEventListener("MSPointerCancel",function(a){b.handleTouchend(a)},!1)},d.ext("twaver.vector.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){s.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),this._pointerIdArray
.length==1?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(this._pointerIdArray.length==0||!this._pointerMap[a.pointerId]||p.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)return;this._pointerMap[a.pointerId]=a;if(this._pointerIdArray.length==2){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(this._pointerIdArray.length==1&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(c==null)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(this._pointerIdArray.length==1&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&p.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?d.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return p.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),c.vector.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,s.addEventListener("mousedown","handleMousedown",this.view,this)},d.ext("twaver.vector.OverviewInteraction",Object,{handleMousedown:function(a){this.clear(),this.endPoint=this.overview.getLogicalPoint(a),d.isCtrlDown(a)&&(this.startPoint=this.endPoint,s.setVisible(this.overview._selectDiv,!0)),s.addEventListener("mousemove","handleMousemove",this.view,this),s.addEventListener("mouseup","handleMouseup",this.view,this)},handleMouseup:function(a){this.endPoint=this.overview.getLogicalPoint(a);if("detail"in a&&a.detail===2)d.callLater(this.network.zoomReset,this.network,[this.endPoint,this.overview._animate]);else if(s.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,e=this.overview._selectDiv._viewRect.y,f=b.width/this.overview._selectDiv._viewRect.width,g=b.height/this.overview._selectDiv._viewRect.height,h=Math.min(f,g);this.network.setZoom(h*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var i=this.network.getCanvasSize().width*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),j=this.network.getCanvasSize().height*((e-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);d.callLater(this.network.centerByLogicalPoint,this.network,[i,j,this.overview._animate]),s.setVisible(this.overview._selectDiv,!1),s.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);this.endPoint=b;if(s.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),s.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,s.removeEventListener("mousemove",this.view,this),s.removeEventListener("mouseup",this.view,this))}}),c.vector.ElementUI=function(a,b){this._network=a,this._element=b,this._attachments=new c.List,this._bodyBounds=new c.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},d.ext("twaver.vector.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(a){},handleSelectionChange:function(a){},invalidate:function(a){a===b&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0);if(this._invalidateFlag)return;this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this.invalidateZoom(),this.setAttachmentVisible&&this.setAttachmentVisible(!1)},invalidateZoom:function(){this._zoomBodyRect=null,this._zoomViewRect=null,this._zoomHotSpot=null},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){var a=this;if(this._invalidateFlag==0)return;this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(a){a.validate()});var b;this._bodyBounds.forEach(function(a){b=p.unionRect(b,a)}),b==null&&(b=d.cloneRect(this._element.getLocation()),b.width=0,b.height=0),this._unionBodyBounds={x:b.x,y:b.y,width:b.width,height:b.height},this._attachments.forEach(function(d){d instanceof c.vector.EditAttachment?d.getElementUI()instanceof c.vector.LinkUI?b=p.unionRect(b,d._viewRect):b=p.unionRect(b,a._network.zoomManager._reverseElementZoomRect(a,d._viewRect)):d.getElementUI()instanceof c.vector.LinkUI?b=p.unionRect(b,a._network.zoomManager._getAttachmentZoomOutLineRect(d,d._viewRect)):d.getElementUI()instanceof c.vector.GroupUI&&d.getElementUI()._shapeRect?d instanceof c.vector.IconsAttachment?b=p.unionRect(b,d._viewRect):b=p.unionRect(b,a._network.zoomManager._getAttachmentZoomOutLineRect(d,d._viewRect)):b=p.unionRect(b,d._viewRect)}),this._viewRect=b},validateImpl:function(){},setShadow:function(a,b){var c=this._network.zoomManager,d=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(b.shadowOffsetX===this._shadowXOffset&&b.shadowOffsetY===this._shadowYOffset&&b.shadowBlur===this._shadowBlur)return b;if(d){var e=c.getGraphicsZoom(),f=c.getSizeZoom();e*=f,e>1&&(e=1),b.shadowOffsetX=this._shadowXOffset*e,b.shadowOffsetY=this._shadowYOffset*e,b.shadowBlur=this._shadowBlur*e,b.shadowColor=this._shadowColor}return b},clearShadow:function(a){if(a.shadowOffsetX!=0||a.shadowOffsetY!=0||a.shadowBlur!=0)a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){var d=this._network.zoomManager,e=d.getGraphicsZoom(),f=d.getSizeZoom();e*=f,e>1&&(e=1),this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var g=this._shadowBlur;g=Math.ceil(g/e),p.grow(b,g+1,g+1)}return b},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&this._element.getStyle("select.style")==="shadow"?!0:!1},addAttachment:function(a){this._attachments.add(a),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),this.invalidate(!1)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkLabel2Attachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);a!=null&&a!==""?this._labelAttachment||(this._labelAttachment=new c.vector.LabelAttachment(this,Se.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var a=this._network.getLabel2(this._element);a!=null&&a!==""?this._label2Attachment||(this._label2Attachment=new c.vector.Label2Attachment(this,Se.SHOW_LABEL2_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);a!=null&&a!==""?this._alarmAttachment||(this._alarmAttachment=new c.vector.AlarmAttachment(this,Se.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new c.vector.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new c.vector.EditAttachment(this,Se.SHOW_EDIT_IN_ATTACHMENT_DIV),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:c.Defaults.FONT},paint:function(a){a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore();if(this._network.isDebug()){var b=this.getZoomViewRect();a.beginPath(),a.strokeStyle="#820F8D",a.lineWidth=1,a.strokeRect(b.x,b.y,b.width,b.height),a.stroke()}},paintBody:function(a){},getZoomBodyRect:function(a){return this._network.zoomManager._getElementZoomRect(this,this.getBodyRect())},getZoomHotSpot:function(){return this._zoomHotSpot||(this._zoomHotSpot=this._network.zoomManager._getZoomHotSpot(this,this._hotSpot)),d.clone(this._zoomHotSpot)},getZoomPointers:function(a,b){return this._network.zoomManager._getZoomPointers(a,this,b)},_getZoomViewRect:function(a,b,c){var e=this._network.zoomManager;if(b){var f=d.cloneRect(e._getAttachmentZoomRect(b,a));return f}var g=e.getLocationZoom(),h=e.getSizeZoom(this),i=this._bodyRect?this._bodyRect:this.getBodyRect();a=a||{x:i.x,y:i.y,width:0,height:0};var j=i.x+i.width/2,k=i.y+i.height/2;return{x:j*g+(a.x-j)*h,y:k*g+(a.y-k)*h,width:a.width*h,height:a.height*h}},getZoomViewRect:function(a){var b=this._network.zoomManager,e=b.getLocationZoom(),f=b.getGraphicsZoom();if(e==1)return d.cloneRect(this._viewRect);if(!this._zoomViewRect||a){var g=this._getZoomViewRect(d.cloneRect(this._unionBodyBounds),!1),h;h=p.unionRect(h,g);var i=this;this._attachments.forEach(function(a){a instanceof c.vector.EditAttachment?h=p.unionRect(h,a._viewRect):h=p.unionRect(h,a.getZoomViewRect())}),this._zoomViewRect=h}return d.cloneRect(this._zoomViewRect)},paintAttachments:function(a){a.beginPath();var b=this._attachments.size();for(var c=0;c<b;c++){var d=this._attachments.get(c);this._hitTest==1&&d.isShowOnTop()==0&&this.paintAttachment(a,d),this._intersectTest==1&&this.paintAttachment(a,d),this._hitTest==0&&this._intersectTest==0&&(d.isShowOnTop()?this._network._topAttachmentList.add(d):this.paintAttachment(a,d))}},paintAttachment:function(a,b){var c=this._network.zoomManager;if(!c.isAttachmentVisible(this._element))return;if((b==this._labelAttachment||b==this._label2Attachment)&&!c.isLabelVisible(this._element))return;if(b==this._alarmAttachment&&!c.isAlarmBalloonVisible(this._element))return;a.beginPath(),b.paint(a),this.clearShadow(a)},getViewRect:function(){return d.cloneRect(this._viewRect)},getUnionBodyBounds:function(){return d.cloneRect(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(a){return a==b&&(a=!0),this._bodyRect||(this._bodyRect=this.createBodyRect()),a?d.cloneRect(this._bodyRect):this._bodyRect},getHotSpot:function(){return this._hotSpot?d.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(a,b){return!1},intersects:function(a){return p.contains(a,this.getZoomViewRect())?!0:!1},hitCanvasRectAtBody:function(a){var b=af.getHitCanvas(a.width,a.height),c=af.getCtx(b);c.save(),c.translate(-a.x,-a.y);if(this._element.getImage){var e=d.getImageAsset(this._element.getImage());if(e&&e.getImage()instanceof Ve)return 1}this.paintBody(c);try{var f=c.getImageData(0,0,a.width,a.height),g=f.data;for(var h=0;h<f.width;h++)for(var i=0;i<f.height;i++){var j=4*(i*f.width+h),k=g[j+3];if(k!==0)return c.restore(),1}}catch(l){af.disposeHitCanvas();if(p.contains(this.getUnionBodyBounds(),a))return 0}return c.restore(),-1},hitCanvasRectAtAttachments:function(a){var b=af.getHitCanvas(a.width,a.height),c=af.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintAttachments(c);try{var d=c.getImageData(0,0,a.width,a.height),e=d.data;for(var f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(i!==0)return c.restore(),1}}catch(j){af.disposeHitCanvas()}return c.restore(),-1},hitCanvasRect:function(a){this._intersectTest=!0,this._hitTest==1&&(this._intersectTest=!1);var b=p.intersection(a,this.getZoomViewRect()),c=this.hitCanvasRectAtBody(b);if(c==1)return this._intersectTest=!1,!0;var d=this.hitCanvasRectAtAttachments(b);return d==1?(this._intersectTest=!1,!0):(this._intersectTest=!1,c==0)},hitCanvasPoint:function(a,b){if(!p.containsPoint(this.getZoomViewRect(),a,b))return!1;this._hitTest=!0;var c=this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2});return this._hitTest=!1,c},hitTest:function(a,b){if(!p.containsPoint(this.getZoomViewRect(),a,b))return null;var c={x:a-1,y:b-1,width:2,height:2},d=p.intersection(c,this.getZoomViewRect()),e=this.hitCanvasRectAtBody(d);if(e==1)return this;var f=this._attachments.size();for(var g=0;g<f;g++){var h=this._attachments.get(g);if(h.hit(a,b))return h}return e==0?this:null},dispose:function(){this._attachments.forEach(function(a){a.dispose()}),this._attachments.clear()}}),c.vector.NodeUI=function(a,b){c.vector.NodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.NodeUI",c.vector.ElementUI,{invalidate:function(a){this.curInterval&&clearInterval(this.curInterval),c.vector.NodeUI.superClass.invalidate.call(this,a)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){c.vector.NodeUI.superClass.validateImpl.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=p.getHotSpot(b.x,b.y,b.width,b.height,a),this.validateBodyBounds()},validate:function(){if(this._invalidateFlag==0)return;c.vector.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var a=this.getStyle("body.type");a==="default"?this.addBodyBounds(this.getDefaultBodyRect()):a==="vector"?this.addBodyBounds(this.getVectorBody()):a==="default.vector"?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):a==="vector.default"&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var a=this._element,b=this.getBodyRect();if(!a.getImage()||typeof a.getImage()=="string"&&!d.getImageAsset(a.getImage()))return b;p.addPadding(b,this._element,"image.padding",1);var c=d.cloneRect(b);return this.appendShadowBound(this,c),b=c,b},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(a){var b=this._element,c=b.getStyle(a+".width");if(c>0){var e=this.getBodyRect();p.addPadding(e,b,a+".padding",1);var f=d.cloneRect(e);return p.grow(f,c*2,c*2),f}return null},getPathRect:function(a,b){var c=this._element,e=this.getBodyRect(),f=this._network.zoomManager.getSizeZoom();b&&p.addPadding(e,c,a+".padding",1);var g=d.cloneRect(e),h=c.getStyle(a+".outline.width");if(h>0)if(this._getZoomPoints){var i=this._element._points,j=i.size(),k=0;for(var l=0;l<j;l++){if(l==0)var m=i.get(l),n=i.get(j-1),o=i.get(l+1);else if(l==j-1)var m=i.get(l),n=i.get(l-1),o=i.get(0);else var m=i.get(l),n=i.get(l-1),o=i.get(l+1);var q=p.getCenterPoint(n,o),r=p.getAngle(q,m),s=Math.abs(5*(h+1)*Math.sin(r));k=k<s?s:k,s=Math.abs(5*(h+1)*Math.cos(r)),k=k<s?s:k}p.grow(g,k,k)}else p.grow(g,h/2,h/2);return this.appendShadowBound(this,g),g},getZoomPathRect:function(a,b){var c=this._element,e=this.getZoomBodyRect(),f=this._network.zoomManager.getSizeZoom();b&&p.addPadding(e,c,a+".padding",1);var g=d.cloneRect(e),h=c.getStyle(a+".outline.width");if(h>0)if(this._getZoomPoints){var i=this._getZoomPoints(),j=i.size(),k=0;for(var l=0;l<j;l++){if(l==0)var m=i.get(l),n=i.get(j-1),o=i.get(l+1);else if(l==j-1)var m=i.get(l),n=i.get(l-1),o=i.get(0);else var m=i.get(l),n=i.get(l-1),o=i.get(l+1);var q=p.getCenterPoint(n,o),r=p.getAngle(q,m),s=Math.abs(5*(h+1)*Math.sin(r));k=k<s?s:k,s=Math.abs(5*(h+1)*Math.cos(r)),k=k<s?s:k}p.grow(g,k,k)}else p.grow(g,h/2,h/2);return this.appendShadowBound(this,g),g},paintBody:function(a){this.curInterval&&clearInterval(this.curInterval);var b=this.getStyle("body.type");b==="default"?this.drawDefaultBody(a):b==="vector"?this.drawVectorBody(a):b==="default.vector"?(this.drawVectorBody(a),this.drawDefaultBody(a)):b==="vector.default"&&(this.drawDefaultBody(a),this.drawVectorBody(a)),this._outerColor&&this.drawOuterBorder(a),this.getStyle("select.style")==="border"&&this._network.isSelected(this._element)&&this.drawSelectBorder(a)},drawOuterBorder:function(a){var b=this._element,c=b.getStyle("outer.width");if(c>0){var d=this.getZoomBodyRect();p.addPadding(d,b,"outer.padding",1),a.lineWidth=c,a.lineCap=b.getStyle("outer.cap"),a.lineJoin=b.getStyle("outer.join"),a.strokeStyle=this._outerColor,t.drawVector(a,b.getStyle("outer.shape"),null,d),a.stroke()}},drawDefaultBody:function(a){var b=this._element,e;if(!b.getImage()||typeof b.getImage()=="string"&&!(e=d.getImageAsset(b.getImage())))return;var f=this.getZoomBodyRect();p.addPadding(f,this._element,"image.padding",1),b.getAngle()!=0&&(a.save(),f=b.getOriginalRect(),f=this._network.zoomManager._getElementZoomRect(this,f),c.Util.rotateCanvas(a,f,b.getAngle())),this.setShadow(this,a);var g=this;if(e&&e.getImage()instanceof Ve){var h=e.getImage().frames,i=e.getImage().size,j=0,k;k=Xe(h,i,0),a.drawImage(k,f.x,f.y,f.width,f.height),this.curInterval=setInterval(function(){j=(j+h.length)%h.length,k=Xe(h,i,j),a.drawImage(k,f.x,f.y,f.width,f.height),j++},100)}else Od(a,b.getImage(),this.getInnerColor(),f,b,this._network);b.getAngle()!=0&&a.restore()},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var e=this.getZoomBodyRect();p.addPadding(e,b,"select.padding",1);var f=d.cloneRect(e);p.grow(f,c/2,c/2),a.lineWidth=c,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),t.drawVector(a,b.getStyle("select.shape"),null,e),a.stroke()}},drawVectorBody:function(a){this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("vector.deep"),d=this.getStyle("vector.fill.color");if(b!==0&&d&&this.getStyle("vector.shape")==="rectangle"){var e=this.getZoomBodyRect(),f=this._element.getAngle();if(f!=0){a.save();var g=this._element.getOriginalRect();g=this._network.zoomManager._getElementZoomRect(this,g),c.Util.rotateCanvas(a,g,f)}t.draw3DRect(a,d,b,e),f!=0&&a.restore()}},drawPath:function(a,b,d,e,f,g,h){var i=this._network.zoomManager,j=this._element,k=null;b=="group"?k=this._shapeRect:k=this.getZoomBodyRect(),d&&p.addPadding(k,j,b+".padding",1);var l=j.getStyle(b+".outline.width");this.setShadow(this,a),j.getAngle()!=0&&(j instanceof _e||(k=j.getOriginalRect(),k=i._getElementZoomRect(this,k)),a.save(),c.Util.rotateCanvas(a,k,j.getAngle()));var m=j.getStyle(b+".fill"),n;if(m){this._innerColor&&!wd.hasDefault(this._element)?n=this._innerColor:n=j.getStyle(b+".fill.color");var o=j.getStyle(b+".gradient");o?t.fill(a,n,o,j.getStyle(b+".gradient.color"),k):a.fillStyle=n}var q=j.getStyle(b+".shape");m&&(a.beginPath(),f?t.drawLinePoints(a,f,null,g,h):t.drawVector(a,q,null,k),a.fill()),l>0&&(a.lineWidth=l,a.lineCap=j.getStyle(b+".cap"),a.lineJoin=j.getStyle(b+".join"),a.strokeStyle=j.getStyle(b+".outline.color"),a.beginPath(),f?t.drawLinePoints(a,f,e,g,h):t.drawVector(a,q,e,k),a.stroke()),j.getAngle()!=0&&a.restore()},hit:function(a,b){if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(d.math.containsPoint(c,a,b))return!0}return p.containsPoint(this.getZoomViewRect(),a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=c.vector.NodeUI.superClass.intersects.apply(this,arguments);if(b==1)return!0;if(this._network._transparentSelectionEnable){var e=this.getBodyRect();if(d.math.intersects(e,a))return!0}return p.intersects(a,this.getZoomViewRect())?this.hitCanvasRect(a):!1}}),c.vector.LinkUI=function(a,b){c.vector.LinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.LinkUI",c.vector.ElementUI,{isEditable:function(){return yd.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,c.vector.LinkUI.superClass.invalidate.call(this,a)},invalidateZoom:function(){this._fromPoint=null,this._toPoint=null,this._linkPoints=null,c.vector.LinkUI.superClass.invalidateZoom.call(this)},validateImpl:function(){this.validateBodyBounds(),c.vector.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var a=this.getLinkPoints();if(!a||a.size()<2)return;var b=this._element,c=p.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=f*2}var g=!this._editAttachment&&b.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=h*2}p.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(this._network._edgeDetect?c=p.unionRect(c,De.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),0,0,this._network.zoomManager)):c=p.unionRect(c,De.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset"),this._network.zoomManager))),b.getStyle("arrow.to")&&(this._network._edgeDetect?c=p.unionRect(c,De.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),0,0,this._network.zoomManager)):c=p.unionRect(c,De.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"),this._network.zoomManager))),this.appendShadowBound(this,c),this.addBodyBounds(c),this._growLinkJoinBounds(c,e)},_growLinkJoinBounds:function(a,b){},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(a){var b=this.getLinkPoints();if(!b||b.size()<2)return;var c=this._element,d=c.getStyle("link.width"),e=d;if(this._outerColor){var f=c.getStyle("outer.width");e+=f*2}var g=!this._editAttachment&&c.getStyle("select.style")==="border"&&this._network.isSelected(this._element);if(g){var h=c.getStyle("select.width");e+=h*2}this.setShadow(this,a),a.lineCap=c.getStyle("link.cap"),a.lineJoin=c.getStyle("link.join");var i=c.getStyle("link.pattern");g&&this.drawLinePoints(a,b,e,c.getStyle("select.color"),i),this._outerColor&&this.drawLinePoints(a,b,d+f*2,this._outerColor,i),this.drawLinePoints(a,b,d,this._innerColor||c.getStyle("link.color"),i),De.drawLinkArrow(this,a,b,this._network.zoomManager)},drawLinePoints:function(a,b,c,d,e){a.lineWidth=c,a.strokeStyle=d;if(this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new vd(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset"),h=Math.floor(g/(e[0]+e[1]));h>2&&(g-=(e[0]+e[1])*h),this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),t._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var i=this._element.getStyle("link.flow.color");i=i?i:Se.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=i,t._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),t.drawLinePoints(a,b,e),a.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=p.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=yd.createFromPoint(this,this._network.zoomManager)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=yd.createToPoint(this,this._network.zoomManager)),this._toPoint},getZoomBodyRect:function(){return this.getBodyRect()},getZoomViewRect:function(){return this._viewRect},createLinkPoints:function(){var a=this._network.zoomManager,b=this.getStyle("link.type"),d=new c.List;if(yd.isOrthogonalOrFlexionalLink(this._element))d=yd.orthogonalAndFlexional(this,b,a);else if(this._element.isLooped()){var e=this._network.getElementUI(this._element.getFromAgent());e!=null&&(this._hotSpot=yd.fillLoopedPoints(this,e.getZoomBodyRect(),d))}else{if(b!=="arc"&&b!=="triangle"&&b!=="parallel")throw"Can not resolve link type '"+b+"'";var f=this.getFromPoint(),g=this.getToPoint();this._hotSpot=yd.fillBundlePoints(this,b,f,g,d,a)}if(this._network._linkPathFunction){var h=this._network._linkPathFunction(this,d);h&&(d=h)}return d},checkAttachments:function(){c.vector.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);a!=null&&a!==""?this._linkHandlerAttachment||(this._linkHandlerAttachment=new c.vector.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return yd.getControlPoint(this._element,this,this._network.zoomManager)},setControlPoint:function(a){if(!a)return;var b=this.getStyle("link.type");if(!yd.hasControlPoint(b))return;var c=yd.getLinkSourceBounds(this,this._network.zoomManager),d=yd.getLinkTargetBounds(this,this._network.zoomManager);yd.setParamsByControlPoint(a,c,d,b,this._element)},getLineLength:function(){return this._lineLength},hit:function(a,b){return p.containsPoint(this._viewRect,a,b)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=c.vector.NodeUI.superClass.intersects.apply(this,arguments);if(b==1)return!0;if(p.intersects(a,this._viewRect)==0)return!1;var d=this.getLinkPoints(),e=d.size();if(e==2)for(var f=0;f<e;f+=2){var g=d.get(f);if(f+1<e){var h=d.get(f+1);if(af.intersectsLine(g.x,g.y,h.x,h.y,a.x,a.y,a.width,a.height))return!0}}return this.hitCanvasRect(a)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=p.getAngle(this._fromPoint,this._toPoint)),this._angle||0},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var d=this._shadowBlur;p.grow(b,d+1,d+1)}return b}}),c.vector.GroupUI=function(a,b){c.vector.GroupUI.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.GroupUI",c.vector.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(a){this._shapeRect?this.drawExpandedGroup(a):c.vector.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect();if(this._shapeRect){var a=this.getPathRect("group",!1),b=this.getStyle("group.deep");p.grow(a,b+1,b+1),this.addBodyBounds(a)}else c.vector.GroupUI.superClass.validateBodyBounds.call(this)},getZoomBodyRect:function(){return this._element.isExpanded()?this.getBodyRect():c.vector.GroupUI.superClass.getZoomBodyRect.call(this)},getZoomViewRect:function(){return this._element.isExpanded()?this.getViewRect():c.vector.GroupUI.superClass.getZoomViewRect.call(this)},drawExpandedGroup:function(a){this.drawPath(a,"group",!1,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");b!==0&&c&&this.getStyle("group.shape")==="rectangle"&&t.draw3DRect(a,c,b,this._shapeRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element,b=this._network;if(a.isExpanded()){a.getChildren().forEach(function(a){var c=b.getElementUI(a);c&&c.validate()});var d=this.getChildrenRects();if(!d.isEmpty()){var e=a.getStyle("group.shape"),f=q[e];if(!f)throw"Can not resolve group shape '"+e+"'";this._shapeRect=f(d)}}return this._shapeRect?(p.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):c.vector.GroupUI.superClass.createBodyRect.call(this)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var d=this._shadowBlur;p.grow(b,d+1,d+1)}return b}}),c.vector.ShapeNodeUI=function(a,b){c.vector.ShapeNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.ShapeNodeUI",c.vector.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this._reverseZoomPathRect()},drawDefaultBody:function(a){if(this._element._points.size()<2)return;this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._getZoomPoints(),this._element._segments,this._element.getStyle("shapenode.closed")),De.drawLinkArrow(this,a,p.getPointObject(this._element._points,this._element._segments))},invalidateZoom:function(){this._zoomPoints=null,c.vector.LinkUI.superClass.invalidateZoom.call(this)},_getZoomPoints:function(){return this._zoomPoints=this._network.zoomManager._getShapeNodeZoomPoints(this,this._element._points),this._zoomPoints},_reverseZoomPathRect:function(){return this._network.zoomManager._reverseElementZoomRect(this,this.getZoomPathRect("vector",!0))}}),c.vector.ShapeLinkUI=function(a,b){c.vector.ShapeLinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.ShapeLinkUI",c.vector.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),e=new c.List,f=this.getStyle("shapelink.type");e.add(a),this._element._points!=null&&e.addAll(this._network.zoomManager
._getShapeLinkZoomPoints(this._element._points)),e.add(b);var g=e.size(),h=Math.ceil(g/2);if(g%2===0){var i=e.get(h),j=e.get(h-1);this._hotSpot={x:(i.x+j.x)/2,y:(i.y+j.y)/2}}else this._hotSpot=d.clone(e.get(h));var k,l,m;if(f!=="lineto")if(f==="quadto"){k=new c.List(e.get(0));for(l=1,g=e.size();l<g;l++)l<g-1?k.add(new c.List([e.get(l++),e.get(l)])):k.add(e.get(l));e=k}else if(f==="cubicto"){k=new c.List(e.get(0));for(l=1,g=e.size();l<g;l++)l<g-2?k.add(new c.List([e.get(l++),e.get(l++),e.get(l)])):l<g-1?k.add(new c.List([e.get(l++),e.get(l)])):k.add(e.get(l));e=k}else{if(f!=="orthogonalto")throw"Can not resolve shapelink type '"+f+"'";m=e.get(0),k=new c.List(m);for(l=1,g=e.size();l<g;l++)if(l<g-1){var n=d.clone(e.get(l)),o=n.x,p=n.y,q=o-m.x,r=p-m.y;Math.abs(q)>Math.abs(r)?(n.x=o,n.y=m.y):(n.x=m.x,n.y=p),m=n,k.add(m)}else k.add(e.get(l));e=k}return e},_growLinkJoinBounds:function(a,b){p.grow(a,b*3,b*3)}}),c.vector.GridUI=function(a,b){c.vector.GridUI.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.GridUI",c.vector.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?c.vector.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage())c.vector.GridUI.superClass.validateBodyBounds.call(this);else{var a=this.getBodyRect(),b=d.clone(a),e=this._element.getStyle("outer.width");p.grow(b,e,e),this.appendShadowBound(this,b),this.addBodyBounds(b)}},_getZoomCellRect:function(a,b){var c=this._element.getCellRect(a,b),d=this._element.getRect(),e=d.x+d.width/2,f=d.y+d.height/2,g=this.getZoomBodyRect(),h=g.width/d.width,i=g.x+g.width/2,j=e==0?1:i/e;return{x:e*j+(c.x-e)*h,y:f*j+(c.y-f)*h,width:c.width*h,height:c.height*h}},drawGridBody:function(a){var b=this.getStyle("grid.fill"),c=this.getStyle("grid.deep"),d=this.getStyle("grid.cell.deep");if(!b&&c===0&&d===0)return;a.beginPath();var e=this.getZoomBodyRect(),f=this.getDyeColor("grid.fill.color");this.setShadow(this,a),b&&(a.fillStyle=f,a.rect(e.x,e.y,e.width,e.height),a.fill()),a.closePath(),this.clearShadow(a),a.beginPath(),c!=0&&t.draw3DRect(a,f,c,e.x,e.y,e.width,e.height),a.closePath();if(d!=0){var g=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count");for(var i=0;i<g;i++)for(var j=0;j<h;j++){var k=this._getZoomCellRect(i,j);k!=null&&(a.beginPath(),t.draw3DRect(a,f,d,k.x,k.y,k.width,k.height),a.closePath())}}}}),c.vector.RotatableNodeUI=function(a,b){c.vector.RotatableNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.RotatableNodeUI",c.vector.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var a=this._element,b=d.getImageAsset(a.getImage()),c=this.getBodyRect();return b?(p.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(a){var b=this._element,c=d.getImageAsset(b.getImage());if(!c)return;var e=this.getBodyRect();p.addPadding(e,this._element,"image.padding",1);if(c.getImage()){var f=this._element._getOrignalWidth(),g=this._element._getOrignalHeight(),h=this._element._getRotateRect();a.save(),a.translate(e.x-h.x+f/2,e.y-h.y+g/2),a.rotate(this._element._angle*Math.PI/180),a.drawImage(c.getImage(this._innerColor),-f/2,-g/2,f,g),a.restore()}else if(!c.getSrc()&&!c.getFunction())throw"ImageAsset '"+b.getImage()+" ' is empty"}}),c.vector.HTMLNodeUI=function(a,b){c.vector.HTMLNodeUI.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.HTMLNodeUI",c.vector.NodeUI,{checkAttachments:function(){c.vector.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&a==="none"){c.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);return}var b=this._network.getLabel(this._element);b!=null&&b!==""?this._labelAttachment||(this._labelAttachment=new c.vector.HTMLLabelAttachment(this,Se.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&a==="none"){c.vector.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);return}var b=this._network.getAlarmLabel(this._element);b!=null&&b!==""?this._alarmAttachment||(this._alarmAttachment=new c.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(a){a?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),c.vector.HTMLLinkUI=function(a,b){c.vector.HTMLLinkUI.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.HTMLLinkUI",c.vector.LinkUI,{checkAttachments:function(){c.vector.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&a==="none"){c.vector.HTMLLinkUI.superClass.checkLabelAttachment.call(this);return}var b=this._network.getLabel(this._element);b!=null&&b!==""?this._labelAttachment||(this._labelAttachment=new c.vector.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&a==="none"){c.vector.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);return}var b=this._network.getAlarmLabel(this._element);b!=null&&b!==""?this._alarmAttachment||(this._alarmAttachment=new c.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),c.vector.Attachment=function(a,b){this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._showOnTop=b},d.ext("twaver.vector.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return d.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(a){},getZoomViewRect:function(){var a=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._viewRect);return a},hit:function(a,b){return p.containsPoint(this.getZoomViewRect(),a,b)?this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2}):!1},hitCanvasRect:function(a){var b=af.getHitCanvas(a.width,a.height),c=af.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paint(c);try{var d=c.getImageData(0,0,a.width,a.height),e=d.data;for(var f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(i!==0)return c.restore(),!0}}catch(j){af.disposeHitCanvas()}return c.restore(),!1},dispose:function(){}}),c.vector.BasicAttachment=function(a,b){c.vector.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},d.ext("twaver.vector.BasicAttachment",c.vector.Attachment,{paint:function(a){c.vector.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),d=this.getOutlineWidth(),e=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._roundRect);this.getElementUI().setShadow(this,a);if(d>0||b){t.drawRoundRect(a,e.x,e.y,e.width,e.height,this.getCornerRadius());if(this._pointers){var f=this._ui.getZoomPointers(this,this._pointers);a.moveTo(f[0].x,f[0].y),a.lineTo(f[1].x,f[1].y),a.lineTo(f[2].x,f[2].y)}a.closePath(),d>0&&(a.lineWidth=d,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke());if(b){var g=this.getFillColor(),h=this.getGradient();h?t.fill(a,g,h,this.getGradientColor(),this._viewRect):a.fillStyle=g,a.fill()}}},validate:function(){c.vector.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();if(a==null||a<=0)a=1;this._viewRect=p.getRect(this._pointers),this._viewRect=p.unionRect(this._viewRect,this._roundRect),a>0&&p.grow(this._viewRect,a*2,a*2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect);var b=this._element instanceof c.Link&&this._element.getStyle("link.label.rotatable");if(b){var d=this._viewRect.x+this._viewRect.width/2,e=this._viewRect.y+this._viewRect.height/2,f=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:d-f,y:e-f,width:f*2,height:f*2}}},calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+c,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h,!1);var l;if(k==="aboveleft")i.y=j.y-d-i.height,i.x=j.x-(i.width-c),l=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if(k==="aboveright")i.y=j.y-d-i.height,i.x=j.x-c,l=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if(k==="belowleft")i.y=j.y+d,i.x=j.x-(i.width-c),l=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if(k==="belowright")i.y=j.y+d,i.x=j.x-c,l=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if(k==="leftabove")i.y=j.y+c-i.height,i.x=j.x-d-i.width,l=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if(k==="leftbelow")i.y=j.y-c,i.x=j.x-d-i.width,l=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if(k==="rightabove")i.y=j.y+c-i.height,i.x=j.x+d,l=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if(k==="rightbelow")i.y=j.y-c,i.x=j.x+d,l=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if(k==="above")i.y=j.y-d-i.height,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y-d},{x:j.x+l,y:j.y-d}];else if(k==="below")i.y=j.y+d,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y+d},{x:j.x+l,y:j.y+d}];else if(k==="left")i.y=j.y-i.height/2,i.x=j.x-d-i.width,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+l},{x:j.x-d,y:j.y-l}];else{if(k!=="right")throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+l},{x:j.x+d,y:j.y-l}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h,!1),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var m=this.getPadding();m!=0&&p.grow(i,m,m),m=this.getPaddingLeft(),m!=0&&(i.x-=m,i.width+=m),m=this.getPaddingRight(),m!=0&&(i.width+=m),m=this.getPaddingTop(),m!=0&&(i.y-=m,i.height+=m),m=this.getPaddingBottom(),m!=0&&(i.height+=m),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},getContentWidth:function(){return c.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return c.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return c.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return c.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return c.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return c.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return c.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return c.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return c.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return c.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return c.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return c.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return c.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return c.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return c.Defaults.ATTACHMENT_FILL},getFillColor:function(){return c.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return c.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return c.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return c.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return c.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return c.Defaults.ATTACHMENT_CAP},getJoin:function(){return c.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return c.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return d.clone(this._roundRect)},getContentRect:function(){return d.clone(this._contentRect)}}),c.vector.LabelAttachment=function(a,b){c.vector.LabelAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.LabelAttachment",c.vector.BasicAttachment,{paint:function(a){var b=this._element instanceof c.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var d=this.getZoomViewRect(),e=d.x+d.width/2,f=d.y+d.height/2;a.translate(e,f),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-e,-f)}c.vector.LabelAttachment.superClass.paint.apply(this,arguments);var g=this._network.zoomManager,h=g._getAttachmentZoomRect(this,this._contentRect),i=this._element.getStyle("label.align");g._drawText(this,a,this.text,h,this.font,this.getStyle("label.color"),i),b&&a.restore();if(this._network.isDebug()){var j=g.getAttachmentSizeZoom(this),k=h;k.width*=j,k.height*=j,a.beginPath(),a.strokeStyle="red",a.lineWidth=2,a.strokeRect(k.x,k.y,k.width,k.height),a.stroke()}},validate:function(){this.font=this.getFont("label.font"),this.text=this.getLabel(),this._textSize=t.getTextSize(this.font,this.text),c.vector.LabelAttachment.superClass.validate.call(this)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},isShadowable:function(){return this.getStyle("label.shadowable")}}),c.vector.Label2Attachment=function(a,b){c.vector.Label2Attachment.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.Label2Attachment",c.vector.BasicAttachment,{paint:function(a){var b=this._element instanceof c.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var d=this.getZoomViewRect(),e=d.x+d.width/2,f=d.y+d.height/2;a.translate(e,f),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-e,-f)}c.vector.Label2Attachment.superClass.paint.apply(this,arguments);var g=this._network.zoomManager,h=g._getAttachmentZoomRect(this,this._contentRect),i=this._element.getStyle("label.align");g._drawText(this,a,this.text,h,this.font,this.getStyle("label2.color"),i),b&&a.restore();if(this._network.isDebug()){var j=g.getAttachmentSizeZoom(this),k=h;k.width*=j,k.height*=j,a.beginPath(),a.strokeStyle="red",a.lineWidth=2,a.strokeRect(k.x,k.y,k.width,k.height),a.stroke()}},validate:function(){this.font=this.getFont("label2.font"),this.text=this.getLabel(),this._textSize=t.getTextSize(this.font,this.text),c.vector.LabelAttachment.superClass.validate.call(this)},getLabel:function(){return this._network.getLabel2(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),c.vector.AlarmAttachment=function(a,b){c.vector.AlarmAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.AlarmAttachment",c.vector.BasicAttachment,{paint:function(a){c.vector.AlarmAttachment.superClass.paint.apply(this,arguments);var b=this._network.zoomManager,d=b._getAttachmentZoomRect(this,this._contentRect);b._drawText(this,a,this.text,d,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=t.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),c.vector.AlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return this._fillColor!=null},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),c.vector.LinkHandlerAttachment=function(a,b){c.vector.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.LinkHandlerAttachment",c.vector.BasicAttachment,{paint:function(a){var b=this._network.zoomManager;c.vector.LinkHandlerAttachment.superClass.paint.apply(this,arguments);var d=b._getAttachmentZoomRect(this,this._contentRect);b._drawText(this,a,this.linkHandlerLabel,d,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=t.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),c.vector.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),c.vector.IconsAttachment=function(a,b){c.vector.IconsAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.IconsAttachment",c.vector.Attachment,{isShadowable:function(){return c.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){c.vector.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element);if(!this.iconsNames||this.iconsNames.length==0)return;var a=this._makeGroup(this.iconsNames),b=this._makeGroup(this._network.getIconsColors(this._element)),d=this._network.zoomManager;len=a.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[],this.iconsOrientations=[];var e,f,g;for(i=0;i<len;i++){var h=a[i],g=this.iconsOrientation[i]||"right",j=this.iconsPosition[i]||"topleft.bottomright",k=this.iconsXgap[i]||1,l=this.iconsYgap[i]||1,m=this.iconsXoffset[i]||0,n=this.iconsYoffset[i]||0;f=null,e=this._getIconsSize(h,g,k,l,d),e&&(f=this._network.getPosition(j,this._ui,e,m,n),this._iconLocation=f,g==="top"?f.y+=e.height:g==="left"&&(f.x+=e.width)),this.locations.push(f),this.iconsSizes.push(e),this.iconsOrientations.push(g)}var o=null;for(i=0;i<this.locations.length;i++){f=this.locations[i],e=this.iconsSizes[i],g=this.iconsOrientations[i];if(f==null)continue;o==null?g==="top"?o={x:f.x,y:f.y-e.height,width:e.width,height:e.height}:g==="left"?o={x:f.x-e.width,y:f.y,width:e.width,height:e.height}:o={x:f.x,y:f.y,width:e.width,height:e.height}:g==="top"?o=p.unionRect(o,{x:f.x,y:f.y-e.height,width:e.width,height:e.height}):g==="left"?o=p.unionRect(o,{x:f.x-e.width,y:f.y,width:e.width,height:e.height}):o=p.unionRect(o,{x:f.x,y:f.y,width:e.width,height:e.height})}d?this._viewRect=o||this.getElementUI().getViewRect():this._viewRect=o||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=a,this.colorGroups=b},_makeGroup:function(a){if(!Array.isArray(a))return[[a]];var b=[],c=!1,d,e=a.length,f,g;for(d=0;d<e;d++)f=a[d],Array.isArray(f)?(c=!0,b.push(f)):(g=[f],b.push(g));return c||(b.length=0,b.push(a)),b},_makeArray:function(a,b,c){if(Array.isArray(a))return a;var d=[];for(var e=0;e<b;e++)d.push(a||c);return d},paint:function(a){c.vector.IconsAttachment.superClass.paint.apply(this,arguments);if(!this.iconsNames||this.iconsNames.length==0||!this.locations)return;var b=this._network.zoomManager,e,f,g,h,i,j,k,l,m,n;for(e=0;e<this.iconsGroups.length;e++){f=this.locations[e];if(!f)continue;i=f.x,j=f.y,h=this.iconsGroups[e],k=this.colorGroups[e],l=this.iconsOrientation[e],m=this.iconsXgap[e]||1,n=this.iconsYgap[e]||1,g=0;for(var o in h){var p=null,q=null;k&&k.length>g&&(q=k[g++]);var r=d.getImageAsset(h[o]);if(r==null)continue;if(b&&this._ui instanceof c.vector.GroupUI&&this._ui._shapeRect){var s=b.getAttachmentSizeZoom(this),t=r.getWidth()*s,u=r.getHeight()*s;if(l==="right")p={x:i,y:j,width:t,height:u},i+=p.width+m;else if(l==="left")p={x:i-t,y:j,width:t,height:u},i-=p.width+m;else if(l==="top")p={x:i,y:j-u,width:t,height:u},j-=p.height+n;else{if(l!=="bottom")throw"Can not resolve '"+l+"' orientation";p={x:i,y:j,width:t,height:u},j+=p.height+n}}else{if(l==="right")p={x:i,y:j,width:r.getWidth(),height:r.getHeight()},i+=p.width+m;else if(l==="left")p={x:i-r.getWidth(),y:j,width:r.getWidth(),height:r.getHeight()},i-=p.width+m;else if(l==="top")p={x:i,y:j-r.getHeight(),width:r.getWidth(),height:r.getHeight()},j-=p.height+n;else{if(l!=="bottom")throw"Can not resolve '"+l+"' orientation";p={x:i,y:j,width:r.getWidth(),height:r.getHeight()},j+=p.height+n}p=b._getAttachmentZoomOutLineRect(this,p)}Od(a,r.getImage(q,p.width,p.height),q,p,this._element,this._network)}}},_getIconsSize:function(a,b,e,f,g){var h=0,i=0,j=null,k=null,l=null;for(var m in a){k=d.getImageAsset(a[m]);if(!k)continue;if(b==="right")j={x:h,y:i,width:k.getWidth(),height:k.getHeight()},h+=j.width+e;else if(b==="left")j={x:h-k.getWidth(),y:i,width:k.getWidth(),height:k.getHeight()},h-=j.width+e;else if(b==="top")j={x:h,y:i-k.getHeight(),width:k.getWidth(),height:k.getHeight()},i-=j.height+f;else{if(b!=="bottom")throw"Can not resolve '"+b+"' orientation";j={x:h,y:i,width:k.getWidth(),height:k.getHeight()},i+=j.height+f}l==null?l=d.clone(j):l=p.unionRect(l,j)}return l?g&&this._ui instanceof c.vector.GroupUI&&this._ui._shapeRect?{width:Math.abs(l.width)*g.getAttachmentSizeZoom(this),height:Math.abs(l.height)*g.getAttachmentSizeZoom(this)}:{width:Math.abs(l.width),height:Math.abs(l.height)}:null}}),c.vector.EditAttachment=function(a,b){c.vector.EditAttachment.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.EditAttachment",c.vector.Attachment,{paint:function(a){c.vector.EditAttachment.superClass.paint.apply(this,arguments),this.paintResizingPoints(a),this.paintEditPoints(a),this.paintRotatePoints(a)},paintResizingPoints:function(a){var b=this.resizingPoints.size();if(b<=0)return;var d=this.resizePointSize*2,e=this.resizePointSize*2,f=this._network.getResizePointFillColor(),g=this._network.getResizePointOutlineWidth(),h=this._network.getResizePointOutlineColor(),i=this._element.getAngle(),j=this._network.zoomManager,k=j._getElementZoomRect(this.getElementUI(),this._element.getOriginalRect());a.lineWidth=g;var l=this.resizingPoints;for(var m=0;m<b;m++){var n=l.get(m),o={x:n.x-this.resizePointSize,y:n.y-this.resizePointSize,width:this.resizePointSize*2,height:this.resizePointSize*2},p=this._getRotateRect(o,i,{x:k.x+k.width/2,y:k.y+k.height/2});a.save(),c.Util.rotateCanvas(a,p,i),af.rect(a,p.x,p.y,d,e),a.restore()}a.fillStyle=f,a.strokeStyle=h,a.fill(),a.stroke();if(this._network.isDebug()){var q=this.getViewRect("resize");a.beginPath(),a.strokeStyle="red",a.lineWidth=1,a.strokeRect(q.x,q.y,q.width,q.height),a.stroke();var q=j._getElementZoomRect(this.getElementUI(),this.getElementUI()._viewRect);a.beginPath(),a.strokeStyle="#FD7766",a.lineWidth=1,a.strokeRect(q.x,q.y,q.width,q.height),a.stroke()}},paintEditPoints:function(a){var b=this.editPoints.size();if(b<=0)return;var c=this._network.getEditPointOutlineColor(),d=this._network.getEditPointFillColor(),e=this._network.getEditPointOutlineWidth();a.beginPath(),a.lineWidth=e;var f=this.editPoints;for(var g=0;g<b;g++){var h=f.get(g);a.beginPath(),af.circle(a,h.x,h.y,this.editPointSize,d,c),a.closePath()}if(this._network.isDebug()){var i=this.getViewRect("edit");a.beginPath(),a.strokeStyle="blue",a.lineWidth=1,a.strokeRect(i.x,i.y,i.width,i.height),a.stroke()}},paintRotatePoints:function(a){var b=this.rotatePoints.size();if(b<=0)return;var c=this._network.getRotatePointOutlineColor(),d=this._network.getRotatePointFillColor(),e=this._network.getRotatePointOutlineWidth();a.beginPath(),a.lineWidth=e;var f=this.rotatePoints;for(var g=0;g<b;g++){var h=f.get(g);a.beginPath(),af.circle(a,h.x,h.y,this.rotatePointSize,d,c),a.closePath(),a.beginPath()}if(this._network.isDebug()){var i=this.getViewRect("rotate");a.beginPath(),a.strokeStyle="green",a.lineWidth=1,a.strokeRect(i.x,i.y,i.width,i.height),a.stroke()}},getViewRect:function(a){if(a){if(a==="resize")return this._resizeRect;if(a==="rotate")return this._rotateRect;if(a==="edit")return this._editRect}return this._viewRect||{x:0,y:0,width:0,height:0}},validate:function(){c.vector.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new c.List,this.editPoints=new c.List,this.rotatePoints=new c.List,this._element instanceof c.Node&&this._addResizingPoint(this._element),this._network.isRotatable(this._element)&&this._element instanceof Ze&&!(this._element instanceof c.ShapeNode)&&!(this._element instanceof c.Grid)&&!(this._element instanceof c.Group)&&this._addRotatePoint(this._element),this._element instanceof c.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof c.vector.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof c.vector.LinkUI&&this._addLinkControlPoint(this._ui);var a=this._network.getResizePointOutlineWidth(),b=this.getElementUI().getZoomBodyRect(),d=2*Math.sqrt(2);this._resizeOffset=(this.resizePointSize+a+1)*d,p.grow(b,this._resizeOffset,this._resizeOffset),this._resizeRect=b,a=this._network.getEditPointOutlineWidth();if(this.editPoints.size()>0){var e=p.getRect(this.editPoints);p.grow(e,this.editPointSize*2+a*2),b=p.unionRect(b,e)}this._editRect=e,a=this._network.getRotatePointOutlineWidth();if(this.rotatePoints.size()>0){var f=this.rotatePoints.get(0),g={x:f.x-this.rotatePointSize-a-1,y:f.y-this.rotatePointSize-a-1,width:this.rotatePointSize*2+a*2+2,height:this.rotatePointSize*2+a*2+2};b=p.unionRect(b,g),this._rotateRect=g}this._viewRect=b},_addResizingPoint:function(a){var b=this._network.zoomManager._getElementZoomRect(this.getElementUI(),a.getOriginalRect());if(!b)return;var c=this._network
.getResizePointSize();if(c<=0)return;var d=new Ce([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),e=this._network.getResizePointOutlineWidth(),f=this._network.getResizePointOutlineColor(),g=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,e,f,g,!0)},_addRotatePoint:function(a){var b=this._network.zoomManager._getElementZoomRect(this.getElementUI(),a.getOriginalRect());if(!b)return;var d=this._network.getRotatePointSize();if(d<=0)return;var e=d*2,f=new c.List([{x:b.x+b.width/2,y:b.y-this._network.getRotatePointOffset()-e/2}]),g=a.getAngle();g!=0&&(f=this._rotatePointList(f,g,b));var h=f.get(0),i={x:h.x-e/2,y:h.y-e/2,width:e,height:e},j=this._network.getRotatePointOutlineWidth(),k=this.rotatePointSize+j;p.grow(b,k,k);var l=p.unionRect(a.getRect(),i);this.rotatePoints=f},_addShapeNodePoint:function(a){var b=this._network.zoomManager._getShapeNodeZoomPoints(this.getElementUI(),a.getPoints());this._addEditPoints(b)},_addShapeLinkPoints:function(a){var b=this._network.zoomManager._getShapeLinkZoomPoints(a.getPoints());this._addEditPoints(b)},_addLinkControlPoint:function(a){if(yd.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var d=new c.List;d.add(b),this._addEditPoints(d)}}},_addEditPoints:function(a){var b=p.getRect(a);if(!b)return;var c=this._network.getEditPointSize();if(c<=0)return;var d=this._network.getEditPointOutlineWidth();this._addPoints(b,a,d,!1)},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(g<0)return;var h=g+c;p.grow(a,h,h),f==1?this.resizingPoints=b:this.editPoints=b},_rotatePoint:function(a,b,c){var d=p.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,d){var e=this,f=new c.List;return a.forEach(function(a){f.add(e._rotatePoint(a,b,d))}),f},_getRotateRect:function(a,b,d){var e=p.createMatrix(b*Math.PI/180,d.x,d.y),f={x:a.x+a.width/2,y:a.y+a.height/2},g=e.transform(f),h=new c.List([{x:g.x-a.width/2,y:g.y-a.height/2},{x:g.x+a.width/2,y:g.y-a.height/2},{x:g.x+a.width/2,y:g.y+a.height/2},{x:g.x-a.width/2,y:g.y+a.height/2}]);return p.getRect(h)}}),c.vector.HTMLLabelAttachment=function(a,b){c.vector.HTMLLabelAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=c.Util.createDiv(),this._roundDiv=c.Util.createDiv(),this._contentDiv=c.Util.createDiv(),c.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),c.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),c.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),c.Util.setCSSStyle(this._contentDiv,"pointer-events","none");var d=this;this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},d.ext("twaver.vector.HTMLLabelAttachment",c.vector.LabelAttachment,{validate:function(){var a=this.getFont("label.font"),b=this.getLabel();this._contentDiv.innerHTML=b,this._contentDiv.style.visibility="hidden",c.vector.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;this.getElementUI().setShadow(this,a);if(c>0||b){t.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius());if(this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke());if(b){var f=this.getFillColor(),g=this.getGradient();g?t.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=this.getFont("label.font"),i=this.getLabel(),j=this._network.getViewRect().x,k=this._network.getViewRect().y,l=this._network.getZoom(),m={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},n=m.x*l-j-this._contentDiv.offsetWidth/2*l+"px",o=m.y*l-k-this._contentDiv.offsetHeight/2*l+"px";this._contentDiv.style.left=n,this._contentDiv.style.top=o,this._contentDiv.style.setProperty("-webkit-transform","scale("+l+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null);if(this._network._debug){var p=this._contentRect;a.beginPath(),a.strokeStyle="blue",a.lineWidth=5,a.strokeRect(p.x,p.y,p.width,p.height),a.stroke();var p=this._roundRect;a.beginPath(),a.strokeStyle="red",a.lineWidth=1,a.strokeRect(p.x,p.y,p.width,p.height),a.stroke();var p=this._viewRect;a.beginPath(),a.strokeStyle="green",a.lineWidth=2,a.strokeRect(p.x,p.y,p.width,p.height),a.stroke()}},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),c.vector.HTMLAlarmAttachment=function(a,b){c.vector.HTMLAlarmAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=c.Util.createDiv(),this._roundDiv=c.Util.createDiv(),this._contentDiv=c.Util.createDiv(),c.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),c.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),c.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),c.Util.setCSSStyle(this._contentDiv,"pointer-events","none");var d=this;this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},d.ext("twaver.vector.HTMLAlarmAttachment",c.vector.AlarmAttachment,{validate:function(){var a=this.getFont("alarm.font"),b=this._network.getAlarmLabel(this._element);this._contentDiv.innerHTML=b,this._contentDiv.style.visibility="hidden",c.vector.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(c.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),d=this.getOutlineWidth(),e=this._contentRect;this.getElementUI().setShadow(this,a);if(d>0||b){t.drawRoundRect(a,e.x,e.y,e.width,e.height,this.getCornerRadius());if(this._pointers){var f=this._ui.getZoomPointers(this,this._pointers);a.moveTo(f[0].x,f[0].y),a.lineTo(f[1].x,f[1].y),a.lineTo(f[2].x,f[2].y)}a.closePath(),d>0&&(a.lineWidth=d,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke());if(b){var g=this.getFillColor(),h=this.getGradient();h?t.fill(a,g,h,this.getGradientColor(),this._viewRect):a.fillStyle=g,a.fill()}}var i=this.getFont("alarm.font"),j=this._network.getAlarmLabel(this._element),k=this._network.getViewRect().x,l=this._network.getViewRect().y,m=this._network.getZoom(),n={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},o=n.x*m-k-this._contentDiv.offsetWidth/2*m+"px",p=n.y*m-l-this._contentDiv.offsetHeight/2*m+"px";this._contentDiv.style.left=o,this._contentDiv.style.top=p,this._contentDiv.style.setProperty("-webkit-transform","scale("+m+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null);if(this._network._debug){var q=this._contentRect;a.beginPath(),a.strokeStyle="blue",a.lineWidth=5,a.strokeRect(q.x,q.y,q.width,q.height),a.stroke()}c.vector.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),c.vector.BaseZoomManager=function(a){this.network=a,this.visibilityThresholds=a.visibilityThresholds},d.ext("twaver.vector.BaseZoomManager",Object,{getZoom:function(){return this.network.getZoom()},getGraphicsZoom:function(){return 1},getSizeZoom:function(a){return 1},getAttachmentSizeZoom:function(a){var b=a.getElementUI();return this.getSizeZoom(b)},getLocationZoom:function(){return 1},_getZoomVisibilityThresholds:function(){return this.network.getZoomVisibilityThresholds()},_convertPointFromView:function(a){var b=a.x*this.getGraphicsZoom()-this.network.getViewRect().x,c=a.y*this.getGraphicsZoom()-this.network.getViewRect().y;return{x:b,y:c}},_getElementViewRect:function(a,b){var c=this.getLocationZoom(),d=this.getSizeZoom(a);if(c==1&&d==1)return b;var e=this._getZoomPoint(a),f=e.x,g=e.y;return b==null&&console.log("View rect is null"),{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d,width:b.width*d,height:b.height*d}},_invalidateZoom:function(){this.network.invalidateElementUIs()},_getGroupChildrenRects:function(a){var b=new Ce;return a.getChildren().forEach(function(a){if(a instanceof Ze){var c=this.network.getElementUI(a);if(c){var d=c.getZoomViewRect(this);d&&b.add(d)}}},this),b},_zoomGraphicsBegin:function(a){var b=this.network,c=this.getGraphicsZoom();a.scale(c,c),a.translate(Math.floor(-b.viewRect.x/c),Math.floor(-b.viewRect.y/c))},_getEditZoomPoints:function(a,b){var d=this.getLocationZoom(),e=this.getSizeZoom(a);if(d==1&&e==1||a instanceof c.vector.LinkUI&&!(a instanceof c.vector.ShapeLinkUI))return b;var f;a instanceof c.vector.ShapeLinkUI?f=p.getCenterPoint(p.getRect(b)):f=this._getZoomPoint(a);var g=f.x,h=f.y;if(b.forEach){var i=new Ce,j;return b.forEach(function(a){a instanceof Ce?(j=new Ce,a.forEach(function(a){j.add({x:g*d+(a.x-g)*e,y:h*d+(a.y-h)*e})}),i.add(j)):i.add({x:g*d+(a.x-g)*e,y:h*d+(a.y-h)*e})}),i}if(b.x)return{x:g*d+(b.x-g)*e,y:h*d+(b.y-h)*e}},_getShapeNodeZoomPoints:function(a,b,c){var d=this.getLocationZoom(),e=this.getSizeZoom(a);if(d==1&&e==1)return b;c&&(d=1/d,e=1/e);var f=p.getRect(b),g=f.x+f.width/2,h=f.y+f.height/2,i=new Ce,j;return b.forEach(function(a){a instanceof Ce?(j=new Ce,a.forEach(function(a){j.add({x:g*d+(a.x-g)*e,y:h*d+(a.y-h)*e})}),i.add(j)):i.add({x:g*d+(a.x-g)*e,y:h*d+(a.y-h)*e})}),i},_getShapeLinkZoomPoints:function(a,b){var c=this.getLocationZoom(),d=c;if(c==1&&d==1)return a;b&&(c=1/c,d=1/d);var e=p.getRect(a),f=e.x+e.width/2,g=e.y+e.height/2,h=new Ce,i;return a.forEach(function(a){a instanceof Ce?(i=new Ce,a.forEach(function(a){i.add({x:f*c+(a.x-f)*d,y:g*c+(a.y-g)*d})}),h.add(i)):h.add({x:f*c+(a.x-f)*d,y:g*c+(a.y-g)*d})}),h},_getLogicalPoint:function(a,b){var c=b?this.getZoom():this.getGraphicsZoom(),d,e=this.network;if(m.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var f=e._view.getBoundingClientRect(),g=a.changedTouches[0],h=m.isAndroid?0:Ad.scrollLeft(),i=m.isAndroid?0:Ad.scrollTop();return d={x:(g.clientX+e.viewRect.x-f.left-h)/c,y:(g.clientY+e.viewRect.y-f.top-i)/c},d}return m.isFirefox?d={x:(a.layerX+e.viewRect.x)/c,y:(a.layerY+e.viewRect.y)/c}:d={x:(a.offsetX+e.viewRect.x)/c,y:(a.offsetY+e.viewRect.y)/c},d},_getVisibleRect:function(a){return a},_getElementZoomRect:function(a,b){var c=this.getLocationZoom(),e=this.getSizeZoom(a);if(c==1&&e==1)return d.cloneRect(b);var f=a!=null?this._getZoomPoint(a):{x:b.x+b.width/2,y:b.y+b.height/2},g=f.x,h=f.y;return{x:g*c+(b.x-g)*e,y:h*c+(b.y-h)*e,width:b.width*e,height:b.height*e}},_reverseElementZoomRect:function(a,b){var c=this.getLocationZoom(),e=this.getSizeZoom(a);if(c==1&&e==1)return d.cloneRect(b);var f=a!=null?this._getZoomPoint(a):{x:b.x+b.width/2,y:b.y+b.height/2},g=f.x,h=f.y;return{x:g+(b.x-g*c)/e,y:h+(b.y-h*c)/e,width:b.width/e,height:b.height/e}},_getZoomContentRect:function(a,d,e,f,g,h){var i=this.getSizeZoom(a.getElementUI()),j=this.getAttachmentSizeZoom(a),k=a.getElementUI();return h==b?k instanceof c.vector.GroupUI&&k._shapeRect?{x:f.x*g+(d.x-f.x)*1+(e.x-d.x)*j,y:f.y*g+(d.y-f.y)*1+(e.y-d.y)*j,width:e.width,height:e.height}:{x:f.x*g+(d.x-f.x)*i+(e.x-d.x)*j,y:f.y*g+(d.y-f.y)*i+(e.y-d.y)*j,width:e.width,height:e.height}:{x:f.x*g+(d.x-f.x)*i+(e.x-d.x)*j,y:f.y*g+(d.y-f.y)*i+(e.y-d.y)*j+h*(a.textHeight-4)*j,width:e.width,height:a.textHeight}},_getAttachmentZoomRect:function(a,d,e){var f=this.getLocationZoom(),g=a.getElementUI(),h=this.getSizeZoom(a.getElementUI()),i=this.getAttachmentSizeZoom(a),j=a._pointers;if(f==1&&i==1&&h==1)return e==b?d:{x:d.x,y:d.y+e*(a.textHeight-4),width:d.width,height:a.textHeight};var g=a.getElementUI(),k=this._getZoomPoint(g,a),l=k.x,m=k.y,n=a.getPosition?a.getPosition():"center",o=0,p=0,q=j?j[0]:df.get(n,d);return e==b?g instanceof c.vector.LinkUI||g instanceof c.vector.GroupUI&&g._shapeRect?this._getZoomContentRect(a,q,d,k,1):this._getZoomContentRect(a,q,d,k,f):this._getZoomContentRect(a,q,d,k,f,e)},_getZoomPoint:function(a,b){var d=a._element,e=0,f=0,g,h;if(d instanceof c.Follower&&d.getHost()&&d.getHost()instanceof c.Grid)return g=d.getHost(),h=g.getRect(),{x:h.x+h.width/2,y:h.y+h.height/2};h=a.getBodyRect();if(a instanceof c.vector.LinkUI&&b&&b.getPosition){var i=b.getXOffset(),j=b.getYOffset();if(b.getPosition()==="from")return a._fromPoint;if(b.getPosition()==="to")return a._toPoint}return{x:h.x+h.width/2,y:h.y+h.height/2}},_getZoomPointers:function(a,b,d){if(d){var e=this._getZoomPoint(b),f=this.getLocationZoom(),g=this.getSizeZoom(b),h=this.getAttachmentSizeZoom(a),i=d[0];return b instanceof c.vector.LinkUI?[{x:e.x+(i.x-e.x)*g,y:e.y+(i.y-e.y)*g},{x:e.x+(i.x-e.x)*g+(d[1].x-i.x)*h,y:e.y+(i.y-e.y)*g+(d[1].y-i.y)*h},{x:e.x+(i.x-e.x)*g+(d[2].x-i.x)*h,y:e.y+(i.y-e.y)*g+(d[2].y-i.y)*h}]:b instanceof c.vector.GroupUI&&b._shapeRect?[{x:e.x+(i.x-e.x)*1,y:e.y+(i.y-e.y)*1},{x:e.x+(i.x-e.x)*1+(d[1].x-i.x)*h,y:e.y+(i.y-e.y)*1+(d[1].y-i.y)*h},{x:e.x+(i.x-e.x)*1+(d[2].x-i.x)*h,y:e.y+(i.y-e.y)*1+(d[2].y-i.y)*h}]:[{x:e.x*f+(i.x-e.x)*g,y:e.y*f+(i.y-e.y)*g},{x:e.x*f+(i.x-e.x)*g+(d[1].x-i.x)*h,y:e.y*f+(i.y-e.y)*g+(d[1].y-i.y)*h},{x:e.x*f+(i.x-e.x)*g+(d[2].x-i.x)*h,y:e.y*f+(i.y-e.y)*g+(d[2].y-i.y)*h}]}},_getZoomHotSpot:function(a,b){if(b){var c=this._getZoomPoint(a),d=this.getLocationZoom(),e=this.getSizeZoom(a);return{x:c.x*d+(b.x-c.x)*e,y:c.y*d+(b.y-c.y)*e}}return null},limitZoom:function(a){return a},_isVisible:function(a){var b=this._getZoomVisibilityThresholds(),c=b[a],d;if(c!=null){var e=b.zoomName;e=="sizeZoom"?d=this.getSizeZoom():e=="locationZoom"?d=this.getLocationZoom():e=="graphicsZoom"?d=this.getGraphicsZoom():d=this.getZoom();if(d<c)return!1}return!0},isElementVisible:function(a){var b=this.getZoom(),d=this._isVisible("element",b);return d&&a instanceof c.Link?this.isLinkVisible(a):d},isLinkVisible:function(a){var b=this.getZoom();return this._isVisible("link",b)},isLabelVisible:function(a){var b=this.getZoom();return this._isVisible("label",b)},isAttachmentVisible:function(a){var b=this.getZoom();return this._isVisible("attachment",b)},isAlarmBalloonVisible:function(a){var b=this.getZoom();return this._isVisible("alarmBallon",b)},_getAttachmentOutLineWidth:function(a){return a.getOutlineWidth()},_getAttachmentZoomOutLineRect:function(a,b){var d=this.getLocationZoom(),e=this.getAttachmentSizeZoom(a);if(d==1&&e==1)return b;var f=this._getAttachmentZoomRect(a,b,null),g=a.getElement();return this.isAttachmentVisible(g)?(a instanceof c.vector.LabelAttachment||a instanceof c.vector.Label2Attachment)&&!this.isLabelVisible(g)?{x:f.x,y:f.x,width:0,height:0}:a instanceof c.vector.AlarmAttachment&&!this.isAlarmBalloonVisible(g)?{x:f.x,y:f.x,width:0,height:0}:{x:f.x,y:f.y,width:f.width*e,height:f.height*e}:{x:f.x,y:f.x,width:0,height:0}},_drawText:function(a,b,c,d,e,f,g){var h=this.getLocationZoom(),i=this.getAttachmentSizeZoom(a);h!=1&&i!=1?(b.translate(d.x,d.y),b.scale(i,i),t.drawText(b,c,{x:0,y:0,width:d.width,height:d.height},e,f,g),b.scale(1/i,1/i),b.translate(-d.x,-d.y)):t.drawText(b,c,d,e,f,g)},_getOffset:function(a,b){var c=this.getLocationZoom();return{x:(a.x-b.x)/c,y:(a.y-b.y)/c}}});var df={"topleft.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"topleft.topright":function(a){return{x:a.x,y:a.y+a.height}},"top.top":function(a){return{x:a.x+a.width/2,y:a.y+a.height}},"topright.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"topright.topright":function(a){return{x:a.x,y:a.y+a.height}},topleft:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},top:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},topright:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"topleft.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"topleft.bottomright":function(a){return{x:a.x,y:a.y}},"top.bottom":function(a){return{x:a.x+a.width/2,y:a.y}},"topright.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"topright.bottomright":function(a){return{x:a.x,y:a.y}},"left.left":function(a){return{x:a.x+a.width,y:a.y+a.height/2}},left:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"left.right":function(a){return{x:a.x,y:a.y+a.height/2}},center:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"right.left":function(a){return{x:a.x+a.width,y:a.y+a.height/2}},right:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"right.right":function(a){return{x:a.x,y:a.y+a.height/2}},"bottomleft.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"bottomleft.topright":function(a){return{x:a.x,y:a.y+a.height}},"bottom.top":function(a){return{x:a.x+a.width/2,y:a.y+a.height}},"bottomright.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"bottomright.topright":function(a){return{x:a.x,y:a.y+a.height}},bottomleft:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},bottom:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},bottomright:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"bottomleft.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"bottomleft.bottomright":function(a){return{x:a.x,y:a.y}},"bottom.bottom":function(a){return{x:a.x+a.width/2,y:a.y}},"bottomright.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"bottomright.bottomright":function(a){return{x:a.x,y:a.y}},from:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},to:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},get:function(a,b){if(!b)throw"rect can not be null";var c=df[a];if(c)return c(b);throw"Can not resolve '"+a+"' position"}};c.vector.PhysicalZoomManager=function(a){c.vector.PhysicalZoomManager.superClass.constructor.apply(this,arguments)},d.ext("twaver.vector.PhysicalZoomManager",c.vector.BaseZoomManager,{getGraphicsZoom:function(){return this.getZoom()},_invalidateZoom:function(){}}),c.vector.LogicalZoomManager=function(a,b){c.vector.LogicalZoomManager.superClass.constructor.apply(this,arguments),this.sizeChange=b},d.ext("twaver.vector.LogicalZoomManager",c.vector.BaseZoomManager,{getLocationZoom:function(){return this.getZoom()},getSizeZoom:function(a){return this.sizeChange?this.getZoom():1}}),c.vector.MixedZoomManager=function(a,b){c.vector.MixedZoomManager.superClass.constructor.call(this,a,b)},d.ext("twaver.vector.MixedZoomManager",c.vector.LogicalZoomManager,{}),function(){function g(a){e[a]=function(){return this.getZoom()>1?b[a].apply(this,arguments):d[a].apply(this,arguments)}}var b=c.vector.LogicalZoomManager.prototype,d=c.vector.PhysicalZoomManager.prototype,e=c.vector.MixedZoomManager.prototype;for(var f in d)typeof d[f]=="function"&&f!="constructor"&&(b.hasOwnProperty(f)||d.hasOwnProperty(f))&&g(f);e._invalidateZoom=function(){this.network.invalidateElementUIs()}}(),c.vector.interaction.BaseInteraction=function(a){this.network=a},d.ext("twaver.vector.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},getOffset:function(a,b){return this.network.getOffset(a,b)},convertPointFromView:function(a){return this.network.convertPointFromView(a)},convertFromUIToMarkerRect:function(a,b,c,d){var e=this.network.zoomManager,f=e.getLocationZoom(),g=e.getGraphicsZoom(),h=e.getSizeZoom(this.network.getElementUI(d));return{x:a.x*f*g-this.network.getViewRect().x+b*f*g,y:a.y*f*g-this.network.getViewRect().y+c*f*g,width:a.width*h*g,height:a.height*h*g}},getMarkerPoint:function(a){var b;if(m.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=a.changedTouches[0];return b={x:c.clientX,y:c.clientY},b}return m.isFirefox?b={x:a.layerX,y:a.layerY}:b={x:a.offsetX,y:a.offsetY},b},paint:function(a){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];s.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)s.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){if(a.button!==0)return;this._startLogical=this.network.getLogicalPoint2(a),this._startClient=s.getClientPoint(a),this._startLogical&&s.handle_mousedown(this,a)},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getGraphicsZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getGraphicsZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),c.vector.interaction.DefaultInteraction=function(a,b){c.vector.interaction.DefaultInteraction.superClass.constructor.call(this,a),this.lazyMode=b},d.ext("twaver.vector.interaction.DefaultInteraction",c.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout","keydown"),m.isFirefox?s.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):s.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),s.addEventListener("mouseup","handle_mouseup",a,this),s.addEventListener("dblclick","handleDoubleClicked",this.network.getView(),this),this._oldCursor=this.network.getView().style.cursor,this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this),this.network.getView().oncontextmenu=function(a){a.preventDefault()},this._createZoomDiv()},tearDown:function(){this.removeListener("mousedown","mousemove","mouseover","mouseout","mouseup","keydown"),m.isFirefox?s.removeEventListener("DOMMouseScroll",this.network.getView(),this):s.removeEventListener("mousewheel",this.network.getView(),this),s.removeEventListener("dblclick",this.network.getView(),this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.end(),this.network.removeMarker(this),this._zoomDiv=null},_createZoomDiv:function(){if(this._zoomDiv==null){this._zoomDiv=k.createElement("div"),this._zoomLabel=k.createElement("span"),this._zoomLabel.style.display="block",this._zoomLabel.style.textAlign="center";var b=k.createElement("button");b.innerHTML="Reset to default",this._zoomDiv.appendChild(this._zoomLabel),this._zoomDiv.appendChild(b);var c=Se,d=this._zoomDiv.style;d.position="absolute",d.color=c.TOOLTIP_COLOR,d.background=c.TOOLTIP_BACKGROUND,d.fontSize=c.TOOLTIP_FONT_SIZE,d.padding=c.TOOLTIP_PADDING,d.border=c.TOOLTIP_BORDER,d.borderRadius=c.TOOLTIP_BORDER_RADIUS,d.boxShadow=c.TOOLTIP_BOX_SHADOW,d.zIndex=c.TOOLTIP_ZINDEX,d.setProperty&&d.setProperty("-webkit-box-shadow",c.TOOLTIP_BOX_SHADOW,null);var e=this;b.onclick=function(a){e.network.setZoom(1),e._setZoomDivVisible(!1)};var f=this._zoomDiv,g=function(){f.style.opacity=parseFloat(f.style.opacity)-.05;if(parseFloat(f.style.opacity)<=.05){e._setZoomDivVisible(!1),f._clearTimeout=null;return}f._clearTimeout=setTimeout(f._clearFunc,100)};f._clearFunc=g,f.onmouseover=function(b){b||(b=a.event);var c=b.relatedTarget?b.relatedTarget:b.fromElement;while(c&&c!=f)c=c.parentNode;c!=f&&(f._clearTimeout&&(clearTimeout(f._clearTimeout),f._clearTimeout=null),f.style.opacity=1)},f.onmouseout=function(b){b||(b=a.event);var c=b.relatedTarget?b.relatedTarget:b.toElement;while(c&&c!=f)c=c.parentNode;c!=f&&(f._clearTimeout=setTimeout(f._clearFunc,10))}}},_isZoomDivVisible:function(){return this._zoomDiv!=null&&this._zoomDiv.parentNode!=null},_getZoomDiv:function(){return this._zoomDiv||this._createZoomDiv(),this._zoomDiv},_setZoomDivVisible:function(a,b,c){var d=this._getZoomDiv();if(a){this._zoomLabel.innerHTML=c,d.style.opacity=1,this._isZoomDivVisible()||this.network.getView().appendChild(d),d.style.left=Se.TOOLTIP_XOFFSET+"px",d.style.top=Se.TOOLTIP_YOFFSET+"px";var e=this;d._clearTimeout&&(clearTimeout(d._clearTimeout),d._clearTimeout=null),d._clearTimeout=setTimeout(d._clearFunc,250)}else d.parentNode&&d.parentNode.removeChild(d)},handleViewRectChange:function(a){(a.property=="viewRect"||a.property=="canvasSizeChange")&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){this.hThumbRect=null,this.vThumbRect=null;if(this.network.isScrollBarVisible()==0){this.repaint();return}var a=this.network.getViewRect().height,b=this.network.getViewRect().width,c=this.network.getViewRect().x,d=this.network.getViewRect().y,e=this.network.getCanvasSize(),f=this.network._unionBounds,g=f.x,h=f.y,i=f.width,j=f.height,k=e.width,l=e.height,m=b,n=a,o=!1,p=!1;if(c>g||b+c<k)p=!0;if(d>h||d+a<l)o=!0;var q=0,r=0,s=0,t=0,u=m,v=n,w,x,y,z=this.getScrollBarWidth();p&&(o&&(u-=z),t=z,r=n-z,c>g&&c+b>k?(w=c-g,w=w*u/(w+m),q=w,s=u-w):c<g&&c+b<k?(w=k-(c+b),w=u*w/(w+m),q=0,s=u-w):(x=c-g,y=k-(c+b),x=u*x/i,y=u*y/i,q=x,s=m-x-y),this.hThumbRect={x:q,y:r,width:s,height:t}),q=0,r=0,s=0,t=0,u=m,v=n,o&&(p&&(v-=z),s=z,q=m-z,d>h&&d+a>l?(w=d-h,w=v*w/(w+n),r=w,t=v-w):d<h&&d+a<l?(w=l-(d+a),w=v*w/(w+n),r=0,t=v-w):(x=d-h,y=l-(d+a),x=v*x/j,y=v*y/j,r=x,t=v-x-y),this.vThumbRect={x:q,y:r,width:s,height:t}),this.network.setHScrollBarVisible(this.hThumbRect!=null),this.network.setVScrollBarVisible(this.vThumbRect!=null),this.repaint()},scrollXOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d+f,e,c,b)},scrollYOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d,e+f,c,b)},handle_mouseover:function(a){if(this.scrollBarVisible==1)return;this.scrollBarVisible=!0,this.repaint()},handle_mouseout:function(a){if(this.scrollBarVisible==0)return;this.scrollBarVisible=!1,this.repaint(),this.end(a)},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup"),Dd.handleKeyDown(this.network,a)},handle_keyup:function(a){this.currentKeyEvent=null,this.removeListener("keyup")},start:function(b){this.end(b,!0),this.lastPoint=this.network.getLogicalPoint2(b),this.startPoint=this.network.getLogicalPoint2(b),this.lastPanPoint=this.getMarkerPoint(b),this.lazyMode&&(this.pressPoint=this.lastPoint),s.addEventListener("mousemove","handle_mousemove",a,this)},end:function(b,c){this.vBarDownPoint=null,this.hBarDownPoint=null,c||(this.network.getView().style.cursor=this._oldCursor);if(this.isMoving){if(this.lazyMode){if(this.dragPoint!=null&&this.pressPoint!=null){var d=this,e=function(){d.network.fireInteractionEvent({kind:"lazyMoveEnd",event:b}),d.network.setMovingElement(!1)},f=this.getOffset(this.dragPoint,this.pressPoint),g=f.x,h=f.y;this.network.moveSelectedElements(g,h,this.network.isLazyMoveAnimate(),e)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:b}));if(this.isParenting()){this.parent==null&&(this.parent=this.network.getCurrentSubNetwork());var d=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(d.parent)},this.network)}this.parentProcess(b,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null,this.repaint()}if(this.isSelecting&&this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var i=p.getRect([this.startPoint,this.endPoint]),j=this.network.getElementsAtRect(i,this.getIntersectMode(),this.network.getRectSelectFilter());if(j&&j.size()>0){var k=this.network.getSelectionModel(),l=k.toSelection();j.forEach(function(a){k.contains(a)?l.remove(a):l.add(a)},this),k.setSelection(l)}this.network.fireInteractionEvent({kind:"selectEnd",event:b})}this.network.setSelectingElement(!1),this.startPoint=null,this.endPoint=null,this.repaint()}this.isMouseDown=!1,s.removeEventListener("mousemove",a,this)},_isDragToSelect:function(a){return!this.network._dragToPan},handle_mousedown:function(a){var b=this.network;if(a.target!=b.getView()&&a.target!=b._topCanvas&&a.target!=b._rootCanvas)return;this.isMoving=!1,this.isSelecting=!1,this.hBarDownPoint=null,this.vBarDownPoint=null,this._setZoomDivVisible(!1);if(!this.network.isValidEvent(a)){var e=this.getMarkerPoint(a);this.start(a),this.vThumbRect!=null&&p.containsPoint(this.vThumbRect,e.x,e.y)&&(this.vBarDownPoint={x:a.screenX,y:a.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),this.hThumbRect!=null&&p.containsPoint(this.hThumbRect,e.x,e.y)&&(this.hBarDownPoint={x:a.screenX,y:a.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x);return}this.network.isFocusOnClick()&&c.Util.setFocus(this.network.getView());var f=this.network.getElementAt(a);!this.network.isSelectingElement()&&!this.network.isEditingElement()&&f!=null&&(this.network.isMovable(f)?this.isMoving=!0:this.network.getView().style.cursor="pointer",this.start(a));if(!this.network.isSelectingElement()&&!this.network.isEditingElement()){var g=this.network.getSelectionModel();f==null?(d.isCtrlDown(a)?this.isSelecting=!0:this._isDragToSelect(a)?(this.isSelecting=!0,g.clearSelection()):this.network.isRectSelectEnabled()&&(g.clearSelection(),this.network.getView().style.cursor="pointer"),this.start(a)):d.isCtrlDown(a)?g.contains(f)?g.removeSelection(f):g.appendSelection(f):g.contains(f)||g.setSelection(f)}this.handleClicked(a,f),this.isMouseDown=!0},handle_mousemove:function(a){this._setZoomDivVisible(!1);var b=this.network.getLogicalPoint2(a);if(!b)return;var c={x:a.screenX,y:a.screenY},e=this.network.getCanvasSize(),f=this.network.getViewRect().height,g=this.network.getViewRect().width,h=this.getScrollBarWidth();if(this.hBarDownPoint!=null){var i=c.x-this.hBarDownPoint.x;this.hBarDownPoint=c,this.network.setViewOffSet(i*e.width/(g-h),0);return}if(this.vBarDownPoint!=null){var j=c.y-this.vBarDownPoint.y;this.vBarDownPoint=c,this.network.setViewOffSet(0,j*e.height/(f-h));return}if(!this.network.isSelectingElement()&&!this.network.isEditingElement()&&this.isMoving&&this.isMouseDown&&!d.isCtrlDown(a)){var k=this.getOffset(b,this.lastPoint);this.xoffset=k.x,this.yoffset=k.y;if(Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?this.dragPoint==null?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a}):(this.network.moveSelectedElements(this.xoffset,this.yoffset),this.lastPoint=b,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))),this.parentProcess(a,!1),this.lazyMode&&(this.dragPoint=b),(this.lazyMode||this.isParenting())&&this.repaint()}else if(this.isSelecting&&(d.isCtrlDown(a)||this._isDragToSelect()))this.network.setSelectingElement(!0),this.endPoint==null?this.network.fireInteractionEvent({kind:"selectStart",event:a}):this.network.fireInteractionEvent({kind:"selectBetween",event:a}),this.endPoint=b,this.repaint();else if(!this.isMoving&&!this.isSelecting&&this.isMouseDown){if(!this.lastPanPoint||!this.network._dragToPan)return;var b=this.getMarkerPoint(a);if(!b)return;var l=b.x-this.lastPanPoint.x,m=b.y-this.lastPanPoint.y;this.network.panByOffset(-l,-m),this.lastPanPoint=b}else this.end(a)},handleMouseWheel:function(a){if(k.activeElement!==this.network.getView())return;if(!this.network._wheelToZoom){this._handleMouseWheelScroll(a);return}s.preventDefault(a);var b={x:a.offsetX||a.layerX,y:a.offsetY||a.layerY},c=this.network.getZoom();a.wheelDelta&&a.wheelDelta>0||a.detail&&a.detail<0?this.network.setZoom(c*1.1,b):this.network.setZoom(c/1.1,b),this._setZoomDivVisible(this.network.isZoomDivVisible(),a,"Zoom : "+parseFloat(this.network.getZoom().toFixed(4)))},_handleMouseWheelScroll:function(a){s.preventDefault(a);var b=!1,c=this._getVisibleScrollBar();c!=null&&(b=a.wheelDelta?a.wheelDelta>0:a.detail<0,c=="v"?this.scrollYOffset(b):this.scrollXOffset(b))},handle_mouseup:function(a){this.end(a)},isParenting:function(){return this.pressPoint&&this.currentKeyEvent!=null&&this.currentKeyEvent.keyCode===80},parentProcess:function(a,b){var c=null;this.parent=null;var d=this;if(!b&&this.isParenting
()){var e={},f=this.network.getLogicalPoint2(a);e.x=f.x-1,e.y=f.y-1,e.width=2,e.height=2;var g=this.network.getElementsAtRect(e,!0);if(g&&g.size()>0){var h=g.size();for(var i=0;i<h;i++){var j=g.get(i);if(!d.network.getElementBox().getSelectionModel().contains(j)){d.parent=j;break}}}}else this.parent=null;this.parent!=null&&(c=this.network.getElementUI(this.parent).getViewRect()),c!=null&&!b?this.parentRect=c:this.parentRect=null},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y},_getVisibleScrollBar:function(){return this.network.isScrollBarVisible()==0?null:this.vThumbRect!=null?"v":this.hThumbRect!=null?"h":null},paintScroll:function(a){if(this.network.isScrollBarVisible()==0)return;if(this.scrollBarVisible==0&&this.hBarDownPoint==null&&this.vBarDownPoint==null)return;var b=this.getScrollBarWidth(),c=this.network.getViewRect().height,d=this.network.getViewRect().width;a.save();var e,f=this.getScrollBarColor();this.hThumbRect!=null&&(e=a.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,0,c-b,d-b,b,b/2),this.paintRoundRect(a,e,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),this.vThumbRect!=null&&(e=a.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,d-b,0,b,c-b,b/2),this.paintRoundRect(a,e,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),a.restore()},paintRoundRect:function(a,b,c,d,e,f,g,h){a.beginPath(),a.globalAlpha=c,a.fillStyle=b,t.drawRoundRect(a,d,e,f,g,h),a.fill()},paint:function(a){this.paintScroll(a);if(this.network.isSelectingElement()){if(this.startPoint==null||this.endPoint==null)return;var b=this.convertPointFromView(this.startPoint),c=this.convertPointFromView(this.endPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=p.getRect([{x:d,y:e},{x:f,y:g}]);if(h!=null){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,af.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}else{if(this.lazyMode){if(this.pressPoint==null||this.dragPoint==null)return;a.beginPath();var k=this.getOffset(this.dragPoint,this.pressPoint),l=k.x,m=k.y,n=this.network.getMovableSelectedElements(),o=n.size(),q=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,i=this.network.getLazyMoveOutlineWidth(),r=this.network.getLazyMoveOutlineColor();a.strokeStyle=r,a.lineWidth=i,a.fillStyle=q;for(var s=0;s<o;s++){var t=n.get(s),u=this.network.getElementUI(t);if(u){var v=this.convertFromUIToMarkerRect(u.getViewRect(),l,m);af.rect(a,v.x,v.y,v.width,v.height)}}a.fill(),a.stroke()}if(this.parentRect){a.beginPath();var q=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,i=this.network.getLazyMoveOutlineWidth(),r=this.network.getLazyMoveOutlineColor();a.strokeStyle=r,a.lineWidth=i,a.fillStyle=q;var v=this.parentRect;af.rect(a,v.x,v.y,v.width,v.height),a.fill(),a.stroke()}}},handleClicked:function(a,b){Dd.handleClicked(this.network,a,b)},handleDoubleClicked:function(a){var b=this.network.getElementAt(a);Dd.handleDoubleClicked(this.network,a,b)}}),c.vector.interaction.CreateElementInteraction=function(a,b){b||(b=c.Node),c.Util.isTypeOf(b,c.Node)?this.elementFunction=function(a){var d=new b;return d instanceof c.Node&&d.setCenterLocation(a),d}:this.elementFunction=b,c.vector.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},d.ext("twaver.vector.interaction.CreateElementInteraction",c.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint2(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),c.vector.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,this.editPointSize=a.getEditPointSize(),this.resizePointSize=a.getResizePointSize(),this.rotatePointSize=a.getRotatePointSize(),c.vector.interaction.EditInteraction.superClass.constructor.call(this,a)},d.ext("twaver.vector.interaction.EditInteraction",c.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(a){if(this.lazyMode==1&&this.resizingRect!=null){a.lineWidth=this.network.getResizeLineWidth();var b=this.convertFromUIToMarkerRect(this.resizingRect,0,0,this.node);a.save(),c.Util.rotateCanvas(a,b,this.node.getAngle()),a.beginPath(),af.rect(a,b.x,b.y,b.width,b.height,null,this.network.getResizeLineColor()),a.restore()}this.isStartRotate&&this.showRotateScale(a)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(a.button!==0)return;if(d.isAltDown(a)&&!this.network.isEditingElement()){var b=this.network.getElementAt(a),e=this.network.getLogicalPoint2(a);if(b instanceof c.ShapeNode){var f=this.getPointIndex(this.network.getShapeNodeZoomPoints(b),e,!0);f>0&&(this._handle_mousedown(a),this.pointIndex=f,this.shapeNode=b,b.addPoint(e,f),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:f}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:f}))}if(b instanceof c.ShapeLink){var g=new c.List(b.getPoints()),h=this.network.getElementUI(b);g.add(h.getFromPoint(),0),g.add(h.getToPoint());var f=this.getPointIndex(g,e)-1;f>0&&(this._handle_mousedown(a),this.pointIndex=f,this.shapeLink=b,b.addPoint(e,f),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:f}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:f}))}return}if(!this.network.isEditingElement()||this.isStart||this.isStartRotate)return;this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?d.isAltDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?d.isAltDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a))},handle_mouseup:function(a){if(this.isStart){var b=this.network.getLogicalPoint2(a);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var d=this,e=new c.animate.AnimateBounds(this.node,this.resizingRect,function(){d.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:d.node,resizeDirection:d.resizeDirection})});c.animate.AnimateManager.start(e)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this._resetShapeNodePoints(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&b?(this._resetShapeLinkPoints(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&b&&(this._setLinkControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.clear()},handle_mousemove:function(a){if(!this.network.isValidEvent(a))return;if(this.isStartRotate&&this.node){this._handleRotateElement(a,this.node),this.network.isShowRotateScale()&&this.repaint();return}if(this.isStart){if(this.shapeNode&&this.pointIndex>=0){this._handleMovingShapeNodePoint(a);return}if(this.shapeLink&&this.pointIndex>=0){this._handleMovingShapeLinkPoint(a);return}if(this.node&&this.resizeDirection){this._handleResizing(a);return}if(this.linkUI){this._handleMovingLinkControlPoint(a);return}}if(this.network.isSelectingElement()||this.network.isMovingElement()||this.network.getSelectionModel().size()===0){this.clear();return}var b=this.network.getElementAt(a),d=this.network.getElementUI(b);if(!d||!d.getEditAttachment()){this.clear();return}var e=this.network.getLogicalPoint2(a);if(b instanceof c.Node){this.node=b;if(this._isEditingShapeNode(e)||this._isResizingNode(e)){this.network.setEditingElement(!0);return}if(this._isRotatingElement(e)){this.network.setRotatingElement(!0),this.network.setEditingElement(!0);return}}else if(b instanceof c.ShapeLink){this.shapeLink=b;if(this._isEditingShapeLink(e)){this.network.setEditingElement(!0);return}}else if(d instanceof c.vector.LinkUI&&yd.isOrthogonalLink(d._element)){this.linkUI=d;var f=this.linkUI.getControlPoint();f&&this._contains(e,f,this.editPointSize)&&(this._setCrossCursor(),this.network.setEditingElement(!0));return}this.clear()},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(b<=0)return!1;var c=this.network.zoomManager,d=this.network.getElementUI(this.node),e=c.getSizeZoom(d),f=c._getElementZoomRect(d,this.node.getOriginalRect()),g=this.node.getAngle();return this._isRotating(a,"crosshair",f,g,e)},_isRotating:function(a,b,c,d,e){var f=this.network.getRotatePointSize(),g={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-f},h=this._rotatePoint(g,d,c),i={x:h.x-f,y:h.y-f,width:f*2,height:f*2};return p.containsPoint(i,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint2(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=this.network.getZoomBodyRect(b),d=p.getCenterPoint(c);return Math.round(Math.atan2(d.x-a.x,a.y-d.y)*180/Math.PI+180)},_resetShapeNodePoints:function(a){var b=this.network.getShapeNodeZoomPoints(this.shapeNode);b.set(this.pointIndex,a);var c=this.network.getElementUI(this.shapeNode),d=this.network.zoomManager._getShapeNodeZoomPoints(c,b,!0);this.shapeNode.setPoints(d)},_handleMovingShapeNodePoint:function(a){var b=this.network.getLogicalPoint2(a);this._resetShapeNodePoints(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_resetShapeLinkPoints:function(a){var b=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink._points);b.set(this.pointIndex,a);var c=this.network.zoomManager._getShapeLinkZoomPoints(b,!0);this.shapeLink.setPoints(c)},_handleMovingShapeLinkPoint:function(a){var b=this.network.getLogicalPoint2(a);this._resetShapeLinkPoints(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_setLinkControlPoint:function(a){var b=this.linkUI.getControlPoint(),c=this.linkUI.getControlPoint(),d=this.network.zoomManager,e={x:a.x-c.x,y:a.y-c.y};b.x+=e.x,b.y+=e.y,this.linkUI.setControlPoint(b)},_handleMovingLinkControlPoint:function(a){var b=this.network.getLogicalPoint2(a);this._setLinkControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},convertFromUIToMarkerRect:function(a,b,c,d){var e=this.network.zoomManager,f=e.getLocationZoom(),g=e.getGraphicsZoom(),h=this.network.getElementUI(d),i=e.getSizeZoom(h),j=a.x+a.width/2,k=a.y+a.height/2,l=j-a.x,m=k-a.y;return{x:j*f*g-this.network.getViewRect().x+b*f*g-l*i*g,y:k*f*g-this.network.getViewRect().y+c*f*g-m*i*g,width:a.width*i*g,height:a.height*i*g}},_getReverseZoomPoint:function(a,b,c){var d=this.network.zoomManager,e=d.getLocationZoom(),f=d.getSizeZoom(this.network.getElementUI(a));return b.x*=e,b.y*=e,{x:b.x/e+(c.x-b.x)/f,y:b.y/e+(c.y-b.y)/f}},_getReverseZoomRect:function(a,b){var c=this.network.zoomManager,d=c.getLocationZoom(),e=c.getSizeZoom(f);if(d==e)return a;var f=this.network.getElementUI(b),g=f.getBodyRect(),h=g.x+g.width/2,i=g.y+g.height/2,j={x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e,width:a.width*e,height:a.height*e};return h=j.x+j.width/2,i=j.y+j.height/2,{x:h/d+(j.x-h)*e,y:i/d+(j.y-i)*e,width:a.width,height:a.height}},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),e=this.node.getWidth()/2,f=this.node.getHeight()/2,g={x:c.x+e,y:c.y+f},h={x:-e,y:-f},i={x:-e,y:f},j={x:e,y:f},k={x:e,y:-f},l={x:0,y:-f},m={x:e,y:0},n={x:0,y:f},o={x:-e,y:0},p=this._getReverseZoomPoint(this.node,d.clone(g),this._endLogical);this.resizeDirection==="northwest"&&(this._transformPoint(j,g,b),h.x=p.x,h.y=p.y,g.x=(h.x+j.x)/2,g.y=(h.y+j.y)/2,this._reversPoint(h,g,b),this._reversPoint(j,g,b),this.resizingRect={x:h.x,y:h.y,width:j.x-h.x,height:j.y-h.y});if(this.resizeDirection==="north"){var q={x:p.x,y:p.y};this._reversPoint(q,g,b),l.y=q.y-g.y,this._transformPoint(l,g,b),this._transformPoint(n,g,b),g.x=(l.x+n.x)/2,g.y=(l.y+n.y)/2,this._reversPoint(l,g,b),this._reversPoint(n,g,b),this.resizingRect={x:g.x-this.node.getWidth()/2,y:g.y-(n.y-l.y)/2,width:this.node.getWidth(),height:n.y-l.y}}this.resizeDirection==="northeast"&&(this._transformPoint(i,g,b),k.x=p.x,k.y=p.y,g.x=(i.x+k.x)/2,g.y=(i.y+k.y)/2,this._reversPoint(i,g,b),this._reversPoint(k,g,b),this.resizingRect={x:i.x,y:k.y,width:k.x-i.x,height:i.y-k.y});if(this.resizeDirection==="west"){var q={x:p.x,y:p.y};this._reversPoint(q,g,b),o.x=q.x-g.x,this._transformPoint(m,g,b),this._transformPoint(o,g,b),g.x=(m.x+o.x)/2,g.y=(m.y+o.y)/2,this._reversPoint(m,g,b),this._reversPoint(o,g,b),this.resizingRect={x:g.x-(m.x-o.x)/2,y:g.y-this.node.getHeight()/2,width:m.x-o.x,height:this.node.getHeight()}}if(this.resizeDirection==="east"){var q={x:p.x,y:p.y};this._reversPoint(q,g,b),m.x=q.x-g.x,this._transformPoint(m,g,b),this._transformPoint(o,g,b),g.x=(m.x+o.x)/2,g.y=(m.y+o.y)/2,this._reversPoint(m,g,b),this._reversPoint(o,g,b),this.resizingRect={x:g.x-(m.x-o.x)/2,y:g.y-this.node.getHeight()/2,width:m.x-o.x,height:this.node.getHeight()}}this.resizeDirection==="southwest"&&(this._transformPoint(k,g,b),i.x=p.x,i.y=p.y,g.x=(i.x+k.x)/2,g.y=(i.y+k.y)/2,this._reversPoint(i,g,b),this._reversPoint(k,g,b),this.resizingRect={x:i.x,y:k.y,width:k.x-i.x,height:i.y-k.y});if(this.resizeDirection==="south"){var q={x:p.x,y:p.y};this._reversPoint(q,g,b),n.y=q.y-g.y,this._transformPoint(l,g,b),this._transformPoint(n,g,b),g.x=(l.x+n.x)/2,g.y=(l.y+n.y)/2,this._reversPoint(l,g,b),this._reversPoint(n,g,b),this.resizingRect={x:g.x-this.node.getWidth()/2,y:g.y-(n.y-l.y)/2,width:this.node.getWidth(),height:n.y-l.y}}this.resizeDirection==="southeast"&&(this._transformPoint(h,g,b),j.x=p.x,j.y=p.y,g.x=(h.x+j.x)/2,g.y=(h.y+j.y)/2,this._reversPoint(h,g,b),this._reversPoint(j,g,b),this.resizingRect={x:h.x,y:h.y,width:j.x-h.x,height:j.y-h.y}),this.resizingRect=this._getReverseZoomRect(this.resizingRect,this.node),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){if(this.node instanceof c.ShapeNode){this.shapeNode=this.node;var b=this.network.getShapeNodeZoomPoints(this.node);for(var d=0,e=b.size();d<e;d++){var f=b.get(d);if(this._contains(a,f,this.editPointSize))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){var b=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink.getPoints());for(var c=0,d=b.size();c<d;c++){var e=b.get(c);if(this._contains(a,e,this.editPointSize))return this._setCrossCursor(),this.pointIndex=c,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(b<=0)return!1;var c=this.network.zoomManager,d=this.network.getElementUI(this.node),e=c._getElementZoomRect(d,this.node.getOriginalRect()),f=this.node.getAngle(),g={x:e.x,y:e.y},h=this._rotatePoint(g,f,e);return this._isResizing(a,h.x,h.y,"northwest","nwse-resize")?!0:(g={x:e.x+e.width/2,y:e.y},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"north","ns-resize")?!0:(g={x:e.x+e.width,y:e.y},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"northeast","nesw-resize")?!0:(g={x:e.x,y:e.y+e.height/2},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"west","ew-resize")?!0:(g={x:e.x+e.width,y:e.y+e.height/2},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"east","ew-resize")?!0:(g={x:e.x,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"southwest","nesw-resize")?!0:(g={x:e.x+e.width/2,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"south","ns-resize")?!0:(g={x:e.x+e.width,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=p.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){return this._contains(a,{x:b,y:c},this.resizePointSize)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=a<c?a:c,f=b<d?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:c*2,height:c*2};return p.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;var d=a.get(0),e;for(var f=1;f<a.size();f++){e=a.get(f);if(this.isPointOnLine(b,d,e,6))return f;d=e}return d=a.get(0),c&&this.isPointOnLine(b,d,e,6)?a.size():0},showRotateScale:function(a){var b=new c.List,e=this.network.getRotateScaleWidth(),f=this.network.getRotateScaleHeight(),g=this.network.getRotatePointSize(),h=this.node.getAngle(),i=this.network.zoomManager,j=this.network.getElementUI(this.node),k=i._getElementZoomRect(j,this.node.getOriginalRect()),l={x:k.x+k.width/2,y:k.y-this.network.getRotatePointOffset()-g},m=this._rotatePoint(l,h,k),n,o="13px Arial",p=h+"°",q,r,s,t,u=this.network.getViewRect();i.getLocationZoom()===1&&(a.translate(-u.x,-u.y),a.scale(this.network.getZoom(),this.network.getZoom())),this.node.getAngle()>=0&&this.node.getAngle()<=180?(q={x:m.x+g,y:m.y},r={x:q.x+e,y:q.y},s={x:r.x,y:r.y-f},t={x:q.x,y:s.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(q={x:m.x-g,y:m.y},r={x:q.x-e,y:q.y},s={x:r.x,y:r.y-f},t={x:q.x,y:s.y});var v=new c.List([q,r,s,t]),n=d.math.getRect(v);i.getLocationZoom()!==1&&(n.x-=u.x,n.y-=u.y),a.fillStyle=this.network.getRotateScaleFillColor(),a.fillRect(n.x,n.y,n.width,n.height),a.fillStyle=this.network.getRotateScaleFontColor(),a.textBaseline="middle",a.textAlign="center",a.font=o,a.fillText(p,n.x+n.width/2,n.y+n.height/2),i.getLocationZoom()===1&&(a.scale(1/this.network.getZoom(),1/this.network.getZoom()),a.translate(u.x,u.y))},isPointOnLine:function(a,b,c,d){d<0&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return e<=d&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}if(b>=360||b<=-360)b%=360;return b>22.5&&b<=67.5&&(c+=1),b<-22.5&&b>=-67.5&&(c-=1),b>67.5&&b<=112.5&&(c+=2),b<-67.5&&b>=-112.5&&(c-=2),b>112.5&&b<=157.5&&(c+=3),b<-112.5&&b>=-157.5&&(c-=3),b>157.5&&b<=202.5&&(c+=4),b<-157.5&&b>=-202.5&&(c-=4),b>202.5&&b<=247.5&&(c+=5),b<-202.5&&b>=-247.5&&(c-=5),b>247.5&&b<=292.5&&(c+=6),b<-247.5&&b>=-292.5&&(c-=6),b>292.5&&b<=337.5&&(c+=7),b<-292.5&&b>=-337.5&&(c-=7),c>8&&(c-=8),c<=0&&(c+=8),d[c]}}),c.vector.interaction.CreateLinkInteraction=function(a,b){b||(b=c.Link),c.Util.isTypeOf(b,c.Link)?this.linkFunction=function(a,d){var e=new b;return e instanceof c.Link&&(e.setFromNode(a),e.setToNode(d)),e}:this.linkFunction=b,c.vector.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},d.ext("twaver.vector.interaction.CreateLinkInteraction",c.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(a){a.beginPath();var b,c;a.lineWidth=this.network.getEditLineWidth();var d=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(b=this.network.getElementUI(this.currentNode).getZoomViewRect(!0),c=this.convertFromUIToMarkerRect(b,0,0),af.rect(a,c.x,c.y,c.width,c.height,null,d)),this.fromNode&&(b=this.network.getElementUI(this.fromNode).getZoomViewRect(!0),c=this.convertFromUIToMarkerRect(b,0,0),af.rect(a,c.x,c.y,c.width,c.height,null,d)),this.currentPoint&&this.paintLine(a),a.closePath()},convertFromUIToMarkerRect:function(a,b,c){var d=this.network.zoomManager,e=d.getGraphicsZoom();return{x:a.x*e-this.network.getViewRect().x+b*e,y:a.y*e-this.network.getViewRect().y+c*e,width:a.width*e,height:a.height*e}},getZoomNodeRectOrPoint:function(a,b){var c=this.network.getElementUI(a).getZoomBodyRect();return b?{x:c.x+c.width/2,y:c.y+c.height/2}:c},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.network.getElementUI(this.fromNode).getZoomBodyRect(),d=this.convertPointFromView({x:c.x+c.width/2,y:c.y+c.height/2}),e=d.x,f=d.y,g=this.currentPoint.x,h=this.currentPoint.y;a.strokeStyle=b,a.beginPath(),a.moveTo(e,f),a.lineTo(g,h),a.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(!this.network.isValidEvent(a))return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(!b)return;if(this.network.isMovingElement()||this.network.isEditingElement()){this.clear();return}var c=null;this.fromNode?(this.currentNode=this.getToNode(a,this.fromNode),this.currentPoint=b,this.repaint()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.repaint()))},getFromNode:function(a){return this.getNode(a)},getToNode:function(a,b){return this.getNode(a,b)},getNode:function(a,b){var c=this.network.getElementAt(a);return c instanceof Ze&&this.network.isLinkable(c,b)?c:null}}),c.vector.interaction.CreateShapeLinkInteraction=function(a,b){c.vector.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=c.ShapeLink),c.Util.isTypeOf(b,c.ShapeLink)?this.linkFunction=function(a,d,e){var f=new b;if(f instanceof c.ShapeLink){f.setFromNode(a),f.setToNode(d);if(e){var g=this.network.zoomManager;f.setPoints(g._getShapeLinkZoomPoints(e,!0))}}return f}:this.linkFunction=b},d.ext("twaver.vector.interaction.CreateShapeLinkInteraction",c.vector.interaction.CreateLinkInteraction,{clear:function(){this.points=null,c.vector.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){var b=this.network.getLogicalPoint2(a);if(!b)return;if(this.fromNode){this.toNode=this.currentNode;if(this.toNode){var d=this.createLink();d&&this.network.addElementByInteraction(d),this.clear()}else{this.points||(this.points=new c.List);if(this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()},paintLine:function(a){if(this.currentPoint){var b=new c.List,d;d=this.convertPointFromView(this.getZoomNodeRectOrPoint(this.fromNode,!0)),b.add(d,0);if(this.points&&this.points.size()>0){var e=this.points.size();for(var f=0;f<e;f++)d=this.convertPointFromView(this.points.get(f)),b.add(d)}d=this.currentPoint,b.add(d),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),t.drawLinePoints(a,b),a.stroke()}}}),c.vector.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=c.ShapeNode),c.Util.isTypeOf(b,c.ShapeNode)?this.shapeNodeFunction=function(a){var d=new b;if(d instanceof c.ShapeNode){var e=this.network.zoomManager,f=this.network.createElementUI(d);if(a){var g=e._getShapeNodeZoomPoints(f,a,!0);f.invalidateZoom(),d.setPoints(g)}}return d}:this.shapeNodeFunction=b,c.vector.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a)},d.ext("twaver.vector.interaction.CreateShapeNodeInteraction",c.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){var b=new c.List,d=this.points.size(),e;for(var f=0;f<d;f++)e=this.convertPointFromView(this.points.get(f)),b.add(e);e=this.convertPointFromView(this.currentPoint),b.add(e),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),t.drawLinePoints(a,b),a.stroke()}},handle_mousedown:function(a){var b=this.network.getLogicalPoint2(a);if(!b)return;if(a.detail===2){if(this.points){var d=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(d),this.clear();var e=this;setTimeout(function(){e.network.setEditingElement(!1)},0)}}else{this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new c.List);if(this.points.size()>0){var f=this.points.get(this.points.size()-1);if(f.x===b.x&&f.y===b.y)return}this.points.add(b)}this.repaint()},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint2(a),this.repaint())}}),c.vector.interaction.MagnifyInteraction=function(a,b,d,e){c.vector.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.scale=b||2,this.xRadius=d||100,this.yRadius=e||100,this.markCanvas=s.createCanvas()},d.ext("twaver.vector.interaction.MagnifyInteraction",c.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.addListener("mousewheel"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.removeListener("mousewheel"),this.network.removeMarker(this)},paint:function(a){if(this.point){var b=this.network.zoomManager,c=b.getLocationZoom(),d=b.getGraphicsZoom(),e=b.getSizeZoom(),f=this.network.getZoom(),g=this.xRadius/this.scale/d,h=this.yRadius/this.scale/d;if(this.mouseFlag==="mousewheel"){var i={x:this.zoomPoint.x-g,y:this.zoomPoint.y-h,width:g*2,height:h*2};this.network.toCanvasByRegion(i,this.scale*d,this.markCanvas,"white");var j={x:this.zoomPoint.x-this.xRadius-this.network.viewRect.x,y:this.zoomPoint.y-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}else{var i={x:this.point.x*c-g,y:this.point.y*c-h,width:g*2,height:h*2};this.network.toCanvasByRegion(i,this.scale*d,this.markCanvas,"white");var j={x:this.point.x*c*d-this.xRadius-this.network.viewRect.x,y:this.point.y*c*d-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}a.drawImage(this.markCanvas,j.x,j.y),a.beginPath(),a.arc(j.x+j.width/2,j.y+j.height/2,Math.min(i.width*d-1,i.height*d-1),0,Math.PI*2,!0),a.strokeStyle="black",a.stroke(),this.mouseFlag=null}},handle_mousemove:function(a){this.point=this.network.getLogicalPoint(a);if(!this.point)return;this.mouseFlag="mousemove",this.repaint()},handle_mousewheel:function(a){var b=this.network.zoomManager,c=b.getLocationZoom();c!==1&&(this.zoomPoint=this.network.getLogicalPoint2(a));if(!this.zoomPoint)return;this.mouseFlag="mousewheel",this.repaint()}}),c.vector.interaction.TouchInteraction=function(a){c.vector.interaction.TouchInteraction.superClass.constructor.call(this,a)},d.ext("twaver.vector.interaction.TouchInteraction",c.vector.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();s.addEventListener("touchstart","handleTouchstart",a,this),s.addEventListener("touchmove","handleTouchmove",a,this),s.addEventListener("touchend","handleTouchend",a,this),s.addEventListener("touchcancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();s.removeEventListener("touchstart",this.network.getView(),this),s.removeEventListener("touchmove",a,this),s.removeEventListener("touchend",a,this),s.removeEventListener("touchcancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){s.preventDefault(a);if(a.touches&&a.touches.length==1){var b=this.network.getLogicalPoint2(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b,this._startTouchClient=this.getMarkerPoint(a),c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null)}else a.touches&&a.touches.length==2&&(this._distance=Ad.getDistance(a),this._zoom=this.network.getZoom());this._touchCount=a.touches.length},handleTouchmove:function(a){s.preventDefault(a);if(this._touchCount==2&&a.touches&&a.touches.length==2){var b=Ad.getDistance(a)/this._distance;this.network.
setZoom(this._zoom*b,!1)}else if(this._touchCount==1&&a.touches&&a.touches.length==1)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint2(a),d=this.network.getElementAt(c);if(this.network.isMovingElement()||this._startTouchElement!=null&&this._startTouchElement==d&&this.network.getMovableSelectedElements().contains(d)){var e=c.x-this._startTouchPoint.x,f=c.y-this._startTouchPoint.y;this._startTouchPoint=c,this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}else{var g=this.getMarkerPoint(a),e=this._startTouchClient.x-g.x,f=this._startTouchClient.y-g.y;this.network.panByOffset(e,f),this._startTouchClient=g}}else{var h=this.network.getLogicalPoint2(a);if(!h)return;this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):this.network.fireInteractionEvent({kind:"selectStart",event:a}),this._moveTouchPoint=h,this.repaint()}},handleTouchend:function(a){s.preventDefault(a);if(this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=p.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){var f=new Date,g=this.network.getLogicalPoint2(a),h=this.network.getElementAt(this._startTouchPoint);g&&f.getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,g)<=20&&(h?this.network.getSelectionModel().contains(h)||this.network.getSelectionModel().setSelection(h):this.network.getSelectionModel().clearSelection(),Dd.handleClicked(this.network,a,h),this._endTouchTime&&f.getTime()-this._endTouchTime.getTime()<=500&&p.getDistance(this._endTouchPoint,g)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Dd.handleDoubleClicked(this.network,a,h)):(this._endTouchTime=f,this._endTouchPoint=g))}},paint:function(a){if(!this._startTouchPoint||!this._moveTouchPoint)return;var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=p.getRect([{x:d,y:e},{x:f,y:g}]);if(h!=null){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,af.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),c.vector.interaction.MSTouchInteraction=function(a){c.vector.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},d.ext("twaver.vector.interaction.MSTouchInteraction",c.vector.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();s.addEventListener("MSPointerDown","handleTouchstart",a,this),s.addEventListener("MSPointerMove","handleTouchmove",a,this),s.addEventListener("MSPointerUp","handleTouchend",a,this),s.addEventListener("MSPointerCancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();s.removeEventListener("MSPointerDown",a,this),s.removeEventListener("MSPointerMove",a,this),s.removeEventListener("MSPointerUp",a,this),s.removeEventListener("MSPointerCancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){this.network.isFocusOnClick()&&c.Util.setFocus(this.network._view);if(this.network.isSelectingElement()&&a.pointerType==a.MSPOINTER_TYPE_MOUSE)return;var b=this.network.getLogicalPoint2(a),e=new Date;a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a);if(this._pointerIdArray.length==1){var f=this.network.getElementAt(b);this._startTouchElement=f,this._startClientPoint={x:a.clientX,y:a.clientY};var g=this.network.getSelectionModel();f?d.isCtrlDown(a)?g.contains(f)?g.removeSelection(f):g.appendSelection(f):g.contains(f)||g.setSelection(f):d.isCtrlDown(a)||g.clearSelection(),Dd.handleClicked(this.network,a,f),this._startTouchTime&&this._startTouchPoint&&e.getTime()-this._startTouchTime.getTime()<=500&&p.getDistance(this._startTouchPoint,b)<=20?(Dd.handleDoubleClicked(this.network,a,f),this._doubleClick=!0):(s.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=e)}else this._pointerIdArray.length==2&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(this._startTouchPoint==null||this._pointerIdArray.length==0||!this._pointerMap[a.pointerId]||p.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)return;this._pointerMap[a.pointerId]=a;if(this._pointerIdArray.length==2){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.network.isSelectingElement()){var b=p.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);var f=-1;for(var g=0;g<this._pointerIdArray.length;g++)if(this._pointerIdArray[g]==a.pointerId){f=g;break}f>=0&&this._pointerIdArray.splice(f,1),delete this._pointerMap[a.pointerId],this._moveTouchPoint=null},_getDistance:function(){return p.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return this.network.getSelectMode()==="intersect"?!0:this.network.getSelectMode()==="contain"?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){var b={x:a.clientX,y:a.clientY};if(p.getDistance(this._startClientPoint,b)<3)return;if(this._startTouchPoint&&this._pointerIdArray.length==1){this._moveTouchPoint={x:this._startTouchPoint.x+(b.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(b.y-this._startClientPoint.y)/this.network.getZoom()};if(this._startTouchElement==null&&this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint2(a);if(!c)return;this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.repaint()}else{var d=this.network.getElementAt(this._moveTouchPoint);if(this._startTouchElement==null&&!this.network.isRectSelectEnabled()){var e=this._startClientPoint.x-b.x,f=this._startClientPoint.y-b.y;this.network.panByOffset(e,f)}else if(this.network.isMovingElement()||this._startTouchElement!=null&&d==this._startTouchElement&&this.network.getMovableSelectedElements().contains(d)){var e=this._moveTouchPoint.x-this._startTouchPoint.x,f=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}this._startClientPoint=b}}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}},paint:function(a){if(!this._startTouchPoint||!this._moveTouchPoint||this._startTouchElement||!this.network.isRectSelectEnabled())return;var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=p.getRect([{x:d,y:e},{x:f,y:g}]);if(h!=null){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,af.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}}),c.XmlSerializer=function(a,b,d){this.dataBox=a,this.settings=b?b:new c.SerializationSettings,this.filterFunction=d,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},d.ext("twaver.XmlSerializer",Object,{serialize:function(){return this.xmlString="<twaver version='"+c.Util.getVersion()+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</twaver>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()];this.xmlString+="<data class='"+a.getClassName()+"' ref='"+c+"'",this.settings.getPropertyType("id")!=null&&(this.xmlString+=" id='"+a.getId()+"'"),this.xmlString+=">\n",a.serializeXml(this,b),this.xmlString+="</data>\n"}a.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(a,b,c){var e=this.settings.getPropertyType(b);if(e){var f=d.getValue(a,b,e),g=d.getValue(c,b,e);f!==g&&this.serializeValue("p",b,f,g,e)}},serializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(b);if(d){var e=a.getStyle(b),f=c.getStyle(b);e!=f&&this.serializeValue("s",b,e,f,d)}},serializeClientXml:function(a,b,c){var d=this.settings.getClientType(b);if(d!=null){var e=a.getClient(b),f=c.getClient(b);e!=f&&this.serializeValue("c",b,e,f,d)}},serializeValue:function(a,b,c,d,e){if(c==null)this.xmlString+="	<"+a+" n='"+b+"' none=''/>\n";else if(e==="cdata")this.xmlString+="	<"+a+" n='"+b+"'><![CDATA["+c+"]]></"+a+">\n";else if(e==="data"){var f=this.refMap[c.getId()];f!=null&&(this.xmlString+="	<"+a+" n='"+b+"' ref='"+f+"'/>\n")}else if(e==="point"){if(!d||c.x!==d.x||c.y!==d.y)this.xmlString+="	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"'/>\n"}else e==="list.point"?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<p x='"+a.x+"' y='"+a.y+"'/>\n"},this),this.xmlString+="	</"+a+">\n"):e==="list.string"||e==="list.number"?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<s>"+a+"</s>\n"},this),this.xmlString+="	</"+a+">\n"):e==="rectangle"?this.xmlString+="	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"' w='"+c.width+"' h='"+c.height+"'/>\n":this.xmlString+="	<"+a+" n='"+b+"'>"+c+"</"+a+">\n"},deserialize:function(a,b){d.isDeserializing=!0,this.xmlString=a;var c=d.xml(a).documentElement;this.refMap={},this.idMap={};var e=new Ce,f=new Ce,g,h,i,j=c.getElementsByTagName("data"),k=j.length;for(i=0;i<k;i++){h=j[i];var l=h.getAttribute("class"),m=this.settings.getPropertyType("id");if(m&&h.hasAttribute("id")){var n=null;if(m==="string")n=h.getAttribute("id");else if(m==="int")n=parseInt(h.getAttribute("id"));else{if(m!=="number")throw"Unsupported id type '"+m+"'";n=parseFloat(h.getAttribute("id"))}if(h.getAttribute("action")==="remove"){this.dataBox.removeById(n);continue}g=this.dataBox.getDataById(n),g||(g=d.newInstance(l,n))}else g=d.newInstance(l);if(h.hasAttribute("ref")){var o=h.getAttribute("ref");this.refMap[o]=g}e.add(g),f.add(h),this.idMap[g.getId()]=g}this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),k=e.size();for(i=0;i<k;i++)g=e.get(i),h=f.get(i),g.deserializeXml(this,h);for(i=0;i<k;i++){g=e.get(i);if(this.dataBox.containsById(g.getId()))continue;b&&!g.getParent()&&g.setParent(b),this.dataBox.add(g)}this.settings.isDataBoxSerializable&&c.getElementsByTagName("dataBox").length===1&&this.dataBox.deserializeXml(this,c.getElementsByTagName("dataBox")[0]),d.isDeserializing=!1},deserializePropertyXml:function(a,b,c){var e=this.settings.getPropertyType(c);e&&d.setValue(a,c,this.deserializeValue(b,e))},deserializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientXml:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if(a.hasAttribute("@none"))return null;if(b==="string")return a.textContent;if(b==="number")return parseFloat(a.textContent);if(b==="boolean")return a.textContent==="true";if(b==="int")return parseInt(a.textContent);if(b==="point")return{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y"))};if(b==="data"){var c=a.getAttribute("ref"),d=this.refMap[c];return d?d:this.idMap[c]}var e,f,g,h;if(b==="list.point"){var i=new Ce,j=a.getElementsByTagName("p");e=j.length;for(h=0;h<e;h++){var k=j[h];i.add({x:parseFloat(k.getAttribute("x")),y:parseFloat(k.getAttribute("y"))})}return i}if(b==="list.string"){var l=new Ce;g=a.getElementsByTagName("s"),e=g.length;for(h=0;h<e;h++)l.add(g[h].textContent);return l}if(b==="list.number"){f=new Ce,g=a.getElementsByTagName("s"),e=g.length;for(h=0;h<e;h++)f.add(parseFloat(g[h].textContent));return f}if(b==="array.string")return a.textContent.split(",");if(b==="array.number"){f=a.textContent.split(","),e=f.length;for(h=0;h<e;h++)f[h]=parseFloat(f[h]);return f}return b==="rectangle"?{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y")),width:parseFloat(a.getAttribute("w")),height:parseFloat(a.getAttribute("h"))}:a.textContent}}),d.addMethod(c.Data,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b),this.serializePropertyXml(a,"parent",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c=b.getElementsByTagName("p"),d=c.length,e,f,g,h;for(e=0;e<d;e++)f=c[e],f.hasAttribute("n")&&this.deserializePropertyXml(a,f,f.getAttribute("n"));if(a.settings.isClientSerializable){g=b.getElementsByTagName("c"),d=g.length;for(e=0;e<d;e++)h=g[e],h.hasAttribute("n")&&this.deserializeClientXml(a,h,h.getAttribute("n"))}},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),d.addMethod(c.Element,{serializeXml:function(a,b){if(a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleXml(a,d,b);c.Element.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"layerId",b),this._alarmState.getHighestNativeAlarmSeverity()&&a.settings.getPropertyType("alarmState")==="alarmstate"&&(a.xmlString+="	<p n='alarmState'>\n",c.AlarmSeverity.forEach(function(b){var c=this.getNewAlarmCount(b);c>0&&(a.xmlString+="		<n n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),c.AlarmSeverity.forEach(function(b){var c=this.getAcknowledgedAlarmCount(b);c>0&&(a.xmlString+="		<a n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),a.xmlString+="	</p>\n")},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeXml:function(a,b){c.Element.superClass.deserializeXml.call(this,a,b);if(a.settings.isStyleSerializable){var d=b.getElementsByTagName("s"),e=d.length,f,g;for(f=0;f<e;f++)g=d[f],g.hasAttribute("n")&&this.deserializeStyleXml(a,g,g.getAttribute("n"))}},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializePropertyXml:function(a,b,d){if(d==="alarmState"){if(a.settings.getPropertyType("alarmState")==="alarmstate"){var e,f,g,h,i=b.getElementsByTagName("n");for(g=0;g<i.length;g++)h=i[g],f=c.AlarmSeverity.getByName(h.getAttribute("n")),this._alarmState.setNewAlarmCount(f,parseInt(h.getAttribute("c")));i=b.getElementsByTagName("a");for(g=0;g<i.length;g++)h=i[g],f=c.AlarmSeverity.getByName(h.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(f,parseInt(h.getAttribute("c")))}}else c.Element.superClass.deserializePropertyXml.call(this,a,b,d)}}),d.addMethod(Ze,{serializeXml:function(a,b){Ze.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"image",b),this.serializePropertyXml(a,"location",b),d.num(this._width)&&this._width>=0&&this.serializePropertyXml(a,"width",b),d.num(this._height)&&this._height>=0&&this.serializePropertyXml(a,"height",b)}}),d.addMethod(c.Link,{serializeXml:function(a,b){c.Link.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"fromNode",b),this.serializePropertyXml(a,"toNode",b)}}),d.addMethod(c.Follower,{serializeXml:function(a,b){c.Follower.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"host",b)}}),d.addMethod(_e,{serializeXml:function(a,b){_e.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"expanded",b)}}),d.addMethod(c.ShapeNode,{serializeXml:function(a,b){c.ShapeNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b),this.serializePropertyXml(a,"segments",b)}}),d.addMethod(c.ShapeLink,{serializeXml:function(a,b){c.ShapeLink.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b)}}),d.addMethod(c.RotatableNode,{serializeXml:function(a,b){c.RotatableNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"angle",b)}}),d.addMethod(c.DataBox,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c=b.getElementsByTagName("p"),d=c.length,e,f,g,h;for(e=0;e<d;e++)f=c[e],f.hasAttribute("n")&&this.deserializePropertyXml(a,f,f.getAttribute("n"));if(a.settings.isClientSerializable){g=b.getElementsByTagName("c"),d=g.length;for(e=0;e<d;e++)h=g[e],h.hasAttribute("n")&&this.deserializeClientXml(a,h,h.getAttribute("n"))}},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),d.addMethod(c.ElementBox,{serializeXml:function(a,b){a.settings.isLayerBoxSerializable&&(a.xmlString+="	<layerBox>\n",this._layerBox.forEachByDepthFirst(function(b){this._layerBox.getDefaultLayer()===b?a.xmlString+="		<layer ":a.xmlString+="		<layer id='"+b.getId()+"' ",b.getName()&&(a.xmlString+="name='"+b.getName()+"' "),a.xmlString+="visible='"+b.isVisible()+"' editable='"+b.isEditable()+"' movable='"+b.isMovable()+"'/>\n"},null,this),a.xmlString+="	</layerBox>\n");if(a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleXml(a,d,b);c.ElementBox.superClass.serializeXml.call(this,a,b)},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializeXml:function(a,b){c.ElementBox.superClass.deserializeXml.call(this,a,b);if(a.settings.isLayerBoxSerializable&&b.getElementsByTagName("layerBox").length==1){this._layerBox.clear();var d=b.getElementsByTagName("layerBox")[0].getElementsByTagName("layer");for(var e=0;e<d.length;e++){var f=d[e],g;if(f.hasAttribute("id")){var h=a.settings.getPropertyType("layerId");if(h==="string")g=new c.Layer(f.getAttribute("id"));else if(h==="int")g=new c.Layer(parseInt(f.getAttribute("id")));else{if(h!=="number")throw"Unsupported layer id type '"+h+"'";g=new c.Layer(parseFloat(f.getAttribute("id")))}this._layerBox.add(g)}else g=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(g);f.hasAttribute("name")&&g.setName(f.getAttribute("name")),f.hasAttribute("visible")&&g.setVisible(f.getAttribute("visible")==="true"),f.hasAttribute("editable")&&g.setEditable(f.getAttribute("editable")==="true"),f.hasAttribute("movable")&&g.setMovable(f.getAttribute("movable")==="true")}}if(a.settings.isStyleSerializable){var i=b.getElementsByTagName("s"),j=i.length;for(var e=0;e<j;e++){var k=i[e];k.hasAttribute("n")&&this.deserializeStyleXml(a,k,k.getAttribute("n"))}}}}),c.JsonSerializer=function(a,b,d){this.dataBox=a,this.settings=b?b:new c.SerializationSettings,this.filterFunction=d,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},d.ext("twaver.JsonSerializer",Object,{serialize:function(){return this.jsonObject={version:c.Util.getVersion(),platform:"html5"},this.settings.isImageSerializable&&(this.jsonObject.images={}),this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this);if(this.settings.isDataBoxSerializable){var a={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=a,this.dataBox.serializeJson(this,this.dataBox.newInstance(),a),d.isEmptyObject(a.p)&&delete a.p,d.isEmptyObject(a.s)&&delete a.s,d.isEmptyObject(a.c)&&delete a.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()],e={"class":a.getClassName(),ref:c,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=a.getId()),this.jsonObject.datas.push(e),a.serializeJson(this,b,e),d.isEmptyObject(e.p)&&delete e.p,d.isEmptyObject(e.s)&&delete e.s,d.isEmptyObject(e.c)&&delete e.c;if(this.settings.isImageSerializable&&a.getImage){var f=a.getImage();if(typeof f=="string"&&!cf[f]&&!this.jsonObject.images[f]){var g=d.getImageAsset(f),h=g&&g.getImage();h&&!ee(h)&&(this.jsonObject.images[f]=h)}}}a.getChildren().forEach(this.serializeData,this)},serializePropertyJson:function(a,b,c,e){var f=this.settings.getPropertyType(b);if(f){var g=d.getValue(a,b,f),h=d.getValue(c,b,f);g!==h&&this.serializeValue(b,g,h,f,e.p)}},serializeStyleJson:function(a,b,c,d){var e=this.settings.getStyleType(b);if(e){var f=a.getStyle(b),g=c.getStyle(b);f!=g&&this.serializeValue(b,f,g,e,d.s)}},serializeClientJson:function(a,b,c,d){var e=this.settings.getClientType(b);if(e!=null){var f=a.getClient(b),g=c.getClient(b);f!=g&&this.serializeValue(b,f,g,e,d.c)}},serializeValue:function(a,b,c,d,e){if(b==null)e[a]=null;else if(b instanceof Ce)e[a]=b._as;else if(d==="data"){var f=this.refMap[b.getId()];f!=null&&(e[a]=f)}else e[a]=b},deserialize:function(a,b){d.isDeserializing=!0,this.jsonObject=JSON.parse(a);var c=this.jsonObject.images;this.settings.isImageSerializable&&c&&Object.keys(c).forEach(function(a){d.registerImage(a,c[a])}),this.refMap={},this.idMap={};var e=new Ce,f=new Ce,g,h=this.jsonObject.datas.length;for(var i=0;i<h;i++){var j=this.jsonObject.datas[i],k=j["class"],l=this.settings.getPropertyType("id");if(l&&j.id!=null){if(j.action==="remove"){this.dataBox.removeById(j.id);continue}g=this.dataBox.getDataById(j.id),g||(g=d.newInstance(k,j.id))}else g=d.newInstance(k);j.ref!=null&&(this.refMap[j.ref]=g),e.add(g),f.add(j),this.idMap[g.getId()]=g}this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),h=e.size();for(i=0;i<h;i++)g=e.get(i),g.deserializeJson(this,f.get(i));for(i=0;i<h;i++){g=e.get(i);if(this.dataBox.containsById(g.getId()))continue;b&&!g.getParent()&&g.setParent(b),this.dataBox.add(g)}this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),d.isDeserializing=!1},deserializePropertyJson:function(a,b,c){var e=this.settings.getPropertyType(c);e&&d.setValue(a,c,this.deserializeValue(b,e))},deserializeStyleJson:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientJson:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if(b==="data"){var c=this.refMap[a];return c?c:this.idMap[a]}return b==="array.number"?a:a instanceof Array?new Ce(a):a}}),d.addMethod(c.Data,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c),this.serializePropertyJson(a,"parent",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),d.addMethod(c.Element,{serializeJson:function(a,b,e){if(a.settings.isStyleSerializable&&this._styleMap)for(var f in this._styleMap)this.serializeStyleJson(a,f,b,e);c.Element.superClass.serializeJson.call(this,a,b,e),this.serializePropertyJson(a,"layerId",b,e);if(this._alarmState.getHighestNativeAlarmSeverity()&&a.settings.getPropertyType("alarmState")==="alarmstate"){var g={n:{},a:{}};e.p.alarmState=g,c.AlarmSeverity.forEach(function(a){var b=this.getNewAlarmCount(a);b>0&&(g.n[a.name]=b)},this._alarmState),c.AlarmSeverity.forEach(function(a){var b=this.getAcknowledgedAlarmCount(a);b>0&&(g.a[a.name]=b)},this._alarmState),d.isEmptyObject(g.n)&&delete g.n,d.isEmptyObject(g.a)&&delete g.a,d.isEmptyObject(g)&&delete e.p.alarmState}},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeJson:function(a,b){c.Element.superClass.deserializeJson.call(this,a,b);if(a.settings.isStyleSerializable)for(var d in b.s)this.deserializeStyleJson(a,b.s[d],d)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializePropertyJson:function(a,b,d){if(d==="alarmState"){if(a.settings.getPropertyType("alarmState")==="alarmstate"){var e;for(e in b.n)this._alarmState.setNewAlarmCount(c.AlarmSeverity.getByName(e),b.n[e]);for(e in b.a)this._alarmState.setAcknowledgedAlarmCount(c.AlarmSeverity.getByName(e),b.a[e])}}else c.Element.superClass.deserializePropertyJson.call(this,a,b,d)}}),d.addMethod(Ze,{serializeJson:function(a,b,c){Ze.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"image",b,c),this.serializePropertyJson(a,"location",b,c),d.num(this._width)&&this._width>=0&&this.serializePropertyJson(a,"width",b,c),d.num(this._height)&&this._height>=0&&this.serializePropertyJson(a,"height",b,c)}}),d.addMethod(c.Link,{serializeJson:function(a,b,d){c.Link.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"fromNode",b,d),this.serializePropertyJson(a,"toNode",b,d)}}),d.addMethod(c.Follower,{serializeJson:function(a,b,d){c.Follower.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"host",b,d)}}),d.addMethod(_e,{serializeJson:function(a,b,c){_e.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"expanded",b,c)}}),d.addMethod(c.ShapeNode,{serializeJson:function(a,b,d){c.ShapeNode.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"points",b,d),this.serializePropertyJson(a,"segments",b,d)}}),d.addMethod(c.ShapeLink,{serializeJson:function(a,b,d){c.ShapeLink.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"points",b,d)}}),d.addMethod(c.RotatableNode,{serializeJson:function(a,b,d){c.RotatableNode.superClass.serializeJson.call(this,a,b,d),this.serializePropertyJson(a,"angle",b,d)}}),d.addMethod(c.DataBox,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),d.addMethod(c.ElementBox,{serializeJson:function(a,b,d){a.settings.isLayerBoxSerializable&&(d.layers=[],this._layerBox.forEachByDepthFirst(function(a){var b={};d.layers.push(b),this._layerBox.getDefaultLayer()!==a&&(b.id=a.getId()),a.getName()&&(b.name=a.getName()),b.visible=a.isVisible(),b.editable=a.isEditable(),b.movable=a.isMovable()},null,this));if(a.settings.isStyleSerializable&&this._styleMap)for(var e in this._styleMap)this.serializeStyleJson(a,e,b,d);c.ElementBox.superClass.serializeJson.call(this,a,b,d)},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializeJson:function(a,b){c.ElementBox.superClass.deserializeJson.call(this,a,b);if(a.settings.isLayerBoxSerializable&&b.layers){this._layerBox.clear();if(b.layers){var d=b.layers.length;for(var e=0;e<d;e++){var f,g=b.layers[e];g.id!=null?(f=new c.Layer(g.id),this._layerBox.add(f)):(f=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(f)),g.name&&f.setName(g.name),g.visible!=null&&f.setVisible(g.visible),g.editable!=null&&f.setEditable(g.editable),g.movable!=null&&f.setMovable(g.movable)}}}if(a.settings.isStyleSerializable)for(var h in b.s)this.deserializeStyleJson(a,b.s[h],h)}}),c.layout.SpringLayouter=function(a){this._network=a,this._damper=1,this._maxMotion=0,this._motionRatio=0,this._isAdjusting=!1,this._timer=null,this._snodeMap={},this._snodes=new Ce,this._slinks=new Ce,this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this),this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this)},d.ext("twaver.layout.SpringLayouter",Object,{_nodeRepulsionFactor:.6,_linkRepulsionFactor:.6,_limitBounds:null,_interval:50,_stepCount:10,_motionLimit:.01,start:function(){if(this._timer)return;var b=this,c=function(){b.relax.call(b)};this._timer=a.setInterval(c,this._interval),this._damper=1},stop:function(){this._timer&&(a.clearInterval(this._timer),this._timer=null)},relax:function(){if(this._damper<.1&&this._maxMotion<this._motionLimit)return;this._rebuild();var a=this._snodes.size();for(var b=0;b<this._stepCount;b++){this._slinks.forEach(this._relaxLink,this);for(var c=0;c<a;c++)for(var d=0;d<a;d++){var e=this._snodes.get(c),f=this._snodes.get(d);e!=f&&this._relaxNodePair(e,f)}this._moveNodes()}this._isAdjusting=!0;for(var b=0;b<a;b++){var g=this._snodes.get(b);g.fix||g.element.setLocation(g.x,g.y)}this._isAdjusting=!1},isRunning:function(){return!!this._timer},getNetwork:function(){return this._network},isVisible:function(a){return this._network.isVisible(a)},isMovable:function(a){return this._network.isMovable(a)?this._network.getSelectionModel().contains(a)?!1:a instanceof _e?!1:!0:!1},getNodeRepulsionFactor:function(){return this._nodeRepulsionFactor},setNodeRepulsionFactor:function(a){a<.02&&(a=.02),this._nodeRepulsionFactor=a,this._damper=1},getLinkRepulsionFactor
:function(){return this._linkRepulsionFactor},setLinkRepulsionFactor:function(a){a<.02&&(a=.02),this._linkRepulsionFactor=a,this._damper=1},getStepCount:function(){return this._stepCount},setStepCount:function(a){this._stepCount=a,this._damper=1},getInterval:function(){return this._interval},setInterval:function(b){if(this._interval===b)return;this._interval=b;if(this._timer){a.clearInterval(this._timer);var c=this,d=function(){c.relax.call(c)};this._timer=a.setInterval(d,this._interval)}},getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(a){this._limitBounds=a,this._damper=1},_handleDataPropertyChange:function(a){this._isAdjusting||(this._damper=1)},_handleDataBoxChange:function(a){this._network.getElementBox().size()===0?this._damper=0:this._damper=1},_handleNetworkPropertyChange:function(a){if(a.property==="elementBox"){var b=a.oldValue;b!=null&&(b.removeDataBoxChangeListener(this._handleDataBoxChange,this),b.removeDataPropertyChangeListener(this._handleDataPropertyChange,this)),this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this)}},_relaxLink:function(a){var b=a.toNode.x-a.fromNode.x,c=a.toNode.y-a.fromNode.y,d=Math.sqrt(b*b+c*c),e=b*.25,f=c*.25;e/=a.length*100;var g=a.length,h=g*100,i=f;f/=h,i/=a.length*100,a.toNode.dx=a.toNode.dx-e*d,a.toNode.dy=a.toNode.dy-f*d,a.fromNode.dx=a.fromNode.dx+e*d,a.fromNode.dy=a.fromNode.dy+f*d},_relaxNodePair:function(a,b){var c=0,d=0,e=a.x-b.x,f=a.y-b.y,g=e*e+f*f;g===0?(c=Math.random(),d=Math.random()):g<36e4&&(c=e/g,d=f/g);var h=a.repulsion*b.repulsion/100,i=h*.25;a.dx+=c*i,a.dy+=d*i,b.dx-=c*i,b.dy-=d*i},_moveNodes:function(){var a=this._maxMotion,b=0;for(var c=0,d=this._snodes.size();c<d;c++){var e=this._snodes.get(c),f=e.dx,g=e.dy;f*=this._damper,g*=this._damper,e.dx=f/2,e.dy=g/2;var h=Math.sqrt(f*f+g*g);if(!e.fix){e.x=e.x+Math.max(-30,Math.min(30,f)),e.y=e.y+Math.max(-30,Math.min(30,g));if(!this._limitBounds)e.x<1&&this._adjustLocation(1,0),e.y<1&&this._adjustLocation(0,1);else{e.x<this._limitBounds.x&&(e.x=this._limitBounds.x,this._adjustLocation(1,0)),e.y<this._limitBounds.y&&(e.y=this._limitBounds.y,this._adjustLocation(0,1));var i,j=this._network.getElementUI(e.element);j?i=j._viewRect:i=e.element.getRect(),i&&(e.x+i.width>this._limitBounds.x+this._limitBounds.width&&(e.x=this._limitBounds.x+this._limitBounds.width-i.width,this._adjustLocation(-1,0)),e.y+i.height>this._limitBounds.y+this._limitBounds.height&&(e.y=this._limitBounds.y+this._limitBounds.height-i.height,this._adjustLocation(0,-1)))}}b=Math.max(h,b)}this._maxMotion=b,this._maxMotion>0?this._motionRatio=a/this._maxMotion-1:this._motionRatio=0,this._damp()},_damp:function(){this._motionRatio<=.001&&((this._maxMotion<.2||this._maxMotion>1&&this._damper<.9)&&this._damper>.01?this._damper-=.01:this._maxMotion<.4&&this._damper>.003?this._damper-=.003:this._damper>1e-4&&(this._damper-=1e-4)),this._maxMotion<this._motionLimit&&(this._damper=0)},_rebuild:function(){this._snodeMap={},this._snodes.clear(),this._slinks.clear(),this._network.getElementBox().forEach(function(a){this.isVisible(a)&&(a instanceof c.Link?this._addLink(a):a instanceof Ze&&this._addNode(a))},this)},_addNode:function(a){var b=this._snodeMap[a.getId()];return b?b:(b={},b.element=a,b.repulsion=this._getRepulsion(a),b.x=a.getX(),b.y=a.getY(),b.dx=0,b.dy=0,b.fix=!this.isMovable(a),this._snodeMap[a.getId()]=b,this._snodes.add(b),b)},_addLink:function(a){var b={};b.fromNode=this._addNode(a.getFromNode()),b.toNode=this._addNode(a.getToNode()),b.element=a;var c=this._network.getElementUI(a.getToNode()),d=this._network.getElementUI(a.getFromNode()),e,f;c&&c._viewRect&&d&&d._viewRect?(e=c._viewRect.width+d._viewRect.width,f=c._viewRect.height+d._viewRect.height):(e=a.getToNode().getWidth()+a.getFromNode().getWidth(),f=a.getToNode().getHeight()+a.getFromNode().getHeight()),b.length=Math.floor(Math.sqrt(e*e+f*f)*this._linkRepulsionFactor),b.length<=0&&(b.length=100),this._slinks.add(b)},_getRepulsion:function(a){var b=this._network.getElementUI(a),c;if(b&&b._viewRect){var d=b._viewRect;c=Math.floor(Math.sqrt(d.width*d.width+d.height*d.height)*this._nodeRepulsionFactor)}else c=100;return c<=0&&(c=100),c},_adjustLocation:function(a,b){for(var c=0,d=this._snodes.size();c<d;c++){var e=this._snodes.get(c),f,g=this._network.getElementUI(e.element);g?f=g._viewRect:f=e.element.getRect();if(!f)return;if(a>0){if(!this._limitBounds||e.x+f.width+a<this._limitBounds.x+this._limitBounds.width)e.x+=a}else if(!this._limitBounds||e.x+a>this._limitBounds.x)e.x+=a;if(b>0){if(!this._limitBounds||e.y+f.height+b<this._limitBounds.y+this._limitBounds.height)e.y+=b}else if(!this._limitBounds||e.y+b>this._limitBounds.y)e.y+=b}}}),c.layout.CloudLayouter=function(a){c.layout.CloudLayouter.superClass.constructor.apply(this,arguments),this._network=a,this._centerX=0,this._centerY=0,this._radius=1,this._rect=null,this._localPoint=null,this._lastWidth=-1e3,this._lastHeight=-1e3,this._nodes=new Ce,this._sa=0,this._ca=0,this._sb=0,this._cb=0,this._sc=0,this._cc=0,this._lasta=0,this._lastb=0,this._active=!1,this._horizontalElliptical=1,this._verticalElliptical=1,this._timer=null,this._centering=!1,this._centeringNode=null,this._freeze=!1,this._network.getClassName()==="twaver.network.Network"?this._network.setInteractions([new c.network.interaction.SelectInteraction(this._network)]):this._network.setInteractions([new c.canvas.interaction.SelectInteraction(this._network)])},d.ext("twaver.layout.CloudLayouter",c.PropertyChangeDispatcher,{__accessor:["updateNodeFunction","mouseMoveFunction","mouseOverFunction","percentPadding","ceaseRate","ceaseLimit"],__bool:["elliptical","active","updateLayoutRectOnResized","reloadOnDataBoxChanged"],_moveSpeed:2,_ceaseRate:.9,_ceaseLimit:.01,_percentPadding:.2,_elliptical:!0,_interval:50,_reloadOnDataBoxChanged:!0,_updateLayoutRectOnResized:!0,getNetwork:function(){return this._network},isLayoutable:function(a){return this._network.isVisible(a)&&this._network.isMovable(a)},start:function(b){arguments.length===0&&(b=!0);if(this._timer)return;this._installListeners(),b&&this.updateLayoutRect(!0);var c=this,d=function(){c._update.call(c)};this._timer=a.setInterval(d,this._interval),this._update()},stop:function(){this._timer&&(a.clearInterval(this._timer),this._timer=null)},isRunning:function(){return!!this._timer},getInterval:function(){return this._interval},setInterval:function(b){if(this._interval===b)return;var c=this._interval;this._interval=b;if(this._timer){a.clearInterval(this._timer);var d=this,e=function(){d._update.call(d)};this._timer=a.setInterval(e,this._interval)}this.firePropertyChange("interval",c,b)},getMoveSpeed:function(){return this._moveSpeed},setMoveSpeed:function(a){var b=this._moveSpeed;this._moveSpeed=a,this.firePropertyChange("moveSpeed",b,a)},getLayoutRect:function(){var a=this._network.getView().offsetWidth/this._network.getZoom(),b=this._network.getView().offsetHeight/this._network.getZoom(),c=a*this._percentPadding,d=b*this._percentPadding;return{x:c,y:d,width:a-2*c,height:b-2*d}},getCount:function(){return this._nodes.size()},updateLayoutRect:function(a){var b=this._radius;this._rect=this.getLayoutRect(),this._rect.width<=2&&(this._rect.width=2),this._rect.height<=2&&(this._rect.height=2),this._radius=Math.min(this._rect.width/2,this._rect.height/2),this.isElliptical()?(this._horizontalElliptical=this._rect.width/2/this._radius,this._verticalElliptical=this._rect.height/2/this._radius):(this._horizontalElliptical=1,this._verticalElliptical=1),this._centerX=this._rect.x+this._rect.width/2,this._centerY=this._rect.y+this._rect.height/2;if(a)this.reload();else{this._lasta=1,this._lastb=1;var c=this._nodes.size();for(var d=0;d<c;d++){var e=this._nodes.get(d);e.cx*=this._radius/b,e.cy*=this._radius/b,e.cz*=this._radius/b}this._freeze?this._updateNodes(0,0,0):this._update()}this._lastWidth=this._network.getView().offsetWidth,this._lastHeight=this._network.getView().offsetHeight},reload:function(){this._freeze=!1,this._centeringNode=null,this._localPoint=null,this._centering=!1,this._nodes=new Ce,this._box.forEach(function(a){if(a&&this.isLayoutable(a)){var b={};b.node=a,this._nodes.add(b)}},this),this._sineCosine(0,0,0),this._active=!1,this._lasta=1,this._lastb=1;var a=0,b=0,c=this._nodes.size();for(var d=0;d<c;d++){a=Math.acos(-1+(2*(d+1)-1)/c),b=Math.sqrt(c*Math.PI)*a;var e=this._nodes.get(d);e.cx=this._radius*Math.cos(b)*Math.sin(a),e.cy=this._radius*Math.sin(b)*Math.sin(a),e.cz=this._radius*Math.cos(a)}},_sineCosine:function(a,b,c){var d=Math.PI/180;this._sa=Math.sin(a*d),this._ca=Math.cos(a*d),this._sb=Math.sin(b*d),this._cb=Math.cos(b*d),this._sc=Math.sin(c*d),this._cc=Math.cos(c*d)},handleSelectionChange:function(a){this.centerNode(this._network.getSelectionModel().getLastData())},handleDataBoxChange:function(a){(this._reloadOnDataBoxChanged||a.kind==="clear")&&this.reload()},handleMouseMove:function(a){this._centering||this._updateLogicalPoint(a),this._mouseMoveFunction?this._active=this._mouseMoveFunction(a):this._active=!0},handleMouseOver:function(a){this._centering||this._updateLogicalPoint(a),this._mouseOverFunction?this._active=this._mouseOverFunction(a):this._active=!0},_updateLogicalPoint:function(a){this._localPoint=this._network.getLogicalPoint(a)},handleRollOut:function(a){this._active=!1},handleResize:function(a){if(a.kind==="validateEnd"){if(!this._updateLayoutRectOnResized)return;if(Math.abs(this._network.getView().offsetWidth-this._lastWidth)<=2&&Math.abs(this._network.getView().offsetHeight-this._lastHeight)<=2)return;this.updateLayoutRect()}},handleNetworkPropertyChange:function(a){a.property==="elementBox"&&(this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this.reload()),a.property==="zoom"&&(this._localPoint=null,this.updateLayoutRect())},_adjustIndex:function(){this._nodes.sort(this._sortFunction);var a=this._nodes.size();for(var b=0;b<a;b++){var c=this._nodes.get(b).node,d=this._box.getDatas().indexOf(c);this._box.getDatas().removeAt(d),this._box.getDatas().add(c,b),this._box.fireIndexChange(c,d,b),this.updateNode(c,b,a,this._nodes.get(b).alpha)}},_sortFunction:function(a,b){return b.cz>a.cz?1:b.cz<a.cz?-1:0},updateNode:function(a,b,c,d){this._updateNodeFunction&&this._updateNodeFunction(a,b,c,d)},_update:function(){if(this._freeze)return;var a,b;if(this._centering&&this._centeringNode){var c=this.isAtCenter(this._centeringNode.node,this._centeringNode.perspective,this._centeringNode.cx,this._centeringNode.cy,this._centeringNode.cz);if(c){this._freeze=!0,this._centering=!1,this._centeringNode=null;return}}!this._freeze&&(this._active||this._centering)&&this._localPoint?this.isElliptical()?(a=(this._centerY-this._localPoint.y)/(this._rect.height/2)*this._moveSpeed,b=(this._localPoint.x-this._centerX)/(this._rect.width/2)*this._moveSpeed):(a=(this._centerY-this._localPoint.y)/this._radius*this._moveSpeed,b=(this._localPoint.x-this._centerX)/this._radius*this._moveSpeed):(a=this._lasta*this._ceaseRate,b=this._lastb*this._ceaseRate),this._lasta=a,this._lastb=b;if(Math.abs(a)>this._ceaseLimit||Math.abs(b)>this._ceaseLimit){var d=0;this._sineCosine(a,b,d);for(var e=0,f=this._nodes.size();e<f;e++){var g=this._nodes.get(e),h=g.cx,i=g.cy*this._ca+g.cz*-this._sa,j=g.cy*this._sa+g.cz*this._ca,k=h*this._cb+j*this._sb,l=i,m=h*-this._sb+j*this._cb,n=k*this._cc+l*-this._sc,o=k*this._sc+l*this._cc,p=m;g.cx=n,g.cy=o,g.cz=p;var q=this._radius*2;q/=q+p,g.perspective=q,g.alpha=(this._radius-p)/(this._radius*2);var r=this._horizontalElliptical*n*q-this._horizontalElliptical*2+this._centerX,s=o*q*this._verticalElliptical+this._centerY;g.node.setCenterLocation(r,s)}this._adjustIndex()}},centerNode:function(a){if(a&&this.isLayoutable(a)){if(this._centeringNode&&a===this._centeringNode.node&&this._freeze)return;for(var b=0,c=this._nodes.size();b<c;b++){var d=this._nodes.get(b);if(d&&a===d.node){this._centering=!0,this._freeze=!1,this._active=!0,this._centeringNode=d,this._localPoint=this.createControlPoint(this._centeringNode.node);break}}}else this._centering=!1,this._freeze=!1,this._active=!1,this._localPoint=null},createControlPoint:function(a){var b=a.getCenterLocation(),c=this.getLayoutRect(),d=c.x+c.width/2,e=c.y+c.height/2,f=Math.atan2(b.y-e,b.x-d),g=c.width+c.height;return{x:d+g*Math.cos(f),y:e+g*Math.sin(f)}},isAtCenter:function(a,b,c,d,e){if(this._moveSpeed<=0)return!0;var f=16/this._moveSpeed;return f>20?f=20:f<2&&(f=2),-e/Math.sqrt(c*c+d*d)>f},_updateNodes:function(a,b,c){this._sineCosine(a,b,c);for(var d=0,e=this._nodes.size();d<e;d++){var f=this._nodes.get(d),g=f.cx,h=f.cy*this._ca+f.cz*-this._sa,i=f.cy*this._sa+f.cz*this._ca,j=g*this._cb+i*this._sb,k=h,l=g*-this._sb+i*this._cb,m=j*this._cc+k*-this._sc,n=j*this._sc+k*this._cc,o=l;f.cx=m,f.cy=n,f.cz=o;var p=this._radius*2;p/=p+o,f.perspective=p;var q=this._horizontalElliptical*m*p-this._horizontalElliptical*2+this._centerX,r=n*p*this._verticalElliptical+this._centerY;f.node.setCenterLocation(q,r)}this._adjustIndex()},_installListeners:function(){this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._network.addViewListener(this.handleResize,this),s.addEventListener("mouseout","handleRollOut",this._network.getView(),this),s.addEventListener("mousemove","handleMouseMove",this._network.getView(),this),s.addEventListener("mouseover","handleMouseOver",this._network.getView(),this),this._network.addPropertyChangeListener(this.handleNetworkPropertyChange,this)},_uninstallListeners:function(){this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._network.removeViewListener(this.handleResize,this),s.removeEventListener("mouseout",this._network.getView(),this),s.removeEventListener("mousemove",this._network.getView(),this),s.removeEventListener("mouseover",this._network.getView(),this),this._network.removePropertyChangeListener(this.handleNetworkPropertyChange,this)}}),c.layout.AutoLayouter=function(a){this._box=a},d.ext("twaver.layout.AutoLayouter",Object,{_expandGroup:!1,_repulsion:1,_type:null,_animate:!0,_explicitXOffset:Number.NaN,_explicitYOffset:Number.NaN,_xOffset:0,_yOffset:0,isExpandGroup:function(){return this._expandGroup},setExpandGroup:function(a){this._expandGroup=a},getRepulsion:function(){return this._repulsion},setRepulsion:function(a){this._repulsion=a},getType:function(){return this._type},isAnimate:function(){return this._animate},setAnimate:function(a){this._animate=a},getElementBox:function(){return this._box},getExplicitXOffset:function(){return this._explicitXOffset},setExplicitXOffset:function(a){this._explicitXOffset=a},getExplicitYOffset:function(){return this._explicitYOffset},setExplicitYOffset:function(a){this._explicitYOffset=a},getDimension:function(a){if(a instanceof _e&&a.getChildrenSize()>0){var b=null;for(var c=0,d=a.getChildrenSize();c<d;c++){var e=a.getChildAt(c);e instanceof Ze&&(b?b=p.unionRect(b,e.getRect()):b=e.getRect())}return b?{width:b.width,height:b.height}:null}return{width:a.getWidth(),height:a.getHeight()}},isVisible:function(a){return!0},isMovable:function(a){return!0},getGroupLayoutType:function(a){return this._type},getElements:function(){var a,b=this._box,d=b.getSelectionModel().size()>1;d?a=b.getSelectionModel().getSelection():(a=new Ce,b.forEachByBreadthFirst(a.add,null,a)),this._xOffset=-1,this._yOffset=-1;var e=new Ce;for(var f=0,g=a.size();f<g;f++){var h=a.get(f);if(this.isVisible(h))if(h instanceof c.Link)e.add(h);else if(this.isMovable(h)&&h instanceof Ze){e.add(h);if(d){if(this._xOffset<0||h.getX()<this._xOffset)this._xOffset=h.getX();if(this._yOffset<0||h.getY()<this._yOffset)this._yOffset=h.getY()}}}return d||(isNaN(this._explicitXOffset)?this._xOffset=50/this._repulsion:this._xOffset=this._explicitXOffset,isNaN(this._explicitYOffset)?this._yOffset=50/this._repulsion:this._yOffset=this._explicitYOffset),e},getLayoutResult:function(a){var b={};return this.doLayoutImpl(a,null,b),b},doLayout:function(a,b){return this.doLayoutImpl(a,b)},doLayoutImpl:function(a,b,e){var f=this,g=b;b=function(){f._box._layoutMovingElements=!1,g&&g()},this._type=a;var h=null;if("round"===a)h=new sg;else if("symmetry"===a)h=new Gg;else if("hierarchic"===a)h=new Qg;else if(a==="topbottom"||a==="bottomtop"||a==="rightleft"||a==="leftright")h=new eg;if(h==null)return!1;f._box._layoutMovingElements=!0;var i={},j=this.getElements(),k=new Hg(this,j,!0,null);j=k.process();var l=new Bg(this,j,a,!0,null);try{h.i2(l)}catch(m){return k.resetGroup(),b!=null&&b(),!1}var n,o;for(n in l._a){o=l._a[n];var p=l.g4(o);i[n]={x:p.x+this._xOffset,y:p.y+this._yOffset}}var q;if(a==="rightleft"||a==="leftright"||a==="bottomtop"){var r=Hg.createMatrix(a),s=Number.MAX_VALUE,t=Number.MAX_VALUE;for(n in i){o=l._a[n],q=i[n];var u=r.transform(q);q.x=u.x,q.y=u.y;var v;a==="rightleft"||a==="leftright"?(v=u.x-l.g9(o)/2/this._repulsion,v<s&&(s=v),v=u.y-l.gj(o)/2/this._repulsion,v<t&&(t=v)):(v=u.x-l.gj(o)/2/this._repulsion,v<s&&(s=v),v=u.y-l.g9(o)/2/this._repulsion,v<t&&(t=v))}for(n in i)o=l._a[n],q=i[n],q.x=q.x-s+this._xOffset,q.y=q.y-t+this._yOffset}if(e==null&&this._animate){var w=new Ce,x=new Ce;for(n in i)w.add(l._a[n].node),x.add(i[n]);c.animate.AnimateManager.endAnimate(),c.animate.AnimateManager.start(new c.animate.AnimateCenterLocation(w,x,function(){k.resetGroup(),b!=null&&d.callLater(b)}))}else{for(n in i)o=l._a[n],q=i[n],e==null?o.node.setCenterLocation(q.x,q.y):e[o.node.getId()]=q;k.resetGroup(),b!=null&&d.callLater(b)}return!0}});var ef=function(a,b){this.x=a,this.y=b};d.ext(ef,Object,{equals:function(a){return this===a?!0:a instanceof ef?a.x==this.x&&a.y==this.y:!1}});var ff=function(a,b){this.width=a,this.height=b};d.ext(ff,Object,{});var gf=function(a,b){this.x=a,this.y=b};d.ext(gf,Object,{});var hf=function(){arguments.length===2?(hf.superClass.constructor.call(this,arguments[1].width,arguments[1].height),this.x=arguments[0].x,this.y=arguments[0].y):(hf.superClass.constructor.call(this,arguments[2],arguments[3]),this.x=arguments[0],this.y=arguments[1])};d.ext(hf,ff,{});var jf=function(a,b){if(jf.a2(a.x,b.x))this._a=1,this._b=0,this._c=-a.x;else{this._b=-1;var c=(b.y-a.y)/(b.x-a.x),d=a.y-a.x*c;this._a=c,this._c=d}};d.ext(jf,Object,{a3:function(){return this._a},a4:function(){return this._b},a5:function(){return this._c}}),jf.a6=function(a,b){if(jf.a1(a.a3())&&jf.a1(b.a3()))return null;if(jf.a1(a.a4())&&jf.a1(b.a4()))return null;if(jf.a1(b.a4())){var c=a;a=b,b=c}var d=a.a3(),e=a.a4(),f=-a.a5(),g,h;jf.a1(a.a3())?(g=b.a4(),h=-b.a5()):(g=b.a4()-b.a3()/a.a3()*a.a4(),h=-b.a5()-b.a3()/a.a3()*-a.a5());var i=h/g,j=(f-i*e)/d;return new ef(j,i)},jf.a1=function(a){return jf.a2(a,0)},jf.a2=function(a,b){return Math.abs(a-b)<1e-5};var kf=function(a){this._a=new Ff;if(a)for(var b=0;b<a.size();b++)this._a.aa(a.get(b))};d.ext(kf,Object,{c:function(){return this._a.ah()},d:function(){return this._a.ah()},a:function(){var a=new Ce;for(var b=this.c();b.i1();b.i2())a.add(b.i6(),0);return new kf(a)},b:function(){return this._a.ay()}});var lf=function(a,b){this.x=a,this.y=b};d.ext(lf,Object,{a:function(a,b){this.x=a,this.y=b}});var mf=function(a,b){this.x=a||0,this.y=b||0};d.ext(mf,Object,{b:function(){return new mf(this.x,this.y)},a:function(a){this.z=a},c:function(){return this.x},d:function(){return this.y},f:function(a,b){this.x=a,this.y=b}});var nf=function(a){this._c=new Ff,a?(this.ac(a.a8().b()),this.ad(a.a9().b())):(this.ac(new mf),this.ad(new mf))};d.ext(nf,Object,{a6:function(){return this.a5(this)},ac:function(a){a.a(this),this._a=a},ad:function(a){a.a(this),this._b=a},a8:function(){return this._a},a9:function(){return this._b},a1:function(a,b){return this.a4(a,b,this.aa())},a2:function(){return this._c.ay()},a7:function(a){return this._c.ak(a)},aa:function(){return this._c.ay()===0?null:this._c.as()},a3:function(){this._c.af()},i2:function(a){var b=this.a7(a);return b!=null?new ef(b.x,b.y):null},i1:function(){return this.a2()},i6:function(){var a=this.a8();return new ef(a.c(),a.d())},i7:function(){var a=this.a9();return new ef(a.c(),a.d())},i8:function(a){this.a8().f(a.x,a.y)},i9:function(a){this.a9().f(a.x,a.y)},i3:function(a,b,c){var d=this.a7(a);d!=null&&d.a(b,c)},i4:function(a,b){this.a1(a,b)},i5:function(){this.a3()}});var of=function(a){of.superClass.constructor.call(this,a)};d.ext(of,nf,{a5:function(a){return new of(a)},a4:function(a,b,c){var d=new lf(a,b);return this.ab(d,c),d},ab:function(a,b){this._c.an(a,this._c.al(b))}});var pf=function(){if(arguments.length===2){var a=arguments[0],b=arguments[1];this._s=!1,this._w=30,this._h=30,this._x=a-this._w/2,this._y=b-this._h/2}else{var c=arguments[0];this._s=c._s,this._w=c._w,this._h=c._h,this._x=c._x,this._y=c._y}};d.ext(pf,Object,{m3:function(){return this.m2(this)},m4:function(){return this._x+this._w/2},m5:function(){return this._y+this._h/2},m6:function(a,b){this._x=a-this._w/2,this._y=b-this._h/2},i1:function(){return this._x},i2:function(){return this._y},i5:function(a,b){this._x=a,this._y=b},i3:function(){return this._w},i4:function(){return this._h},i6:function(a,b){var c=(this._w-a)/2,d=(this._h-b)/2;this._x+=c,this._y+=d,this._w=a,this._h=b},m1:function(a){var b,c,d,e;a.width<=0?(b=this._x,c=this._x+this._w,d=this._y,e=this._y+this._h):(b=Math.min(this._x,a.x),c=Math.max(this._x+this._w,a.x+a.width),d=Math.min(this._y,a.y),e=Math.max(this._y+this._h,a.y+a.height)),a.x=b,a.y=d,a.width=c-b,a.height=e-d}});var qf=function(a){a?qf.superClass.constructor.call(this,a):qf.superClass.constructor.call(this,0,0)};d.ext(qf,pf,{m2:function(a){return new qf(a)}});var rf={};rf.a2=function(a){var b=ag.a2(Vg.a(a.xa()));return rf.a4(a,b,rf.a3(a,b))},rf.a3=function(a,b){for(var c=a.x9();c.i1();c.i2())b.i7(c.i9(),-1);var d=0,e=new Lf(a.xa());for(var f=a.x9();f.i1();f.i2()){var g=f.i9();b.i2(g)===-1&&rf.a(g,e,b,d++)}return d},rf.a6=function(a){var b=new Gf,c=rf.a2(a);for(var d=0;d<c.length-1;d++){var e=a.xo(c[d].x2(),c[d+1].x3());b.aa(e)}return b},rf.a4=function(a,b,c){var d=[];for(var e=0;e<c;e++)d[e]=new Yf;for(var f=a.x9();f.i1();f.i2())d[b.i2(f.i9())].ae(f.i9());return d},rf.a=function(a,b,c,d){b.c(a),c.i7(a,d);while(!b.a()){a=b.b();for(var e=a.ag();e!=null;e=e.a8()){var f=e.a3();c.i2(f)===-1&&(c.i7(f,d),b.c(f))}for(var g=a.ae();g!=null;g=g.a7()){var h=g.a2();c.i2(h)===-1&&(c.i7(h,d),b.c(h))}}},rf.a1=function(a,b,c){var d=new Af(b,c);return d.a8(a),d._i},rf.a5=function(a,b,c){var d=[];for(var e=0;e<c;e++)d[e]=new Gf;for(var f=a.xf();f.i1();f.i2())d[b.i2(f.i8())].aa(f.i8());return d},rf.a7=function(a){var b=new Gf,c=ag.a3(Vg.b(a.xa())),d=ag.a4(Vg.a(a.xh())),e=rf.a1(a,d,c),f=rf.a5(a,d,e);if(f.length>1){var g=new Yf;for(var h=0;h<f.length;h++){var i=f[h],j=null;if(i.ay()===1){var k=i.c2();k.a2().ad()===1?j=k.a2():k.a3().ad()===1&&(j=k.a3())}else{for(var l=i.c1();l.i1();l.i2()){var m=l.i8();if(c.i4(m.a2()))if(j==null)j=m.a2();else if(j!==m.a2()){j=null;break}if(!c.i4(m.a3()))continue;if(j==null){j=m.a3();continue}if(j===m.a3())continue;j=null;break}if(j!=null){var n=i.c2();n.a2()!==j?j=n.a2():j=n.a3()}}j!=null&&g.aa(j)}var o;for(var p=g.x4();!g.ar();p=o)o=g.x4(),b.ac(a.xo(p,o))}return b};var sf=function(){this._c=0,this._d=0,this._e=0,this._b=!0,this._f=!1};d.ext(sf,Object,{a6:function(a){this._f=a},a7:function(a){this._b=a},a8:function(a){a.x0()!==0&&this.a9(a,a.x9().i9())},a9:function(a,b){this._xx=a.xk(),this._c=a.xl(),this._d=0,this._e=0,this.a0(b);if(this._b)for(var c=a.x9();c.i1();c.i2()){var d=c.i9();this._xx.i1(d)==null&&(this.a1(d),this.a0(d))}a.xi(this._xx),a.xj(this._c)},a0:function(a){var b=++this._d;this._xx.z1(a,sf._B),this.a5(a,b);for(var c=this._f?a.ap():a.af();c.i1();c.i2()){var d=c.i8();if(!this._c.i4(d)){this._c.i7(d,!0);var e=d.a1(a);this._xx.i1(e)==null?(this.a3(d,e,!0),this.a0(e),this.a2(d,e)):this.a3(d,e,!1)}}this.a4(a,b,++this._e),this._xx.z1(a,sf._C)},a5:function(a,b){},a4:function(a,b,c){},a3:function(a,b,c){},a2:function(a,b){},a1:function(a){}}),sf._B={},sf._C={};var tf=function(a){this._a=a};d.ext(tf,sf,{a5:function(a,b){var c=this._a._ah.i2(a);this._a._ad[c].ae(a)}});var uf=function(a){this._a=a};d.ext(uf,sf,{a2:function(a,b){var c=a.a1(b),d=this._a[c.al()],e=this._a[b.al()];e._a+1>d._a?(d._c=d._a,d._b=d._d,d._a=e._a+1,d._d=a):e._a+1>d._c&&(d._c=e._a+1,d._b=a)}});var vf=function(a){this._a=a};d.ext(vf,sf,{a3:function(a,b,c){c&&a.a2()===b&&this._a.ac(a)}});var wf=function(){this._a=0,this._c=0};d.ext(wf,Object,{});var xf=function(){this._a=0};d.ext(xf,Object,{a1:function(a,b){this._a=0;for(var c=b.length-1;c>=0;c--)b[c]=-1;for(var d=a.x9();d.i1();d.i2()){var e=d.i9();if(e.ak()!==0)continue;this.a2(e,e.al(),b);break}for(var f=a.x9();f.i1();f.i2()){var g=f.i9(),h=g.al();b[h]===-1&&this.a2(g,h,b)}},a2:function(a,b,c){c[b]=-2;for(var d=a.ag();d!=null;){var e=d.a3(),f=e.al();switch(c[f]){case-1:this.a2(e,f,c);case-2:default:d=d.a8()}}c[b]=this._a++}});var yf={};yf.a1=function(a){var b=new zf;return b.a8(a),b._n},yf.a2=function(a){var b=a.x9(),c=null,d=0;b.i4();for(;b.i1();b.i2())b.i9().ak()===0&&(c=b.i9(),d++);if(d===1)return c;d=0,b.i4();for(;b.i1();b.i2())b.i9().ao()===0&&(c=b.i9(),d++);return d===1?c:yf.a8(a)},yf.a8=function(a){var b=Vg.a(a.x0()),c=ag.a2(b);return yf.a6(a,c)},yf.a6=function(a,b){var c=a.xd(),d=Vg.d(1),e=Vg.a(a.x0(),-1),f=yf.a4(a,c);yf.a7(c,b,d,e,-1);for(var g=f.c1();g.i1();g.i2())a.x3(g.i8());return d[0]},yf.a7=function(a,b,c,d,e){var f=0;for(var g=a.ag();g!=null;g=g.a8()){var h=g.a3(),i=yf.a7(h,b,c,d,e);i>e&&(e=i),f+=d[h.al()]}var j=f*(a._g.xa()-1-f);for(var k=a.ag();k!=null;k=k.a8()){var l=k.a3();for(var m=k.a8();m!=null;m=m.a8()){var n=m.a3();j+=d[l.al()]*d[n.al()]}}return b.i7(a,j),d[a.al()]=f+1,j>e&&(e=j,c[0]=a),e},yf.a4=function(a,b){var c=new Gf,d=new vf(c);d.a6(!1),d.a9(a,b);for(var e=c.c1();e.i1();e.i2())a.x3(e.i8());return c},yf.a3=function(a){return yf.a4(a,yf.a2(a))};var zf=function(){this._n=!0,this.a6(!1)};d.ext(zf,sf,{a3:function(a,b,c){c||(this._n=!1)},a1:function(a){this._n=!1}});var Af=function(a,b){this._i=0,this._m=b,this._j=a,this._l=!1};d.ext(Af,sf,{a8:function(a){this._h=Vg.a(a.x0()),this._k=Vg.a(a.x0()),this._g=new Lf(a.xh()),Af.superClass.a8.call(this,a)},a5:function(a,b){this._k[a.al()]=this._h[a.al()]=b},a3:function(a,b,c){this._g.c(a);if(!c){var d=a.a1(b);this._h[d.al()]=Math.min(this._h[d.al()],this._k[b.al()])}},a1:function(a){this._l=!1},a2:function(a,b){var c=a.a1(b);if(this._h[b.al()]>=this._k[c.al()]){for(;this._g.d()!==a;this._j.i5(this._g.b(),this._i));this._j.i5(this._g.b(),this._i),this._i++,this._g.a()?this._l?this._m.i5(c,!0):this._l=!0:this._m.i5(c,!0)}this._h[c.al()]=Math.min(this._h[c.al()],this._h[b.al()])}});var Bf=function(a,b){this._h=!1,this._i=a,this._g=b};d.ext(Bf,Object,{z1:function(a,b){a._c[this._i]=b},i1:function(a){return a._c[this._i]},i5:function(a,b){a._c[this._i]=b},i4:function(a){return a._c[this._i]},i7:function(a,b){a._c[this._i]=b},i2:function(a){var b=a._c[this._i];return b==null?0:b},i6:function(a,b){a._c[this._i]=b},i3:function(a){var b=a._c[this._i];return b==null?0:b},c:function(){return this._h},d:function(){this._h=!0}});var Cf=function(a,b){this._c=!1,this._d=a,this._b=b};d.ext(Cf,Object,{i8:function(a,b){a._c[this._d]=b},i1:function(a){return a._c[this._d]},i7:function(a,b){a._c[this._d]=b},i4:function(a){var b=a._c[this._d];return b==null?!1:b},i5:function(a,b){a._c[this._d]=b},i2:function(a){var b=a._c[this._d];return b==null?0:b},i6:function(a,b){a._c[this._d]=b},i3:function(a){var b=a._c[this._d];return b==null?0:b},a:function(){return this._c},b:function(){this._c=!0}});var Df=function(a){this._bb=a,this.i4()};d.ext(Df,Object,{i1:function(){return this._aa!=null},i2:function(){this._aa=this._aa._a},i3:function(){this._aa=this._aa._b},i4:function(){this._aa=this._bb._b},i5:function(){this._aa=this._bb._c},i7:function(){return this._bb.ay()},i6:function(){return this._aa._c}});var Ef=function(a){Ef.superClass.constructor.call(this,a)};d.ext(Ef,Df,{i8:function(){return this.i6()}});var Ff=function(a){this._id=d.id(),this._a=0;if(a){a.i4();for(;a.i1();a.i2())this.ae(a.i6())}};d.ext(Ff,Object,{ac:function(a){var b=this.ag(a);return this._b==null?this._b=this._c=b:(this._b._b=b,b._a=this._b,this._b=b),this._a++,b},ae:function(a){var b=this.ag(a);return this._c==null?this._b=this._c=b:(this._c._a=b,b._b=this._c,this._c=b),this._a++,b},z1:function(a){a._b=null,a._a=null,this._c==null?this._b=this._c=a:(this._c._a=a,a._b=this._c,this._c=a),this._a++},ad:function(a){a._b=null,a._a=null,this._b==null?this._b=this._c=a:(this._b._b=a,a._a=this._b,this._b=a),this._a++},aa:function(a){return this.ae(a),!0},ab:function(a){for(;a.i1();a.i2())this.ae(a.i6())},ao:function(a,b){if(b===this._b)return this.ac(a);if(b==null)return this.ae(a);var c=this.ag(a);return this.aq(c,b),c},aq:function(a,b){if(b==null)this.ad(a);else if(b===this._b)this.ad(a);else{if(this._c==null)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._b;b._b=a,a._a=b,c._a=a,a._b=c}this._a++}},ap:function(a,b){if(b==null)this.z1(a);else if(b===this._c)this.z1(a);else{if(this._b==null)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._a;b._a=a,a._a=c,c._b=a,a._b=b}this._a++}},an:function(a,b){if(b===this._c)return this.ae(a);if(b==null)return this.ac(a);var c=this.ag(a);return this.ap(c,b),c},ay:function(){return this._a},ar:function(){return this._a===0},af:function(){this._b=this._c=null,this._a=0},am:function(){return this._b._c},at:function(){var a=this.am();return this.aw(this._b),a},as:function(){return this._c._c},au:function(){return this.aw(this._c)},ak:function(a){var b=0;for(var c=this._b;c!=null;){if(a===b)return c._c;c=c._a,b++}return null},aj:function(a){return a._a==null?this._b:a._a},ai:function(a){return a._b==null?this._c:a._b},aw:function(a){return a!==this._b?a._b._a=a._a:this._b=a._a,a!==this._c?a._a._b=a._b:this._c=a._b,this._a--,a._c},av:function(a){return this.aw(a._aa)},ah:function(){return new Df(this)},al:function(a){var b=this._b;while(b!=null){if(b._c==null&&a==null)return b;if(b._c===a)return b;b=b._a}return null},a0:function(){var a=Vg.d(this._a),b=0;for(var c=this._b;c!=null;)a[b]=c._c,c=c._a,b++;return a},ax:function(){for(var a=this._b;a!=null;a=a._b){var b=a._a;a._a=a._b,a._b=b}var c=this._b;this._b=this._c,this._c=c},a1:function(a){var b=this.a0();b.sort(a);var c=0;for(var d=this._b;d!=null;)d._c=b[c],d=d._a,c++},a2:function(){var a=this.a0();a.sort(Vg.c);var b=0;for(var c=this._b;c!=null;)c._c=a[b],c=c._a,b++},az:function(a){this._b==null?(this._b=a._b,this._c=a._c):a._b!=null&&(this._c._a=a._b,a._b._b=this._c,this._c=a._c),this._a+=a._a,a._b=a._c=null,a._a=0},ag:function(a){return new Jf(a)}});var Gf=function(a){Gf.superClass.constructor.call(this,a)};d.ext(Gf,Ff,{c1:function(){return new Ef(this)},c2:function(){return this.am()},c3:function(){return this.at()}});var Hf=function(){this._c=0};d.ext(Hf,Object,{a:function(a){this._c++,a._b=this._b,a._a=null,this._b!=null?(this._b._a=a,this._b=a):this._b=this._a=a},b:function(a,b){if(b==null){this.a(a);return}var c=b._b;c!=null?c._a=a:this._a=a,a._b=c,a._a=b,b._b=a,this._c++},c:function(a){var b=a._a,c=a._b;this._c--,b!=null?b._b=c:this._b=c,c!=null?c._a=b:this._a=b}});var If=function(a,b){this._p=a,this._j=b,this._o=a._o[b]};d.ext(If,Object,{i1:function(){return this._o!=null},i2:function(){this._o=this._o._k[this._j]},i3:function(){this._o=this._o._f[this._j]},i4:function(){this._o=this._p._o[this._j]},i5:function(){this._o=this._p._q[this._j]},i7:function(){return this._p._n[this._j]},i6:function(){return this._o},i8:function(){return this._o}});var Jf=function(a){this._c=a};d.ext(Jf,Object,{a:function(){return this._a},b:function(){return this._b},c:function(a){this._c=a},d:function(){return this._c}});var Kf=function(a,b,c,d){this._r=a,this._s=b,this._q=c,this._p=d};d.ext(Kf,Object,{i1:function(a){return this._p[a.a5()]},i3:function(a){return this._r[a.a5()]},i2:function(a){return this._s[a.a5()]},i4:function(a){return this._q[a.a5()]},i8:function(a,b){this._p[a.a5()]=b},i6:function(a,b){this._r[a.a5()]=b},i5:function(a,b){this._s[a.a5()]=b},i7:function(a,b){this._q[a.a5()]=b}});var Lf=function(a){this._a=Vg.d(a),this._b=-1};d.ext(Lf,Object,{d:function(){return this._a[this._b]},b:function(){return this._a[this._b--]},c:function(a){this._a[++this._b]=a},a:function(){return this._b<0}});var Mf=function(){};d.ext(Mf,Object,{a0:function(a){this._c=Vg.d(a)}});var Nf=function(a,b,c,d,e,f,g){this._g=0,a.xt(this,b,c,d,e,f,g)};d.ext(Nf,Mf,{a5:function(){
return this._h._u&&this._h.b1(),this._g},a2:function(){return this._d},a3:function(){return this._e},a1:function(a){return this._d!==a?this._d:this._e},a4:function(){for(var a=0;a<=1;a++)this._k[a]=null,this._f[a]=null},a8:function(){return this._k[0]},a7:function(){return this._k[1]},a6:function(a,b,c,d){this.a0(d),this._h=a,this._k=Vg.d(2),this._f=Vg.d(2),this._d=b,this._e=c}});var Of=function(a){this._j=0,this._h=a,this.i4()};d.ext(Of,Object,{i2:function(){this._k=this._k._k[this._j],this._k==null&&this._j===0&&(this._k=this._h._o[1],this._j=1)},i3:function(){this._k=this._k._f[this._j],this._k==null&&this._j===1&&(this._k=this._h._q[0],this._j=0)},i4:function(){this._k=this._h._o[0],this._k==null?(this._k=this._h._o[1],this._j=1):this._j=0},i5:function(){this._k=this._h._q[1],this._k==null?(this._k=this._h._q[0],this._j=0):this._j=1},i1:function(){return this._k!=null},i6:function(){return this._k},i8:function(){return this._k},i7:function(){return this._h.ad()}});var Pf=function(){this._a=ug._A,this._b=ug._A,this._c=new Ce};d.ext(Pf,Object,{i1:function(){return this._c.size()},i2:function(a){return this._c.get(a)},i3:function(a,b,c){this._c.set(a,new ef(b,c))},i4:function(a,b){this._c.add(new ef(a,b))},i5:function(){this._c.clear()},i6:function(){return this._a},i7:function(){return this._b},i8:function(a){this._a=a},i9:function(a){this._b=a}});var Qf=function(){this._x=0,this._y=0,this._w=0,this._h=0};d.ext(Qf,Object,{i5:function(a,b){this._x=a,this._y=b},i6:function(a,b){this._w=a,this._h=b},i4:function(){return this._h},i3:function(){return this._w},i1:function(){return this._x},i2:function(){return this._y}});var Rf=function(a,b,c,d){this._m=a,this._n=b,this._l=c,this._k=d};d.ext(Rf,Object,{i1:function(a){return this._k[a.al()]},i3:function(a){return this._m[a.al()]},i2:function(a){return this._n[a.al()]},i4:function(a){return this._l[a.al()]},z1:function(a,b){this._k[a.al()]=b},i6:function(a,b){this._m[a.al()]=b},i7:function(a,b){this._n[a.al()]=b},i5:function(a,b){this._l[a.al()]=b}});var Sf=function(a,b){this._b=a,this._r=b,this._a=[];for(var c=this._b-1;c>=0;c--)this._a.push(c);this._c=new Ce};d.ext(Sf,Object,{a1:function(a){var b;if(this._a.length===0){this.a2(a,this._b,this._b+this._r);for(var c=this._b+this._r-1;c>this._b;c--)this._a.push(c);b=this._b,this._b+=this._r}else b=this._a.pop();return b},b:function(a){var b=this.a1(a),c=new Bf(b,this);return this._c.add(c),this.a4(a,b),c},c:function(a){var b=this.a1(a),c=new Cf(b,this);return this._c.add(c),this.a4(a,b),c},a2:function(a,b,c){for(var d=a._a;d!=null;d=d._a){var e=Vg.d(c);Vg.f(d._c,e,b),d._c=e}},a3:function(a,b,c){var d=Vg.d(c);Vg.f(a._c,d,b),a._c=d},a4:function(a,b){for(var c=a._a;c!=null;c=c._a)c._c[b]=null},a5:function(a,b){if(a instanceof Bf){var c=a;if(c.c())throw"Error";c.d();var d=a._i;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}},a6:function(a,b){if(a instanceof Cf){var c=a;if(c.a())throw"Error";c.b();var d=c._d;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}}});var Tf=function(a){this._id=d.id(),this._p=0,a.xs(this)};d.ext(Tf,Mf,{ad:function(){return this._n[0]+this._n[1]},ak:function(){return this._n[1]},ao:function(){return this._n[0]},al:function(){return this._g._y&&this._g.c(),this._p},ag:function(){return this._o[0]},ae:function(){return this._o[1]},af:function(){return new Of(this)},am:function(){return new If(this,1)},ap:function(){return new If(this,0)},an:function(){return new Vf(this)},aq:function(){return new Uf(this,1)},aw:function(){return new Uf(this,0)},ah:function(a){for(var b=this._o[0];b!=null;b=b._k[0])if(b.a3()===a)return b;return null},ai:function(a){for(var b=this._o[1];b!=null;b=b._k[1])if(b.a2()===a)return b;return null},aj:function(a){var b=this.ah(a);return b==null&&(b=this.ai(a)),b},au:function(a){this.at(a,1,Vg.d(this.ak()))},av:function(a){this.at(a,0,Vg.d(this.ao()))},as:function(a,b){this.a0(b),this._g=a,this._o=Vg.d(2),this._q=Vg.d(2),this._n=Vg.a(2)},ab:function(a,b,c,d,e){if(b==null){this.aa(a,c,d);return}var f;b._d===b._e?f=d:f=this!==b._d?1:0;if(e===0){var g=b._k[f];a._f[d]=b,a._k[d]=g,b._k[f]=a,g==null?this._q[c]=a:g._d===g._e?g._f[d]=a:g._f[this!==g._d?1:0]=a}else{var h=b._f[f];a._k[d]=b,a._f[d]=h,b._f[f]=a,h==null?this._o[c]=a:h._d===h._e?h._k[d]=a:h._k[this!==h._d?1:0]=a}this._n[c]++},aa:function(a,b,c){var d=this._q[b];a._k[c]=null,d==null?(this._o[b]=a,a._f[c]=null):(a._f[c]=d,d._d===d._e?d._k[c]=a:d._k[this!==d._d?1:0]=a),this._q[b]=a,this._n[b]++},ar:function(a,b,c){var d,e;d=a._k[c],e=a._f[c],d==null?this._q[b]=e:d._f[d._d!==this?1:0]=e,e==null?this._o[b]=d:e._k[e._d!==this?1:0]=d,this._n[b]--},ac:function(){for(var a=0;a<=1;a++)this._o[a]=null,this._q[a]=null,this._n[a]=0},at:function(a,b,c){if(this._n[b]<2)return;var d=this._n[b],e=0,f;for(f=this._o[b];f!=null;f=f._k[b])c[e]=f,e++;Vg.s(c,d,a);var g=this._o[b]=c[0];g._f[b]=null;for(var h=1;h<d;)f=c[h],f._f[b]=g,g._k[b]=f,h++,g=f;this._q[b]=f,f._k[b]=null}});var Uf=function(a,b){Uf.superClass.constructor.call(this,a,b),this._h=b!==1?1:0};d.ext(Uf,If,{i6:function(){return this.i9()},i9:function(){return this._h!==0?this._o._e:this._o._d}});var Vf=function(a){Vf.superClass.constructor.call(this,a)};d.ext(Vf,Of,{i6:function(){return this._k.a1(this._h)},i9:function(){return this._k.a1(this._h)}});var Wf=function(a){Wf.superClass.constructor.call(this,a)};d.ext(Wf,Df,{i9:function(){return this.i6()}});var Xf=function(a){this._o=a,this._c=a._a};d.ext(Xf,Object,{i1:function(){return this._c!=null},i2:function(){this._c=this._c._a},i3:function(){this._c=this._c._b},i5:function(){this._c=this._o._b},i4:function(){this._c=this._o._a},i7:function(){return this._o._c},i6:function(){return this._c},i9:function(){return this._c},i8:function(){return this._c}});var Yf=function(a){if(a&&a.length){Yf.superClass.constructor.call(this);for(var b=0;b<a.length;b++)this.ae(a[b])}else Yf.superClass.constructor.call(this,a)};d.ext(Yf,Ff,{x1:function(){return new Wf(this)},x2:function(){return this.am()},x3:function(){return this.as()},x4:function(){return this.at()}});var Zf=function(a){this._d=a,Zf.superClass.constructor.call(this)};d.ext(Zf,Yf,{});var $f=function(a){this._a=a,this._b=new Gf,this._c=new Yf};d.ext($f,Object,{a:function(){for(var a=this._a.x9();a.i1();a.i2())this.e(a.i9())},b:function(){this.c(),this.d()},c:function(){while(!this._c.ar()){var a=this._c.x4();this._a.xq(a)||this.g(a)}},d:function(){while(!this._b.ar()){var a=this._b.c3();this._a.xp(a)||this.f(a)}},e:function(a){for(var b=a.af();b.i1();b.i2())this._b.ac(b.i8()),this._a.h1(b.i8());this._c.ac(a),this._a.h2(a)},f:function(a){this._a.u1(a)},g:function(a){this._a.h3(a)}}),$f.h=function(a,b){b.i4();for(;b.i1();b.i2()){var c=b.i8();a.xq(c.a2())||a.h3(c.a2()),a.xq(c.a3())||a.h3(c.a3()),a.xp(c)||a.u1(c)}},$f.i=function(a,b){b.i4();for(;b.i1();b.i2()){var c=b.i8();a.xp(c)&&a.h1(c),c.a2().ad()===0&&a.h2(c.a2()),c.a3().ad()===0&&a.h2(c.a3())}};var _f=function(){this._g=arguments[0],this._f=this._g.xk(),this._h=this._g.xk(),this._d=new Ff,this._e=0,arguments.length!==1&&this.a(arguments[1],arguments[2],arguments[3],arguments[4])};d.ext(_f,Object,{a:function(a,b,c,d){var e=Vg.d(c-b+1);for(var f=b;f<=c;f++)e[f]=new Zf(f);for(var g=this._g.x9();g.i1();g.i2()){var h=g.i9();if(d==null||d.i4(h))this._f.z1(h,e[a.i2(h)-b].ac(h)),this._e++}for(var i=0;i<e.length;i++){var j=e[i],k=this._d.ae(j);for(var l=j.x1();l.i1();l.i2())this._h.z1(l.i9(),k)}},c:function(){this._g.xi(this._h),this._g.xi(this._f)},e:function(){return this._e===0},g:function(){for(;this._d.am().ar();this._d.at());this._e--;var a=this._d.am().x4();return this._h.z1(a,null),this._f.z1(a,null),a},f:function(){for(;this._d.as().ar();this._d.au());this._e--;var a=this._d.as().x4();return this._h.z1(a,null),this._f.z1(a,null),a},d:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.a();f!=null?(e=f.d(),this._h.z1(a,f)):(e=new Zf(d._d+1),this._h.z1(a,this._d.ae(e))),d.aw(b),this._f.z1(a,e.ac(a))},b:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.b();f!=null?(e=f.d(),this._h.z1(a,f)):(e=new Zf(d._d-1),this._h.z1(a,this._d.ac(e))),d.aw(b),this._f.z1(a,e.ac(a))}});var ag={};ag.a1=function(a){return new Rf(a,null,null,null)},ag.a2=function(a){return new Rf(null,a,null,null)},ag.a3=function(a){return new Rf(null,null,a,null)},ag.a4=function(a){return new Kf(null,a,null,null)},ag.a5=function(a){return new Kf(null,null,a,null)},ag.a6=function(a){return new Kf(null,null,null,a)};var bg=function(){if(arguments.length===2){this._a=new Ff,this._b=new Ff,this._c=0;var a=arguments[0],b=arguments[1],c=new cg(a._j2.gj(b)/2,0);this._a.ac(c),c=new cg(a._j2.gj(b)/2,0),this._b.ac(c)}else this._a=arguments[1],this._b=arguments[2],this._c=arguments[3]};d.ext(bg,Object,{});var cg=function(a,b){this._b=a,this._a=b};d.ext(cg,Object,{});var dg=function(){this._cx=!0,this._cs=new pg,this._ct=new ng,this._cw=new og};d.ext(dg,Object,{i5:function(a){this._cx=a},k:function(){var a=new qg(this);return this._cx&&(this._cs.w1(a),a=this._cs),this._cw.w1(a),a=this._cw,this._ct.w1(a),a=this._ct,a},i2:function(a){this.k().i2(a)},i1:function(a){return this.k().i1(a)}});var eg=function(){eg.superClass.constructor.call(this),this._jv=20,this._jw=40,this._jx=function(a,b){var c=a.a3(),d=b.a3(),e=c._g;return Math.floor(100*(e.g5(c)-e.g5(d)))}};d.ext(eg,dg,{i4:function(a){return yf.a1(a)},i3:function(a){if(!this.i4(a))throw"Error";var b=yf.a3(a);this._j2=a,this._j3=new fg(a),Cg.c(a),this._jy=a.xk();if(!a.xb()){this.bu();var c=this._j3.c1();this.f(c),this.b(this._j3),this.c(this._j3)}var d;for(;!b.ar();a.x3(d))d=b.c3(),Cg.b(a.g2(d))},bu:function(){if(this._jx!=null)for(var a=this._j2.x9();a.i1();a.i2())a.i9().av(this._jx)},c:function(a){var b=this.a2(a),c=Vg.a(b.length);for(var d=0;d<b.length;d++){var e=b[d],f=0;for(var g=e.ah();g.i1();g.i2()){var h=g.i6();f=Math.max(f,this._j2.g9(h))}c[d]=f}var i=-this._jw;for(var j=0;j<b.length;j++){i+=this._jw+c[j];var k=b[j];for(var l=k.ah();l.i1();l.i2()){var m=l.i6();this._j2.s2(m,this._j2.g5(m),i-c[j]/2)}}},a2:function(a){var b=Vg.d(a.b());for(var c=0,d=a.b();c<d;c++)b[c]=new Ff;return a.c1(),this.a1(a.c1(),0,b),b},a1:function(a,b,c){c[b].ae(a);for(var d=a.aw();d.i1();d.i2())this.a1(d.i9(),b+1,c)},b:function(a){var b=a.c1();this._j2.s2(b,0,this._j2.g6(b)),this.g(b)},g:function(a){for(var b=a.aw();b.i1();b.i2()){var c=b.i9(),d=this._jy.i1(c);this._j2.s2(c,this._j2.g5(a)+d._c,this._j2.g6(c)),this.g(c)}},f:function(a){if(this._j3.c2(a)){this._jy.z1(a,new bg(this,a));return}var b=a.aw(),c=b.i9();b.i2(),this.f(c);var d=this._jy.i1(c),e=new bg(this,d._a,d._b,0);if(!b.i1()){e._a.ac(new cg(this._j2.gj(a)/2,0)),e._b.ac(new cg(this._j2.gj(a)/2,0)),this._jy.z1(a,e);return}while(b.i1()){c=b.i9(),b.i2(),this.f(c),d=this._jy.i1(c);var f=e._b.ah(),g=d._a.ah(),h=2147483647,i=0,j=0;while(f.i1()&&g.i1()){var k=f.i6();f.i2();var l=g.i6();g.i2(),j+=k._a,i+=l._a,h=Math.min(h,i-j-k._b-l._b)}d._c=this._jv-h,i+=d._c;var m=d._b.am();m._a=d._c;if(f.i1()&&!g.i1())for(var n=j-this.a3(d._b);f.i1();n=0){var o=f.i6();f.i2(),d._b.ae(new cg(o._b,o._a+n))}else if(!f.i1()&&g.i1()){var p=this.a3(e._a);for(p=i-p;g.i1();p=0){var q=g.i6();g.i2(),e._a.ae(new cg(q._b,q._a+p))}}e._b=d._b}this._jy.z1(a,e);var r=-d._c/2;for(var s=a.aw();s.i1();){var t=s.i9();s.i2();var u=this._jy.i1(t);u._c+=r;var v=u._b.am();v._a+=r,v=u._a.am(),v._a+=r}e._a.ac(new cg(this._j2.gj(a)/2,0)),e._b.ac(new cg(this._j2.gj(a)/2,0))},a3:function(a){var b=0;for(var c=a.ah();c.i1();c.i2()){var d=c.i6();b+=d._a}return b}});var fg=function(a){this._b=a,this.a()};d.ext(fg,Object,{c1:function(){return this._a==null&&this.a(),this._a},b:function(){return this._a==null?-1:this.d(this._a)},d:function(a){var b=0;for(var c=a.aw();c.i1();c.i2())b=Math.max(b,this.d(c.i9()));return b+1},c2:function(a){return a.ao()===0},a:function(){for(var a=this._b.x9();a.i1();a.i2())if(a.i9().ak()===0){this._a=a.i9();return}}});var gg=function(a){this._d=0,this._e=0,this._f=0,this._a=0,this._b=0,this._g=a,this._c=new Ff};d.ext(gg,Object,{a:function(){return this._d+this._e+this._f}});var hg=function(){hg.superClass.constructor.call(this),this._kl=340,this._km=360,this._kk=40,this._ko=.5};d.ext(hg,dg,{ic:function(){return this._km},ia:function(){return this._kl},i9:function(){return this._ko},i3:function(a){if(!yf.a1(a))throw"Error";this._a=a;var b=this.i8(),c=yf.a4(a,b);Cg.c(a),this._kn=Vg.d(a.x0());for(var d=a.x9();d.i1();d.i2()){var e=d.i9();e!==b?this.aa(e,new gg(this._kk+this.q(e.aq().i9()))):this.aa(e,new gg(this._kk))}this.s(b),a.s2(b,0,0),this.t(b);var f;for(;!c.ar();a.x3(f))f=c.c3()},i4:function(a){return yf.a1(a)},i0:function(a){return this._kn[a.al()]},i8:function(){return yf.a2(this._a)},i7:function(a){var b=this.ib(a),c;do{c=this.i6(a);if(c<=b)break;for(var d=a.aw();d.i1();d.i2()){var e=d.i9();this.i0(e)._g*=1+this._ko}}while(!0);var f=(b-c)/(2*a.ao());c=0;for(var g=a.aw();g.i1();g.i2()){var h=this.i0(g.i9());h._d+=f,h._e+=f,c+=h._d+h._e}this.id(a)},id:function(a){var b=Vg.d(a.ao()),c=0;for(var d=a.ap();d.i1();)b[c]=d.i8(),d.i2(),c++;var e=this;b.sort(function(a,b){var c=a.a3(),d=b.a3(),f=e.i0(c).a()-e.i0(d).a();return f>0?1:f>=0?0:-1});for(var f=0;f<b.length;f++)this._a.h1(b[f]);for(var g=0;g<b.length;g+=2)this._a.u1(b[g]);c=b.length-1,c%2===0&&c--;for(;c>0;c-=2)this._a.u1(b[c])},ib:function(a){return a.ak()===0?this._km:a.ao()===2?Math.min(180,this._kl):this._kl},i6:function(a){var b=0;for(var c=a.ap();c.i1();c.i2()){var d=c.i8(),e=d.a3(),f=this.i0(e),g=-f._g,h=f._b,i=f._c,j=0,k=j+1,l=i._b,m=l.d(),n;for(;k>j;k=(n.y-h)/(n.x-g))n=m,l=i.ai(l),m=l.d(),j=(m.y-n.y)/(m.x-n.x);f._d=-Math.atan(k)*180/Math.PI,j=0,k=j-1,l=i._b;for(m=l.d();l.a().d().x===m.x;m=l.d())l=l.a();var o;for(;k<j;k=(o.y-h)/(o.x-g))o=m,l=i.aj(l),m=l.d(),j=(m.y-o.y)/(m.x-o.x);f._e=Math.atan(k)*180/Math.PI,b+=f._d+f._e}return b},aa:function(a,b){this._kn[a.al()]=b},p:function(a){var b=this.i0(a),c=new Ff,d=2*this.q(a);c.aa(new ef(0,0)),c.aa(new ef(0,d)),c.aa(new ef(d,d)),c.aa(new ef(d,0)),b._c=c,b._a=d/2,b._b=d/2},r:function(a){if(a.ao()===0)this.p(a);else{var b=this.i0(a),c=this.q(a),d=new Ff;d.aa(new ef(-c,-c)),d.aa(new ef(-c,c)),d.aa(new ef(c,-c)),d.aa(new ef(c,c));for(var e=a.aw();e.i1();e.i2()){var f=this.i0(e.i9());d.az(f._c)}var g=ug.h(d),h=Number.MAX_VALUE,i=Number.MAX_VALUE,j=Number.MIN_VALUE,k=Number.MIN_VALUE;for(var l=g.ah();l.i1();l.i2()){var m=l.i6();m.x<h&&(h=m.x),m.x>j&&(j=m.x),m.y<i&&(i=m.y),m.y>k&&(k=m.y)}var n=new Ff;for(var o=g.ah();o.i1();o.i2()){var p=o.i6();n.aa(new ef(p.x-h,p.y-i))}b._c=n,b._a=-h,b._b=-i}},s:function(a){if(a.ao()===0)this.r(a);else{for(var b=a.aw();b.i1();b.i2())this.s(b.i9());this.i7(a);var c=0;for(var d=a.aw();d.i1();d.i2()){var e=d.i9(),f=this.i0(e),g=180-(360-this.ib(a))/2-c-(f._e+f._f);c+=f.a(),g=g/180*Math.PI;var h=Math.sin(g),i=Math.cos(g);for(var j=f._c._b;j!=null;j=j.a()){var k=j.d(),l=k.x+f._g,m=k.y-f._b,n=new ef(l*i-h*m,l*h+i*m);j.c(n)}var o=f._a+f._g;f._a=o*i,f._b=o*h}this.r(a)}},t:function(a){var b=this._a.g4(a),c=0;if(a.ak()>0){var d=a.aq().i9(),e=this._a.g4(d);c=Math.PI+Math.atan2(e.y-b.y,e.x-b.x)}for(var f=a.aw();f.i1();f.i2()){var g=f.i9(),h=this.i0(g);if(c!==0){var i=Math.cos(c),j=Math.sin(c),k=h._a*i-j*h._b,l=h._a*j+i*h._b;h._a=k,h._b=l}this._a.s2(g,b.x+h._a,b.y+h._b),this.t(g)}},q:function(a){return 1.41*(Math.max(this._a.gj(a),this._a.g9(a))/2)}});var ig=function(){};d.ext(ig,Object,{i2:function(a){return a.ad()},i1:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var jg=function(a){this._a=a};d.ext(jg,Object,{i2:function(a){var b=0;for(var c=a.an();c.i1();c.i2())this._a.i1(c.i9())!=null&&b++;return b},i4:function(a){return this._a.i1(a)==null},i1:function(a){throw"Error"},i3:function(a){throw"Error"}});var kg=function(){kg.superClass.constructor.call(this),this._kq=!1,this._kp=90};d.ext(kg,hg,{a:function(a,b){this._kr=b,this._ks=a,this._kq=!0},i7:function(a){if(!this.u(a)){kg.superClass.i7.call(this,a);return}var b=this.i9(),c=this.ib(a),d=(360-c)/2+c,e=new Gf(a.ap());do{var f=this.i6(a);f=(360-c)/2;var g=null,h=null;for(var i=e._b;i!=null;i=i.a()){var j=i.d(),k=j.a3(),l=this.i0(k),m=this._ks.i3(j),n=m-(f+l._e);n>=0&&m+l._d>=d&&(f+l.a()<=d?n=d-f-l.a():n=2*(d-(m+l._d))),l._f=0;if(n>=0)l._f=n,g=i,h=l;else{-n>l._d+l._e?n=(l._d+l._e)/2:n/=-2,f-=n,f<=d&&f+l.a()>d&&(f+=n,n=f+l.a()-d,f-=n);for(;g!=null&&n>h._f;h=this.i0(g.d().a3())){n-=h._f,h._f=0,g=g.b();if(g!=null)continue;h=null;break}g!=null?h._f-=n:f+=n}f+=l.a()}if(f<=d){var o=0,p=(360-c)/2;for(var q=a.ap();q.i1();q.i2()){var r=q.i8(),s=r.a3(),t=this._ks.i3(r),u=this.i0(s),v=p+u._f+u._e;o<Math.abs(v-t)&&(o=Math.abs(v-t)),p+=u.a()}if(o<=this._kp)break}for(var w=a.aw();w.i1();w.i2()){var x=w.i9();this.i0(x)._g*=1+b}}while(!0)},ib:function(a){return this.u(a)?a.ak()===0?this.ic():this.ia():kg.superClass.ib.call(this,a)},u:function(a){return!this._kq||a.ao()===0?!1:this._ks.i1(a.ag())!=null}});var lg=function(a){this._a=a};d.ext(lg,Object,{i1:function(a){return this._a.i1(a)},i2:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var mg=function(){};d.ext(mg,Object,{w1:function(a){this._bb=a},w2:function(){return this._bb},w4:function(a){this._bb!=null&&this._bb.i2(a)},w3:function(a){return this._bb!=null?this._bb.i1(a):!0}});var ng=function(){this._cg=45,this._ce=400,this._ch=400,this._cf=0};d.ext(ng,mg,{i1:function(a){if(this.w2()!=null){var b=!0,c=a.xk(),d=rf.a3(a,c),e=Vg.d(d),f=Vg.d(d);for(var g=0;g<d;g++)e[g]=new Yf,f[g]=new Gf;for(var h=a.xf();h.i1();h.i2()){var i=h.i8();f[c.i2(i.a2())].aa(i),a.h1(i)}for(var j=a.x9();j.i1();j.i2()){var k=j.i9();e[c.i2(k)].aa(k),a.h2(j.i9())}for(var l=0;l<d;l++){for(var m=e[l].x1();m.i1();m.i2())a.h3(m.i9());for(var n=f[l].c1();n.i1();n.i2())a.u1(n.i8());b=this.w3(a);for(var o=f[l].c1();o.i1();o.i2())a.h1(o.i8());for(var p=e[l].x1();p.i1();p.i2())a.h2(p.i9());if(!b)break}for(var q=0;q<d;q++)for(var r=e[q].x1();r.i1();r.i2())a.h3(r.i9());for(var s=0;s<d;s++)for(var t=f[s].c1();t.i1();t.i2())a.u1(t.i8());return a.xi(c),b}return!0},i2:function(a){if(a.xb())return;var b=a.xk(),c=rf.a3(a,b),d=Vg.d(c),e=Vg.d(c),f=Vg.d(c),g=Vg.d(c);for(var h=0;h<c;h++)d[h]=new Yf,e[h]=new Gf;for(var i=a.xf();i.i1();i.i2()){var j=i.i8();e[b.i2(j.a2())].aa(j),a.h1(j)}for(var k=a.x9();k.i1();k.i2()){var l=k.i9();d[b.i2(l)].aa(l),a.h2(k.i9())}for(var m=0;m<c;m++){for(var n=d[m].x1();n.i1();n.i2())a.h3(n.i9());for(var o=e[m].c1();o.i1();o.i2())a.u1(o.i8());this.w4(a);var p=a.g3();f[m]=new hf(p.x,p.y,p.width,p.height);var q={};g[m]=q;if(this._cf>0){var r=this._cg+Math.ceil((p.width+1)/this._cf)*this._cf,s=this._cg+Math.ceil((p.height+1)/this._cf)*this._cf;q.x=p.x,q.y=p.y,q.width=r,q.height=s}else q.x=p.x,q.y=p.y,q.width=p.width+this._cg,q.height=p.height+this._cg;for(var t=e[m].c1();t.i1();t.i2())a.h1(t.i8());for(var u=d[m].x1();u.i1();u.i2())a.h2(u.i9())}for(var v=0;v<c;v++)for(var w=d[v].x1();w.i1();w.i2())a.h3(w.i9());for(var x=0;x<c;x++)for(var y=e[x].c1();y.i1();y.i2())a.u1(y.i8());Cg.a(g,null,this._ce/this._ch);if(this._cf<=0)for(var z=0;z<g.length;z++)this.w5(a,d[z],e[z],new ef(g[z].x,g[z].y),f[z]);else for(var A=0;A<g.length;A++){var B=Math.floor((g[A].x-f[A].x)/this._cf)*this._cf,C=Math.floor((g[A].y-f[A].y)/this._cf)*this._cf,D=f[A].x+B,E=f[A].y+C;this.w5(a,d[A],e[A],new ef(D,E),f[A])}a.xi(b)},w5:function(a,b,c,d,e){var f=-e.x+d.x,g=-e.y+d.y;for(var h=b.x1();h.i1();h.i2()){var i=a.ga(h.i9());a.s4(h.i9(),new ef(i.x+f,i.y+g))}for(var j=c.c1();j.i1();j.i2()){var k=j.i8(),l=new Ce;for(var m=a.gp(k).c();m.i1();m.i2()){var n=m.i6();l.add(new ef(n.x+f,n.y+g))}a.s5(k,new kf(l))}}});var og=function(){};d.ext(og,mg,{i1:function(a){return this.w3(a)},i2:function(a){this.w7(a),this.w2()!=null&&this.w4(a),this.w6(a)},w7:function(a){this.e(a),this.k(a),this.i(a)},e:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},w6:function(a){this.l(a),this.j(a),this.f(a)},l:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},j:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},k:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},f:function(a){this._ca!=null&&(a.x1("A",this._ca),this._ca=null,this._b6=null),this._b8!=null&&(a.x1("B",this._b8),this._b8=null,this._b9=null)},i:function(a){this._ca=a.xc("A"),this._ca!=null&&(this._b6=new lg(this._ca),a.x1("A",this._b6)),this._b8=a.xc("B"),this._b8!=null&&(this._b9=new lg(this._b8),a.x1("B",this._b9))}});var pg=function(){this._a=new Gf,this._c=10};d.ext(pg,mg,{i2:function(a){this._b=a.xl(),this.w9(a),this.w4(a),this.c(a),this.w8(a,this._b),a.xj(this._b)},i1:function(a){if(this.w2()==null)return!0;this._b=a.xl(),this.w9(a);var b=this.w3(a);return this.c(a),a.xj(this._b),b},w8:function(a,b){for(var c=a.xf();c.i1();c.i2()){var d=c.i8();if(b.i1(d)!=null){var e=b.i1(d);Cg.g(a,d,e,this._c)}}},w9:function(a){var b=a.xk();for(var c=a.x9();c.i1();c.i2()){var d=c.i9();for(var e=d.af();e.i1();e.i2()){var f=e.i8(),g=f.a1(d),h=b.i1(g);if(h!==f)if(h==null)b.z1(g,f);else{this._b.i1(h)==null&&this._b.i8(h,new Gf);var i=this._b.i1(h);i.aa(f),this._a.ac(f),a.h1(f)}}for(var j=d.af();j.i1();j.i2()){var k=j.i8(),l=k.a1(d);b.z1(l,null)}}a.xi(b)},c:function(a){for(;!this._a.ar();a.u1(this._a.c3()));}});var qg=function(a){this._a=a};d.ext(qg,Object,{i2:function(a){this._a.i3(a)},i1:function(a){return this._a.i4(a)}});var rg=function(){rg.superClass.constructor.call(this),this._jo=30,this._jp=new vg,this._jt=5};d.ext(rg,dg,{i4:function(a){return!0},i3:function(a){this._ju=a,Cg.c(a);var b=this._jp.i1(a),c=0;for(var d=a.x9();d.i1();d.i2())c=Math.max(c,this.e(d.i9()));c<this._jt&&(c=this._jt),this.a(b,c)},a:function(a,b){var c=a.i7(),d=2*Math.PI/c,e=0,f=Vg.a(c);a.i4();for(var g=0;g<c;)f[g]=this.e(a.i9())+this._jo,e+=f[g],g++,a.i2();var h=e/c,i=e/(Math.PI*2);i<b&&(i=b),a.i4();var j=0;for(var k=0;k<c;){var l=d/h*f[k];j+=l/2;var m=Math.cos(j)*i,n=Math.sin(j)*i;j+=l/2,this._ju.s2(a.i9(),m,n),k++,a.i2()}return i},e:function(a){var b=this._ju.gj(a),c=this._ju.g9(a);return b<=c?c:b}});var sg=function(){sg.superClass.constructor.call(this),this._jm=new rg,this._jk=new kg};d.ext(sg,dg,{i4:function(a){return!0},i3:function(a){if(a.x0()<2)return;this._jn=a,Cg.c(this._jn),Cg.e(this._jn);var b=new Ag(this._jn);b.a1(),b.h();var c=new $f(this._jn);c.a();for(var d=b.x9();d.i1();d.i2()){var e=d.i9(),f=b.c2(e);if(f.ay()>1){var g=b.d1(e);$f.h(this._jn,g.c1()),this._jm.i3(this._jn);var h=this._jn.g3();b.s7(e,h.width,h.height)}else if(f.ay()===1){var i=f.x2();b.s8(e,this._jn.gm(i)),this._jn.s2(i,0,0)}else b.s7(e,1,1);$f.i(this._jn,this._jn.xf())}c.b();var j=this.a7(b);yf.a4(b,j);var k=b.xk(),l=b.xl();this.a2(b,l,k),this.a1(b,l),this.a3(b,j,l),this._jk.a(l,k),this._jk.i3(b),this.a5(b,j,k);for(var m=b.x9();m.i1();m.i2()){var n=m.i9(),o=b.g4(n);for(var p=b.c2(n).x1();p.i1();p.i2()){var q=p.i9();this._jn.s2(q,o.x+this._jn.g5(q),o.y+this._jn.g6(q))}}},a7:function(a){var b=-1,c=null;for(var d=a.x9();d.i1();d.i2()){var e=d.i9();a.c2(e).ay()>b&&(c=e,b=a.c2(e).ay())}return c},a1:function(a,b){var c=function(a,c){var d=b.i3(a)-b.i3(c);return d>0?1:d>=0?0:-1};for(var d=a.x9();d.i1();d.i2())d.i9().av(c)},a2:function(a,b,c){var d=Vg.a(this._jn.x0());for(var e=a.x9();e.i1();e.i2()){var f=e.i9(),g=a.c2(f);for(var h=g.x1();h.i1();h.i2()){var i=h.i9();d[i.al()]=f.al()}}var j=yf.a2(a);this.a4(a,j,d,b,c)},a3:function(a,b,c){if(a.c2(b).ay()>1){var d=0,e=0,f=0;for(var g=b.ap();g.i1();g.i2()){var h=g.i8(),i=c.i3(h);i-d>e&&(e=i-d,f=(d+i)/2),d=i}360-d>e&&(f=(360+d)/2),this.a6(a,b,f);for(var j=b.ap();j.i1();j.i2()){var k=j.i8(),l=c.i3(k);for(l-=f;l<0;l+=360);c.i6(k,l)}b.av(function(a,b){var d=c.i3(a)-c.i3(b);return d>0?1:d>=0?0:-1})}},a4:function(a,b,c,d,e){var f=b.al(),g=e.i3(b);for(var h=b.ap();h.i1();h.i2()){var i=h.i8(),j=a.b(i),k=0,l=0,m=0,n=0;for(var o=j.c1();o.i1();o.i2()){var p=o.i8(),q=null,r=null;c[p.a2().al()]===f?(q=p.a2(),r=p.a3()):(q=p.a3(),r=p.a2()),m-=this._jn.g5(q),n+=this._jn.g6(q),k-=this._jn.g5(r),l+=this._jn.g6(r)}if(m!==0||n!==0){var s;for(s=Math.atan2(n,m)*180/Math.PI-g;s<0;s+=360);d.i6(i,s)}if(k!==0&&l!==0){var t=Math.atan2(l,k)*180/Math.PI;t<0&&(t+=360),e.i6(i.a3(),t)}this.a4(a,i.a3(),c,d,e)}},a5:function(a,b,c){var d=a.g4(b);for(var e=b.ap();e.i1();e.i2()){var f=e.i8(),g=f.a3(),h=a.g4(g),i=h.x-d.x,j=h.y-d.y,k=Math.atan2(j,i)*180/Math.PI;if(c.i1(g)!=null){var l=c.i3(g);k+=l}this.a6(a,g,k),this.a5(a,g,c)}},a6:function(a,b,c){c=c/180*Math.PI;var d=a.c2(b);if(d.ay()<=1)return;for(var e=d.x1();e.i1();e.i2()){var f=e.i9(),g=this._jn.g5(f),h=this._jn.g6(f),i=Math.cos(c),j=Math.sin(c),k=g*i-j*h,l=g*j+i*h;this._jn.s2(f,k,l)}}});var tg=function(){this._a=(new Date).getTime()};d.ext(tg,Object,{b:function(){return(new Date).getTime()-this._a}});var ug={};ug._A=new ef(0,0),ug.b=function(a,b,c){return ug.c(a.x,a.y,b.x,b.y,c.x,c.y)},ug.c=function(a,b,c,d,e,f){c-=a,d-=b,e-=a,f-=b;var g=e*d-f*c;return g>=0?g<=0?0:-1:1},ug.d=function(a,b,c){return ug.b(a,b,c)>0},ug.f=function(a,b,c){return ug.b(a,b,c)<0},ug.g=function(a,b,c){return ug.b(a,b,c)===0},ug.h=function(a){return ug.i(a)},ug.i=function(a){var b=new Ff(a.ah()),c=new Ff;b.a2();if(b.ar())return c;var d=b.at();c.ae(d);for(;!b.ar()&&d.equals(b.am());b.at());if(b.ar())return c;d=b.at();var e=c.ae(d);for(var f=b.ah();f.i1();f.i2()){var g=f.i6();if(!g.equals(d)){d=g;if(c.ay()===2&&ug.g(c.am(),c.as(),g))e.c(g);else{var h;for(h=e;!ug.f(c.ai(h).d(),h.d(),g);h=c.ai(h));var i;for(i=e;!ug.d(c.aj(i).d(),i.d(),g);i=c.aj(i));for(;i!==c.aj(h);c.aw(c.aj(h)));e=c.an(g,h)}}}return c},ug.j=function(){return ug.k(Number.MAX_VALUE)},ug.k=function(a){return Math.floor(Math.random()*a)},ug.l=function(a,b){return Math.random()*(b-a)+a};var vg=function(){};d.ext(vg,Object,{i1:function(a){this._b=a;var b=new Gf;b=rf.a6(a),b.az(rf.a7(a));var c=this.a1();for(;!b.ar();a.x5(b.c3()));return c.x1()},a1:function(){if(this._b.x0()<3)return new Yf(this._b.x9());var a=this._b.xk(),b=this._b.xk(),c=this._b.xl(),d=new _f(this._b,new ig,0,this.a3(this._b)),e=this._b.x0(),f=new Gf,g=new Gf,h=new $f(this._b);for(;e>3;e--){var i=d.g();for(var j=i.an();j.i1();j.i2())a.z1(j.i9(),e),b.i5(j.i9(),!1);for(var k=i.an();k.i1();k.i2()){var l=k.i9();for(var m=l.ap();m.i1();m.i2()){var n=m.i8();a.i2(n.a3())===e&&(g.aa(n),b.i5(n.a2(),!0),b.i5(n.a3(),!0))}}if(g.ay()<i.ad()-1){var o=null;for(var p=i.an();p.i1();p.i2()){var q=p.i9();if(a.i2(q)===e&&!b.i4(q))if(o==null)o=q;else{var r=this._b.xo(o,q);c.i7(r,!0),g.aa(r),o=null}}if(o!=null)for(var s=i.an();s.i1();s.i2()){var t=s.i9();if(t===o||t.aj(o)!=null)continue;var u=this._b.xo(o,t);c.i7(u,!0),g.aa(u);break}if(g.ay()<i.ad()-1){var v=2147483647,w=null;for(var x=i.an();x.i1();x.i2()){var y=x.i9();y.ad()<v&&(w=y,v=y.ad())}for(var z=i.an();z.i1();z.i2()){var A=z.i9();if(w.aj(A)!=null||w===A)continue;var B=this._b.xo(w,A);c.i7(B,!0),g.aa(B);if(g.ay()>=i.ad()-1)break}}}for(var C=i.an();C.i1();C.i2())d.b(C.i9());for(var D=g.c1();D.i1();D.i2()){var E=D.i8();c.i4(E)&&(d.d(E.a2()),d.d(E.a3()))}f.az(g),h.e(i)}h.b(),d.c();for(var F=f.c1();F.i1();F.i2()){var G=F.i8();G._h!=null&&(c.i4(G)?this._b.x5(G):this._b.h1(G))}var H=this.a4(this._b),I=new Yf,J=H.ak(0),K=H.ak(1),L=null;J.a2()===K.a2()||J.a2()===K.a3()?L=J.a3():L=J.a2(),I.aa(L);for(var M=H.c1();M.i1();M.i2()){var N=M.i8();L=N.a1(L),I.aa(L)}for(var O=f.c1();O.i1();O.i2()){var P=O.i8();!c.i4(P)&&P._h==null&&this._b.u1(P)}return this._b.xi(b),this._b.xj(c),this._b.xi(a),this.a2(I),I},a2:function(a){if(a.ay()<this._b.x0()){var b=this._b.xk();for(var c=a._b;c!=null;c=c.a()){var d=c.d();b.z1(d,c)}var e;for(e=new _f(this._b,new jg(b),0,a.ay(),new jg(b));!e.e();){var f=e.f();for(var g=f.an();g.i1();g.i2()){var h=g.i9();if(b.i1(h)==null)continue;var i=b.i1(h),j=a.ai(i).d(),k=null;f.aj(j)!=null?k=a.ao(f,i):k=a.an(f,i),b.z1(f,k);break}for(var l=f.an();l.i1();l.i2()){var m=l.i9();b.i1(m)==null&&e.d(m)}}this._b.xi(b),e.c()}},a3:function(a){var b=0;for(var c=a.x9();c.i1();c.i2())b=Math.max(b,c.i9().ad());return b},a4:function(a){var b=[];for(var c=0,d=a.x0();c<d;c++)b[c]=new wf;var e=new uf(b);e.a6(!1),e.a8(a);var f=-1,g=null;for(var h=a.x9();h.i1();h.i2()){var i=h.i9(),j=b[i.al()];j._a+j._c>f&&(f=j._a+j._c,g=i)}var k=new Gf,l=g;for(var m=b[l.al()]._d;m!=null;m=b[l.al()]._d)k.ac(m),l=m.a1(l);l=g;for(var n=b[l.al()]._b;n!=null;n=b[l.al()]._d)k.ae(n),l=n.a1(l);return k}});var wg=function(){this._v=new Hf,this._x=new Hf,this._z=new Sf(3,5),this._w=new Sf(3,5),this._y=!1,this._u=!1,this._t={}};d.ext(wg,Object,{xm:function(){var a=new Tf(this);return a},xo:function(a,b){return this.xn(a,null,b,null,0,0)},xn:function(a,b,c,d,e,f){return new Nf(this,a,b,c,d,e,f)},x4:function(a){this.b3(a)},b3:function(a){var b;while((b=a._o[0])!=null)this.x5(b);while((b=a._o[1])!=null)this.x5(b);this._v.c(a),a._g=null,this._y=!0},x5:function(a){this.a11(a)},a11:function(a){if(a._h!==this)throw"Error";var b=a.a2(),c=a.a3();this.a12(a,b,c),this._x.c(a),a._h=null,this._u=!0},x7:function(a){a._p=this._v._c,a._g=this,a.ac(),a._c.length<this._z._b&&this._z.a3(a,a._c.length,this._z._b),this._v.a(a),this._y=!0},x8:function(a){if(a._h!=null)throw"Error";a._c.length<this._w._b&&this._w.a3(a,a._c.length,this._w._b),a._a==null||a._a._h!==this?this._x.a(a):this._x.b(a,a._a),a._h=this,a.a4(),this.b2(a,a.a2(),null,a.a3(),null,0,0),this._u=!0},xr:function(a,b,c){var d=a.a2(),e=a.a3();a._h==null?(a._d=b,a._e=c):(d!==b&&(d.ar(a,0,0),a._d=b,b.ab(a,null,0,0,0)),e!==c&&(e.ar(a,1,1),a._e=c,c.ab(a,null,1,1,0)))},x3:function(a){this.xr(a,a.a3(),a.a2())},h1:function(a){this.a11(a)},u1:function(a){this.x8(a)},h2:function(a){this.x4(a)},h3:function(a){this.x7(a)},xa:function(){return this._v._c},x0:function(){return this._v._c},xh:function(){return this._x._c},xg:function(){return this._x._c},xb:function(){return this._v._c===0},xq:function(a){return a._g===this},xp:function(a){return a._h===this},xd:function(){return this._v._a},x9:function(){return new Xf(this._v)},xf:function(){return new Xf(this._x)},x2:function(a,b){var c=Vg.d(this.xh());if(a!=null&&b!=null)for(var d=this.x9();d.i1();d.i2())d.i9().at(a,1,c),d.i9().at(b,0,c);else if(b==null&&a!=null)for(var e=this.x9();e.i1();e.i2())e.i9().at(a,1,c);else if(b!=null&&a==null)for(var f=this.x9();f.i1();f.i2())f.i9().at(b,0,c)},xk:function(){return this._z.b(this._v)},xl:function(){return this._w.c(this._x)},xi:function(a){this._z.a5(a,this._v)},xj:function(a){this._w.a6(a,this._x)},xc:function(a){return this._t[a]},x1:function(a,b){this._t[a]=b},x6:function(a){delete this._t[a]},b2:function(a,b,c,d,e,f,g){b.ab(a,c,0,0,f),d.ab(a,e,1,1,g)},a12:function(a,b,c){b.ar(a,0,0),c.ar(a,1,1)},c:function(){var a=0;for(var b=this.x9();b.i1();b.i2())b.i9()._p=a++;this._y=!1},b1:function(){var a=0;for(var b=this.xf();b.i1();b.i2())b.i8()._g=a++;this._u=!1},xs:function(a){a.as(this,this._z._b),a._p=this._v._c,this._v.a(a)},xt:function(a,b,c,d,e,f,g){a.a6(this,b,d,this._w._b),a._g=this._x._c,this._x.a(a),this.b2(a,a.a2(),c,a.a3(),e,f,g)}});var xg=function(){xg.superClass.constructor.call(this)};d.ext(xg,wg,{gb:function(a){return this.g1(a)},g7:function(a){return this.g2(a)},g5:function(a){var b=this.g1(a);return b.i1()+b.i3()/2},g6:function(a){var b=this.g1(a);return b.i2()+b.i4()/2},g4:function(a){return new ef(this.g5(a),this.g6(a))},gi:function(a){return this.g1(a).i1()},gh:function(a){return this.g1(a).i2()},ga:function(a){var b=this.g1(a);return new ef(b.i1(),b.i2())},gj:function(a){return this.g1(a).i3()},g9:function(a){return this.g1(a).i4()},gm:function(a){return new ff(this.gj(a),this.g9(a))},s1:function(a,b){this.s2(a,b.x,b.y)},s2:function(a,b,c){var d=this.g1(a);d.i5(b-d.i3()/2,c-d.i4()/2)},s7:function(a,b,c){this.g1(a).i6(b,c)},s8:function(a,b){this.s7(a,b.width,b.height)},s3:function(a,b,c){this.g1(a).i5(b,c)},s4:function(a,b){this.s3(a,b.x,b.y)},gp:function(a){var b=this.g2(a),c=new Ce;for(var d=0;d<b.i1();d++)c.add(b.i2(d));return new kf(c)},gf:function(a){var b=this.g2(a),c=new Ff;for(var d=0;d<b.i1();d++)c.aa(b.i2(d));return c},gc:function(a){var b=new Ce;b.add(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.add(c.i6());return b.add(this.gl(a)),new kf(b)},gd:function(a){var b=new Ff;b.aa(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.aa(c.i6());return b.aa(this.gl(a)),b},m1:function(a,b){var c=this.g2(a);c.i5();var d=b.ah(),e=d.i6();this.gx(a,e);var f=b.as();d.i2();for(;d.i6()!==f;d.i2()){var g=d.i6();c.i4(g.x,g.y)}this.gy(a,f)},s5:function(a,b){var c=this.g2(a);c.i5();for(var d=b.d();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},s6:function(a,b){var c=this.g2(a);c.i5();for(var d=b.ah();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},m2:function(a,b,c){this.gx(a,b),this.gy(a,c)},gn:function(a){return this
.g2(a).i6()},gk:function(a){return this.g2(a).i7()},gt:function(a,b){this.g2(a).i8(b)},gz:function(a,b){this.g2(a).i9(b)},gs:function(a){var b=this.g2(a).i6();if(b==null)return this.g4(a.a2());var c=new ef(this.g5(a.a2())+b.x,this.g6(a.a2())+b.y);return c},gl:function(a){var b=this.g2(a).i7();if(b==null)return this.g4(a.a3());var c=new ef(this.g5(a.a3())+b.x,this.g6(a.a3())+b.y);return c},gx:function(a,b){var c=new ef(b.x-this.g5(a.a2()),b.y-this.g6(a.a2()));this.g2(a).i8(c)},gy:function(a,b){var c=new ef(b.x-this.g5(a.a3()),b.y-this.g6(a.a3()));this.g2(a).i9(c)},g8:function(){var a=new Gf;for(var b=this.xf();b.i1();b.i2())a.aa(b.i8());return a},g3:function(){var a,b=a=Number.MAX_VALUE,c,d=c=Number.MIN_VALUE;for(var e=this.x9();e.i1();e.i2()){var f=this.ga(e.i9()),g=this.gm(e.i9());b=Math.min(f.x,b),a=Math.min(f.y,a),d=Math.max(f.x+g.width,d),c=Math.max(f.y+g.height,c)}for(var h=this.xf();h.i1();h.i2())for(var i=this.gp(h.i8()).c();i.i1();i.i2()){var j=i.i6();b=Math.min(j.x,b),a=Math.min(j.y,a),d=Math.max(j.x,d),c=Math.max(j.y,c)}return{x:Math.floor(b),y:Math.floor(a),width:Math.floor(d-b),height:Math.floor(c-a)}}});var yg=function(){yg.superClass.constructor.call(this),this.a(new qf,new of)};d.ext(yg,xg,{a:function(a,b){this._a3=a,this._a4=b},xo:function(a,b){return this.l2(a,b,this._a4.a6())},l2:function(a,b,c){return this.l1(a,null,b,null,0,0,c)},xn:function(a,b,c,d,e,f){return this.l1(a,b,c,d,e,f,this._a4.a6())},l1:function(a,b,c,d,e,f,g){var h=new Nf(this,a,b,c,d,e,f);return h._l=g,h},xm:function(){var a=new Tf(this);return a._r=this._a3.m3(),a},g3:function(){var a={x:0,y:0,width:-1,height:-1};for(var b=this.x9();b.i1();b.i2())b.i9()._r.m1(a);return a},g1:function(a){return a._r},g2:function(a){return a._l},g5:function(a){return a._r.m4()},g6:function(a){return a._r.m5()},gi:function(a){return a._r.i1()},gh:function(a){return a._r.i2()},gj:function(a){return a._r.i3()},g9:function(a){return a._r.i4()},s2:function(a,b,c){a._r.m6(b,c)},s7:function(a,b,c){a._r.i6(b,c)},s3:function(a,b,c){a._r.i5(b,c)}});var zg=function(){zg.superClass.constructor.call(this),this._ap=this.xk(),this._as=this.xl()};d.ext(zg,xg,{g1:function(a){var b=this._ap.i1(a);return b==null&&(b=new Qf,this._ap.z1(a,b)),b},g2:function(a){var b=this._as.i1(a);return b==null&&(b=new Pf,this._as.i8(a,b)),b}});var Ag=function(a){Ag.superClass.constructor.call(this),this._ay=a,this._a0=this.xk(),this._au=this.xl()};d.ext(Ag,zg,{c2:function(a){var b=this._a0.i1(a);return b},a2:function(a,b){this._a0.z1(a,b)},h:function(){this._az==null&&(this._az=this.xk());var a=Vg.a(this._ay.x0()+1),b=1;for(var c=this.x9();c.i1();){var d=this.c2(c.i9());for(var e=d.x1();e.i1();e.i2()){var f=e.i9();a[f.al()]=b}var g=new Gf;for(var h=d.x1();h.i1();h.i2()){var i=h.i9(),j=a[i.al()];for(var k=i.ap();k.i1();k.i2()){var l=k.i8(),m=l.a3(),n=a[m.al()];n===j&&g.ac(l)}}this._az.z1(c.i9(),g),c.i2(),b++}},d1:function(a){return this._az.i1(a)},b:function(a){return this._au.i1(a)},a3:function(a,b){this._au.i8(a,b)},a1:function(){var a=this._ay.xk(),b=ag.a4(Vg.a(this._ay.xh())),c=rf.a1(this._ay,b,a),d=rf.a5(this._ay,b,c);this.d2(a,d),this._ay.xi(a)},c1:function(a){var b=null,c=-1;for(var d=0,e=a.length;d<e;d++){var f=a[d];f.ay()>c&&(b=f,c=f.ay())}return b},d2:function(a,b){var c=this._ay.xl(),d=this._ay.xk(),e=b.length;for(var f=0;f<e;f++){var g=b[f];for(var h=g.c1();h.i1();h.i2())c.i8(h.i8(),g)}var i=this.c1(b);this.a4(i,a,c,new Ce,d);var j={};e=b.length;for(var k=0;k<e;k++){var l=b[k];if(l.ay()>1){var m=this.xm();j[l._id]=m}}for(var n=this._ay.x9();n.i1();n.i2()){var o=n.i9();if(a.i4(o)&&d.i1(o)==null){var p=this.xm();j[o._id]=p;var q=new Yf;q.aa(o),this.a2(p,q)}}var r=Vg.d(2);e=b.length;for(var s=0;s<e;s++){var t=b[s];if(t.ay()===1){var u=t.c2();r[0]=u.a2(),r[1]=u.a3();for(var v=0;v<2;v++){var w=r[v];if(w.ad()===1){var x=this.xm();j[w._id]=x;var y=new Yf;y.aa(w),this.a2(x,y)}}}}for(var z=this._ay.x9();z.i1();z.i2()){var A=z.i9();if(d.i1(A)!=null){var B=d.i1(A),C=j[B._id];for(var D=A.af();D.i1();D.i2()){var E=D.i8();if(c.i1(E)!==B){var F=j[c.i1(E)._id];if(F==null){var G=E.a1(A),H=d.i1(G);H!=null?F=j[H._id]:F=j[G._id]}var I=C.aj(F),J=null;I==null?(I=this.xo(C,F),J=new Gf):J=this.b(I),J.aa(E),this.a3(I,J)}}}else if(a.i4(A)){var K=j[A._id];for(var L=A.af();L.i1();L.i2()){var M=L.i8(),N=M.a1(A),O=j[N._id];if(O!=null){var P=K.aj(O);if(P==null){var Q=this.xo(K,O),R=new Gf;R.aa(M),this.a3(Q,R)}}}}}if(this._ay.x0()===2&&this._ay.xg()===1){var S=this._ay.xf().i8(),T=j[S.a2()._id],U=j[S.a3()._id];if(U!=null&&T!=null&&U.aj(T)==null){var V=this.xo(T,U),W=new Gf;W.aa(S),this.a3(V,W)}}var X=Vg.a(this._ay.x0()),Y=1;e=b.length;for(var Z=0;Z<e;Z++){var $=b[Z],_=j[$._id];if(_!=null){var ab=this.c2(_);ab==null&&(ab=new Yf,this.a2(_,ab));for(var bb=$.c1();bb.i1();bb.i2()){var cb=bb.i8(),db=cb.a2();X[db.al()]!==Y&&(!a.i4(db)||d.i1(db)===$)&&(X[db.al()]=Y,ab.aa(db)),db=cb.a3(),X[db.al()]!==Y&&(!a.i4(db)||d.i1(db)===$)&&(X[db.al()]=Y,ab.aa(db))}}}this._ay.xj(c),this._ay.xi(d)},a4:function(a,b,c,d,e){if(d.contains(a))return;d.add(a);var f=[];for(var g=a.c1();g.i1();g.i2()){var h=g.i8();f[0]=h.a2(),f[1]=h.a3();for(var i=0;i<2;i++){var j=f[i];if(b.i4(j)&&e.i1(j)==null){a.ay()>1&&e.z1(j,a);for(var k=j.af();k.i1();k.i2()){var l=c.i1(k.i8());this.a4(l,b,c,d,e)}}}}}});var Bg=function(a,b,d,e,f){this._a={},Bg.superClass.constructor.call(this);var g=new Ce,h,i;for(h=0,i=b.size();h<i;h++){var j=b.get(h);if(j instanceof c.Link)g.add(j);else{var k=e&&f==null&&j instanceof _e;k&&j.setExpanded(!0);var l=a.getDimension(j);k&&j.setExpanded(!1);if(l==null)continue;var m=this.xm(),n=a._repulsion;d==="rightleft"||d==="leftright"?this.s7(m,l.height*n,l.width*n):this.s7(m,l.width*n,l.height*n),m.node=j,this._a[j.getId()]=m}}for(h=0,i=g.size();h<i;h++){var o=g.get(h),p=o.getFromAgent(),q=o.getToAgent(),r=this._a[p.getId()],s=this._a[q.getId()];if(r==null||s==null||r===s)continue;this.xo(r,s)}};d.ext(Bg,yg,{});var Cg={};Cg._D=new kf,Cg._E=new ef(0,0),Cg.b=function(a){if(a.i1()>0){var b=new Ce;for(var c=a.i1()-1;c>=0;c--)b.add(a.i2(c));a.i5();for(var d=0,e=b.size();d<e;d++){var f=b.get(d);a.i4(f.x,f.y)}}var g=a.i6();a.i8(a.i7()),a.i9(g)},Cg.c=function(a){Cg.d(a,!0)},Cg.d=function(a,b){if(b)for(var c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,Cg._E),a.gz(d,Cg._E),a.s5(d,Cg._D)}else for(var e=a.xf();e.i1();e.i2())a.s5(e.i8(),Cg._D)},Cg.e=function(a){var b=new ef(0,0);for(var c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,b),a.gz(d,b)}},Cg.f=function(a,b,c,d){var e=a.gc(b).b(),f=Vg.d(e),g=0;for(var h=a.gc(b).c();h.i1();h.i2()){var i=h.i6();if(g<=0||!i.equals(f[g-1]))f[g]=new ef(i.x,i.y),g++}e=g;if(e<2)return;var j=new Ce,k=new gf(f[1].x-f[0].x,f[1].y-f[0].y),l=Cg.i(k);l.x*=d,l.y*=d;var m=Cg.h(f[0],l),n=Cg.h(f[1],l),o=new jf(m,n);for(var p=1;p<e-1;p++){var q=o,r=Cg.i(new gf(f[p+1].x-f[p].x,f[p+1].y-f[p].y));r.x*=d,r.y*=d;var s=Cg.h(f[p],r),t=Cg.h(f[p+1],r);o=new jf(s,t);var u=jf.a6(q,o);u!=null&&j.add(new ef(u.x,u.y))}var v=new gf(f[e-1].x-f[e-2].x,f[e-1].y-f[e-2].y);v=Cg.i(v),v.x*=d,v.y*=d;var w=Cg.h(f[e-1],v),x=new kf(j);b.a2()===c.a2()?(a.s5(c,x),a.m2(c,m,w)):(a.s5(c,x.a()),a.m2(c,w,m))},Cg.g=function(a,b,c,d){var e=d;for(var f=c.c1();f.i1();f.i2()){var g=f.i8();Cg.f(a,b,g,e),e<0&&(e-=d),e=-e}},Cg.a=function(a,b,c){return Cg.j(a,b,c,1)},Cg.l=function(a,b,c){if(a==null||a.length<1)return b!=null&&(b.x=0,b.y=0,b.width=0,b.height=0),{width:0,height:0};var d=0,e=0;for(var f=0;f<a.length;f++){var g=a[f];d=Math.max(d,g.width),e=Math.max(e,g.height)}var h=d*e*a.length,i=Math.sqrt(h/c),j=h/i,k=Math.floor(j/d),l=Math.ceil(j/d),m=Math.ceil(a.length/k),n=Math.ceil(a.length/l),o,p;k*m<l*n?(o=k,p=m):(o=l,p=n);var q=0,r=0,s=0,t=0,u;if(d>e)for(var v=0;v<a.length;v++)u=a[v],u.x=r*d,u.y=q*e,s=Math.max(s,u.x+u.width),t=Math.max(t,u.y+u.height),++r>=o&&(q++,r=0);else for(var w=0;w<a.length;w++)u=a[w],u.x=r*d,u.y=q*e,s=Math.max(s,u.x+u.width),t=Math.max(t,u.y+u.height),++q>=p&&(r++,q=0);return b!=null&&(b.x=0,b.y=0,b.width=s,b.height=t),{width:p,height:o}},Cg.j=function(a,b,c,d){if(a==null||a.length<1)return b!=null&&(b.x=0,b.y=0,b.width=0,b.height=0),0;var e,f=e=a[0].width,g,h=g=a[0].height,i=a.length;for(var j=1;j<i;j++){var k=a[j].width;f=Math.min(f,k),e=Math.max(e,k);var l=a[j].height;h=Math.min(h,l),g=Math.max(g,l)}if(h/g>.95&&f/e>.95)return Cg.l(a,b,c).width;var m=new Ff,n=0;for(var o=0;o<i;o++){var p=a[o];m.aa(a[o]),n=Math.floor(n+p.width*p.height)}m.a1(function(a,b){var c=Math.floor(b.height)-Math.floor(a.height);return c===0?Math.floor(b.width)-Math.floor(a.width):c});var q=0,r=0,s=Math.floor(c*Math.sqrt(n/c)),t=s,u=0,v=new Ff;do{var w=new Ff;v.aa(w);var x,y,z=x=y=0;for(var A=m.ah();A.i1();A.i2()){var B=A.i6();z+B.width>t&&w.ay()>0?(y=Math.max(y,z),w=new Ff,w.aa(B),v.aa(w),z=Math.floor(B.width)):(w.aa(B),z=Math.floor(z+B.width)),w.ay()===1&&(x=Math.floor(x+w.am().height))}y=Math.max(y,z),c*x>y&&u!==y&&(v.af(),t=Math.floor(t*1.1),u=y)}while(v.ar());var C=0;for(var D=v.ah();D.i1();D.i2()){var E=0,F=D.i6();for(var G=F.ah();G.i1();G.i2()){var H=G.i6();H.x=E,H.y=C,E+=H.width}q=Math.max(q,E),C+=Cg.k(F),r=Math.max(r,C)}return b!=null&&(b.x=0,b.y=0,b.width=q,b.height=r),v.ay()},Cg.k=function(a){var b=0;for(var c=a.ah();c.i1();c.i2())b=Math.max(c.i6().height,b);return b},Cg.h=function(a,b){return new ef(a.x+b.x,a.y+b.y)},Cg.i=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);return new gf(-a.y/b,a.x/b)};var Dg=function(a){this._a=a,this._b=!1};d.ext(Dg,Object,{a:function(){return this._b},b:function(){return this._a},c:function(){return this._a===1},d:function(){return this._a===2},e:function(){return this._a===4},f:function(){return this._a===8},g:function(){return this._a===0}}),Dg.h=function(a,b){var c=a.xc("A");return c==null?null:c.i1(b)},Dg.i=function(a,b){var c=a.xc("B");return c==null?null:c.i1(b)},Dg.j=function(a){switch(a){case 1:return Dg.k;case 2:return Dg.l}return null},Dg.k=new Dg(1),Dg.l=new Dg(2);var Eg=function(a,b,c,d,e){this._o=0,this._l=0,this._i=0,this._d=0,this._f=0,this._b=a,this._a=1e-4,this._r=b,this._p=1,this._e=(e.gj(a)+e.g9(a))/4;var f=.45*c*Math.sqrt(d);this._k=ug.l(-f,f),this._h=ug.l(-f,f),this._g=ug.l(-f,f)};d.ext(Eg,Object,{});var Fg=function(){this._a=0,this._c=0,this._b=0};d.ext(Fg,Object,{});var Gg=function(){Gg.superClass.constructor.call(this),this._dj=0,this._dh=0,this._dq=0,this._dp=0,this._dt=0,this._de=0,this._d3=0,this._dr=0,this._ed=0,this._dw=.65,this._ea=1,this._dl=80,this._dx=3,this._d8=!0,this._eb=3e5,this._ee=2,this._di=2,this._df=1e3};d.ext(Gg,dg,{i4:function(a){return!0},i3:function(a){if(a==null)return;this._d5=a;if(!this.s(a))return;var b=new Fg,c=0,d=Math.floor(this._dx*this._dz.length*this._dz.length+20*this._dz.length);d=Math.max(d,1e4);var e=this._ea*this._ea*this._dz.length,f=this._df;try{for(;this._dj>e&&c<d;c++){var g=this.b(c&2147483647);f--===0&&(this._dy.b()>this._eb&&(c=d),f=this._df),this.h(g,b),this.d(g,b),this.i(g,b),this._d8?(this.g(g,b),this.j(g,b)):(this.f(g,b),this.c(g,b));var h=Math.sqrt(b._a*b._a+b._c*b._c+b._b*b._b);this.ac(g,b,h),this.aa(g,b,h)}}catch(i){}finally{this.r()}},s:function(a){if(a==null||a.xa()<1)return!1;this._d5=a,this._dp=1,this._dy=new tg,this._dt=a.x0(),this._d2=Vg.d(this._dt),this._df=1+1e5/this._dt,this._ed=1/(2*this._di),this._de=this._ed*this._ee/(this._dl*.05),this._d3=Math.pow(this._dl,-1)*this._ed,this._dr=Math.pow(this._dl,3)*this._ed,this._dj=0,this._du=new Fg,this._dq=Math.max(20*this._dl,10);var b=Math.max(.1,Math.min(this._dw*this._dl,this._dq)),c=this._dt;Cg.c(a),this._dz=Vg.d(c);for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=new Eg(e,b,this._dl,this._dt,a);this._dz[--c]=f,this._dj+=f._r,this._dh+=f._r*f._r,this._du._a+=f._k,this._du._c+=f._h,this._du._b+=f._g,this._d2[e.al()]=f}return this._d8=!1,this._dz.length>0},b:function(a){var b=this._dz.length,c=b-a%b-1,d=ug.k(c+1),e=this._dz[d];return this._dz[d]=this._dz[c],this._dz[c]=e,e},f:function(a,b){var c,d,e=c=d=0;for(var f=a._b.ae();f!=null;f=f.a7()){var g=this._d2[f.a2().al()],h=g._k-a._k,i=g._h-a._h,j=g._g-a._g,k=h*h+i*i+j*j,l,m=Math.sqrt(k),n=m-(g._e+a._e);if(n<=0)continue;l=n*n*this._d3/m,e+=h*l,c+=i*l,d+=j*l}for(var o=a._b.ag();o!=null;o=o.a8()){var p=this._d2[o.a3().al()],q=p._k-a._k,r=p._h-a._h,s=p._g-a._g,t=q*q+r*r+s*s,u,v=Math.sqrt(t),w=v-(p._e+a._e);if(w<=0)continue;u=w*w*this._d3/v,e+=q*u,c+=r*u,d+=s*u}b._a+=e,b._c+=c,b._b+=d},g:function(a,b){var c,d,e=c=d=0;this._dp++,a._f=this._dp;for(var f=a._b.ae();f!=null;f=f.a7()){var g=this._d2[f.a2().al()];g._f=this._dp;var h=g._k-a._k,i=g._h-a._h,j=g._g-a._g,k=h*h+i*i+j*j,l=Math.sqrt(k);if(l!==0){var m=Math.max(1e-6,l-(a._e+g._e)),n=-this._ef[f.a5()]/(m*m);n+=m*m*this._d1[f.a5()],n/=l,e+=h*n,c+=i*n,d+=j*n}}for(var o=a._b.ag();o!=null;o=o.a8()){var p=this._d2[o.a3().al()];p._f=this._dp;var q=p._k-a._k,r=p._h-a._h,s=p._g-a._g,t=q*q+r*r+s*s,u=Math.sqrt(t);if(u!==0){var v=Math.max(1e-6,u-(a._e+p._e)),w=-this._ef[o.a5()]/(v*v);w+=v*v*this._d1[o.a5()],w/=u,e+=q*w,c+=r*w,d+=s*w}}b._a+=e,b._c+=c,b._b+=d},j:function(a,b){var c,d,e=c=d=0;for(var f=this._dt-1;f>=0;f--){var g=this._d2[f];if(g._f!==a._f){var h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(k!==0){var l=Math.sqrt(k),m=Math.max(1e-6,l-(a._e+g._e)),n=this._dr/(m*m*l);e+=h*n,c+=i*n,d+=j*n}}}b._a+=e,b._c+=c,b._b+=d},c:function(a,b){var c,d,e=c=d=0;for(var f=this._dt-1;f>=0;f--){var g=this._d2[f],h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(k!==0){var l=Math.sqrt(k),m,n=l-(a._e+g._e);n<=0?m=this._dr/(1e-8*l):m=this._dr/(n*n*l),e+=h*m,c+=i*m,d+=j*m}}b._a+=e,b._c+=c,b._b+=d},i:function(a,b){var c=this._du._b/this._dt-a._g;b._b+=c*this._dl*this._dt/this._dh},d:function(a,b){if(this._de!==0){var c=this._du._a/this._dt-a._k,d=this._du._c/this._dt-a._h,e=this._du._b/this._dt-a._g;b._a+=c*this._de,b._c+=d*this._de,b._b+=e*this._de}},h:function(a,b){var c=.05*(a._r+2);c>0&&(b._a=ug.l(-c,c),b._c=ug.l(-c,c),b._b=ug.l(-c,c))},ac:function(a,b,c){if(c!==0&&a._a!==0){var d=b._a*a._o+b._c*a._l+b._b*a._i,e=d/(c*a._a);this._dh-=a._r*a._r,this._dj-=a._r,a._p*e>0?a._r+=e*.45:a._r+=e*.15,a._r>this._dq?a._r=this._dq:a._r<.1&&(a._r=.1),this._dj+=a._r,this._dh+=a._r*a._r,a._p=e}},aa:function(a,b,c){if(c>0){var d=a._r/c,e=b._a*d,f=b._c*d,g=b._b*d;a._k+=e,a._h+=f,a._g+=g,this._du._a+=e,this._du._c+=f,this._du._b+=g,a._a=c,a._o=b._a,a._l=b._c,a._i=b._b}},r:function(){for(var a=this._d2.length-1;a>=0;a--){var b=this._d2[a];this._d5.s2(b._b,b._k,b._h)}}});var Hg=function(a,b,c,d){this._e=a,this._f=b,this._a=c,this._b=d,this._c={}};d.ext(Hg,Object,{resetGroup:function(){if(!this._a||this._b!=null)return;for(var a in this._c){var b=this._c[a];this._e.isExpandGroup()?b.group.setExpanded(!0):b.group.setExpanded(b.b)}},process:function(){var a=new Ce;for(var b=0,d=this._f.size();b<d;b++){var e=this._f.get(b);if(e instanceof c.Link)e.isLooped()||a.add(e);else{if(this._b==null&&e.getParent()instanceof _e)continue;(this._b==null||this._b!=null&&this._b!==e)&&a.add(e),this._b==null&&e instanceof _e&&this.layoutGroup(e)}}return a},layoutGroup:function(a){if(!this._a||this._c[a.getId()]!=null||this._b!=null)return;this._c[a.getId()]={group:a,b:a.isExpanded()};var b=this._e.getGroupLayoutType(a);if(!b)return;a.setExpanded(!0);var d=new Ce,e=a.getChildren(),f;for(var g=0,h=e.size();g<h;g++){f=e.get(g),f instanceof _e&&(this.layoutGroup(f),f.setExpanded(!1)),!(f instanceof c.Link)&&!d.contains(f)&&d.add(f);if(f instanceof Ze){var i=f.getLinks();if(i!=null)for(var j=0,k=i.size();j<k;j++){var l=i.get(j);d.contains(l)||d.add(l)}}}var m=new Bg(this._e,d,b,this._a,this._b);try{var n=null;if("round"===b)n=new sg;else if("symmetry"===b)n=new Gg;else if("hierarchic"===b)n=new Qg;else if(b==="topbottom"||b==="bottomtop"||b==="rightleft"||b==="leftright")n=new eg;if(n!=null){n.i2(m);var o=Hg.createMatrix(b),p={},q={};for(var r in m._a){var s=m._a[r],t=s.node,u=m.g4(s);p[r]=t.getCenterLocation();if(o!=null){var v=o.transform(u);t.setCenterLocation(v.x,v.y)}else t.setCenterLocation(u.x,u.y);q[r]=t.getCenterLocation()}}}catch(w){}e=a.getChildren();for(g=0,h=e.size();g<h;g++)f=e.get(g),f instanceof _e&&f.setExpanded(!0)}}),Hg.createMatrix=function(a){return a==="rightleft"?p.createMatrix(Math.PI/2,0,0):a==="leftright"?p.createMatrix(-Math.PI/2,0,0):a==="bottomtop"?p.createMatrix(Math.PI,0,0):null};var Ig=function(){};d.ext(Ig,Object,{i1:function(a,b,c){var d=this.a1(a,b);return this.a2(a,b,c),d},a1:function(a,b){var c=Ig.i4(a);c.ax();var d=0;for(var e=c.x1();e.i1();e.i2())b.i7(e.i9(),-1);for(var f=c.x1();f.i1();f.i2()){var g=f.i9(),h=-1;for(var i=g.aq();i.i1();i.i2())h=Math.max(h,b.i2(i.i9()));b.i7(g,h+1),d=Math.max(d,h+1)}return d+1},a2:function(a,b,c){c.az(Ig.i3(a,b))}}),Ig.i3=function(a,b){var c=new Gf;for(var d=a.xf();d.i1();d.i2()){var e=d.i8();b.i2(e.a2())>b.i2(e.a3())&&(a.x3(e),c.ac(e))}return c},Ig.i4=function(a){var b=Vg.a(a.xa());return(new xf).a1(a,b),Ig.i2(a,b)},Ig.i2=function(a,b){var c=Vg.d(a.x0());for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();c[b[f]]=e}return new Yf(c)};var Jg=function(){Jg.superClass.constructor.call(this),this.c0()};d.ext(Jg,Gf,{c0:function(){this._bc=1,this._bd=0}});var Kg=function(){this._m1=20,this._m2=60,this._m3=5,this._m4=0};d.ext(Kg,Object,{i4:function(a){this._m3=a},i5:function(a){this._m4=a},i3:function(a){this._m1=a},i6:function(a){this._m2=a},i2:function(a){this._m5=a},t1:function(){return this._m2},a1:function(a,b){var c=Vg.d(b.length);for(var d=0;d<b.length;d++)c[d]=b[d].x1();this.a2(a,c)},a2:function(a,b){var c=Vg.a(b.length),d=0;for(var e=0;e<b.length;e++){var f=0,g=b[e];g.i4();for(;g.i1();g.i2())f=Math.max(f,a.g9(g.i9()));c[e]=f,g.i4();for(;g.i1();g.i2()){var h=(c[e]-a.g9(g.i9()))/2;a.s4(g.i9(),new ef(a.gi(g.i9()),d+h))}var i=this.t1();d+=c[e]+i,g.i4()}},i1:function(a,b,c){this._m6=a,this.t2(b,c)}});var Lg=function(a,b){Lg.superClass.constructor.call(this)};d.ext(Lg,Kg,{t2:function(a,b){var c=this._m6;this._a=c.xc("D"),this._h=c.xc("C"),this.a1(c,a),this.tg(c,a),this.tf(a,ag.a5(this._e),this._m5,this._l),this.tb(c,this._f[0]),this.ta(a),this.th(c,this._f[0],a),this.b(a),this.tb(c,this._f[1]),this.ta(a),this.th(c,this._f[1],a),this.b(a),this.a11(this._f[1]),this.a12(a),this.tb(c,this._f[2]),this.ta(a),this.th(c,this._f[2],a),this.b(a),this.tb(c,this._f[3]),this.ta(a),this.th(c,this._f[3],a),this.b(a),this.a11(this._f[3]),this.a12(a),this.tc(c),this.tj()},a11:function(a){for(var b=0;b<a.length;b++)a[b]=-a[b]},b:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.ax()}for(var d=0;d<a.length;d++){var e=0,f=null;for(var g=a[d].x1();g.i1();g.i2()){var h=g.i9(),i=h.al();this._l[i]=e++,this._b[i]=f,this._k[i]=null,f!=null&&(this._k[f.al()]=h),f=h}}var j=this._a;this._a=this._h,this._h=j;for(var k=this._m6.xf();k.i1();k.i2()){var l=k.i8(),m=this._m6.gn(l);this._m6.gt(l,new ef(-m.x,m.y));var n=this._m6.gk(l);this._m6.gz(l,new ef(-n.x,n.y))}var o=this._l,p=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:o[a.a2().al()]-o[b.a2().al()]},q=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:o[a.a3().al()]};this._m6.x2(p,q)},a12:function(a){for(var b=this._m6.xf();b.i1();b.i2()){var c=b.i8();this._m6.x3(c);var d=this._m6.gn(c),e=this._m6.gk(c);this._m6.gz(c,d),this._m6.gt(c,e)}var f=new Ff;for(var g=0;g<a.length;g++)f.ae(a[g]);for(var h=0;h<a.length;h++)a[h]=f.au();var i=this._l,j=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:i[a.a2().al()]-i[b.a2().al()]},k=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:i[a.a3().al()]};this._m6.x2(j,k)},tg:function(a,b){var c=a.x0(),d=a.xg();this._l=Vg.a(c),this._b=Vg.d(c),this._k=Vg.d(c),this._m=Vg.d(c),this._i=Vg.d(c),this._o=Vg.d(c),this._f=Vg.e(4,c),this._c=Vg.a(c),this._g=Vg.a(c),this._j=Vg.a(c),this._d=Vg.b(c),this._e=Vg.b(d);for(var e=0;e<b.length;e++){var f=0,g=null;for(var h=b[e].x1();h.i1();h.i2()){var i=h.i9(),j=i.al();this._l[j]=f++,this._b[j]=g,this._k[j]=null,g!=null&&(this._k[g.al()]=i),g=i}}var k=this._l,l=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:k[a.a2().al()]-k[b.a2().al()]},m=function(a,b){return a==null&&b!=null?1:a!=null&&b==null?-1:a==null&&b==null?0:k[a.a3().al()]};a.x2(l,m)},tb:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=d.al();this._m[e]=d,this._i[e]=d,b[e]=Number.MAX_VALUE,this._o[e]=d,this._c[e]=Number.MAX_VALUE,this._d[e]=!1,this._j[e]=this._g[e]=0}},ta:function(a){for(var b=1;b<a.length;b++){var c=-1;for(var d=a[b]._b;d!=null;d=d.a()){var e=d.d(),f=e.al(),g=e.ak();if(g!==0){var h=Math.floor((g+1)/2),i=Math.ceil((g+1)/2),j=1,k;for(k=e.ae();j<h;k=k.a7())j++;for(var l=!1;j<=i&&!l;j++){var m=this._m6.g2(k),n=k.a2(),o=n.al();this._i[f]===e&&!this._e[k.a5()]&&c<this._l[o]&&(c=this._l[o],this._i[o]=e,this._m[f]=this._m[o],this._i[f]=this._m[f],l=!0,this._j[o]=m.i6().x,this._g[f]=m.i7().x),k=k.a7()}}}}},th:function(a,b,c){for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();this._m[f]===e&&this.td(a,e,b)}for(var g=0;g<c.length;g++){var h=c[g].x1();if(h.i1()){var i=c[g].x1().i9(),j=i.al();this._o[this._m[j].al()]===i&&this.tk(a,i,b)}}for(var k=a.x9();k.i1();k.i2()){var l=k.i9(),m=l.al(),n=this._c[this._o[this._m[m].al()].al()];n<Number.MAX_VALUE&&(b[m]+=n)}},td:function(a,b,c){var d=b.al();if(c[d]===Number.MAX_VALUE){c[d]=0;var e=b,f=0;do{var g=e.al();g!==d&&(f-=this._g[g]);if(this._l[g]>0){var h=this._b[g],i=this._m[this._b[g].al()],j=i.al();this.td(a,i,c),this._o[d]===b&&(this._o[d]=this._o[j]),this._o[d]===this._o[j]&&(c[d]=Math.max(c[d],c[h.al()]+this.ti(a,h,e)-f))}f+=this._j[g],e=this._i[g]}while(e!==b);f=0,e=b;do{var k=e.al();k!==d&&(f-=this._g[k]),c[k]=c[d]+f,f+=this._j[k],e=this._i[k]}while(e!==b)}},tk:function(a,b,c){var d=b.al();if(this._d[d])return;this._d[d]=!0;var e=b;do{var f=e.al(),g=this._k[f];if(g!=null){var h=g.al(),i=this._o[this._m[h].al()];if(i!==this._o[d]){var j=c[h]-c[d]-this.ti(a,e,g);this._c[i.al()]!==Number.MAX_VALUE&&(j+=this._c[i.al()]),this._c[this._o[d].al()]=Math.min(this._c[this._o[d].al()],j)}else this.tk(a,this._m[h],c)}e=this._i[f]}while(e!==b)},tc:function(a){var b=Vg.a(4),c=Vg.a(4);for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();c[0]+=this._f[0][f],c[1]+=this._f[1][f],c[2]+=this._f[2][f],c[3]+=this._f[3][f]}c[0]/=a.xa(),c[1]/=a.xa(),c[2]/=a.xa(),c[3]/=a.xa();for(var g=a.x9();g.i1();g.i2()){var h=g.i9(),i=h.al(),j=a.g4(h);b[0]=this._f[0][i]-c[0],b[1]=this._f[1][i]-c[1],b[2]=this._f[2][i]-c[2],b[3]=this._f[3][i]-c[3],b.sort(Vg.n);var k=(b[1]+b[2])/2;a.s1(h,new ef(k,j.y))}},ti:function(a,b,c){var d=a.gj(b),e=a.gj(c),f;return d>1&&e>1?f=this._m1+(d+e)/2:f=this._m3+(d+e)/2,this._l[b.al()]<this._l[c.al()]?(this._a!=null&&(f+=this._a.i3(c)),this._h!=null&&(f+=this._h.i3(b))):(this._a!=null&&(f+=this._a.i3(b)),this._h!=null&&(f+=this._h.i3(c))),f},tj:function(){this._l=null,this._b=null,this._k=null,this._e=null,this._m=null,this._i=null,this._f=null,this._c=null,this._o=null,this._d=null,this._j=null,this._g=null},tf:function(a,b,c,d){var e=a.length;for(var f=2;f<e-1;f++){var g=-1,h=0,i=0,j=a[f].x1();for(var k=a[f].x1();k.i1();k.i2()){var l=k.i9(),m=null,n=!1;l.ak()===1&&(m=l.ae().a2(),c.i1(m)!=null&&c.i1(l)!=null&&(n=!0));if(i===a[f].ay()-1||n){var o=n?d[m.al()]:a[f-1].ay();for(;h<=i;h++){var p=j.i9();for(var q=p.am();q.i1();q.i2()){var r=q.i8(),s=d[r.a2().al()];(s<g||s>o)&&b.i7(q.i8(),!0)}j.i2()}g=o}i++}}}});var Mg=function(a,b){this._b=20,this._a=b,this._d=a,this._f={}};d.ext(Mg,Object,{a3:function(a){this._b=a},a4:function(a,b,c,d,e){if(this.a2(a)){var f=this.b2(a);f._o=b,f._m=e,f._n=d,f._f=c}},b2:function(a){var b=this._f[a._id];return b==null&&(b=new Ng,this._f[a._id]=b),b},a2:function(a){return this._f[a._id]!=null},c:function(){var a=ag.a1(Vg.a(this._d.xa())),b=ag.a1(Vg.a(this._d.xa()));for(var c=this._d.x9();c.i1();c.i2()){var d=c.i9();if(this.a2(d)){var e=this.b2(d);a.i6(d,this._b*(e.c()-1)),b.i6(d,this._b*(e.b()-1))}}this._d.x1("D",a),this._d.x1("C",b)},g:function(){this._d.x6("D"),this._d.x6("C")},f:function(){for(var a=this._d.x9();a.i1();a.i2()){var b=a.i9();if(this.a2(b)){var c=this._d.gi(b),d=this._d.gh(b),e=this._d.gj(b),f=this._d.g9(b),g=this.b2(b),h=g._q.ay()+g._b.ay()+g._f,i=g._d.ay()+g._g.ay()+g._o,j=g._i.ay()+g._l.ay()+g._n,k=g._h.ay()+g._k.ay()+g._m,l=this._a.a7(e,h),m=this._a.a7(e,i),n=this._a.a7(f,k),o=this._a.a7(f,j);g.a2(this._a.a8(e,h,l),this._a.a8(e,i,m),this._a.a8(f,k,n),this._a.a8(f,j,o));for(var p=g._j.c1();p.i1();p.i2()){var q=p.i8(),r=this.a1(q),s=this.b1(q),t=new Ff;if(r.b()===s.b())r.c()?(t.aa(new ef(c+g._g._bd*m+g._c,d)),t.aa(new ef(c+g._g._bd*m+g._c,d-this._b)),g._g._bd++,t.aa(new ef(c+g._g._bd*m+g._c,d-this._b)),t.aa(new ef(c+g._g._bd*m+g._c,d)),g._g._bd++,g._g._bc=Math.max(g._g._bc,2)):r.d()?(t.aa(new ef(c+g._b._bd*l+g._p,d+f)),t.aa(new ef(c+g._b._bd*l+g._p,d+f+this._b)),g._b._bd++,t.aa(new ef(c+g._b._bd*l+g._p,d+f+this._b)),t.aa(new ef(c+g._b._bd*l+g._p,d+f)),g._b._bd++,g._b._bc=Math.max(g._b._bc,2)):r.f()?(t.aa(new ef(c,d+g._i._bd*o+g._a)),t.aa(new ef(c-this._b,d+g._i._bd*o+g._a)),g._i._bd++,t.aa(new ef(c-this._b,d+g._i._bd*o+g._a)),t.aa(new ef(c,d+g._i._bd*o+g._a)),g._i._bd++,g._i._bc=Math.max(g._i._bc,2)):r.e()&&(t.aa(new ef(c+e,d+g._h._bd*n+g._e)),t.aa(new ef(c+e+this._b,d+g._h._bd*n+g._e)),g._h._bd++,t.aa(new ef(c+e+this._b,d+g._h._bd*n+g._e)),t.aa(new ef(c+e,d+g._h._bd*n+g._e)),g._h._bd++,g._h._bc=Math.max(g._h._bc,2)),this._d.m1(q,t);else if(r.c()||s.c()){if(r.e()||s.e())t.aa(new ef(c+e-g._d._bd*m-g._c,d)),t.aa(new ef(c+e-g._d._bd*m-g._c,d-this._b*g._d._bc)),t.aa(new ef(c+e+this._b*g._h._bc,d-this._b*g._d._bc)),t.aa(new ef(c+e+this._b*g._h._bc,d+g._h._bd*n+g._e)),t.aa(new ef(c+e,d+g._h._bd*n+g._e)),g._d._bd++,g._d._bc++,g._h._bd++,g._h._bc++,s.c()&&t.ax(),this._d.m1(q,t);else if(r.f()||s.f())t.aa(new ef(c+g._g._bd*m+g._c,d)),t.aa(new ef(c+g._g._bd*m+g._c,d-this._b*g._g._bc)),t.aa(new ef(c-this._b*g._i._bc,d-this._b*g._g._bc)),t.aa(new ef(c-this._b*g._i._bc,d+g._i._bd*o+g._a)),t.aa(new ef(c,d+g._i._bd*o+g._a)),g._g._bd++,g._g._bc++,g._i._bd++,g._i._bc++,s.c()&&t.ax(),this._d.m1(q,t);else if(r.d()||s.d())t.aa(new ef(c+e-g._d._bd*m-g._c,d)),t.aa(new ef(c+e-g._d._bd*m-g._c,d-this._b*g._d._bc)),t.aa(new ef(c+e+this._b*g.b(),d-this._b*g._d._bc)),t.aa(new ef(c+e+this._b*g.b(),d+f+this._b*g._q._bc)),t.aa(new ef(c+e-g._q._bd*l-g._p,d+f+this._b*g._q._bc)),t.aa(new ef(c+e-g._q._bd*l-g._p,d+f)),g._d._bd++,g._d._bc++,g._k._bc++,g._h._bc++,g._q._bc++,g._q._bd++,s.c()&&t.ax(),this._d.m1(q,t)}else if(r.d()||s.d()){if(r.e()||s.e())t.aa(new ef(c+e-g._q._bd*l-g._p,d+f)),t.aa(new ef(c+e-g._q._bd*l-g._p,d+f+this._b*g._q._bc)),t.aa(new ef(c+e+this._b*g._k._bc,d+f+this._b*g._q._bc)),t.aa(new ef(c+e+this._b*g._k._bc,d+f-g._k._bd*n-g._e)),t.aa(new ef(c+e,d+f-g._k._bd*n-g._e)),g._q._bd++,g._q._bc++,g._k._bd++,g._k._bc++,s.d()&&t.ax(),this._d.m1(q,t);else if(r.f()||s.f())t.aa(new ef(c+g._b._bd*l+g._p,d+f)),t.aa(new ef(c+g._b._bd*l+g._p,d+f+this._b*g._b._bc)),t.aa(new ef(c-this._b*g._l._bc,d+f+this._b*g._b._bc)),t.aa(new ef(c-this._b*g._l._bc,d+f-g._l._bd*o-g._a)),t.aa(new ef(c,d+f-g._l._bd*o-g._a)),g._b._bd++,g._b._bc++,g._l._bd++,g._l._bc++,s.d()&&t.ax(),this._d.m1(q,t)}else t.aa(new ef(c,d+f-g._l._bd*o-g._a)),t.aa(new ef(c-this._b*g._l._bc,d+f-g._l._bd*o-g._a)),t.aa(new ef(c-this._b*g._l._bc,d+f+this._b*g.a1())),t.aa(new ef(c+e+this._b*g._k._bc,d+f+this._b*g.a1())),t.aa(new ef(c+e+this._b*g._k._bc,d+f-g._k._bd*n-g._e)),t.aa(new ef(c+e,d+f-g._k._bd*n-g._e)),g._l._bd++,g._l._bc++,g._b._bc++,g._q._bc++,g._k._bc++,g._k._bd++,s.f()&&t.ax(),this._d.m1(q,t)}}}},a5:function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=b[c];for(var f=d.x1();f.i1();f.i2()){var g=f.i9();if(this.a2(g)){var h=this.b2(g);e._g=Math.max(e._g,this._b*(h.d()-1)),e._j=Math.max(e._j,this._b*(h.a1()-1))}}}},a1:function(a){var b=this._d.xc("A"),c=null;b!=null&&(c=b.i1(a));if(c==null||c.g()){var d=this._d.xc("B");if(d==null)return Dg.j(1);var e=d.i1(a);if(e==null||e.g())return Dg.j(1);if(e.c())return Dg.j(8);if(e.f())return Dg.j(1);if(e.d())return Dg.j(4);if(e.e())return Dg.j(2)}return c},b1:function(a){var b=this._d.xc("B"),c=null;b!=null&&(c=b.i1(a));if(c==null||c.g()){var d=this._d.xc("A");if(d==null)return Dg.j(8);var e=d.i1(a);if(e==null||e.g())return Dg.j(8);if(e.c())return Dg.j(8);if(e.f())return Dg.j(1);if(e.d())return Dg.j(4);if(e.e())return Dg.j(2)}return c}});var Ng=function(){this._o=0,this._f=0,this._n=0,this._m=0,this._c=0,this._p=0,this._e=0,this._a=0,this._j=new Gf,this._g=new Jg,this._d=new Jg,this._b=new Jg,this._q=new Jg,this._h=new Jg,this._k=new Jg,this._i=new Jg,this._l=new Jg};d.ext(Ng,Object,{a1:function(){return Math.max(this._q._bc,this._b._bc)},d:function(){return Math.max(this._d._bc,this._g._bc)},b:function(){return Math.max(this._k._bc,this._h._bc)},c:function(){return Math.max(this._l._bc,this._i._bc)},a2:function(a,b,c,d){this._c=b,this._a=d,this._p=a,this._e=c,this._g.c0(),this._d.c0(),this._b.c0(),this._q.c0(),this._k.c0(),this._h.c0(),this._l.c0(),this._i.c0()}});var Og=function(a,b,c,d){this._k=20,this._r=.5,this._d=a,this._c=b,this._j=c,this._m=d,this._i=a.xc("A")!=null||a.xc("B")!=null,this._t=new Rg(a,b,c,d),this._b=new Mg(a,this)};d.ext(Og,Object,{a6:function(a){this._k=a,this._t.a1(a),this._b.a3(a)},g1:function(){return this._k},a9:function(a){return this.c1(),a},a5:function(a){return this.a1(),a},b3:function(a){return this.c1(),a=this.c4(a),this._b.c(),a},g2:function(a){return this._b.g(),a},e2:function(a){a=this.f(a),this._b.f()},e1:function(){this._t.d(),this._n!=null&&this._d.xi(this._n),this.a1(),this._d=null},a1:function(){if(!this._i)return;this._q!=null&&(this._d.x1("A",this._q),this._q=null),this._p!=null&&(this._d.x1("B",this._p),this._p=null),this._h!=null&&(this._d.xj(this._h),this._h=null),this._l!=null&&(this._d.xj(this._l),this._l=null)},c1:function(){if(!this._i)return;this._h==null&&(this._h=this._d.xl()),this._l==null&&(this._l=this._d.xl());for(var a=this._d.xf();a.i1();a.i2()){var b=a.i8(),c=this._j.i1(b.a2())!=null,d=this._j.i1(b.a3())!=null;if(c&&!d){var e=this._j.i1(b.a2());this._m.i4(e)?this._l.i8(b,Dg.h(this._d,e)):this._l.i8(b,Dg.i(this._d,e))}else if(!c&&d){var f=this._j.i1(b.a3());this._m.i4(f)?this._h.i8(b,Dg.i(this._d,f)):this._h.i8(b,Dg.h(this._d,f))}else!c&&!d&&(this._m.i4(b)?(this._h.i8(b,Dg.i(this._d,b)),this._l.i8(b,Dg.h(this._d,b))):(this._h.i8(b,Dg.h(this._d,b)),this._l.i8(b,Dg.i(this._d,b))))}this._q=this._d.xc("A"),this._p=this._d.xc("B"),this._d.x1("A",this._h),this._d.x1("B",this._l)},c4:function(a){this._n=this._d.xk(),this._a=this._d.xl(),this._g=this._d.xl();var b=new Gf,c=new Gf,d=new Gf,e=new Gf,f=new Gf,g=new Gf,h=new Gf,i=new Gf,j=new Gf,k=this._d.xk();for(var l=0;l<a.length;l++){var m=0;for(var n=a[l].x1();n.i1();)k.i6(n.i9(),m),n.i2(),m++}var o=function(a,b){var c=k.i3(a.a3())-k.i3(b.a3());return c<=0?c>=0?0:-1:1},p=function(a,b){var c=k.i3(a.a2())-k.i3(b.a2());return c<=0?c>=0?0:-1:1};for(var q=0;q<a.length;q++){var r=a[q];for(var s=r._b;s!=null;s=s.a()){var t=s.d();t.av(o),t.au(p);var u=0;b.af(),c.af(),d.af(),e.af(),f.af(),g.af(),h.af(),i.af(),j.af();for(var v=t.ap();v.i1();){var w=v.i8(),x=this.b1(w);x==null||x.d()||x.g()?d.aa(w):x.e()?b.aa(w):x.f()?(c.aa(w),j.aa(w)):x.c()&&(i.aa(w),j.aa(w)),v.i2(),u++}u=0;for(var y=t.am();y.i1();){var z=y.i8(),A=this.a2(z);A==null||A.c()||A.g()?e.aa(z):A.e()?b.aa(z):A.f()?(c.aa(z),j.aa(z)):A.d()&&(g.aa(z),j.aa(z)),y.i2(),u++}var B=k.i3(t);if(!j.ar()){var C=.1/j.ay();for(var D=B-.4;!j.ar();D+=C){var E=j.c3();if(E.a2()===t){var F=this._d.xm();this._n.z1(F,E.a2()),this._d.s7(F,1,1),this._c.z1(F,this._c.i1(t)),k.i6(F,D),this._a.i8(E,this._d.gn(E)),this._d.gt(E,ug._A),this._d.xr(E,F,E.a3()),r.ao(F,s)}else{var G=this._d.xm();this._n.z1(G,E.a3()),this._d.s7(G,1,1),this._c.z1(G,this._c.i1(t)),k.i6(G,D),this._g.i8(E,this._d.gk(E)),this._d.gz(E,ug._A),this._d.xr(E,E.a2(),G),r.ao(G,s)}}}if(!b.ar()){var H=.1/b.ay();for(var I=B+.1;!b.ar();I+=H){var J=b.c3();if(J.a2()===t){var K=this._d.xm();this._n.z1(K,J.a2()),this._d.s7(K,1,1),this._c.z1(K,this._c.i1(t)),k.i6(K,I),this._a.i8(J,this._d.gn(J)),this._d.gt(J,ug._A),this._d.xr(J,K,J.a3()),s=r.an(K,s)}else{var L=this._d.xm();this._n.z1(L,J.a3()),this._d.s7(L,1,1),this._c.z1(L,this._c.i1(t)),k.i6(L,I),this._g.i8(J,this._d.gk(J)),this._d.gz(J,ug._A),this._d.xr(J,J.a2(),L),s=r.an(L,s)}}}var M=Og._z;this._b.a2(t)&&(M=this._b.b2(t));var N=M._b.ay()+g.ay()+t.ao()+f.ay()+M._q.ay();if(N>0){var O=this._d.g9(t)/2,P=this._d.gj(t),Q=this.a7(P,N),R=-0.5*P+this.a8(this._d.gj(t),N,Q)+Q*(M._b.ay()+g.ay());for(var S=t.ap();S.i1();S.i2()){var T=S.i8();!this.c2(T)&&this._j.i1(T.a2())==null&&(this._d.g2(T).i8(new ef(R,O)),R+=Q)}}var U=this._t.a3(t),V=0,W=0,X=0,Y=0;U!=null&&(V=U._e.ay(),W=U._c.ay(),X=U._b.ay(),Y=U._d.ay()),N=M._g.ay()+V+i.ay()+t.ak()+h.ay()+W+M._d.ay();if(N>0){var Z=this._d.gj(t),$=this.a7(Z,N),_=this.a8(Z,N,$),ab=-0.5*Z+_+$*(M._g.ay()+V+i.ay()),bb=-this._d.g9(t)/2;for(var cb=t.am();cb.i1();cb.i2()){var db=cb.i8(
);!this.d1(db)&&this._j.i1(db.a3())==null&&(this._d.g2(db).i9(new ef(ab,bb)),ab+=$)}if(U!=null){var eb=-0.5*Z+_+$*(M._g.ay()+i.ay()+U._e.ay()-1);for(var fb=U._e.c1();fb.i1();fb.i2()){var gb=fb.i8();this._d.u1(gb),gb.a2()===t&&!this.c2(gb)?(this._d.g2(fb.i8()).i8(new ef(eb,bb)),eb-=$):this.d1(gb)||(this._d.g2(fb.i8()).i9(new ef(eb,bb)),eb-=$),this._d.h1(gb)}eb=.5*Z-_-$*(M._d.ay()+h.ay());for(var hb=U._c.c1();hb.i1();hb.i2()){var ib=hb.i8();this._d.u1(ib),ib.a2()===t&&!this.c2(ib)?(this._d.g2(hb.i8()).i8(new ef(eb,bb)),eb-=$):this.d1(ib)||(this._d.g2(hb.i8()).i9(new ef(eb,bb)),eb-=$),this._d.h1(ib)}}}this._b.a2(t)&&this._b.a4(t,V+i.ay()+t.ak()+h.ay()+W,g.ay()+t.ao()+f.ay(),X+c.ay(),Y+b.ay())}}return this._d.xi(k),a},a7:function(a,b){return b<=1?0:a/(b-1+2*this._r)},a8:function(a,b,c){return b<=1?a*.5:(a-c*(b-1))*.5},f:function(a){var b=this.g1();this._f=this._d.xk();for(var c=0;c<a.length;c++){var d=a[c];for(var e=d._b;e!=null;){var f=e.d(),g=this._n.i1(f);if(g!=null||this._t.b2(f))e=e.a();else{var h=new Yf,i=new Yf,j=new Yf,k=new Yf,l=new Yf,m=new Yf,n=new Gf,o=new Gf,p=new Ug(h,i,j,k,l,m,n,o);this._f.z1(f,p),n.ab(f.am()),o.ab(f.ap());for(var q=e.b();q!=null&&this._n.i1(q.d())===f;q=q.b()){var r=q.d(),s=this.c3(r);s.f()?i.ac(r):s.c()?k.ac(r):s.d()&&m.ac(r)}var t;for(t=e.a();t!=null&&this._n.i1(t.d())===f;t=t.a()){var u=t.d(),v=this.c3(u);v.e()?h.aa(u):v.c()?j.aa(u):v.d()&&l.aa(u)}e=t}}}var w=this.d2(a),x=0;for(var y=0;y<a.length;y++){var z=w[y];y>0&&(x+=w[y-1]._j+w[y-1]._h+w[y-1]._b),x+=z._g+z._f+z._a+z._d;for(var A=a[y].x1();A.i1();A.i2()){var B=A.i9();this._d.s3(B,this._d.gi(B),this._d.gh(B)+x)}z._c+=x,z._i+=x}for(var C=0;C<a.length;C++){var D=a[C];for(var E=D.x1();E.i1();E.i2()){var F=E.i9();this._n.i1(F)!=null&&D.av(E)}}var G=this,H=function(a,b){return G.a3(a)?G.a3(b)?G._d.gi(a)>=G._d.gi(b)?-1:1:1:G.a3(b)?-1:G._d.gi(a)>=G._d.gi(b)?1:-1},I=function(a,b){return G.a3(a)?G.a3(b)?G._d.gi(a)>=G._d.gi(b)?1:-1:1:G.a3(b)?-1:G._d.gi(a)>=G._d.gi(b)?-1:1};for(var J=0;J<a.length;J++){var K=w[J];for(var L=a[J].x1();L.i1();L.i2()){var M=L.i9();if(!this._t.b2(M)){var N=this._f.i1(M),O=N._d,P=N._a,Q=N._b,R=N._h,S=N._f,T=N._c,U=N._g,V=N._e,W=0,X=0,Y=0,Z=0,$=M.ao(),_=M.ak(),ab=this._d.gi(M),bb=this._d.gh(M),cb=this._d.gj(M),db=this._d.g9(M),eb=this._t.a3(M),fb=Og._z;this._b.a2(M)&&(fb=this._b.b2(M));if(eb!=null){W=eb._d.ay(),X=eb._b.ay(),Y=eb._e.ay(),Z=eb._c.ay();if(W>0){var gb=fb._h.ay()+O.ay()+W+fb._k.ay(),hb=this.a7(db,gb),ib=this.a8(db,gb,hb),jb=bb+ib+hb*(fb._h.ay()+this.a4(O));for(var kb=eb._d.c1();kb.i1();kb.i2()){var lb=kb.i8();this._d.u1(lb),lb.a2()===M?this.c2(lb)||this._d.gx(lb,new ef(ab+cb,jb)):(!this.d1(lb),this._d.gy(lb,new ef(ab+cb,jb))),jb+=hb,this._d.h1(lb)}}if(X>0){var mb=fb._i.ay()+P.ay()+X+fb._l.ay(),nb=this.a7(db,mb),ob=this.a8(db,mb,nb),pb=bb+ob+nb*(fb._i.ay()+this.a4(P));for(var qb=eb._b.c1();qb.i1();qb.i2()){var rb=qb.i8();this._d.u1(rb),rb.a2()===M?this.c2(rb)||this._d.gx(rb,new ef(ab,pb)):this.d1(rb)||this._d.gy(rb,new ef(ab,pb)),pb+=nb,this._d.h1(rb)}}}if(O.ay()>0){O.a1(H);var sb=fb._h.ay()+O.ay()+W+fb._k.ay(),tb=this.a7(db,sb),ub=this.a8(db,sb,tb),vb=bb+ub+tb*fb._h.ay(),wb=!0;while(!O.ar()){var xb=O.x4();if(this.a3(xb)){wb&&(wb=!1,vb+=tb*W);var yb=xb.ag(),zb=this._d.gd(yb),Ab=zb.at();zb.ac(new ef(Ab.x,K.b()));if(this.c2(yb)){var Bb=this._a.i1(yb);zb.ac(new ef(Ab.x,Bb.y+this._d.g6(M))),zb.ac(new ef(Bb.x+this._d.g5(M),Bb.y+this._d.g6(M)))}else zb.ac(new ef(Ab.x,vb)),zb.ac(new ef(ab+cb,vb));this._d.xr(yb,M,yb.a3()),this._d.m1(yb,zb)}else{var Cb=xb.ae(),Db=this._d.gd(Cb),Eb=Db.au();Db.ae(new ef(Eb.x,K.a()));if(this.d1(Cb)){var Fb=this._g.i1(Cb);Db.ae(new ef(Eb.x,Fb.y+this._d.g6(M))),Db.ae(new ef(Fb.x+this._d.g5(M),Fb.y+this._d.g6(M)))}else Db.ae(new ef(Eb.x,vb)),Db.ae(new ef(ab+cb,vb));this._d.xr(Cb,Cb.a2(),M),this._d.m1(Cb,Db)}this._d.x4(xb),vb+=tb}}if(P.ay()>0){P.a1(I);var Gb=fb._i.ay()+P.ay()+X+fb._l.ay(),Hb=this.a7(db,Gb),Ib=this.a8(db,Gb,Hb),Jb=bb+Ib+Hb*fb._i.ay(),Kb=!0;while(!P.ar()){var Lb=P.x4();if(this.a3(Lb)){Kb&&(Kb=!1,Jb+=Hb*X);var Mb=Lb.ag(),Nb=this._d.gd(Mb),Ob=Nb.at();Nb.ac(new ef(Ob.x,K.b()));if(this.c2(Mb)){var Pb=this._a.i1(Mb);Nb.ac(new ef(Ob.x,Pb.y+this._d.g6(M))),Nb.ac(new ef(Pb.x+this._d.g5(M),Pb.y+this._d.g6(M)))}else Nb.ac(new ef(Ob.x,Jb)),Nb.ac(new ef(ab,Jb));this._d.xr(Mb,M,Mb.a3()),this._d.m1(Mb,Nb)}else{var Qb=Lb.ae(),Rb=this._d.gd(Qb),Sb=Rb.au();Rb.ae(new ef(Sb.x,K.a()));if(this.d1(Qb)){var Tb=this._g.i1(Qb);Rb.ae(new ef(Sb.x,Tb.y+this._d.g6(M))),Rb.ae(new ef(Tb.x+this._d.g5(M),Tb.y+this._d.g6(M)))}else Rb.ae(new ef(Sb.x,Jb)),Rb.ae(new ef(ab,Jb));this._d.xr(Qb,Qb.a2(),M),this._d.m1(Qb,Rb)}this._d.x4(Lb),Jb+=Hb}}var Ub=fb._g.ay()+fb._d.ay()+_+R.ay()+Q.ay()+Y+Z;cb=this._d.gj(M);var Vb=this.a7(cb,Ub),Wb=this.a8(cb,Ub,Vb);Ub=fb._b.ay()+fb._q.ay()+$+T.ay()+S.ay();var Xb=this.a7(cb,Ub),Yb=this.a8(cb,Ub,Xb);if(R.ay()>0){var Zb=Vb,$b=b,_b=this._d.gi(M)+Wb+Zb*(fb._g.ay()+R.ay()-1),ac=this._d.gh(M),bc=K._c-K._g-R.ay()*$b,cc;for(;!R.ar();this._d.x4(cc)){cc=R.x4();var dc=cc.ag(),ec=this._d.gd(dc),fc=ec.at();ec.ac(new ef(fc.x,K.b())),ec.ac(new ef(fc.x,bc));if(this.c2(dc)){var gc=this._a.i1(dc);ec.ac(new ef(gc.x+this._d.g5(M),bc)),ec.ac(new ef(gc.x+this._d.g5(M),gc.y+this._d.g6(M)))}else ec.ac(new ef(_b,bc)),ec.ac(new ef(_b,ac)),_b-=Zb;bc+=$b,this._d.xr(dc,M,dc.a3()),this._d.m1(dc,ec)}}if(Q.ay()>0){var hc=Vb,ic=b,jc=this._d.gi(M)+this._d.gj(M)-Wb-hc*fb._d.ay(),kc=this._d.gh(M),lc=K._c-K._g-ic,mc;for(;!Q.ar();this._d.x4(mc)){mc=Q.x4();var nc=mc.ag(),oc=this._d.gd(nc),pc=oc.at();oc.ac(new ef(pc.x,K.b())),oc.ac(new ef(pc.x,lc));if(this.c2(nc)){var qc=this._a.i1(nc);oc.ac(new ef(qc.x+this._d.g5(M),lc)),oc.ac(new ef(qc.x+this._d.g5(M),qc.y+this._d.g6(M)))}else oc.ac(new ef(jc,lc)),oc.ac(new ef(jc,kc)),jc-=hc;lc-=ic,this._d.xr(nc,M,nc.a3()),this._d.m1(nc,oc)}}if(T.ay()>0){var rc=Xb,sc=b,tc=this._d.gi(M)+Yb+rc*(fb._b.ay()+T.ay()-1),uc=this._d.gh(M)+this._d.g9(M),vc=uc+T.ay()*sc,wc;for(;!T.ar();this._d.x4(wc)){wc=T.x4();var xc=wc.ae(),yc=this._d.gd(xc),zc=yc.au();yc.ae(new ef(zc.x,K.a())),yc.ae(new ef(zc.x,vc));if(this.d1(xc)){var Ac=this._g.i1(xc);yc.ae(new ef(Ac.x+this._d.g5(M),vc)),yc.ae(new ef(Ac.x+this._d.g5(M),Ac.y+this._d.g6(M)))}else yc.ae(new ef(tc,vc)),yc.ae(new ef(tc,uc)),tc-=rc;vc-=sc,this._d.xr(xc,xc.a2(),M),this._d.m1(xc,yc)}}if(S.ay()>0){var Bc=Xb,Cc=b,Dc=this._d.gi(M)+this._d.gj(M)-Yb-Xb*fb._q.ay(),Ec=this._d.gh(M)+this._d.g9(M),Fc=Ec+Cc,Gc;for(;!S.ar();this._d.x4(Gc)){Gc=S.x4();var Hc=Gc.ae(),Ic=this._d.gd(Hc),Jc=Ic.au();Ic.ae(new ef(Jc.x,K.a())),Ic.ae(new ef(Jc.x,Fc));if(this.d1(Hc)){var Kc=this._g.i1(Hc);Ic.ae(new ef(Kc.x+this._d.g5(M),Fc)),Ic.ae(new ef(Kc.x+this._d.g5(M),Kc.y+this._d.g6(M)))}else Ic.ae(new ef(Dc,Fc)),Ic.ae(new ef(Dc,Ec)),Dc-=Bc;Fc+=Cc,this._d.xr(Hc,Hc.a2(),M),this._d.m1(Hc,Ic)}}while(!V.ar()){var Lc=V.c3(),Mc=this._d.gl(Lc);K.a()+12<Mc.y&&this._d.g7(Lc).i4(Mc.x,K.a())}while(!U.ar()){var Nc=U.c3(),Oc=this._d.gs(Nc);if(K.b()-12>Oc.y){var Pc=this._d.gf(Nc);Pc.ac(new ef(Oc.x,K.b())),this._d.s6(Nc,Pc)}}}}}for(var Qc=0;Qc<a.length;Qc++){var Rc=a[Qc];for(var Sc=Rc._b;Sc!=null;Sc=Sc.a()){var Tc=Sc.d(),Uc=this._t.a3(Tc);Uc!=null&&Uc._a!=null&&(this._d.x4(Uc._a),Rc.aw(Sc.b()))}}return this._d.xi(this._f),this._d.xj(this._a),this._d.xj(this._g),a},c3:function(a){return this.a3(a)?this.b1(a.ag()):this.a2(a.ae())},b1:function(a){return this._h==null?Og.s:this._h.i1(a)},a2:function(a){return this._l==null?Og.u:this._l.i1(a)},c2:function(a){if(a==null)return!1;var b=this.b1(a);return b!=null&&b.a()},d1:function(a){if(a==null)return!1;var b=this.a2(a);return b!=null&&b.a()},a3:function(a){return a.ao()===1},b2:function(a){return a.ak()===1},a4:function(a){var b=0;for(var c=a._b;c!=null;c=c.a())this.b2(c.d())&&b++;return b},d2:function(a){var b=this._k,c=Vg.d(a.length+1);for(var d=0;d<a.length;d++){var e=a[d],f=new Sg;c[d]=f,f._c=Number.MAX_VALUE,f._i=Number.MIN_VALUE;for(var g=e.x1();g.i1();g.i2()){var h=g.i9(),i=this._d.gb(h);f._c=Math.min(f._c,i.i2()),f._i=Math.max(f._i,i.i2()+i.i4())}}this._b.a5(a,c);for(var j=0;j<a.length;j++){var k=c[j];for(var l=a[j].x1();l.i1();l.i2()){var m=l.i9(),n=this._f.i1(m);n!=null&&(k._h=Math.max(k._h,Math.max(n._f.ay()*b,n._c.ay()*b)),k._f=Math.max(k._f,Math.max(n._b.ay()*b,n._h.ay()*b)))}}return c}}),Og.s=Dg.j(2),Og.u=Dg.j(1),Og._z=new Ng;var Pg=function(){this._af=0,this._b=0};d.ext(Pg,Object,{ib:function(a){this._af=a},ia:function(a,b,c){this.a6(a,b,c),this.b2(!1);var d=this.g();if(this.o()&&d>0){var e=this.r();for(var f=0;f<20&&d>0&&this.o();f++){this.b2(!0);var g=this.g();g<d&&(this.a7(e),d=g)}this.b3(e),this.b1()}return this.c()},a6:function(a,b,c){this._b=(new Date).getTime(),this._ac=a,this._ah=b;var d=this;this._p=function(a,b){var c=d._n[a.al()]-d._n[b.al()];return c>0?1:c>=0?0:-1},this._ad=Vg.d(c);for(var e=0;e<this._ad.length;e++)this._ad[e]=new Yf;this._ab=Vg.a(this._ac.x0()),this._f=Vg.d(this._ac.x0()),this._n=Vg.a(this._ac.x0()+1);var f=this._ab;this._o=function(a,b){if(a==null&&b!=null)return 1;if(a!=null&&b==null)return-1;if(a==null&&b==null)return 0;var c=a,d=b,e=c._h,g=c.a2(),h=d.a2(),i=f[g.al()]-f[h.al()];if(i===0){var j=Pg.b(Dg.h(e,c),e.gn(c)),k=Pg.b(Dg.h(e,d),e.gn(d)),l=j-k;if(l===0){var m=f[c.a3().al()]-f[d.a3().al()];if(m===0){var n=Pg.a(Dg.i(e,c),e.gk(c)),o=Pg.a(Dg.i(e,d),e.gk(d));return n-o}return m}return l}return i},this._l=function(a,b){if(a==null&&b!=null)return 1;if(a!=null&&b==null)return-1;if(a==null&&b==null)return 0;var c=a,d=b,e=c._h,g=c.a3(),h=d.a3(),i=f[g.al()]-f[h.al()];if(i===0){var j=Pg.a(Dg.i(e,c),e.gk(c)),k=Pg.a(Dg.i(e,d),e.gk(d)),l=j-k;if(l===0){var m=f[c.a2().al()]-f[d.a2().al()];if(m===0){var n=Pg.b(Dg.h(e,c),e.gn(c)),o=Pg.b(Dg.h(e,d),e.gn(d));return n-o}return m}return l}return i},this._z=function(a,b){if(a==null&&b!=null)return 1;if(a!=null&&b==null)return-1;if(a==null&&b==null)return 0;var c=a,d=b,e=c._h,f=Pg.b(Dg.h(e,c),e.gn(c)),g=Pg.b(Dg.h(e,d),e.gn(d));return f-g},this._e=function(a,b){if(a==null&&b!=null)return 1;if(a!=null&&b==null)return-1;if(a==null&&b==null)return 0;var c=a,d=b,e=c._h,f=Pg.a(Dg.i(e,c),e.gk(c)),g=Pg.a(Dg.i(e,d),e.gk(d));return f-g},this._ac.x2(this._e,this._z)},c:function(){this._ah=null,this._aa=null,this._f=null,this._n=null,this._p=null,this._o=null,this._l=null,this._ac=null;var a=this._ad;return this._ad=null,a},o:function(){var a=(new Date).getTime()-this._b;return a<=this._af},m:function(){var a=this,b=function(b,c){return Math.ceil(a._n[b.a3().al()])-Math.ceil(a._n[c.a3().al()])};for(var c=this._ac.x9();c.i1();c.i2()){for(var d=c.i9().aw();d.i1();d.i2())this._n[d.i9().al()]=ug.j();c.i9().av(b)}},b2:function(a){for(var b=0;b<this._ad.length;b++)this._ad[b].af();if(a){this.m();for(var c=0,d=this._ab.length;c<d;c++)this._ab[c]=0;this._ac.x2(null,this._z)}var e=this._ac.xm();this._ah.i7(e,0);for(var f=this._ac.x9();f.i1();f.i2())f.i9().ak()===0&&f.i9()!==e&&this._ac.xo(e,f.i9());var g=new tf(this);g.a6(!0),g.a9(this._ac,e),this._ad[0].at(),this._ac.x4(e),this.d()},a1:function(){this._ac.x2(this._o,this._l);var a=0;for(var b=1;b<this._ad.length;b++){var c=this.a2(this._ad[b-1],this._ad[b]);a+=c}var d=0;return a+=d,a},a2:function(a,b){var c=a.ah(),d=b.ah(),e=new Ff,f=new Ff;this._aa=Vg.d(this._ac.x0());var g=0;for(;c.i1()&&d.i1();d.i2())g+=this.a8(c.i6(),e,f,!0),g+=this.a8(d.i6(),f,e,!1),c.i2();for(;c.i1();c.i2())g+=this.a8(c.i6(),e,f,!0);for(;d.i1();d.i2())g+=this.a8(d.i6(),f,e,!1);return g},a8:function(a,b,c,d){var e=0,f=0,g=0;if(this._aa[a.al()]!=null){var h=this._aa[a.al()].a();for(var i=b._b;i!==h;i=i.a()){var j=i._c;j===a?(e++,g+=f,b.aw(i)):f++}}var k=e*c.ay()+g;if(d)for(var l=a.ag();l!=null;l=l.a8()){var m=l.a3();this._ab[m.al()]>=this._ab[a.al()]&&(this._aa[m.al()]=c.ae(m))}else for(var n=a.ae();n!=null;n=n.a7()){var o=n.a2();this._ab[o.al()]>this._ab[a.al()]&&(this._aa[o.al()]=c.ae(o))}return k},g:function(){var a=this.r(),b=this.a1(),c=!0;for(var d=0;d<3&&this.o()&&b>0;){var e=this.k();e<b?(this.a7(a),b=e):d++,c=!c}this.b3(a),this.b1();if(b>0){var f=1;for(var g=0;f===1&&b>0;g++){this.e(),this.i();var h=this.a1();h<b?(f=1,this.a7(a)):f=-1,b=h}this.b3(a),this.b1()}return b},e:function(){var a=this.l(),b=this.r(),c=Vg.d(this._ac.x0());for(var d=this._ad.length-1;d>=0;d--)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(f.ak()===1&&f.ao()===1){var g=a.i1(f.ag());if(g!=null&&c[g.al()]==null){var h=this.a4(f,g),i=g.al(),j=c[i]=Vg.d(h+1);for(var k=j.length-1;k>=0;k--)j[k]=new Ff}}}for(var l=0;l<this._ad.length;l++)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(n.ak()===1&&n.ao()===1){var o=a.i1(n.ag());if(o!=null){var p=o.al(),q=this.a4(n,o)-1;c[p][q].ae(n.ae())}}else for(var r=n.ae();r!=null;r=r.a7()){var s=a.i1(r);if(s!=null){var t=s.al(),u=this.a4(n,s)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(c[w.al()]!=null)for(var x=w.ag();x!=null;x=x.a8()){var y=a.i1(x);if(y!=null)for(var z=c[y.al()];z[0].ay()>0;){var A=0,B;do{B=z[A].am();var C=B.a3();if(C.ak()!==1||C.ao()!==1)break;A++}while(!0);var D=z[A].at().a3();A--,D=B.a2(),B=z[A].at();var E=B.a3();while(A>=0){b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ae().a2();if(--A>=0){var F=z[A].at();E=F.a3()}}}}}this.b1(),this._ac.xj(a)},i:function(){var a=this.f(),b=this.r(),c=Vg.d(this._ac.x0());for(var d=0;d<this._ad.length;d++)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(f.ak()===1&&f.ao()===1){var g=a.i1(f.ae());if(g!=null&&c[g.al()]==null){var h=this.a4(g,f),i=g.al(),j=c[i]=Vg.d(h+1);for(var k=j.length-1;k>=0;k--)j[k]=new Ff}}}for(var l=this._ad.length-1;l>=0;l--)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(n.ak()===1&&n.ao()===1){var o=a.i1(n.ae());if(o!=null){var p=o.al(),q=this.a4(o,n)-1;c[p][q].ae(n.ag())}}else for(var r=n.ag();r!=null;r=r.a8()){var s=a.i1(r);if(s!=null){var t=s.al(),u=this.a4(s,n)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(c[w.al()]!=null)for(var x=w.ae();x!=null;x=x.a7()){var y=a.i1(x);if(y!=null)for(var z=c[y.al()];z[0].ay()>0;){var A=0,B;do{B=z[A].am();var C=B.a2();if(C.ak()!==1||C.ao()!==1)break;A++}while(!0);var D=z[A].at().a2();A--,D=B.a3(),B=z[A].at();var E=B.a2();while(A>=0){b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ag().a3();if(--A>=0){var F=z[A].at();E=F.a2()}}}}}this.b1(),this._ac.xj(a)},a4:function(a,b){return this._ah.i2(a)-this._ah.i2(b)},l:function(){var a=ag.a6(Vg.d(this._ac.xg()));for(var b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ao()>1){var d=0;for(var e=c.ag();e!=null;e=e.a8()){var f=e.a3();f.ak()===1&&f.ao()===1&&d++}if(d>1)for(var g=c.ag();g!=null;g=g.a8()){var h=g,i=h.a3();if(i.ak()===1&&i.ao()===1){for(;i.ak()===1&&i.ao()===1;i=h.a3())a.i8(h,c),h=i.ag();a.i8(h,c)}}}}return a},f:function(){var a=ag.a6(Vg.d(this._ac.xg()));for(var b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ak()>1){var d=0;for(var e=c.ae();e!=null;e=e.a7()){var f=e.a2();f.ak()===1&&f.ao()===1&&d++}if(d>1)for(var g=c.ae();g!=null;g=g.a7()){var h=g,i=h.a2();if(i.ak()===1&&i.ao()===1){for(;i.ak()===1&&i.ao()===1;i=h.a2())a.i8(h,c),h=i.ae();a.i8(h,c)}}}}return a},k:function(){for(var a=1;a<this._ad.length;a++){var b=this._ad[a];for(var c=b.ah();c.i1();c.i2()){var d=c.i6();this._n[d.al()]=this.a5(d,b.ay(),d.am(),this._ad[a-1].ay()),this._n[d.al()]+=this._ab[d.al()]/(this._ad[a-1].ay()*3)}this.a3(b,this._p)}return this.a1()},a5:function(a,b,c,d){var e=0;if(c.i7()===0)e=d*this._ab[a.al()]/b;else{for(;c.i1();c.i2()){var f=c.i8();f.a2()===a?e+=this._ab[f.a3().al()]:e+=this._ab[f.a2().al()]}e/=c.i7()}return e},a7:function(a){Vg.f(this._ab,a,a.length)},b3:function(a){Vg.f(a,this._ab,a.length)},r:function(){var a=Vg.a(this._ab.length);return this.a7(a),a},d:function(){for(var a=0;a<this._ad.length;a++){var b=0;for(var c=this._ad[a].ah();c.i1();)this._ab[c.i6().al()]=b,c.i2(),b++}},b1:function(){for(var a=0;a<this._ad.length;a++){var b=this._ad[a];for(var c=b._b;c!=null;c=c.a()){var d=c.d();this._f[this._ab[d.al()]]=d}var e=0;for(var f=b._b;f!=null;)f.c(this._f[e]),f=f.a(),e++}},a3:function(a,b){var c=a.ah();for(var d=0;d<a.ay();c.i2())this._f[d]=c.i6(),d++;Vg.s(this._f,a.ay(),b);var e=0;for(var f=a._b;f!=null;)f.c(this._f[e]),this._ab[this._f[e].al()]=e,f=f.a(),e++}}),Pg.b=function(a,b){if(a==null)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4-d:a.f()?-1e4+d:a.c()?-2e4-c:c},Pg.a=function(a,b){if(a==null)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4+d:a.f()?-1e4-d:a.d()?-2e4-c:c};var Qg=function(){Qg.superClass.constructor.call(this),this._i6=0,this._i3=2147483647,this._i0=60,this._iz=20,this._i2=20,this._i4=20,this.i5(!1),this._i7=new Ig,this._i1=new Pg,this._i8=new Lg};d.ext(Qg,dg,{j2:function(){return this._i2},i4:function(a){return!0},i3:function(a){this._i6=(new Date).getTime(),Cg.d(a,!1);var b=a.xk(),c=a.xk(),d=a.xl(),e=new Gf,f=new Og(a,b,c,d);f.a6(this.j2()),this._i8.i3(this._iz),this._i8.i6(this._i0),this._i8.i4(this._i2),this._i8.i5(this._i4),this._i8.i2(c);var g=this._i7.i1(a,b,e);for(var h=e.c1();h.i1();h.i2()){var i=h.i8();d.i7(i,!0);var j=a.gn(i);a.gt(i,a.gk(i)),a.gz(i,j)}this.a2(a,b,c),g=f.a9(g);var k=this.j1(a,b,g);k=f.a5(k),k=f.b3(k),this._i8.i1(a,k,b),k=f.g2(k),f.e2(k),this.b(a,c),this.w(a),this.a1(a,e),f.e1(),a.xj(d),a.xi(c),a.xi(b)},j1:function(a,b,c){if(this._i1 instanceof Pg){var d=this._i1,e=(new Date).getTime()-this._i6;d.ib(this._i3-e)}var f=this._i1.ia(a,b,c);return f},a1:function(a,b){for(var c=b.c1();c.i1();c.i2()){var d=c.i8(),e=a.gs(d),f=a.gl(d);a.x3(d);var g=a.gp(d);a.s5(d,g.a()),a.gy(d,e),a.gx(d,f)}},b:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=b.i1(d);if(e!=null&&!a.xp(e)){for(var f=d.am().i8().a2();b.i1(f)!=null;f=d.am().i8().a2())d=f;a.u1(e);var g=d.ae(),h=new Ff;for(;b.i1(g.a3())!=null;g=g.a3().ag()){var i=a.gs(g);h.aa(i),h.az(a.gf(g));var j=a.gl(g);j.equals(i)||h.aa(j)}var k=a.gs(g);h.aa(k),h.az(a.gf(g));var l=a.gl(g);l.equals(k)||h.aa(l),a.m1(e,h)}}for(var m=a.x9();m.i1();m.i2())b.i1(m.i9())!=null&&a.x4(m.i9())},w:function(a){for(var b=a.xf();b.i1();b.i2()){var c=b.i8(),d=a.g2(c);if(d.i1()>0){var e=new Ce,f=a.gc(c),g=f.c(),h=g.i6();g.i2();var i=h.x,j=h.y;if(g.i1()){var k=g.i6(),l=k.x,m=k.y;g.i2();for(;g.i1();g.i2()){var n=g.i6(),o=n.x,p=n.y,q=(i-o)*(m-p)/(j-p)+o;Math.abs(q-l)>=1&&(e.add(k),i=l,j=m),k=n,l=o,m=p}}e.size()<d.i1()&&a.s5(c,new kf(e))}}},a2:function(a,b,c){var d=a.g8().c1();d.i5();for(;d.i1();d.i3()){var e=d.i8().a2(),f=d.i8().a3(),g=b.i2(f)-b.i2(e);if(g>1){var h=null,i=null,j=e;for(;g>1;g--)h=a.xm(),a.s7(h,1,1),a.s4(h,ug._A),i=a.xo(j,h),j===e&&a.gt(i,a.gn(d.i8())),b.i7(h,b.i2(j)+1),c.z1(h,d.i8()),j=h;i=a.xo(h,f),a.gz(i,a.gk(d.i8())),a.h1(d.i8())}}}});var Rg=function(a,b,c,d){this._i=20,this._j=a,this._g=b,this._a=c,this._h=d};d.ext(Rg,Object,{a1:function(a){this._i=a},b2:function(a){return this._e==null?!1:this._e.i4(a)},a3:function(a){return this._f==null?null:this._f.i1(a)},d:function(){this._j.xi(this._f),this._j.xi(this._e)}});var Sg=function(){this._c=0,this._i=0,this._g=0,this._j=0,this._f=0,this._h=0,this._d=0,this._e=0,this._a=0,this._b=0};d.ext(Sg,Object,{a:function(){return this._c-this._g-this._f-this._a},b:function(){return this._i+this._j+this._h+this._b}});var Tg=function(){this._d=new Gf,this._b=new Gf,this._c=new Gf,this._e=new Gf};d.ext(Tg,Object,{});var Ug=function(a,b,c,d,e,f,g,h){this._d=a,this._a=b,this._b=c,this._h=d,this._f=e,this._c=f,this._e=g,this._g=h};d.ext(Ug,Object,{});var Vg={};Vg.a=function(a,b){var c=[];for(var d=0;d<a;d++)c[d]=b||0;return c},Vg.b=function(a){var b=[];for(var c=0;c<a;c++)b[c]=!1;return b},Vg.c=function(a,b){if(a instanceof ef)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y<=b.y?0:1;if(a instanceof ff)return b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;if(a instanceof hf)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y>b.y?1:b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;throw"Unkown Type: "+a},Vg.d=function(a){var b=[];for(var c=0;c<a;c++)b[c]=null;return b},Vg.e=function(a,b){var c=[];for(var d=0;d<a;d++)c[d]=Vg.a(b);return c},Vg.f=function(a,b,c){for(var d=0;d<c;d++)b[d]=a[d]},Vg.s=function(a,b,c){var d=[];Vg.f(a,d,b),d.sort(c),Vg.f(d,a,b)},Vg.n=function(a,b){return a-b}})(this);